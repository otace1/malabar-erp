<?php
	class maClasse{

		//Methodes permettant de créer
		public function creerLicenceIB($id_banq, $num_lic, $id_cli, $id_post,
										$id_mon, $fob, $assurance, $fret,
										$autre_frais, $fsi, $aur,
										$id_mod_trans, $ref_fact, $date_fact, $fournisseur,
										$date_val, $date_exp, $id_march, $id_mod_lic,
										$id_util, $fichier_lic, $tmp, $fichier_fact, $tmp_fact,
										$id_type_lic, $id_mod_paie, $id_sous_type_paie,
										$provenance, $commodity){
			include('connexion.php');
			$entree['id_banq'] = $id_banq;$entree['num_lic'] = $num_lic;
			$entree['id_cli'] = $id_cli;$entree['id_post'] = $id_post;
			$entree['id_mon'] = $id_mon;$entree['fob'] = $fob;
			$entree['assurance'] = $assurance;$entree['fret'] = $fret;$entree['autre_frais'] = $autre_frais;
			$entree['fsi'] = $fsi;$entree['aur'] = $aur;
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_fact'] = $ref_fact;$entree['date_fact'] = $date_fact;
			$entree['fournisseur'] = $fournisseur;$entree['date_val'] = $date_val;$entree['date_exp'] = $date_exp;
			$entree['id_march'] = $id_march;$entree['id_mod_lic'] = $id_mod_lic;$entree['id_util'] = $id_util;
			$entree['fichier_lic'] = $fichier_lic;$entree['fichier_fact'] = $fichier_fact;
			$entree['id_type_lic'] = $id_type_lic;$entree['id_mod_paie'] = $id_mod_paie;
			$entree['id_sous_type_paie'] = $id_sous_type_paie; $entree['provenance'] = $provenance;
			$entree['commodity'] = $commodity;

			if ($entree['date_fact'] == '') {
				$entree['date_fact'] = NULL;
			}

			if ($entree['date_val'] == '') {
				$entree['date_val'] = NULL;
			}

			if ($entree['date_exp'] == '') {
				$entree['date_exp'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO licence(id_banq, num_lic, id_cli,
																id_post, id_mon, fob,
																assurance, fret, autre_frais,
																fsi, aur,
																id_mod_trans, ref_fact, date_fact,
																fournisseur, date_val, id_march,
																id_mod_lic, id_util, fichier_lic, fichier_fact,
																id_type_lic, id_mod_paie, id_sous_type_paie, provenance, commodity)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?)');
			$requete-> execute(array($entree['id_banq'], $entree['num_lic'], $entree['id_cli'],
									$entree['id_post'], $entree['id_mon'], $entree['fob'],
									$entree['assurance'], $entree['fret'], $entree['autre_frais'],
									$entree['fsi'], $entree['aur'],
									$entree['id_mod_trans'], $entree['ref_fact'], $entree['date_fact'],
									$entree['fournisseur'], $entree['date_val'], $entree['id_march'],
									$entree['id_mod_lic'], $entree['id_util'], $entree['fichier_lic'],
									$entree['fichier_fact'], $entree['id_type_lic'], $entree['id_mod_paie'],
									$entree['id_sous_type_paie'], $entree['provenance'], $entree['commodity']));

			$this-> creerDateExpirationLicence($num_lic, $date_exp);

			$dossier = '../dossiers/'.$num_lic;

			if(!is_dir($dossier)){
				mkdir("../dossiers/$num_lic", 0777);
			}

			move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
			move_uploaded_file($tmp_fact, '../dossiers/'.$num_lic.'/' . basename($fichier_fact));
			//move_uploaded_file($tmp, '../dossiers/');
		}

		public function creerMasterDataFactureDossier($ref_fact, $master_data, $tmp){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['master_data'] = $master_data;

			$requete = $connexion-> prepare('UPDATE facture_dossier SET master_data = ? WHERE ref_fact = ?');
			$requete-> execute(array($entree['master_data'], $entree['ref_fact']));

			$dossier = '../FACTURES DOSSIERS/'.$ref_fact;

			if(!is_dir($dossier)){
				mkdir("../FACTURES DOSSIERS/$ref_fact", 0777);
			}

			move_uploaded_file($tmp, '../FACTURES DOSSIERS/'.$ref_fact.'/' . basename($master_data));
			//move_uploaded_file($tmp, '../dossiers/');
		}

		public function creerLicenceIB2($id_banq, $num_lic, $id_cli, $id_post,
										$id_mon, $fob, $assurance, $fret,
										$autre_frais, $fsi, $aur,
										$id_mod_trans, $ref_fact, $date_fact, $fournisseur,
										$date_val, $date_exp, $id_march, $id_mod_lic,
										$id_util, $fichier_lic, $tmp, $fichier_fact, $tmp_fact,
										$id_type_lic, $id_mod_paie, $id_sous_type_paie,
										$provenance, $commodity, $tonnage, $poids, $unit_mes, $ref_av){
			include('connexion.php');
			$entree['id_banq'] = $id_banq;$entree['num_lic'] = $num_lic;
			$entree['id_cli'] = $id_cli;$entree['id_post'] = $id_post;
			$entree['id_mon'] = $id_mon;$entree['fob'] = $fob;
			$entree['assurance'] = $assurance;$entree['fret'] = $fret;$entree['autre_frais'] = $autre_frais;
			$entree['fsi'] = $fsi;$entree['aur'] = $aur;
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_fact'] = $ref_fact;$entree['date_fact'] = $date_fact;
			$entree['fournisseur'] = $fournisseur;$entree['date_val'] = $date_val;$entree['date_exp'] = $date_exp;
			$entree['id_march'] = $id_march;$entree['id_mod_lic'] = $id_mod_lic;$entree['id_util'] = $id_util;
			$entree['fichier_lic'] = $fichier_lic;$entree['fichier_fact'] = $fichier_fact;
			$entree['id_type_lic'] = $id_type_lic;$entree['id_mod_paie'] = $id_mod_paie;
			$entree['id_sous_type_paie'] = $id_sous_type_paie; $entree['provenance'] = $provenance;
			$entree['commodity'] = $commodity;
			$entree['tonnage'] = $tonnage; $entree['poids'] = $poids;
			$entree['unit_mes'] = $unit_mes;
			$entree['ref_av'] = $ref_av;

			if ($entree['date_fact'] == '') {
				$entree['date_fact'] = NULL;
			}

			if ($entree['date_val'] == '') {
				$entree['date_val'] = NULL;
			}

			if ($entree['date_exp'] == '') {
				$entree['date_exp'] = NULL;
			}

			if ($entree['fob'] == '') {
				$entree['fob'] = NULL;
			}
			if ($entree['fret'] == '') {
				$entree['fret'] = NULL;
			}
			if ($entree['assurance'] == '') {
				$entree['assurance'] = NULL;
			}
			if ($entree['autre_frais'] == '') {
				$entree['autre_frais'] = NULL;
			}
			
			if ($entree['id_march'] == '') {
				$entree['id_march'] = NULL;
			}

			/*if ($entree[''] == '') {
				$entree[''] = NULL;
			}*/

			// echo "<br> id_banq = $id_banq";echo "<br> num_lic = $num_lic";echo "<br> id_cli = $id_cli";
			// echo "<br> id_post = $id_post";echo "<br> id_mon = $id_mon";echo "<br> fob = $fob";
			// echo "<br> assurance = $assurance";echo "<br> fret = $fret";echo "<br> autre_frais = $autre_frais";
			// echo "<br> fsi = $fsi";echo "<br> aur = $aur";echo "<br> id_mod_trans = $id_mod_trans";
			// echo "<br> ref_fact = $ref_fact";echo "<br> date_fact = $date_fact";echo "<br> fournisseur = $fournisseur";
			// echo "<br> date_val = $date_val";echo "<br> date_exp = $date_exp";echo "<br> id_march = $id_march";
			// echo "<br> id_mod_lic = $id_mod_lic";echo "<br> id_util = $id_util";echo "<br> fichier_lic = $fichier_lic";
			// echo "<br> fichier_fact = $fichier_fact";echo "<br> id_type_lic = $id_type_lic";echo "<br> id_mod_paie = $id_mod_paie";
			// echo "<br> id_sous_type_paie = $id_sous_type_paie";echo "<br> provenance = $provenance";echo "<br> commodity = $commodity";
			// echo "<br>--------------------------------";

			$requete = $connexion-> prepare('INSERT INTO licence(id_banq, num_lic, id_cli,
																id_post, id_mon, fob,
																assurance, fret, autre_frais,
																fsi, aur,
																id_mod_trans, ref_fact, date_fact,
																fournisseur, date_val, id_march,
																id_mod_lic, id_util, fichier_lic, fichier_fact,
																id_type_lic, id_mod_paie, id_sous_type_paie, provenance, commodity, tonnage, poids, unit_mes, ref_av)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?)');
			$requete-> execute(array($entree['id_banq'], $entree['num_lic'], $entree['id_cli'],
									$entree['id_post'], $entree['id_mon'], $entree['fob'],
									$entree['assurance'], $entree['fret'], $entree['autre_frais'],
									$entree['fsi'], $entree['aur'],
									$entree['id_mod_trans'], $entree['ref_fact'], $entree['date_fact'],
									$entree['fournisseur'], $entree['date_val'], $entree['id_march'],
									$entree['id_mod_lic'], $entree['id_util'], $entree['fichier_lic'],
									$entree['fichier_fact'], $entree['id_type_lic'], $entree['id_mod_paie'],
									$entree['id_sous_type_paie'], $entree['provenance'], $entree['commodity'],
									$entree['tonnage'], $entree['poids'], $entree['unit_mes'], $entree['ref_av']));

			if ($date_exp != null) {
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

			if ($tmp != null) {
				$dossier = '../dossiers/'.$num_lic;

				if(!is_dir($dossier)){
					mkdir("../dossiers/$num_lic", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
				move_uploaded_file($tmp_fact, '../dossiers/'.$num_lic.'/' . basename($fichier_fact));
				}
				//move_uploaded_file($tmp, '../dossiers/');
			// return $this->$connexion->lastInsertId();
		}

		public function creerLicenceEtFactureIB($id_banq, $num_lic, $id_cli, $id_post,
										$id_mon, $fob, $assurance, $fret,
										$autre_frais, $fsi, $aur,
										$id_mod_trans, $ref_fact, $date_fact, $fournisseur,
										$date_val, $date_exp, $id_march, $id_mod_lic,
										$id_util, $fichier_lic, $tmp, $fichier_fact, $tmp_fact,
										$id_type_lic, $id_mod_paie, $id_sous_type_paie,
										$provenance, $commodity, $tonnage, $poids, $unit_mes, 
										$ref_av, $origine, $date_fact_rec, $ref_po){
			include('connexion.php');
			$entree['id_banq'] = $id_banq;$entree['num_lic'] = $num_lic;
			$entree['id_cli'] = $id_cli;$entree['id_post'] = $id_post;
			$entree['id_mon'] = $id_mon;$entree['fob'] = $fob;
			$entree['assurance'] = $assurance;$entree['fret'] = $fret;$entree['autre_frais'] = $autre_frais;
			$entree['fsi'] = $fsi;$entree['aur'] = $aur;
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_fact'] = $ref_fact;$entree['date_fact'] = $date_fact;
			$entree['fournisseur'] = $fournisseur;$entree['date_val'] = $date_val;$entree['date_exp'] = $date_exp;
			$entree['id_march'] = $id_march;$entree['id_mod_lic'] = $id_mod_lic;$entree['id_util'] = $id_util;
			$entree['fichier_lic'] = $fichier_lic;$entree['fichier_fact'] = $fichier_fact;
			$entree['id_type_lic'] = $id_type_lic;$entree['id_mod_paie'] = $id_mod_paie;
			$entree['id_sous_type_paie'] = $id_sous_type_paie; $entree['provenance'] = $provenance;
			$entree['commodity'] = $commodity;
			$entree['tonnage'] = $tonnage; $entree['poids'] = $poids;
			$entree['unit_mes'] = $unit_mes;
			$entree['ref_av'] = $ref_av;
			$entree['origine'] = $origine;
			$entree['date_fact_rec'] = $date_fact_rec;
			$entree['ref_po'] = $ref_po;

			if ($entree['date_fact'] == '') {
				$entree['date_fact'] = NULL;
			}

			if ($entree['date_val'] == '') {
				$entree['date_val'] = NULL;
			}

			if ($entree['date_exp'] == '') {
				$entree['date_exp'] = NULL;
			}

			if ($entree['fob'] == '') {
				$entree['fob'] = NULL;
			}
			if ($entree['fret'] == '') {
				$entree['fret'] = NULL;
			}
			if ($entree['assurance'] == '') {
				$entree['assurance'] = NULL;
			}
			if ($entree['autre_frais'] == '') {
				$entree['autre_frais'] = NULL;
			}
			
			if ($entree['id_march'] == '') {
				$entree['id_march'] = NULL;
			}

			/*if ($entree[''] == '') {
				$entree[''] = NULL;
			}*/

			// echo "<br> id_banq = $id_banq";echo "<br> num_lic = $num_lic";echo "<br> id_cli = $id_cli";
			// echo "<br> id_post = $id_post";echo "<br> id_mon = $id_mon";echo "<br> fob = $fob";
			// echo "<br> assurance = $assurance";echo "<br> fret = $fret";echo "<br> autre_frais = $autre_frais";
			// echo "<br> fsi = $fsi";echo "<br> aur = $aur";echo "<br> id_mod_trans = $id_mod_trans";
			// echo "<br> ref_fact = $ref_fact";echo "<br> date_fact = $date_fact";echo "<br> fournisseur = $fournisseur";
			// echo "<br> date_val = $date_val";echo "<br> date_exp = $date_exp";echo "<br> id_march = $id_march";
			// echo "<br> id_mod_lic = $id_mod_lic";echo "<br> id_util = $id_util";echo "<br> fichier_lic = $fichier_lic";
			// echo "<br> fichier_fact = $fichier_fact";echo "<br> id_type_lic = $id_type_lic";echo "<br> id_mod_paie = $id_mod_paie";
			// echo "<br> id_sous_type_paie = $id_sous_type_paie";echo "<br> provenance = $provenance";echo "<br> commodity = $commodity";
			// echo "<br>--------------------------------";

			$requete = $connexion-> prepare('INSERT INTO licence(id_banq, num_lic, id_cli,
																id_post, id_mon, fob,
																assurance, fret, autre_frais,
																fsi, aur,
																id_mod_trans, ref_fact, date_fact,
																fournisseur, date_val, id_march,
																id_mod_lic, id_util, fichier_lic, fichier_fact,
																id_type_lic, id_mod_paie, id_sous_type_paie, provenance, 
																commodity, tonnage, poids, unit_mes, ref_av, origine, 
																date_fact_rec, ref_po)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['id_banq'], $entree['num_lic'], $entree['id_cli'],
									$entree['id_post'], $entree['id_mon'], $entree['fob'],
									$entree['assurance'], $entree['fret'], $entree['autre_frais'],
									$entree['fsi'], $entree['aur'],
									$entree['id_mod_trans'], $entree['ref_fact'], $entree['date_fact'],
									$entree['fournisseur'], $entree['date_val'], $entree['id_march'],
									$entree['id_mod_lic'], $entree['id_util'], $entree['fichier_lic'],
									$entree['fichier_fact'], $entree['id_type_lic'], $entree['id_mod_paie'],
									$entree['id_sous_type_paie'], $entree['provenance'], $entree['commodity'],
									$entree['tonnage'], $entree['poids'], $entree['unit_mes'], $entree['ref_av'], 
									$entree['origine'], $entree['date_fact_rec'], $entree['ref_po']));

			if ($date_exp != null) {
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

			if ($tmp != null) {
				$dossier = '../dossiers/'.$num_lic;

				if(!is_dir($dossier)){
					mkdir("../dossiers/$num_lic", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
				move_uploaded_file($tmp_fact, '../dossiers/'.$num_lic.'/' . basename($fichier_fact));
				}
				//move_uploaded_file($tmp, '../dossiers/');
			// return $this->$connexion->lastInsertId();
		}

		public function edit_facture_licence_backup($num_lic, $ref_fact, $date_fact, $date_fact_rec, $fournisseur, 
											$commodity, $ref_po, $origine, $provenance, $fob, $fret, $assurance, 
											$autre_frais, $id_mon, $poids, $unit_mes){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['ref_fact'] = $ref_fact;
			$entree['date_fact'] = $date_fact;
			$entree['date_fact_rec'] = $date_fact_rec;
			$entree['fournisseur'] = $fournisseur;
			$entree['commodity'] = $commodity;
			$entree['ref_po'] = $ref_po;
			$entree['origine'] = $origine;
			$entree['provenance'] = $provenance;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['id_mon'] = $id_mon;
			$entree['poids'] = $poids;
			$entree['unit_mes'] = $unit_mes;

			$requete = $connexion-> prepare('UPDATE licence
												SET ref_fact = ?, date_fact = ?, date_fact_rec = ?, fournisseur = ?, commodity = ?, ref_po = ?, origine = ?, provenance = ?, fob = ?, fret = ?, assurance = ?, autre_frais = ?, id_mon = ?, poids = ?, unit_mes = ?
												WHERE num_lic = ?');
			$requete-> execute(array($entree['ref_fact'], $entree['date_fact'], $entree['date_fact_rec'], $entree['fournisseur'], $entree['commodity'], $entree['ref_po'], $entree['origine'], $entree['provenance'], $entree['fob'], $entree['fret'], $entree['assurance'], $entree['autre_frais'], $entree['id_mon'], $entree['poids'], $entree['unit_mes'], $entree['num_lic']));
		}

		public function edit_facture_licence($ref_fact_old, $ref_fact, $date_fact, $date_fact_rec, $fournisseur, 
											$commodity, $po_ref, $montant_fact, $id_mon, $id_cli, $date_val, $fret_fact, $assurance_fact, $autre_frais_fact){
			include('connexion.php');
			$entree['ref_fact_old'] = $ref_fact_old;
			$entree['ref_fact'] = $ref_fact;
			$entree['date_fact'] = $date_fact;
			$entree['date_fact_rec'] = $date_fact_rec;
			$entree['fournisseur'] = $fournisseur;
			$entree['commodity'] = $commodity;
			$entree['po_ref'] = $po_ref;
			$entree['montant_fact'] = $montant_fact;
			$entree['id_mon'] = $id_mon;
			$entree['id_cli'] = $id_cli;
			$entree['date_val'] = $date_val;
			$entree['fret_fact'] = $fret_fact;
			$entree['assurance_fact'] = $assurance_fact;
			$entree['autre_frais_fact'] = $autre_frais_fact;

			$requete = $connexion-> prepare('UPDATE facture_licence
												SET ref_fact = ?, date_fact = ?, date_fact_rec = ?, fournisseur = ?, commodity = ?, po_ref = ?, montant_fact = ?, id_mon = ?, id_cli = ?, date_val = ?, fret_fact = ?, assurance_fact = ?, autre_frais_fact = ?
												WHERE ref_fact = ?');
			$requete-> execute(array($entree['ref_fact'], $entree['date_fact'], $entree['date_fact_rec'], $entree['fournisseur'], $entree['commodity'], $entree['po_ref'], $entree['montant_fact'], $entree['id_mon'], $entree['id_cli'], $entree['date_val'], $entree['fret_fact'], $entree['assurance_fact'], $entree['autre_frais_fact'], $entree['ref_fact_old']));
		}

		public function creerEB($num_lic, $id_march, $id_cli, $id_mod_lic,
								$id_mod_trans, $id_mon, $destination, $date_val,
								$date_exp, $poids, $fob, $lot_pret, $id_banq, $id_util, 
								$fichier_lic, $tmp){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['id_march'] = $id_march;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mon'] = $id_mon;
			$entree['destination'] = $destination;
			$entree['date_val'] = $date_val;
			$entree['date_exp'] = $date_exp;
			$entree['poids'] = $poids;
			$entree['fob'] = $fob;
			$entree['lot_pret'] = $lot_pret;
			$entree['id_banq'] = $id_banq;
			$entree['id_util'] = $id_util;
			$entree['fichier_lic'] = $fichier_lic;


			$requete = $connexion-> prepare('INSERT INTO licence(num_lic, id_march, id_cli, id_mod_lic,
																id_mod_trans, id_mon, destination, date_val,
																poids, fob, lot_pret, id_banq, id_util, fichier_lic)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?)');
			$requete-> execute(array($entree['num_lic'], $entree['id_march'], $entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_mon'], $entree['destination'], $entree['date_val'], $entree['poids'], $entree['fob'], $entree['lot_pret'], $entree['id_banq'], $entree['id_util'], $entree['fichier_lic']));
			if ($date_exp != null) {
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

			if ($tmp != null) {
				$dossier = '../dossiers/'.$num_lic;

				if(!is_dir($dossier)){
					mkdir("../dossiers/$num_lic", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
				// move_uploaded_file($tmp_fact, '../dossiers/'.$num_lic.'/' . basename($fichier_fact));
				}
				//move_uploaded_file($tmp, '../dossiers/');
		}

		public function modifierLicenceEB($num_lic, $id_march, $destination, $date_val,
								$date_exp, $poids, $fob, $lot_pret, $id_banq, $num_lic_old){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['id_march'] = $id_march;
			$entree['destination'] = $destination;
			$entree['date_val'] = $date_val;
			$entree['date_exp'] = $date_exp;
			$entree['poids'] = $poids;
			$entree['fob'] = $fob;
			$entree['lot_pret'] = $lot_pret;
			$entree['id_banq'] = $id_banq;
			$entree['num_lic_old'] = $num_lic_old;


			$requete = $connexion-> prepare('UPDATE licence SET num_lic = ?, id_march = ?, destination = ?, date_val = ?,
																poids = ?, fob = ?, lot_pret = ?, id_banq = ?
												WHERE num_lic = ?');
			$requete-> execute(array($entree['num_lic'], $entree['id_march'], $entree['destination'], $entree['date_val'], $entree['poids'], $entree['fob'], $entree['lot_pret'], $entree['id_banq'], $entree['num_lic_old']));
			if ($date_exp != null) {
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

		}

		public function creerEBTracking($num_lic, $date_val, $poids, $unit_mes, $id_cli,
										$id_march, $date_exp, $id_util, $destination,
										$acheteur, $id_mod_trans, $ref_fact=NULL, $fichier_lic=NULL, $tmp=NULL){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['date_val'] = $date_val;
			$entree['poids'] = $poids;
			$entree['unit_mes'] = $unit_mes;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_util'] = $id_util;
			$entree['destination'] = $destination;
			$entree['acheteur'] = $acheteur;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['ref_fact'] = $ref_fact;
			$entree['fichier_lic'] = $fichier_lic;

			/*echo "<br> num_lic = $num_lic";
			echo "<br> date_val = $date_val";
			echo "<br> poids = $poids";
			echo "<br> unit_mes = $unit_mes";
			echo "<br> id_cli = $id_cli";
			echo "<br> id_march = $id_march";
			echo "<br> id_util = $id_util";
			echo "<br> destination = $destination";
			echo "<br> acheteur = $acheteur";
			echo "<br> id_mod_trans = $id_mod_trans";*/

			$requete = $connexion-> prepare("INSERT INTO licence(num_lic, date_val, tonnage,
																poids, unit_mes, id_cli, id_march,
																id_mod_lic, id_util,
																id_type_lic, id_mon,
																destination, acheteur, id_mod_trans, ref_fact, fichier_lic)
													VALUES(?, ?, '1', ?, ?, ?, ?, '1', ?, '1', '1', ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['num_lic'], $entree['date_val'], $entree['poids'],
								$entree['unit_mes'], $entree['id_cli'], $entree['id_march'], $entree['id_util'],
								$entree['destination'], $entree['acheteur'], $entree['id_mod_trans'],
								$entree['ref_fact'], $entree['fichier_lic']));

			if ($date_exp != null) {
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

			if ($tmp != null) {
				$dossier = '../dossiers/'.$num_lic;

				if(!is_dir($dossier)){
					mkdir("../dossiers/$num_lic", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
				//cmove_uploaded_file($tmp_fact, '../dossiers/'.$num_lic.'/' . basename($fichier_fact));
			}
		}

		public function creerClient($nom_cli, $ville_cli, $account_manager, $influence_intern, $influence_extern, $info_cli, $etat_cli){

			include('connexion.php');
			$entree['nom_cli'] = $nom_cli;
			$entree['ville_cli'] = $ville_cli;
			$entree['account_manager'] = $account_manager;
			$entree['influence_intern'] = $influence_intern;
			$entree['influence_extern'] = $influence_extern;
			$entree['info_cli'] = $info_cli;
			$entree['etat_cli'] = $etat_cli;

			// echo '<br> nom_cli = '.$nom_cli;
			// echo '<br> ville_cli = '.$ville_cli;
			// echo '<br> account_manager = '.$account_manager;
			// echo '<br> contact_cli = '.$contact_cli;
			// echo '<br> tel_contact_cli = '.$tel_contact_cli;
			// echo '<br> mail_contact_cli = '.$mail_contact_cli;
			// echo '<br> influence_intern = '.$influence_intern;
			// echo '<br> influence_extern = '.$influence_extern;
			// echo '<br> domain_activ = '.$domain_activ;
			// echo '<br> date_appel_offre = '.$date_appel_offre;
			// echo '<br> info_cli = '.$info_cli;

			$requete = $connexion-> prepare("INSERT INTO client (nom_cli, ville_cli , account_manager, influence_intern, 
																influence_extern, 
																info_cli, etat_cli)
												VALUES(?, ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['nom_cli'], $entree['ville_cli'], $entree['account_manager'], $entree['influence_intern'], 
										$entree['influence_extern'],
										$entree['info_cli'], $entree['etat_cli']));

		}

		public function creerClient2($nom_cli, $code_cli, $rccm_cli, $id_nat, $num_imp_exp, $num_tva, $adr_cli, $photo, $tmp, $tel_cli, $mail_cli){

			include('connexion.php');
			$entree['nom_cli'] = $nom_cli;
			$entree['code_cli'] = $code_cli;
			$entree['rccm_cli'] = $rccm_cli;
			$entree['id_nat'] = $id_nat;
			$entree['num_imp_exp'] = $num_imp_exp;
			$entree['num_tva'] = $num_tva;
			$entree['adr_cli'] = $adr_cli;
			$entree['photo'] = $photo;
			$entree['tel_cli'] = $tel_cli;
			$entree['mail_cli'] = $mail_cli;

			// echo '<br> nom_cli = '.$nom_cli;
			// echo '<br> code_cli = '.$code_cli;
			// echo '<br> rccm_cli = '.$rccm_cli;
			// echo '<br> contact_cli = '.$contact_cli;
			// echo '<br> tel_contact_cli = '.$tel_contact_cli;
			// echo '<br> mail_contact_cli = '.$mail_contact_cli;
			// echo '<br> id_nat = '.$id_nat;
			// echo '<br> num_imp_exp = '.$num_imp_exp;
			// echo '<br> domain_activ = '.$domain_activ;
			// echo '<br> date_appel_offre = '.$date_appel_offre;
			// echo '<br> num_tva = '.$num_tva;

			$requete = $connexion-> prepare("INSERT INTO client (nom_cli, code_cli , rccm_cli, id_nat, 
																num_imp_exp, 
																num_tva, adr_cli, photo, tel_cli, mail_cli)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['nom_cli'], $entree['code_cli'], $entree['rccm_cli'], 
										$entree['id_nat'], $entree['num_imp_exp'],
										$entree['num_tva'], $entree['adr_cli'], $entree['photo'], 
										$entree['tel_cli'], $entree['mail_cli']));


			if (isset($tmp) && ($tmp!='')) {

				// if(!is_dir($dossier)){
				// 	mkdir("../dossiers/$num_lic", 0777);
				// }

				//move_uploaded_file($tmp, '../images/clients/' . basename($photo));

				try {
					move_uploaded_file($tmp, '../images/clients/'. basename($photo));
				} catch (Exception $e) {
				    echo 'Exception reçue : ',  $e->getMessage(), "\n";
				}

			}

		}

		public function creerLicenceIBUpload($client, $fournisseur, $commodity, $po, $facture,
										$num_licence, $monnaie, $fob, $fret,
										$assurance, $autre_frais, $fsi, $aur,
										$validation, $id_util, $id_mod_lic, $extreme){
			include('connexion.php');
			$entree['client'] = $client;$entree['fournisseur'] = $fournisseur;
			$entree['po'] = $po;$entree['facture'] = $facture;
			$entree['num_licence'] = $num_licence;$entree['monnaie'] = $monnaie;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['aur'] = $aur;
			$entree['validation'] = $validation;$entree['id_util'] = $id_util;$entree['id_mod_lic'] = $id_mod_lic;
			$entree['extreme'] = $extreme;$entree['commodity'] = $commodity;$entree['fsi'] = $fsi;

			$requete = $connexion-> prepare('INSERT INTO licence_upload(client, fournisseur, po,
																facture, num_licence, monnaie,
																fob, fret, assurance,
																autre_frais, fsi, aur,
																validation, id_util, id_mod_lic,
																extreme, commodity)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['fournisseur'], $entree['po'],
									$entree['facture'], $entree['num_licence'], $entree['monnaie'],
									$entree['fob'], $entree['fret'], $entree['assurance'],
									$entree['autre_frais'], $entree['fsi'], $entree['aur'],
									$entree['validation'], $entree['id_util'], $entree['id_mod_lic'],
									$entree['extreme'], $entree['commodity']));

			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		/*public function creerDossierIBUpload($client, $ref_dos, $num_lic, $cod, $fxi, $montant_av,
										$date_fact, $ref_fact, $fob, $fret,
										$assurance, $autre_frais, $ref_decl, $montant_decl,
										$ref_liq, $id_util, $ref_quit, $date_quit, $id_mod_lic){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['fxi'] = $fxi;$entree['montant_av'] = $montant_av;
			$entree['date_fact'] = $date_fact;$entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['montant_decl'] = $montant_decl;
			$entree['ref_liq'] = $ref_liq;$entree['id_util'] = $id_util;$entree['ref_quit'] = $ref_quit;
			$entree['date_quit'] = $date_quit;$entree['cod'] = $cod;$entree['ref_decl'] = $ref_decl;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('INSERT INTO dossier_upload(client, ref_dos, num_lic, fxi,
																montant_av, date_fact, ref_fact,
																fob, fret, assurance,
																autre_frais, ref_decl, montant_decl,
																ref_liq, id_util, ref_quit,
																date_quit, cod, id_mod_lic)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['num_lic'], $entree['fxi'],
									$entree['montant_av'], $entree['date_fact'], $entree['ref_fact'],
									$entree['fob'], $entree['fret'], $entree['assurance'],
									$entree['autre_frais'], $entree['ref_decl'], $entree['montant_decl'],
									$entree['ref_liq'], $entree['id_util'], $entree['ref_quit'],
									$entree['date_quit'], $entree['cod'], $entree['id_mod_lic']));

			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}*/

		public function creerDossierIBUpload($client, $ref_dos, $num_lic, $cod, $fxi, $montant_av,
										$date_fact, $ref_fact, $fob, $fret,
										$assurance, $autre_frais, $ref_decl, $montant_decl,
										$ref_liq, $id_util, $ref_quit, $date_quit, $id_mod_lic){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['fxi'] = $fxi;$entree['montant_av'] = $montant_av;
			$entree['date_fact'] = $date_fact;$entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['montant_decl'] = $montant_decl;
			$entree['ref_liq'] = $ref_liq;$entree['id_util'] = $id_util;$entree['ref_quit'] = $ref_quit;
			$entree['date_quit'] = $date_quit;$entree['cod'] = $cod;$entree['ref_decl'] = $ref_decl;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('INSERT INTO dossier_upload(client, ref_dos, num_lic, fxi,
																montant_av, date_fact, ref_fact,
																fob, fret, assurance,
																autre_frais, ref_decl, montant_decl,
																ref_liq, id_util, ref_quit,
																date_quit, cod, id_mod_lic)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['num_lic'], $entree['fxi'],
									$entree['montant_av'], $entree['date_fact'], $entree['ref_fact'],
									$entree['fob'], $entree['fret'], $entree['assurance'],
									$entree['autre_frais'], $entree['ref_decl'], $entree['montant_decl'],
									$entree['ref_liq'], $entree['id_util'], $entree['ref_quit'],
									$entree['date_quit'], $entree['cod'], $entree['id_mod_lic']));

			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierIBUploadTrackingKlsa($client, $ref_dos, $num_lic, $t1, $poids, $ref_fact,
										$horse, $trailer_1, $trailer_2, $transporteur,
										$destination, $arrival_date, $crossing_date, $wiski_arriv,
										$wiski_dep, $remarque, $id_util, $id_mod_lic, $id_mod_trans){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['poids'] = $poids;$entree['ref_fact'] = $ref_fact;
			$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['transporteur'] = $transporteur;$entree['destination'] = $destination;
			$entree['arrival_date'] = $arrival_date;$entree['wiski_arriv'] = $wiski_arriv;
			$entree['wiski_dep'] = $wiski_dep;$entree['remarque'] = $remarque;
			$entree['id_util'] = $id_util;$entree['t1'] = $t1;$entree['crossing_date'] = $crossing_date;
			$entree['id_mod_lic'] = $id_mod_lic;$entree['id_mod_trans'] = $id_mod_trans;
			/*echo $client.' = client<br>';echo $ref_dos.' = ref_dos<br>';echo $num_lic.' = num_lic<br>';
			echo $poids.' = poids<br>';echo $ref_fact.' = ref_fact<br>';echo $horse.' = horse<br>';
			echo $trailer_1.' = trailer_1<br>';echo $trailer_2.' = trailer_2<br>';echo $transporteur.' = transporteur<br>';
			echo $destination.' = destination<br>';echo $arrival_date.' = arrival_date<br>';echo $crossing_date.' = crossing_date<br>';
			echo $wiski_arriv.' = wiski_arriv<br>';echo $wiski_dep.' = wiski_dep<br>';echo $remarque.' = remarque<br>';
			echo $id_util.' = id_util<br>';echo $t1.' = t1<br>';echo $id_mod_lic.' = id_mod_lic<br>';
			echo $id_mod_trans.' = id_mod_trans<br><br>------------';*/
			$requete = $connexion-> prepare('INSERT INTO dossier_upload_tracking(client, ref_dos, num_lic, poids,
																ref_fact, horse, trailer_1,
																trailer_2, transporteur, destination,
																arrival_date, crossing_date, wiski_arriv,
																wiski_dep, remarque,
																id_util, t1, id_mod_lic, id_mod_trans)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['num_lic'], $entree['poids'],
									$entree['ref_fact'], $entree['horse'], $entree['trailer_1'],
									$entree['trailer_2'], $entree['transporteur'], $entree['destination'],
									$entree['arrival_date'], $entree['crossing_date'], $entree['wiski_arriv'],
									$entree['wiski_dep'], $entree['remarque'],
									$entree['id_util'], $entree['t1'], $entree['id_mod_lic'], $entree['id_mod_trans']));

			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierIBUploadExport($ref_dos, $num_lic, $date_exp, $tonnage, $ship_num, $barge, $horse, $trailer_1, $trailer_2, $num_lot, $nbr_bags, $poids, $kapulo_load, $dispatch_pweto, $arrival_pweto, $barge_load, $barge_dispatch_date, $doc_receiv, $nbre_seal, $dgda_seal, $remarque, $transporter, $load_date, $pv_mine, $demande_attestation, $assay_date, $ceec_in, $ceec_out, $min_div_in, $min_div_out, $date_decl, $dgda_in, $date_liq, $date_quit, $dgda_out, $gov_in, $gov_out, $dispatch_date, $klsa_arriv, $end_form, $exit_drc, $cleared, $statut, $site_load, $destination, $ref_decl, $ref_liq, $ref_quit, $impala_sncc, $docs_sncc, $sncc_sakania, $sakania_date, $id_cli, $id_util, $id_mod_trans){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['date_exp'] = $date_exp;$entree['tonnage'] = $tonnage;
			$entree['ship_num'] = $ship_num;$entree['barge'] = $barge;
			$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['num_lot'] = $num_lot;
			$entree['nbr_bags'] = $nbr_bags;$entree['poids'] = $poids;
			$entree['kapulo_load'] = $kapulo_load;$entree['dispatch_pweto'] = $dispatch_pweto;
			$entree['arrival_pweto'] = $arrival_pweto;$entree['barge_load'] = $barge_load;
			$entree['barge_dispatch_date'] = $barge_dispatch_date;$entree['doc_receiv'] = $doc_receiv;
			$entree['nbre_seal'] = $nbre_seal;$entree['dgda_seal'] = $dgda_seal;
			$entree['remarque'] = $remarque;$entree['transporter'] = $transporter;
			$entree['load_date'] = $load_date;$entree['pv_mine'] = $pv_mine;
			$entree['demande_attestation'] = $demande_attestation;$entree['assay_date'] = $assay_date;
			$entree['ceec_in'] = $ceec_in;$entree['ceec_out'] = $ceec_out;
			$entree['min_div_in'] = $min_div_in;$entree['min_div_out'] = $min_div_out;
			$entree['date_decl'] = $date_decl;$entree['dgda_in'] = $dgda_in;
			$entree['date_liq'] = $date_liq;$entree['date_quit'] = $date_quit;
			$entree['dgda_out'] = $dgda_out;$entree['gov_in'] = $gov_in;
			$entree['gov_out'] = $gov_out;$entree['dispatch_date'] = $dispatch_date;
			$entree['klsa_arriv'] = $klsa_arriv;$entree['end_form'] = $end_form;
			$entree['exit_drc'] = $exit_drc;$entree['cleared'] = $cleared;
			$entree['statut'] = $statut;$entree['site_load'] = $site_load;
			$entree['destination'] = $destination;$entree['ref_decl'] = $ref_decl;
			$entree['ref_liq'] = $ref_liq;$entree['impala_sncc'] = $impala_sncc;
			$entree['ref_quit'] = $ref_quit;$entree['docs_sncc'] = $docs_sncc;
			$entree['sncc_sakania'] = $sncc_sakania;$entree['sakania_date'] = $sakania_date;
			$entree['id_cli'] = $id_cli; $entree['id_util'] = $id_util; $entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare('INSERT INTO dossier_upload_export(ref_dos, num_lic, date_exp, tonnage, ship_num, barge, horse, trailer_1, trailer_2, num_lot, nbr_bags, poids, kapulo_load, dispatch_pweto, arrival_pweto, barge_load, barge_dispatch_date, doc_receiv, nbre_seal, dgda_seal, remarque, transporter, load_date, pv_mine, demande_attestation, assay_date, ceec_in, ceec_out, min_div_in, min_div_out, date_decl, dgda_in, date_liq, date_quit, dgda_out, gov_in, gov_out, dispatch_date, klsa_arriv, end_form, exit_drc, cleared, statut, site_load, destination, ref_decl, ref_liq, ref_quit, impala_sncc, docs_sncc, sncc_sakania, sakania_date, id_cli, id_util, id_mod_trans)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['num_lic'], $entree['date_exp'], $entree['tonnage'], $entree['ship_num'], $entree['barge'], $entree['horse'], $entree['trailer_1'], $entree['trailer_2'], $entree['num_lot'], $entree['nbr_bags'], $entree['poids'], $entree['kapulo_load'], $entree['dispatch_pweto'], $entree['arrival_pweto'], $entree['barge_load'], $entree['barge_dispatch_date'], $entree['doc_receiv'], $entree['nbre_seal'], $entree['dgda_seal'], $entree['remarque'], $entree['transporter'], $entree['load_date'], $entree['pv_mine'], $entree['demande_attestation'], $entree['assay_date'], $entree['ceec_in'], $entree['ceec_out'], $entree['min_div_in'], $entree['min_div_out'], $entree['date_decl'], $entree['dgda_in'], $entree['date_liq'], $entree['date_quit'], $entree['dgda_out'], $entree['gov_in'], $entree['gov_out'], $entree['dispatch_date'], $entree['klsa_arriv'], $entree['end_form'], $entree['exit_drc'], $entree['cleared'], $entree['statut'], $entree['site_load'], $entree['destination'], $entree['ref_decl'], $entree['ref_liq'], $entree['ref_quit'], $entree['impala_sncc'], $entree['docs_sncc'], $entree['sncc_sakania'], $entree['sakania_date'], $entree['id_cli'], $entree['id_util'], $entree['id_mod_trans']));

			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierIBUpload2($client, $ref_dos, $mca_b_ref, $road_manif, $date_preal, $t1,
										$poids, $ref_fact, $fob, $fret,
										$assurance, $autre_frais, $fournisseur, $po,
										$commodity, $horse, $trailer_1, $trailer_2, $num_lic, $num_exo,
										$arrival_date, $crossing_date, $wiski_arriv, $wiski_dep, $amicongo_arriv,
										$insp_report, $ir, $ref_crf, $date_crf, $ref_decl, $dgda_in, $ref_liq,
										$date_liq, $ref_quit, $date_quit, $dgda_out, $custom_deliv, $dispatch_deliv,
										$remarque, $statut, $id_mod_trac, $id_util, $bl, $supplier, $credit_enlev_by, $bond_warehouse){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['mca_b_ref'] = $mca_b_ref;
			$entree['date_preal'] = $date_preal;$entree['t1'] = $t1;
			$entree['poids'] = $poids;$entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['po'] = $po;
			$entree['commodity'] = $commodity;$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['road_manif'] = $road_manif;$entree['fournisseur'] = $fournisseur;
			$entree['num_lic'] = $num_lic;$entree['num_exo'] = $num_exo;$entree['arrival_date'] = $arrival_date;
			$entree['crossing_date'] = $crossing_date;$entree['wiski_arriv'] = $wiski_arriv;$entree['wiski_dep'] = $wiski_dep;
			$entree['amicongo_arriv'] = $amicongo_arriv;$entree['insp_report'] = $insp_report;$entree['ir'] = $ir;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;$entree['ref_decl'] = $ref_decl;
			$entree['dgda_in'] = $dgda_in;$entree['ref_liq'] = $ref_liq;$entree['date_liq'] = $date_liq;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;$entree['dgda_out'] = $dgda_out;
			$entree['custom_deliv'] = $custom_deliv;$entree['dispatch_deliv'] = $dispatch_deliv;$entree['remarque'] = $remarque;
			$entree['statut'] = $statut;$entree['id_mod_trac'] = $id_mod_trac;$entree['id_util'] = $id_util;
			$entree['bl'] = $bl; $entree['supplier'] = $supplier; $entree['credit_enlev_by'] = $credit_enlev_by;
			$entree['bond_warehouse'] = $bond_warehouse;
			/*echo $client.' - '.$ref_dos.' - '.$mca_b_ref.' - '.$road_manif.' - '.$date_preal.' - '.$t1.' - '.$poids.' - '.$fob.' - '.$fret.' - '.$assurance.' - '.$autre_frais.' - '.$ref_fact.' - '.$fournisseur.' - '.$po.' - '.$commodity.' - '.$horse.' - '.$trailer_1.' - '.$trailer_2.' - '.$num_lic.' - '.$num_exo.' - '.$crossing_date.' - '.$arrival_date.' - '.$wiski_arriv.' - '.$wiski_dep.' - '.$amicongo_arriv.' - '.$insp_report.' - '.$ir.' - '.$ref_crf.' - '.$date_crf.' - '.$ref_decl.' - '.$dgda_in.' - '.$ref_liq.' - '.$date_liq.' - '.$ref_quit.' - '.$date_quit.' - '.$dgda_out.' - '.$custom_deliv.' - '.$dispatch_deliv.' - '.$statut.' - '.$remarque.'<br><br><br>';*/
			$requete = $connexion-> prepare('INSERT INTO dossier_upload_tracking(client, ref_dos, mca_b_ref, date_preal,
																t1, poids, ref_fact,
																fob, fret, assurance,
																autre_frais, fournisseur, po,
																commodity, horse, trailer_1,
																trailer_2, road_manif, num_lic,
																num_exo, arrival_date, crossing_date, wiski_arriv, wiski_dep, amicongo_arriv, insp_report, ir, ref_crf, date_crf, ref_decl, dgda_in, ref_liq, date_liq, ref_quit, date_quit, dgda_out, custom_deliv, dispatch_deliv, remarque, statut,
																id_mod_lic, id_util, bl, supplier, credit_enlev_by, bond_warehouse)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['mca_b_ref'], $entree['date_preal'],
									$entree['t1'], $entree['poids'], $entree['ref_fact'],
									$entree['fob'], $entree['fret'], $entree['assurance'],
									$entree['autre_frais'], $entree['fournisseur'], $entree['po'],
									$entree['commodity'], $entree['horse'], $entree['trailer_1'],
									$entree['trailer_2'], $entree['road_manif'], $entree['num_lic'],
									$entree['num_exo'], $entree['arrival_date'], $entree['crossing_date'],
									$entree['wiski_arriv'], $entree['wiski_dep'], $entree['amicongo_arriv'],
									$entree['insp_report'], $entree['ir'], $entree['ref_crf'],
									$entree['date_crf'], $entree['ref_decl'], $entree['dgda_in'],
									$entree['ref_liq'], $entree['date_liq'], $entree['dgda_out'],
									$entree['ref_quit'], $entree['date_quit'], $entree['custom_deliv'],
									$entree['dispatch_deliv'], $entree['remarque'], $entree['statut'],
									$entree['id_mod_trac'], $entree['id_util'], $entree['bl'],
									$entree['supplier'], $entree['credit_enlev_by'], $entree['bond_warehouse']));

			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierMMG($client, $ref_dos, $t1, $poids,
										$ref_fact, $horse, $trailer_1, $trailer_2,
										$num_lic, $num_exo, $klsa_arriv, $crossing_date,
										$wiski_arriv, $wiski_dep, $insp_report, $ir,
										$ref_crf, $date_crf, $ref_decl, $dgda_in,
										$ref_liq, $date_liq, $ref_quit, $date_quit,
										$dgda_out, $regul_ir, $cleared, $statut, $remarque,
										$id_mod_lic, $id_util){
			include('connexion.php');

			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;
			$entree['t1'] = $t1;$entree['poids'] = $poids;
			$entree['ref_fact'] = $ref_fact;$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;$entree['trailer_2'] = $trailer_2;
			$entree['num_lic'] = $num_lic;$entree['num_exo'] = $num_exo;
			$entree['klsa_arriv'] = $klsa_arriv;$entree['crossing_date'] = $crossing_date;
			$entree['wiski_arriv'] = $wiski_arriv;$entree['wiski_dep'] = $wiski_dep;
			$entree['insp_report'] = $insp_report;$entree['ir'] = $ir;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;
			$entree['ref_decl'] = $ref_decl;$entree['dgda_in'] = $dgda_in;
			$entree['ref_liq'] = $ref_liq;$entree['date_liq'] = $date_liq;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;
			$entree['dgda_out'] = $dgda_out;$entree['regul_ir'] = $regul_ir;
			$entree['cleared'] = $cleared;$entree['statut'] = $statut;$entree['remarque'] = $remarque;
			$entree['id_mod_lic'] = $id_mod_lic;$entree['id_util'] = $id_util;

			/*echo '<br>----<br>client = '.$client;
			echo '<br>ref_dos = '.$ref_dos;
			echo '<br>t1 = '.$t1;
			echo '<br>poids = '.$poids;
			echo '<br>ref_fact = '.$ref_fact;
			echo '<br>horse = '.$horse;
			echo '<br>trailer_1 = '.$trailer_1;
			echo '<br>trailer_2 = '.$trailer_2;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>num_exo = '.$num_exo;
			echo '<br>klsa_arriv = '.$klsa_arriv;
			echo '<br>crossing_date = '.$crossing_date;
			echo '<br>wiski_arriv = '.$wiski_arriv;
			echo '<br>wiski_dep = '.$wiski_dep;
			echo '<br>insp_report = '.$insp_report;
			echo '<br>ir = '.$ir;
			echo '<br>ref_crf = '.$ref_crf;
			echo '<br>date_crf = '.$date_crf;
			echo '<br>ref_decl = '.$ref_decl;
			echo '<br>dgda_in = '.$dgda_in;
			echo '<br>ref_liq = '.$ref_liq;
			echo '<br>date_liq = '.$date_liq;
			echo '<br>ref_quit = '.$ref_quit;
			echo '<br>date_quit = '.$date_quit;
			echo '<br>dgda_out = '.$dgda_out;
			echo '<br>regul_ir = '.$regul_ir;
			echo '<br>cleared = '.$cleared;
			echo '<br>statut = '.$statut;
			echo '<br>remarque = '.$remarque;*/

			$requete = $connexion-> prepare('INSERT INTO dossier_upload_tracking(client, ref_dos, t1, poids, ref_fact, horse, trailer_1, trailer_2, num_lic, num_exo, klsa_arriv, crossing_date, wiski_arriv, wiski_dep, insp_report, ir, ref_crf, date_crf, ref_decl, dgda_in, ref_liq, date_liq, ref_quit, date_quit, dgda_out, regul_ir, cleared, statut, remarque, id_mod_lic, id_util)
												VALUES(?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['t1'], $entree['poids'], $entree['ref_fact'], $entree['horse'], $entree['trailer_1'], $entree['trailer_2'], $entree['num_lic'], $entree['num_exo'], $entree['klsa_arriv'], $entree['crossing_date'], $entree['wiski_arriv'], $entree['wiski_dep'], $entree['insp_report'], $entree['ir'], $entree['ref_crf'], $entree['date_crf'], $entree['ref_decl'], $entree['dgda_in'], $entree['ref_liq'], $entree['date_liq'], $entree['ref_quit'], $entree['date_quit'], $entree['dgda_out'], $entree['regul_ir'], $entree['cleared'], $entree['statut'], $entree['remarque'], $entree['id_mod_lic'], $entree['id_util']));

			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierTrackingMMG($client, $ref_dos, $t1, $poids,
										$ref_fact, $horse, $trailer_1, $trailer_2,
										$num_lic, $num_exo, $klsa_arriv, $crossing_date,
										$wiski_arriv, $wiski_dep, $insp_receiv, $ir,
										$ref_crf, $date_crf, $ref_decl, $dgda_in,
										$ref_liq, $date_liq, $ref_quit, $date_quit,
										$dgda_out, $regul_ir, $cleared, $statut, $remarque,
										$id_mod_lic, $id_util){
			include('connexion.php');

			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;
			$entree['t1'] = $t1;$entree['poids'] = $poids;
			$entree['ref_fact'] = $ref_fact;$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;$entree['trailer_2'] = $trailer_2;
			$entree['num_lic'] = $num_lic;$entree['num_exo'] = $num_exo;
			$entree['klsa_arriv'] = $klsa_arriv;$entree['crossing_date'] = $crossing_date;
			$entree['wiski_arriv'] = $wiski_arriv;$entree['wiski_dep'] = $wiski_dep;
			$entree['insp_receiv'] = $insp_receiv;$entree['ir'] = $ir;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;
			$entree['ref_decl'] = $ref_decl;$entree['dgda_in'] = $dgda_in;
			$entree['ref_liq'] = $ref_liq;$entree['date_liq'] = $date_liq;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;
			$entree['dgda_out'] = $dgda_out;$entree['regul_ir'] = $regul_ir;
			$entree['cleared'] = $cleared;$entree['statut'] = $statut;$entree['remarque'] = $remarque;
			$entree['id_mod_lic'] = $id_mod_lic;$entree['id_util'] = $id_util;

			if($entree['klsa_arriv'] == '' || (!isset($entree['klsa_arriv'])) || (strlen($entree['klsa_arriv']) != 10)){
				$entree['klsa_arriv'] = NULL;
			}
			if($entree['crossing_date'] == '' || (!isset($entree['crossing_date'])) || (strlen($entree['crossing_date']) != 10) ){
				$entree['crossing_date'] = NULL;
			}
			if($entree['wiski_arriv'] == '' || (!isset($entree['wiski_arriv'])) || (strlen($entree['wiski_arriv']) != 10) ){
				$entree['wiski_arriv'] = NULL;
			}
			if($entree['wiski_dep'] == '' || (!isset($entree['wiski_dep'])) || (strlen($entree['wiski_dep']) != 10) ){
				$entree['wiski_dep'] = NULL;
			}
			if($entree['insp_receiv'] == '' || (!isset($entree['insp_receiv'])) || (strlen($entree['insp_receiv']) != 10) ){
				$entree['insp_receiv'] = NULL;
			}
			if($entree['date_crf'] == '' || (!isset($entree['date_crf'])) || (strlen($entree['date_crf']) != 10) ){
				$entree['date_crf'] = NULL;
			}
			if($entree['dgda_in'] == '' || (!isset($entree['dgda_in'])) || (strlen($entree['dgda_in']) != 10) ){
				$entree['dgda_in'] = NULL;
			}
			if($entree['date_liq'] == '' || (!isset($entree['date_liq'])) || (strlen($entree['date_liq']) != 10) ){
				$entree['date_liq'] = NULL;
			}
			if($entree['date_quit'] == '' || (!isset($entree['date_quit'])) || (strlen($entree['date_quit']) != 10) ){
				$entree['date_quit'] = NULL;
			}
			if($entree['dgda_out'] == '' || (!isset($entree['dgda_out'])) || (strlen($entree['dgda_out']) != 10) ){
				$entree['dgda_out'] = NULL;
			}
			if($entree['regul_ir'] == '' || (!isset($entree['regul_ir'])) || (strlen($entree['regul_ir']) != 10) ){
				$entree['regul_ir'] = NULL;
			}

			/*echo '<br>----<br>client = '.$client;
			echo '<br>ref_dos = '.$ref_dos;
			echo '<br>t1 = '.$t1;
			echo '<br>poids = '.$poids;
			echo '<br>ref_fact = '.$ref_fact;
			echo '<br>horse = '.$horse;
			echo '<br>trailer_1 = '.$trailer_1;
			echo '<br>trailer_2 = '.$trailer_2;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>num_exo = '.$num_exo;
			echo '<br>klsa_arriv = '.$klsa_arriv;
			echo '<br>crossing_date = '.$crossing_date;
			echo '<br>wiski_arriv = '.$wiski_arriv;
			echo '<br>wiski_dep = '.$wiski_dep;
			echo '<br>insp_receiv = '.$insp_receiv;
			echo '<br>ir = '.$ir;
			echo '<br>ref_crf = '.$ref_crf;
			echo '<br>date_crf = '.$date_crf;
			echo '<br>ref_decl = '.$ref_decl;
			echo '<br>dgda_in = '.$dgda_in;
			echo '<br>ref_liq = '.$ref_liq;
			echo '<br>date_liq = '.$date_liq;
			echo '<br>ref_quit = '.$ref_quit;
			echo '<br>date_quit = '.$date_quit;
			echo '<br>dgda_out = '.$dgda_out;
			echo '<br>regul_ir = '.$regul_ir;
			echo '<br>cleared = '.$cleared;
			echo '<br>statut = '.$statut;
			echo '<br>remarque = '.$remarque;*/

			$requete = $connexion-> prepare('INSERT INTO dossier(id_cli, ref_dos, t1, poids, ref_fact, horse, trailer_1, trailer_2, num_lic, num_exo, klsa_arriv, crossing_date, wiski_arriv, wiski_dep, insp_receiv, ir, ref_crf, date_crf, ref_decl, dgda_in, ref_liq, date_liq, ref_quit, date_quit, dgda_out, regul_ir, cleared, statut, remarque, id_mod_lic, id_util)
												VALUES(?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['t1'], $entree['poids'], $entree['ref_fact'], $entree['horse'], $entree['trailer_1'], $entree['trailer_2'], $entree['num_lic'], $entree['num_exo'], $entree['klsa_arriv'], $entree['crossing_date'], $entree['wiski_arriv'], $entree['wiski_dep'], $entree['insp_receiv'], $entree['ir'], $entree['ref_crf'], $entree['date_crf'], $entree['ref_decl'], $entree['dgda_in'], $entree['ref_liq'], $entree['date_liq'], $entree['ref_quit'], $entree['date_quit'], $entree['dgda_out'], $entree['regul_ir'], $entree['cleared'], $entree['statut'], $entree['remarque'], $entree['id_mod_lic'], $entree['id_util']));

			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierTrackingIBUpload($client, $ref_dos, $mca_b_ref, $road_manif, $date_preal, $t1,
										$poids, $fob, $fret, $assurance,
										$autre_frais, $ref_fact, $fournisseur, $po,
										$commodity, $horse, $trailer_1, $trailer_2, $id_mod_lic){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['mca_b_ref'] = $mca_b_ref;
			$entree['date_preal'] = $date_preal;$entree['t1'] = $t1;
			$entree['poids'] = $poids;$entree['fob'] = $fob;
			$entree['fret'] = $fret;$entree['assurance'] = $assurance;$entree['autre_frais'] = $autre_frais;
			$entree['ref_fact'] = $ref_fact;$entree['po'] = $po;
			$entree['commodity'] = $commodity;$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['road_manif'] = $road_manif;$entree['fournisseur'] = $fournisseur;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('INSERT INTO dossier_upload(client, ref_dos, mca_b_ref, date_preal,
																t1, poids, fob,
																fret, assurance, autre_frais,
																ref_fact, fournisseur, po,
																commodity, horse, trailer_1,
																trailer_2, road_manif, id_mod_lic)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['mca_b_ref'], $entree['date_preal'],
									$entree['t1'], $entree['poids'], $entree['fob'],
									$entree['fret'], $entree['assurance'], $entree['autre_frais'],
									$entree['ref_fact'], $entree['fournisseur'], $entree['po'],
									$entree['commodity'], $entree['horse'], $entree['trailer_1'],
									$entree['trailer_2'], $entree['road_manif'], $entree['id_mod_lic']));

			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerLicenceIBFromUploade($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM licence_upload
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if ( $this-> getLicence($reponse['num_licence']) == null ){

                	$this-> creerLicenceIB(7, $reponse['num_licence'], $reponse['client'],
                                          25, $reponse['monnaie'], $reponse['fob'],
                                          $reponse['assurance'], $reponse['fret'], $reponse['autre_frais'],
                                          $reponse['fsi'], $reponse['aur'],
                                          25, $reponse['facture'], NULL,
                                          $reponse['fournisseur'], $reponse['validation'], $reponse['extreme'],
                                          NULL, $id_mod_lic, $id_util,
                                          NULL, NULL, NULL, NULL,
                                          1, NULL, NULL,
                                          NULL, $reponse['commodity']);

                }
			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE licence_upload
												SET etat = 1
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}

		public function creerRubriqueDossier($id_dep, $id_rub, $id_dos, $montant){
			include('connexion.php');

			$entree['id_dep'] = $id_dep;
			$entree['id_rub'] = $id_rub;
			$entree['id_dos'] = $id_dos;
			$entree['montant'] = $montant;

			$requete = $connexion-> prepare("INSERT INTO rubrique_dossier(id_dep, id_rub, id_dos, montant) VALUES(?, ?, ?, ?)");
			$requete-> execute(array($entree['id_dep'], $entree['id_rub'], $entree['id_dos'], $entree['montant']));
		}

		public function creerFactureDossierBackUp($ref_fact, $id_cli, $id_march,
											$id_four, $information, $id_util){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_cli'] = $id_cli;

			$entree['id_four'] = $id_four;
			$entree['information'] = $information;
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("INSERT INTO facture_dossier(ref_fact, id_cli, id_util,
																	id_march, id_four, information)
												VALUES(?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['ref_fact'], $entree['id_cli'], $entree['id_util'],
									$entree['id_march'], $entree['id_four'], $entree['information']));
		}

		public function ajoutContactClient($nom_cont, $tel_cont, $mail_cont, $id_cli, $id_util){
			include('connexion.php');

			$entree['nom_cont'] = $nom_cont;
			$entree['tel_cont'] = $tel_cont;
			$entree['mail_cont'] = $mail_cont;
			$entree['id_cli'] = $id_cli;
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("INSERT INTO contact_client(nom_cont, tel_cont, mail_cont, id_util, id_cli)
												VALUES(?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['nom_cont'], $entree['tel_cont'], $entree['mail_cont'], 
									$entree['id_util'], $entree['id_cli']));
		}

		public function ajoutDomaineClient($id_cli, $id_dom, $id_cat_cli, $honnoraire, $volume, $target_init, 
											$sales_stage, $forecast, $competiteur, $observation, $id_util, $date_appel_offre){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_dom'] = $id_dom;
			$entree['id_cat_cli'] = $id_cat_cli;
			$entree['honnoraire'] = $honnoraire;
			$entree['volume'] = $volume;
			$entree['target_init'] = $target_init;
			$entree['sales_stage'] = $sales_stage;
			$entree['forecast'] = $forecast;
			$entree['competiteur'] = $competiteur;
			$entree['observation'] = $observation;
			$entree['id_util'] = $id_util;
			$entree['date_appel_offre'] = $date_appel_offre;

			// echo '<br>-------------------------------------------------id_cli = '.$id_cli;
			// echo '<br>-------------------------------------------------id_dom = '.$id_dom;
			// echo '<br>-------------------------------------------------id_cat_cli = '.$id_cat_cli;
			// echo '<br>-------------------------------------------------honnoraire = '.$honnoraire;
			// echo '<br>-------------------------------------------------volume = '.$volume;
			// echo '<br>-------------------------------------------------target_init = '.$target_init;
			// echo '<br>-------------------------------------------------sales_stage = '.$sales_stage;
			// echo '<br>-------------------------------------------------forecast = '.$forecast;
			// echo '<br>-------------------------------------------------competiteur = '.$competiteur;
			// echo '<br>-------------------------------------------------observation = '.$observation;
			// echo '<br>-------------------------------------------------id_util = '.$id_util;
			// echo '<br>-------------------------------------------------date_appel_offre = '.$date_appel_offre;

			$requete = $connexion-> prepare("INSERT INTO affectation_client_domaine(id_cli, id_dom, id_cat_cli, 
																					honnoraire, volume, target_init, 
																					sales_stage, forecast, competiteur, 
																					observation, id_util, date_appel_offre)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['id_cli'], $entree['id_dom'], $entree['id_cat_cli'], 
									$entree['honnoraire'], $entree['volume'], $entree['target_init'], $entree['sales_stage'], 
									$entree['forecast'], $entree['competiteur'], $entree['observation'], $entree['id_util'], 
									$entree['date_appel_offre']));
		}

		public function ajoutActionClient($id_cli, $id_dom, $date_act_cli, $desi_act_cli, $id_util){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_dom'] = $id_dom;
			$entree['date_act_cli'] = $date_act_cli;
			$entree['desi_act_cli'] = $desi_act_cli;
			$entree['id_util'] = $id_util;

			// echo '<br>-------------------------------------------------id_cli = '.$id_cli;
			// echo '<br>-------------------------------------------------id_dom = '.$id_dom;
			// echo '<br>-------------------------------------------------date_act_cli = '.$date_act_cli;
			// echo '<br>-------------------------------------------------desi_act_cli = '.$desi_act_cli;
			// echo '<br>-------------------------------------------------id_util = '.$id_util;

			$requete = $connexion-> prepare("INSERT INTO action_client(id_cli, id_dom, date_act_cli, 
																					desi_act_cli, id_util)
												VALUES(?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['id_cli'], $entree['id_dom'], $entree['date_act_cli'], 
									$entree['desi_act_cli'], $entree['id_util']));
		}

		public function creerFactureDossier($ref_fact, $id_cli, $id_util, $id_mod_lic, $type_fact, $information, $note_debit='0', $id_t_trans=NULL, $affichage_bloc='1'){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['id_cli'] = $id_cli;
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$entree['information'] = $information;
			$entree['note_debit'] = $note_debit;
			$entree['affichage_bloc'] = $affichage_bloc;

			if ( isset($id_t_trans) && ($id_t_trans!='') && ($id_t_trans=='1') && ($id_mod_lic=='2') ) {

				$entree['id_t_trans'] = '2';

			}else if ((isset($id_t_trans) && ($id_t_trans!=''))) {

				$entree['id_t_trans'] = $id_t_trans;

			}else if((isset($_GET['id_t_trans']) && ($_GET['id_t_trans']!=''))){

				$entree['id_t_trans'] = $_GET['id_t_trans'];

			}
			else{

				$entree['id_t_trans'] = $id_mod_lic;

			}
			// echo '<br><br><br>-------------------------------------------------INFO = '.$affichage_bloc;

			/*echo '<br>ref_fact = '.$ref_fact;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO facture_dossier(ref_fact, id_cli, id_util, 
																			id_mod_lic, type_fact, information, 
																			note_debit, id_t_trans, 
																			affichage_bloc)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_fact'], $entree['id_cli'], $entree['id_util'], 
									$entree['id_mod_lic'], $entree['type_fact'], $entree['information'], 
									$entree['note_debit'], $entree['id_t_trans'], $entree['affichage_bloc']));

		}
		
		public function creerFactureBrouillon($ref_fact, $id_cli, $id_util, $id_mod_lic, $type_fact, $information, $note_debit='0', $id_t_trans=NULL, $affichage_bloc='1'){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['id_cli'] = $id_cli;
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$entree['information'] = $information;
			$entree['note_debit'] = $note_debit;
			$entree['affichage_bloc'] = $affichage_bloc;

			if ( isset($id_t_trans) && ($id_t_trans!='') && ($id_t_trans=='1') && ($id_mod_lic=='2') ) {

				$entree['id_t_trans'] = '2';

			}else if ((isset($id_t_trans) && ($id_t_trans!=''))) {

				$entree['id_t_trans'] = $id_t_trans;

			}else if((isset($_GET['id_t_trans']) && ($_GET['id_t_trans']!=''))){

				$entree['id_t_trans'] = $_GET['id_t_trans'];

			}
			else{

				$entree['id_t_trans'] = $id_mod_lic;

			}
			// echo '<br><br><br>-------------------------------------------------INFO = '.$affichage_bloc;

			/*echo '<br>ref_fact = '.$ref_fact;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO facture_dossier(ref_fact, id_cli, id_util, 
																			id_mod_lic, type_fact, information, 
																			note_debit, id_t_trans, 
																			affichage_bloc, validation)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, "2")');
			$requete-> execute(array($entree['ref_fact'], $entree['id_cli'], $entree['id_util'], 
									$entree['id_mod_lic'], $entree['type_fact'], $entree['information'], 
									$entree['note_debit'], $entree['id_t_trans'], $entree['affichage_bloc']));

		}
		
		// public function creerFactureDossier($ref_fact, $id_cli, $id_util, $id_mod_lic, $type_fact, $information, $note_debit='0'){
		// 	include('connexion.php');

		// 	$entree['ref_fact'] = $ref_fact;
		// 	$entree['id_cli'] = $id_cli;
		// 	$entree['id_util'] = $id_util;
		// 	$entree['id_mod_lic'] = $id_mod_lic;
		// 	$entree['type_fact'] = $type_fact;
		// 	$entree['information'] = $information;
		// 	$entree['note_debit'] = $note_debit;

		// 	if (isset($_GET['id_mod_trans'])) {
		// 		$entree['id_mod_trans'] = $_GET['id_mod_trans'];
		// 	}else{
		// 		$entree['id_mod_trans'] = 1;
		// 	}

		// 	echo '<br>ref_fact = '.$ref_fact;
		// 	echo '<br>id_cli = '.$id_cli;
		// 	echo '<br>id_util = '.$id_util;
		// 	echo '---------<br>';

		// 	$requete = $connexion-> prepare('INSERT INTO facture_dossier(ref_fact, id_cli, id_util, 
		// 																	id_mod_lic, type_fact, information, 
		// 																	note_debit, id_mod_trans)
		// 										VALUES(?, ?, ?, ?, ?, ?, ?, ?)');
		// 	$requete-> execute(array($entree['ref_fact'], $entree['id_cli'], $entree['id_util'], 
		// 							$entree['id_mod_lic'], $entree['type_fact'], $entree['information'], 
		// 							$entree['note_debit'], $entree['id_mod_trans']));

		// }
		
		public function creerFactureDossierSicomineTR8($ref_fact, $id_cli, $id_util, $id_mod_lic, $type_fact, $information, $note_debit='0'){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['id_cli'] = $id_cli;
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$entree['information'] = $information;
			$entree['note_debit'] = $note_debit;

			if (isset($_GET['id_mod_trans'])) {
				$entree['id_mod_trans'] = $_GET['id_mod_trans'];
			}else{
				$entree['id_mod_trans'] = 1;
			}

			/*echo '<br>ref_fact = '.$ref_fact;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO facture_dossier(ref_fact, id_cli, id_util, 
																			id_mod_lic, type_fact, information, 
																			note_debit, id_mod_trans, validation, id_t_trans)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, "0", "4")');
			$requete-> execute(array($entree['ref_fact'], $entree['id_cli'], $entree['id_util'], 
									$entree['id_mod_lic'], $entree['type_fact'], $entree['information'], 
									$entree['note_debit'], $entree['id_mod_trans']));

		}
		
		public function creerFactureDossierSicomineIM4($ref_fact, $id_cli, $id_util, $id_mod_lic, $type_fact, $information, $note_debit='0'){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['id_cli'] = $id_cli;
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$entree['information'] = $information;
			$entree['note_debit'] = $note_debit;

			if (isset($_GET['id_mod_trans'])) {
				$entree['id_mod_trans'] = $_GET['id_mod_trans'];
			}else{
				$entree['id_mod_trans'] = 1;
			}

			/*echo '<br>ref_fact = '.$ref_fact;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO facture_dossier(ref_fact, id_cli, id_util, 
																			id_mod_lic, type_fact, information, 
																			note_debit, id_mod_trans, validation, id_t_trans)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, "0", "2")');
			$requete-> execute(array($entree['ref_fact'], $entree['id_cli'], $entree['id_util'], 
									$entree['id_mod_lic'], $entree['type_fact'], $entree['information'], 
									$entree['note_debit'], $entree['id_mod_trans']));

		}
		
		public function creerFactureDossierSicomine($ref_fact, $id_cli, $id_util, $id_mod_lic, $type_fact, $information, $note_debit='0'){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['id_cli'] = $id_cli;
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$entree['information'] = $information;
			$entree['note_debit'] = $note_debit;

			if (isset($_GET['id_mod_trans'])) {
				$entree['id_mod_trans'] = $_GET['id_mod_trans'];
			}else{
				$entree['id_mod_trans'] = 1;
			}

			/*echo '<br>ref_fact = '.$ref_fact;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO facture_dossier(ref_fact, id_cli, id_util, 
																			id_mod_lic, type_fact, information, 
																			note_debit, id_mod_trans, validation, id_t_trans)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, "2", "2")');
			$requete-> execute(array($entree['ref_fact'], $entree['id_cli'], $entree['id_util'], 
									$entree['id_mod_lic'], $entree['type_fact'], $entree['information'], 
									$entree['note_debit'], $entree['id_mod_trans']));

		}
		
		public function ajoutMarchandise($nom_march, $id_dos, $id_util,
											$origine, $ref_fact, $nbr_bags, 
											$id_emb, $supplier, $poids_brut, 
											$poids, $id_unit_mes, $fob, 
											$fret, $assurance, $autre_frais, 
											$num_av, $num_lic, $fxi, 
											$code_tarif_march, $id_mon, $num_exo){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['nom_march'] = $nom_march;
			$entree['id_dos'] = $id_dos;

			$entree['origine'] = $origine;
			$entree['ref_fact'] = $ref_fact;
			$entree['nbr_bags'] = $nbr_bags;
			$entree['id_emb'] = $id_emb;
			$entree['supplier'] = $supplier;
			$entree['poids_brut'] = $poids_brut;
			$entree['poids'] = $poids;
			$entree['id_unit_mes'] = $id_unit_mes;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['num_av'] = $num_av;
			$entree['num_lic'] = $num_lic;
			$entree['fxi'] = $fxi;
			$entree['code_tarif_march'] = $code_tarif_march;
			$entree['id_mon'] = $id_mon;
			$entree['num_exo'] = $num_exo;

			// echo '<br>-----------------------------------id_util = '.$id_util;
			// echo '<br>-----------------------------------id_march = '.$id_march;
			// echo '<br>-----------------------------------id_dos = '.$id_dos;
			// echo '<br>-----------------------------------origine = '.$origine;
			// echo '<br>-----------------------------------ref_fact = '.$ref_fact;
			// echo '<br>-----------------------------------nbr_bags = '.$nbr_bags;
			// echo '<br>-----------------------------------id_emb = '.$id_emb;
			// echo '<br>-----------------------------------supplier = '.$supplier;
			// echo '<br>-----------------------------------poids_brut = '.$poids_brut;
			// echo '<br>-----------------------------------poids = '.$poids;
			// echo '<br>-----------------------------------id_unit_mes = '.$id_unit_mes;
			// echo '<br>-----------------------------------fob = '.$fob;
			// echo '<br>-----------------------------------fret = '.$fret;
			// echo '<br>-----------------------------------assurance = '.$assurance;
			// echo '<br>-----------------------------------autre_frais = '.$autre_frais;
			// echo '<br>-----------------------------------num_av = '.$num_av;
			// echo '<br>-----------------------------------num_lic = '.$num_lic;
			// echo '<br>-----------------------------------fxi = '.$fxi;

			$requete = $connexion-> prepare("INSERT INTO marchandise_dossier(nom_march, id_dos, id_util,
																	origine, ref_fact, nbr_bags, id_emb, 
																	supplier, poids_brut, poids, id_unit_mes, 
																	fob, fret, assurance, autre_frais, num_av, 
																	num_lic, fxi, code_tarif_march, id_mon, num_exo)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['nom_march'], $entree['id_dos'], $entree['id_util'],
									$entree['origine'], $entree['ref_fact'], $entree['nbr_bags'],
									$entree['id_emb'], $entree['supplier'], $entree['poids_brut'],
									$entree['poids'], $entree['id_unit_mes'], $entree['fob'], 
									$entree['fret'], $entree['assurance'], $entree['autre_frais'],
									$entree['num_av'], $entree['num_lic'], $entree['fxi'], 
									$entree['code_tarif_march'], $entree['id_mon'], $entree['num_exo']));


			$requeteMarchandise = $connexion-> prepare('SELECT SUM(nbr_bags) AS nbr_bags, 
																SUM(poids_brut) AS poids_brut, 
																SUM(poids) AS poids,
																SUM(fob) AS fob,
																SUM(fret) AS fret,
																SUM(assurance) AS assurance,
																SUM(autre_frais) AS autre_frais,
																id_mon
															FROM marchandise_dossier
															WHERE id_dos = ?');
			$requeteMarchandise-> execute(array($entree['id_dos']));
			$reponseMarchandise = $requeteMarchandise-> fetch();

			$this-> MAJ_nbr_bags($entree['id_dos'], $reponseMarchandise['nbr_bags']);
			$this-> MAJ_poids_brut($entree['id_dos'], $reponseMarchandise['poids_brut']);
			$this-> MAJ_poids($entree['id_dos'], $reponseMarchandise['poids']);
			$this-> MAJ_fob($entree['id_dos'], $reponseMarchandise['fob']);
			$this-> MAJ_montant_decl($entree['id_dos'], $reponseMarchandise['fob']);
			$this-> MAJ_id_mon($entree['id_dos'], $id_mon);
			// $this-> MAJ_fret($entree['id_dos'], $reponseMarchandise['fret']);
			// $this-> MAJ_assurance($entree['id_dos'], $reponseMarchandise['assurance']);
			// $this-> MAJ_autre_frais($entree['id_dos'], $reponseMarchandise['autre_frais']);
			// $this-> MAJ_id_mon($entree['id_dos'], $reponseMarchandise['id_mon']);


		}

		public function repliquerMarchandise($id_dos, $id_dos_rep){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['id_dos_rep'] = $id_dos_rep;

			$requete = $connexion-> prepare("SELECT * FROM marchandise_dossier WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos_rep']));
			while ($reponse = $requete-> fetch()) {
				
				$this-> ajoutMarchandise($reponse['nom_march'], $entree['id_dos'], $reponse['id_util'],
											$reponse['origine'], $reponse['ref_fact'], $reponse['nbr_bags'], 
											$reponse['id_emb'], $reponse['supplier'], $reponse['poids_brut'], 
											$reponse['poids'], $reponse['id_unit_mes'], $reponse['fob'], 
											$reponse['fret'], $reponse['assurance'], $reponse['autre_frais'], 
											$reponse['num_av'], $reponse['num_lic'], $reponse['fxi'], 
											$reponse['code_tarif_march'], $reponse['id_mon'], $reponse['num_exo']);

			}$requete-> closeCursor();


			$requeteMarchandise = $connexion-> prepare('SELECT SUM(nbr_bags) AS nbr_bags, 
																SUM(poids_brut) AS poids_brut, 
																SUM(poids) AS poids,
																SUM(fob) AS fob,
																SUM(fret) AS fret,
																SUM(assurance) AS assurance,
																SUM(autre_frais) AS autre_frais,
																id_mon
															FROM marchandise_dossier
															WHERE id_dos = ?');
			$requeteMarchandise-> execute(array($entree['id_dos']));
			$reponseMarchandise = $requeteMarchandise-> fetch();

			$this-> MAJ_nbr_bags($entree['id_dos'], $reponseMarchandise['nbr_bags']);
			$this-> MAJ_poids_brut($entree['id_dos'], $reponseMarchandise['poids_brut']);
			$this-> MAJ_poids($entree['id_dos'], $reponseMarchandise['poids']);
			$this-> MAJ_fob($entree['id_dos'], $reponseMarchandise['fob']);
			$this-> MAJ_montant_decl($entree['id_dos'], $reponseMarchandise['fob']);
			// $this-> MAJ_fret($entree['id_dos'], $reponseMarchandise['fret']);
			// $this-> MAJ_assurance($entree['id_dos'], $reponseMarchandise['assurance']);
			// $this-> MAJ_autre_frais($entree['id_dos'], $reponseMarchandise['autre_frais']);
			// $this-> MAJ_id_mon($entree['id_dos'], $reponseMarchandise['id_mon']);


		}

		public function editMultipleMarchandise($nom_march, $id_dos, $id_util,
											$origine, $ref_fact, $nbr_bags, 
											$id_emb, $supplier, $poids_brut, 
											$poids, $id_unit_mes, $fob, 
											$fret, $assurance, $autre_frais, 
											$num_av, $num_lic, $fxi, 
											$code_tarif_march, $id_mon, $num_exo){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['nom_march'] = $nom_march;
			$entree['id_dos'] = $id_dos;

			$entree['origine'] = $origine;
			$entree['ref_fact'] = $ref_fact;
			$entree['nbr_bags'] = $nbr_bags;
			$entree['id_emb'] = $id_emb;
			$entree['supplier'] = $supplier;
			$entree['poids_brut'] = $poids_brut;
			$entree['poids'] = $poids;
			$entree['id_unit_mes'] = $id_unit_mes;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['num_av'] = $num_av;
			$entree['num_lic'] = $num_lic;
			$entree['fxi'] = $fxi;
			$entree['code_tarif_march'] = $code_tarif_march;
			$entree['id_mon'] = $id_mon;
			$entree['num_exo'] = $num_exo;

			// echo '<br>-----------------------------------id_util = '.$id_util;
			// echo '<br>-----------------------------------id_march = '.$id_march;
			// echo '<br>-----------------------------------id_dos = '.$id_dos;
			// echo '<br>-----------------------------------origine = '.$origine;
			// echo '<br>-----------------------------------ref_fact = '.$ref_fact;
			// echo '<br>-----------------------------------nbr_bags = '.$nbr_bags;
			// echo '<br>-----------------------------------id_emb = '.$id_emb;
			// echo '<br>-----------------------------------supplier = '.$supplier;
			// echo '<br>-----------------------------------poids_brut = '.$poids_brut;
			// echo '<br>-----------------------------------poids = '.$poids;
			// echo '<br>-----------------------------------id_unit_mes = '.$id_unit_mes;
			// echo '<br>-----------------------------------fob = '.$fob;
			// echo '<br>-----------------------------------fret = '.$fret;
			// echo '<br>-----------------------------------assurance = '.$assurance;
			// echo '<br>-----------------------------------autre_frais = '.$autre_frais;
			// echo '<br>-----------------------------------num_av = '.$num_av;
			// echo '<br>-----------------------------------num_lic = '.$num_lic;
			// echo '<br>-----------------------------------fxi = '.$fxi;

			if (isset($nom_march) && ($nom_march!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET nom_march = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['nom_march'], $entree['id_dos']));
			}
			if (isset($origine) && ($origine!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET origine = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['origine'], $entree['id_dos']));
			}
			if (isset($nbr_bags) && ($nbr_bags!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET nbr_bags = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['nbr_bags'], $entree['id_dos']));
			}
			if (isset($id_emb) && ($id_emb!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET id_emb = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['id_emb'], $entree['id_dos']));
			}
			if (isset($supplier) && ($supplier!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET supplier = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['supplier'], $entree['id_dos']));
			}
			if (isset($ref_fact) && ($ref_fact!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET ref_fact = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['ref_fact'], $entree['id_dos']));
			}
			if (isset($poids_brut) && ($poids_brut!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET poids_brut = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['poids_brut'], $entree['id_dos']));
			}
			if (isset($poids) && ($poids!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET poids = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['poids'], $entree['id_dos']));
			}
			if (isset($id_unit_mes) && ($id_unit_mes!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET id_unit_mes = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['id_unit_mes'], $entree['id_dos']));
			}
			if (isset($fob) && ($fob!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET fob = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['fob'], $entree['id_dos']));
			}
			if (isset($fret) && ($fret!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET fret = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['fret'], $entree['id_dos']));
			}
			if (isset($assurance) && ($assurance!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET assurance = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['assurance'], $entree['id_dos']));
			}
			if (isset($autre_frais) && ($autre_frais!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET autre_frais = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['autre_frais'], $entree['id_dos']));
			}
			if (isset($num_av) && ($num_av!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET num_av = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['num_av'], $entree['id_dos']));
			}
			if (isset($num_lic) && ($num_lic!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET num_lic = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['num_lic'], $entree['id_dos']));
			}
			if (isset($fxi) && ($fxi!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET fxi = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['fxi'], $entree['id_dos']));
			}
			if (isset($code_tarif_march) && ($code_tarif_march!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET code_tarif_march = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['code_tarif_march'], $entree['id_dos']));
			}
			if (isset($id_mon) && ($id_mon!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET id_mon = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['id_mon'], $entree['id_dos']));
			}
			if (isset($num_exo) && ($num_exo!='')) {
				$requete = $connexion-> prepare("UPDATE marchandise_dossier SET num_exo = ? WHERE id_dos = ?");
				$requete-> execute(array($entree['num_exo'], $entree['id_dos']));
			}


			$requeteMarchandise = $connexion-> prepare('SELECT SUM(nbr_bags) AS nbr_bags, 
																SUM(poids_brut) AS poids_brut, 
																SUM(poids) AS poids,
																SUM(fob) AS fob,
																SUM(fret) AS fret,
																SUM(assurance) AS assurance,
																SUM(autre_frais) AS autre_frais,
																id_mon
															FROM marchandise_dossier
															WHERE id_dos = ?');
			$requeteMarchandise-> execute(array($entree['id_dos']));
			$reponseMarchandise = $requeteMarchandise-> fetch();

			$this-> MAJ_nbr_bags($entree['id_dos'], $reponseMarchandise['nbr_bags']);
			$this-> MAJ_poids_brut($entree['id_dos'], $reponseMarchandise['poids_brut']);
			$this-> MAJ_poids($entree['id_dos'], $reponseMarchandise['poids']);
			$this-> MAJ_fob($entree['id_dos'], $reponseMarchandise['fob']);
			$this-> MAJ_montant_decl($entree['id_dos'], $reponseMarchandise['fob']);
			// $this-> MAJ_fret($entree['id_dos'], $reponseMarchandise['fret']);
			// $this-> MAJ_assurance($entree['id_dos'], $reponseMarchandise['assurance']);
			// $this-> MAJ_autre_frais($entree['id_dos'], $reponseMarchandise['autre_frais']);
			// $this-> MAJ_id_mon($entree['id_dos'], $reponseMarchandise['id_mon']);


		}

		public function creerCotation($ref_cot, $id_dos, $id_util){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['ref_cot'] = $ref_cot;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("INSERT INTO cotation(ref_cot, id_dos, id_util)
												VALUES(?, ?, ?)");
			$requete-> execute(array($entree['ref_cot'], $entree['id_dos'], $entree['id_util']));
		}

		public function creerDetailCotation($id_cot, $id_deb, $montant){
			include('connexion.php');

			$entree['id_cot'] = $id_cot;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;

			/*
			echo '<br>id_cot = '.$id_cot;
			echo '<br>id_deb = '.$id_deb;
			echo '<br>montant = '.$montant;*/

			$requete = $connexion-> prepare("INSERT INTO detail_cotation(id_cot, id_deb, montant)
												VALUES(?, ?, ?)");
			$requete-> execute(array($entree['id_cot'], $entree['id_deb'], $entree['montant']));
		}

		// public function creerDepenseDossier($ref_dep, $id_util, $id_cli){
		// 	include('connexion.php');

		// 	$entree['ref_dep'] = $ref_dep;
		// 	$entree['id_util'] = $id_util;
		// 	$entree['id_cli'] = $id_cli;

			
		// 	// echo '<br>ref_dep = '.$ref_dep;
		// 	// echo '<br>id_util = '.$id_util;
		// 	// echo '<br>id_cli = '.$id_cli;

		// 	$requete = $connexion-> prepare("INSERT INTO depense_dossier(ref_dep, id_util, id_cli)
		// 										VALUES(?, ?, ?)");
		// 	$requete-> execute(array($entree['ref_dep'], $entree['id_util'], $entree['id_cli']));
		// }

		// public function creerDepenseDossier($id_dep, $id_dos, $montant, $date_dep, $id_util){
		// 	include('connexion.php');

		// 	$entree['id_dep'] = $id_dep;
		// 	$entree['id_dos'] = $id_dos;
		// 	$entree['montant'] = $montant;
		// 	$entree['date_dep'] = $date_dep;
		// 	$entree['id_util'] = $id_util;

			
		// 	// echo '<br>----<br>id_dep = '.$id_dep;
		// 	// echo '<br>id_dos = '.$id_dos;
		// 	// echo '<br>montant = '.$montant;
		// 	// echo '<br>date_dep = '.$date_dep;
		// 	// echo '<br>id_util = '.$id_util;

		// 	$requete = $connexion-> prepare("INSERT INTO depense_dossier(id_dep, id_dos, montant, date_dep, id_util)
		// 										VALUES(?, ?, ?, ?, ?)");
		// 	$requete-> execute(array($entree['id_dep'], $entree['id_dos'], $entree['montant'], $entree['date_dep'], $entree['id_util']));
		// }

		public function creerDetailFactureDossierBackUp($ref_fact, $id_dos, $id_deb, $montant){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;

			/*echo '<br><br>id_dos = '.$id_dos;
			echo '<br>ref_fact = '.$ref_fact;
			echo '<br>id_deb = '.$id_deb;
			echo '<br>montant = '.$montant;*/

			$requete = $connexion-> prepare("INSERT INTO detail_facture_dossier(ref_fact, id_dos,
																	id_deb, montant)
												VALUES(?, ?, ?, ?)");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'],
									$entree['id_deb'], $entree['montant']));
		}

		public function creerDetailFactureDossier($ref_fact, $id_dos, $id_deb, $montant, $tva, $usd='1', $detail=NULL){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$entree['tva'] = $tva;
			$entree['usd'] = $usd;
			$entree['detail'] = $detail;

			// echo '<br><br>id_dos = '.$id_dos;
			// echo '<br>ref_fact = '.$ref_fact;
			// echo '<br>id_deb = '.$id_deb;
			// echo '<br>montant = '.$montant;
			// echo '<br>------------------<br>';

			$requete = $connexion-> prepare("INSERT INTO detail_facture_dossier(ref_fact, id_dos,
																	id_deb, montant, tva, usd, detail)
												VALUES(?, ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'],
									$entree['id_deb'], $entree['montant'], 
									$entree['tva'], $entree['usd'], $entree['detail']));
		}

		public function creerDetailFactureLicence($ref_fact, $num_lic, $id_deb, $montant, $tva, $usd='1', $detail=NULL){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$entree['tva'] = $tva;
			$entree['usd'] = $usd;
			$entree['detail'] = $detail;

			// echo '<br><br>------------------num_lic = '.$num_lic;
			// echo '<br>------------------ref_fact = '.$ref_fact;
			// echo '<br>------------------id_deb = '.$id_deb;
			// echo '<br>------------------montant = '.$montant;
			// echo '<br>------------------tva = '.$tva;
			// echo '<br>------------------usd = '.$usd;
			// echo '<br>------------------detail = '.$detail;
			// echo '<br>------------------<br>';

			$requete = $connexion-> prepare("INSERT INTO detail_facture_licence(ref_fact, num_lic,
																	id_deb, montant, tva, usd)
												VALUES(?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['ref_fact'], $entree['num_lic'],
									$entree['id_deb'], $entree['montant'], 
									$entree['tva'], $entree['usd']));
		}

		public function creerDetailFactureDossier2($ref_fact, $id_dos, $id_deb, $montant, $tva, $usd){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$entree['tva'] = $tva;
			$entree['usd'] = $usd;

			// echo '<br><br>----------------------------------------------------------------------------------------id_dos = '.$id_dos;
			// echo '<br>----------------------------------------------------------------------------------------ref_fact = '.$ref_fact;
			// echo '<br>----------------------------------------------------------------------------------------id_deb = '.$id_deb;
			// echo '<br>----------------------------------------------------------------------------------------montant = '.$montant;
			// echo '<br>----------------------------------------------------------------------------------------usd = '.$usd;
			// echo '<br>----------------------------------------------------------------------------------------tva = '.$tva;
			// echo '<br>------------------<br>';

			$requete = $connexion-> prepare("INSERT INTO detail_facture_dossier(ref_fact, id_dos,
																	id_deb, montant, tva, usd)
												VALUES(?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'],
									$entree['id_deb'], $entree['montant'], 
									$entree['tva'], $entree['usd']));
		}

		public function creerDossierIBFromUploade($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier_upload
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];

				$this-> creerDossierIB2($reponse['ref_dos'], $reponse['client'], $reponse['ref_fact'],
                                          $reponse['fob'], $reponse['fret'], $reponse['assurance'],
                                          $reponse['autre_frais'], $reponse['num_lic'], $_GET['id_mod_trac'],
                                          NULL, 1,
                                          NULL, $reponse['cod'], $reponse['fxi'],
                                          $reponse['montant_av'], $reponse['date_fact'],
                                          $reponse['ref_decl'], $reponse['montant_decl'],
                                          $reponse['ref_liq'], $_SESSION['id_util'],
                                          $reponse['ref_quit'], $reponse['date_quit']);

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload
												SET etat = 1
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}

		public function creerDossierIBFromUploadeTrackingKlsa($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier_upload_tracking
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];
				$this-> creerDossierIBTrackingKlsa($reponse['ref_dos'], $reponse['client'], $reponse['t1'],
                                          $reponse['poids'], $reponse['ref_fact'], $reponse['horse'],
                                          $reponse['trailer_1'], $reponse['trailer_2'], $reponse['transporteur'],
                                          $reponse['destination'], $reponse['id_mod_trans'],
                                          $reponse['arrival_date'], $reponse['crossing_date'],
                                          $reponse['wiski_arriv'], $reponse['wiski_dep'],
                                          $reponse['remarque'], $_SESSION['id_util'],
                                          $_GET['id_mod_trac'], $reponse['num_lic']);

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload_tracking
												SET etat = '1'
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}

		public function creerDossierEBFromUploade($id_util){
			include('connexion.php');

			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier_upload_export
												WHERE id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];
				$this-> creerDossierEBUpload($reponse['ref_dos'], $reponse['num_lic'], $reponse['ship_num'], $reponse['barge'], $reponse['horse'], $reponse['trailer_1'], $reponse['trailer_2'], $reponse['num_lot'], $reponse['nbr_bags'], $reponse['poids'], $reponse['kapulo_load'], $reponse['dispatch_pweto'], $reponse['arrival_pweto'], $reponse['barge_load'], $reponse['barge_dispatch_date'], $reponse['doc_receiv'], $reponse['nbre_seal'], $reponse['dgda_seal'], $reponse['remarque'], $reponse['transporter'], $reponse['load_date'], $reponse['pv_mine'], $reponse['demande_attestation'], $reponse['assay_date'], $reponse['ceec_in'], $reponse['ceec_out'], $reponse['min_div_in'], $reponse['min_div_out'], $reponse['date_decl'], $reponse['dgda_in'], $reponse['date_liq'], $reponse['date_quit'], $reponse['dgda_out'], $reponse['gov_in'], $reponse['gov_out'], $reponse['dispatch_date'], $reponse['klsa_arriv'], $reponse['end_form'], $reponse['exit_drc'], $reponse['cleared'], $reponse['statut'], $reponse['site_load'], $reponse['destination'], $reponse['ref_decl'], $reponse['ref_liq'], $reponse['ref_quit'], $reponse['impala_sncc'], $reponse['docs_sncc'], $reponse['sncc_sakania'], $reponse['sakania_date'], $reponse['id_cli'], $reponse['id_util'], $reponse['id_mod_trans']);

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload_export
												SET etat = '1'
												WHERE id_util = ?");
			$requete-> execute(array($entree['id_util']));
		}

		public function creerDossierIBFromUploade2($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier_upload_tracking
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];

				if ($this-> verifierDossier($reponse['ref_dos']) == false) {
					//Créer des nouveaux dossiers
					$this-> creerDossierIB3($reponse['client'], $reponse['ref_dos'], $reponse['mca_b_ref'], $reponse['road_manif'],
                                                $reponse['date_preal'], $reponse['t1'], $reponse['poids'], $reponse['ref_fact'], $reponse['supplier'], $reponse['fob'], $reponse['fret'],
                                                $reponse['assurance'], $reponse['autre_frais'], $reponse['po'],
                                                $reponse['commodity'], $reponse['horse'], $reponse['trailer_1'], $reponse['trailer_2'], $reponse['num_lic'],
                                                $reponse['num_exo'], $reponse['arrival_date'], $reponse['crossing_date'], $reponse['wiski_arriv'],
                                                $reponse['wiski_dep'], $reponse['amicongo_arriv'], $reponse['insp_report'], $reponse['ir'],
                                                $reponse['ref_crf'], $reponse['date_crf'], $reponse['ref_decl'], $reponse['dgda_in'], $reponse['ref_liq'],
                                                $reponse['date_liq'], $reponse['ref_quit'], $reponse['date_quit'], $reponse['dgda_out'],
                                                $reponse['custom_deliv'], $reponse['dispatch_deliv'], $reponse['remarque'], $reponse['statut'], $reponse['bl'],
                                                $_GET['id_mod_trac'], $_SESSION['id_util'], 1,
                                                $reponse['credit_enlev_by'], $reponse['bond_warehouse']);
				}else{

					//Mettre à jour les dossiers existants
					$id_dos = NULL;
					$id_dos = $this-> getIdDossierClientLicence($reponse['ref_dos'], $reponse['client'], $reponse['num_lic']);

					if (isset($reponse['mca_b_ref']) && ($reponse['mca_b_ref'] != '')) {
						$this-> MAJ_mca_b_ref($id_dos, $reponse['mca_b_ref']);
					}

					if (isset($reponse['road_manif']) && ($reponse['road_manif'] != '')) {
						$this-> MAJ_road_manif($id_dos, $reponse['road_manif']);
					}

					if (isset($reponse['date_preal']) && ($reponse['date_preal'] != '')) {
						$this-> MAJ_date_preal($id_dos, $reponse['date_preal']);
					}

					if (isset($reponse['t1']) && ($reponse['t1'] != '')) {
						$this-> MAJ_t1($id_dos, $reponse['t1']);
					}

					if (isset($reponse['poids']) && ($reponse['poids'] != '')) {
						$this-> MAJ_poids($id_dos, $reponse['poids']);
					}

					if (isset($reponse['fob']) && ($reponse['fob'] != '')) {
						$this-> MAJ_fob($id_dos, $reponse['fob']);
					}

					if (isset($reponse['fret']) && ($reponse['fret'] != '')) {
						$this-> MAJ_fret($id_dos, $reponse['fret']);
					}

					if (isset($reponse['assurance']) && ($reponse['assurance'] != '')) {
						$this-> MAJ_assurance($id_dos, $reponse['assurance']);
					}

					if (isset($reponse['autre_frais']) && ($reponse['autre_frais'] != '')) {
						$this-> MAJ_autre_frais($id_dos, $reponse['autre_frais']);
					}

					if (isset($reponse['ref_fact']) && ($reponse['ref_fact'] != '')) {
						$this-> MAJ_ref_fact($id_dos, $reponse['ref_fact']);
					}

					if (isset($reponse['fournisseur']) && ($reponse['fournisseur'] != '')) {
						$this-> MAJ_fournisseur($id_dos, $reponse['fournisseur']);
					}

					if (isset($reponse['po']) && ($reponse['po'] != '')) {
						$this-> MAJ_po_ref($id_dos, $reponse['po']);
					}

					if (isset($reponse['commodity']) && ($reponse['commodity'] != '')) {
						$this-> MAJ_commodity($id_dos, $reponse['commodity']);
					}

					if (isset($reponse['horse']) && ($reponse['horse'] != '')) {
						$this-> MAJ_horse($id_dos, $reponse['horse']);
					}

					if (isset($reponse['trailer_1']) && ($reponse['trailer_1'] != '')) {
						$this-> MAJ_trailer_1($id_dos, $reponse['trailer_1']);
					}

					if (isset($reponse['trailer_2']) && ($reponse['trailer_2'] != '')) {
						$this-> MAJ_trailer_2($id_dos, $reponse['trailer_2']);
					}

					if (isset($reponse['num_lic']) && ($reponse['num_lic'] != '')) {
						$this-> MAJ_num_lic($id_dos, $reponse['num_lic']);
					}

					if (isset($reponse['num_exo']) && ($reponse['num_exo'] != '')) {
						$this-> MAJ_num_exo($id_dos, $reponse['num_exo']);
					}

					if (isset($reponse['arrival_date']) && ($reponse['arrival_date'] != '')) {
						$this-> MAJ_arrival_date($id_dos, $reponse['arrival_date']);
					}

					if (isset($reponse['crossing_date']) && ($reponse['crossing_date'] != '')) {
						$this-> MAJ_crossing_date($id_dos, $reponse['crossing_date']);
					}

					if (isset($reponse['wiski_arriv']) && ($reponse['wiski_arriv'] != '')) {
						$this-> MAJ_wiski_arriv($id_dos, $reponse['wiski_arriv']);
					}

					if (isset($reponse['wiski_dep']) && ($reponse['wiski_dep'] != '')) {
						$this-> MAJ_wiski_dep($id_dos, $reponse['wiski_dep']);
					}

					if (isset($reponse['amicongo_arriv']) && ($reponse['amicongo_arriv'] != '')) {
						$this-> MAJ_amicongo_arriv($id_dos, $reponse['amicongo_arriv']);
					}

					if (isset($reponse['insp_report']) && ($reponse['insp_report'] != '')) {
						$this-> MAJ_insp_report($id_dos, $reponse['insp_report']);
					}

					if (isset($reponse['ir']) && ($reponse['ir'] != '')) {
						$this-> MAJ_ir($id_dos, $reponse['ir']);
					}

					if (isset($reponse['ref_crf']) && ($reponse['ref_crf'] != '')) {
						$this-> MAJ_ref_crf($id_dos, $reponse['ref_crf']);
					}

					if (isset($reponse['date_crf']) && ($reponse['date_crf'] != '')) {
						$this-> MAJ_date_crf($id_dos, $reponse['date_crf']);
					}

					if (isset($reponse['ref_decl']) && ($reponse['ref_decl'] != '')) {
						$this-> MAJ_ref_decl($id_dos, $reponse['ref_decl']);
					}

					if (isset($reponse['dgda_in']) && ($reponse['dgda_in'] != '')) {
						$this-> MAJ_dgda_in($id_dos, $reponse['dgda_in']);
					}

					if (isset($reponse['ref_liq']) && ($reponse['ref_liq'] != '')) {
						$this-> MAJ_ref_liq($id_dos, $reponse['ref_liq']);
					}

					if (isset($reponse['date_liq']) && ($reponse['date_liq'] != '')) {
						$this-> MAJ_date_liq($id_dos, $reponse['date_liq']);
					}

					if (isset($reponse['ref_quit']) && ($reponse['ref_quit'] != '')) {
						$this-> MAJ_ref_quit($id_dos, $reponse['ref_quit']);
					}

					if (isset($reponse['date_quit']) && ($reponse['date_quit'] != '')) {
						$this-> MAJ_date_quit($id_dos, $reponse['date_quit']);
					}

					if (isset($reponse['dgda_out']) && ($reponse['dgda_out'] != '')) {
						$this-> MAJ_dgda_out($id_dos, $reponse['dgda_out']);
					}

					if (isset($reponse['custom_deliv']) && ($reponse['custom_deliv'] != '')) {
						$this-> MAJ_custom_deliv($id_dos, $reponse['custom_deliv']);
					}

					if (isset($reponse['dispatch_deliv']) && ($reponse['dispatch_deliv'] != '')) {
						$this-> MAJ_dispatch_deliv($id_dos, $reponse['dispatch_deliv']);
					}

					if (isset($reponse['remarque']) && ($reponse['remarque'] != '')) {
						$this-> MAJ_remarque($id_dos, $reponse['remarque']);
					}

					if (isset($reponse['statut']) && ($reponse['statut'] != '')) {
						$this-> MAJ_statut($id_dos, $reponse['statut']);
					}

				}

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload_tracking
												SET etat = '1'
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}

		public function creerDossierIBFromUploadeMMG($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier_upload_tracking
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];

				if ($this-> verifierDossier($reponse['ref_dos']) == false) {
					//Créer des nouveaux dossiers
					$this-> creerDossierTrackingMMG($reponse['client'], $reponse['ref_dos'], $reponse['t1'], $reponse['poids'],
                                      $reponse['ref_fact'], $reponse['horse'], $reponse['trailer_1'], $reponse['trailer_2'],
                                      $reponse['num_lic'], $reponse['num_exo'], $reponse['klsa_arriv'], $reponse['crossing_date'],
                                      $reponse['wiski_arriv'], $reponse['wiski_dep'], $reponse['insp_report'], $reponse['ir'],
                                      $reponse['ref_crf'], $reponse['date_crf'], $reponse['ref_decl'], $reponse['dgda_in'],
                                      $reponse['ref_liq'], $reponse['date_liq'], $reponse['ref_quit'], $reponse['date_quit'],
                                      $reponse['dgda_out'], $reponse['regul_ir'], $reponse['cleared'], $reponse['statut'], $reponse['remarque'], 2, 1);
				}else{

					//Mettre à jour les dossiers existants
					$id_dos = NULL;
					$id_dos = $this-> getIdDossierClientLicence($reponse['ref_dos'], $reponse['client'], $reponse['num_lic']);

					if (isset($reponse['t1']) && ($reponse['t1'] != '')) {
						$this-> MAJ_t1($id_dos, $reponse['t1']);
					}
					if (isset($reponse['poids']) && ($reponse['poids'] != '')) {
						$this-> MAJ_poids($id_dos, $reponse['poids']);
					}
					if (isset($reponse['horse']) && ($reponse['horse'] != '')) {
						$this-> MAJ_horse($id_dos, $reponse['horse']);
					}
					if (isset($reponse['trailer_1']) && ($reponse['trailer_1'] != '')) {
						$this-> MAJ_trailer_1($id_dos, $reponse['trailer_1']);
					}
					if (isset($reponse['trailer_2']) && ($reponse['trailer_2'] != '')) {
						$this-> MAJ_trailer_2($id_dos, $reponse['trailer_2']);
					}
					if (isset($reponse['num_lic']) && ($reponse['num_lic'] != '')) {
						$this-> MAJ_num_lic($id_dos, $reponse['num_lic']);
					}
					if (isset($reponse['num_exo']) && ($reponse['num_exo'] != '')) {
						$this-> MAJ_num_exo($id_dos, $reponse['num_exo']);
					}
					if (isset($reponse['klsa_arriv']) && ($reponse['klsa_arriv'] != '')) {
						$this-> MAJ_klsa_arriv($id_dos, $reponse['klsa_arriv']);
					}
					if (isset($reponse['crossing_date']) && ($reponse['crossing_date'] != '')) {
						$this-> MAJ_crossing_date($id_dos, $reponse['crossing_date']);
					}

					if (isset($reponse['wiski_arriv']) && ($reponse['wiski_arriv'] != '')) {
						$this-> MAJ_wiski_arriv($id_dos, $reponse['wiski_arriv']);
					}
					if (isset($reponse['wiski_dep']) && ($reponse['wiski_dep'] != '')) {
						$this-> MAJ_wiski_dep($id_dos, $reponse['wiski_dep']);
					}
					if (isset($reponse['insp_report']) && ($reponse['insp_report'] != '')) {
						$this-> MAJ_insp_report($id_dos, $reponse['insp_report']);
					}
					if (isset($reponse['ir']) && ($reponse['ir'] != '')) {
						$this-> MAJ_ir($id_dos, $reponse['ir']);
					}
					if (isset($reponse['ref_crf']) && ($reponse['ref_crf'] != '')) {
						$this-> MAJ_ref_crf($id_dos, $reponse['ref_crf']);
					}
					if (isset($reponse['date_crf']) && ($reponse['date_crf'] != '')) {
						$this-> MAJ_date_crf($id_dos, $reponse['date_crf']);
					}
					if (isset($reponse['ref_decl']) && ($reponse['ref_decl'] != '')) {
						$this-> MAJ_ref_decl($id_dos, $reponse['ref_decl']);
					}
					if (isset($reponse['dgda_in']) && ($reponse['dgda_in'] != '')) {
						$this-> MAJ_dgda_in($id_dos, $reponse['dgda_in']);
					}
					if (isset($reponse['ref_liq']) && ($reponse['ref_liq'] != '')) {
						$this-> MAJ_ref_liq($id_dos, $reponse['ref_liq']);
					}
					if (isset($reponse['ref_quit']) && ($reponse['ref_quit'] != '')) {
						$this-> MAJ_ref_quit($id_dos, $reponse['ref_quit']);
					}
					if (isset($reponse['date_quit']) && ($reponse['date_quit'] != '')) {
						$this-> MAJ_date_quit($id_dos, $reponse['date_quit']);
					}
					if (isset($reponse['dgda_out']) && ($reponse['dgda_out'] != '')) {
						$this-> MAJ_dgda_out($id_dos, $reponse['dgda_out']);
					}

					if (isset($reponse['regul_ir']) && ($reponse['regul_ir'] != '')) {
						$this-> MAJ_regul_ir($id_dos, $reponse['regul_ir']);
					}
					if (isset($reponse['cleared']) && ($reponse['cleared'] != '')) {
						$this-> MAJ_cleared($id_dos, $reponse['cleared']);
					}
					if (isset($reponse['statut']) && ($reponse['statut'] != '')) {
						$this-> MAJ_statut($id_dos, $reponse['statut']);
					}
					if (isset($reponse['remarque']) && ($reponse['remarque'] != '')) {
						$this-> MAJ_remarque($id_dos, $reponse['remarque']);
					}

				}

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload_tracking
												SET etat = '1'
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}

		public function creerDateExpirationLicence($num_lic, $date_exp){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['date_exp'] = $date_exp;

			$requete = $connexion-> prepare('INSERT INTO expiration_licence(num_lic, date_exp, id_etat)
												VALUES(?, ?, 1)');
			$requete-> execute(array($entree['num_lic'], $entree['date_exp']));
		}

		// public function creerClient($nom_cli){
		// 	include('connexion.php');

		// 	$entree['nom_cli'] = $nom_cli;
		// 	//$entree['date_exp'] = $date_exp;

		// 	$requete = $connexion-> prepare('INSERT INTO client(nom_cli)
		// 										VALUES(?)');
		// 	$requete-> execute(array($entree['nom_cli']));
		// }

		public function creerAffectationLicenceModeleLicence($id_cli, $id_mod_lic){

			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("INSERT INTO affectation_client_modele_licence(id_cli, id_mod_lic)
														VALUES(?, ?)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

		}

		public function new_aff_module($id_util, $id_mod){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod'] = $id_mod;

			$requete = $connexion-> prepare('INSERT INTO affectation_utilisateur_module(id_util, id_mod)
												VALUES(?, ?)');
			$requete-> execute(array($entree['id_util'], $entree['id_mod']));
		}

		public function creerMonnaie($sig_mon){
			include('connexion.php');

			$entree['sig_mon'] = $sig_mon;
			//$entree['date_exp'] = $date_exp;

			$requete = $connexion-> prepare('INSERT INTO monnaie(nom_mon, sig_mon)
												VALUES(?, ?)');
			$requete-> execute(array($entree['sig_mon'], $entree['sig_mon']));
		}

		public function creerDocumentAppurement($fichier_doc, $num_lic, $id_util, $tmp, $banque, $ref_apure, $date_apure){
			include('connexion.php');

			$entree['fichier_doc'] = $fichier_doc;
			$entree['num_lic'] = $num_lic;
			$entree['id_util'] = $id_util;
			$entree['banque'] = $banque;
			$entree['ref_apure'] = $ref_apure;
			$entree['date_apure'] = $date_apure;

			/*echo '<br>fichier_doc = '.$fichier_doc;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>id_util = '.$id_util;*/

			$requete = $connexion-> prepare('INSERT INTO document_appurement(fichier_doc, num_lic, id_util, banque, ref_apure, date_apure)
												VALUES(?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['fichier_doc'], $entree['num_lic'], $entree['id_util'],
								$entree['banque'], $entree['ref_apure'], $entree['date_apure']));

			$dossier = '../dossiers/'.$num_lic;

			if (isset($tmp) && ($tmp!='')) {

				if(!is_dir($dossier)){
					mkdir("../dossiers/$num_lic", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_doc));

			}

		}

		public function creerTransmissionApurement($id_mod_lic, $fichier_trans_ap, $ref_trans_ap, $id_util, $tmp, $banque, $date_trans_ap, $id_cli, $id_type_apur=1){
			include('connexion.php');

			$entree['fichier_trans_ap'] = $fichier_trans_ap;
			$entree['ref_trans_ap'] = $ref_trans_ap;
			$entree['id_util'] = $id_util;
			$entree['banque'] = $banque;
			$entree['date_trans_ap'] = $date_trans_ap;
			$entree['id_cli'] = $id_cli;
			$entree['id_type_apur'] = $id_type_apur;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('INSERT INTO transmission_apurement(fichier_trans_ap, ref_trans_ap, id_util, banque, date_trans_ap, id_cli, id_type_apur, id_mod_lic)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['fichier_trans_ap'], $entree['ref_trans_ap'], $entree['id_util'],
								$entree['banque'], $entree['date_trans_ap'], $entree['id_cli'], $entree['id_type_apur'], $entree['id_mod_lic']));


		}

		public function creerTransmisFactureDossier($fichier_trans_fact, $ref_trans_fact, $id_util, $tmp, $date_trans_fact){
			include('connexion.php');

			$entree['fichier_trans_fact'] = $fichier_trans_fact;
			$entree['ref_trans_fact'] = $ref_trans_fact;
			$entree['id_util'] = $id_util;
			$entree['date_trans_fact'] = $date_trans_fact;

			/*echo '<br>fichier_trans_fact = '.$fichier_trans_fact;
			echo '<br>ref_trans_fact = '.$ref_trans_fact;
			echo '<br>id_util = '.$id_util;*/

			$requete = $connexion-> prepare('INSERT INTO transmis_facture_dossier(fichier_trans_fact, ref_trans_fact, id_util, date_trans_fact)
												VALUES(?, ?, ?, ?)');
			$requete-> execute(array($entree['fichier_trans_fact'], $entree['ref_trans_fact'], $entree['id_util'], $entree['date_trans_fact']));

			/*$dossier = '../dossiers/'.$ref_trans_ap;

			if (isset($tmp) && ($tmp!='')) {

				if(!is_dir($dossier)){
					mkdir("../dossiers/$ref_trans_ap", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$ref_trans_ap.'/' . basename($fichier_trans_ap));

			}*/

		}

		public function creerFacture($ref_fact, $date_fact, $date_fact_rec,
										$fournisseur, $date_val, $fichier_fact,
										$tmp_fact, $id_mod_lic, $id_cli, $commodity,
										$montant_fact, $id_mon, $fret_fact,
										$assurance_fact, $autre_frais_fact, $po_ref){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['date_fact'] = $date_fact;
			$entree['date_fact_rec'] = $date_fact_rec;
			$entree['fournisseur'] = $fournisseur;
			$entree['date_val'] = $date_val;
			$entree['fichier_fact'] = $fichier_fact;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['commodity'] = $commodity;
			$entree['montant_fact'] = $montant_fact;
			$entree['id_mon'] = $id_mon;
			$entree['fret_fact'] = $fret_fact;
			$entree['assurance_fact'] = $assurance_fact;
			$entree['autre_frais_fact'] = $autre_frais_fact;
			$entree['po_ref'] = $po_ref;

			/*echo '<br>ref_fact = '.$ref_fact;
			echo '<br>date_fact = '.$date_fact;
			echo '<br>date_fact_rec = '.$date_fact_rec;
			echo '<br>fournisseur= '.$fournisseur;
			echo '<br>date_val = '.$date_val;
			echo '<br>fichier_fact = '.$fichier_fact;
			echo '<br>id_mod_lic = '.$id_mod_lic;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>id_march = '.$id_march;*/

			$requete = $connexion-> prepare('INSERT INTO facture_licence(ref_fact, date_fact, date_fact_rec,
																		fournisseur, date_val, fichier_fact,
																		id_mod_lic, id_cli, commodity,
																		montant_fact, id_mon, fret_fact,
																		assurance_fact, autre_frais_fact, po_ref)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_fact'], $entree['date_fact'], $entree['date_fact_rec'],
									$entree['fournisseur'], $entree['date_val'], $entree['fichier_fact'],
									$entree['id_mod_lic'], $entree['id_cli'], $entree['commodity'],
									$entree['montant_fact'], $entree['id_mon'], $entree['fret_fact'],
									$entree['assurance_fact'], $entree['autre_frais_fact'], 
									$entree['po_ref']));

			$facture = '../factures/'.$ref_fact;

			if(!is_dir($facture)){
				mkdir("../factures/$ref_fact", 0777);
			}

			move_uploaded_file($tmp_fact, '../factures/'.$ref_fact.'/' . basename($fichier_fact));
		}

		public function edit_fichier_facture($ref_fact, $fichier_fact, $tmp_fact){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['fichier_fact'] = $fichier_fact;

			/*echo '<br>ref_fact = '.$ref_fact;
			echo '<br>date_fact = '.$date_fact;
			echo '<br>date_fact_rec = '.$date_fact_rec;
			echo '<br>fournisseur= '.$fournisseur;
			echo '<br>date_val = '.$date_val;
			echo '<br>fichier_fact = '.$fichier_fact;
			echo '<br>id_mod_lic = '.$id_mod_lic;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>id_march = '.$id_march;*/

			$requete = $connexion-> prepare('UPDATE facture_licence
												SET fichier_fact = ?
												WHERE ref_fact = ?');
			$requete-> execute(array($entree['fichier_fact'], $entree['ref_fact']));

			$facture = '../factures/'.$ref_fact;

			if(!is_dir($facture)){
				mkdir("../factures/$ref_fact", 0777);
			}

			move_uploaded_file($tmp_fact, '../factures/'.$ref_fact.'/' . basename($fichier_fact));
		}

		public function creerAV($cod, $date_av, $montant_av, 
								$fxi, $num_lic, $fichier_av, 
								$tmp_av, $id_util, $id_mon){
			include('connexion.php');

			$entree['ref_av'] = $cod;
			$entree['date_av'] = $date_av;
			$entree['montant_av'] = $montant_av;
			$entree['fxi'] = $fxi;
			$entree['num_lic'] = $num_lic;
			$entree['fichier_av'] = $fichier_av;
			$entree['id_util'] = $id_util;
			$entree['id_mon'] = $id_mon;

			/*echo '<br>cod = '.$cod;
			echo '<br>date_av = '.$date_av;
			echo '<br>montant_av = '.$montant_av;
			echo '<br>fxi= '.$fxi;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>fichier_av = '.$fichier_av;
			echo '<br>id_util = '.$id_util;
			echo '<br>id_mon = '.$id_mon;
			echo '<br>id_march = '.$id_march;*/

			$requete = $connexion-> prepare('INSERT INTO av(ref_av, date_av, montant_av, 
															fxi, num_lic, fichier_av, 
															id_util, id_mon)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_av'], $entree['date_av'], $entree['montant_av'], 
									$entree['fxi'], $entree['num_lic'], $entree['fichier_av'], 
									$entree['id_util'], $entree['id_mon']));

			/*$av = '../av/'.$fichier_av;

			if(!is_dir($av)){
				mkdir("../av/$fichier_av", 0777);
			}*/

			move_uploaded_file($tmp_av, '../av/' . basename($fichier_av));
		}
		

		public function getDataAv($cod){
			include('connexion.php');
			$entree['cod'] = $cod;

			$requete = $connexion-> prepare("SELECT *
												FROM av
												WHERE cod = ?");
			$requete-> execute(array($entree['cod']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getBanque($id_banq){
			include('connexion.php');
			$entree['id_banq'] = $id_banq;

			$requete = $connexion-> prepare("SELECT *
												FROM banque
												WHERE id_banq = ?");
			$requete-> execute(array($entree['id_banq']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getNomColonneClient($nom_champ, $id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');
			$entree['nom_champ'] = $nom_champ;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
												FROM colonne c, affectation_colonne_client_modele_licence aff
													WHERE c.champ_col = ?
														AND c.id_col = aff.id_col
														AND aff.id_mod_trans = ?
														AND aff.id_mod_lic = ?");
			$requete-> execute(array($entree['nom_champ'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['titre_col'];
			}
		}

		public function MAJ_codAllDossier($ref_av, $cod){

			include('connexion.php');
			$entree['ref_av'] = $ref_av;
			$entree['cod'] = $cod;
			/*
			?>
			<script type="text/javascript">
				alert("ref_av = <?php echo $ref_av;?> cod = <?php echo $cod;?>");
			</script>
			<?php
			*/
			$requete = $connexion-> prepare("UPDATE dossier SET cod = ?, montant_av = fob, fxi = ?
												WHERE ref_av = ?");
			$requete-> execute(array($entree['cod'], $this-> getDataAv($cod)['fxi'], $entree['ref_av']));

		} 

		public function creerAppurementLicence($id_dos, $id_doc, $id_util){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['id_doc'] = $id_doc;
			$entree['id_util'] = $id_util;

			/*echo '<br>id_dos = '.$id_dos;
			echo '<br>id_doc = '.$id_doc;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO appurement_licence(id_dos, id_doc, id_util)
												VALUES(?, ?, ?)');
			$requete-> execute(array($entree['id_dos'], $entree['id_doc'], $entree['id_util']));

		}

		public function creerDetailApurement($id_trans_ap, $id_dos){
			include('connexion.php');

			$entree['id_trans_ap'] = $id_trans_ap;
			$entree['id_dos'] = $id_dos;

			/*echo '<br>id_trans_ap = '.$id_trans_ap;
			echo '<br>id_dos = '.$id_dos;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO detail_apurement(id_trans_ap, id_dos)
												VALUES(?, ?)');
			$requete-> execute(array($entree['id_trans_ap'], $entree['id_dos']));

		}

		public function creerDetailTransmisFactureDossier($id_trans_fact, $ref_fact){
			include('connexion.php');

			$entree['id_trans_fact'] = $id_trans_fact;
			$entree['ref_fact'] = $ref_fact;

			/*echo '<br>id_trans_fact = '.$id_trans_fact;
			echo '<br>ref_fact = '.$ref_fact;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO detail_transmis_facture_dossier(id_trans_fact, ref_fact)
												VALUES(?, ?)');
			$requete-> execute(array($entree['id_trans_fact'], $entree['ref_fact']));

		}

		public function creerAppurementLicence2($id_dos, $id_doc, $id_util, $type_paie, $ref_apure, $date_apure, $banque){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['id_doc'] = $id_doc;
			$entree['id_util'] = $id_util;
			$entree['type_paie'] = $type_paie;
			$entree['ref_apure'] = $ref_apure;
			$entree['date_apure'] = $date_apure;
			$entree['banque'] = $banque;

			echo '<br>id_dos = '.$id_dos;
			echo '<br>id_doc = '.$id_doc;
			echo '<br>id_util = '.$id_util;
			echo '<br>type_paie = '.$type_paie;
			echo '<br>ref_apure = '.$ref_apure;
			echo '<br>date_apure = '.$date_apure;
			echo '<br>banque = '.$banque;
			echo '---------<br>';
			$requete = $connexion-> prepare('INSERT INTO appurement_licence(id_dos, id_doc, id_util,
																type_paie, ref_apure, date_apure, banque)
												VALUES(?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['id_dos'], $entree['id_doc'], $entree['id_util'], $entree['type_paie'],
									$entree['ref_apure'], $entree['date_apure'], $entree['banque']));

		}

		public function creerDossierEB($ref_dos, $id_cli, $num_lic, $id_march, $id_mod_lic,
										$id_mod_trans, $id_util, $num_lot, $horse, $trailer_1,
										$trailer_2, $site_load, $destination, $transporter,
										$nbr_bags, $poids, $load_date){
			include('connexion.php');

			$entree['ref_dos'] = $ref_dos;
			$entree['id_cli'] = $id_cli;
			$entree['num_lic'] = $num_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_util'] = $id_util;
			$entree['num_lot'] = $num_lot;
			$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;
			$entree['site_load'] = $site_load;
			$entree['destination'] = $destination;
			$entree['transporter'] = $transporter;
			$entree['nbr_bags'] = $nbr_bags;
			$entree['poids'] = $poids;
			$entree['load_date'] = $load_date;

			/*echo '<br>ref_dos = '.$ref_dos;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>id_march = '.$id_march;
			echo '<br>id_mod_lic = '.$id_mod_lic;
			echo '<br>id_mod_trans = '.$id_mod_trans;
			echo '<br>id_util = '.$id_util;
			echo '<br>num_lot = '.$num_lot;
			echo '<br>horse = '.$horse;
			echo '<br>trailer_1 = '.$trailer_1;
			echo '<br>trailer_2 = '.$trailer_2;
			echo '<br>site_load = '.$site_load;
			echo '<br>destination = '.$destination;
			echo '<br>transporter = '.$transporter;
			echo '<br>nbr_bags = '.$nbr_bags;
			echo '<br>poids = '.$poids;
			echo '<br>load_date = '.$load_date;
			echo '---------------<br>';*/

			if($entree['load_date'] == '' || (!isset($entree['load_date'])) ){
				$entree['load_date'] = NULL;
			}

			if($entree['poids'] == '' || (!isset($entree['poids'])) ){
				$entree['poids'] = NULL;
			}

			if($entree['nbr_bags'] == '' || (!isset($entree['nbr_bags'])) ){
				$entree['nbr_bags'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, num_lic, id_march,
																	id_mod_lic, id_mod_trans, id_util,
																	num_lot, horse, trailer_1, trailer_2,
																	site_load, destination, transporter,
																	nbr_bags, poids, load_date)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['num_lic'],
									$entree['id_march'], $entree['id_mod_lic'], $entree['id_mod_trans'],
									$entree['id_util'], $entree['num_lot'], $entree['horse'],
									$entree['trailer_1'], $entree['trailer_2'], $entree['site_load'],
									$entree['destination'], $entree['transporter'], $entree['nbr_bags'],
									$entree['poids'], $entree['load_date']));

		}

		public function creerDossierIB($ref_dos, $id_cli, $ref_fact, $fob,
										$fret, $assurance, $autre_frais, $num_lic,
										$id_mod_lic, $id_march, $id_mod_trans,
										$ref_av, $cod, $id_util, $road_manif, $date_preal,
										$t1, $poids,$po_ref,
										$commodity, $horse, $trailer_1, $trailer_2, $ref_crf,
										$date_crf, $bond_warehouse='KOLWEZI'){
			include('connexion.php');

			/*echo '<br> ref_dos = '.$ref_dos;echo '<br> id_cli = '.$id_cli;
			echo '<br> ref_fact = '.$ref_fact;echo '<br> fob = '.$fob;
			echo '<br> fret = '.$fret;echo '<br> assurance = '.$assurance;
			echo '<br> autre_frais = '.$autre_frais;echo '<br> num_lic = '.$num_lic;
			echo '<br> id_mod_lic = '.$id_mod_lic;*/
			//echo '<br> id_mod_lic = '.$id_mod_lic;

			if ($id_cli != '845' && $id_cli != '856' && $id_cli != '857' && $id_cli != '863' && $id_cli != '864') {
				$bond_warehouse = NULL;
			}

			$entree['ref_dos'] = $ref_dos; $entree['id_cli'] = $id_cli; $entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob; $entree['fret'] = $fret; $entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais; $entree['num_lic'] = $num_lic;
			$entree['id_mod_lic'] = $id_mod_lic; $entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_av'] = $ref_av;
			$entree['cod'] = $cod;
			$entree['id_util'] = $id_util;
			$entree['road_manif'] = $road_manif;$entree['date_preal'] = $date_preal;
			$entree['t1'] = $t1;$entree['poids'] = $poids;
			$entree['fret'] = $fret;$entree['po_ref'] = $po_ref;
			$entree['commodity'] = $commodity;$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;$entree['trailer_2'] = $trailer_2;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;
			$entree['bond_warehouse'] = $bond_warehouse;

			if($entree['date_preal'] == '' || (!isset($entree['date_preal'])) ){
				$entree['date_preal'] = NULL;
			}

			if($entree['fob'] == '' || (!isset($entree['fob'])) ){
				$entree['fob'] = NULL;
			}

			if($entree['fret'] == '' || (!isset($entree['fret'])) ){
				$entree['fret'] = NULL;
			}

			if($entree['assurance'] == '' || (!isset($entree['assurance'])) ){
				$entree['assurance'] = NULL;
			}

			if($entree['autre_frais'] == '' || (!isset($entree['autre_frais'])) ){
				$entree['autre_frais'] = NULL;
			}

			if($entree['poids'] == '' || (!isset($entree['poids'])) ){
				$entree['poids'] = NULL;
			}

			if($entree['date_crf'] == '' || (!isset($entree['date_crf'])) ){
				$entree['date_crf'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, ref_dos_2, id_cli, ref_fact, fob,
																fret, assurance, autre_frais, num_lic,
																id_mod_lic, id_march, id_mod_trans,
																ref_av,cod, id_util, road_manif,
																date_preal, t1, poids,
																po_ref, commodity, horse,
																trailer_1, trailer_2,
																ref_crf, date_crf, bond_warehouse)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,
														?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 
														?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['ref_dos'], $entree['id_cli'], $entree['ref_fact'],
									$entree['fob'], $entree['fret'], $entree['assurance'],
									$entree['autre_frais'], $entree['num_lic'], $entree['id_mod_lic'],
									$entree['id_march'], $entree['id_mod_trans'],
									$entree['ref_av'], $entree['cod'], $entree['id_util'],
									$entree['road_manif'], $entree['date_preal'], $entree['t1'],
									$entree['poids'], $entree['po_ref'], $entree['commodity'],
									$entree['horse'], $entree['trailer_1'], $entree['trailer_2'],
									$entree['ref_crf'], $entree['date_crf'], $entree['bond_warehouse']));
		}

		public function creerDossierIBDivers($ref_dos, $id_cli, $ref_fact, $fob,
										$fret, $assurance, $autre_frais, $num_lic,
										$id_mod_lic, $id_march, $id_mod_trans,
										$ref_av, $cod, $id_util, $road_manif, $date_preal,
										$t1, $poids,$po_ref,
										$commodity, $horse, $trailer_1, $trailer_2, $ref_crf,
										$date_crf, $bond_warehouse=NULL){
			include('connexion.php');

			/*echo '<br> ref_dos = '.$ref_dos;echo '<br> id_cli = '.$id_cli;
			echo '<br> ref_fact = '.$ref_fact;echo '<br> fob = '.$fob;
			echo '<br> fret = '.$fret;echo '<br> assurance = '.$assurance;
			echo '<br> autre_frais = '.$autre_frais;echo '<br> num_lic = '.$num_lic;
			echo '<br> id_mod_lic = '.$id_mod_lic;*/
			//echo '<br> id_mod_lic = '.$id_mod_lic;

			if ($id_cli != '845' && $id_cli != '856' && $id_cli != '857' && $id_cli != '863' && $id_cli != '864') {
				$bond_warehouse = NULL;
			}

			$entree['ref_dos'] = $ref_dos; $entree['id_cli'] = $id_cli; $entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob; $entree['fret'] = $fret; $entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais; $entree['num_lic'] = $num_lic;
			$entree['id_mod_lic'] = $id_mod_lic; $entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_av'] = $ref_av;
			$entree['cod'] = $cod;
			$entree['id_util'] = $id_util;
			$entree['road_manif'] = $road_manif;$entree['date_preal'] = $date_preal;
			$entree['t1'] = $t1;$entree['poids'] = $poids;
			$entree['fret'] = $fret;$entree['po_ref'] = $po_ref;
			$entree['commodity'] = $commodity;$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;$entree['trailer_2'] = $trailer_2;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;
			$entree['bond_warehouse'] = $bond_warehouse;

			if($entree['date_preal'] == '' || (!isset($entree['date_preal'])) ){
				$entree['date_preal'] = NULL;
			}

			if($entree['fob'] == '' || (!isset($entree['fob'])) ){
				$entree['fob'] = NULL;
			}

			if($entree['fret'] == '' || (!isset($entree['fret'])) ){
				$entree['fret'] = NULL;
			}

			if($entree['assurance'] == '' || (!isset($entree['assurance'])) ){
				$entree['assurance'] = NULL;
			}

			if($entree['autre_frais'] == '' || (!isset($entree['autre_frais'])) ){
				$entree['autre_frais'] = NULL;
			}

			if($entree['poids'] == '' || (!isset($entree['poids'])) ){
				$entree['poids'] = NULL;
			}

			if($entree['date_crf'] == '' || (!isset($entree['date_crf'])) ){
				$entree['date_crf'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, ref_fact, fob,
																fret, assurance, autre_frais, num_lic,
																id_mod_lic, id_march, id_mod_trans,
																ref_av,cod, id_util, road_manif,
																date_preal, t1, poids,
																po_ref, commodity, horse,
																trailer_1, trailer_2,
																ref_crf, date_crf, bond_warehouse)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,
														?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['ref_fact'],
									$entree['fob'], $entree['fret'], $entree['assurance'],
									$entree['autre_frais'], $entree['num_lic'], $entree['id_mod_lic'],
									$entree['id_march'], $entree['id_mod_trans'],
									$entree['ref_av'], $entree['cod'], $entree['id_util'],
									$entree['road_manif'], $entree['date_preal'], $entree['t1'],
									$entree['poids'], $entree['po_ref'], $entree['commodity'],
									$entree['horse'], $entree['trailer_1'], $entree['trailer_2'],
									$entree['ref_crf'], $entree['date_crf'], $entree['bond_warehouse']));
		}

		public function creerDossierIBDivers2($ref_dos, $id_cli, $num_lic,
										$id_mod_lic, $id_mod_trans, $id_util){
			include('connexion.php');

			$entree['ref_dos']=$ref_dos;
			$entree['id_cli']=$id_cli;
			$entree['num_lic']=$num_lic;
			$entree['id_mod_lic']=$id_mod_lic;
			$entree['id_mod_trans']=$id_mod_trans;
			$entree['id_util']=$id_util;

			echo '<br><br>ref_dos = '.$ref_dos.'\'';
			echo '<br>id_cli = '.$id_cli.'\'';
			echo '<br>num_lic = '.$num_lic.'\'';
			echo '<br>id_mod_lic = '.$id_mod_lic.'\'';
			echo '<br>id_mod_trans = '.$id_mod_trans.'\'';
			echo '<br>id_util = '.$id_util.'<br>';

			// $requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, num_lic, id_mod_lic, id_mod_trans, id_util)
			// 									VALUES(?, ?, ?, ?, ?, ?)');
			// $requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['num_lic'],
			// 						$entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_util']));

		}

		public function creerDossierDiversIB($ref_dos, $ref_dos_2, $id_cli, $num_lic,
											$id_mod_lic, $id_mod_trans, $id_util, 
											$date_preal, $date_ouvert, $road_manif, 
											$reg_dgda, $ref_fact, $supplier, $ref_av, $fxi, $commodity, 
											$origine, $nbr_bags, $provenance, $last_provenance, 
											$bur_douane, $front_in, $transporter, $horse, 
											$trailer_1, $trailer_2, $dgda_seal, $id_march, $id_emb, 
											$poids, $poids_brut, $fob, $fret, $assurance, $autre_frais, $id_taux_e, 
											$code_tarif_march=NULL){
			include('connexion.php');

			$entree['ref_dos'] = strval($ref_dos);
			$entree['ref_dos_2'] = strval($ref_dos_2);
			$entree['id_cli'] = $id_cli;
			$entree['num_lic'] = $num_lic;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_util'] = $id_util;
			$entree['date_preal'] = $date_preal;
			$entree['date_ouvert'] = $date_ouvert;
			$entree['road_manif'] = $road_manif;
			$entree['reg_dgda'] = $reg_dgda;
			$entree['ref_fact'] = $ref_fact;
			$entree['supplier'] = $supplier;
			$entree['ref_av'] = $ref_av;
			$entree['fxi'] = $fxi;
			$entree['commodity'] = $commodity;
			$entree['origine'] = $origine;
			$entree['nbr_bags'] = $nbr_bags;
			$entree['provenance'] = $provenance;
			$entree['last_provenance'] = $last_provenance;
			$entree['bur_douane'] = $bur_douane;
			$entree['front_in'] = $front_in;
			$entree['transporter'] = $transporter;
			$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;
			$entree['dgda_seal'] = $dgda_seal;
			$entree['id_march'] = $id_march;
			$entree['id_emb'] = $id_emb;
			$entree['poids'] = $poids;
			$entree['poids_brut'] = $poids_brut;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['id_t_dos'] = '2';
			$entree['id_taux_e'] = $id_taux_e;
			$entree['code_tarif_march'] = $code_tarif_march;

			if ($entree['ref_dos']==$entree['ref_dos_2']) {
				$entree['principal'] = '1';
			}else{
				$entree['principal'] = '0';
			}

			// echo '<br>----------------------------<br>';
			// echo '<br>ref_dos = '.$ref_dos;
			// echo '<br>ref_dos_2 = '.$ref_dos_2;
			// echo '<br>id_cli = '.$id_cli;
			// echo '<br>num_lic = '.$num_lic;
			// echo '<br>id_mod_lic = '.$id_mod_lic;
			// echo '<br>id_mod_trans = '.$id_mod_trans;
			// echo '<br>id_util = '.$id_util;
			// echo '<br>date_preal = '.$date_preal;
			// echo '<br>date_ouvert = '.$date_ouvert;
			// echo '<br>road_manif = '.$road_manif;
			// echo '<br>reg_dgda = '.$reg_dgda;
			// echo '<br>ref_fact = '.$ref_fact;
			// echo '<br>ref_av = '.$ref_av;
			// echo '<br>fxi = '.$fxi;
			// echo '<br>commodity = '.$commodity;
			// echo '<br>origine = '.$origine;
			// echo '<br>nbr_bags = '.$nbr_bags;
			// echo '<br>provenance = '.$provenance;
			// echo '<br>last_provenance = '.$last_provenance;
			// echo '<br>bur_douane = '.$bur_douane;
			// echo '<br>front_in = '.$front_in;
			// echo '<br>transporter = '.$transporter;
			// echo '<br>horse = '.$horse;
			// echo '<br>trailer_1 = '.$trailer_1;
			// echo '<br>trailer_2 = '.$trailer_2;
			// echo '<br>dgda_seal = '.$dgda_seal;
			// echo '<br>id_march = '.$id_march;
			// echo '<br>id_emb = '.$id_emb;
			// echo '<br>id_t_dos = '.$entree['id_t_dos'];
			// echo '<br>principal = '.$entree['principal'];
			// echo '<br>poids = '.$poids;
			// echo '<br>poids_brut = '.$poids_brut;
			// echo '<br>fob = '.$fob;
			// echo '<br>fret = '.$fret;
			// echo '<br>assurance = '.$assurance;
			// echo '<br>autre_frais = '.$autre_frais;

			$requete = $connexion-> prepare("INSERT INTO dossier(ref_dos, ref_dos_2, id_cli, num_lic,
																id_mod_lic, id_mod_trans, id_util, 
																date_preal, date_ouvert, road_manif, 
																reg_dgda, ref_fact, supplier, ref_av, fxi, commodity, 
																origine, nbr_bags, provenance, last_provenance, 
																bur_douane, front_in, transporter, horse, trailer_1, 
																trailer_2, dgda_seal, id_march, id_emb, id_t_dos, principal, poids, poids_brut, fob, fret, assurance, autre_frais, 
																id_taux_e, code_tarif_march)
													VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 
															?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 
															?, ?, ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['ref_dos'], $entree['ref_dos_2'], $entree['id_cli'], $entree['num_lic'],
								$entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_util'], 
								$entree['date_preal'], $entree['date_ouvert'], $entree['road_manif'], 
								$entree['reg_dgda'], $entree['ref_fact'], $entree['supplier'], $entree['ref_av'],  
								$entree['fxi'], 
								$entree['commodity'], $entree['origine'], $entree['nbr_bags'], $entree['provenance'], 
								$entree['last_provenance'], $entree['bur_douane'], $entree['front_in'], $entree['transporter'], 
								$entree['horse'], $entree['trailer_1'], $entree['trailer_2'], $entree['dgda_seal'], 
								$entree['id_march'], $entree['id_emb'], $entree['id_t_dos'], $entree['principal'], 
								$entree['poids'], $entree['poids_brut'], $entree['fob'], $entree['fret'], 
								$entree['assurance'], $entree['autre_frais'], $entree['id_taux_e'], 
								$entree['code_tarif_march']));
		}

		public function creerDossierIB2($ref_dos, $id_cli, $ref_fact, $fob,
										$fret, $assurance, $autre_frais, $num_lic,
										$id_mod_lic, $id_march, $id_mod_trans,
										$ref_av, $cod, $fxi, $montant_av, $date_fact, $ref_decl,
										$montant_decl, $ref_liq, $id_util, $ref_quit, $date_quit){
			include('connexion.php');

			/*echo '<br> ref_dos = '.$ref_dos;echo '<br> id_cli = '.$id_cli;
			echo '<br> ref_fact = '.$ref_fact;echo '<br> fob = '.$fob;
			echo '<br> fret = '.$fret;echo '<br> assurance = '.$assurance;
			echo '<br> autre_frais = '.$autre_frais;echo '<br> num_lic = '.$num_lic;
			echo '<br> id_mod_lic = '.$id_mod_lic;*/
			//echo '<br> id_mod_lic = '.$id_mod_lic;

			$entree['ref_dos'] = $ref_dos; $entree['id_cli'] = $id_cli; $entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob; $entree['fret'] = $fret; $entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais; $entree['num_lic'] = $num_lic;
			$entree['id_mod_lic'] = $id_mod_lic; $entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_av'] = $ref_av;
			$entree['cod'] = $cod;$entree['fxi'] = $fxi;
			$entree['montant_av'] = $montant_av;$entree['date_fact'] = $date_fact;
			$entree['ref_decl'] = $ref_decl;$entree['montant_decl'] = $montant_decl;
			$entree['ref_liq'] = $ref_liq;$entree['id_util'] = $id_util;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;

			if($entree['date_fact'] == '' || (strlen($entree['date_fact']) != 10) ){
				$entree['date_fact'] = NULL;
			}

			if($entree['date_quit'] == '' || (strlen($entree['date_quit']) != 10) ){
				$entree['date_quit'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, ref_fact, fob,
																fret, assurance, autre_frais, num_lic,
																id_mod_lic, id_march, id_mod_trans, ref_av,cod,
																fxi, montant_av, date_fact, ref_decl, montant_decl, ref_liq, id_util, ref_quit, date_quit)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,
														?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['ref_fact'],
									$entree['fob'], $entree['fret'], $entree['assurance'],
									$entree['autre_frais'], $entree['num_lic'], $entree['id_mod_lic'],
									$entree['id_march'], $entree['id_mod_trans'],
									$entree['ref_av'], $entree['cod'], $entree['fxi'],
									$entree['montant_av'], $entree['date_fact'], $entree['ref_decl'],
									$entree['montant_decl'], $entree['ref_liq'], $entree['id_util'],
									$entree['ref_quit'], $entree['date_quit']));
		}

		public function creerDossierIBTrackingKlsa($ref_dos, $id_cli, $t1, $poids,
										$ref_fact, $horse, $trailer_1, $trailer_2,
										$transporteur, $destination, $id_mod_trans,
										$arrival_date, $crossing_date, $wiski_arriv,
										$wiski_dep, $remarque, $id_util, $id_mod_lic,
										$num_lic){
			include('connexion.php');

			/*echo '<br> ref_dos = '.$ref_dos;echo '<br> id_cli = '.$id_cli;
			echo '<br> t1 = '.$t1;echo '<br> poids = '.$poids;
			echo '<br> ref_fact = '.$ref_fact;echo '<br> horse = '.$horse;
			echo '<br> trailer_1 = '.$trailer_1;echo '<br> trailer_2 = '.$trailer_2;
			echo '<br> transporteur = '.$transporteur;echo '<br> destination = '.$destination;
			echo '<br> id_mod_trans = '.$id_mod_trans;echo '<br> arrival_date = '.$arrival_date;
			echo '<br> crossing_date = '.$crossing_date;echo '<br> wiski_arriv = '.$wiski_arriv;
			echo '<br> wiski_dep = '.$wiski_dep;echo '<br> remarque = '.$remarque;
			echo '<br> id_util = '.$id_util;echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br><br>------------';*/
			//echo '<br> transporteur = '.$transporteur;

			$entree['ref_dos'] = $ref_dos; $entree['id_cli'] = $id_cli; $entree['t1'] = $t1;
			$entree['poids'] = $poids; $entree['ref_fact'] = $ref_fact; $entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1; $entree['trailer_2'] = $trailer_2;
			$entree['transporteur'] = $transporteur; $entree['destination'] = $destination;
			$entree['id_mod_trans'] = $id_mod_trans;$entree['arrival_date'] = $arrival_date;
			$entree['crossing_date'] = $crossing_date;$entree['wiski_arriv'] = $wiski_arriv;
			$entree['wiski_dep'] = $wiski_dep;$entree['remarque'] = $remarque;
			$entree['id_util'] = $id_util; $entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = $num_lic;

			if($entree['arrival_date'] == '' || (strlen($entree['arrival_date']) != 10) ){
				$entree['arrival_date'] = NULL;
			}

			if($entree['crossing_date'] == '' || (strlen($entree['crossing_date']) != 10) ){
				$entree['crossing_date'] = NULL;
			}

			if($entree['wiski_arriv'] == '' || (strlen($entree['wiski_arriv']) != 10) ){
				$entree['wiski_arriv'] = NULL;
			}

			if($entree['wiski_dep'] == '' || (strlen($entree['wiski_dep']) != 10) ){
				$entree['wiski_dep'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, t1, poids,
																ref_fact, horse, trailer_1, trailer_2,
																transporteur, destination, id_mod_trans, arrival_date,crossing_date,
																wiski_arriv, wiski_dep, remarque, id_util,
																id_mod_lic, num_lic)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,
														?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['t1'],
									$entree['poids'], $entree['ref_fact'], $entree['horse'],
									$entree['trailer_1'], $entree['trailer_2'], $entree['transporteur'],
									$entree['destination'], $entree['id_mod_trans'],
									$entree['arrival_date'], $entree['crossing_date'], $entree['wiski_arriv'],
									$entree['wiski_dep'], $entree['remarque'], $entree['id_util'],
									$entree['id_mod_lic'], $entree['num_lic']));
		}

		public function creerDossierEBUpload($ref_dos, $num_lic, $ship_num, $barge, $horse, $trailer_1, $trailer_2, $num_lot, $nbr_bags, $poids, $kapulo_load, $dispatch_pweto, $arrival_pweto, $barge_load, $barge_dispatch_date, $doc_receiv, $nbre_seal, $dgda_seal, $remarque, $transporter, $load_date, $pv_mine, $demande_attestation, $assay_date, $ceec_in, $ceec_out, $min_div_in, $min_div_out, $date_decl, $dgda_in, $date_liq, $date_quit, $dgda_out, $gov_in, $gov_out, $dispatch_date, $klsa_arriv, $end_form, $exit_drc, $cleared, $statut, $site_load, $destination, $ref_decl, $ref_liq, $ref_quit, $impala_sncc, $docs_sncc, $sncc_sakania, $sakania_date, $id_cli, $id_util, $id_mod_trans){
			include('connexion.php');

			/*echo '<br> ref_dos = '.$ref_dos;echo '<br> id_cli = '.$id_cli;
			echo '<br> t1 = '.$t1;echo '<br> poids = '.$poids;
			echo '<br> ref_fact = '.$ref_fact;echo '<br> horse = '.$horse;
			echo '<br> trailer_1 = '.$trailer_1;echo '<br> trailer_2 = '.$trailer_2;
			echo '<br> transporter = '.$transporter;echo '<br> destination = '.$destination;
			echo '<br> id_mod_trans = '.$id_mod_trans;echo '<br> arrival_date = '.$arrival_date;
			echo '<br> crossing_date = '.$crossing_date;echo '<br> wiski_arriv = '.$wiski_arriv;
			echo '<br> wiski_dep = '.$wiski_dep;echo '<br> remarque = '.$remarque;
			echo '<br> id_util = '.$id_util;echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br><br>------------';*/
			//echo '<br> transporter = '.$transporter;

			if (strpos(strtoupper($cleared), 'CLEARED') !== false) {
			    $cleared = '1';
			}else if (strpos(strtoupper($cleared), 'TRANSIT') !== false) {
			    $cleared = '0';
			}else if (strpos(strtoupper($cleared), 'PROCESS') !== false) {
			    $cleared = '0';
			}else if (strpos(strtoupper($cleared), 'CANCEL') !== false) {
			    $cleared = '2';
			}else{
				$cleared = '0';
			}

			/*echo $ref_dos.'  '.$num_lic.'  '.$ship_num.'  '.$barge.'  '.$horse.'  '.$trailer_1.'  '.$trailer_2.'  '.$num_lot.'  '.$nbr_bags.'  '.$poids.'  '.$kapulo_load.'  '.$dispatch_pweto.'  '.$arrival_pweto.'  '.$barge_load.'  '.$barge_dispatch_date.'  '.$doc_receiv.'  '.$nbre_seal.'  '.$dgda_seal.'  '.$remarque.'  '.$transporter.'  '.$load_date.'  '.$pv_mine.'  '.$demande_attestation.'  '.$assay_date.'  '.$ceec_in.'  '.$ceec_out.'  '.$min_div_in.'  '.$min_div_out.'  '.$date_decl.'  '.$dgda_in.'  '.$date_liq.'  '.$date_quit.'  '.$dgda_out.'  '.$gov_in.'  '.$gov_out.'  '.$dispatch_date.'  '.$klsa_arriv.'  '.$end_form.'  '.$exit_drc.'  CL = '.$cleared.'  '.$statut.'  '.$site_load.'  '.$destination.'  '.$ref_decl.'  '.$ref_liq.'  '.$ref_quit.'  '.$impala_sncc.'  '.$docs_sncc.'  '.$sncc_sakania.'  '.$sakania_date.'  '.$id_cli.'  '.$id_util.'  '.$id_mod_trans.'<br>---------<br>';*/
			/*if (str_contains(strtoupper($cleared), 'CLEARED')) {
				$cleared = '1';
			}else if (str_contains(strtoupper($cleared), 'TRANSIT')) {
				$cleared = '0';
			}else if (str_contains(strtoupper($cleared), 'CANCEL')) {
				$cleared = '2';
			}else{
				$cleared = '0';
			}*/

			$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['ship_num'] = $ship_num;$entree['barge'] = $barge;
			$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['num_lot'] = $num_lot;
			$entree['nbr_bags'] = $nbr_bags;$entree['poids'] = $poids;
			$entree['kapulo_load'] = $kapulo_load;$entree['dispatch_pweto'] = $dispatch_pweto;
			$entree['arrival_pweto'] = $arrival_pweto;$entree['barge_load'] = $barge_load;
			$entree['barge_dispatch_date'] = $barge_dispatch_date;$entree['doc_receiv'] = $doc_receiv;
			$entree['nbre_seal'] = $nbre_seal;$entree['dgda_seal'] = $dgda_seal;
			$entree['remarque'] = $remarque;$entree['transporter'] = $transporter;
			$entree['load_date'] = $load_date;$entree['pv_mine'] = $pv_mine;
			$entree['demande_attestation'] = $demande_attestation;$entree['assay_date'] = $assay_date;
			$entree['ceec_in'] = $ceec_in;$entree['ceec_out'] = $ceec_out;
			$entree['min_div_in'] = $min_div_in;$entree['min_div_out'] = $min_div_out;
			$entree['date_decl'] = $date_decl;$entree['dgda_in'] = $dgda_in;
			$entree['date_liq'] = $date_liq;$entree['date_quit'] = $date_quit;
			$entree['dgda_out'] = $dgda_out;$entree['gov_in'] = $gov_in;
			$entree['gov_out'] = $gov_out;$entree['dispatch_date'] = $dispatch_date;
			$entree['klsa_arriv'] = $klsa_arriv;$entree['end_form'] = $end_form;
			$entree['exit_drc'] = $exit_drc;$entree['cleared'] = $cleared;
			$entree['statut'] = $statut;$entree['site_load'] = $site_load;
			$entree['destination'] = $destination;$entree['ref_decl'] = $ref_decl;
			$entree['ref_liq'] = $ref_liq;$entree['impala_sncc'] = $impala_sncc;
			$entree['ref_quit'] = $ref_quit;$entree['docs_sncc'] = $docs_sncc;
			$entree['sncc_sakania'] = $sncc_sakania;$entree['sakania_date'] = $sakania_date;
			$entree['id_cli'] = $id_cli; $entree['id_util'] = $id_util;
			$entree['id_mod_trans'] = $id_mod_trans; //$entree['id_mod_lic'] = $id_mod_lic;


			if($entree['kapulo_load'] == '' || (strlen($entree['kapulo_load']) != 10) ){
				$entree['kapulo_load'] = NULL;
			}

			if($entree['dispatch_pweto'] == '' || (strlen($entree['dispatch_pweto']) != 10) ){
				$entree['dispatch_pweto'] = NULL;
			}

			if($entree['arrival_pweto'] == '' || (strlen($entree['arrival_pweto']) != 10) ){
				$entree['arrival_pweto'] = NULL;
			}

			if($entree['barge_load'] == '' || (strlen($entree['barge_load']) != 10) ){
				$entree['barge_load'] = NULL;
			}

			if($entree['barge_dispatch_date'] == '' || (strlen($entree['barge_dispatch_date']) != 10) ){
				$entree['barge_dispatch_date'] = NULL;
			}

			if($entree['load_date'] == '' || (strlen($entree['load_date']) != 10) ){
				$entree['load_date'] = NULL;
			}

			if($entree['pv_mine'] == '' || (strlen($entree['pv_mine']) != 10) ){
				$entree['pv_mine'] = NULL;
			}

			if($entree['demande_attestation'] == '' || (strlen($entree['demande_attestation']) != 10) ){
				$entree['demande_attestation'] = NULL;
			}

			if($entree['assay_date'] == '' || (strlen($entree['assay_date']) != 10) ){
				$entree['assay_date'] = NULL;
			}

			if($entree['ceec_in'] == '' || (strlen($entree['ceec_in']) != 10) ){
				$entree['ceec_in'] = NULL;
			}

			if($entree['ceec_out'] == '' || (strlen($entree['ceec_out']) != 10) ){
				$entree['ceec_out'] = NULL;
			}

			if($entree['min_div_in'] == '' || (strlen($entree['min_div_in']) != 10) ){
				$entree['min_div_in'] = NULL;
			}

			if($entree['min_div_out'] == '' || (strlen($entree['min_div_out']) != 10) ){
				$entree['min_div_out'] = NULL;
			}

			if($entree['date_decl'] == '' || (strlen($entree['date_decl']) != 10) ){
				$entree['date_decl'] = NULL;
			}

			if($entree['dgda_in'] == '' || (strlen($entree['dgda_in']) != 10) ){
				$entree['dgda_in'] = NULL;
			}

			if($entree['date_liq'] == '' || (strlen($entree['date_liq']) != 10) ){
				$entree['date_liq'] = NULL;
			}

			if($entree['date_quit'] == '' || (strlen($entree['date_quit']) != 10) ){
				$entree['date_quit'] = NULL;
			}

			if($entree['dgda_out'] == '' || (strlen($entree['dgda_out']) != 10) ){
				$entree['dgda_out'] = NULL;
			}

			if($entree['gov_in'] == '' || (strlen($entree['gov_in']) != 10) ){
				$entree['gov_in'] = NULL;
			}

			if($entree['gov_out'] == '' || (strlen($entree['gov_out']) != 10) ){
				$entree['gov_out'] = NULL;
			}

			if($entree['dispatch_date'] == '' || (strlen($entree['dispatch_date']) != 10) ){
				$entree['dispatch_date'] = NULL;
			}

			if($entree['klsa_arriv'] == '' || (strlen($entree['klsa_arriv']) != 10) ){
				$entree['klsa_arriv'] = NULL;
			}

			if($entree['exit_drc'] == '' || (strlen($entree['exit_drc']) != 10) ){
				$entree['exit_drc'] = NULL;
			}

			if($entree['end_form'] == '' || (strlen($entree['end_form']) != 10) ){
				$entree['end_form'] = NULL;
			}

			if($entree['impala_sncc'] == '' || (strlen($entree['impala_sncc']) != 10) ){
				$entree['impala_sncc'] = NULL;
			}

			if($entree['docs_sncc'] == '' || (strlen($entree['docs_sncc']) != 10) ){
				$entree['docs_sncc'] = NULL;
			}

			if($entree['sncc_sakania'] == '' || (strlen($entree['sncc_sakania']) != 10) ){
				$entree['sncc_sakania'] = NULL;
			}

			if($entree['sakania_date'] == '' || (strlen($entree['sakania_date']) != 10) ){
				$entree['sakania_date'] = NULL;
			}

			if($entree['doc_receiv'] == '' || (strlen($entree['doc_receiv']) != 10) ){
				$entree['doc_receiv'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, num_lic, ship_num, barge, horse, trailer_1, trailer_2, num_lot, nbr_bags, poids, kapulo_load, dispatch_pweto, arrival_pweto, barge_load, barge_dispatch_date, doc_receiv, nbre_seal, dgda_seal, remarque, transporter, load_date, pv_mine, demande_attestation, assay_date, ceec_in, ceec_out, min_div_in, min_div_out, date_decl, dgda_in, date_liq, date_quit, dgda_out, gov_in, gov_out, dispatch_date, klsa_arriv, end_form, exit_drc, cleared, statut, site_load, destination, ref_decl, ref_liq, ref_quit, impala_sncc, docs_sncc, sncc_sakania, sakania_date, id_cli, id_util, id_mod_trans, id_mod_lic)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, ?,
													?, ?, 1)');
			$requete-> execute(array($entree['ref_dos'], $entree['num_lic'], $entree['ship_num'], $entree['barge'], $entree['horse'], $entree['trailer_1'], $entree['trailer_2'], $entree['num_lot'], $entree['nbr_bags'], $entree['poids'], $entree['kapulo_load'], $entree['dispatch_pweto'], $entree['arrival_pweto'], $entree['barge_load'], $entree['barge_dispatch_date'], $entree['doc_receiv'], $entree['nbre_seal'], $entree['dgda_seal'], $entree['remarque'], $entree['transporter'], $entree['load_date'], $entree['pv_mine'], $entree['demande_attestation'], $entree['assay_date'], $entree['ceec_in'], $entree['ceec_out'], $entree['min_div_in'], $entree['min_div_out'], $entree['date_decl'], $entree['dgda_in'], $entree['date_liq'], $entree['date_quit'], $entree['dgda_out'], $entree['gov_in'], $entree['gov_out'], $entree['dispatch_date'], $entree['klsa_arriv'], $entree['end_form'], $entree['exit_drc'], $entree['cleared'], $entree['statut'], $entree['site_load'], $entree['destination'], $entree['ref_decl'], $entree['ref_liq'], $entree['ref_quit'], $entree['impala_sncc'], $entree['docs_sncc'], $entree['sncc_sakania'], $entree['sakania_date'], $entree['id_cli'], $entree['id_util'], $entree['id_mod_trans']));

		}

		public function creerDossierIB3($client, $ref_dos, $mca_b_ref, $road_manif, $date_preal, $t1,
										$poids, $ref_fact, $supplier, $fob, $fret,
										$assurance, $autre_frais, $po_ref,
										$commodity, $horse, $trailer_1, $trailer_2, $num_lic, $num_exo,
										$arrival_date, $crossing_date, $wiski_arriv, $wiski_dep, $amicongo_arriv,
										$insp_report, $ir, $ref_crf, $date_crf, $ref_decl, $dgda_in, $ref_liq,
										$date_liq, $ref_quit, $date_quit, $dgda_out, $custom_deliv, $dispatch_deliv,
										$remarque, $statut, $bl, $id_mod_trac, $id_util, $id_mod_trans, $credit_enlev_by, $bond_warehouse){
			include('connexion.php');

			/*echo '<br> client = '.$client;echo '<br> ref_dos = '.$ref_dos;echo '<br> mca_b_ref = '.$mca_b_ref;echo '<br> road_manif = '.$road_manif;echo '<br> date_preal = '.$date_preal;echo '<br> t1 = '.$t1;echo '<br> poids = '.$poids;echo '<br> ref_fact = '.$ref_fact;echo '<br> fob = '.$fob;echo '<br> fret = '.$fret;echo '<br> assurance = '.$assurance;echo '<br> autre_frais = '.$autre_frais;echo '<br> po_ref = '.$po_ref;echo '<br> commodity = '.$commodity;echo '<br> horse = '.$horse;echo '<br> trailer_1 = '.$trailer_1;echo '<br> trailer_2 = '.$trailer_2;echo '<br> num_lic = '.$num_lic;echo '<br> num_exo = '.$num_exo;echo '<br> arrival_date = '.$arrival_date;echo '<br> crossing_date = '.$crossing_date;echo '<br> wiski_arriv = '.$wiski_arriv;echo '<br> wiski_dep = '.$wiski_dep;echo '<br> amicongo_arriv = '.$amicongo_arriv;echo '<br> insp_report = '.$insp_report;echo '<br> ir = '.$ir;echo '<br> ref_crf = '.$ref_crf;echo '<br> date_crf = '.$date_crf;echo '<br> ref_decl = '.$ref_decl;echo '<br> dgda_in = '.$dgda_in;echo '<br> ref_liq = '.$ref_liq;echo '<br> date_liq = '.$date_liq;echo '<br> ref_quit = '.$ref_quit;echo '<br> date_quit = '.$date_quit;echo '<br> dgda_out = '.$dgda_out;echo '<br> custom_deliv = '.$custom_deliv;echo '<br> dispatch_deliv = '.$dispatch_deliv;echo '<br> remarque = '.$remarque;echo '<br> statut = '.$statut;echo '<br> id_mod_trac = '.$id_mod_trac;echo '<br> id_util = '.$id_util;echo '<br> id_mod_trans = '.$id_mod_trans;echo '<br><br>------------------<br><br>';*/

			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['mca_b_ref'] = $mca_b_ref;
			$entree['date_preal'] = $date_preal;$entree['t1'] = $t1;
			$entree['poids'] = $poids;$entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['po_ref'] = $po_ref;
			$entree['commodity'] = $commodity;$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['road_manif'] = $road_manif;
			$entree['num_lic'] = $num_lic;$entree['num_exo'] = $num_exo;$entree['arrival_date'] = $arrival_date;
			$entree['crossing_date'] = $crossing_date;$entree['wiski_arriv'] = $wiski_arriv;$entree['wiski_dep'] = $wiski_dep;
			$entree['amicongo_arriv'] = $amicongo_arriv;$entree['insp_report'] = $insp_report;$entree['ir'] = $ir;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;$entree['ref_decl'] = $ref_decl;
			$entree['dgda_in'] = $dgda_in;$entree['ref_liq'] = $ref_liq;$entree['date_liq'] = $date_liq;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;$entree['dgda_out'] = $dgda_out;
			$entree['custom_deliv'] = $custom_deliv;$entree['dispatch_deliv'] = $dispatch_deliv;$entree['remarque'] = $remarque;
			$entree['statut'] = $statut;$entree['id_mod_trac'] = $id_mod_trac;$entree['id_util'] = $id_util;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['bl'] = $bl;
			$entree['supplier'] = $supplier;
			$entree['credit_enlev_by'] = $credit_enlev_by;
			$entree['bond_warehouse'] = $bond_warehouse;

			if($entree['date_quit'] == '' || (strlen($entree['date_quit']) != 10) ){
				$entree['date_quit'] = NULL;
			}

			if($entree['date_liq'] == '' || (strlen($entree['date_liq']) != 10) ){
				$entree['date_liq'] = NULL;
			}

			if($entree['poids'] == ''){
				$entree['poids'] = NULL;
			}

			if($entree['fob'] == ''){
				$entree['fob'] = NULL;
			}

			if($entree['fret'] == ''){
				$entree['fret'] = NULL;
			}

			if($entree['assurance'] == ''){
				$entree['assurance'] = NULL;
			}

			if($entree['autre_frais'] == '' ){
				$entree['autre_frais'] = NULL;
			}

			if($entree['ir'] == '' ){
				$entree['ir'] = 'NO';
			}

			if($entree['date_preal'] == '' || (strlen($entree['date_preal']) != 10) ){
				$entree['date_preal'] = NULL;
			}

			if($entree['arrival_date'] == '' || (strlen($entree['arrival_date']) != 10) ){
				$entree['arrival_date'] = NULL;
			}

			if($entree['crossing_date'] == '' || (strlen($entree['crossing_date']) != 10) ){
				$entree['crossing_date'] = NULL;
			}

			if($entree['wiski_arriv'] == '' || (strlen($entree['wiski_arriv']) != 10) ){
				$entree['wiski_arriv'] = NULL;
			}

			if($entree['wiski_dep'] == '' || (strlen($entree['wiski_dep']) != 10) ){
				$entree['wiski_dep'] = NULL;
			}

			if($entree['amicongo_arriv'] == '' || (strlen($entree['amicongo_arriv']) != 10) ){
				$entree['amicongo_arriv'] = NULL;
			}

			if($entree['insp_report'] == '' || (strlen($entree['insp_report']) != 10) ){
				$entree['insp_report'] = NULL;
			}

			if($entree['date_crf'] == '' || (strlen($entree['date_crf']) != 10) ){
				$entree['date_crf'] = NULL;
			}

			if($entree['dgda_in'] == '' || (strlen($entree['dgda_in']) != 10) ){
				$entree['dgda_in'] = NULL;
			}

			if($entree['dgda_out'] == '' || (strlen($entree['dgda_out']) != 10) ){
				$entree['dgda_out'] = NULL;
			}

			if($entree['custom_deliv'] == '' || (strlen($entree['custom_deliv']) != 10) ){
				$entree['custom_deliv'] = NULL;
			}

			if($entree['dispatch_deliv'] == '' || (strlen($entree['dispatch_deliv']) != 10) ){
				$entree['dispatch_deliv'] = NULL;
			}

			if($entree['bl'] == '' || (strlen($entree['bl']) != 10) ){
				$entree['bl'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(id_cli, ref_dos, mca_b_ref, date_preal,
																id_mod_lic, id_util, id_mod_trans, num_lic, t1, poids, ref_fact, fob, fret, assurance,
																autre_frais, po_ref, commodity, horse, trailer_1,
																trailer_2, road_manif, num_exo, arrival_date,
																crossing_date, wiski_arriv, wiski_dep,
																amicongo_arriv, insp_receiv, ir, ref_crf,
																date_crf, ref_decl, dgda_in, ref_liq,
																date_liq, ref_quit, date_quit, dgda_out,
																custom_deliv, dispatch_deliv, remarque, statut,
																bl, supplier, credit_enlev_by, bond_warehouse)
												VALUES(?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?, ?,
													?, ?, ?, ?, ?,
													?, ?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?,
													?, ?, ?, ?, ?,
													?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['mca_b_ref'],
									$entree['date_preal'], $entree['id_mod_trac'], $entree['id_util'],
									$entree['id_mod_trans'], $entree['num_lic'], $entree['t1'],
									$entree['poids'], $entree['ref_fact'], $entree['fob'],
									$entree['fret'], $entree['assurance'], $entree['autre_frais'],
									$entree['po_ref'], $entree['commodity'], $entree['horse'],
									$entree['trailer_1'], $entree['trailer_2'], $entree['road_manif'],
									$entree['num_exo'], $entree['arrival_date'], $entree['crossing_date'],
									$entree['wiski_arriv'], $entree['wiski_dep'], $entree['amicongo_arriv'],
									$entree['insp_report'], $entree['ir'], $entree['ref_crf'],
									$entree['date_crf'], $entree['ref_decl'], $entree['dgda_in'],
									$entree['ref_liq'], $entree['date_liq'], $entree['ref_quit'],
									$entree['date_quit'], $entree['dgda_out'], $entree['custom_deliv'],
									$entree['dispatch_deliv'], $entree['remarque'], $entree['statut'],
									$entree['bl'], $entree['supplier'], $entree['credit_enlev_by'],
									$entree['bond_warehouse']));
		}
		//FIN Methodes permettant de créer

		//Methodes permettant d'archiver
		public function archiver($id_dos, $id_doc, $fichier, $tmp, $ref_dos){
			include('connexion.php');
			$entree['id_dos']=$id_dos;
			$entree['id_doc']=$id_doc;
			$entree['fichier']=$fichier;

			// echo "----- ID DOS = $id_dos<br>";
			// echo "----- ID DOC = $id_doc<br>";
			// echo "----- FICHIER = $fichier<br>";

			if($this-> getDocumentForDossier($id_dos, $id_doc) == '0'){

				$requete = $connexion-> prepare('INSERT INTO dossier_document(id_dos, id_doc, piece, id_util) VALUES(?, ?, ?, ?)');
				$requete-> execute(array($entree['id_dos'], $entree['id_doc'], $entree['fichier'], $_SESSION['id_util']));
		
			}else{
				
				$requete = $connexion-> prepare('UPDATE dossier_document SET piece = ?, date_create = NOW(), id_util=? 
													WHERE id_dos = ? AND id_doc = ?');
				$requete-> execute(array($entree['fichier'], $_SESSION['id_util'], $entree['id_dos'], $entree['id_doc']));
		
			}

			if(stristr($ref_dos, '/') == true) {
				$ref_dos = str_replace("/", "_", "$ref_dos");
			}
			
			$dossier = '../documents/'.$ref_dos;

			if(!is_dir($dossier)){
				mkdir("../documents/$ref_dos", 0777);
			}

			//Transfert du fichier
			move_uploaded_file($tmp, '../documents/'.$ref_dos.'/' . basename($fichier));

		}

		public function creerPlis($ref_plis, $num_bp, $num_lic, $fichier_plis, $tmp){
			include('connexion.php');
			$entree['ref_plis']=$ref_plis;
			$entree['num_bp']=$num_bp;
			$entree['num_lic']=$num_lic;
			$entree['fichier_plis']=$fichier_plis;

			// echo "----- ID DOS = $id_dos<br>";
			// echo "----- ID DOC = $id_doc<br>";
			// echo "----- FICHIER = $fichier<br>";

			if(stristr($num_lic, '/') == true) {
				$num_lic = str_replace("/", "_", "$num_lic");
			}
			
			$dossier = '../documents/'.$num_lic;

			if(!is_dir($dossier)){
				mkdir("../documents/$num_lic", 0777);
			}

			//Transfert du fichier
			move_uploaded_file($tmp, '../documents/'.$num_lic.'/' . basename($fichier_plis));


			$requete = $connexion-> prepare('INSERT INTO plis(ref_plis, num_bp, num_lic, 
																fichier_plis, id_util, id_cli) 
												VALUES(?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_plis'], $entree['num_bp'], $entree['num_lic'], $entree['fichier_plis'], $_SESSION['id_util'], $_GET['id_cli']));

		}

		public function creerPVContentieux($ref_pv, $date_pv, $date_reception, $id_bur_douane, $annee, $marchandise, $id_cli, $id_mod_lic, $fichier_pv, $id_util){
			include('connexion.php');
			$entree['ref_pv']=$ref_pv;
			$entree['date_pv']=$date_pv;
			$entree['date_reception']=$date_reception;
			$entree['id_bur_douane']=$id_bur_douane;
			$entree['annee']=$annee;
			$entree['marchandise']=$marchandise;
			$entree['id_cli']=$id_cli;
			$entree['id_mod_lic']=$id_mod_lic;
			$entree['fichier_pv']=$fichier_pv;
			$entree['id_util']=$id_util;

			$requete = $connexion-> prepare('INSERT INTO pv_contencieux(ref_pv, date_pv, date_reception, 
																id_bur_douane, annee, marchandise, 
																id_cli, id_mod_lic, fichier_pv, id_util) 
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_pv'], $entree['date_pv'], $entree['date_reception'], $entree['id_bur_douane'], $entree['annee'], $entree['marchandise'], $entree['id_cli'], $entree['id_mod_lic'], $entree['fichier_pv'], $entree['id_util']));

		}

		public function modificationPVContentieux($id_pv, $ref_pv, $date_pv, $date_reception, $id_bur_douane, $annee, $marchandise, $id_cli, $id_mod_lic, $id_etat, $remarque, $observ_verb, $argument_dec, $risque_reel, $action_en_cours, $infraction, $droit_cdf, $droit_usd, $amende_cdf, $amende_usd, $risque_potentiel){
			include('connexion.php');
			$entree['id_pv']=$id_pv;
			$entree['ref_pv']=$ref_pv;
			$entree['date_pv']=$date_pv;
			$entree['date_reception']=$date_reception;
			$entree['id_bur_douane']=$id_bur_douane;
			$entree['annee']=$annee;
			$entree['marchandise']=$marchandise;
			$entree['id_cli']=$id_cli;
			$entree['id_mod_lic']=$id_mod_lic;
			$entree['id_etat']=$id_etat;
			$entree['remarque']=$remarque;
			$entree['observ_verb']=$observ_verb;
			$entree['argument_dec']=$argument_dec;
			$entree['risque_reel']=$risque_reel;
			$entree['action_en_cours']=$action_en_cours;
			$entree['infraction']=$infraction;
			$entree['droit_cdf']=$droit_cdf;
			$entree['droit_usd']=$droit_usd;
			$entree['amende_cdf']=$amende_cdf;
			$entree['amende_usd']=$amende_usd;
			$entree['risque_potentiel']=$risque_potentiel;

			// echo '<br>ref_pv = '.$ref_pv;
			// echo '<br>date_pv = '.$date_pv;
			// echo '<br>date_reception = '.$date_reception;
			// echo '<br>id_bur_douane = '.$id_bur_douane;
			// echo '<br>annee = '.$annee;
			// echo '<br>marchandise = '.$marchandise;
			// echo '<br>id_cli = '.$id_cli;
			// echo '<br>id_mod_lic = '.$id_mod_lic;
			// echo '<br> fichier_pv= '.$fichier_pv;
			// echo '<br>id_util = '.$id_util;

			$requete = $connexion-> prepare('UPDATE pv_contencieux
												SET ref_pv = ?, date_pv = ?, date_reception = ?, 
													id_bur_douane = ?, annee = ?, marchandise = ?, 
													id_cli = ?, id_mod_lic = ?, id_etat = ?, remarque = ?, 
													observ_verb = ?, argument_dec = ?, risque_reel = ?, action_en_cours = ?, 
													infraction = ?, droit_cdf = ?, droit_usd = ?, amende_cdf = ?, 
													amende_usd = ?, risque_potentiel = ?
												WHERE id_pv = ?');
			$requete-> execute(array($entree['ref_pv'], $entree['date_pv'], $entree['date_reception'], $entree['id_bur_douane'], $entree['annee'], $entree['marchandise'], $entree['id_cli'], $entree['id_mod_lic'], $entree['id_etat'], $entree['remarque'], $entree['observ_verb'], $entree['argument_dec'], $entree['risque_reel'], $entree['action_en_cours'], $entree['infraction'], $entree['droit_cdf'], $entree['droit_usd'], $entree['amende_cdf'], $entree['amende_usd'], $entree['risque_potentiel'], $entree['id_pv']));

		}

		public function editPlis($id_plis, $ref_plis, $num_bp, $num_lic){
			include('connexion.php');
			$entree['ref_plis']=$ref_plis;
			$entree['num_bp']=$num_bp;
			$entree['id_plis']=$id_plis;
			$entree['num_lic']=$num_lic;

			// echo '<br>------ref_plis = '.$ref_plis;
			// echo '<br>------num_bp = '.$num_bp;
			// echo '<br>------num_lic = '.$num_lic;
			// echo '<br>------id_plis = '.$id_plis;

			$requete = $connexion-> prepare('UPDATE plis SET ref_plis =?, num_bp=?, num_lic=? 
												WHERE id_plis  = ?');
			$requete-> execute(array($entree['ref_plis'], $entree['num_bp'], $entree['num_lic'], $entree['id_plis']));

		}

		public function modifierFichierPlis($id_plis, $num_lic, $fichier_plis, $tmp){
			include('connexion.php');
			$entree['id_plis']=$id_plis;
			$entree['fichier_plis']=$fichier_plis;

			if(stristr($num_lic, '/') == true) {
				$num_lic = str_replace("/", "_", "$num_lic");
			}
			
			$dossier = '../documents/'.$num_lic;

			if(!is_dir($dossier)){
				mkdir("../documents/$num_lic", 0777);
			}

			//Transfert du fichier
			move_uploaded_file($tmp, '../documents/'.$num_lic.'/' . basename($fichier_plis));


			$requete = $connexion-> prepare('UPDATE plis SET fichier_plis = ? WHERE id_plis = ?');
			$requete-> execute(array($entree['fichier_plis'], $entree['id_plis']));

		}

		//FIN Methodes permettant d'archiver

		//Methodes permettant d'afficher
		public function afficherMenuLicence(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_cli = '';
			$active = '';
			$open = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2' || $_SESSION['id_role'] == '5'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";
			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if($reponse['id_mod_lic'] == $_GET['id_mod_lic']){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <li class="nav-item">
		                <a href="dashboard.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>&amp;debut=&amp;fin=" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-tachometer-alt"></i>
		                  <p>Dashboard licences <?php echo $reponse['sigle_mod_lic'];?></p>
		                </a>
		              </li>
		              <li class="nav-item">
		                <a href="licence.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
		                  <p>Synthèse Licence <?php echo $reponse['sigle_mod_lic'];?></p>
		                </a>
		              </li>
		              <?php
		              if ($reponse['id_mod_lic'] == '1') {
		              
		              	$this-> afficherMenuTrackingClientModeleLicence2($reponse['id_mod_lic']);
		              
		              }
		              ?>
		              <li class="nav-item">
		                <a href="facture.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>&etat=&debut_date_recep=&fin_date_recep=" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-file nav-icon"></i>
		                  <p>Facture</p>
		                </a>
		              </li>
		              <?php
		              	if ($reponse['id_mod_lic'] == 1) {
		              	?>
		              <!--<li class="nav-item">
		                <a href="manipulation.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-edit nav-icon"></i>
		                  <p>Manipulations</p>
		                </a>
		              </li>

		              <li class="nav-item has-treeview">
			        	<a href="#" class="nav-link" class="nav-link ">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-certificate nav-icon"></i>
		                  <p>AV</p>
		                </a>
		            	<ul class="nav nav-treeview">
		              		<?php $this-> afficherMenuAvClientModeleLicence($reponse['id_mod_lic']);?>
		            	</ul>
		              </li>-->
		              <li class="nav-item">
		                <a href="apurementLicenceExport.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-check nav-icon"></i>
		                  <p>Tansmis Apurement</p>
		                </a>
		              </li>
		              	<?php
		              	}else if ($reponse['id_mod_lic'] == 2) {
		              	?>
		              <!--<li class="nav-item">
		                <a href="manipulation.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-edit nav-icon"></i>
		                  <p>Manipulations</p>
		                </a>
		              </li>

		              <li class="nav-item has-treeview">
			        	<a href="#" class="nav-link" class="nav-link ">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-certificate nav-icon"></i>
		                  <p>AV</p>
		                </a>
		            	<ul class="nav nav-treeview">
		              		<?php $this-> afficherMenuAvClientModeleLicence($reponse['id_mod_lic']);?>
		            	</ul>
		              </li>-->
		              <li class="nav-item">
		                <a href="apurementLicence.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>&amp;num_lic=&amp;date_quit_debut=&amp;date_quit_fin=" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-check nav-icon"></i>
		                  <p>Tansmis Apurement</p>
		                </a>
		              </li>
		              	<?php
		              	}
		              ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();
			}
			?>
          <li class="nav-item">
            <a href="sydonia_upload.php?id_mod_trac=&amp;id_cli=" class="nav-link">
              &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
              <p>UPLOAD DATA EXCEL</p>
            </a>
          </li>
			<?php


		}

		public function afficherMenuLicenceAjax(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_cli = '';
			$active = '';
			$open = '';
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";
			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if($reponse['id_mod_lic'] == $_GET['id_mod_lic']){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <li class="nav-item">
		                <a href="dashboard.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-tachometer-alt"></i>
		                  <p>Dashboard licences <?php echo $reponse['sigle_mod_lic'];?></p>
		                </a>
		              </li>
		              <?php
		              	$requete2 = $connexion-> prepare("SELECT cl.nom_cli AS nom_cli,
		              											cl.id_cli AS id_cli,
		              											cl.code_cli AS code_cli
		              										FROM client cl, affectation_client_modele_licence aff, modele_licence ml
		              										WHERE cl.id_cli = aff.id_cli
		              											AND aff.menu_tracking = '1'
		              											AND aff.id_mod_lic = ml.id_mod_lic
		              											AND ml.id_mod_lic = ?
		              										ORDER BY cl.nom_cli");
		              	$requete2-> execute(array($reponse['id_mod_lic']));
		              	while ($reponse2 = $requete2-> fetch()) {
		              	?>
		              	<li class="nav-item has-treeview">
			                <a href="#" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p><?php echo $reponse2['nom_cli'];?></p>
			                </a>
		            		<ul class="nav nav-treeview">
		            			<li class="nav-item">
					                <a href="licenceAjax.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_type_lic=&amp;id_cli=<?php echo $reponse2['id_cli'];?>" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-list"></i>
					                  <p>Tableau Licences</p>
					                </a>
					            </li>
		            			<li class="nav-item">
					                <a href="apurementLicence.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $reponse2['id_cli'];?>" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-check"></i>
					                  <p>Apurement</p>
					                </a>
					            </li>
		            		</ul>
			            </li>
		              	<?php
		              	}$requete2-> closeCursor();
		              ?>
		              
		              <li class="nav-item">
		                <a href="facture.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>&etat=" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-file nav-icon"></i>
		                  <p>Facture</p>
		                </a>
		              </li>
		              <?php
		              	if ($reponse['id_mod_lic'] == 1) {
		              	?>
		              <!--<li class="nav-item">
		                <a href="manipulation.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-edit nav-icon"></i>
		                  <p>Manipulations</p>
		                </a>
		              </li>

		              <li class="nav-item has-treeview">
			        	<a href="#" class="nav-link" class="nav-link ">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-certificate nav-icon"></i>
		                  <p>AV</p>
		                </a>
		            	<ul class="nav nav-treeview">
		              		<?php $this-> afficherMenuAvClientModeleLicence($reponse['id_mod_lic']);?>
		            	</ul>
		              </li>-->
		              <li class="nav-item">
		                <a href="apurementLicenceExport.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-check nav-icon"></i>
		                  <p>Tansmis Apurement</p>
		                </a>
		              </li>
		              	<?php
		              	}else if ($reponse['id_mod_lic'] == 2) {
		              	?>
		              <!--<li class="nav-item">
		                <a href="manipulation.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-edit nav-icon"></i>
		                  <p>Manipulations</p>
		                </a>
		              </li>

		              <li class="nav-item has-treeview">
			        	<a href="#" class="nav-link" class="nav-link ">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-certificate nav-icon"></i>
		                  <p>AV</p>
		                </a>
		            	<ul class="nav nav-treeview">
		              		<?php $this-> afficherMenuAvClientModeleLicence($reponse['id_mod_lic']);?>
		            	</ul>
		              </li>-->
		              <li class="nav-item">
		                <a href="apurementLicence.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-check nav-icon"></i>
		                  <p>Tansmis Apurement</p>
		                </a>
		              </li>
		              	<?php
		              	}
		              ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();
			?>
          <li class="nav-item">
            <a href="sydonia_upload.php?id_mod_trac=&amp;id_cli=" class="nav-link">
              &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
              <p>UPLOAD DATA EXCEL</p>
            </a>
          </li>
			<?php


		}

		public function afficherMenuApurementClientModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, 
													c.id_cli AS id_cli, c.photo AS photo,
													IF(c.nom_abr_cli IS NOT NULL, c.nom_abr_cli, c.nom_cli) AS nom_abr_cli  
												FROM client c, licence l, dossier d
												WHERE l.id_mod_lic = ?
													AND l.id_cli = c.id_cli
													AND l.num_lic = d.num_lic
												GROUP BY c.nom_cli
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) && (isset($reponse['id_cli'])) && (isset($_GET['id_march'])) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}

			?>
				<li class="nav-item <?php echo $open;?>">
			        <a href="apurementLicence.php?id_mod_lic=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_type_lic=&amp;num_lic=&amp;date_quit_debut=&amp;date_quit_fin=" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['nom_abr_cli'];?>
			          </p>
			        </a>
			    </li>
			<?php
				
			}$requete-> closeCursor();
		}

		public function afficherMenuApurementClientModeleLicenceBackUp($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, 
													c.id_cli AS id_cli, c.photo AS photo,
													c.nom_abr_cli AS nom_abr_cli  
												FROM client c, affectation_client_modele_licence cm, modele_licence m 
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND cm.menu_tracking = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) && (isset($reponse['id_cli'])) && (isset($_GET['id_march'])) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}

				if ($reponse['id_cli']=='883') {
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['nom_abr_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
						<li class="nav-item <?php echo $open;?>">
					        <a href="apurementLicence.php?id_mod_lic=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_type_lic=" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
					          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-minus nav-icon"></i>
					          <p>
					            <?php echo $reponse['nom_abr_cli'];?>
					          </p>
					        </a>
					    </li>
		            <?php
		            	$requeteFournisseur = $connexion-> prepare("SELECT DISTINCT(cl.nom_cli) AS supplier 
		            													FROM client cl, fournisseur_licence_client four 
		            													WHERE four.id_cli = ?
		            														AND four.id_mod_lic = ?
		            														AND four.id_four = cl.id_cli");
		            	$requeteFournisseur-> execute(array($reponse['id_cli'], $entree['id_mod_lic']));
		            	while ($reponseFournisseur = $requeteFournisseur-> fetch()) {
		            	?>
		            	<li class="nav-item">
			                <a href="apurementLicenceBySupplier.php?id_mod_lic=<?php echo $id_mod_lic;?>&amp;supplier=<?php echo $reponseFournisseur['supplier'];?>&amp;id_type_lic=" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-minus nav-icon"></i>
			                  <p><?php echo $reponseFournisseur['supplier'];?></p>
			                </a>
			            </li>
		            	<?php
		            	}$requeteFournisseur-> closeCursor();
		            ?>
		            </ul>
			    </li>
			<?php
				}else{
			?>
				<li class="nav-item <?php echo $open;?>">
			        <a href="apurementLicence.php?id_mod_lic=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_type_lic=&amp;num_lic=&amp;date_quit_debut=&amp;date_quit_fin=" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['nom_abr_cli'];?>
			          </p>
			        </a>
			    </li>
			<?php
				}
			}$requete-> closeCursor();
		}

		public function afficherMenuAvClientModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, 
													c.id_cli AS id_cli, c.photo AS photo,
													c.nom_abr_cli AS nom_abr_cli  
												FROM client c, affectation_client_modele_licence cm, modele_licence m 
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND cm.menu_tracking = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) && (isset($reponse['id_cli'])) && (isset($_GET['id_march'])) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['nom_abr_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              	<li class="nav-item">
			                <a href="dashboardAv.php?id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-tachometer-alt nav-icon"></i>
			                  <p>Dashboard AV</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="irSansAv.php?id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-bell nav-icon"></i>
			                  <p>IR Sans AV <sup class="badge badge-danger"><?php echo $this-> getNombreIrSansAVClient($reponse['id_cli']);?></sup></p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="av.php?id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-list nav-icon"></i>
			                  <p>Situation AV</p>
			                </a>
			            </li>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuFinanceOperation(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2' || $_SESSION['id_role'] == '6' || $_SESSION['id_role'] == '10'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_lic_fin_ops'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_lic_fin_ops']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	$this-> afficherMenuClientModeleLicence($reponse['id_mod_lic']);
		              ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherMenuArchivage(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			// if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '15'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_lic_archivage'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_lic_archivage']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	$this-> afficherArchivageModeleLicence($reponse['id_mod_lic']);
		              ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			// }
		}

		public function afficherMenuFacturation2(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_cli = '';
			$active = '';
			$open = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2' || $_SESSION['id_role'] == '8'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";
			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if($reponse['id_mod_lic'] == $_GET['id_mod_lic']){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php //echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <li class="nav-item">
		                <a href="facturation.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-calculator"></i>
		                  <p>Facturation <?php echo $reponse['sigle_mod_lic'];?></p>
		                </a>
		              </li>
		              <li class="nav-item">
		                <a href="factureGlobale.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-plus"></i>
		                  <p>Etablir Facture Globale</p>
		                </a>
		              </li>
		              <li class="nav-item">
		                <a href="listerFactureGlobale.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-copy"></i>
		                  <p>Lister Facture Globale</p>
		                </a>
		              </li>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}

		}

		public function afficherMenuTracking(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2' || $_SESSION['id_role'] == '6' || $_SESSION['id_role'] == '10'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_trac'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_trac']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <!--<li class="nav-item">
		                <a href="dashboardDossier.php?id_mod_trac=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>&commodity=" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-tachometer-alt"></i>
		                  <p>Dashboard dossiers <?php echo $reponse['sigle_mod_lic'];?></p>
		                </a>
		              </li>-->

						<li class="nav-item has-treeview">
					        <a href="dashboardDossier.php?id_cli=<?php //echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>" class="nav-link" class="nav-link">
		                  	&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-tachometer-alt"></i>
		                  	<p>DASHBOARD <?php echo $reponse['sigle_mod_lic'];?></p>
					        </a>
				            <ul class="nav nav-treeview">
				            	<li class="nav-item">
					                <a href="dashboardDossierGeneral.php?id_cli=<?php echo $id_cli;?>&amp;commodity=&amp;id_mod_trac=<?php echo $reponse['id_mod_lic'];?>" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
					                  <p>GENERAL</p>
					                </a>
					            </li>
				              <?php
				              	//$this-> afficherMenuModeTransportDashboard($id_cli, $reponse['id_mod_lic']);
				              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
				              ?>
				            </ul>
					    </li>
		              <!--<li class="nav-item">
		                <a href="reporting_dossier.php?id_mod_trac=<?php echo $reponse['id_mod_lic'];?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
		                  <p>Reporting</p>
		                </a>
		              </li>-->
		              <?php
		              	$this-> afficherMenuTrackingClientModeleLicence($reponse['id_mod_lic']);
		              // if ($reponse['id_mod_lic'] == '1') {
		              // 	# code...
		              // 	$this-> afficherMenuClientModeleLicenceExport($reponse['id_mod_lic']);
		              // }else if ($reponse['id_mod_lic'] == '2') {
		              // 	# code...
		              // 	$this-> afficherMenuClientModeleLicence($reponse['id_mod_lic']);
		              // }

		              	//if( $_SESSION['id_role'] == '10'){
			              ?>
			              <li class="nav-item">
			                <a href="sydonia_upload.php?id_mod_trac=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
			                  <p>UPLOAD DATA EXCEL</p>
			                </a>
			              </li>
		              <?php
		              	//}
		              ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherMenuCotation(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2' || $_SESSION['id_role'] == '7'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_lic_cot'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_lic_cot']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		            	<li class="nav-item">
			                <a href="dossierEnAttenteCotation.php?id_mod_lic_cot=<?php echo $reponse['id_mod_lic'];?>&id_cli=&debut=&fin=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p>En attente 
			                  	<sup>
			                  		<span class="badge badge-danger">
			                  			<?php echo $this-> getNbreDossierEnAttenteCotation($reponse['id_mod_lic']);?>
			                  		</span>
			                  	</sup>
			                  </p>
			                </a>
			            </li>
		            	<li class="nav-item">
			                <a href="cotation.php?id_mod_lic_cot=<?php echo $reponse['id_mod_lic'];?>&id_cli=&debut=&fin=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p>Liste</p>
			                </a>
			            </li>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherMenuKpi(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_lic_kpi'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_lic_kpi']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>

		            <ul class="nav nav-treeview">
			        <?php
			        	$this-> afficherMenuKPIClientModeleLicence($reponse['id_mod_lic']);
			        ?>
			    	</ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherMenuFacturation(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2' || $_SESSION['id_role'] == '8'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_lic_fact'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_lic_fact']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
						<li class="nav-item">
			                <a href="dashboardFactureDossier.php?id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-tachometer-alt nav-icon"></i>
			                  <p>Dashboard
			                  </p>
			                </a>
			            </li>
			            <?php
			            	$this-> afficherMenuTrackingClientModeleLicenceFacturation($reponse['id_mod_lic']);
			            ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();
			}
		}

		public function afficherMenuFinanceOPS(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2' || $_SESSION['id_role'] == '8'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_lic_fin_ops'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_lic_fin_ops']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
						<!-- <li class="nav-item">
			                <a href="dashboardFactureDossier.php?id_mod_lic_fin_ops=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-tachometer-alt nav-icon"></i>
			                  <p>Dashboard
			                  </p>
			                </a>
			            </li> -->
		            	<li class="nav-item has-treeview <?php echo $open;?>">
					        <a class="nav-link">
					          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-calculator"></i>
					          <p>
					            Dépenses Normales
					            <i class="right fas fa-angle-left"></i>
					          </p>
					        </a>
							<ul class="nav nav-treeview">
								<li class="nav-item">
					                <a href="nouvelleDepenseNormale.php?id_mod_lic_fin_ops=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-plus nav-icon"></i>
					                  <p>Nouvelle
					                  </p>
					                </a>
					            </li>
								<li class="nav-item">
					                <a href="enAttenteDepenseNormale.php?id_mod_lic_fin_ops=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-list nav-icon"></i>
					                  <p>En attente
					                  </p>
					                </a>
					            </li>
								<li class="nav-item">
					                <a href="depenseNormale.php?id_mod_lic_fin_ops=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-check nav-icon"></i>
					                  <p>Validés
					                  </p>
					                </a>
					            </li>
							</ul>
					    </li>

		            </ul><!-- 
		            <ul class="nav nav-treeview">
		            	<li class="nav-item has-treeview <?php echo $open;?>">
					        <a class="nav-link  <?php echo $active;?>">
					          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-file"></i>
					          <p>
					            PARTIELLE
					            <i class="right fas fa-angle-left"></i>
					          </p>
					        </a>
							<ul class="nav nav-treeview">
					            <li class="nav-item">
					                <a href="nouvelleFacturePartielle1.php?id_mod_lic_fin_ops=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-edit nav-icon"></i>
					                  <p>Edition
					                  </p>
					                </a>
					            </li>
					            <li class="nav-item">
					                <a href="listerFactureDossier.php?type_fact=partielle&id_mod_lic_fin_ops=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-list nav-icon"></i>
					                  <p>Liste
					                  </p>
					                </a>
					            </li>
					            <li class="nav-item">
					                <a href="transmisFactureDossier.php?type_fact=partielle&id_mod_lic_fin_ops=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-check nav-icon"></i>
					                  <p>Transmis
					                  </p>
					                </a>
					            </li>
							</ul>
					    </li>

		            </ul> -->
			    </li>
				<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherMenuFacturationBackUp(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2' || $_SESSION['id_role'] == '6'){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_lic_fact'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_lic_fact']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
						<li class="nav-item">
			                <a href="dashboardFactureDossier.php?id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-tachometer-alt nav-icon"></i>
			                  <p>Dashboard
			                  </p>
			                </a>
			            </li>
		            	<li class="nav-item has-treeview <?php echo $open;?>">
					        <a class="nav-link  <?php echo $active;?>">
					          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-copy"></i>
					          <p>
					            GLOBALE
					            <i class="right fas fa-angle-left"></i>
					          </p>
					        </a>
							<ul class="nav nav-treeview">
								<li class="nav-item">
					                <a href="nouvelleFactureMasterData.php?id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-edit nav-icon"></i>
					                  <p>Edition Avec M.D.
					                  </p>
					                </a>
					            </li>
					            <!-- <li class="nav-item">
					                <a href="nouvelleFactureMasterData.php?id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-edit nav-icon"></i>
					                  <p>Edition Normale
					                  </p>
					                </a>
					            </li> -->
					            <li class="nav-item">
					                <a href="listerFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-list nav-icon"></i>
					                  <p>Liste
					                  </p>
					                </a>
					            </li>
					            <li class="nav-item">
					                <a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-check nav-icon"></i>
					                  <p>Transmis
					                  </p>
					                </a>
					            </li>
							</ul>
					    </li>

		            </ul>
		            <ul class="nav nav-treeview">
		            	<li class="nav-item has-treeview <?php echo $open;?>">
					        <a class="nav-link  <?php echo $active;?>">
					          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-file"></i>
					          <p>
					            PARTIELLE
					            <i class="right fas fa-angle-left"></i>
					          </p>
					        </a>
							<ul class="nav nav-treeview">
					            <li class="nav-item">
					                <a href="nouvelleFacturePartielle1.php?id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-edit nav-icon"></i>
					                  <p>Edition
					                  </p>
					                </a>
					            </li>
					            <li class="nav-item">
					                <a href="listerFactureDossier.php?type_fact=partielle&id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-list nav-icon"></i>
					                  <p>Liste
					                  </p>
					                </a>
					            </li>
					            <li class="nav-item">
					                <a href="transmisFactureDossier.php?type_fact=partielle&id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-check nav-icon"></i>
					                  <p>Transmis
					                  </p>
					                </a>
					            </li>
							</ul>
					    </li>

		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherMenuMarchandiseModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(nom_march) AS nom_march, id_march AS id_march
												FROM marchandise
												WHERE id_mod_lic = ?
												ORDER BY nom_march");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_march'])) && ($reponse['id_march'] == $_GET['id_march']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="dossier.php?id_march=<?php echo $reponse['id_march'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_march'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	$this-> afficherMenuModeTransport($reponse['id_march'], $id_mod_lic);
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function getLicenceMarchandiseDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$licence = '';

			$requete = $connexion-> prepare("SELECT REPLACE(REPLACE(REPLACE(num_lic,' ', ''),'/',''),'-','') AS num_lic
												FROM marchandise_dossier
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				$licence.= $reponse['num_lic'].'_';
			}$requete-> closeCursor();

			return $licence;
		}

		public function afficherMenuClientModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli, c.photo AS photo, c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND cm.menu_tracking = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['code_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	$this-> afficherMenuFinOPSModeTransportClient($reponse['id_cli'], $id_mod_lic);
		              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
		              ?>
		              <?php
		              	if( $reponse['id_cli'] == '869'){
		              	/*
		              	?>
		              	<li class="nav-item">
			                <a href="uploadTrackingKlsa.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&commodity=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-upload nav-icon"></i>
			                  <p>UPLOAD FICHIER</p>
			                </a>
			            </li>
		              	<?php
		              	*/
		              	}
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherArchivageModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli, c.photo AS photo, c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND cm.menu_tracking = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item<?php echo $open;?>">
			        <a href="archivage.php?id_mod_lic_archivage=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['code_cli'];?>
			          </p>
			        </a>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuFinOPSModeTransportClient($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			$requete = $connexion-> prepare("SELECT UPPER(nom_mod_trans) AS nom_mod_trans, id_mod_trans AS id_mod_trans
												FROM mode_transport
												WHERE id_mod_trans IN(
													SELECT DISTINCT(id_mod_trans)
													FROM dossier
													WHERE id_cli = ?
														AND id_mod_lic = ?
											)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="financeOPS.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic_fin_ops=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&commodity=" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['nom_mod_trans'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuClientModeleLicenceExport($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fa fa-user"></i>
			          <p>
			            <?php echo $reponse['nom_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	$this-> afficherMenuModeTransportClientExport($reponse['id_cli'], $id_mod_lic);
		              	//$this-> afficherMenuMarchandiseClientModeleLicence($reponse['id_cli'], $id_mod_lic);
		              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
		              ?>
		              <?php
		              	/*if( $reponse['id_cli'] == '869'){
		              	?>
		              	<li class="nav-item">
			                <a href="uploadTrackingKlsa.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&commodity=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-upload nav-icon"></i>
			                  <p>UPLOAD FICHIER</p>
			                </a>
			            </li>
		              	<?php
		              	}*/
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuTrackingClientModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli, 
														c.photo AS photo, c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND cm.menu_tracking = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['code_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	//$this-> afficherMenuModeTransportClientExport($reponse['id_cli'], $id_mod_lic);
		              	$this-> afficherMenuMarchandiseClientModeleLicence($reponse['id_cli'], $id_mod_lic);
		              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
		              ?>
		              <?php
		              	if( $entree['id_mod_lic'] == '1'){
		              	?>
		              <li class="nav-item">
		                <a href="redevance.php?id_mod_trac=<?php echo $entree['id_mod_lic'];?>&amp;id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-copy nav-icon"></i>
		                  <p>Plis Redevance Minière</p>
		                </a>
		              </li>
		              	<?php
		              	}
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuTrackingClientModeleLicence2($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli, 
														c.photo AS photo, c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND cm.menu_tracking = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['code_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	//$this-> afficherMenuModeTransportClientExport($reponse['id_cli'], $id_mod_lic);
		              	$this-> afficherMenuMarchandiseClientModeleLicence2($reponse['id_cli'], $id_mod_lic);
		              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuTrackingClientModeleLicenceFacturation($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli, 
														c.photo AS photo, c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND cm.menu_tracking = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['code_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              	<li class="nav-item">
			                <a href="dossierEnAttenteFacture.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
			                  <p>Dossiers non-facturés <sup><b><span style="color: red;"><?php echo $this-> getNbreDossierEnAttenteFacture($id_mod_lic, $reponse['id_cli']);?></span></b></sup></p>
			                </a>
			            </li>
			              <?php
			              	if (($reponse['id_cli'] == '883' && $entree['id_mod_lic']=='1') || ($this-> getModeleFacture($reponse['id_cli'], 1)=='883')) {
			              	?>
		              	<li class="nav-item">
					    	<a href="nouvelleFactureMasterData.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>
			                  	Editer Facture EX1
			                  	<i class="right fas fa-angle-left"></i>
			                  </p>
			                </a>
				            <ul class="nav nav-treeview">
				              <?php
				              	$this-> afficherMenuMarchandiseClientModeleLicenceFacturation($reponse['id_cli'], $id_mod_lic);
				              ?>
				            </ul>
			             </li>
		              	<li class="nav-item">
					    	<a href="nouvelleFactureMasterData.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>
			                  	Editer Facture Trans.Local
			                  	<i class="right fas fa-angle-left"></i>
			                  </p>
			                </a>
				            <ul class="nav nav-treeview">
				              <?php
				              	$this-> afficherMenuMarchandiseClientModeleLicenceFacturationTransfertLocal($reponse['id_cli'], $id_mod_lic);
				              ?>
				            </ul>
			             </li>
			             <li class="nav-item">
					    	<a href="nouvelleFactureTransbordement.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_t_trans=5" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer Facture Transbord.</p>
			                </a>
		            	</li>
			             <li class="nav-item">
					    	<a href="licenceEnAttenteFacture.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_t_trans=5" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer Facture Licence <sup><b><span style="color: red;"><?php echo $this-> getNbreLicenceEnAttenteFacture($id_mod_lic, $reponse['id_cli']);?></span></b></sup></p>
			                </a>
		            	</li>
					    <li class="nav-item">
					    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
			                  <p>Transmis Factures</p>
			                </a>
					    </li>
			              	<?php
			              	}else if ( ($reponse['id_cli'] == '928' && $entree['id_mod_lic']=='1') || ($this-> getModeleFacture($reponse['id_cli'], 1)=='928')) {
			              	?>
		              	<li class="nav-item">
					    	<a href="#" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>
			                  	Editer Facture EX1
			                  	<i class="right fas fa-angle-left"></i>
			                  </p>
			                </a>
				            <ul class="nav nav-treeview">
				              <?php
				              	$this-> afficherMenuMarchandiseClientModeleLicenceFacturationFrontier($reponse['id_cli'], $id_mod_lic);
				              ?>
				            </ul>
			             </li>
			             <li class="nav-item">
					    	<a href="nouvelleFactureVenteLocale.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=27" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer Facture Vente Local</p>
			                </a>
		            	</li>
			             <li class="nav-item">
					    	<a href="licenceEnAttenteFacture.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_t_trans=5" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer Facture Licence <sup><b><span style="color: red;"><?php echo $this-> getNbreLicenceEnAttenteFacture($id_mod_lic, $reponse['id_cli']);?></span></b></sup></p>
			                </a>
		            	</li>
					    <li class="nav-item">
					    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
			                  <p>Transmis Factures</p>
			                </a>
					    </li>
			              	<?php
			              	}else if (($reponse['id_cli'] == '883' && $entree['id_mod_lic']=='2')  || ($this-> getModeleFacture($reponse['id_cli'], 2)=='883')) {
			              	?>
		              	<li class="nav-item">
					    	<a href="nouvelleFactureMasterData.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer Facture IM4</p>
			                </a>
					    	<a href="nouvelleFactureMasterDataTR8.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer Facture TR8</p>
			                  <!-- <p>Editer Facture Escorte</p> -->
			                </a>
					    	<a href="nouvelleFactureMasterDataTR8.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <!-- <p>Editer Facture TR8</p> -->
			                  <p>Editer Facture Escorte</p>
			                </a>
					    	<a href="nouvelleFactureMasterDataSEGUCE.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer Facture SEGUCE</p>
			                </a>
			             </li>
						    <li class="nav-item">
						    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}else if ($reponse['id_cli'] == '888' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) {
			              	?>
			              	<li class="nav-item has-treeview">
						    	<a  class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
				                  <p>
				                  	Editer
						            <i class="right fas fa-angle-left"></i>
				              	  </p>
				                </a>
					            <ul class="nav nav-treeview">
					              	<li class="nav-item">
					              		<li class="nav-item has-treeview">
									    	<!--<a  class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-truck nav-icon"></i>
							                  <p>
							                  	Route
									            <i class="right fas fa-angle-left"></i>
							              	  </p>
							                </a>
								            <ul class="nav nav-treeview">
								              	<li class="nav-item">
											    	<a href="factureSicomineEnAttente.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-spinner nav-icon"></i>
									                  <p>En cours</p>
									                </a>
									            </li>
								              	<li class="nav-item">
											    	<a href="nouvelleFactureSicomine.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plus nav-icon"></i>
									                  <p>Nouvelle</p>
									                </a>
									            </li>
									        </ul>-->
							              	<li class="nav-item">
										    	<a href="factureSicomineIM4.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-truck nav-icon"></i>
								                  <p>IM4</p>
								                </a>
								            </li>
							              	<li class="nav-item">
										    	<a href="factureSicomineTR8.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-truck nav-icon"></i>
								                  <p>TR8</p>
								                </a>
								            </li>
									    </li>
					              		<li class="nav-item has-treeview">
									    	<a  class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plane nav-icon"></i>
							                  <p>
							                  	Aerien
									            <i class="right fas fa-angle-left"></i>
							              	  </p>
							                </a>
								            <ul class="nav nav-treeview">
								              	<li class="nav-item">
											    	<a href="factureSicomineEnAttente.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=3" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-spinner nav-icon"></i>
									                  <p>En cours</p>
									                </a>
									            </li>
								              	<li class="nav-item">
											    	<a href="nouvelleFactureSicomine.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=3" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plus nav-icon"></i>
									                  <p>Nouvelle</p>
									                </a>
									            </li>
									        </ul>
									    </li>
									</li>
						        </ul>
						    </li>
						    <li class="nav-item">
						    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}else if ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='887') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='885')) {
			              	?>
			              	<li class="nav-item has-treeview">
						    	<a  class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
				                  <p>
				                  	Editer
						            <i class="right fas fa-angle-left"></i>
				              	  </p>
				                </a>
					            <ul class="nav nav-treeview">
					              	<li class="nav-item">
					              		<li class="nav-item has-treeview">
									    	<!-- <a href="nouvelleFactureRCD.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link"> -->
									    	<a href="nouvelleFactureSTF.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-truck nav-icon"></i>
							                  <p>
							                  	Route
									            <!-- <i class="right fas fa-angle-left"></i> -->
							              	  </p>
							                </a>

									    	<a href="nouvelleFactureSTFAir.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=3" class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plane nav-icon"></i>
							                  <p>
							                  	Air
									            <!-- <i class="right fas fa-angle-left"></i> -->
							              	  </p>
							                </a>

									    </li>
									</li>
						        </ul>
						    </li>
						    <li class="nav-item">
						    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}else if (($reponse['id_cli'] == '921' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || $reponse['id_cli']=='922') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='922')) {
			              	?>
			              	<li class="nav-item has-treeview">
						    	<a  class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
				                  <p>
				                  	Editer
						            <i class="right fas fa-angle-left"></i>
				              	  </p>
				                </a>
					            <ul class="nav nav-treeview">
					              	<li class="nav-item">
					              		<li class="nav-item has-treeview">

									    	<a href="nouvelleFactureSTF.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-truck nav-icon"></i>
							                  <p>
							                  	Route
									            <!-- <i class="right fas fa-angle-left"></i> -->
							              	  </p>
							                </a>

									    	<a href="nouvelleFactureSTFAir.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=3" class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plane nav-icon"></i>
							                  <p>
							                  	Air
									            <!-- <i class="right fas fa-angle-left"></i> -->
							              	  </p>
							                </a>
									    </li>
									</li>
						        </ul>
						    </li>
						    <li class="nav-item">
						    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}else if ( ($reponse['id_cli'] == '995' || ($this-> getModeleFacture($reponse['id_cli'], 1)=='995')) ) {
			              	?>
						    <li class="nav-item">
						    	<a href="newInvoiceKICOExport.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
				                  <p>Editer</p>
				                </a>
			            	</li>
						    <li class="nav-item">
				                <a href="transmisFactureDossier.php?type_fact=partielle&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}else {
			              	?>
						    <li class="nav-item">
						    	<a href="nouvelleFacturePartielle1.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
				                  <p>Editer</p>
				                </a>
			            	</li>
						    <li class="nav-item">
				                <a href="transmisFactureDossier.php?type_fact=partielle&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}
			              ?>
		              	<li class="nav-item">
			                <a href="listerFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-copy nav-icon"></i>
			                  <p>Lister Factures</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <!-- <a href="statutDossierFacturation.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link"> -->
			                <a  onclick="window.open('statutDossierFacturation.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>','pop1','width=1000,height=800');" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-list nav-icon"></i>
			                  <p>Statut Dossiers</p>
			                </a>
			            </li>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuKPIClientModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli, 
														c.photo AS photo, c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND cm.menu_tracking = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/clients/<?php echo $reponse['photo'];?>" style="width: 30px; border-radius: 1px;">
			          <p>
			            <?php echo $reponse['code_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              	<li class="nav-item">
			              <?php
			              	if ( ($reponse['id_cli'] == '883' || $reponse['id_cli'] == '886') && $id_mod_lic == '2') {
			              	?>
					    	<a href="scoring.php?id_mod_lic_kpi=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-circle nav-icon"></i>
			                  <p>Scoring</p>
			                </a>
			              	<?php
			              	}
			              ?>
			            </li>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuClientTrackingModeleLicenceExport($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fa fa-user"></i>
			          <p>
			            <?php echo $reponse['nom_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	$this-> afficherMenuModeTransportClientExport($reponse['id_cli'], $id_mod_lic);
		              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
		              ?>
		              <?php
		              	/*if( $reponse['id_cli'] == '869'){
		              	?>
		              	<li class="nav-item">
			                <a href="uploadTrackingKlsa.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&commodity=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-upload nav-icon"></i>
			                  <p>UPLOAD FICHIER</p>
			                </a>
			            </li>
		              	<?php
		              	}*/
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuModeTransport($id_march, $id_mod_lic){
			include('connexion.php');
			//$entree['id_mod_lic'] = $id_mod_lic;
			$style = '';

			$requete = $connexion-> query("SELECT UPPER(nom_mod_trans) AS nom_mod_trans, id_mod_trans AS id_mod_trans
												FROM mode_transport ");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_march'])) && ($id_march == $_GET['id_march']) && (isset($id_march)) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="dossier.php?id_march=<?php echo $id_march;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['nom_mod_trans'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuModeTransportClient($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			$requete = $connexion-> prepare("SELECT UPPER(nom_mod_trans) AS nom_mod_trans, id_mod_trans AS id_mod_trans
												FROM mode_transport
												WHERE id_mod_trans IN(
													SELECT DISTINCT(id_mod_trans)
													FROM dossier
													WHERE id_cli = ?
														AND id_mod_lic = ?
											)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="dossier.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&commodity=" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['nom_mod_trans'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuModeTransportClientExport($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			//On recupere Les marchandises
			$requeteMarchandise = $connexion-> prepare('SELECT m.id_march AS id_march,
																UPPER(m.nom_march) AS nom_march
															FROM marchandise m, affectation_marchandise_client_modele_licence a
															WHERE m.id_march = a.id_march
																AND a.id_cli = ?
																AND a.id_mod_lic = ?');
			$requeteMarchandise-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseMarchandise = $requeteMarchandise-> fetch()) {
				?>
				<li class="nav-item has-treeview">
	                <a href="#" class="nav-link">
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-minus nav-icon"></i>
	                  <p><?php echo $reponseMarchandise['nom_march'];?></p>
	                </a>
	                <ul class="nav nav-treeview">
	                <?php

						$requete = $connexion-> prepare("SELECT DISTINCT(id_mod_trans) AS id_mod_trans ,
															UPPER(nom_mod_trans) AS nom_mod_trans
														FROM mode_transport
														WHERE id_mod_trans IN(
																	SELECT id_mod_trans FROM dossier
																		WHERE id_cli = ?
																)");
						$requete-> execute(array($entree['id_cli']));
						while ($reponse = $requete-> fetch()) {
							if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
								$style = 'style="font-weight: bold; color: white;"';
							}else{
								$style = '';
							}
						?>
							<li class="nav-item">
				                <a href="dossier.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>&commodity=" class="nav-link" <?php echo $style;?>>
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
				                  <p><?php echo $reponse['nom_mod_trans'];?></p>
				                </a>
				            </li>
						<?php
						}$requete-> closeCursor();
	                ?>
	                </ul>
	            </li>
				<?php
			}$requeteMarchandise-> closeCursor();
		}

		public function afficherMenuMarchandiseClientModeleLicenceFacturation($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			//On recupere Les marchandises
			$requeteMarchandise = $connexion-> prepare("SELECT m.id_march AS id_march,
																UPPER(m.nom_march) AS nom_march
															FROM marchandise m, affectation_marchandise_client_modele_licence a
															WHERE m.id_march = a.id_march
																AND a.id_cli = ?
																AND a.id_mod_lic = ?
																AND a.menu_tracking = '1'
															ORDER BY m.nom_march ASC");
			$requeteMarchandise-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseMarchandise = $requeteMarchandise-> fetch()) {

				if (isset($_GET['id_march']) && ($_GET['id_march']==$reponseMarchandise['id_march']) && isset($_GET['id_cli']) && ($_GET['id_cli']==$id_cli)) {
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				

				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
	                <a href="#" class="nav-link <?php echo $active;?>">
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-minus nav-icon"></i>
	                  <p><?php echo $reponseMarchandise['nom_march'];?></p>
	                </a>
	                <ul class="nav nav-treeview">
	                <?php

	                //On recupère les modes de transport
	                if ($id_cli != '928') {
	                	$requete = $connexion-> prepare("SELECT DISTINCT(id_mod_trans) AS id_mod_trans ,
															UPPER(nom_mod_trans) AS nom_mod_trans
														FROM mode_transport
														WHERE id_mod_trans IN(
																	SELECT id_mod_trans FROM dossier
																		WHERE id_cli = ?
																			AND id_mod_lic = ?
																)
															AND id_mod_trans <> 6");
						$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
						while ($reponse = $requete-> fetch()) {
							if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
								$style = 'style="font-weight: bold; color: white;"';
							}else{
								$style = '';
							}

							if ($id_cli == 928) {
							?>
							<li class="nav-item">
				                <a href="nouvelleFactureGlobaleFRONTExport.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>&commodity=" class="nav-link" <?php echo $style;?>>
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
				                  <p><?php echo $reponse['nom_mod_trans'];?></p>
				                </a>
				            </li>
							<?php
							}else{
							?>
							<li class="nav-item">
				                <a href="nouvelleFactureGlobaleExport.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>&commodity=" class="nav-link" <?php echo $style;?>>
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
				                  <p><?php echo $reponse['nom_mod_trans'];?></p>
				                </a>
				            </li>
							<?php
							}
						
						}$requete-> closeCursor();
	                }//FIN On recupère les modes de transport
	                else if ($id_cli == '928') {//On recupère les licences
	                	$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic
	                										FROM licence l, dossier dos
	                										WHERE l.id_cli = ?
	                											AND l.id_mod_lic = ?
	                											AND l.num_lic = dos.num_lic
	                											AND dos.ref_quit IS NOT NULL
	                											AND dos.date_quit IS NOT NULL
	                											AND dos.date_trans_fact IS NOT NULL
	                											AND dos.id_dos NOT IN (
	                													SELECT id_dos
	                														FROM detail_facture_dossier
	                												)
	                											AND dos.date_trans_fact IS NOT NULL
	                										GROUP BY l.num_lic");
						$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
						while ($reponse = $requete-> fetch()) {
							if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['num_lic'])) && ($reponse['num_lic'] == $_GET['num_lic']) ){
								$style = 'style="font-weight: bold; color: white;"';
							}else{
								$style = '';
							}

							?>
							<li class="nav-item">
				                <a href="nouvelleFactureGlobaleFRONTExport.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;num_lic=<?php echo $reponse['num_lic'];?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>&commodity=" class="nav-link" <?php echo $style;?>>
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
				                  <p><?php echo $reponse['num_lic'];?></p>
				                </a>
				            </li>
							<?php
							
						}$requete-> closeCursor();
	                }
	                //FIN On recupère les modes de transport
	                ?>
	                </ul>
	            </li>
				<!-- <li class="nav-item <?php echo $open;?>  <?php echo $active;?>">
	                <a href="nouvelleFactureGlobaleExport.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>&amp;id_t_trans=1" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponseMarchandise['nom_march'];?></p>
	                </a>
	            </li> -->
				<?php
			}$requeteMarchandise-> closeCursor();

						
		}

		public function afficherMenuMarchandiseClientModeleLicenceFacturationFrontier($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			//On recupere Les marchandises
			$requeteLicence = $connexion-> prepare("SELECT l.num_lic AS num_lic
	                										FROM licence l, dossier dos
	                										WHERE l.id_cli = ?
	                											AND l.id_mod_lic = ?
	                											AND dos.num_lic LIKE CONCAT(SUBSTRING(l.num_lic, 1, 10), '%')
	                											AND dos.ref_quit IS NOT NULL
	                											AND dos.date_quit IS NOT NULL
	                											AND dos.date_trans_fact IS NOT NULL
	                											AND dos.id_dos NOT IN (
	                													SELECT det.id_dos
	                														FROM detail_facture_dossier det, facture_dossier fd
	                														WHERE det.ref_fact = fd.ref_fact
	                															AND fd.validation <> '2'
	                												)
	                											AND dos.date_trans_fact IS NOT NULL
	                										GROUP BY l.num_lic");
			$requeteLicence-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseLicence = $requeteLicence-> fetch()) {

				if (isset($_GET['num_lic']) && ($_GET['num_lic']==$reponseLicence['num_lic']) && isset($_GET['id_cli']) && ($_GET['id_cli']==$id_cli)) {
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				

				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
	                <a href="#" class="nav-link <?php echo $active;?>">
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-minus nav-icon"></i>
	                  <p><?php echo $reponseLicence['num_lic'];?></p>
	                </a>
	                <ul class="nav nav-treeview">
						<li class="nav-item">
			                <a href="factureFrontierEnAttente.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;num_lic=<?php echo $reponseLicence['num_lic'];?>&commodity=" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-spinner nav-icon"></i>
			                  <p>
			                  	En cours
			                  	<sup>
			                  		<span class="badge badge-primary">
			                  			<?php
			                  			echo $this-> getNombreFactureDossierEnCoursLicence($reponseLicence['num_lic'])
			                  			?>
			                  		</span>
			                  	</sup>
			                  </p>
			                </a>
			            </li>
						<li class="nav-item">
			                <a href="nouvelleFactureGlobaleFRONTExport.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;num_lic=<?php echo $reponseLicence['num_lic'];?>&commodity=" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plus nav-icon"></i>
			                  <p>
			                  	Nouvelle Facture
			                  	<sup>
			                  		<span class="badge badge-primary">
			                  			<?php
			                  			echo $this-> getNombreFactureDossierNonFactureLicence($reponseLicence['num_lic'])
			                  			?>
			                  		</span>
			                  	</sup>
			                  </p>
			                </a>
			            </li>
	                </ul>
	            </li>
				<?php
			}$requeteLicence-> closeCursor();

						
		}

		public function afficherMenuMarchandiseClientModeleLicenceFacturationTransfertLocal($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			//On recupere Les marchandises
			$requeteMarchandise = $connexion-> prepare("SELECT m.id_march AS id_march,
																UPPER(m.nom_march) AS nom_march
															FROM marchandise m, affectation_marchandise_client_modele_licence a
															WHERE m.id_march = a.id_march
																AND a.id_cli = ?
																AND a.id_mod_lic = ?
																AND a.menu_tracking = '1'
															ORDER BY m.nom_march ASC");
			$requeteMarchandise-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseMarchandise = $requeteMarchandise-> fetch()) {

				if (isset($_GET['id_march']) && ($_GET['id_march']==$reponseMarchandise['id_march']) && isset($_GET['id_cli']) && ($_GET['id_cli']==$id_cli)) {
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				

				?>
				<li class="nav-item <?php echo $open;?>  <?php echo $active;?>">
	                <a href="nouvelleFactureTransfertLocal.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>&amp;id_t_trans=6" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponseMarchandise['nom_march'];?>
	                  	<sup><?php 
	                  		if ($this-> getNbreDossierEnAttenteFactureTransfertLocal($id_mod_lic, $id_cli, $reponseMarchandise['id_march'])>='0') {
	                  			echo '<b><span style="color: red;">'.$this-> getNbreDossierEnAttenteFactureTransfertLocal($id_mod_lic, $id_cli, $reponseMarchandise['id_march']).'</span></b>';
	                  		}
	                  	?></sup>
	                  </p>
	                </a>
	            </li>
				<?php
			}$requeteMarchandise-> closeCursor();
		}

		public function afficherMenuMarchandiseClientModeleLicence($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			//On recupere Les marchandises
			$requeteMarchandise = $connexion-> prepare("SELECT m.id_march AS id_march,
																UPPER(m.nom_march) AS nom_march
															FROM marchandise m, affectation_marchandise_client_modele_licence a
															WHERE m.id_march = a.id_march
																AND a.id_cli = ?
																AND a.id_mod_lic = ?
																AND a.menu_tracking = '1'
															ORDER BY m.nom_march ASC");
			$requeteMarchandise-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseMarchandise = $requeteMarchandise-> fetch()) {

				if (isset($_GET['id_march']) && ($_GET['id_march']==$reponseMarchandise['id_march']) && isset($_GET['id_cli']) && ($_GET['id_cli']==$id_cli)) {
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				

				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
	                <a href="#" class="nav-link <?php echo $active;?>">
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-minus nav-icon"></i>
	                  <p><?php echo $reponseMarchandise['nom_march'];?></p>
	                </a>
	                <ul class="nav nav-treeview">
	                <?php

						$requete = $connexion-> prepare("SELECT DISTINCT(id_mod_trans) AS id_mod_trans ,
															UPPER(nom_mod_trans) AS nom_mod_trans
														FROM mode_transport
														WHERE id_mod_trans IN(
																	SELECT id_mod_trans FROM dossier
																		WHERE id_cli = ?
																			AND id_mod_lic = ?
																)");
						$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
						while ($reponse = $requete-> fetch()) {
							if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
								$style = 'style="font-weight: bold; color: white;"';
							}else{
								$style = '';
							}
						?>
							<li class="nav-item">
				                <a href="dossier.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>&commodity=" class="nav-link" <?php echo $style;?>>
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
				                  <p><?php echo $reponse['nom_mod_trans'];?></p>
				                </a>
				            </li>
						<?php
						}$requete-> closeCursor();
	                ?>
	                </ul>
	            </li>
				<?php
			}$requeteMarchandise-> closeCursor();
		}

		public function afficherMenuMarchandiseClientModeleLicence2($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			//On recupere Les marchandises
			$requeteMarchandise = $connexion-> prepare("SELECT m.id_march AS id_march,
																UPPER(m.nom_march) AS nom_march
															FROM marchandise m, affectation_marchandise_client_modele_licence a
															WHERE m.id_march = a.id_march
																AND a.id_cli = ?
																AND a.id_mod_lic = ?
																AND a.menu_tracking = '1'
															ORDER BY m.nom_march ASC");
			$requeteMarchandise-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseMarchandise = $requeteMarchandise-> fetch()) {

				if (isset($_GET['id_march']) && ($_GET['id_march']==$reponseMarchandise['id_march']) && isset($_GET['id_cli']) && ($_GET['id_cli']==$id_cli)) {
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				

				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
	                <a href="#" class="nav-link <?php echo $active;?>">
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-minus nav-icon"></i>
	                  <p><?php echo $reponseMarchandise['nom_march'];?></p>
	                </a>
	                <ul class="nav nav-treeview">
	                <?php

						$requete = $connexion-> prepare("SELECT DISTINCT(id_mod_trans) AS id_mod_trans ,
															UPPER(nom_mod_trans) AS nom_mod_trans
														FROM mode_transport
														WHERE id_mod_trans = 1 OR id_mod_trans = 4
														-- WHERE id_mod_trans IN(
																	-- SELECT id_mod_trans FROM dossier
																	-- 	WHERE id_cli = ?
																	-- 		AND id_mod_lic = ?
																-- )");
						$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
						while ($reponse = $requete-> fetch()) {
							if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
								$style = 'style="font-weight: bold; color: white;"';
							}else{
								$style = '';
							}
						?>
							<li class="nav-item">
				                <a href="licence2.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>&commodity=" class="nav-link" <?php echo $style;?>>
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
				                  <p><?php echo $reponse['nom_mod_trans'];?></p>
				                </a>
				            </li>
						<?php
						}$requete-> closeCursor();
	                ?>
	                </ul>
	            </li>
				<?php
			}$requeteMarchandise-> closeCursor();
		}

		public function afficherMenuModeTransportDashboard($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$style = '';

			$requete = $connexion-> prepare("SELECT DISTINCT(id_mod_trans) AS id_mod_trans,
													UPPER(nom_mod_trans) AS nom_mod_trans
												FROM mode_transport
												WHERE id_mod_trans IN (
													SELECT DISTINCT(id_mod_trans) AS id_mod_trans
														FROM dossier
														WHERE id_mod_lic = ?
												)
											");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="dashboardDossier.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&commodity=" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['nom_mod_trans'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuLicenceClient($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			$requete = $connexion-> prepare("SELECT num_lic
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
												ORDER BY date_creat_lic DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && ($reponse['num_lic'] == $_GET['num_lic']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="dossier.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;num_lic=<?php echo $reponse['num_lic'];?>" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['num_lic'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMarchandiseDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT md.nom_march AS nom_march,
													md.code_tarif_march AS code_tarif_march,
													md.*,
													unit.nom_unit_mes AS nom_unit_mes,
													UPPER(emb.nom_emb) AS nom_emb,
													mon.sig_mon AS sig_mon,
													mon.id_mon AS id_mon
												FROM marchandise_dossier md, emballage emb, unite_mesure unit, monnaie mon
												WHERE md.id_dos = ?
													AND md.id_emb = emb.id_emb
													AND md.id_unit_mes = unit.id_unit_mes
													AND md.id_mon = mon.id_mon
												ORDER BY md.id_march_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modaleDeleteMarchandiseDossier.php');
				include('modalEditMarchandiseDossier.php');
			?>
			<tr>
				<td>
					<?php echo $compteur;?>
				</td>
				<td>
					<?php echo $reponse['code_tarif_march'];?>
				</td>
				<td>
					<?php echo $reponse['nom_march'];?>
				</td>
				<td>
					<?php echo $reponse['origine'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['nbr_bags'], 2, ',', ' ');?>
				</td>
				<td>
					<?php echo $reponse['nom_emb'];?>
				</td>
				<td>
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td>
					<?php echo $reponse['supplier'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids_brut'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fret'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['assurance'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?>
				</td>
				<td>
					<?php echo $reponse['num_av'];?>
				</td>
				<td>
					<?php echo $reponse['num_lic'];?>
				</td>
				<td>
					<?php echo $reponse['fxi'];?>
				</td>
				<td>
					<?php echo $reponse['num_exo'];?>
				</td>
				<td>
					<span class="btn btn-warning btn-sm square-btn-adjust" data-toggle="modal" data-target=".editMarchandiseDossier_<?php echo $reponse['id_march_dos'];?>">
	                    <i class="fa fa-edit"></i>
	                </span>
					<span class="btn btn-danger btn-sm square-btn-adjust" data-toggle="modal" data-target=".deleteMarchandiseDossier_<?php echo $reponse['id_march_dos'];?>">
	                    <i class="fa fa-times"></i>
	                </span>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherEnTeteTableau($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

            if ($_GET['id_mod_lic'] == '1') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 869';
				}

            }else if ($_GET['id_mod_lic'] == '2') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 857';
				}

            }

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    $sqlClient
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang_tracking ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">#</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">NUMERO DOSSIER</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;"></th>
			<?php
			while ($reponse = $requete-> fetch()) {

			?>
			<th style="border: 1px solid white;"><?php echo $reponse['titre_col'];?></th>
			<?php

			}$requete-> closeCursor();
			?>
		      <th style="border: 1px solid white;">
		      	FILE STATUS
		      </th>
		      <th style="border: 1px solid white;">
		      	LOCATION
		      </th>
		      <th style="border: 1px solid white;">
		      	DOCUMENTS STATUS
		      </th>
			</tr>
			<?php
		}

		public function afficherEnTeteTableauDeboursFactureGlobale($id_march, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_trans'] = $id_mod_trans;
			//$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;

			?>
			<th style="border: 1px solid white;">
				DROITS (CDF)
			</th>
			<!-- <th style="border: 1px solid white;">
				LSE (CDF)
			</th> -->
			<?php

			$requete = $connexion-> prepare("SELECT deb.abr_deb_2 AS abr_deb_2,
													deb.id_deb AS id_deb
												FROM debours deb, affectation_debours_marchandise af
												WHERE af.id_deb = deb.id_deb
													AND af.id_march = ?
												ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_march']));
			while ($reponse = $requete-> fetch()) {

			?>
			<th style="border: 1px solid white;">
				<?php echo $reponse['abr_deb_2'];?> ($)
			</th>
			<?php

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("SELECT deb.abr_deb_2 AS abr_deb_2,
													deb.id_deb AS id_deb
												FROM debours deb, affectation_debours_client_modele_licence af
												WHERE af.id_deb = deb.id_deb
													AND af.id_cli = ?
													AND af.id_mod_lic = ?
													AND af.id_mod_trans = ?
													AND deb.id_t_deb <> 1
													AND deb.id_deb <> 81
													AND deb.id_deb <> 82
												-- ORDER BY af.rang ASC ");
			$requete-> execute(array($_GET['id_cli'], $_GET['id_mod_lic_fact'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {

			?>
			<th style="border: 1px solid white;">
				<?php echo $reponse['abr_deb_2'];?> ($)
			</th>
			<?php

			}$requete-> closeCursor();

		}

		public function afficherLigneTableauDeboursFactureGlobale($id_march, $id_dos, $compteur){
			include('connexion.php');
			//$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$compteurDebours = 0;
			$compteurDebours++;

			?>
			<td style="border: 1px solid white;">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="27">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input style="width: 12em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="" step="0.000001" required>
			</td>
			<?php
			/*
			$compteurDebours++;
			?>
			<td style="border: 1px solid white;">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="127">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input style="width: 12em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="" step="0.000001" required>
			</td>
			<?php
			*/
			$requete = $connexion-> prepare("SELECT deb.abr_deb_2 AS abr_deb_2,
													deb.id_deb AS id_deb,
													af.*
												FROM debours deb, affectation_debours_marchandise af
												WHERE af.id_deb = deb.id_deb
													AND af.id_march = ?
												ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_march']));
			while ($reponse = $requete-> fetch()) {
				$compteurDebours++;
			?>
			<td style="">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['id_deb'];?>">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<?php 
				if($reponse['id_deb']=='8'){
					$montant = 0;
					// if ($this-> getDossier($id_dos)['id_mod_trans']=='4') {
					// 	$montant += 420;
					// }else{
						if ((strlen(trim($this-> getDossier($id_dos)['horse']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
							$montant += 140; 
						}
						if ((strlen(trim($this-> getDossier($id_dos)['trailer_1']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
							$montant += 140; 
						}
						if ((strlen(trim($this-> getDossier($id_dos)['trailer_2']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
							$montant += 140; 
						}
					// }
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else if($reponse['id_deb']=='37'){
					$montant = 0;
					if (($this-> getDossier($id_dos)['poids']/1000)>='30') {
						// $montant = 250; 
						$montant = 800; 
					}else{
						// $montant = 125; 
						$montant = 600; 
					}
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else if($reponse['id_deb']=='81' && ($entree['id_march']=='1' || $entree['id_march']=='56')){
					$montant = 0;
					$montant = ($this-> getDossier($id_dos)['poids']/1000)*5;
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else if($reponse['id_deb']=='81' && $entree['id_march']=='13'){
					$montant = 0;
					$montant = ($this-> getDossier($id_dos)['poids']/1000)*8;
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else if($reponse['id_deb']=='43'){
					$montant = ($this-> getDossier($id_dos)['poids_brut']/1000)*3;
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else{
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['montant'];?>" step="0.0001">
				<?php
				}
				?>
			</td>
			<?php

			}$requete-> closeCursor();

			$compteurDebours++;

			$requete = $connexion-> prepare("SELECT deb.abr_deb_2 AS abr_deb_2,
													deb.id_deb AS id_deb,
													af.*
												FROM debours deb, affectation_debours_client_modele_licence af
												WHERE af.id_deb = deb.id_deb
													AND af.id_cli = ?
													AND af.id_mod_lic = ?
													AND af.id_mod_trans = ?
													AND deb.id_t_deb <> 1
													AND deb.id_deb <> 81
													AND deb.id_deb <> 82");
			$requete-> execute(array($_GET['id_cli'], $_GET['id_mod_lic_fact'], $_GET['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				if($reponse['id_deb']=='10' || $reponse['id_deb']=='80'){
					?>
			<td style="">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['id_deb'];?>">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">

				<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['montant'];?>" step="0.0001">
			</td>
			<?php

				}else if($reponse['id_deb']=='23'){
					$montant = 0;
					if ((strlen(trim($this-> getDossier($id_dos)['trailer_1']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
						$montant += 30; 
					}
					if ((strlen(trim($this-> getDossier($id_dos)['trailer_2']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
						$montant += 30; 
					}
				?>
				<td style="">
					<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['id_deb'];?>">
					<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
					<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">

					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				</td>
				<?php
				}else{
					?>
			<td style="">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['id_deb'];?>">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">

				<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['montant'];?>" step="0.0001">
			</td>
			<?php

				}
			
				$compteurDebours++;

			}$requete-> closeCursor();

			?>
			<input type="hidden" name="compteurDebours" value="<?php echo $compteurDebours;?>">
			<?php

		}

		public function afficherLigneTableauDeboursFactureGlobaleEdit($ref_fact, $id_march, $id_dos, $compteur){
			include('connexion.php');
			//$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$compteurDebours = 0;
			$compteurDebours++;

			?>
			<td style="border: 1px solid white;">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="27">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input style="width: 12em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $this-> getMontantFactureDeboursDossier3($ref_fact, 27, $id_dos);?>" step="0.000001">
			</td>
			<?php
			/*
			$compteurDebours++;
			?>
			<td style="border: 1px solid white;">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="127">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input style="width: 12em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $this-> getMontantFactureDeboursDossier3($ref_fact, 127, $id_dos);?>" step="0.000001">
			</td>
			<?php
			*/
			$requete = $connexion-> prepare("SELECT deb.abr_deb_2 AS abr_deb_2,
													deb.id_deb AS id_deb,
													af.*
												FROM debours deb, affectation_debours_marchandise af
												WHERE af.id_deb = deb.id_deb
													AND af.id_march = ?
												ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_march']));
			while ($reponse = $requete-> fetch()) {
				$compteurDebours++;
			?>
			<td style="">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['id_deb'];?>">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<?php 
				if($reponse['id_deb']=='8'){
					$montant = 0;
					// if ($this-> getDossier($id_dos)['id_mod_trans']=='4') {
					// 	$montant += 420;
					// }else{
						if ((strlen(trim($this-> getDossier($id_dos)['horse']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
							$montant += 140; 
						}
						if ((strlen(trim($this-> getDossier($id_dos)['trailer_1']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
							$montant += 140; 
						}
						if ((strlen(trim($this-> getDossier($id_dos)['trailer_2']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
							$montant += 140; 
						}
					// }
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else if($reponse['id_deb']=='37'){
					$montant = 0;
					if (($this-> getDossier($id_dos)['poids']/1000)>='30') {
						// $montant = 250; 
						$montant = 800; 
					}else{
						// $montant = 125; 
						$montant = 600; 
					}
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else if($reponse['id_deb']=='81' && $entree['id_march']=='1'){
					$montant = 0;
					$montant = ($this-> getDossier($id_dos)['poids']/1000)*5;
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else if($reponse['id_deb']=='81' && $entree['id_march']=='13'){
					$montant = 0;
					$montant = ($this-> getDossier($id_dos)['poids']/1000)*8;
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else if($reponse['id_deb']=='43'){
					$montant = ($this-> getDossier($id_dos)['poids_brut']/1000)*3;
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
				<?php
				}else{
				?>
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['montant'];?>" step="0.0001">
				<?php
				}
				?>
			</td>
			<?php

			}$requete-> closeCursor();

			$compteurDebours++;

			$requete = $connexion-> prepare("SELECT deb.abr_deb_2 AS abr_deb_2,
													deb.id_deb AS id_deb,
													af.*
												FROM debours deb, affectation_debours_client_modele_licence af
												WHERE af.id_deb = deb.id_deb
													AND af.id_cli = ?
													AND af.id_mod_lic = ?
													AND af.id_mod_trans = ?
													AND deb.id_t_deb <> 1
													AND deb.id_deb <> 81
													AND deb.id_deb <> 82");
			$requete-> execute(array($_GET['id_cli'], $_GET['id_mod_lic_fact'], $_GET['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {

				if($reponse['id_deb']=='10' || $reponse['id_deb']=='80'){
			?>
			<td style="">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['id_deb'];?>">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">

				<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['montant'];?>" step="0.0001">
			</td>
			<?php
			}else if($reponse['id_deb']=='23'){
				$montant = 0;
				if ((strlen(trim($this-> getDossier($id_dos)['trailer_1']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
					$montant += 30; 
				}
				if ((strlen(trim($this-> getDossier($id_dos)['trailer_2']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
					$montant += 30; 
				}
			?>
			<td style="">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['id_deb'];?>">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="0">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">

				<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $montant;?>" step="0.0001">
			</td>
			<?php
			}else{
			?>
			<td style="">
				<input type="hidden" name="id_deb_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['id_deb'];?>">
				<input type="hidden" name="tva_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">
				<input type="hidden" name="usd_<?php echo $id_dos.'_'.$compteurDebours;?>" value="1">

				<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $id_dos.'_'.$compteurDebours;?>" value="<?php echo $reponse['montant'];?>" step="0.0001">
			</td>
			<?php
			}
				$compteurDebours++;

			}$requete-> closeCursor();

			?>
			<input type="hidden" name="compteurDebours" value="<?php echo $compteurDebours;?>">
			<?php

		}

		public function afficherEnTeteTableauLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			// $entree['id_mod_trans'] = $id_mod_trans;


			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
											FROM colonne c, affectation_colonne_modele_licence af
											WHERE c.id_col = af.id_col
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			?>
		    <tr class="bg bg-dark">
		      <th style="">#</th>
		      <th style="">NUMERO LICENCE</th>
		      <!-- <th style="border: 1px solid white; background-color: #222530; color: white;"></th> -->
			<?php
			while ($reponse = $requete-> fetch()) {

			?>
			<th style=""><?php echo $reponse['titre_col'];?></th>
			<?php

			}$requete-> closeCursor();
			?>
			<th style="">ACTION</th>
			</tr>
			<?php
		}

		public function afficherEnTeteTableauUtilisateur($id_mod_lic, $id_util, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
											FROM colonne c, utilisateur u, affectation_colonne_utilisateur af
											WHERE c.id_col = af.id_col
												AND af.id_util = u.id_util
											    AND af.id_mod_lic = ?
											    AND af.id_util = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">#</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">NUMERO DOSSIER</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;"></th>
			<?php
			while ($reponse = $requete-> fetch()) {

			?>
			<th style="border: 1px solid white;"><?php echo $reponse['titre_col'];?></th>
			<?php

			}$requete-> closeCursor();
			?>
			<th style="border: 1px solid white;">FILE STATUS</th>
			</tr>
			<?php
		}

		public function afficherEnTeteTableauOps($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

            if ($_GET['id_mod_lic'] == '1') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 869';
				}

            }else if ($_GET['id_mod_lic'] == '2') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 857';
				}

            }

			$requete = $connexion-> prepare("SELECT d.nom_dep AS nom_dep
											FROM depense d, client cl, affectation_depense_client af
											WHERE d.id_dep = af.id_dep
												AND af.id_cli = cl.id_cli
											    $sqlClient
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 1px solid white; background-color: #222530; color: white;">#</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" colspan="">NUMERO DOSSIER</th>
		      <th style="border: 1px solid white; text-align: center;" colspan="2">RENTABILITE ($)</th>
			<?php
			while ($reponse = $requete-> fetch()) {

			?>
			<th style="text-align: center;border: 1px solid white; " colspan="2">
				<?php echo $reponse['nom_dep'];?> ($)
			</th>
			<?php

			}$requete-> closeCursor();
			?>
		      <th style="border: 1px solid white; background-color: #222530; color: white; text-align: center;" colspan="2">RENTABILITE ($)</th>
			</tr>
			<?php
		}

		public function afficherRowTableauFinOPS($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$comp = 'a';
			$bg = '';

			$requete = $connexion-> prepare("SELECT d.nom_dep AS nom_dep, d.id_dep AS id_dep
											FROM depense d, client cl, affectation_depense_client af
											WHERE d.id_dep = af.id_dep
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($this-> getDataRowFinOPS($reponse['id_dep'], $id_dos)==NULL) {
					$disabled = '';
					$style = 'background-color: rgb(105,105,105); color: white; font-weight: bold; color: rgb(255,215,0);';
				}else{
					$disabled = 'disabled';
					$style = 'font-weight: bold;';
				}
				?>
				<input type="hidden" name="id_dep_<?php echo $id_dos.'_'.$comp.'_'.$compteur;?>" value="<?php echo $reponse['id_dep'];?>">
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<input type="number" style=" <?php echo $style;?> text-align: right;" step="0.5" min="1" name="montant_<?php echo $id_dos.'_'.$reponse['id_dep'].'_'.$compteur;?>" value="<?php echo $this-> getDataRowFinOPS($reponse['id_dep'], $id_dos)['montant'];?>" <?php echo $disabled;?>>
				</td>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
					<input type="date" style=" <?php echo $style;?>" name="date_dep_<?php echo $id_dos.'_'.$reponse['id_dep'].'_'.$compteur;?>" value="<?php echo $this-> getDataRowFinOPS($reponse['id_dep'], $id_dos)['date_dep'];?>"  <?php echo $disabled;?> >
				</td>
				<?php
				$comp++;
			}$requete-> closeCursor();
			?><input type="hidden" name="alpha" value="<?php echo $comp;?>"><?php
		}

		public function afficherEnTeteTableauEncodeur($id_mod_lic, $id_util, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;
			$entree['id_mod_trans'] = $id_mod_trans;

			if (isset($id_util) && ($id_util!='')) {
				$sqlClient = ' AND util.id_util = "'.$id_util.'"';
			}else{
				$sqlClient = '';
			}

            if ($_GET['id_mod_trac'] == '1') {

				if (isset($id_util) && ($id_util!='')) {
					$sqlClient = ' AND util.id_util = "'.$id_util.'"';
				}else{
					$sqlClient = ' AND util.id_util = 869';
				}

            }else if ($_GET['id_mod_trac'] == '2') {

				if (isset($id_util) && ($id_util!='')) {
					$sqlClient = ' AND util.id_util = "'.$id_util.'"';
				}else{
					$sqlClient = ' AND util.id_util = 857';
				}

            }

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
											FROM colonne c, utilisateur util, affectation_colonne_utilisateur af
											WHERE c.id_col = af.id_col
												AND af.id_util = util.id_util
											    $sqlClient
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">#</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">NUMERO DOSSIER</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;"></th>
			<?php
			while ($reponse = $requete-> fetch()) {

			?>
			<th style="border: 1px solid white;"><?php echo $reponse['titre_col'];?></th>
			<?php

			}$requete-> closeCursor();
			?>
		      <th style="border: 1px solid white;">
		      	FILE STATUS
		      </th>
		      <th style="border: 1px solid white;">
		      	LOCATION
		      </th>
		      <th style="border: 1px solid white;">
		      	DOCUMENTS STATUS
		      </th>
			</tr>
			<?php
		}

		public function afficherEnTeteTableauEncodeur2($id_mod_lic, $id_util, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;
			$entree['id_mod_trans'] = $id_mod_trans;

			if (isset($id_util) && ($id_util!='')) {
				$sqlClient = ' AND util.id_util = "'.$id_util.'"';
			}else{
				$sqlClient = '';
			}

            if ($_GET['id_mod_trac'] == '1') {

				if (isset($id_util) && ($id_util!='')) {
					$sqlClient = ' AND util.id_util = "'.$id_util.'"';
				}else{
					$sqlClient = ' AND util.id_util = 869';
				}

            }else if ($_GET['id_mod_trac'] == '2') {

				if (isset($id_util) && ($id_util!='')) {
					$sqlClient = ' AND util.id_util = "'.$id_util.'"';
				}else{
					$sqlClient = ' AND util.id_util = 857';
				}

            }

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
											FROM colonne c, utilisateur util, affectation_colonne_utilisateur af
											WHERE c.id_col = af.id_col
												AND af.id_util = util.id_util
											    $sqlClient
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">#</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">NUMERO DOSSIER</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;"></th>
			<?php
			while ($reponse = $requete-> fetch()) {

			?>
			<th style="border: 1px solid white;" class="bg bg-dark"><?php echo $reponse['titre_col'];?></th>
			<?php

			}$requete-> closeCursor();
			?>
			</tr>
			<?php
		}

		public function afficherEnTeteTableauEncodeurPopUp($id_mod_lic, $id_util, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;
			$entree['id_mod_trans'] = $id_mod_trans;

			if (isset($id_util) && ($id_util!='')) {
				$sqlClient = ' AND util.id_util = "'.$id_util.'"';
			}else{
				$sqlClient = '';
			}

            if ($_GET['id_mod_trac'] == '1') {

				if (isset($id_util) && ($id_util!='')) {
					$sqlClient = ' AND util.id_util = "'.$id_util.'"';
				}else{
					$sqlClient = ' AND util.id_util = 869';
				}

            }else if ($_GET['id_mod_trac'] == '2') {

				if (isset($id_util) && ($id_util!='')) {
					$sqlClient = ' AND util.id_util = "'.$id_util.'"';
				}else{
					$sqlClient = ' AND util.id_util = 857';
				}

            }

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
											FROM colonne c, utilisateur util, affectation_colonne_utilisateur af
											WHERE c.id_col = af.id_col
												AND af.id_util = util.id_util
											    $sqlClient
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											    AND af.view_pop_up = '1'
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">#</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">NUMERO DOSSIER</th>
			<?php
			if (isset($_GET['etat']) && ($_GET['etat']!='')) {
			?>
			  <th style="border: 1px solid white; background-color: #222530; color: white;">ARRIVEE SUR SITE</th>
			<?php
			}
			while ($reponse = $requete-> fetch()) {

			?>
			<th style="border: 1px solid white;"><?php echo $reponse['titre_col'];?></th>
			<?php

			}$requete-> closeCursor();
			?>
			</tr>
			<?php
		}

		public function afficherEnTeteTableauPopUp($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

            if ($_GET['id_mod_lic'] == '1') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 883';
				}

            }else if ($_GET['id_mod_lic'] == '2') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 883';
				}

            }

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    $sqlClient
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="col_1">#</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="col_6">MCA File REF</th>
			<?php
			while ($reponse = $requete-> fetch()) {

			?>
			<th style="border: 1px solid white;"><?php echo $reponse['titre_col'];?></th>
			<?php

			}$requete-> closeCursor();
			?>
			</tr>
			<?php
		}

		public function afficherCelluleTableauNewExport($id_mod_lic, $id_cli, $id_mod_trans, $id_march){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$i = 1;
			?>
			<tr style="border: 1px solid white;">
				<td style="" class="col_1"><?php echo $i;?></td>
				<td style="border: 0.5px solid black;" class="col_6">
					<input type="text" class="form-control cc-exp" name="ref_dos_<?php echo $i;?>" value="<?php echo $this-> getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $i);?>">
				</td>
				<?php
				if (isset($_GET['num_lic']) && ($_GET['num_lic']!='')) {
					?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 14em;" class="form-control cc-exp" value="<?php echo $_GET['num_lic'];?>" disabled>
					<input type="hidden"name="num_lic_<?php echo $i;?>"name="num_lic_<?php echo $i;?>" value="<?php echo $_GET['num_lic'];?>" >
				</td>
					<?php
				}else{
					?>
				<td style="border: 0.5px solid black;">
					<select name="num_lic_<?php echo $i;?>" style="width: 14em;" onchange="" class="form-control cc-exp">
		              <option value="<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>">
		              	<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>
		              </option>
						<option></option>
		                <?php
		                  $this->selectionnerLicenceModeleClientActive($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_march']);
		                ?>
		            </select>
				</td>
					<?php
				}
				?>
				<td style="border: 0.5px solid black;">
					<input type="date" style="width: 10em;" class="form-control cc-exp" name="load_date_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" value="<?php echo $this-> getClient($id_cli)['site'];?>" style="width: 10em;" class="form-control cc-exp" name="site_load_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="destination_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="horse_<?php echo $i;?>">
				</td>
				<?php
				if ($id_mod_trans != '4') {
				?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
				</td>
				<?php
				} else {
				?>
				<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
				<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
				<?php
				}
				?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="nbr_bags_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="number" step="0.001" style="width: 10em;" class="form-control cc-exp" name="poids_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="num_lot_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="dgda_seal_<?php echo $i;?>">
				</td>
				<?php
				if ($id_mod_trans != '4') {
				?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="transporter_<?php echo $i;?>">
				</td>
				<?php
				} else {
				?>
				<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="transporter_<?php echo $i;?>">
				<?php
				}
				?>
			</tr>
			<?php
			for ($i=2; $i <=10 ; $i++) {
				?>
				<tr style="border: 1px solid white;">
					<td style="" class="col_1"><?php echo $i;?></td>
					<td style="border: 0.5px solid black;" class="col_6">
						<input type="text" class="form-control cc-exp" name="ref_dos_<?php echo $i;?>" value="<?php echo $this-> getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $i, ($i-1));?>">
					</td>
					<?php
					if (isset($_GET['num_lic']) && ($_GET['num_lic']!='')) {
						?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 14em;" class="form-control cc-exp" value="<?php echo $_GET['num_lic'];?>" disabled>
						<input type="hidden"name="num_lic_<?php echo $i;?>"name="num_lic_<?php echo $i;?>" value="<?php echo $_GET['num_lic'];?>" >
					</td>
						<?php
					}else{
						?>
					<td style="border: 0.5px solid black;">
						<select name="num_lic_<?php echo $i;?>" style="width: 14em;" onchange="" class="form-control cc-exp">
			              <option value="<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>">
			              	<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>
			              </option>
							<option></option>
			                <?php
			                  $this->selectionnerLicenceModeleClientActive($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_march']);
			                ?>
			            </select>
					</td>
						<?php
					}
					?>
					<td style="border: 0.5px solid black;">
						<input type="date" style="width: 10em;" class="form-control cc-exp" name="load_date_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" value="<?php echo $this-> getClient($id_cli)['site'];?>" style="width: 10em;" class="form-control cc-exp" name="site_load_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="destination_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="horse_<?php echo $i;?>">
					</td>
					<?php
					if ($id_mod_trans != '4') {
					?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
					</td>
					<?php
					} else {
					?>
					<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
					<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
					<?php
					}
					?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="nbr_bags_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="number" step="0.001" style="width: 10em;" class="form-control cc-exp" name="poids_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="num_lot_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="dgda_seal_<?php echo $i;?>">
					</td>
					<?php
					if ($id_mod_trans != '4') {
					?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="transporter_<?php echo $i;?>">
					</td>
					<?php
					} else {
					?>
					<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="transporter_<?php echo $i;?>">
					<?php
					}
					?>
				</tr>
				<?php
				?>
				<input type="hidden" name="nbre" value="<?php echo $i;?>">
				<?php
			}
		}

		public function afficherCelluleTableauImportDivers($id_mod_lic, $id_cli, $id_mod_trans, $id_march){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$i = 1;
			?>
			<tr style="border: 1px solid white;">
				<td style=""><?php echo $i;?></td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 20em;" class="form-control cc-exp" name="ref_dos[]" value="<?php echo $this-> getMcaFileImport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $i);?>">
				</td>
			</tr>
				<input type="hidden" name="nbre" value="<?php echo $i;?>">
			<?php

		}

		public function afficherEnTeteDossierFacturePartielle($id_dos){
			include('connexion.php');
			$entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$compteur = 0;
			
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
												FROM dossier
												WHERE ref_dos_2 = ?
												ORDER BY ref_dos");
			$requete-> execute(array($entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
				<th style="border: 0.5px solid grey; text-align: center;" colspan="3" >
					<b><u><?php echo $reponse['ref_dos'];?></u></b><br>
					<?php 
						echo $this-> getDossier($reponse['id_dos'])['ref_decl'].' | '.$this-> getDossier($reponse['id_dos'])['ref_liq'].' | '.$this-> getDossier($reponse['id_dos'])['ref_quit'];
					?><br>
					<input type="hidden" name="id_dos_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					Taux: <input type="number" step="0.0001" name="roe_decl_<?php echo $compteur;?>" required>
				</th>
			<?php
			}$requete-> closeCursor();

			echo '<input type="hidden" value="'.$compteur.'" name="nbre">';

		}

		public function afficherEnTeteDossierFacturePartielle2($id_dos){
			include('connexion.php');
			$entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			echo '<td></td>';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
												FROM dossier
												WHERE ref_dos_2 = ?
												ORDER BY ref_dos");
			$requete-> execute(array($entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
			?>
				<td style="border: 0.5px solid black; text-align: center;">
					Montant
				</td>
				<td style="border: 0.5px solid black; text-align: center;">
					Devise
				</td>
				<td style="border: 0.5px solid black; text-align: center;">
					TVA
				</td>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherContactClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT *
												FROM contact_client
												WHERE id_cli = ?");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
			?>
                <strong><?php echo $reponse['nom_cont'];?></strong>

                <p class="text-muted">
                 Tél.: <?php echo $reponse['tel_cont'];?><br>
                 Mail: <?php echo $reponse['mail_cont'];?><br>
                </p>
                <hr>

			<?php
			}$requete-> closeCursor();

		}

		public function afficherActionClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT dom.nom_dom AS nom_dom,
													act.*,
													DATE_FORMAT(act.date_act_cli, '%d/%m/%Y') AS date_act_cli,
													DATE_FORMAT(act.date_create, '%d/%m/%Y %h:%i') AS date_create
												FROM action_client act, domaine_activite dom
												WHERE act.id_cli = ?
													AND act.id_dom = dom.id_dom");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
			?>
				<div class="time-label">
					<span class="bg-info">
					  <?php
					  	echo $reponse['date_act_cli'];
					  ?>
					</span>
				</div>
				<!-- /.timeline-label -->
				<!-- timeline item -->
				<div>
				<i class="fas fa-clock bg-primary"></i>

				<div class="timeline-item">
				  <span class="time">
				  	<i class="far fa-clock"></i>
				  	<?php
					  	echo $reponse['date_create'];
					 ?>
				  </span>

				  <h3 class="timeline-header"><a href="#"><?php echo $reponse['nom_dom'];?></a></h3>

				  <div class="timeline-body">
				    <?php echo $reponse['desi_act_cli'];?>
				  </div>
				  <div class="timeline-footer">
				    <a href="#" class="btn btn-warning btn-sm"><i class="fa fa-edit"></i></a>
				    <a href="#" class="btn btn-danger btn-sm"><i class="fa fa-times"></i></a>
				  </div>
				</div>
				</div>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDomaineClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$compteur=0;

			$requete = $connexion-> prepare("SELECT dom.nom_dom AS nom_dom,
													cat.nom_cat_cli AS nom_cat_cli,
													CONCAT(af.volume,' trucks/mois') AS volume,
													CONCAT(af.target_init,' %') AS target_init,
													CONCAT(af.sales_stage,' %') AS sales_stage,
													ROUND((af.volume*af.honnoraire*(af.target_init/100))) AS valeur,
													DATE_FORMAT(af.forecast, '%d/%m/%Y') AS forecast,
													DATE_FORMAT(af.date_appel_offre, '%d/%m/%Y') AS date_appel_offre,
													af.observation AS observation,
													af.competiteur AS competiteur,
													CONCAT('$ ', af.honnoraire) AS honnoraire
												FROM domaine_activite dom, categorie_client cat, affectation_client_domaine af
												WHERE af.id_cli = ?
													AND af.id_dom = dom.id_dom
													AND af.id_cat_cli = cat.id_cat_cli");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
           	<tr>
           		<td><?php echo $compteur;?></td>
           		<td style="text-align: center;">
           			<?php
           				echo $reponse['nom_dom'];
           			?>
           		</td>
           		<td style="text-align: left;">
           			<?php
           				echo $reponse['competiteur'];
           			?>
           		</td>
           		<td style="text-align: center;">
           			<?php
           				echo $reponse['date_appel_offre'];
           			?>
           		</td>
           		<td style="text-align: center;">
           			<?php
           				echo $reponse['nom_cat_cli'];
           			?>
           		</td>
           		<td style="text-align: center;">
           			<?php
           				echo $reponse['volume'];
           			?>
           		</td>
           		<td style="text-align: center;">
           			<?php
           				echo $reponse['target_init'];
           			?>
           		</td>
           		<td style="text-align: center;">
           			<?php
           				echo $reponse['sales_stage'];
           			?>
           		</td>
           		<td style="text-align: center;">
           			<?php
           				echo $reponse['honnoraire'];
           			?>
           		</td>
           		<td style="text-align: center;">
           			<?php
           				echo '$ '.number_format($reponse['valeur'], 2, ',', ' ');
           			?>
           		</td>
           		<td style="text-align: center;">
           			<?php
           				echo $reponse['forecast'];
           			?>
           		</td>
           		<td style="text-align: left;">
           			<?php
           				echo $reponse['observation'];
           			?>
           		</td>
           	</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherBoutonFormulaireFacturePartielle($id_dos){
			include('connexion.php');
			// $entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$entree['id_dos'] = $id_dos;
			echo '<td></td>';
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
												FROM dossier
												WHERE id_dos = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;
			?>
				<li class="nav-item">
					<a class="nav-link <?php echo $active;?>" href="#tab_<?php echo $reponse['id_dos'];?>" data-toggle="tab">
						Dossier <?php echo $reponse['ref_dos'];?>
					</a>
				</li>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherBoutonFormulaireFacturePartielleBackUp($id_dos){
			include('connexion.php');
			$entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			echo '<td></td>';
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
												FROM dossier
												WHERE ref_dos_2 = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;
			?>
				<li class="nav-item">
					<a class="nav-link <?php echo $active;?>" href="#tab_<?php echo $reponse['id_dos'];?>" data-toggle="tab">
						Dossier <?php echo $reponse['ref_dos'];?>
					</a>
				</li>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFormulaireFacturePartielle($id_dos){
			include('connexion.php');
			// $entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$entree['id_dos'] = $id_dos;
			echo '<td></td>';
			$compteur = '0';
			$sous_compteur = 0;
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, principal, roe_decl, fob, 
													fret, assurance, autre_frais, poids, poids_brut, montant_decl
												FROM dossier
												WHERE id_dos = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;

				if ($reponse['roe_decl']>0) {
					// code...
				}else{
					$reponse['roe_decl'] = 2000;
				}
			?>
			<div class="tab-pane <?php echo $active;?>" id="tab_<?php echo $reponse['id_dos']?>">
				<div class="row">
						<div class="col-md-8">
						  <table class="table table-sm table-bordered table-hover table-dark table-head-fixed">
						    <thead>
						        <tr>
						            <th colspan="2">DEBOURS</th>
						            <th>MONTANT</th>
						            <th>DEVISE</th>
						            <th>TVA</th>
						        </tr>
						    </thead>
						    <tbody>
						    	<?php
						    		$this-> getDeboursPourFactureClientModeleLicence($this-> getDossier($id_dos)['id_cli'], $_GET['id_mod_lic_fact'], $compteur, $sous_compteur, $reponse['principal'], $id_dos);
						    	?>
						    </tbody>
						</table>
					</div>
					<div class="col-md-4">
			    		<input type="hidden" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $ref_fact?>">
			    		<input type="hidden" name="id_dos_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos']?>">
			    			<div class="row">
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Taux</label>
						            <input type="number" step="0.0001" min="0" name="roe_decl_<?php echo $compteur;?>" id="roe_decl" onblur="getTotal()" value="<?php echo $reponse['roe_decl'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">FOB</label>
						            <input type="number" step="0.0001" min="0" name="montant_decl_<?php echo $compteur;?>" value="<?php echo $reponse['montant_decl'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Fret</label>
						            <input type="number" step="0.0001" min="0" name="fret_<?php echo $compteur;?>" value="<?php echo $reponse['fret'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Assurance</label>
						            <input type="number" step="0.0001" min="0" name="assurance_<?php echo $compteur;?>" value="<?php echo $reponse['assurance'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Autres Charges</label>
						            <input type="number" step="0.0001" min="0" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Poids Net (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_<?php echo $compteur;?>" value="<?php echo $reponse['poids'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Poids Brut (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_brut_<?php echo $compteur;?>" value="<?php echo $reponse['poids_brut'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">Autres informations / Autres Détails sur la Facture:</label>
						            <input type="text" name="info" value="" class="form-control form-control-sm cc-exp bg bg-dark">
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL ($):</label>
						            <input type="text" name="total" id="totalUSD" class="form-control text-danger form-control-lg cc-exp" style="text-align: center; font-weight: bold;background-color: black; font-size: 20px;" disabled>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL (CDF):</label>
						            <input type="text" name="" id="totalCDF" class="form-control text-primary form-control-lg cc-exp bg" style="text-align: center; font-weight: bold;background-color: black; font-size: 20px;" disabled>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL Général ($):</label>
						            <input type="text" name="" id="total" class="form-control form-control-lg cc-exp bg text-success " style="text-align: center; font-weight: bold; background-color: black; font-size: 20px;" disabled>
						        </div>
			    			</div>
						</div>
				</div>
			</div>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherFormulaireFacturePartielleBackup_18_04_22($id_dos){
			include('connexion.php');
			// $entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$entree['id_dos'] = $id_dos;
			echo '<td></td>';
			$compteur = '0';
			$sous_compteur = 0;
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, principal, roe_decl, fob, 
													fret, assurance, autre_frais, poids, montant_decl, poids_brut
												FROM dossier
												WHERE id_dos = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;
			?>
			<div class="tab-pane <?php echo $active;?>" id="tab_<?php echo $reponse['id_dos']?>">
			  <table class="table table-bordered table-hover table-dark table-head-fixed">
			    <thead>
			    	<tr>
			    		<input type="hidden" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $ref_fact?>">
			    		<input type="hidden" name="id_dos_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos']?>">
			    		<th colspan="5">
			    			<div class="row">
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Taux</label>
						            <input type="number" step="0.0001" min="0" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">FOB Déclaré</label>
						            <input type="number" step="0.0001" min="0" name="montant_decl_<?php echo $compteur;?>" value="<?php echo $reponse['montant_decl'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Fret</label>
						            <input type="number" step="0.0001" min="0" name="fret_<?php echo $compteur;?>" value="<?php echo $reponse['fret'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Assurance</label>
						            <input type="number" step="0.0001" min="0" name="assurance_<?php echo $compteur;?>" value="<?php echo $reponse['assurance'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Autres Charges</label>
						            <input type="number" step="0.0001" min="0" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Poids Net (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_<?php echo $compteur;?>" value="<?php echo $reponse['poids'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Poids Brut (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_brut_<?php echo $compteur;?>" value="<?php echo $reponse['poids_brut'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">Autres informations / Autres Détails sur la Facture:</label>
						            <input type="text" name="info" value="" class="form-control cc-exp bg bg-dark">
						        </div>
			    			</div>
			    		</th>
			    	</tr>
			        <tr>
			            <th colspan="2">DEBOURS</th>
			            <th>MONTANT</th>
			            <th>DEVISE</th>
			            <th>TVA</th>
			        </tr>
			    </thead>
			    <tbody>
			    	<?php
			    		if(isset($_GET['id_t_trans']) && ($_GET['id_t_trans']!='')){
			    			$id_t_trans = $_GET['id_t_trans'];
			    		}else{
			    			$id_t_trans = NULL;
			    		}
			    		$this-> getDeboursPourFactureClientModeleLicence($this-> getDossier($id_dos)['id_cli'], $_GET['id_mod_lic_fact'], $compteur, $sous_compteur, $reponse['principal'], $id_dos, $id_t_trans);
			    	?>
			    </tbody>
			</table>
			</div>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherFormulaireFacturePartielleEdit($id_dos){
			include('connexion.php');
			// $entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$entree['id_dos'] = $id_dos;
			echo '<td></td>';
			$compteur = '0';
			$sous_compteur = 0;
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, principal, roe_decl, fob, 
													fret, assurance, autre_frais, poids, montant_decl, poids_brut
												FROM dossier
												WHERE id_dos = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;

				if ($reponse['roe_decl']>0) {
					// code...
				}else{
					$reponse['roe_decl'] = 2000;
				}
			?>
			<div class="tab-pane <?php echo $active;?>" id="tab_<?php echo $reponse['id_dos']?>">
				<div class="row">
						<div class="col-md-8">
						  <table class="table table-sm table-bordered table-hover table-dark table-head-fixed">
						    <thead>
						        <tr>
						            <th colspan="2">DEBOURS</th>
						            <th>MONTANT</th>
						            <th>DEVISE</th>
						            <th>TVA</th>
						        </tr>
						    </thead>
						    <tbody>
						    	<?php
						    		$this-> getDeboursPourFactureClientModeleLicenceEdit($this-> getDossier($id_dos)['id_cli'], $_GET['id_mod_lic_fact'], $compteur, $sous_compteur, $reponse['principal'], $id_dos);
						    	?>
						    </tbody>
						</table>
					</div>
					<div class="col-md-4">
			    		<input type="hidden" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $ref_fact?>">
			    		<input type="hidden" name="id_dos_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos']?>">
			    			<div class="row">
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Taux</label>
						            <input type="number" step="0.0001" min="0" name="roe_decl_<?php echo $compteur;?>" id="roe_decl" onblur="getTotal()" value="<?php echo $reponse['roe_decl'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">FOB</label>
						            <input type="number" step="0.0001" min="0" name="montant_decl_<?php echo $compteur;?>" value="<?php echo $reponse['montant_decl'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Fret</label>
						            <input type="number" step="0.0001" min="0" name="fret_<?php echo $compteur;?>" value="<?php echo $reponse['fret'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Assurance</label>
						            <input type="number" step="0.0001" min="0" name="assurance_<?php echo $compteur;?>" value="<?php echo $reponse['assurance'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Autres Charges</label>
						            <input type="number" step="0.0001" min="0" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Poids Net (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_<?php echo $compteur;?>" value="<?php echo $reponse['poids'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Poids Brut (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_brut_<?php echo $compteur;?>" value="<?php echo $reponse['poids_brut'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">Autres informations / Autres Détails sur la Facture:</label>
						            <input type="text" name="info" value="" class="form-control form-control-sm cc-exp bg bg-dark">
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL ($):</label>
						            <input type="text" name="total" id="totalUSD" class="form-control text-danger form-control-lg cc-exp" style="text-align: center; font-weight: bold;background-color: black; font-size: 20px;" disabled>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL (CDF):</label>
						            <input type="text" name="" id="totalCDF" class="form-control text-primary form-control-lg cc-exp" style="text-align: center; font-weight: bold;background-color: black; font-size: 20px;" disabled>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL Général ($):</label>
						            <input type="text" name="" id="total" class="form-control form-control-lg cc-exp bg text-success " style="text-align: center; font-weight: bold;background-color: black; font-size: 20px;" disabled>
						        </div>
			    			</div>
						</div>
				</div>
			</div>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherFormulaireFacturePartielleEditBackup_18_04_22($id_dos){
			include('connexion.php');
			// $entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$entree['id_dos'] = $id_dos;
			echo '<td></td>';
			$compteur = '0';
			$sous_compteur = 0;
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, principal, roe_decl, fob, 
													fret, assurance, autre_frais, poids, montant_decl, poids_brut
												FROM dossier
												WHERE id_dos = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;
			?>
			<div class="tab-pane <?php echo $active;?>" id="tab_<?php echo $reponse['id_dos']?>">
			  <table class="table table-bordered table-hover table-dark table-head-fixed">
			    <thead>
			    	<tr>
			    		<input type="hidden" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $ref_fact?>">
			    		<input type="hidden" name="id_dos_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos']?>">
			    		<th colspan="5">
			    			<div class="row">
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Taux</label>
						            <input type="number" step="0.0001" min="0" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">FOB Déclaré</label>
						            <input type="number" step="0.0001" min="0" name="montant_decl_<?php echo $compteur;?>" value="<?php echo $reponse['montant_decl'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Fret</label>
						            <input type="number" step="0.0001" min="0" name="fret_<?php echo $compteur;?>" value="<?php echo $reponse['fret'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Assurance</label>
						            <input type="number" step="0.0001" min="0" name="assurance_<?php echo $compteur;?>" value="<?php echo $reponse['assurance'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Autres Charges</label>
						            <input type="number" step="0.0001" min="0" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Poids Net (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_<?php echo $compteur;?>" value="<?php echo $reponse['poids'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Poids Brut (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_brut_<?php echo $compteur;?>" value="<?php echo $reponse['poids_brut'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">Autres informations / Autres Détails sur la Facture:</label>
						            <input type="text" name="info" value="" class="form-control cc-exp bg bg-dark">
						        </div>
			    			</div>
			    		</th>
			    	</tr>
			        <tr>
			            <th colspan="2">DEBOURS</th>
			            <th>MONTANT</th>
			            <th>DEVISE</th>
			            <th>TVA</th>
			        </tr>
			    </thead>
			    <tbody>
			    	<?php
			    		$this-> getDeboursPourFactureClientModeleLicenceEdit($this-> getDossier($id_dos)['id_cli'], $_GET['id_mod_lic_fact'], $compteur, $sous_compteur, $reponse['principal'], $id_dos);
			    	?>
			    </tbody>
			</table>
			</div>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherFormulaireFacturePartielleBackUp($id_dos){
			include('connexion.php');
			$entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			echo '<td></td>';
			$compteur = '0';
			$sous_compteur = 0;
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, principal, roe_decl
												FROM dossier
												WHERE ref_dos_2 = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;
			?>
			<div class="tab-pane <?php echo $active;?>" id="tab_<?php echo $reponse['id_dos']?>">
			  <table class="table table-bordered table-hover table-dark table-head-fixed">
			    <thead>
			    	<tr>
			    		<input type="hidden" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $ref_fact?>">
			    		<input type="hidden" name="id_dos_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos']?>">
			    		<th>Référence Facture: <input type="text" name="ref_fact_<?php echo $compteur;?>" class="bg bg-dark" value="<?php echo $ref_fact?>" disabled></th>
			    		<th>Taux: <input type="number" step="0.0001" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl']?>" class="bg bg-dark" required></th>
			    	</tr>
			        <tr>
			            <th colspan="2">DEBOURS</th>
			            <th>MONTANT</th>
			            <th>DEVISE</th>
			            <th>TVA</th>
			        </tr>
			    </thead>
			    <tbody>
			    	<?php
			    		$this-> getDeboursPourFactureClientModeleLicence($this-> getDossier($id_dos)['id_cli'], $_GET['id_mod_lic_fact'], $compteur, $sous_compteur, $reponse['principal'], $id_dos);
			    	?>
			    </tbody>
			</table>
			</div>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherFormulaireDepenseOperation($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$compteur = 0;
			$active = '';
			?>
		    <div class="col-md-12" >    
			<?php
			$requete = $connexion-> query("SELECT *
												FROM categorie_rubrique");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {

			?>
			
		          <table class="table table-dark table-bordered table-hover">
		            <thead>
		              <tr>
		                <th colspan="3"><?php echo $reponse['nom_cat_rub'];?></th>
		           	  </tr>
		              <tr>
		                <th width="5%"></th>
		                <th width="70%"></th>
		                <th width="10%"></th>
		                <th width="15%"></th>
		              </tr>
		            </thead>
		            <tbody>
		            	<?php
		            		//$this-> afficherRubriqueForFormulaireDepenseOperation($reponse['id_cat_rub'], $compteur);
		            		$requeteRubrique = $connexion-> prepare("SELECT r.id_rub AS id_rub, r.nom_rub AS nom_rub, af.montant AS montant
																		FROM rubrique_depense r, affectation_client_rubrique_depense af
																		WHERE r.id_cat_rub = ?
																			AND r.id_rub = af.id_rub
																			AND af.id_cli = ?");
							$requeteRubrique-> execute(array($reponse['id_cat_rub'], $entree['id_cli']));
							while ($reponseRubrique = $requeteRubrique-> fetch()) {
								$compteur++;
							?>
							<tr>
								<td><?php echo $compteur;?></td>
								<td>
									<?php echo $reponseRubrique['nom_rub'];?>
								</td>
								<td style="text-align: center;">
									$ <?php echo $reponseRubrique['montant'];?>
								</td>
								<td>
									<input type="checkbox" name="check_<?php echo $compteur;?>" class="form-control">
									<input type="hidden" name="id_rub_<?php echo $compteur;?>" value="<?php echo $reponseRubrique['id_rub'];?>">
								</td>
							</tr>
							<?php
							}$requeteRubrique-> closeCursor();
		            	?>
		            </tbody>
		          </table>


			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
		      </div>
			<?php
		}

		public function afficherRubriqueForFormulaireDepenseOperation($id_cat_rub, $compteur){
			include('connexion.php');
			$entree['id_cat_rub'] = $id_cat_rub;
			$active = '';
			$requete = $connexion-> prepare("SELECT *
												FROM rubrique_depense
												WHERE id_cat_rub = ?");
			$requete-> execute(array($entree['id_cat_rub']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
			<tr>
				<td><?php echo $compteur;?></td>
				<td>
					<?php echo $reponse['nom_rub'];?>
				</td>
				<td>
					<input type="checkbox" name="check_<?php echo $compteur;?>" class="form-control">
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function getNombreIrSansAVClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(ref_av)) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND ref_av NOT IN(
															SELECT ref_av FROM av
														)
													AND ref_av IS NOT NULL
													AND ref_av <> ''
													AND ref_av <> 'N/A'
													AND ref_av <> '-'
													AND ref_av NOT LIKE '%UNDER%'
													AND ref_av NOT LIKE '21%'
													AND ref_av NOT LIKE '20%'
													AND ref_av NOT LIKE '2021%'
													AND ref_av NOT LIKE '2020%'
													AND ref_av <> 'TBC'");
			$requete-> execute(array($entree['id_cli']));
			$reponse=$requete-> fetch();
			//if($reponse){
				return $reponse['nbre'];
			//}
		}

		public function getAffectationClientModeleLicence($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM affectation_client_modele_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			$reponse=$requete-> fetch();
			return $reponse;
		}

		public function afficherIrSansAv($id_cli, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$compteur=$premiere_entree;

			$requete = $connexion-> prepare("SELECT DISTINCT(ref_av) AS ref_av,
													DATE_FORMAT(date_av, '%d/%m/%Y') AS date_av,
													REPLACE(REPLACE(ref_av, ' ', '_'), '-', '_') AS ref_av_2
												FROM dossier
												WHERE id_cli = ?
													AND ref_av NOT IN(
															SELECT ref_av FROM av
														)
													AND ref_av IS NOT NULL
													AND ref_av <> ''
													AND ref_av <> 'N/A'
													AND ref_av <> '-'
													AND ref_av NOT LIKE '%UNDER%'
													AND ref_av NOT LIKE '21%'
													AND ref_av NOT LIKE '20%'
													AND ref_av NOT LIKE '2021%'
													AND ref_av NOT LIKE '2020%'
													AND ref_av <> 'TBC'
												GROUP BY ref_av
												ORDER BY ref_av");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditAvIr.php');

			?>
			<tr style="">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreDossierIr($id_cli, $reponse['ref_av']);?>
				</td>
				<td style="text-align: center;">
					<button class="btn btn-sm btn-info" onclick="window.open('popUpDossiersIr.php?ref_av=<?php echo $reponse['ref_av'];?>&id_cli=<?php echo $id_cli;?>','pop1','width=1000,height=800');"><i class="fa fa-eye"></i></button>
				</td>
				<td style="text-align: center;">
					<button class="btn btn-sm btn-success" data-toggle="modal" data-target=".editAvIr_<?php echo $reponse['ref_av_2'];?>"><i class="fa fa-plus"></i></button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersIr($ref_av, $id_cli){
			include("connexion.php");
			$entree['ref_av'] = $ref_av;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT ref_dos, fob
												FROM dossier
												WHERE ref_av = ?
												$sqlClient");
			$requete-> execute(array($entree['ref_av']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function getNombreDossierIr($id_cli, $ref_av){
			include('connexion.php');
			$entree['ref_av'] = $ref_av;
			$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE ref_av = ?
													AND id_cli = ?');
			$requete-> execute(array($entree['ref_av'], $entree['id_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getModeleFacture($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare('SELECT modele_facture
												FROM affectation_client_modele_licence
												WHERE id_mod_lic = ?
													AND id_cli = ?');
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['modele_facture'];
			}
		}

		public function getDeboursPourFactureClientModeleLicence($id_cli, $id_mod_lic, $compteur_dossier, $sous_compteur, $principal='1', $id_dos){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $sous_compteur;
			$compteur_dossier = $compteur_dossier;
			$active = '';
			$sqlTypeDebours = '';
			$montant_interet = 0;

			if ($principal == '0') {
				$sqlTypeDebours = ' WHERE id_t_deb <> 3';
			}
			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				?>
				<tr id="headingOne_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
					<th colspan="6">
						<a class="btn btn-primary btn-sm" data-toggle="collapse" href="#multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>" role="button" aria-expanded="false" aria-controls="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
							<i class="fa fa-plus"></i>
						</a>
						<?php echo $reponseTypeDebours['nom_t_deb']; ?>
					</th>
				</tr>
				<div>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant,
														af.detail AS detail
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
														AND af.id_mod_trans = ?
													ORDER BY deb.nom_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli'], $this-> getDossier($id_dos)['id_mod_trans']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$sous_compteur++;
					$class = "";
					if($this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos)>0){
						$reponseDebours['montant'] = $this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos);
					}

					if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '59' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = '60.000';

					}else if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '60' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = '200.000';

					}else if ($id_cli == 884 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '26' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$class = "class='frais_bancaire'";

					}else if ($id_cli == 884 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '96' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = $this-> getDossier($id_dos)['poids_brut'];

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='39' && ($this-> getDossier($id_dos)['id_march']=='13' || $this-> getDossier($id_dos)['id_march']=='58')) { // Concentree

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;
						$montant_interet = ((100*$this-> getDossier($id_dos)['poids'])/1000)*0.01;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='11' && ($this-> getDossier($id_dos)['id_march']=='1')) {

						$reponseDebours['montant'] = 0;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='40') { // Voirie

						$reponseDebours['montant'] =( 50*$this-> getDossier($id_dos)['poids'])/1000;
						$montant_interet += (( 50*$this-> getDossier($id_dos)['poids'])/1000)*0.01;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='43') {

						$reponseDebours['montant'] = (3*$this-> getDossier($id_dos)['poids_brut'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='87') {

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='88') {

						$reponseDebours['montant'] = (50*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='89') {

						if ($this-> getDossier($id_dos)['id_march']==1) {
							$reponseDebours['montant'] = (5*$this-> getDossier($id_dos)['poids'])/1000;
						}else{
							$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						}

						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44' && ($this-> getDossier($id_dos)['id_march']=='13')) {

						$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44' && ($this-> getDossier($id_dos)['id_march']=='1')) {

						$reponseDebours['montant'] = (5*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids']/1000)<30)) {

						$reponseDebours['montant'] = 600;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids']/1000)>=30)) {

						$reponseDebours['montant'] = 800;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='129' && $this-> getDossier($id_dos)['id_march']=='58') { // LMC

						$reponseDebours['montant'] = ($this-> getDossier($id_dos)['poids']/1000)*8;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='129' && $this-> getDossier($id_dos)['id_march']=='59') { // LMC

						$reponseDebours['montant'] = ($this-> getDossier($id_dos)['poids']/1000)*5;
						
					}

					//Interet Taxe Voirie / Concetree
					else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='128') {

						$reponseDebours['montant'] = $montant_interet;

					}
					// //Interet Taxe Voirie
					// else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='124' && ($this-> getDossier($id_dos)['id_march']=='13')) {

					// 	$reponseDebours['montant'] = ((100*$this-> getDossier($id_dos)['poids'])/1000)*0.01;

					// }
					// //Interet Taxe Concentree
					// else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='125') {

					// 	$reponseDebours['montant'] =(( 50*$this-> getDossier($id_dos)['poids'])/1000)*0.01;
						
					// }

					?>
					<tr class="collapse multi-collapse" id="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
						<td width="10%">
							<input type="hidden" name="id_deb_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $reponseDebours['id_deb']; ?>">
							<?php echo $reponseDebours['abr_deb']; ?>
						</td>
						<td width="50%">
							<?php 
								echo $reponseDebours['nom_deb']; 
								if ($reponseDebours['detail']=='1') {
								?>
								: <input type="text" style="width: 20em;" name="detail_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<?php
								}
							?>
						</td>
						<td style="text-align: center;">
							<input type="number" step="0.001" name="montant_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="montant_<?php echo $sous_compteur;?>" value="<?php echo $reponseDebours['montant']; ?>" onblur="getTotal()" <?php echo $class;?>>

						</td>
						<td style="text-align: center;">
							<select name="usd_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="usd_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['usd'] == '0') {
								?>
								<option value="0">CDF</option>
								<option value="1">USD</option>
								<?php
								}else{
								?>
								<option value="1">USD</option>
								<option value="0">CDF</option>
								<?php
								}
								?>
							</select>
						</td>
						<td style="text-align: center;">
							<select name="tva_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="tva_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['tva'] == '0') {
								?>
								<option value="0">NON</option>
								<option value="1">OUI</option>
								<?php
								}else{
								?>
								<option value="1">OUI</option>
								<option value="0">NON</option>
								<?php
								}
								?>
							</select>
						</td>
					</tr>
					<?php
				}$requeteDebours-> closeCursor();
				?>
				</div>
				<?php
			}$requeteTypeDebours-> closeCursor();
			?>
			<input type="hidden" name="sous_compteur_<?php echo $compteur_dossier;?>" id="sous_compteur" value="<?php echo $sous_compteur;?>">
			<?php
		}

		public function getDeboursPourDossier($id_cli, $id_mod_lic, $id_mod_trans, $id_dos=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$compteur = 0;
			$active = '';
			$sqlTypeDebours = '';
			$detail_input = '';
			$usd_input = '';
			$tva_input = '';
			$montant_input = '';
			$montant_tva_input = '';
			$unite_input = '';

			$debours = '';

			$montant = 0;

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				$debours .= '
							<tr id="">
								<th colspan="7" class="bg bg-secondary">
									<u>'.$reponseTypeDebours['nom_t_deb'].'</u>
								</th>
							</tr>
							<div>';
				?>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, 
														-- UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.nom_deb  AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, 
														round(af.montant, 2) AS montant,
														af.detail AS detail
														-- af.unite AS unite,
														-- af.montant_min AS montant_min
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
														-- AND af.id_march = ?
														AND af.id_mod_trans = ?
													ORDER BY deb.rang, deb.id_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$compteur++;
					$montant = 0;
					
					if ($reponseDebours['usd'] == '0') {
						$usd_input = '<option value="0">CDF</option><option value="1">USD</option>';
					}else{
						$usd_input = '<option value="1">USD</option><option value="0">CDF</option>';
					}

					if ($reponseDebours['tva'] == '0') {
						$tva_input = '<option value="0">NO</option><option value="1">YES</option>';
					}else{
						$tva_input = '<option value="1">YES</option><option value="0">NO</option>';
					}

					if ($reponseDebours['id_deb']==136) { // CEEC <= 30

						$montant = $this-> getDossier($id_dos)['nbre_remorque']*$reponseDebours['montant'];

					}else if ($reponseDebours['id_deb']==37 && $this-> getDossier($id_dos)['poids']<=30000) { // CEEC <= 30

						$montant = 600;

					}else if ($reponseDebours['id_deb']==37 && $this-> getDossier($id_dos)['poids']>30000) { // CEEC > 30

						$montant = 800;

					}else if (($reponseDebours['id_deb']==6 || $reponseDebours['id_deb']==129) && $this-> getDossier($id_dos)['id_march']==4) { // LMC Cobalt

						$montant = ($this-> getDossier($id_dos)['poids']/1000)*8;

					}else if (($reponseDebours['id_deb']==6 || $reponseDebours['id_deb']==129) && ($this-> getDossier($id_dos)['id_march']==1 || $this-> getDossier($id_dos)['id_march']==59)) { // LMC Cuivre

						$montant = ($this-> getDossier($id_dos)['poids']/1000)*5;

					}else if ($reponseDebours['id_deb']==43) { // FERE

						$montant = ($this-> getDossier($id_dos)['poids_brut']/1000)*3;

					}
					// else if ($reponseDebours['unite']=='Poids') {

					// 	$montant = ($this-> getDossier($id_dos)['poids']/1000)*$reponseDebours['montant'];

					// }
					else if ($reponseDebours['montant']>1) {

						$montant = $reponseDebours['montant'];

					}
				
					$debours .= '<tr>
									<td width="10%">
										<input type="hidden" id="id_deb_'.$compteur.'" name="id_deb_'.$compteur.'" value="'.$reponseDebours['id_deb'].'">
										'.$reponseDebours['abr_deb'].'
									</td>
									<td width="50%">
										'.$reponseDebours['nom_deb'].'
									</td>
									<td style="text-align: center;">
										<input type="number" step="0.001" style="text-align: right;" name="montant_'.$compteur.'" value="'.$montant.'">
									</td>
									<td style="text-align: center;">
										<select name="usd_'.$compteur.'" id="usd_'.$compteur.'" onchange="getTotal()">
											'.$usd_input.'
										</select>
									</td>
									<td style="text-align: center;">
										<select name="tva_'.$compteur.'" id="tva_'.$compteur.'" onchange="getTotal();calculDroit();">
											'.$tva_input.'
										</select>
									</td>
								</tr>';

					?>
					
					<?php
				}$requeteDebours-> closeCursor();
				$debours .= '</div>';

			}$requeteTypeDebours-> closeCursor();
			$debours .= '<input type="hidden" name="compteur" value="'.$compteur.'">';

			return $debours;
		}

		public function getDeboursPourFactureClientModeleLicenceBcakup_18_04_22($id_cli, $id_mod_lic, $compteur_dossier, $sous_compteur, $principal='1', $id_dos, $id_t_trans=NULL, $id_mod_trans=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_t_trans) && ($id_t_trans!='')) {
				$entree['id_t_trans'] = $id_t_trans;
			}else{
				$entree['id_t_trans'] = 1;
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$entree['id_mod_trans'] = $id_mod_trans;
			}else{
				$entree['id_mod_trans'] = 1;
			}

			$compteur = $sous_compteur;
			$compteur_dossier = $compteur_dossier;
			$active = '';
			$sqlTypeDebours = '';

			if ($principal == '0') {
				$sqlTypeDebours = ' WHERE id_t_deb <> 3';
			}

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				?>
				<tr><th colspan="4"><?php echo $reponseTypeDebours['nom_t_deb']; ?></th></tr>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant,
														af.detail AS detail,
														af.id_t_trans AS id_t_trans
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
														AND af.id_t_trans = ?
														AND af.id_mod_trans = ?
													ORDER BY deb.nom_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_t_trans'], $entree['id_mod_trans']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$sous_compteur++;
					if($this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos)>0){
						$reponseDebours['montant'] = $this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos);
					}

					if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '59' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = '60.000';

					}else if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '60' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = '200.000';

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='39' && ($this-> getDossier($id_dos)['id_march']=='13')) {

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='40') {

						$reponseDebours['montant'] =( 50*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='43') {

						$reponseDebours['montant'] = (3*$this-> getDossier($id_dos)['poids_brut'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44' && $this-> getDossier($id_dos)['id_march']=='13') {

						$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='89' && $this-> getDossier($id_dos)['id_march']=='13') {

						$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='87' && $this-> getDossier($id_dos)['id_march']=='13') {

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='88' && $this-> getDossier($id_dos)['id_march']=='13') {

						$reponseDebours['montant'] = (50*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44' && $this-> getDossier($id_dos)['id_march']=='1') {

						$reponseDebours['montant'] = (5*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='82' && $this-> getDossier($id_dos)['id_march']=='1') {

						$reponseDebours['montant'] = 0;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='82' && $this-> getDossier($id_dos)['id_march']=='13') {
						if ($reponseDebours['id_t_trans']=='5') {
							$reponseDebours['montant'] = 20;
						}else{
							$reponseDebours['montant'] = 5;
						}
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='82' && $this-> getDossier($id_dos)['id_march']=='1') {
						
						$reponseDebours['montant'] = 0;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids_brut']/1000)<30)) {

						$reponseDebours['montant'] = 125;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids_brut']/1000)>=30)) {

						$reponseDebours['montant'] = 250;
						
					}else if($reponseDebours['id_deb']=='8' && $id_mod_lic=='1'){
						$reponseDebours['montant'] = 0;
						if ($this-> getDossier($id_dos)['id_mod_trans']=='4') {
							$reponseDebours['montant'] += 420;
						}else{
							if ((strlen(trim($this-> getDossier($id_dos)['horse']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
								$reponseDebours['montant'] += 140; 
							}
							if ((strlen(trim($this-> getDossier($id_dos)['trailer_1']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
								$reponseDebours['montant'] += 140; 
							}
							if ((strlen(trim($this-> getDossier($id_dos)['trailer_2']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
								$reponseDebours['montant'] += 140; 
							}
						}
					}

					?>
					<tr>
						<td width="10%">
							<input type="hidden" name="id_deb_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $reponseDebours['id_deb']; ?>">
							<?php echo $reponseDebours['abr_deb']; ?>
						</td>
						<td width="50%">
							<?php 
								echo $reponseDebours['nom_deb']; 
								if ($reponseDebours['detail']=='1') {
								?>
								: <input type="text" style="width: 20em;" name="detail_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<?php
								}
							?>
						</td>
						<td style="text-align: center;">
							<input type="number" step="0.001" name="montant_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $reponseDebours['montant']; ?>">

						</td>
						<td style="text-align: center;">
							<select name="usd_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<?php
								if ($reponseDebours['usd'] == '0') {
								?>
								<option value="0">CDF</option>
								<option value="1">USD</option>
								<?php
								}else{
								?>
								<option value="1">USD</option>
								<option value="0">CDF</option>
								<?php
								}
								?>
							</select>
						</td>
						<td style="text-align: center;">
							<select name="tva_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<?php
								if ($reponseDebours['tva'] == '0') {
								?>
								<option value="0">NON</option>
								<option value="1">OUI</option>
								<?php
								}else{
								?>
								<option value="1">OUI</option>
								<option value="0">NON</option>
								<?php
								}
								?>
							</select>
						</td>
					</tr>
					<?php
				}$requeteDebours-> closeCursor();

			}$requeteTypeDebours-> closeCursor();
			?>
			<input type="hidden" name="sous_compteur_<?php echo $compteur_dossier;?>" value="<?php echo $sous_compteur;?>">
			<?php
		}

		public function getDeboursPourFactureClientModeleLicenceEdit($id_cli, $id_mod_lic, $compteur_dossier, $sous_compteur, $principal='1', $id_dos){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $sous_compteur;
			$compteur_dossier = $compteur_dossier;
			$active = '';
			$sqlTypeDebours = '';

			if ($principal == '0') {
				$sqlTypeDebours = ' WHERE id_t_deb <> 3';
			}

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				?>
				<tr id="headingOne_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
					<th colspan="6">
						<a class="btn btn-primary btn-sm" data-toggle="collapse" href="#multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>" role="button" aria-expanded="false" aria-controls="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
							<i class="fa fa-plus"></i>
						</a>
						<?php echo $reponseTypeDebours['nom_t_deb']; ?>
					</th>
				</tr>
				<div>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant,
														af.detail AS detail
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
														AND af.id_mod_trans = ?
													ORDER BY deb.nom_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli'], $this-> getDossier($id_dos)['id_mod_trans']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$sous_compteur++;
					$class = "";

					$reponseDebours['montant'] = $this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos);
					
					if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='39') {

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='40') {

						$reponseDebours['montant'] =( 50*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_cli == 884 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '26' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$class = "class='frais_bancaire'";

					}else if ($id_cli == 884 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '96' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = $this-> getDossier($id_dos)['poids_brut'];

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='43') {

						$reponseDebours['montant'] = (3*$this-> getDossier($id_dos)['poids_brut'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='87') {

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='88') {

						$reponseDebours['montant'] = (50*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='89') {

						$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44' && ($this-> getDossier($id_dos)['id_march']=='13')) {

						$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44' && ($this-> getDossier($id_dos)['id_march']=='1')) {

						$reponseDebours['montant'] = (5*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids']/1000)<30)) {

						$reponseDebours['montant'] = 600;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids']/1000)>=30)) {

						$reponseDebours['montant'] = 800;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='11' && ($this-> getDossier($id_dos)['id_march']=='1')) {

						$reponseDebours['montant'] = 0;

					}
					?>
					<tr class="collapse multi-collapse" id="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
						<td width="10%">
							<input type="hidden" name="id_deb_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $reponseDebours['id_deb']; ?>">
							<?php echo $reponseDebours['abr_deb']; ?>
						</td>
						<td width="50%">
							<?php 
								echo $reponseDebours['nom_deb']; 
								if ($reponseDebours['detail']=='1') {
								?>
								: <input type="text" style="width: 20em;" name="detail_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<?php
								}
							?>
						</td>
						<td style="text-align: center;">
							<input type="number" step="0.001" name="montant_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="montant_<?php echo $sous_compteur;?>" value="<?php echo $reponseDebours['montant']; ?>" onblur="getTotal()" <?php echo $class;?>>

						</td>
						<td style="text-align: center;">
							<select name="usd_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="usd_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['usd'] == '0') {
								?>
								<option value="0">CDF</option>
								<option value="1">USD</option>
								<?php
								}else{
								?>
								<option value="1">USD</option>
								<option value="0">CDF</option>
								<?php
								}
								?>
							</select>
						</td>
						<td style="text-align: center;">
							<select name="tva_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="tva_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['tva'] == '0') {
								?>
								<option value="0">NON</option>
								<option value="1">OUI</option>
								<?php
								}else{
								?>
								<option value="1">OUI</option>
								<option value="0">NON</option>
								<?php
								}
								?>
							</select>
						</td>
					</tr>
					<?php
				}$requeteDebours-> closeCursor();

				?>
				</div>
				<?php
			}$requeteTypeDebours-> closeCursor();
			?>
			<input type="hidden" name="sous_compteur_<?php echo $compteur_dossier;?>" id="sous_compteur" value="<?php echo $sous_compteur;?>">
			<?php
		}

		public function getDeboursPourFactureClientModeleLicenceEditBackup_18_06_22($id_cli, $id_mod_lic, $compteur_dossier, $sous_compteur, $principal='1', $id_dos){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $sous_compteur;
			$compteur_dossier = $compteur_dossier;
			$active = '';
			$sqlTypeDebours = '';

			if ($principal == '0') {
				$sqlTypeDebours = ' WHERE id_t_deb <> 3';
			}

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				?>
				<tr><th colspan="4"><?php echo $reponseTypeDebours['nom_t_deb']; ?></th></tr>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant,
														af.detail AS detail
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
													ORDER BY deb.nom_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$sous_compteur++;
					// if($this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos)>0){
					// 	$reponseDebours['montant'] = $this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos);
					// }

					// if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '59' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
					// 	$reponseDebours['montant'] = '60.000';
					// }else if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '60' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
					// 	$reponseDebours['montant'] = '200.000';
					// }

					$reponseDebours['montant'] = $this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos);
					
					if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '59' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = '60.000';

					}else if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '60' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = '200.000';

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='39' && ($this-> getDossier($id_dos)['id_march']=='13')) {

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='40') {

						$reponseDebours['montant'] =( 50*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='43') {

						$reponseDebours['montant'] = (3*$this-> getDossier($id_dos)['poids_brut'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44' && $this-> getDossier($id_dos)['id_march']=='13') {

						$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='89' && $this-> getDossier($id_dos)['id_march']=='13') {

						$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='87' && $this-> getDossier($id_dos)['id_march']=='13') {

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='88' && $this-> getDossier($id_dos)['id_march']=='13') {

						$reponseDebours['montant'] = (50*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44' && $this-> getDossier($id_dos)['id_march']=='1') {

						$reponseDebours['montant'] = (5*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='82' && $this-> getDossier($id_dos)['id_march']=='1') {

						$reponseDebours['montant'] = 0;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='82' && $this-> getDossier($id_dos)['id_march']=='13') {
						if ($reponseDebours['id_t_trans']=='5') {
							$reponseDebours['montant'] = 20;
						}else{
							$reponseDebours['montant'] = 5;
						}
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='82' && $this-> getDossier($id_dos)['id_march']=='1') {
						
						$reponseDebours['montant'] = 0;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids_brut']/1000)<30)) {

						$reponseDebours['montant'] = 125;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids_brut']/1000)>=30)) {

						$reponseDebours['montant'] = 250;
						
					}else if($reponseDebours['id_deb']=='8' && $id_mod_lic=='1'){
						$reponseDebours['montant'] = 0;
						if ($this-> getDossier($id_dos)['id_mod_trans']=='4') {
							$reponseDebours['montant'] += 420;
						}else{
							if ((strlen(trim($this-> getDossier($id_dos)['horse']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
								$reponseDebours['montant'] += 140; 
							}
							if ((strlen(trim($this-> getDossier($id_dos)['trailer_1']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
								$reponseDebours['montant'] += 140; 
							}
							if ((strlen(trim($this-> getDossier($id_dos)['trailer_2']))>=4) && isset($this-> getDossier($id_dos)['horse'])) {
								$reponseDebours['montant'] += 140; 
							}
						}
					}

					?>
					<tr>
						<td width="10%">
							<input type="hidden" name="id_deb_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $reponseDebours['id_deb']; ?>">
							<?php echo $reponseDebours['abr_deb']; ?>
						</td>
						<td width="50%">
							<?php 
								echo $reponseDebours['nom_deb']; 
								if ($reponseDebours['detail']=='1') {
								?>
								: <input type="text" style="width: 20em;" name="detail_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $this-> getDataFactureDeboursDossier($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos)['detail'];?>">
								<?php
								}
							?>
						</td>
						<td style="text-align: center;">
							<input type="number" step="0.001" name="montant_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $reponseDebours['montant']; ?>">

						</td>
						<td style="text-align: center;">
							<select name="usd_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<?php
								if ($reponseDebours['usd'] == '0') {
								?>
								<option value="0">CDF</option>
								<option value="1">USD</option>
								<?php
								}else{
								?>
								<option value="1">USD</option>
								<option value="0">CDF</option>
								<?php
								}
								?>
							</select>
						</td>
						<td style="text-align: center;">
							<select name="tva_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<?php
								if ($reponseDebours['tva'] == '0') {
								?>
								<option value="0">NON</option>
								<option value="1">OUI</option>
								<?php
								}else{
								?>
								<option value="1">OUI</option>
								<option value="0">NON</option>
								<?php
								}
								?>
							</select>
						</td>
					</tr>
					<?php
				}$requeteDebours-> closeCursor();

			}$requeteTypeDebours-> closeCursor();
			?>
			<input type="hidden" name="sous_compteur_<?php echo $compteur_dossier;?>" value="<?php echo $sous_compteur;?>">
			<?php
		}

		/*public function afficherFormulaireFacturePartielle($id_dos){
			include('connexion.php');
			$entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			echo '<td></td>';
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
												FROM dossier
												WHERE ref_dos_2 = ?
												ORDER BY ref_dos");
			$requete-> execute(array($entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
				}else{
					$active = '';
				}
			?>
			<div class="tab-pane <?php echo $active;?>" id="tab_<?php echo $reponse['id_dos']?>">
			  <table class="table table-bordered table-hover">
			    <thead>
			        <tr>
			            <th>DEBOURS</th>
			            <th>MONTANT</th>
			            <th>DEVISE</th>
			            <th>TVA</th>
			        </tr>
			    </thead>
			    <tbody>
			    	
			    </tbody>
			</table>
			</div>
			<?php
			}$requete-> closeCursor();

		}*/

		public function afficherDossierPourFacturationClientModeleLicence($id_cli, $id_mod_lic, $id_mod_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, ref_decl, 
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic, fob, fret, assurance, autre_frais,
													(fob+fret+assurance+autre_frais) AS cif,
													principal
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_dos NOT IN(
														SELECT det.id_dos 
														FROM detail_facture_dossier det, facture_dossier fd
														WHERE fd.id_t_trans = ?
															AND fd.ref_fact = det.ref_fact
													)
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" class="form-control" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(27, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 8em;" class="form-control" name="roe_decl_<?php echo $compteur;?>">
				</td>

				<td style="text-align: center;">
				<?php
					if ($reponse['principal'] == '1' && empty($this-> getMontantDeboursDetailFactureDossier(12, $reponse['id_dos']))) {
					?>
					<input type="number" step="0.0001" style="text-align: right;" class="form-control" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(12, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
				?>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['principal'] == '1' && empty($this-> getMontantDeboursDetailFactureDossier(62, $reponse['id_dos']))) {
					?>
					<input type="number" step="0.0001" style="text-align: right;" class="form-control" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(62, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
				?>
				</td>
				<td style="text-align: center;">
				<?php
					if (!empty($this-> getMontantDeboursDetailFactureDossier(10, $reponse['id_dos']))) {
					?>
					<input type="number" step="0.0001" style="text-align: right;" class="form-control" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(10, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
				?>
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="fob_<?php echo $compteur;?>" value="<?php echo $reponse['fob'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="fret_<?php echo $compteur;?>" value="<?php echo $reponse['fret'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="assurance_<?php echo $compteur;?>" value="<?php echo $reponse['assurance'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais'];?>">
				</td>
				<td style="text-align: center;" class="bg bg-purple">
					<?php
						echo number_format($reponse['cif'], 2, ',', ' ');
					?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Documents du Dossier<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>

			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierRCDPourFacturationClientModeleLicenceBackUp($id_cli, $id_mod_lic, $id_mod_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, num_lic, ref_decl, 
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic,
													principal
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND ref_dos NOT IN(
														SELECT d.ref_dos AS ref_dos
															FROM detail_facture_dossier det, dossier d
															WHERE d.id_dos = det.id_dos
													)
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['num_lic'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(27, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="roe_decl_<?php echo $compteur;?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="tr8_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(23, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(62, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(10, $id_cli, $id_mod_lic)['montant']+$this-> getDataDeboursClientModeleLicence(11, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['principal'] == '1') {
					?>
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(63, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
				?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Documents du Dossier<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>

			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierRCDPourFacturationClientModeleLicence($id_cli, $id_mod_lic, $id_mod_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, num_lic, ref_decl, 
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic,
													principal
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND ref_dos NOT IN(
														SELECT d.ref_dos AS ref_dos
															FROM detail_facture_dossier det, dossier d
															WHERE d.id_dos = det.id_dos
													)
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['num_lic'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(27, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="tva_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(16, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="tva_autre_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(106, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="roe_decl_<?php echo $compteur;?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="tr8_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(23, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(62, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(10, $id_cli, $id_mod_lic)['montant']+$this-> getDataDeboursClientModeleLicence(11, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['principal'] == '1') {
					?>
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(63, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
				?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Documents du Dossier<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>

			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierSTFPourFacturationClientModeleLicence($id_cli, $id_mod_lic, $id_mod_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, num_lic, ref_decl, 
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic,
													principal
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND ref_dos NOT IN(
														SELECT d.ref_dos AS ref_dos
															FROM detail_facture_dossier det, dossier d
															WHERE d.id_dos = det.id_dos
													)
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['num_lic'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(27, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="tva_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(16, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="autre_tva_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(106, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: center; width: 10em;" class="form-control" name="roe_decl_<?php echo $compteur;?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="tr8_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(23, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(62, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(10, $id_cli, $id_mod_lic)['montant']+$this-> getDataDeboursClientModeleLicence(11, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="apurement_lic_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(34, $id_cli, $id_mod_lic)['montant'];?>">
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['principal'] == '1') {
					?>
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(63, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
				?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Documents du Dossier<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>

			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierPourFacturationClientModeleLicenceFacture($id_cli, $id_mod_lic, $id_mod_trans, $ref_fact){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['ref_fact'] = $ref_fact;
			$compteur = '0';
			$active = '';
			// $requete = $connexion-> prepare("SELECT id_dos, ref_dos, ref_decl, 
			// 										DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic, fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
			// 										principal
			// 									FROM dossier
			// 									WHERE id_cli = ?
			// 										AND id_mod_lic = ?
			// 										AND ref_quit IS NOT NULL
			// 										AND date_quit IS NOT NULL
			// 										AND id_mod_trans = ?
			// 										AND not_fact = '0'
			// 										AND id_dos NOT IN (
			// 											SELECT id_dos
			// 												FROM detail_facture_dossier
			// 												WHERE ref_fact <> ?
			// 										)
			// 									ORDER BY ref_dos");
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, ref_decl, 
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic, fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													principal
												FROM dossier
												WHERE id_cli = ?
														AND id_mod_lic = ?
														AND ref_quit IS NOT NULL
														AND date_quit IS NOT NULL
														AND id_mod_trans = ?
														AND not_fact = '0'
														AND ( id_dos IN (
																	SELECT det.id_dos 
																		FROM detail_facture_dossier det, facture_dossier fd
																		WHERE fd.ref_fact = ?
																			AND fd.ref_fact = det.ref_fact
																)
															OR id_dos NOT IN (SELECT id_dos 
																				FROM detail_facture_dossier d, facture_dossier
																				WHERE facture_dossier.id_t_trans = '2'
                                                                              		and d.ref_fact = facture_dossier.ref_fact
																			)
														)
												ORDER BY ref_dos");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(27, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getDossier($reponse['id_dos'])['roe_decl']>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $this-> getDossier($reponse['id_dos'])['roe_decl'];?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" style="text-align: center; width: 12em;" class="form-control" name="roe_decl_<?php echo $compteur;?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
				<?php
					// if (!empty($this-> getMontantDeboursDetailFactureDossierExlu($ref_fact, 12, $reponse['id_dos']))) {

					// }else{
						if ($reponse['principal'] == '1') {
							if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 12, $reponse['id_dos'])>0) {
							?>
							<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 12, $reponse['id_dos']);?>">
							<?php
							}else {
							?>
							<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(12, $id_cli, $id_mod_lic)['montant'];?>">
							<?php
							}
						?>
						<?php
						}
					// }
				?>
				</td>
				<td style="text-align: center;">
				<?php
					if (!empty($this-> getMontantDeboursDetailFactureDossierExlu($ref_fact, 12, $reponse['id_dos']))) {

					}else{
						if ($reponse['principal'] == '1') {
							if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos'])>0) {
							?>
							<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos']);?>">
							<?php
							}else {
							?>
							<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(62, $id_cli, $id_mod_lic)['montant'];?>">
							<?php
							}
						?>
						<?php
						}
					}
				?>
				</td>
				<td style="text-align: center;">
					<?php
					if (!empty($this-> getMontantDeboursDetailFactureDossierExlu($ref_fact, 12, $reponse['id_dos']))) {

					}else{
						if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos'])>0) {
						?>
						<input type="number" step="0.0001" class="form-control" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos']);?>">
						<?php
						}else {
						?>
						<input type="number" step="0.0001" class="form-control" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(10, $id_cli, $id_mod_lic)['montant'];?>">
						<?php
						}
					}
					?>
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="fob_<?php echo $compteur;?>" value="<?php echo $reponse['fob'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="fret_<?php echo $compteur;?>" value="<?php echo $reponse['fret'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="assurance_<?php echo $compteur;?>" value="<?php echo $reponse['assurance'];?>">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.0001" style="text-align: right; width: 10em;" class="form-control" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais'];?>">
				</td>
				<td style="text-align: center;" class="bg bg-purple">
					<?php
						echo number_format($reponse['cif'], 2, ',', ' ');
					?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Liasse Doc<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>

			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierPourFacturationRCDClientModeleLicenceFactureBackUp($id_cli, $id_mod_lic, $id_mod_trans, $ref_fact){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['ref_fact'] = $ref_fact;
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, ref_decl, num_lic,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic,
													principal
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
													AND not_fact = '0'
													AND id_dos NOT IN (
														SELECT id_dos
															FROM detail_facture_dossier
															WHERE ref_fact <> ?
													)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['num_lic'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(27, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getDossier($reponse['id_dos'])['roe_decl']>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $this-> getDossier($reponse['id_dos'])['roe_decl'];?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" style="text-align: center; width: 12em;" class="form-control" name="roe_decl_<?php echo $compteur;?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 23, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tr8_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 23, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tr8_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(23, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(62, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(10, $id_cli, $id_mod_lic)['montant']+$this-> getDataDeboursClientModeleLicence(11, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
				<?php
					if ($reponse['principal'] == '1') {
						if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 63, $reponse['id_dos'])>0) {
						?>
						<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 63, $reponse['id_dos']);?>">
						<?php
						}else {
						?>
						<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(63, $id_cli, $id_mod_lic)['montant'];?>">
						<?php
						}
					?>
					<?php
					}
				?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Liasse Doc<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>

			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierPourFacturationRCDClientModeleLicenceFacture($id_cli, $id_mod_lic, $id_mod_trans, $ref_fact){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['ref_fact'] = $ref_fact;
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, ref_decl, num_lic,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic,
													principal
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
													AND not_fact = '0'
													AND id_dos NOT IN (
														SELECT id_dos
															FROM detail_facture_dossier
															WHERE ref_fact <> ?
													)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['num_lic'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(27, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 16, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 16, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tva_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(16, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 106, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tva_autre_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 106, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tva_autre_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(106, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getDossier($reponse['id_dos'])['roe_decl']>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $this-> getDossier($reponse['id_dos'])['roe_decl'];?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" style="text-align: center; width: 12em;" class="form-control" name="roe_decl_<?php echo $compteur;?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 23, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tr8_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 23, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tr8_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(23, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(62, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(10, $id_cli, $id_mod_lic)['montant']+$this-> getDataDeboursClientModeleLicence(11, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
				<?php
					if ($reponse['principal'] == '1') {
						if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 63, $reponse['id_dos'])>0) {
						?>
						<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 63, $reponse['id_dos']);?>">
						<?php
						}else {
						?>
						<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(63, $id_cli, $id_mod_lic)['montant'];?>">
						<?php
						}
					?>
					<?php
					}
				?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Liasse Doc<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>

			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierPourFacturationSTFClientModeleLicenceFacture($id_cli, $id_mod_lic, $id_mod_trans, $ref_fact){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['ref_fact'] = $ref_fact;
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, ref_decl, num_lic,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic,
													principal
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
													AND not_fact = '0'
													AND id_dos NOT IN (
														SELECT id_dos
															FROM detail_facture_dossier
															WHERE ref_fact <> ?
													)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['num_lic'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="droits_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(27, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 16, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 16, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tva_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(16, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 106, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 106, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_tva_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(106, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getDossier($reponse['id_dos'])['roe_decl']>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $this-> getDossier($reponse['id_dos'])['roe_decl'];?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" style="text-align: center; width: 12em;" class="form-control" name="roe_decl_<?php echo $compteur;?>">
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 23, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tr8_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 23, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="tr8_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(23, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(62, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(10, $id_cli, $id_mod_lic)['montant']+$this-> getDataDeboursClientModeleLicence(11, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
					<?php
					if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 34, $reponse['id_dos'])>0) {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="apurement_lic_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 34, $reponse['id_dos']);?>">
					<?php
					}else {
					?>
					<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="apurement_lic_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(34, $id_cli, $id_mod_lic)['montant'];?>">
					<?php
					}
					?>
				</td>

				<td style="text-align: center;">
				<?php
					if ($reponse['principal'] == '1') {
						if ($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 63, $reponse['id_dos'])>0) {
						?>
						<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 63, $reponse['id_dos']);?>">
						<?php
						}else {
						?>
						<input type="number" step="0.0001" class="form-control" style="text-align: center; width: 12em;" name="honnoraire_<?php echo $compteur;?>" value="<?php echo $this-> getDataDeboursClientModeleLicence(63, $id_cli, $id_mod_lic)['montant'];?>">
						<?php
						}
					?>
					<?php
					}
				?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Liasse Doc<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>

			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierPourAppurementBanqueClientModeleLicence($id_cli, $id_mod_lic, $num_lic=NULL, $id_type_apur=1){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur = '0';
			$active = '';
			$sqlLicence = '';
			$sqlQuittance = '';
			$sqlTypeApurement = '';

			if ($id_type_apur=='2') {
				$sqlTypeApurement = 'AND dos.ref_cvee IS NOT NULL';
			}

			if($id_mod_lic == '2'){

				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}

				if (isset($id_cli) && ($id_cli!='')) {
					// $sqlClient = ' AND dos.id_cli = "'.$id_cli.'"';

					$sqlClient = ' AND (dos.id_cli = "'.$id_cli.'" 
										OR SUBSTRING(md.num_lic, 1, 10) IN (
												SELECT SUBSTRING(num_lic, 1, 10)
													FROM licence
													WHERE id_cli = "'.$id_cli.'"
											)
									)';
				}else{
					$sqlClient = '';
				}

				if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
					$sqlQuittance = ' AND dos.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
				}

				$requete = $connexion-> prepare("SELECT dos.id_dos, dos.ref_dos, dos.ref_decl, 
														DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl, dos.horse, dos.commodity, dos.id_mod_lic,
														dos.principal, dos.fob, dos.num_lic, 
														DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq, 
														DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
														dos.ref_liq, dos.ref_quit
													FROM dossier dos, marchandise_dossier md
													WHERE dos.id_mod_lic = ?
														AND dos.id_dos NOT IN(
															SELECT detail_apurement.id_dos
																FROM detail_apurement, transmission_apurement
																WHERE detail_apurement.id_trans_ap = transmission_apurement.id_trans_ap
																	AND transmission_apurement.id_type_apur = ?
														)
														AND dos.ref_quit IS NOT NULL
														AND dos.date_quit IS NOT NULL
														AND dos.ref_assurance IS NOT NULL
														AND dos.not_apurement = '0'
														ANd dos.id_dos = md.id_dos
														$sqlLicence
														$sqlClient
														$sqlQuittance
														AND trim(dos.ref_assurance) <> ''
														AND trim(dos.num_lic) <> 'N/A'
														AND trim(md.num_lic) <> 'N/A'
														AND trim(md.num_lic) <> 'UNDER VALUE'
													GROUP BY dos.id_dos
													ORDER BY dos.id_dos ASC
													LIMIT 0, 300");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
				while ($reponse = $requete-> fetch()) {
					$compteur++;
					
				?>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr>
					<td><?php echo $compteur;?></td>
					<td style="text-align: center;">
						<?php
							echo $reponse['ref_dos'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['num_lic'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['fob'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['ref_decl'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['ref_liq'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['ref_quit'];
						?>
					</td>
					<td>
						<button type="button" class="btn btn-dark dropdown-toggle dropdown-icon" data-toggle="dropdown">
	                        <i class="fa fa-copy"></i>  Documents du Dossier<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
	                        <span class="sr-only">Toggle Dropdown</span>
	                        <div class="dropdown-menu" role="menu">
	                          <?php
	                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
	                          ?>
	                        </div>
	                      </button>
					</td>
				</tr>
				<?php
				}$requete-> closeCursor();
			}else if($id_mod_lic == '1'){
				
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(dos.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}

				if (isset($id_cli) && ($id_cli!='')) {
					// $sqlClient = ' AND dos.id_cli = "'.$id_cli.'"';

					$sqlClient = ' AND (dos.id_cli = "'.$id_cli.'" 
										OR SUBSTRING(dos.num_lic, 1, 10) IN (
												SELECT SUBSTRING(num_lic, 1, 10)
													FROM licence
													WHERE id_cli = "'.$id_cli.'"
											)
									)';
				}else{
					$sqlClient = '';
				}

				if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
					$sqlQuittance = ' AND dos.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
				}

				$requete = $connexion-> prepare("SELECT dos.id_dos, dos.ref_dos, dos.ref_decl, 
														DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl, dos.horse, dos.commodity, dos.id_mod_lic,
														dos.principal, dos.fob, dos.num_lic, 
														DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq, 
														DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
														dos.ref_liq, dos.ref_quit,
														dos.num_lot AS num_lot,
														dos.poids AS poids,
														dos.poids_brut AS poids_brut,
														dos.ref_cvee AS ref_cvee,
														dos.montant_cvee AS montant_cvee
													FROM dossier dos
													WHERE dos.id_mod_lic = ?
														AND dos.id_dos NOT IN(
															SELECT id_dos
																FROM detail_apurement, transmission_apurement
																WHERE detail_apurement.id_trans_ap = transmission_apurement.id_trans_ap
																	AND transmission_apurement.id_type_apur = ? 
														)
														AND dos.ref_quit IS NOT NULL
														AND dos.date_quit IS NOT NULL
														AND dos.not_apurement = '0'
														$sqlTypeApurement
														$sqlLicence
														$sqlClient
														$sqlQuittance
														AND trim(dos.num_lic) <> 'N/A'
														AND trim(dos.num_lic) <> 'N/A'
														AND trim(dos.num_lic) <> 'UNDER VALUE'
													GROUP BY dos.id_dos
													ORDER BY dos.id_dos ASC
													LIMIT 0, 300");

				$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
				while ($reponse = $requete-> fetch()) {
					$compteur++;
					
				?>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr>
					<td><?php echo $compteur;?></td>
					<td style="text-align: center;">
						<?php
							echo $reponse['ref_dos'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['num_lot'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['num_lic'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['poids_brut'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['poids'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['ref_decl'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['ref_liq'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['ref_quit'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['ref_cvee'];
						?>
					</td>
					<td style="text-align: center;">
						<?php
							echo $reponse['montant_cvee'];
						?>
					</td>
					<td>
						<button type="button" class="btn btn-dark dropdown-toggle dropdown-icon" data-toggle="dropdown">
	                        <i class="fa fa-copy"></i>  Documents du Dossier<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
	                        <span class="sr-only">Toggle Dropdown</span>
	                        <div class="dropdown-menu" role="menu">
	                          <?php
	                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
	                          ?>
	                        </div>
	                      </button>
					</td>
				</tr>
				<?php
				}$requete-> closeCursor();
			}

			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierPourAppurementBanqueClientModeleLicenceByBanque($id_banq, $id_cli, $id_mod_lic, $num_lic=NULL, $id_type_apur=1){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$entree['id_banq'] = $id_banq;
			$compteur = '0';
			$active = '';
			$sqlLicence = '';
			$sqlQuittance = '';
			$sqlTypeApurement = '';

			if ($id_type_apur=='2') {
				$sqlTypeApurement = 'AND dos.ref_cvee IS NOT NULL';
			}

			if($id_mod_lic == '2'){

				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}

				if (isset($id_cli) && ($id_cli!='')) {
					// $sqlClient = ' AND dos.id_cli = "'.$id_cli.'"';

					$sqlClient = ' AND (dos.id_cli = "'.$id_cli.'" 
										OR SUBSTRING(md.num_lic, 1, 10) IN (
												SELECT SUBSTRING(num_lic, 1, 10)
													FROM licence
													WHERE id_cli = "'.$id_cli.'"
											)
									)';
				}else{
					$sqlClient = '';
				}

				if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
					$sqlQuittance = ' AND dos.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
				}

				$tableau = '';

				$requete = $connexion-> prepare("SELECT dos.id_dos, dos.ref_dos, dos.ref_decl, 
														DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl, dos.horse, dos.commodity, dos.id_mod_lic,
														dos.principal, dos.fob, dos.num_lic, 
														DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq, 
														DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
														dos.ref_liq, dos.ref_quit
													FROM dossier dos, marchandise_dossier md, licence lic
													WHERE dos.id_mod_lic = ?
														AND dos.id_dos NOT IN(
															SELECT detail_apurement.id_dos
																FROM detail_apurement, transmission_apurement
																WHERE detail_apurement.id_trans_ap = transmission_apurement.id_trans_ap
																	AND transmission_apurement.id_type_apur = ?
														)
														AND dos.ref_quit IS NOT NULL
														AND dos.date_quit IS NOT NULL
														AND dos.not_apurement = '0'
														ANd dos.id_dos = md.id_dos
														$sqlLicence
														$sqlClient
														$sqlQuittance
														AND trim(dos.num_lic) <> 'N/A'
														AND trim(md.num_lic) <> 'N/A'
														AND trim(md.num_lic) <> 'UNDER VALUE'
														AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING(lic.num_lic, 1, 10)
														AND lic.id_banq = ?
													GROUP BY dos.id_dos
													ORDER BY dos.id_dos ASC
													LIMIT 0, 300");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur'], $entree['id_banq']));
				while ($reponse = $requete-> fetch()) {
					$compteur++;
					$tableau .='<input type="hidden" name="id_dos_'.$compteur.'" value="'.$reponse['id_dos'].'">	
								<tr>
									<td>'.$compteur.'</td>
									<td style="text-align: center;">'.$reponse['ref_dos'].'</td>
									<td style="text-align: center;">'.$reponse['num_lic'].'</td>
									<td style="text-align: center;">'.$reponse['fob'].'</td>
									<td style="text-align: center;">'.$reponse['ref_decl'].'</td>
									<td style="text-align: center;">'.$reponse['ref_liq'].'</td>
									<td style="text-align: center;">'.$reponse['ref_quit'].'</td>
								</tr>
								';
				}$requete-> closeCursor();
				$tableau .= '<input type="hidden" name="nbre" value="'.$compteur.'">';
				return $tableau;
			}


		}

		public function selectionnerBanqueNewTransmit($id_cli, $id_mod_lic, $num_lic=NULL, $id_type_apur=1){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur = '0';
			$active = '';
			$sqlLicence = '';
			$sqlQuittance = '';
			$sqlTypeApurement = '';
			$select = '<select name=\'banque\' id=\'banque\' onchange=\'afficherDossierPourAppurementBanqueClientModeleLicenceByBanque(this.value, id_cli_banq.value, id_mod_lic_banq.value)\' class=\'form-control cc-exp\' required><option></option>';

			if ($id_type_apur=='2') {
				$sqlTypeApurement = 'AND dos.ref_cvee IS NOT NULL';
			}

			if($id_mod_lic == '2'){

				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}

				if (isset($id_cli) && ($id_cli!='')) {
					// $sqlClient = ' AND dos.id_cli = "'.$id_cli.'"';

					$sqlClient = ' AND (dos.id_cli = "'.$id_cli.'" 
										OR SUBSTRING(md.num_lic, 1, 10) IN (
												SELECT SUBSTRING(num_lic, 1, 10)
													FROM licence
													WHERE id_cli = "'.$id_cli.'"
											)
									)';
				}else{
					$sqlClient = '';
				}

				if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
					$sqlQuittance = ' AND dos.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
				}

				$requete = $connexion-> prepare("SELECT COUNT(dos.id_dos) AS nbre_dos, 
														banque.nom_banq AS nom_banq, 
														banque.id_banq AS id_banq
													FROM dossier dos, marchandise_dossier md, licence lic, banque
													WHERE dos.id_mod_lic = ?
														AND dos.id_dos NOT IN(
															SELECT detail_apurement.id_dos
																FROM detail_apurement, transmission_apurement
																WHERE detail_apurement.id_trans_ap = transmission_apurement.id_trans_ap
																	AND transmission_apurement.id_type_apur = ?
														)
														AND dos.ref_quit IS NOT NULL
														AND dos.date_quit IS NOT NULL
														AND dos.ref_assurance IS NOT NULL
														AND dos.not_apurement = '0'
														ANd dos.id_dos = md.id_dos
														$sqlLicence
														$sqlClient
														$sqlQuittance
														AND trim(dos.ref_assurance) <> ''
														AND trim(dos.num_lic) <> 'N/A'
														AND trim(md.num_lic) <> 'N/A'
														AND trim(md.num_lic) <> 'UNDER VALUE'
														AND lic.num_lic = md.num_lic
														AND banque.id_banq = lic.id_banq
													GROUP BY banque.id_banq
													ORDER BY banque.nom_banq ASC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
				while ($reponse = $requete-> fetch()) {
					$compteur++;
					$select .='
							<option value="'.$reponse['id_banq'].'">'.$reponse['nom_banq'].'</option>
					';
					
				}$requete-> closeCursor();

				$select .= '</select>';
			}

			return $select;

		}

		public function afficherDossierPourAppurementBanqueClientModeleLicenceBySupplier($supplier, $id_mod_lic){
			include('connexion.php');
			$entree['supplier'] = '%'.$supplier.'%';
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, ref_decl, 
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic,
													principal, fob, num_lic, 
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq, 
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													ref_liq, ref_quit
												FROM dossier
												WHERE supplier LIKE ?
													AND id_mod_lic = ?
													AND id_dos NOT IN(
														SELECT id_dos
															FROM detail_apurement
													)
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL");
			$requete-> execute(array($entree['supplier'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['num_lic'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['fob'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_decl'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_liq'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_quit'];
					?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Documents du Dossier<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherRapportKaniakaDate($kaniaka_arriv){
			include('connexion.php');
			$entree['kaniaka_arriv'] = $kaniaka_arriv;
			$compteur = '0';

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													d.transporter AS transporter,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													cl.code_cli AS code_cli,
													d.commodity AS commodity,
													d.id_dos AS id_dos,
													d.id_mod_lic AS id_mod_lic,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.kaniaka_arriv, '%d/%m/%Y') AS kaniaka_arriv, 
													DATE_FORMAT(d.kaniaka_dep, '%d/%m/%Y') AS kaniaka_dep,
													DATE_FORMAT(d.tr8_date, '%d/%m/%Y') AS tr8_date,
													d.tr8_ref AS tr8_ref,
													d.kaniaka_arriv AS kaniaka_arriv_2, 
													d.kaniaka_dep AS kaniaka_dep_2
												FROM dossier d, client cl
												WHERE d.kaniaka_arriv = ?
													AND d.id_mod_trans = '1'
													AND d.id_Cli = cl.id_cli");
			$requete-> execute(array($entree['kaniaka_arriv']));
			while ($reponse = $requete-> fetch()) {
				include('modalAjoutCamion.php');
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_preal'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['transporter'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['trailer_1'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['trailer_2'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['code_cli'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>

				<td style="text-align: center; color: orange;">
					<?php
						echo $reponse['tr8_ref'];
					?>
				</td>

				<td style="text-align: center; color: orange;">
					<?php
						echo $reponse['tr8_date'];
					?>
				</td>

				<td style="text-align: center;">
					<?php
						echo $reponse['kaniaka_arriv'];
					?>
				</td>

				<td style="text-align: center;">
					<?php
						echo $reponse['kaniaka_dep'];
					?>
				</td>

				<td>
					<button class="btn btn-primary square-btn-adjust" data-toggle="modal" data-target=".ajourCamion_<?php echo $reponse['id_dos'];?>">
	                    <i class="fa fa-edit"></i> Editer
	                </button>
				</td>

				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Documents du Dossier<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossierKaniaka($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherRapportKaniakaRechercheCamion($camion){
			include('connexion.php');
			$entree['camion'] = $camion;
			$compteur = '0';

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													d.transporter AS transporter,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.id_dos AS id_dos,
													cl.code_cli AS code_cli,
													d.commodity AS commodity,
													DATE_FORMAT(d.kaniaka_arriv, '%d/%m/%Y') AS kaniaka_arriv, 
													DATE_FORMAT(d.kaniaka_dep, '%d/%m/%Y') AS kaniaka_dep,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(d.tr8_date, '%d/%m/%Y') AS tr8_date,
													d.kaniaka_arriv AS kaniaka_arriv_2, 
													d.kaniaka_dep AS kaniaka_dep_2,
													d.tr8_ref AS tr8_ref
												FROM dossier d, client cl
												WHERE (horse = ? OR trailer_1 = ? OR trailer_2 = ?)
													AND id_mod_trans = '1'
													AND d.id_cli = cl.id_cli
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['camion'], $entree['camion'], $entree['camion']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalAjoutCamion.php');
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr>
				<td><?php echo $compteur;?></td>
				<td style="text-align: center;">
					<?php
						echo $reponse['ref_dos'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['date_preal'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['transporter'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['horse'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['trailer_1'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['trailer_2'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['code_cli'];
					?>
				</td>
				<td style="text-align: center;">
					<?php
						echo $reponse['commodity'];
					?>
				</td>

				<td style="text-align: center; color: orange;">
					<?php
						echo $reponse['tr8_ref'];
					?>
				</td>

				<td style="text-align: center; color: orange;">
					<?php
						echo $reponse['tr8_date'];
					?>
				</td>

				<td style="text-align: center;">
					<?php
						echo $reponse['kaniaka_arriv'];
					?>
				</td>

				<td style="text-align: center;">
					<?php
						echo $reponse['kaniaka_dep'];
					?>
				</td>

				<td>
					<button class="btn btn-primary square-btn-adjust" data-toggle="modal" data-target=".ajourCamion_<?php echo $reponse['id_dos'];?>">
	                    <i class="fa fa-plus"></i> Ajouter
	                </button>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Documents du Dossier<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossierKaniaka($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherLigneDossierFacturePartielle($id_dos){
			include('connexion.php');
			$entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$compteur=0;
			$html = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
												FROM dossier
												WHERE ref_dos_2 = ?
												ORDER BY ref_dos");
			$requete-> execute(array($entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$html .= '<td style="border: 0.5px solid black;"><input type="hidden" name="id_dos_'.$compteur.'[]" value="'.$reponse['id_dos'].'"><input type="number" step="0.001" style="width: 10em;" class="form-control cc-exp" name="montant_1_'.$compteur.'[]" required></td><td style="border: 0.5px solid black;"><select class="form-control cc-exp" name="usd_1_'.$compteur.'[]" style="width: 5em;" ><option value="1">USD</option><option value="0">CDF</option></select></td><td style="border: 0.5px solid black;"><select class="form-control cc-exp" name="tva_1_'.$compteur.'[]" style="width: 5em;" ><option value="0">NO</option><option value="1">YES</option></select></td>';
			}$requete-> closeCursor();

			$html .= '<td style="border: 0.5px solid black;"><button class="btn btn-danger" name="remove" id="remove">Remove</button></td>';

			return $html;
		}


		public function afficherEnTeteTableauExcel($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col, c.id_col AS id_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 0.2px solid white; background-color: #696969; color: white;">#</th>
		      <th style="border: 0.2px solid white; background-color: #696969; color: white;">MCA File REF</th>
			<?php
			while ($reponse = $requete-> fetch()) {
				if ($reponse['id_col'] == '44') {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 50em; padding-right: 50em;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '43') {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 60em; padding-right: 60em;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '11') {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 300px; padding-right: 300px;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '13') {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 300px; padding-right: 300px;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white;">
					<?php echo $reponse['titre_col'];?>
				</th>
				<?php

				}
			}$requete-> closeCursor();
			?>
			</tr>
			<?php
		}

		public function afficherEnTeteTableauExcel2($id_mod_lic, $id_cli, $id_mod_trans, $excel){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$row = 4;
			$col = 'C';
			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col, c.id_col AS id_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			$excel-> getActiveSheet()
				-> setCellValue('A1', $reponse['titre_col'])
				-> setCellValue('A1', $reponse['titre_col']);

				/*
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 0.2px solid white; background-color: #696969; color: white;">#</th>
		      <th style="border: 0.2px solid white; background-color: #696969; color: white;">MCA File REF</th>
			<?php
			while ($reponse = $requete-> fetch()) {
				if ($reponse['id_col'] == '44') {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 50em; padding-right: 50em;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '43') {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 60em; padding-right: 60em;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '11') {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 300px; padding-right: 300px;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '13') {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 300px; padding-right: 300px;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else {
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white;">
					<?php echo $reponse['titre_col'];?>
				</th>
				<?php

				}
			}$requete-> closeCursor();
			?>
			</tr>
			<?php */
		}

		public function verifierSouscriptionLicence($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT id_cli
												FROM souscription_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			$reponse = $requete-> fetch();

			if ($reponse) {
				return true;
			}else{
				return false;
			}
		}

		public function verifierDoublonFacture($ref_fact){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE ref_fact = ?');
			$requete-> execute(array($entree['ref_fact']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function verifierDoublonManifest($road_manif){
			include('connexion.php');

			$entree['road_manif'] = $road_manif;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE road_manif = ?');
			$requete-> execute(array($entree['road_manif']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getDossiersDoublonFacture($ref_fact){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;

			$liste = '';

			$requete = $connexion-> prepare('SELECT ref_dos
												FROM dossier
												WHERE ref_fact = ?');
			$requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$liste .= ' | '.$reponse['ref_dos'];
			}$requete-> closeCursor();

			return $liste;
		}

		public function getDossiersDoublonManifest($road_manif){
			include('connexion.php');

			$entree['road_manif'] = $road_manif;

			$liste = '';

			$requete = $connexion-> prepare('SELECT ref_dos
												FROM dossier
												WHERE road_manif = ?');
			$requete-> execute(array($entree['road_manif']));

			while($reponse = $requete-> fetch()){
				$liste .= ' | '.$reponse['ref_dos'];
			}$requete-> closeCursor();

			return $liste;
		}

		public function getDocumentForDossier($id_dos, $id_doc){
			$entree['id_dos'] = $id_dos;
			$entree['id_doc'] = $id_doc;
			include('connexion.php');

			$requete = $connexion-> prepare("SELECT *
												FROM dossier_document
												WHERE id_dos = ?
													AND id_doc = ?");
			$requete-> execute(array($entree['id_dos'], $entree['id_doc']));

			$reponse = $requete-> fetch();

			if(!empty($reponse)){
				return $reponse['piece'];
			}else{
				return 0;
			}
		}

		public function notificationDoublonFacture($id_cli, $id_mod_lic, $id_mod_trans, $id_march){
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;
			include('connexion.php');
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbr_doublon, CONCAT(ref_fact,'_',road_manif) AS ref_fact_road_manif
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_mod_trans = ?
													AND id_march = ?
												GROUP BY ref_fact_road_manif
												HAVING COUNT(ref_fact_road_manif) > 1");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_march']));
			while ($reponse=$requete-> fetch()) {
				$compteur++;
			}$requete-> closeCursor();

			return $compteur;
		}

		public function notificationDoublonFacture2($id_mod_lic){
			// $entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			// $entree['id_mod_trans'] = $id_mod_trans;
			// $entree['id_march'] = $id_march;
			include('connexion.php');
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbr_doublon, CONCAT(ref_fact,'_',road_manif,'_',id_cli) AS ref_fact_road_manif
												FROM dossier
												WHERE id_mod_lic = ?
												GROUP BY ref_fact_road_manif
												HAVING COUNT(ref_fact_road_manif) > 1");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse=$requete-> fetch()) {
				$compteur++;
			}$requete-> closeCursor();

			return $compteur;
		}

		public function listeNotificationDoublonFacture2($id_mod_lic){
			$entree['id_mod_lic'] = $id_mod_lic;
			include('connexion.php');
			$compteur = 0;
			$tableau = '';

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbr_doublon, ref_fact, CONCAT(ref_fact,'_',road_manif,'_',id_cli) AS ref_fact_road_manif
												FROM dossier
												WHERE id_mod_lic = ?
												GROUP BY ref_fact_road_manif
												HAVING COUNT(ref_fact_road_manif) > 1");
			$requete-> execute(array($entree['id_mod_lic']));

			while ($reponse = $requete-> fetch()) {
				
				$requeteDossier = $connexion-> prepare("SELECT d.id_dos AS id_dos, 
																d.ref_dos AS ref_dos, 
																d.ref_fact AS ref_fact, 
																d.road_manif AS road_manif, 
																cl.nom_cli AS nom_cli,
																d.horse AS horse, 
																d.trailer_1 AS trailer_1, 
																d.trailer_2 AS trailer_2, 
																d.road_manif AS road_manif,
																DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
																d.remarque AS remarque, 
																d.commodity AS commodity,
																DATEDIFF(CURRENT_DATE(), d.date_preal) AS delay
															FROM dossier d, client cl
															WHERE CONCAT(d.ref_fact,'_',d.road_manif,'_',d.id_cli) = ?
																AND d.id_mod_lic = ?
																AND d.id_cli = cl.id_cli
															ORDER BY d.id_dos ASC");
				$requeteDossier-> execute(array($reponse['ref_fact_road_manif'], $entree['id_mod_lic']));
				while ($reponseDossier = $requeteDossier-> fetch()) {
					$compteur++;
					$tableau .='<tr>
									<td>'.$compteur.'</td>
									<td>'.$reponseDossier['nom_cli'].'</td>
									<td>'.$reponseDossier['ref_dos'].'</td>
									<td>'.$reponseDossier['ref_fact'].'</td>
									<td>'.$reponseDossier['road_manif'].'</td>
									<td>'.$reponseDossier['horse'].'</td>
									<td>'.$reponseDossier['trailer_1'].'</td>
									<td>'.$reponseDossier['trailer_2'].'</td>
									<td>'.$reponseDossier['commodity'].'</td>
									<td>'.$reponseDossier['date_preal'].'</td>
									<td>'.$reponseDossier['delay'].'</td>
									<td>'.$reponseDossier['remarque'].'</td>
								</tr>';
				}
			}$requete-> closeCursor();

			return $tableau;
		}

		public function listeNotificationDoublonFacture($id_cli, $id_mod_lic, $id_mod_trans, $id_march){
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;
			include('connexion.php');
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbr_doublon, ref_fact, CONCAT(ref_fact,'_',road_manif) AS ref_fact_road_manif
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_mod_trans = ?
													AND id_march = ?
												GROUP BY ref_fact_road_manif
												HAVING COUNT(ref_fact_road_manif) > 1");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_march']));

			while ($reponse = $requete-> fetch()) {
				
				$requeteDossier = $connexion-> prepare("SELECT id_dos, ref_dos, horse, trailer_1, trailer_2, road_manif,
																DATE_FORMAT(date_preal, '%d/%m/%Y') AS date_preal
															FROM dossier
															WHERE CONCAT(ref_fact,'_',road_manif) = ?
																AND id_cli = ?
																AND id_mod_lic = ?
																AND id_mod_trans = ?
																AND id_march = ? 
															ORDER BY id_dos DESC");
				$requeteDossier-> execute(array($reponse['ref_fact_road_manif'], $entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_march']));
				while ($reponseDossier = $requeteDossier-> fetch()) {
					$compteur++;
				?>
				<tr>
					<td style="text-align: center;">
						<?php echo $compteur;?>
					</td>
					<td style="text-align: center; color: orange;">
						<?php echo $reponse['ref_fact'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponseDossier['ref_dos'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponseDossier['date_preal'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponseDossier['horse'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponseDossier['trailer_1'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponseDossier['trailer_2'];?>
					</td>
					<td style="text-align: center; color: orange;">
						<?php echo $reponseDossier['road_manif'];?>
					</td>
				</tr>
				<?php
				}
			}$requete-> closeCursor();


		}

		public function listeDossierPourFacturation($id_cli, $id_mod_lic, $id_mod_trans, $id_march){
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;
			include('connexion.php');
			$compteur = 0;

			$requeteDossier = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													d.id_dos,
													d.ref_dos_2,
													u.nom_util AS nom_util,
													d.ref_fact,
													d.poids, 
													d.poids_brut,
													d.commodity AS commodity,
													d.num_lot AS num_lot,
													d.num_bp AS num_bp,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_quit AS ref_quit,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													d.fob, d.fret, d.assurance, d.autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal, montant_decl
												FROM dossier d, utilisateur u
												WHERE d.id_mod_lic = ?
													ANd d.id_util = u.id_util
													AND d.id_cli = ?
													AND (
															(d.etat_feuil_calc = '1'
															AND d.date_verif_feuil_calc IS NOT NULL
															AND d.id_util_verif_feuil_calc IS NOT NULL
															AND d.id_mod_lic = '2')
														OR (
															d.id_mod_lic = '1'
															AND d.date_trans_fact IS NULL)
														)
													AND d.date_quit IS NOT NULL AND d.ref_quit IS NOT NULL
													AND d.id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fd
																WHERE fd.id_t_trans = ?
																	AND fd.ref_fact = det.ref_fact
														)
													AND d.not_fact = '0'");
			$requeteDossier-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseDossier = $requeteDossier-> fetch()) {
				$compteur++;
			?>
			<form method="post" action="">
				<input type="hidden" name="id_dos" value="<?php echo $reponseDossier['id_dos'];?>">
				<input type="hidden" name="ref_dos" value="<?php echo $reponseDossier['ref_dos'];?>">
				<tr>
					<td style="text-align: ;">
						<?php echo $compteur;?>
					</td>
					<td style="text-align: ;">
						<?php echo $reponseDossier['nom_util'];?>
					</td>
					<td style="text-align: ;">
						<?php echo $reponseDossier['ref_dos'];?>
					</td>
					<td style="text-align: ;">
						<?php echo $reponseDossier['date_preal'];?>
					</td>
					<td style="text-align: ;">
						<?php echo $reponseDossier['num_lot'];?>
					</td>
					<td style="text-align: ;">
						<?php echo $reponseDossier['ref_fact'];?>
					</td>
					<td style="text-align: ;">
						<?php echo $reponseDossier['num_bp'];?>
					</td>
					<td style="text-align: right;">
						<?php echo number_format($reponseDossier['fob'], 2, ',', ' ');?>
					</td>
					<td style="text-align: right;">
						<?php echo number_format($reponseDossier['poids'], 2, ',', ' ');?>
					</td>
					<td style="text-align: right;">
						<?php echo number_format($reponseDossier['poids_brut'], 2, ',', ' ');?>
					</td>
					<td style="text-align: ;">
						<?php echo $reponseDossier['horse'];?>
					</td>
					<td style="text-align: ;">
						<?php echo $reponseDossier['trailer_1'];?>
					</td>
					<td style="text-align: ;">
						<?php echo $reponseDossier['trailer_2'];?>
					</td>
					<td style="text-align: center;">
						<button class="btn-xs btn-success" name="ok">Valider</button>
					</td>
				</tr>
			</form>
			<?php
			}$requeteDossier-> closeCursor();


		}

		public function listeDossierPourFacturationAjax($id_cli, $id_mod_lic, $id_mod_trans, $id_march){
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;
			include('connexion.php');
			$compteur = 0;

			$tbl = '';

			$requeteDossier = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													d.id_dos AS id_dos,
													d.ref_dos_2,
													u.nom_util AS nom_util,
													d.ref_fact,
													d.poids, 
													d.poids_brut,
													d.commodity AS commodity,
													d.num_lot AS num_lot,
													d.num_bp AS num_bp,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_quit AS ref_quit,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													d.fob, d.fret, d.assurance, d.autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal, montant_decl
												FROM dossier d, utilisateur u
												WHERE d.id_mod_lic = ?
													ANd d.id_util = u.id_util
													AND d.id_cli = ?
													AND (
															(d.etat_feuil_calc = '1'
															AND d.date_verif_feuil_calc IS NOT NULL
															AND d.id_util_verif_feuil_calc IS NOT NULL
															AND d.id_mod_lic = '2')
														OR (
															d.id_mod_lic = '1'
															AND d.date_trans_fact IS NULL)
														)
													AND d.date_quit IS NOT NULL AND d.ref_quit IS NOT NULL
													AND d.id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fd
																WHERE fd.id_t_trans = ?
																	AND fd.ref_fact = det.ref_fact
														)
													AND d.not_fact = '0'");
			$requeteDossier-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseDossier = $requeteDossier-> fetch()) {
				$compteur++;
				$tbl .= '<tr>
							<td style="text-align: ;">
								'.$compteur.'
							</td>
							<td style="text-align: ;">
								'.$reponseDossier['nom_util'].'
							</td>
							<td style="text-align: ;">
								'.$reponseDossier['ref_dos'].'
							</td>
							<td style="text-align: ;">
								'.$reponseDossier['date_preal'].'
							</td>
							<td style="text-align: ;">
								'.$reponseDossier['num_lot'].'
							</td>
							<td style="text-align: ;">
								'.$reponseDossier['ref_fact'].'
							</td>
							<td style="text-align: ;">
								'.$reponseDossier['num_bp'].'
							</td>
							<td style="text-align: right;">
								'.number_format($reponseDossier['fob'], 2, ',', ' ').'
							</td>
							<td style="text-align: right;">
								'.number_format($reponseDossier['poids'], 2, ',', ' ').'
							</td>
							<td style="text-align: right;">
								'.number_format($reponseDossier['poids_brut'], 2, ',', ' ').'
							</td>
							<td style="text-align: ;">
								'.$reponseDossier['horse'].'
							</td>
							<td style="text-align: ;">
								'.$reponseDossier['trailer_1'].'
							</td>
							<td style="text-align: ;">
								'.$reponseDossier['trailer_2'].'
							</td>
							<td style="text-align: center;">
								<button class="btn-xs btn-warning" onclick="modalEditDossier('.$reponseDossier['id_dos'].')"><i class="fa fa-edit"></i> Editer</button>
							</td>
							<td style="text-align: center;">
								<button class="btn-xs btn-success" onclick="MAJ_date_trans_fact('.$reponseDossier['id_dos'].', \''.$reponseDossier['ref_dos'].'\')"><i class="fa fa-check"></i> Valider</button>
							</td>
						</tr>';

			}$requeteDossier-> closeCursor();

			return $tbl;

		}

		public function template_master_data($id_cli, $id_mod_lic, $id_t_dos){
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_t_dos'] = $id_t_dos;

			include('connexion.php');
			$compteur = 0;

			$tbl = '';

			if($id_t_dos == 'divers'){

				$tbl = '<input type="hidden" name="type" value="'.$id_t_dos.'">';

				$requeteDossier = $connexion-> prepare("SELECT ref_dos, 
																id_dos,
																ref_decl,
																DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
																ref_liq,
																DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
																ref_quit,
																DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
															FROM dossier
															WHERE id_cli = ?
																AND id_mod_lic = ?
																AND not_fact = '0'
																AND id_march = '11'
																AND principal = '1'
																AND ref_decl IS NOT NULL
																AND date_decl IS NOT NULL
																AND ref_liq IS NOT NULL
																AND date_liq IS NOT NULL
																AND ref_quit IS NOT NULL
																AND date_quit IS NOT NULL
																AND id_dos NOT IN(
																	SELECT det.id_dos 
																		FROM detail_facture_dossier det, facture_dossier fact
																		WHERE fact.id_t_trans = 2
																			AND det.ref_fact = fact.ref_fact
																)
															");
				$requeteDossier-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
				while ($reponseDossier = $requeteDossier-> fetch()) {
					$compteur++;
					$tbl .= '<tr>
								<td style="text-align: center;">
									'.$compteur.'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['ref_dos'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['ref_decl'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['date_decl'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['ref_liq'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['date_liq'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['ref_quit'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['date_quit'].'
								</td>
								<td style="text-align: center;">
									<input type="radio" name="id_dos" name="id_dos" value="'.$reponseDossier['id_dos'].'">
								</td>
							</tr>';

				}$requeteDossier-> closeCursor();

			}else{

				$tbl = '<input type="hidden" name="type" value="'.$id_t_dos.'">';
				
				$requeteDossier = $connexion-> prepare("SELECT ref_dos, 
																id_dos,
																ref_decl,
																DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
																ref_liq,
																DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
																ref_quit,
																DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
															FROM dossier
															WHERE id_cli = ?
																AND id_mod_lic = ?
																AND not_fact = '0'
																AND id_march <> '11'
																AND ref_decl IS NOT NULL
																AND date_decl IS NOT NULL
																AND ref_liq IS NOT NULL
																AND date_liq IS NOT NULL
																AND ref_quit IS NOT NULL
																AND date_quit IS NOT NULL
																AND id_dos NOT IN(
																	SELECT det.id_dos 
																		FROM detail_facture_dossier det, facture_dossier fact
																		WHERE fact.id_t_trans = 2
																			AND det.ref_fact = fact.ref_fact
																)
															");
				$requeteDossier-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
				while ($reponseDossier = $requeteDossier-> fetch()) {
					$compteur++;
					$tbl .= '<tr>
								<input type="hidden" name="id_dos_'.$compteur.'" name="id_dos_'.$compteur.'" value="'.$reponseDossier['id_dos'].'">
								<td style="text-align: center;">
									'.$compteur.'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['ref_dos'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['ref_decl'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['date_decl'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['ref_liq'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['date_liq'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['ref_quit'].'
								</td>
								<td style="text-align: center;">
									'.$reponseDossier['date_quit'].'
								</td>
								<td style="text-align: center;">
									<input type="checkbox" name="check_'.$compteur.'" id="check_'.$compteur.'" />
								</td>
							</tr>';

				}$requeteDossier-> closeCursor();

			}

			$tbl .='<input type="hidden" name="nbre" value="'.$compteur.'">';

			return $tbl;

		}

		public function getNombreDossierRefFacture($ref_fact){
			$entree['ref_fact'] = $ref_fact;
			include('connexion.php');

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));

			$reponse = $requete-> fetch();

			if(!empty($reponse)){
				return $reponse['nbre'];
			}else{
				return 0;
			}
		}

		public function getListeDocumentForDossier($id_dos, $id_mod_lic){
			
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				if($reponse['id_doc']==49 && ($this-> verifierPlisBP($this-> getDossier($id_dos)['num_bp'], $this-> getDossier($id_dos)['id_cli']))){
					$num_dos = $this-> getDossier($id_dos)['ref_dos'];
						
					// if(stristr($num_dos, '/') == true) {
					// 	$num_dos = str_replace("/", "_", "$num_dos");
					// }
					
					// $piece = $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);
					?>
					<a class="dropdown-item" onclick="window.open('../documents/<?php echo $this-> verifierPlisBP($this-> getDossier($id_dos)['num_bp'], $this-> getDossier($id_dos)['id_cli'])['num_lic'];?>/<?php echo $this-> verifierPlisBP($this-> getDossier($id_dos)['num_bp'], $this-> getDossier($id_dos)['id_cli'])['fichier_plis'];?>','pop4','width=700,height=900');">
						<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
					</a>
					<?php
				}else if($this-> getDocumentForDossier($id_dos, $reponse['id_doc']) == '0'){
					
				}else if(file_exists('../documents/'.$this-> getDossier($id_dos)['ref_dos'].'/'.$this-> getDocumentForDossier($id_dos, $reponse['id_doc']))){
					$num_dos = $this-> getDossier($id_dos)['ref_dos'];
						
					if(stristr($num_dos, '/') == true) {
						$num_dos = str_replace("/", "_", "$num_dos");
					}
					
					$piece = $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);
					?>
					<a class="dropdown-item" onclick="window.open('../documents/<?php echo $num_dos;?>/<?php echo $piece;?>','pop4','width=700,height=900');">
						<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
					</a>
					<?php
				}

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function tableauDocumentForDossier($id_dos){
			
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT doc.nom_doc AS nom_doc,
													dd.piece AS piece,
													dos.ref_dos AS ref_dos
												FROM document doc, dossier_document dd, dossier dos
												WHERE doc.id_doc = dd.id_doc
													AND dd.id_dos = ?
													AND dd.id_dos = dos.id_dos");
			$requete-> execute(array($entree['id_dos']));


			while($reponse = $requete-> fetch()){
				$compteur++;
					?>

					<tr onMouseOver="this.style.cursor='pointer'" onclick="window.open('../documents/<?php echo $reponse['ref_dos'];?>/<?php echo $reponse['piece'];?>','pop4','width=700,height=900');">
						<td><?php echo $compteur;?></td>
						<td>
							<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
						</td>
					</tr>
					<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function verifierPlisBP($num_bp, $id_cli){
			
			include('connexion.php');
			$entree['num_bp'] = $num_bp;
			$entree['id_cli'] = $id_cli;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT *
												FROM plis
												WHERE num_bp = ?
													AND id_cli = ?");
			$requete-> execute(array($entree['num_bp'], $entree['id_cli']));
			$reponse = $requete-> fetch();

			if ($reponse) {
				return $reponse;
			}else{
				return false;
			}

		}

		public function getListeDocumentForDossier2($id_dos, $id_mod_lic){
			
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				if($this-> getDocumentForDossier($id_dos, $reponse['id_doc']) == '0'){
					
				}else{
					$num_dos = $this-> getDossier($id_dos)['ref_dos'];
						
					if(stristr($num_dos, '/') == true) {
						$num_dos = str_replace("/", "_", "$num_dos");
					}
					
					$piece = $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);
					?>
					<a class="dropdown-item" onclick="window.open('../../documents/<?php echo $num_dos;?>/<?php echo $piece;?>','pop1','width=700,height=900');">
						<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
					</a>
					<?php
				}

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function getFactureDossierTransmis($id_trans_fact){
			
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact, fd.id_cli AS id_cli, 
													fd.type_fact AS type_fact
											FROM facture_dossier fd, transmis_facture_dossier trans, 
												detail_transmis_facture_dossier det
											WHERE trans.id_trans_fact = ?
												AND trans.id_trans_fact = det.id_trans_fact
												AND det.ref_fact = fd.ref_fact
											ORDER BY fd.ref_fact");
			$requete-> execute(array($entree['id_trans_fact']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				
					if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898) {
				?>
					<a class="dropdown-item" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
					<i class="fa fa-file"></i> <?php echo $reponse['ref_fact'];?>
				</a>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
					<a class="dropdown-item" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
					<i class="fa fa-file"></i> <?php echo $reponse['ref_fact'];?>
				</a>
				<?php
					}else if ($reponse['id_cli'] == 912) {
				?>
					<a class="dropdown-item" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
						<i class="fa fa-file"></i> <?php echo $reponse['ref_fact'];?>
					</a>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885')) {
				?>
					<a class="dropdown-item" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
					<i class="fa fa-file"></i> <?php echo $reponse['ref_fact'];?>
				</a>
				<?php
					}else{
				?>
					<a class="dropdown-item" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
					<i class="fa fa-file"></i> <?php echo $reponse['ref_fact'];?>
				</a>
				<?php
					}

			}$requete-> closeCursor();

		}

		public function getListeDocumentForDossierKaniaka($id_dos, $id_mod_lic){
			
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				if($this-> getDocumentForDossier($id_dos, $reponse['id_doc']) == '0'){
					
				}else{
					$num_dos = $this-> getDossier($id_dos)['ref_dos'];
						
					if(stristr($num_dos, '/') == true) {
						$num_dos = str_replace("/", "_", "$num_dos");
					}
					
					$piece = $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);
					?>
					<a class="dropdown-item" onclick="window.open('../../documents/<?php echo $num_dos;?>/<?php echo $piece;?>','pop1','width=700,height=900');">
						<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
					</a>
					<?php
				}

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang_tracking ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
					$clignoteCleared = false;
				if ($reponse['id_col'] == '40' && $id_mod_lic == '2') {
					$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					if ( ($getDataRowCalculNetDays >= 0) && ($getDataRowCalculNetDays <= 3) ) {
						$bg = "badge badge-success";
					}else if ( ($getDataRowCalculNetDays > 3) && ($getDataRowCalculNetDays <= 5) ) {
						$bg = "badge badge-warning";
					}else if ( ($getDataRowCalculNetDays > 5) ) {
						$bg = "badge badge-danger";
					}
				?>
				<td style="border: 1px solid black; text-align: center;">
					<span class=" <?php echo $bg;?>">
					<?php
						echo $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					?>
					</span>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php
					$bg = '';

				}else if ($reponse['id_col'] == '40' && $id_mod_lic == '1') {

					if ($id_mod_trans == '4') {
						# code...
					}else{



							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "badge badge-success";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 7) ) {
								$bg = "badge badge-warning";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 7) ) {
								$bg = "badge badge-danger";
							}
						?>
						<td style="border: 1px solid black; text-align: center;">
							<span class=" <?php echo $bg;?>">
							<?php
								echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos));
							?>
							</span>
						</td>
						<?php

							$bg = '';




					}

				}
				else if ($reponse['id_col'] == '228') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						$clignoteCleared = true;
						?>
							<option>NO</option>
							<option value="1">YES</option>
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
							<option>YES</option>
							<option value="0">NO</option>
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '38') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						$clignoteCleared = true;
						?>
							<option>TRANSIT</option>
							<option value="1">CLEARED</option>
							<option value="2">CANCELLED</option>
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
							<option>CLEARED</option>
							<option value="0">TRANSIT</option>
							<option value="2">CANCELLED</option>
						<?php
					}else if ( ($getDataRow == '2') ) {
						?>
							<option>CANCELLED</option>
							<option value="0">TRANSIT</option>
							<option value="1">CLEARED</option>
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '49') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
						<option><?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?></option>
						<option></option>
						<option value="LUBUMBASHI">LUBUMBASHI</option>
						<option value="KOLWEZI">KOLWEZI</option>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '18') {
					//Date Expiration Licence
					if ( ($this-> getDifferenceDate($this-> getDateExpirationLicence2($this-> getDossier($id_dos)['num_lic']), date('Y-m-d')) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteLic = ' clignoteb';
						$couleurLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteLic = '';
						$couleurLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurLic;?>">
					<?php echo $this-> getDateExpirationLicence($this-> getDossier($id_dos)['num_lic'])?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '50') {
					// Poids Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'];?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '54') {
					// Balance Tons Licence
					if ( ((($this-> getBalanceLicenceDossier($id_dos)*100)/($this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'])) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteBalanceLic = ' clignoteb';
						$couleurBalanceLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteBalanceLic = '';
						$couleurBalanceLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteBalanceLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurBalanceLic;?>">
					<?php echo number_format( $this-> getBalanceLicenceDossier($id_dos), 2, ',', ' ');?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '71') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('ceec_out', $id_dos), $this-> getDataRow('ceec_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '74') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('min_div_out', $id_dos), $this-> getDataRow('min_div_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '36') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('dgda_out', $id_dos), $this-> getDataRow('dgda_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '88') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '80') {
					// DA To Exit
					if ($this-> getDossier($id_dos)['id_mod_trans'] == '4') {
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('docs_sncc', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}else{
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}

				}
				else if ($reponse['calcul'] == '1') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php
						if (isset($this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']])) {
							echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];
						}
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php

				}else if ($reponse['id_col'] == '44') {
					if (!isset($this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'])) {

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input type="<?php echo $reponse['type_col'];?>" style="width: 25em;" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'] ?> name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow('supplier', $id_dos);?>">
						</td>
						<?php

					}else{

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input type="text" style="width: 25em;" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'] ?> name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'];?>">
						</td>
						<?php

					}
				}else if ($reponse['id_col'] == '42') {
					// Status
					$bgStatuts = '';
					if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
						$bgStatuts = 'bg bg-primary';
					}
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'] ?>>
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '222') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'] ?>>
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}
				//Type d'emballage
				else if ($reponse['id_col'] == '236') {
					// Status
					$bgStatuts = '';
					
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'] ?>>
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getEmballage($this-> getDataRow($reponse['champ_col'], $id_dos))['nom_emb'];?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerEmballage($_GET['id_cli'], $_GET['id_mod_trac']);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}
				else if ($reponse['id_col'] == '210') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerTruckLocationModeleLicenceModeTransportClient($id_mod_lic, $id_mod_trans, $id_cli);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}
				//Doublon facture
				else if ($reponse['champ_col'] == 'ref_fact' && ($this-> verifierDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: white; background-color: purple;';


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'].' '.$this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				//Doublon MAnifest
				else if ($reponse['champ_col'] == 'road_manif' && ($this-> verifierDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: white; background-color: red;';


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'].' '.$this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				else if ($reponse['champ_col'] == 'remarque') {

					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'].' '.$this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?> style="text-transform:uppercase; <?php echo $textColor;?>  width: 35em;" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				else if ($reponse['champ_col'] == 'date_creat_dos') {

					?>
					<td style="border: 1px solid black; text-align: center;" disabled>
						<?php
							echo $this-> getDataRow('date_creat_dos', $id_dos);
						?>
					</td>
					<?php

				}
				else{
					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'].' '.$this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherRowLicence($id_mod_lic, $num_lic, $compteur){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$bg = '';

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col
											FROM colonne c, affectation_colonne_modele_licence af
											WHERE c.id_col = af.id_col
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
					$clignoteCleared = false;
				if($reponse['id_col'] == '198'){
				?>
				<td style="text-align: center;">
					<?php
					echo $this-> getMarchandise($this-> getLicence($num_lic)['id_march']);
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '293'){
				?>
				<td style="text-align: center;">
					<?php
					echo $this-> getDateExpirationLicence($num_lic);
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '294'){
				?>
				<td style="text-align: center;">
					<?php
					echo $this-> getNbreDossierLicenceExport($num_lic);
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '295'){
				?>
				<td style="text-align: right;">
					<?php
					echo number_format($this-> getLicence($num_lic)['poids'], 2, ',', ' ');
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '296'){
				?>
				<td style="text-align: right;">
					<?php
					echo number_format($this-> getSommePoidsLicenceExport($num_lic), 2, ',', ' ');
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '295'){
				?>
				<td style="text-align: right;">
					<?php
					echo number_format($this-> getLicence($num_lic)['poids'], 2, ',', ' ');
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '296'){
				?>
				<td style="text-align: right;">
					<?php
					echo number_format($this-> getSommePoidsLicenceExport($num_lic), 2, ',', ' ');
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '297'){
				?>
				<td style="text-align: right;">
					<?php
					echo number_format($this-> getLicence($num_lic)['poids']-$this-> getSommePoidsLicenceExport($num_lic), 2, ',', ' ');
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '300'){
				?>
				<td style="text-align: right;">
					<?php
					echo number_format($this-> getSommeFobLicenceExport($num_lic), 2, ',', ' ');
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '301'){
				?>
				<td style="text-align: right;">
					<?php
					echo number_format($this-> getLicence($num_lic)['fob']-$this-> getSommeFobLicenceExport($num_lic), 2, ',', ' ');
					?>
				</td>
				<?php
				}else if($reponse['id_col'] == '298'){
				?>
				<td style="text-align: center;">
					<?php
					echo $this-> getDifferenceDate($this-> getDateExpirationLicence2($num_lic), date('Y-m-d'));
					?>
				</td>
				<?php
				}else{
				?>
				<td style="text-align: center;">
					<?php
					echo $this-> getDataRowLicence($reponse['champ_col'], $num_lic);
					?>
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherRowTableauEncodeur($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur, $id_util){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_util'] = $id_util;
			$bg = '';
			$enable = '';
			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col,
													IF(afcu.edit_tracking='0', 'disabled', '') AS enable
											FROM colonne c, affectation_colonne_utilisateur afcu, utilisateur util
											WHERE c.id_col = afcu.id_col
												AND afcu.id_util = util.id_util
											    AND util.id_util = ?
											    AND afcu.id_mod_trans = ?
											    AND afcu.id_mod_lic = ?
											ORDER BY afcu.rang ASC");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
					$clignoteCleared = false;

				if ($reponse['id_col'] == '40' && $id_mod_lic == '2') {
					$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					if ( ($getDataRowCalculNetDays >= 0) && ($getDataRowCalculNetDays <= 3) ) {
						$bg = "badge badge-success";
					}else if ( ($getDataRowCalculNetDays > 3) && ($getDataRowCalculNetDays <= 5) ) {
						$bg = "badge badge-warning";
					}else if ( ($getDataRowCalculNetDays > 5) ) {
						$bg = "badge badge-danger";
					}
				?>
				<td style="border: 1px solid black; text-align: center;">
					<span class=" <?php echo $bg;?>">
					<?php
						echo $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					?>
					</span>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php
					$bg = '';

				}else if ($reponse['id_col'] == '40' && $id_mod_lic == '1') {

					if ($id_mod_trans == '4') {
						# code...
					}else{



							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "badge badge-success";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 7) ) {
								$bg = "badge badge-warning";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 7) ) {
								$bg = "badge badge-danger";
							}
						?>
						<td style="border: 1px solid black; text-align: center;">
							<span class=" <?php echo $bg;?>">
							<?php
								echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos));
							?>
							</span>
						</td>
						<?php

							$bg = '';




					}

				}
				else if ($reponse['id_col'] == '228') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						$clignoteCleared = true;
						?>
							<option>NO</option>
							<option value="1">YES</option>
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
							<option>YES</option>
							<option value="0">NO</option>
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '38') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						$clignoteCleared = true;
						?>
							<option>TRANSIT</option>
							<option value="1">CLEARED</option>
							<option value="2">CANCELLED</option>
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
							<option>CLEARED</option>
							<option value="0">TRANSIT</option>
							<option value="2">CANCELLED</option>
						<?php
					}else if ( ($getDataRow == '2') ) {
						?>
							<option>CANCELLED</option>
							<option value="0">TRANSIT</option>
							<option value="1">CLEARED</option>
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '49') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
						<option><?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?></option>
						<option></option>
						<option value="LUBUMBASHI">LUBUMBASHI</option>
						<option value="KOLWEZI">KOLWEZI</option>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '17') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '18') {
					//Date Expiration Licence
					if ( ($this-> getDifferenceDate($this-> getDateExpirationLicence2($this-> getDossier($id_dos)['num_lic']), date('Y-m-d')) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteLic = ' clignoteb';
						$couleurLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteLic = '';
						$couleurLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurLic;?>">
					<?php echo $this-> getDateExpirationLicence($this-> getDossier($id_dos)['num_lic'])?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '50') {
					// Poids Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'];?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '54') {
					// Balance Tons Licence
					if ( ((($this-> getBalanceLicenceDossier($id_dos)*100)/($this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'])) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteBalanceLic = ' clignoteb';
						$couleurBalanceLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteBalanceLic = '';
						$couleurBalanceLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteBalanceLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurBalanceLic;?>">
					<?php echo number_format( $this-> getBalanceLicenceDossier($id_dos), 2, ',', ' ');?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '71') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('ceec_out', $id_dos), $this-> getDataRow('ceec_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '74') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('min_div_out', $id_dos), $this-> getDataRow('min_div_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '36') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('dgda_out', $id_dos), $this-> getDataRow('dgda_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '88') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '80') {
					// DA To Exit
					if ($this-> getDossier($id_dos)['id_mod_trans'] == '4') {
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('docs_sncc', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}else{
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}

				}
				else if ($reponse['calcul'] == '1') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php
						if (isset($this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']])) {
							echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];
						}
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php

				}else if ($reponse['id_col'] == '44') {
					if (!isset($this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'])) {

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['enable'];?> style="width: 25em;" name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow('supplier', $id_dos);?>">
						</td>
						<?php

					}else{

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input type="text" style="width: 25em;" name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'];?>">
						</td>
						<?php

					}
				}else if ($reponse['id_col'] == '42') {
					// Status
					$bgStatuts = '';
					if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
						$bgStatuts = 'bg bg-primary';
					}
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '222') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}
				else if ($reponse['id_col'] == '210') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerTruckLocationModeleLicenceModeTransportClient($id_mod_lic, $id_mod_trans, $id_cli);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}
				//Doublon facture
				else if ($reponse['champ_col'] == 'ref_fact' && ($this-> verifierDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: white; background-color: purple;';


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				//Doublon MAnifest
				else if ($reponse['champ_col'] == 'road_manif' && ($this-> verifierDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: white; background-color: red;';


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				else if ($reponse['champ_col'] == 'remarque') {

					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>  width: 35em;" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				else if ($reponse['champ_col'] == 'date_creat_dos') {

					?>
					<td style="border: 1px solid black; text-align: center;" disabled>
						<?php
							echo $this-> getDataRow('date_creat_dos', $id_dos);
						?>
					</td>
					<?php

				}
				else{
					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> <?php echo $reponse['enable'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherRowTableauEncodeur2($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur, $id_util){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_util'] = $id_util;
			$bg = '';
			$enable = '';
			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col,
													IF(afcu.edit_tracking='0', 'disabled', '') AS enable
											FROM colonne c, affectation_colonne_utilisateur afcu, utilisateur util
											WHERE c.id_col = afcu.id_col
												AND afcu.id_util = util.id_util
											    AND util.id_util = ?
											    AND afcu.id_mod_trans = ?
											    AND afcu.id_mod_lic = ?
											ORDER BY afcu.rang ASC");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
					$clignoteCleared = false;

				if ($reponse['id_col'] == '40' && $id_mod_lic == '2') {
					$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					if ( ($getDataRowCalculNetDays >= 0) && ($getDataRowCalculNetDays <= 3) ) {
						$bg = "badge badge-success";
					}else if ( ($getDataRowCalculNetDays > 3) && ($getDataRowCalculNetDays <= 5) ) {
						$bg = "badge badge-warning";
					}else if ( ($getDataRowCalculNetDays > 5) ) {
						$bg = "badge badge-danger";
					}
				?>
				<td style="border: 1px solid black; text-align: center;">
					<span class=" <?php echo $bg;?>">
					<?php
						echo $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					?>
					</span>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php
					$bg = '';

				}else if ($reponse['id_col'] == '40' && $id_mod_lic == '1') {

					if ($id_mod_trans == '4') {
						# code...
					}else{



							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "badge badge-success";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 7) ) {
								$bg = "badge badge-warning";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 7) ) {
								$bg = "badge badge-danger";
							}
						?>
						<td style="border: 1px solid black; text-align: center;">
							<span class=" <?php echo $bg;?>">
							<?php
								echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos));
							?>
							</span>
						</td>
						<?php

							$bg = '';




					}

				}
				else if ($reponse['id_col'] == '228') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						$clignoteCleared = true;
						?>
							<option>NO</option>
							<option value="1">YES</option>
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
							<option>YES</option>
							<option value="0">NO</option>
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '38') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						$clignoteCleared = true;
						?>
							<option>TRANSIT</option>
							<option value="1">CLEARED</option>
							<option value="2">CANCELLED</option>
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
							<option>CLEARED</option>
							<option value="0">TRANSIT</option>
							<option value="2">CANCELLED</option>
						<?php
					}else if ( ($getDataRow == '2') ) {
						?>
							<option>CANCELLED</option>
							<option value="0">TRANSIT</option>
							<option value="1">CLEARED</option>
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '49') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
						<option><?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?></option>
						<option></option>
						<option value="LUBUMBASHI">LUBUMBASHI</option>
						<option value="KOLWEZI">KOLWEZI</option>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '17') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '18') {
					//Date Expiration Licence
					if ( ($this-> getDifferenceDate($this-> getDateExpirationLicence2($this-> getDossier($id_dos)['num_lic']), date('Y-m-d')) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteLic = ' clignoteb';
						$couleurLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteLic = '';
						$couleurLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurLic;?>">
					<?php echo $this-> getDateExpirationLicence($this-> getDossier($id_dos)['num_lic'])?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '50') {
					// Poids Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'];?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '54') {
					// Balance Tons Licence
					if ( ((($this-> getBalanceLicenceDossier($id_dos)*100)/($this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'])) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteBalanceLic = ' clignoteb';
						$couleurBalanceLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteBalanceLic = '';
						$couleurBalanceLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteBalanceLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurBalanceLic;?>">
					<?php echo number_format( $this-> getBalanceLicenceDossier($id_dos), 2, ',', ' ');?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '71') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('ceec_out', $id_dos), $this-> getDataRow('ceec_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '74') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('min_div_out', $id_dos), $this-> getDataRow('min_div_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '36') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('dgda_out', $id_dos), $this-> getDataRow('dgda_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '88') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '80') {
					// DA To Exit
					if ($this-> getDossier($id_dos)['id_mod_trans'] == '4') {
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('docs_sncc', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}else{
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}

				}
				else if ($reponse['calcul'] == '1') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php
						if (isset($this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']])) {
							echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];
						}
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php

				}else if ($reponse['id_col'] == '44') {
					if (!isset($this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'])) {

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['enable'];?> style="width: 25em;" name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow('supplier', $id_dos);?>">
						</td>
						<?php

					}else{

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input type="text" style="width: 25em;" name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'];?>">
						</td>
						<?php

					}
				}else if ($reponse['id_col'] == '42') {
					// Status
					$bgStatuts = '';
					if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
						$bgStatuts = 'bg bg-primary';
					}
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '222') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}
				else if ($reponse['id_col'] == '210') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>">
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerTruckLocationModeleLicenceModeTransportClient($id_mod_lic, $id_mod_trans, $id_cli);
						?>
					</select>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}
				//Doublon facture
				else if ($reponse['champ_col'] == 'ref_fact' && ($this-> verifierDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: white; background-color: purple;';


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				//Doublon MAnifest
				else if ($reponse['champ_col'] == 'road_manif' && ($this-> verifierDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: white; background-color: red;';


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				else if ($reponse['champ_col'] == 'remarque') {

					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>  width: 35em;" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				else if ($reponse['champ_col'] == 'date_creat_dos') {

					?>
					<td style="border: 1px solid black; text-align: center;" disabled>
						<?php
							echo $this-> getDataRow('date_creat_dos', $id_dos);
						?>
					</td>
					<?php

				}
				else{
					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> <?php echo $reponse['enable'];?> style="width: 7em; text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherRowTableauEncodeurPopUp($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur, $id_util){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_util'] = $id_util;
			$bg = '';
			$enable = '';
			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col,
													afcu.edit_tracking AS edit_tracking
											FROM colonne c, affectation_colonne_utilisateur afcu, utilisateur util
											WHERE c.id_col = afcu.id_col
												AND afcu.id_util = util.id_util
											    AND util.id_util = ?
											    AND afcu.id_mod_trans = ?
											    AND afcu.id_mod_lic = ?
											    AND afcu.view_pop_up = '1'
											ORDER BY afcu.rang ASC");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
					$clignoteCleared = false;

				if ($reponse['edit_tracking'] == '1') {

					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonManifest($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
					</td>
					<?php

				}
				else{
					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherRowTableau2($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

            if ($_GET['id_mod_lic'] == '1') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 883';
				}

            }else if ($_GET['id_mod_lic'] == '2') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 883';
				}

            }

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    $sqlClient
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] == '40' && $id_mod_lic == '2') {
					$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					if ( ($getDataRowCalculNetDays >= 0) && ($getDataRowCalculNetDays <= 3) ) {
						$bg = "badge badge-success";
					}else if ( ($getDataRowCalculNetDays > 3) && ($getDataRowCalculNetDays <= 5) ) {
						$bg = "badge badge-warning";
					}else if ( ($getDataRowCalculNetDays > 5) ) {
						$bg = "badge badge-danger";
					}
				?>
				<td style="border: 1px solid black; text-align: center;">
					<span class=" <?php echo $bg;?>">
					<?php
						echo $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					?>
					</span>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php
					$bg = '';

				}else if ($reponse['id_col'] == '40' && $id_mod_lic == '1') {

					if ($id_mod_trans == '4') {
						# code...
					}else{



							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "badge badge-success";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 7) ) {
								$bg = "badge badge-warning";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 7) ) {
								$bg = "badge badge-danger";
							}
						?>
						<td style="border: 1px solid black; text-align: center;">
							<span class=" <?php echo $bg;?>">
							<?php
								echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos));
							?>
							</span>
						</td>
						<?php

							$bg = '';




					}

				}
				else if ($reponse['id_col'] == '38') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						?>
						TRANSIT
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
						CLEARED
						<?php
					}else if ( ($getDataRow == '2') ) {
						?>
						CANCELLED
						<?php
					}
					?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '49') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '17') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '18') {
					//Date Expiration Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDateExpirationLicence($this-> getDossier($id_dos)['num_lic']);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '50') {
					// Poids Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'];?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '54') {
					// Balance Tons Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo number_format( $this-> getBalanceLicenceDossier($id_dos), 2, ',', ' ');?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '71') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('ceec_out', $id_dos), $this-> getDataRow('ceec_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '74') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('min_div_out', $id_dos), $this-> getDataRow('min_div_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '36') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('dgda_out', $id_dos), $this-> getDataRow('dgda_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '88') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '80') {
					// DA To Exit
					if ($this-> getDossier($id_dos)['id_mod_trans'] == '4') {
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('docs_sncc', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}else{
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}

				}
				else if ($reponse['calcul'] == '1') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php
						if (isset($this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']])) {
							echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];
						}
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php

				}else if ($reponse['id_col'] == '44') {
					if (!isset($this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'])) {

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<?php echo $this-> getDataRow('supplier', $id_dos);?>
						</td>
						<?php

					}else{

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<?php echo $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'];?>
						</td>
						<?php

					}
				}else if ($reponse['id_col'] == '42') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}
				//Doublon facture
				else if ($reponse['id_col'] == '11' && ($this-> verifierDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: black; background-color: #FF4500;';


					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
					</td>
					<?php

				}
				else if ($reponse['champ_col'] == 'date_creat_dos') {

					?>
					<td style="border: 1px solid black; text-align: center;" disabled>
						<?php
							echo $this-> getDataRow('date_creat_dos', $id_dos);
						?>
					</td>
					<?php

				}
				else{
					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherRowUpdate($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] != '17' && $reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80') {
					?>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['titre_col'];?></label>
			            <input type="<?php echo $reponse['type_col'];?>" name="<?php echo $reponse['champ_col'];?>" class="form-control cc-exp">
			          </div>
			        <?php
				}


			}$requete-> closeCursor();
		}

		public function afficherRowUpdateCreationDossier($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											    AND af.creation_dossier = '1'
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['champ_col'] == 'num_lic') {
					if ($this-> verifierSouscriptionLicence($entree['id_cli'], $entree['id_mod_lic'])==true) {
		              ?>
					  <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">LICENCE </label>
		                <!-- <input type="text" id="txtCountry" name="num_lic" autocomplete="off" class="form-control cc-exp" required> -->
		                <select name="num_lic" id="num_lic" class="form-control cc-exp" onchange="getBalanceLicence(this.value);getDataLicence(this.value);" required>
		                  <option></option>
		                  <option value="UNDER VALUE">UNDER VALUE</option>
		                    <?php
		                      $this->selectionnerLicenceEnCoursModeleClient($entree['id_mod_lic'], $entree['id_cli']);
		                    ?>
		                </select>
		              </div>

		              <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">BALANCE FOB LICENCE</label>
		                <span id="balance_fob_licence"></span>
		              </div>
		     
		              <!-- <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">FOURNISSEUR</label>
		                
		                <input type="text" name="supplier" class="form-control cc-exp">
		              </div> -->
		     
		              <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">FOB FACTURE</label>
		                <span id="fob"></span>
		                <!-- <input type="number" min="0" step="0.001" name="fob" class="form-control cc-exp"> -->
		              </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">FRET</label>
			            <!--<span id="fret"></span>-->
			            <input type="number" min="0" step="0.001" name="fret" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">ASSURANCE</label>
			            <!--<span id="assurance"></span>-->
			            <input type="number" min="0" step="0.001" name="assurance" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">AUTRE FRAIS</label>
			            <!--<span id="autre_frais"></span>-->
			            <input type="number" min="0" step="0.001" name="autre_frais" class="form-control cc-exp" required>
			          </div>

		     		<?php
		     		}else{
		     		?>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Licence</label>
			            <input type="text" name="num_lic" class="form-control cc-exp" required>
			          </div>
					  
					  <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">FOB</label>
			            <input type="number" step="0.001" name="fob" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">FRET</label>
			            <!--<span id="fret"></span>-->
			            <input type="number" min="0" step="0.001" name="fret" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">ASSURANCE</label>
			            <!--<span id="assurance"></span>-->
			            <input type="number" min="0" step="0.001" name="assurance" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">AUTRE FRAIS</label>
			            <!--<span id="autre_frais"></span>-->
			            <input type="number" min="0" step="0.001" name="autre_frais" class="form-control cc-exp" required>
			          </div>

			          <?php
		     		}

				}else if ($reponse['champ_col'] == 'poids' && $id_mod_lic=='2') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Quantité</label>
			            <input type="number" name="nbr_bags" class="form-control cc-exp" required>
			          </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Emballage</label>
						<select name="id_emb" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerEmballage($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
			          </div>
					<?php
				}else if ($reponse['champ_col'] == 'id_emb' && $id_mod_lic=='1') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Emballage</label>
						<select name="id_emb" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerEmballage($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
			          </div>
					<?php
				}else if ($reponse['id_col'] == '227') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Trailer 1</label>
			            <input type="text" name="trailer_1" class="form-control cc-exp" required>
			          </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Trailer 2</label>
			            <input type="text" name="trailer_2" class="form-control cc-exp" required>
			          </div>
					<?php
				}else if ($reponse['id_col'] == '223') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Reagents</label>
						<select name="commodity" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerMarchandiseClientModeleLicence3($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
					<?php
				}else if ($reponse['champ_col'] == 'provenance') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Dernière Provenance</label>
						<select name="last_provenance" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Truck Provenance</label>
						<select name="provenance" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Origine</label>
						<select name="origine" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
					<?php
				}else{
					?>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['titre_col'];?></label>
			            <input type="<?php echo $reponse['type_col'];?>" name="<?php echo $reponse['champ_col'];?>" class="form-control cc-exp">
			          </div>
			        <?php
				}


			}$requete-> closeCursor();

			?>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Frontière IN</label>
	            <input type="text" name="front_in" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Frontière OUT</label>
	            <input type="text" name="front_out" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Bureau de Douane</label>
				<select name="bur_douane" class="form-control cc-exp" required>
					<option></option>
					<?php
						$this-> selectionnerBureauDouane2();
					?>
				</select>
				<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
			  </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Régime</label>
				<select name="reg_dgda" class="form-control cc-exp" required>
					<option></option>
					<?php
						$this-> selectionnerRegimeDouanier($_GET['id_mod_trac']);
					?>
				</select>
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Lieu de Chargement</label>
	            <input type="text" name="site_load" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Lieu de Dechargement</label>
	            <input type="text" name="site_offload" class="form-control cc-exp">
	          </div>
	          <?php
	          	if ($_GET['id_mod_trac']=='2') {
	          	?>
	          	<div class="col-md-2">
		            <label for="x_card_code" class="control-label mb-1">Première Expedition</label>
					<select name="first_exp" class="form-control cc-exp" required>
						<option></option>
						<option value="0">NON</option>
						<option value="1">OUI</option>
					</select>
				  </div>
	          	<?php
	          	}
	          ?>
	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Note / Remarque</label>
	            <textarea name="remarque" class="form-control cc-exp"></textarea>
	          </div>

			<?php
		}

		public function afficherRowUpdateCreationDossier_dec_erp($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											    AND af.creation_dossier = '1'
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['champ_col'] == 'num_lic') {
					if ($this-> verifierSouscriptionLicence($entree['id_cli'], $entree['id_mod_lic'])==true) {
		              ?>
					  <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">LICENCE </label>
		                <!-- <input type="text" id="txtCountry" name="num_lic" autocomplete="off" class="form-control cc-exp" required> -->
		                <select name="num_lic" id="num_lic" class="form-control cc-exp" onchange="getBalanceLicence(this.value);getDataLicence(this.value);" required>
		                  <option></option>
		                  <option value="UNDER VALUE">UNDER VALUE</option>
		                    <?php
		                      $this->selectionnerLicenceEnCoursModeleClient($entree['id_mod_lic'], $entree['id_cli']);
		                    ?>
		                </select>
		              </div>

		              <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">BALANCE FOB LICENCE</label>
		                <span id="balance_fob_licence"></span>
		              </div>
		     
		              <!-- <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">FOURNISSEUR</label>
		                
		                <input type="text" name="supplier" class="form-control cc-exp">
		              </div> -->
		     
		              <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">FOB FACTURE</label>
		                <span id="fob"></span>
		                <!-- <input type="number" min="0" step="0.001" name="fob" class="form-control cc-exp"> -->
		              </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">FRET</label>
			            <!--<span id="fret"></span>-->
			            <input type="number" min="0" step="0.001" name="fret" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">ASSURANCE</label>
			            <!--<span id="assurance"></span>-->
			            <input type="number" min="0" step="0.001" name="assurance" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">AUTRE FRAIS</label>
			            <!--<span id="autre_frais"></span>-->
			            <input type="number" min="0" step="0.001" name="autre_frais" class="form-control cc-exp" required>
			          </div>

		     		<?php
		     		}else{
		     		?>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Licence</label>
			            <input type="text" name="num_lic" class="form-control cc-exp" required>
			          </div>
					  
					  <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">FOB</label>
			            <input type="number" step="0.001" name="fob" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">FRET</label>
			            <!--<span id="fret"></span>-->
			            <input type="number" min="0" step="0.001" name="fret" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">ASSURANCE</label>
			            <!--<span id="assurance"></span>-->
			            <input type="number" min="0" step="0.001" name="assurance" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">AUTRE FRAIS</label>
			            <!--<span id="autre_frais"></span>-->
			            <input type="number" min="0" step="0.001" name="autre_frais" class="form-control cc-exp" required>
			          </div>

			          <?php
		     		}

				}else if ($reponse['champ_col'] == 'poids' && $id_mod_lic=='2') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Quantité</label>
			            <input type="number" name="nbr_bags" class="form-control cc-exp" required>
			          </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Emballage</label>
						<select name="id_emb" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerEmballage($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
			          </div>
					<?php
				}else if ($reponse['champ_col'] == 'id_emb' && $id_mod_lic=='1') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Emballage</label>
						<select name="id_emb" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerEmballage($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
			          </div>
					<?php
				}else if ($reponse['id_col'] == '227') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Trailer 1</label>
			            <input type="text" name="trailer_1" class="form-control cc-exp" required>
			          </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Trailer 2</label>
			            <input type="text" name="trailer_2" class="form-control cc-exp" required>
			          </div>
					<?php
				}else if ($reponse['id_col'] == '223') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Reagents</label>
						<select name="commodity" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerMarchandiseClientModeleLicence3($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
					<?php
				}else if ($reponse['champ_col'] == 'provenance') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Dernière Provenance</label>
						<select name="last_provenance" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Truck Provenance</label>
						<select name="provenance" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Origine</label>
						<select name="origine" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
					<?php
				}else{
					?>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['titre_col'];?></label>
			            <input type="<?php echo $reponse['type_col'];?>" name="<?php echo $reponse['champ_col'];?>" class="form-control cc-exp">
			          </div>
			        <?php
				}


			}$requete-> closeCursor();

			?>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Frontière IN</label>
	            <input type="text" name="front_in" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Frontière OUT</label>
	            <input type="text" name="front_out" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Bureau de Douane</label>
				<select name="bur_douane" class="form-control cc-exp" required>
					<option></option>
					<?php
						$this-> selectionnerBureauDouane2();
					?>
				</select>
				<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
			  </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Régime</label>
				<select name="reg_dgda" class="form-control cc-exp" required>
					<option></option>
					<?php
						$this-> selectionnerRegimeDouanier($_GET['id_mod_trac']);
					?>
				</select>
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Lieu de Chargement</label>
	            <input type="text" name="site_load" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Lieu de Dechargement</label>
	            <input type="text" name="site_offload" class="form-control cc-exp">
	          </div>
	          <?php
	          	if ($_GET['id_mod_trac']=='2') {
	          	?>
	          	<div class="col-md-2">
		            <label for="x_card_code" class="control-label mb-1">Première Expedition</label>
					<select name="first_exp" class="form-control cc-exp" required>
						<option></option>
						<option value="0">NON</option>
						<option value="1">OUI</option>
					</select>
				  </div>
	          	<?php
	          	}
	          ?>
	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Note / Remarque</label>
	            <textarea name="remarque" class="form-control cc-exp"></textarea>
	          </div>

			<?php
		}

		public function afficherRowUpdateCreationDossier2($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											    AND af.creation_dossier = '1'
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['champ_col'] == 'num_lic') {
					if ($this-> verifierSouscriptionLicence($entree['id_cli'], $entree['id_mod_lic'])==true) {
		              ?>
					  <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">LICENCE </label>
		                <!-- <input type="text" id="txtCountry" name="num_lic" autocomplete="off" class="form-control cc-exp" required> -->
		                <select name="num_lic" id="num_lic" class="form-control cc-exp" onchange="xajax_afficherFobMaxLicence(this.value);" required>
		                  <option></option>
		                  <option value="UNDER VALUE">UNDER VALUE</option>
		                    <?php
		                      $this->selectionnerLicenceEnCoursModeleClient($entree['id_mod_lic'], $entree['id_cli']);
		                    ?>
		                </select>
		              </div>

		              <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">BALANCE LICENCE</label>
		                <span id="balance_fob_sous_dos"></span>
		              </div>
		     
		              <!-- <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">FOURNISSEUR</label>
		                
		                <input type="text" name="supplier" class="form-control cc-exp">
		              </div> -->
		     
		              <div class="col-md-2">
		                <label for="x_card_code" class="control-label mb-1">FOB DECLAREE</label>
		                <span id="fob_sous_dos"></span>
		                <!-- <input type="number" min="0" step="0.001" name="fob" class="form-control cc-exp"> -->
		              </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">FRET</label>
			            <!--<span id="fret"></span>-->
			            <input type="number" min="0" step="0.001" name="fret" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">ASSURANCE</label>
			            <!--<span id="assurance"></span>-->
			            <input type="number" min="0" step="0.001" name="assurance" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">AUTRE FRAIS</label>
			            <!--<span id="autre_frais"></span>-->
			            <input type="number" min="0" step="0.001" name="autre_frais" class="form-control cc-exp" required>
			          </div>

		     		<?php
		     		}else{
		     		?>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Licence</label>
			            <input type="text" name="num_lic" class="form-control cc-exp" required>
			          </div>
					  
					  <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">FOB</label>
			            <input type="number" step="0.001" name="fob" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">FRET</label>
			            <!--<span id="fret"></span>-->
			            <input type="number" min="0" step="0.001" name="fret" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">ASSURANCE</label>
			            <!--<span id="assurance"></span>-->
			            <input type="number" min="0" step="0.001" name="assurance" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">AUTRE FRAIS</label>
			            <!--<span id="autre_frais"></span>-->
			            <input type="number" min="0" step="0.001" name="autre_frais" class="form-control cc-exp" required>
			          </div>

			          <?php
		     		}
		     		
				}else if ($reponse['champ_col'] == 'poids') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Quantité</label>
			            <input type="number" name="nbr_bags" class="form-control cc-exp" required>
			          </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Emballage</label>
						<select name="id_emb" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerEmballage($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
			          </div>
					<?php
				}else if ($reponse['id_col'] == '227') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Trailer 1</label>
			            <input type="text" name="trailer_1" class="form-control cc-exp" required>
			          </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Trailer 2</label>
			            <input type="text" name="trailer_2" class="form-control cc-exp" required>
			          </div>
					<?php
				}else if ($reponse['id_col'] == '223') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Reagents</label>
						<select name="commodity" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerMarchandiseClientModeleLicence3($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
					<?php
				}else if ($reponse['champ_col'] == 'provenance') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Dernière Provenance</label>
						<select name="last_provenance" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Truck Provenance</label>
						<select name="provenance" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1">Origine</label>
						<select name="origine" class="form-control cc-exp" required>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
					<?php
				}else{
					?>

			          <div class="col-md-2">
			            <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['titre_col'];?></label>
			            <span id="<?php echo $reponse['champ_col'];?>"></span>
			          </div>
			        <?php
				}


			}$requete-> closeCursor();
			?>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Frontière IN</label>
	            <input type="text" name="front_in" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Frontière OUT</label>
	            <input type="text" name="front_out" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Bureau de Douane</label>
				<select name="bur_douane" class="form-control cc-exp" required>
					<option></option>
					<?php
						$this-> selectionnerBureauDouane2();
					?>
				</select>
				<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
			  </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Régime</label>
				<select name="reg_dgda" class="form-control cc-exp" required>
					<option></option>
					<?php
						$this-> selectionnerRegimeDouanier($_GET['id_mod_trac']);
					?>
				</select>
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Lieu de Chargement</label>
	            <input type="text" name="site_load" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Lieu de Dechargement</label>
	            <input type="text" name="site_offload" class="form-control cc-exp">
	          </div>

	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Première Expedition</label>
				<select name="first_exp" class="form-control cc-exp" required>
					<option></option>
					<option value="0">NON</option>
					<option value="1">OUI</option>
				</select>
				<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
			  </div>
	          <div class="col-md-2">
	            <label for="x_card_code" class="control-label mb-1">Note / Remarque</label>
	            <textarea name="remarque" class="form-control cc-exp"></textarea>
	          </div>

			<?php
		}

		public function afficherRowDossierUpdate($id_mod_lic, $id_cli, $id_mod_trans, $id_dos){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col,
													c.attribut_col AS attribut_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['champ_col'] == 'num_lic') {
					?>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['titre_col'];?></label>
			            <input type="text" id="txtCountry" name="num_lic" value="<?php echo $this-> getDataRow('num_lic', $id_dos);?>" autocomplete="off" class="form-control cc-exp" required>
			            <!-- <select name="num_lic" id="num_lic" class="form-control cc-exp" onchange="xajax_afficherFobMaxLicence(this.value),xajax_selectionnerAVPourLicence(this.value),xajax_afficherMaskAV(av.value)" required>
			              <option></option>
			              <option value="UNDER VALUE">UNDER VALUE</option>-->
			                <?php
			                  //$this->selectionnerLicenceEnCoursModeleClient($_GET['id_mod_trac'], $_GET['id_cli']);
			                ?>
			            <!--</select> -->
			          </div>
			          <!-- 
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">BALANCE LICENCE</label>
			            <span id="balance_fob"></span>
			          </div>
			  -->
			          <!-- <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">FOURNISSEUR</label>
			            
			            <input type="text" name="supplier" class="form-control cc-exp">
			          </div> -->
			 
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">FOB DECLAREE</label>
			            <!-- <span id="fob"></span> -->
			            <input type="number" min="0" step="0.001" name="fob" class="form-control cc-exp" value="<?php echo $this-> getDataRow('fob', $id_dos);?>" required>
			          </div>
			 
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">FRET</label>
			            <!--<span id="fret"></span>-->
			            <input type="number" min="0" step="0.001" name="fret" value="<?php echo $this-> getDataRow('fret', $id_dos);?>" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">ASSURANCE</label>
			            <!--<span id="assurance"></span>-->
			            <input type="number" min="0" step="0.001" value="<?php echo $this-> getDataRow('assurance', $id_dos);?>" name="assurance" class="form-control cc-exp" required>
			          </div>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">AUTRE FRAIS</label>
			            <!--<span id="autre_frais"></span>-->
			            <input type="number" min="0" step="0.001" value="<?php echo $this-> getDataRow('autre_frais', $id_dos);?>" name="autre_frais" class="form-control cc-exp" required>
			          </div>

			        <?php
				}else if ($reponse['id_col'] == '208') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Quantité</label>
			            <input type="number" name="nbr_bags" value="<?php echo $this-> getDataRow('nbr_bags', $id_dos);?>" class="form-control cc-exp">
			          </div>
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Emballage</label>
						<select name="id_emb" class="form-control cc-exp" required>
							<option value="<?php echo $this-> getDataRow('id_emb', $id_dos);?>">
								 <?php echo $this-> getEmballage($this-> getDataRow('id_emb', $id_dos))['nom_emb'];?>
							</option>
							<option></option>
							<?php
								$this-> selectionnerEmballage($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
			          </div>
					<?php
				}else if ($reponse['id_col'] == '227') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Trailer 1</label>
			            <input type="text" name="trailer_1" value="<?php echo $this-> getDataRow('trailer_1', $id_dos);?>" class="form-control cc-exp">
			          </div>
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Trailer 2</label>
			            <input type="text" name="trailer_2" value="<?php echo $this-> getDataRow('trailer_2', $id_dos);?>" class="form-control cc-exp">
			          </div>
					<?php
				}else if ($reponse['id_col'] == '223') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Reagents</label>
						<select name="commodity" class="form-control cc-exp" required>
							<option  value="<?php echo $this-> getDataRow('commodity', $id_dos);?>"><?php echo $this-> getDataRow('commodity', $id_dos);?></option>
							<option></option>
							<?php
								$this-> selectionnerMarchandiseClientModeleLicence3($_GET['id_cli'], $_GET['id_mod_trac']);
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
					<?php
				}else if ($reponse['champ_col'] == 'provenance') {
					// Status
					$bgStatuts = '';
					// if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
					// 	$bgStatuts = 'bg bg-primary';
					// }
					?>
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Dernière Provenance</label>
						<select name="last_provenance" class="form-control cc-exp" required>
							<option  value="<?php echo $this-> getDataRow('last_provenance', $id_dos);?>"><?php echo $this-> getDataRow('last_provenance', $id_dos);?></option>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Truck Provenance</label>
						<select name="provenance" class="form-control cc-exp" required>
							<option  value="<?php echo $this-> getDataRow('provenance', $id_dos);?>"><?php echo $this-> getDataRow('provenance', $id_dos);?></option>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Origine</label>
						<select name="origine" class="form-control cc-exp" required>
							<option value="<?php echo $this-> getDataRow('num_lic', $id_dos);?>"><?php echo $this-> getDataRow('origine', $id_dos);?></option>
							<option></option>
							<?php
								$this-> selectionnerPays();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Frontière IN</label>
			            <input type="text" name="front_in" value="<?php echo $this-> getDataRow('front_in', $id_dos);?>" class="form-control cc-exp">
			          </div>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Frontière OUT</label>
			            <input type="text" name="front_out" value="<?php echo $this-> getDataRow('front_out', $id_dos);?>" class="form-control cc-exp">
			          </div>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Bureau de Douane</label>
						<select name="bur_douane" class="form-control cc-exp" required>
							<option value="<?php echo $this-> getDataRow('bur_douane', $id_dos);?>"><?php echo $this-> getDataRow('bur_douane', $id_dos);?></option>
							<?php
								$this-> selectionnerBureauDouane2();
							?>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Régime</label>
						<select name="reg_dgda" class="form-control cc-exp" required>
							<option value="<?php echo $this-> getDataRow('reg_dgda', $id_dos);?>"><?php echo $this-> getDataRow('reg_dgda', $id_dos);?></option>
							<option></option>
							<?php
								$this-> selectionnerRegimeDouanier($_GET['id_mod_trac']);
							?>
						</select>
			          </div>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Lieu de Chargement</label>
			            <input type="text" name="site_load" value="<?php echo $this-> getDataRow('site_load', $id_dos);?>" class="form-control cc-exp">
			          </div>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Lieu de Dechargement</label>
			            <input type="text" name="site_offload" value="<?php echo $this-> getDataRow('site_offload', $id_dos);?>" class="form-control cc-exp">
			          </div>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Première Expedition</label>
						<select name="first_exp" class="form-control cc-exp" required>
							<option value="<?php echo $this-> getDataRow('first_exp', $id_dos);?>"><?php echo $this-> getDataRow('first_exp', $id_dos);?></option>
							<option></option>
							<option value="0">NON</option>
							<option value="1">OUI</option>
						</select>
						<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					  </div>
			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1">Note / Remarque</label>
			            <textarea name="remarque" class="form-control cc-exp"><?php echo $this-> getDataRow('remarque', $id_dos);?></textarea>
			          </div>

					<?php
				}
				else if ($reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80' && $reponse['id_col'] != '38' && $reponse['id_col'] != '42' && $reponse['id_col'] != '40' && $reponse['id_col'] != '221' && $reponse['id_col'] != '211') 
				{
					?>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['titre_col'];?></label>
			            <input type="<?php echo $reponse['type_col'];?>" name="<?php echo $reponse['champ_col'];?>" class="form-control cc-exp" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>" <?php echo $reponse['attribut_col'];?>>
			          </div>
			        <?php
				}


			}$requete-> closeCursor();
		}

		public function getRowUpdate($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$a = '';
			$champ_col = array();

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] != '17' && $reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80') {
					//$a = $reponse['champ_col'];
					$champ_col1 = $reponse['champ_col'];
					$post = "$_POST[$champ_col1]";
					$champ_col[] = $post;


					/*$champ_col = $reponse['champ_col'];
					$post .= ",$_POST[$champ_col]";

					$champ_col[] = $reponse['champ_col'];*/

				}


			}$requete-> closeCursor();
			return $champ_col;
		}

		public function getRowUpdate2($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$a = '';
			$champ_col = array();

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80' && $reponse['id_col'] != '38' && $reponse['id_col'] != '40' && $reponse['id_col'] != '42') {
					//$a = $reponse['champ_col'];
					$champ_col1 = $reponse['champ_col'];
					//$index = '_'.$i
					$post = "$_POST[$champ_col1]";
					$champ_col[] = $post;


					/*$champ_col = $reponse['champ_col'];
					$post .= ",$_POST[$champ_col]";

					$champ_col[] = $reponse['champ_col'];*/

				}


			}$requete-> closeCursor();
			return $champ_col;
		}

		public function getNameRowUpdate($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$post = '';
			$name_champ_col = array();

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, c.id_col AS id_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80' && $reponse['id_col'] != '38' && $reponse['id_col'] != '40' && $reponse['id_col'] != '42') {

					$name_champ_col[] = $reponse['champ_col'];


				}


			}$requete-> closeCursor();
			return $name_champ_col;
		}

		public function getNameRowUpdateCreationDossier($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$post = '';
			$name_champ_col = array();

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, c.id_col AS id_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											    AND af.creation_dossier = '1'
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80' && $reponse['id_col'] != '38' && $reponse['id_col'] != '40' && $reponse['id_col'] != '42') {

					$name_champ_col[] = $reponse['champ_col'];


				}


			}$requete-> closeCursor();
			return $name_champ_col;
		}

		public function afficherRowTableauExcel($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			if (isset($_id_cli) && ($_id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$_id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col,
													c.type_col AS type_col,
													c.calcul AS calcul,
													c.id_col AS id_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] == '40' && $id_mod_lic == '2') {
					$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					if ( ($getDataRowCalculNetDays >= 0) && ($getDataRowCalculNetDays <= 3) ) {
						$bg = "background-color: green; color: white;";
					}else if ( ($getDataRowCalculNetDays > 3) && ($getDataRowCalculNetDays <= 5) ) {
						$bg = "background-color: orange; color: white;";
					}else if ( ($getDataRowCalculNetDays > 5) ) {
						$bg = "background-color: red; color: white;";
					}
				?>
				<td style="border: 0.5px solid black; text-align: center; <?php echo $bg;?>">
					<?php
						echo $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php
					$bg = '';
				}
				else if ($reponse['id_col'] == '40' && $id_mod_lic == '1') {

					if ($id_mod_trans == '4') {
						# code...
					}else{



							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "background-color: green; color: white;";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 7) ) {
								$bg = "background-color: orange; color: white;";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 7) ) {
							$bg = "background-color: red; color: white;";
							}
						?>
						<td style="border: 1px solid black; text-align: center; <?php echo $bg;?>">
							<span class="">
							<?php
								echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos));
							?>
							</span>
						</td>
						<?php

							$bg = '';




					}

				}
				else if ($reponse['id_col'] == '38') {

				?>
				<td style="border: 0.5px solid black; text-align: center;">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						?>
						TRANSIT
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
						CLEARED
						<?php
					}else if ( ($getDataRow == '2') ) {
						?>
						CANCELLED
						<?php
					}
					?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '17') {

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '18') {
					//Date Expiration Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDateExpirationLicence($this-> getDossier($id_dos)['num_lic']);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '50') {
					// Poids Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'];?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '54') {
					// Balance Tons Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getBalanceLicenceDossier($id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '71') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('ceec_out', $id_dos), $this-> getDataRow('ceec_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '74') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('min_div_out', $id_dos), $this-> getDataRow('min_div_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '36') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('dgda_out', $id_dos), $this-> getDataRow('dgda_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '88') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '80') {
					// DA To Exit
					if ($this-> getDossier($id_dos)['id_mod_trans'] == '4') {
						?>
						<td class=" " style="border: 1px solid black; text-align: center; <?php echo $bg;?>">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('docs_sncc', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}else{
						?>
						<td class="" style="border: 1px solid black; text-align: center; <?php echo $bg;?>">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}

				}
				else if ($reponse['calcul'] == '1') {

				?>
				<td class="" style="border: 1px solid black; text-align: center; <?php echo $bg;?>">
					<?php
						if (isset($this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']])) {
							echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];
						}
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php

				}else if ($reponse['id_col'] == '44') {
					if (!isset($this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'])) {

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<?php echo $this-> getDataRow('supplier', $id_dos);?>
						</td>
						<?php

					}else{

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<?php echo $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'];?>
						</td>
						<?php

					}
				}else if ($reponse['id_col'] == '42') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '44'){

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php

				}else{

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherApurement($id_cli, $id_mod_lic, $num_lic, $premiere_entree, $nombre_dossier_par_page, $id_type_apur=1){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND tr.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			if ($id_mod_lic == '1') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(d.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(d.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
													WHERE d.id_mod_lic = ?
														$sqlLicence
														$sqlClient
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC
													LIMIT $premiere_entree, $nombre_dossier_par_page");
			}else if ($id_mod_lic == '2') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(md.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d, marchandise_dossier md
													WHERE d.id_mod_lic = ?
														AND d.id_dos = md.id_dos
														$sqlClient
														$sqlLicence
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC
													LIMIT $premiere_entree, $nombre_dossier_par_page");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditTransmissionApurement.php');

				if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['banque'];?>
				</td>
				<!-- <td style="text-align: center;">
					<?php echo $this-> getNombreLicenceTransmissionApurement($reponse['id_trans_ap']);?>
				</td> -->
				<td style="text-align: center;">
					<?php echo $reponse['nbre_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php //echo $this-> getNombreDossierTransmissionApurement($reponse['id_trans_ap']);?>
					<?php echo $reponse['nbre_dos'];?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDossiersApures3.php?id_trans_ap=<?php echo $reponse['id_trans_ap'];?>&id_cli=<?php echo $entree['id_cli'];?>&id_mod_lic=<?php echo $id_mod_lic; ?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">Détails</button>
					</a>
					<?php
						if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust" data-toggle="modal" data-target=".editTransmission_<?php echo $reponse['id_trans_ap'];?>">
		                    <i class="fa fa-upload"></i> Loger Accusée de réception
		                </button>
						<?php
						}else{
						?>
						<button class="btn bg bg-info square-btn-adjust" onclick="window.open('../transmision_apurements/<?php echo $reponse['id_trans_ap'];?>/<?php echo $reponse['fichier_trans_ap'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-file"></i> Accusée de réception
		                </button>
						<?php
						}

						if ($id_mod_lic==1) {
						?>
	                    <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportTransmissionApurement.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic=<?php echo $id_mod_lic; ?>&id_trans_ap=<?php echo $reponse['id_trans_ap']; ?>','pop1','width=80,height=80');">
	                      <i class="fas fa-file-excel"></i> Export
	                    </button>
						<!-- <button class="btn bg bg-primary square-btn-adjust" onclick="window.open('lettreTransmissionLicence.php?id_trans_ap=<?php echo $reponse['id_trans_ap']; ?>','pop1','width=1000,height=800');">
		                    <i class="fas fa-file"></i> Lettre Transmission
		                </button> -->
						<?php
						}else if ($id_mod_lic==2) {
						?>
	                    <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportTransmissionApurement.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic=<?php echo $id_mod_lic; ?>&id_trans_ap=<?php echo $reponse['id_trans_ap']; ?>','pop1','width=80,height=80');">
	                      <i class="fas fa-file-excel"></i> Export
	                    </button>
						<button class="btn bg bg-primary square-btn-adjust" onclick="window.open('lettreTransmissionLicence.php?id_trans_ap=<?php echo $reponse['id_trans_ap']; ?>','pop1','width=1000,height=800');">
		                    <i class="fas fa-file"></i> Lettre Transmission
		                </button>
						<?php
						}
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function transmis_non_envoyes($id_cli, $id_mod_lic, $num_lic, $id_type_apur=1){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND tr.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$rows = array();

			if ($id_mod_lic == '1') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(d.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(d.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
													WHERE d.id_mod_lic = ?
														$sqlLicence
														$sqlClient
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC");
			}else if ($id_mod_lic == '2') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(md.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap,
														CONCAT('<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"window.open(\'popUpDossiersApures3.php?id_trans_ap=',tr.id_trans_ap,'&id_cli=',cl.id_cli,'&id_mod_lic=',tr.id_mod_lic,'\',\'Details Transmis _\',\'width=1900,height=900\');\">
																	<button class=\"btn btn-xs bg bg-warning\"><i class=\'fa fa-list\'></i> Détails</button>
																</a>  
																<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"envoyer_transmis(\'',tr.id_trans_ap,'\');\">
																	<button class=\"btn btn-xs bg bg-primary\"><i class=\'fa fa-paper-plane\'></i> Envoyer</button>
																</a>',
																IF(d.id_mod_lic = 2,
																	CONCAT('<a title=\"Exporter le fichier de transmis en Excel\" href=\"#\" style=\"color: black;\" onclick=\"window.location.replace(\'exportTransmissionApurement.php?id_trans_ap=',tr.id_trans_ap,'&id_cli=',cl.id_cli,'&id_mod_lic=',tr.id_mod_lic,'\');\">
																			<button class=\"btn btn-xs bg bg-success\"><i class=\'fa fa-file-excel\'></i> Exporter</button>
																		</a>'),
																	''
																),
																'
																<button class=\"btn btn-xs bg bg-primary square-btn-adjust\" onclick=\"window.open(\'lettreTransmissionLicence.php?id_trans_ap=',tr.id_trans_ap,'\',\'pop1\',\'width=1000,height=800\');\">
												                    <i class=\"fas fa-file\"></i> Lettre Transmission
												                </button> 
																<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"modal_upload_ar(\'',tr.id_trans_ap,'\', \'',tr.ref_trans_ap,'\');\">
																	<button class=\"btn btn-xs bg bg-dark\"><i class=\'fa fa-upload\'></i> Loger A/R</button>
																</a>',
																'<form method=\'POST\' action=\'\'>
																	<input type=\'hidden\' name=\'id_trans_ap\' value=\'',tr.id_trans_ap,'\'>
																	<input type=\'hidden\' name=\'ref_trans_ap\' value=\'',tr.ref_trans_ap,'\'>
																	<button type=\'submit\' name=\'download_all_file_transmit_apurement\' class=\"btn btn-xs bg bg-purple\"><i class=\'fa fa-download\'></i></button>
																	<span class=\"btn btn-xs bg bg-secondary\" onclick=\"modal_liste_dossier_transmit_apurement(\'',tr.id_trans_ap,'\');\"><i class=\'fa fa-cogs\'></i></span>
																</form>'
															) AS btn_action
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d, marchandise_dossier md
													WHERE d.id_mod_lic = ?
														AND d.id_dos = md.id_dos
														$sqlClient
														$sqlLicence
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
														AND tr.date_envoi IS NULL
														AND tr.fichier_trans_ap IS NULL
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;
			}$requete-> closeCursor();

			return $rows;
		}

		public function transmis_rejet2($id_cli, $id_mod_lic, $num_lic, $id_type_apur=1){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND tr.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$rows = array();

			if ($id_mod_lic == '1') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(d.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(d.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
													WHERE d.id_mod_lic = ?
														$sqlLicence
														$sqlClient
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC");
			}else if ($id_mod_lic == '2') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(md.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														tr.motif AS motif,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														DATE_FORMAT(tr.date_envoi, '%d/%m/%Y') AS date_envoi,
														DATE_FORMAT(tr.date_rejet, '%d/%m/%Y') AS date_rejet,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap,
														CONCAT('<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"window.open(\'popUpDossiersApures3.php?id_trans_ap=',tr.id_trans_ap,'&id_cli=',cl.id_cli,'&id_mod_lic=',tr.id_mod_lic,'\',\'Details Transmis _\',\'width=1900,height=900\');\">
																	<button class=\"btn btn-xs bg bg-warning\"><i class=\'fa fa-list\'></i> Détails</button>
																</a>  
																<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"envoyer_transmis(\'',tr.id_trans_ap,'\');\">
																	<button class=\"btn btn-xs bg bg-primary\"><i class=\'fa fa-paper-plane\'></i> Envoyer</button>
																</a>',
																IF(d.id_mod_lic = 2,
																	CONCAT('<a title=\"Exporter le fichier de transmis en Excel\" href=\"#\" style=\"color: black;\" onclick=\"window.location.replace(\'exportTransmissionApurement.php?id_trans_ap=',tr.id_trans_ap,'&id_cli=',cl.id_cli,'&id_mod_lic=',tr.id_mod_lic,'\');\">
																			<button class=\"btn btn-xs bg bg-success\"><i class=\'fa fa-file-excel\'></i> Exporter</button>
																		</a>'),
																	''
																),
																'
																<button class=\"btn btn-xs bg bg-primary square-btn-adjust\" onclick=\"window.open(\'lettreTransmissionLicence.php?id_trans_ap=',tr.id_trans_ap,'\',\'pop1\',\'width=1000,height=800\');\">
												                    <i class=\"fas fa-file\"></i> Lettre Transmission
												                </button> 
																<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"modal_upload_ar(\'',tr.id_trans_ap,'\', \'',tr.ref_trans_ap,'\');\">
																	<button class=\"btn btn-xs bg bg-dark\"><i class=\'fa fa-upload\'></i> Loger A/R</button>
																</a>'
															) AS btn_action
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d, marchandise_dossier md
													WHERE d.id_mod_lic = ?
														AND d.id_dos = md.id_dos
														$sqlClient
														$sqlLicence
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
														AND tr.date_rejet IS NOT NULL
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;
			}$requete-> closeCursor();

			return $rows;
		}

		public function transmis_non_reception($id_cli, $id_mod_lic, $num_lic, $id_type_apur=1){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND tr.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$rows = array();

			if ($id_mod_lic == '1') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(d.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(d.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
													WHERE d.id_mod_lic = ?
														$sqlLicence
														$sqlClient
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC");
			}else if ($id_mod_lic == '2') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(md.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														DATE_FORMAT(tr.date_envoi, '%d/%m/%Y') AS date_envoi,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap,
														CONCAT('<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"window.open(\'popUpDossiersApures3.php?id_trans_ap=',tr.id_trans_ap,'&id_cli=',cl.id_cli,'&id_mod_lic=',tr.id_mod_lic,'\',\'Details Transmis _\',\'width=1900,height=900\');\">
																	<button class=\"btn btn-xs bg bg-warning\"><i class=\'fa fa-list\'></i> Détails</button>
																</a>',
																IF(d.id_mod_lic = 2,
																	CONCAT('<a title=\"Exporter le fichier de transmis en Excel\" href=\"#\" style=\"color: black;\" onclick=\"window.location.replace(\'exportTransmissionApurement.php?id_trans_ap=',tr.id_trans_ap,'&id_cli=',cl.id_cli,'&id_mod_lic=',tr.id_mod_lic,'\');\">
																			<button class=\"btn btn-xs bg bg-success\"><i class=\'fa fa-file-excel\'></i> Exporter</button>
																		</a>'),
																	''
																),
																-- '<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"download_all_file_transmit_apurement(\'',tr.id_trans_ap,'\');\">
																-- 	<button class=\"btn btn-xs bg bg-purple\"><i class=\'fa fa-download\'></i></button>
																-- </a>'
																'<form method=\'POST\' action=\'\'>
																	<input type=\'hidden\' name=\'id_trans_ap\' value=\'',tr.id_trans_ap,'\'>
																	<input type=\'hidden\' name=\'ref_trans_ap\' value=\'',tr.ref_trans_ap,'\'>
																	<button type=\'submit\' name=\'download_all_file_transmit_apurement\' class=\"btn btn-xs bg bg-purple\"><i class=\'fa fa-download\'></i></button>
																</form>'
															) AS btn_action
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d, marchandise_dossier md
													WHERE d.id_mod_lic = ?
														AND d.id_dos = md.id_dos
														$sqlClient
														$sqlLicence
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
														AND tr.date_envoi IS NOT NULL
														AND tr.date_recep IS NULL
														AND tr.date_rejet IS NULL
														AND tr.fichier_trans_ap IS NULL
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;
			}$requete-> closeCursor();

			return $rows;
		}

		public function transmis_receptionnes($id_cli, $id_mod_lic, $num_lic, $id_type_apur=1){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND tr.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$rows = array();

			if ($id_mod_lic == '1') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(d.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(d.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
													WHERE d.id_mod_lic = ?
														$sqlLicence
														$sqlClient
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC");
			}else if ($id_mod_lic == '2') {
			
				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(md.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														DATE_FORMAT(tr.date_envoi, '%d/%m/%Y') AS date_envoi,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap,
														IF(tr.date_envoi IS NOT NULL,
															DATE_FORMAT(tr.date_envoi, '%d/%m/%Y'),
															DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y')
														) AS date_envoi,
														IF(tr.date_recep IS NOT NULL,
															DATE_FORMAT(tr.date_recep, '%d/%m/%Y'),
															DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y')
														) AS date_recep,
														CONCAT('<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"window.open(\'popUpDossiersApures3.php?id_trans_ap=',tr.id_trans_ap,'&id_cli=',cl.id_cli,'&id_mod_lic=',tr.id_mod_lic,'\',\'Details Transmis _\',\'width=1900,height=900\');\">
																	<button class=\"btn btn-xs bg bg-warning\"><i class=\'fa fa-list\'></i> Détails</button>
																</a> ',
																IF(d.id_mod_lic = 2,
																	CONCAT('<a title=\"Exporter le fichier de transmis en Excel\" href=\"#\" style=\"color: black;\" onclick=\"window.location.replace(\'exportTransmissionApurement.php?id_trans_ap=',tr.id_trans_ap,'&id_cli=',cl.id_cli,'&id_mod_lic=',tr.id_mod_lic,'\');\">
																			<button class=\"btn btn-xs bg bg-success\"><i class=\'fa fa-file-excel\'></i> Exporter</button>
																		</a> '),
																	''
																),
																'
																<button class=\"btn btn-xs bg bg-primary square-btn-adjust\" onclick=\"window.open(\'lettreTransmissionLicence.php?id_trans_ap=',tr.id_trans_ap,'\',\'pop1\',\'width=1000,height=800\');\">
												                    <i class=\"fas fa-file\"></i> Lettre Transmission
												                </button> ',
												                
																IF(tr.fichier_trans_ap IS NOT NULL,
																	CONCAT('<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"window.open(\'../transmision_apurements/',tr.id_trans_ap,'/',tr.fichier_trans_ap,'\',\'Fichier Transmit\',\'width=1300,height=700\');\">
																			<button class=\"btn btn-xs bg bg-primary\"><i class=\'fa fa-file\'></i> A/R</button>
																		</a>'),
																	''
																),
																'<form method=\'POST\' action=\'\'>
																	<input type=\'hidden\' name=\'id_trans_ap\' value=\'',tr.id_trans_ap,'\'>
																	<input type=\'hidden\' name=\'ref_trans_ap\' value=\'',tr.ref_trans_ap,'\'>
																	<button type=\'submit\' name=\'download_all_file_transmit_apurement\' class=\"btn btn-xs bg bg-purple\"><i class=\'fa fa-download\'></i></button>
																</form>'
															) AS btn_action
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d, marchandise_dossier md
													WHERE d.id_mod_lic = ?
														AND d.id_dos = md.id_dos
														$sqlClient
														$sqlLicence
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
														AND (tr.date_recep IS NOT NULL OR tr.fichier_trans_ap IS NOT NULL
														OR tr.not_envoi = '1')
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;
			}$requete-> closeCursor();

			return $rows;
		}

		public function afficherApurementExport($id_cli, $id_mod_lic, $num_lic, $premiere_entree, $nombre_dossier_par_page, $id_type_apur=1){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND tr.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(d.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}else{
					$sqlLicence = '';
				}

				// echo '<script>alert("'.$$sqlLicence.'");</script>';

				$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(d.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
													WHERE d.id_mod_lic = ?
														$sqlLicence
														$sqlClient
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_type_apur = ?
														AND tr.id_cli = cl.id_cli
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC
													LIMIT $premiere_entree, $nombre_dossier_par_page");
			
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditTransmissionApurement.php');

				if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['banque'];?>
				</td>
				<!-- <td style="text-align: center;">
					<?php echo $this-> getNombreLicenceTransmissionApurement($reponse['id_trans_ap']);?>
				</td> -->
				<td style="text-align: center;">
					<?php echo $reponse['nbre_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php //echo $this-> getNombreDossierTransmissionApurement($reponse['id_trans_ap']);?>
					<?php echo $reponse['nbre_dos'];?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDossiersApures.php?id_trans_ap=<?php echo $reponse['id_trans_ap'];?>&id_cli=<?php echo $entree['id_cli'];?>&id_mod_lic=<?php echo $id_mod_lic; ?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">Détails</button>
					</a>
					<?php
						if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust" data-toggle="modal" data-target=".editTransmission_<?php echo $reponse['id_trans_ap'];?>">
		                    <i class="fa fa-upload"></i> Loger Accusée de réception
		                </button>
						<?php
						}else{
						?>
						<button class="btn bg bg-info square-btn-adjust" onclick="window.open('../transmision_apurements/<?php echo $reponse['id_trans_ap'];?>/<?php echo $reponse['fichier_trans_ap'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-file"></i> Accusée de réception
		                </button>
						<?php
						}

					?>
                    <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportTransmissionApurementExport.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic=<?php echo $id_mod_lic; ?>&id_trans_ap=<?php echo $reponse['id_trans_ap']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i> Export
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDemamndeDeFondEnAttente($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT d.id_dep AS id_dep,
													DATE_FORMAT(d.date_dep, '%d/%m/%Y') AS date_dep,
													d.ref_dep AS ref_dep,
													UPPER(cl.nom_cli) AS nom_cli,
													SUM(rd.montant) AS montant, 
													COUNT(DISTINCT(rd.id_dos)) AS dossier
												FROM depense_dossier d, client cl, rubrique_dossier rd
												WHERE d.id_cli = cl.id_cli
													AND d.id_dep = rd.id_dep
													AND d.etat = '0'
												GROUP BY d.id_dep
												ORDER BY d.id_dep");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				//include('modalEditTransmissionApurement.php');

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_dep'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dep'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['dossier'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['montant'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<button class="btn bg-warning square-btn-adjust" onclick="window.open('generateurBonDeDepense.php?id_dep=<?php echo $reponse['id_dep'];?>&ref_dep=<?php echo $reponse['ref_dep'];?>','pop1','width=1900,height=900');">
	                    <i class="fas fa-file"></i> Générer
	                </button>

					<button class="btn bg-success square-btn-adjust" data-toggle="modal" data-target=".id_dep_<?php echo $reponse['id_dep'];?>">
	                    <i class="fas fa-check"></i> Valider
	                </button>
				</td>
			</tr>

			    <form id="demo-form2" method="POST" action="" data-parsley-validate enctype="multipart/form-data">
			<div class="modal fade id_dep_<?php echo $reponse['id_dep'];?>" id="modal-default">
			  <div class="modal-dialog modal-md">
			      <input type="hidden" name="id_dep" value="<?php echo $reponse['id_dep'];?>">
			      <input type="hidden" name="ref_dep" value="<?php echo $reponse['ref_dep'];?>">
			    <div class="modal-content">
			      <div class="modal-header btn-success">
			        <h4 class="modal-title"><i class="fa fa-check"></i> Validation  </h4>
			        
			      </div>
			      <div class="modal-body">
			        <div class="row">
			          <span style="text-align: center;">
			            Voulez-vous valider la depense <?php echo $reponse['ref_dep'];?> ?
			          </span>
			        </div>
			      </div>
			      <div class="modal-footer justify-content-between">
			        <button type="button" class="btn btn-danger" data-dismiss="modal">Annuler</button>
			        <button type="submit" name="validerDepenseDossier" class="btn btn-primary">Valider</button>
			      </div>
			    </div>
			    <!-- /.modal-content -->
			  </div>
			  <!-- /.modal-dialog -->
			</div>
			    </form>

			<?php
			}$requete-> closeCursor();
		}

		public function afficherDemamndeDeFond($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT d.id_dep AS id_dep,
													DATE_FORMAT(d.date_dep, '%d/%m/%Y') AS date_dep,
													d.ref_dep AS ref_dep,
													UPPER(cl.nom_cli) AS nom_cli,
													SUM(rd.montant) AS montant, 
													COUNT(DISTINCT(rd.id_dos)) AS dossier
												FROM depense_dossier d, client cl, rubrique_dossier rd
												WHERE d.id_cli = cl.id_cli
													AND d.id_dep = rd.id_dep
													AND d.etat = '1'
												GROUP BY d.id_dep
												ORDER BY d.id_dep DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				//include('modalEditTransmissionApurement.php');

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_dep'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dep'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['dossier'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['montant'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<button class="btn bg-teal square-btn-adjust" onclick="window.open('generateurBonDeDepense.php?id_dep=<?php echo $reponse['id_dep'];?>&ref_dep=<?php echo $reponse['ref_dep'];?>','pop1','width=1900,height=900');">
	                    <i class="fas fa-file"></i> Générer
	                </button>
				</td>
			</tr>


			<?php
			}$requete-> closeCursor();
		}

		public function afficherTransmisFacture($id_cli, $id_mod_lic, $type_fact, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fact.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_fact) AS id_trans_fact, UPPER(cl.nom_cli) AS nom_cli,
													tr.id_trans_fact AS id_trans_fact,
													tr.ref_trans_fact AS ref_trans_fact,
													DATE_FORMAT(tr.date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													tr.fichier_trans_fact AS fichier_trans_fact,
													cl.id_cli AS id_cli
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													$sqlClient
													AND fact.id_mod_lic = ?
													AND fact.type_fact = ?
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
												ORDER BY tr.id_trans_fact DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalTransmisFacture.php');

				if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreDossierTransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDetailTransmisFacture.php?id_trans_fact=<?php echo $reponse['id_trans_fact'];?>&id_cli=<?php echo $entree['id_cli'];?>&id_mod_lic_fact=<?php echo $id_mod_lic; ?>&type_fact=<?php echo $_GET['type_fact']; ?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">Détails</button>
					</a>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Factures<!-- <sup><span class="badge badge-info"><?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?></span></sup> -->
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getFactureDossierTransmis($reponse['id_trans_fact']);
                          ?>
                        </div>
                      </button>
					<?php
						if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust" data-toggle="modal" data-target=".uploadTransmisFacture_<?php echo $reponse['id_trans_fact'];?>">
		                    <i class="fa fa-upload"></i> Loger Accusée de réception
		                </button>
						<?php
						}else{
						?>
						<button class="btn bg bg-info square-btn-adjust" onclick="window.open('../transmis_factures/<?php echo $reponse['id_trans_fact'];?>/<?php echo $reponse['fichier_trans_fact'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-file"></i> Accusée de réception
		                </button>
						<?php
						}
					?>
                    <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportTramisFacture.php?id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_lic=<?php echo $id_mod_lic; ?>&id_trans_fact=<?php echo $reponse['id_trans_fact']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i> Exporter en Excel
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherTransmisFacturePartiellePourFingerClient($id_cli, $finger, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['finger'] = $finger;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fact.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$compteur = $premiere_entree;
			$checkBouton = '';

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_fact) AS id_trans_fact, UPPER(cl.nom_cli) AS nom_cli,
													tr.id_trans_fact AS id_trans_fact,
													tr.ref_trans_fact AS ref_trans_fact,
													DATE_FORMAT(tr.date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													tr.fichier_trans_fact AS fichier_trans_fact,
													cl.id_cli AS id_cli,
													cl.nom_abr_cli AS nom_abr_cli,
													tr.finger AS finger
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													$sqlClient
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
													AND tr.fichier_trans_fact IS NOT NULL
													AND tr.finger = ?
												ORDER BY tr.id_trans_fact DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['finger']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalIntegrationFinger.php');

				if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

				if ($reponse['finger'] == '0') {
					$checkBouton = '<button class="btn btn-success square-btn-adjust" data-toggle="modal" data-target=".finger_'.$reponse['id_trans_fact'].'" title="Valider l\'intégration dans Finger">
		                    <i class="fa fa-check"></i>
		                </button>';
				}else{
					$checkBouton = '';
				}
			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_abr_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreDossierTransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
                    <button class="btn btn-primary square-btn-adjust" onclick="window.location.replace('exportFacturePartielleFinger.php?ref_trans_fact=<?php echo $reponse['ref_trans_fact']; ?>&id_trans_fact=<?php echo $reponse['id_trans_fact']; ?>','pop1','width=80,height=80');" title="Extraction Fichier Finger">
                      <i class="fas fa-upload"></i>
                    </button>
                    <?php
                    echo $checkBouton;
                    ?>
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDetailTransmisFacture.php?id_trans_fact=<?php echo $reponse['id_trans_fact'];?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning" title="Voir les Détails"><i class="fas fa-eye"></i></button>
					</a>
					<button type="button" title="Voir les Factures" class="btn btn-dark dropdown-toggle dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i> <!-- <sup><span class="badge badge-info"><?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?></span></sup> -->
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getFactureDossierTransmis($reponse['id_trans_fact']);
                          ?>
                        </div>
                      </button>
					<?php
						if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust" data-toggle="modal" data-target=".uploadTransmisFacture_<?php echo $reponse['id_trans_fact'];?>">
		                    <i class="fa fa-upload"></i> Loger Accusée de réception
		                </button>
						<?php
						}else{
						?>
						<button title="Voir l'Accusée de réception" class="btn bg bg-info square-btn-adjust" onclick="window.open('../transmis_factures/<?php echo $reponse['id_trans_fact'];?>/<?php echo $reponse['fichier_trans_fact'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-receipt"></i>
		                </button>
						<?php
						}
					?>
                    <button class="btn btn-success square-btn-adjust"title="Exporter en Excel" onclick="window.location.replace('exportTramisFacture.php?id_cli=<?php echo $reponse['id_cli']; ?>&id_trans_fact=<?php echo $reponse['id_trans_fact']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i>
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherFacturePartiellePourFingerClient($id_cli, $finger, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['finger'] = $finger;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$compteur = $premiere_entree;
			$checkBouton = '';

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													fd.id_t_trans AS id_t_trans,
													fd.finger AS finger
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.finger = ?
													$sqlClient
												ORDER BY fd.date_fact DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['finger']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				// include('modalFacturationDossier.php');
				// include('modalTransmisFactureDossier.php');
				// include('modalDeleteFactureDossier.php');

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php 
					if ($reponse['id_t_trans']=='12') {
						echo number_format($this-> getMontantFactureLicence($reponse['ref_fact']), 2, ',', ' ');
					}else{
						echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
					}
					?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
					<?php
					if ($reponse['id_t_trans'] == '12') {
					?>
                    <form method="POST" action="">
                    	<input type="hidden" name="ref_fact" value="<?php echo $reponse['ref_fact'];?>">
                    	<button class="btn btn-success square-btn-adjust" name="fingerLicence" title="Extraction Fichier Finger">
	                      <i class="fas fa-upload"></i>
	                    </button>
                    </form>
					<?php
					}else{
					?>
                    <form method="POST" action="">
                    	<input type="hidden" name="ref_fact" value="<?php echo $reponse['ref_fact'];?>">
                    	<button class="btn btn-success square-btn-adjust" name="finger" title="Extraction Fichier Finger">
	                      <i class="fas fa-upload"></i>
	                    </button>
                    </form>
					<?php
					}
					?>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['id_t_trans'] == '12') {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureLicence.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 883 && $reponse['id_mod_lic'] == 1) {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobaleExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898 || $reponse['id_cli'] == 886) {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 912) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885') ) {
				?>
					<!-- <button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureRCD.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button> -->

					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                
				<?php
					}
				?>
				</td>
				<?php
				if ($reponse['finger']=='1') {
				?>
				<td style="text-align: center;">
                    <form method="POST" action="">
                    	<input type="hidden" name="ref_fact" value="<?php echo $reponse['ref_fact'];?>">
                    	<button class="btn btn-danger square-btn-adjust" name="fingerOut" title="Annuler l'integration">
	                      <i class="fas fa-times"></i>
	                    </button>
                    </form>
				</td>
				<?php
				}
				?>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherFacturePartiellePourFingerClientRecherche($ref_fact, $id_cli, $finger){
			include("connexion.php");
			$entree['finger'] = $finger;
			$entree['ref_fact'] = $ref_fact;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$compteur = 0;
			$checkBouton = '';

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													fd.finger AS finger
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.finger = ?
													AND fd.ref_fact = ?
													$sqlClient
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['finger'], $entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

			?>
			<tr class="bg bg-teal">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
                    <form method="POST" action="">
                    	<input type="hidden" name="ref_fact" value="<?php echo $reponse['ref_fact'];?>">
                    	<button class="btn btn-success square-btn-adjust" name="finger" title="Extraction Fichier Finger">
	                      <i class="fas fa-upload"></i>
	                    </button>
                    </form>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['id_cli'] == 883 && $reponse['id_mod_lic'] == 1) {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898 || $reponse['id_cli'] == 886) {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 912) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885') ) {
				?>
					<!-- <button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureRCD.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button> -->

					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                
				<?php
					}
				?>
				</td>
				<?php
				if ($reponse['finger']=='1') {
				?>
				<td style="text-align: center;">
                    <form method="POST" action="">
                    	<input type="hidden" name="ref_fact" value="<?php echo $reponse['ref_fact'];?>">
                    	<button class="btn btn-danger square-btn-adjust" name="fingerOut" title="Annuler l'integration">
	                      <i class="fas fa-times"></i>
	                    </button>
                    </form>
				</td>
				<?php
				}
				?>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td>
					<hr>
				</td>
			</tr>
			<?php
		}

		public function afficherTransmisFacturePartiellePourFingerClientRecherche($mot_cle, $id_cli, $finger){
			include("connexion.php");
			$entree['finger'] = $finger;
			$entree['mot_cle'] = $mot_cle;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fact.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$compteur = 0;
			$checkBouton = '';

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_fact) AS id_trans_fact, UPPER(cl.nom_cli) AS nom_cli,
													tr.id_trans_fact AS id_trans_fact,
													tr.ref_trans_fact AS ref_trans_fact,
													DATE_FORMAT(tr.date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													tr.fichier_trans_fact AS fichier_trans_fact,
													cl.id_cli AS id_cli,
													cl.nom_abr_cli AS nom_abr_cli,
													tr.finger AS finger
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													$sqlClient
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
													AND tr.fichier_trans_fact IS NOT NULL
													AND tr.finger = ?
													AND (
														tr.ref_trans_fact = ? 
														OR fact.ref_fact = ?
														)
												ORDER BY tr.id_trans_fact DESC");
			$requete-> execute(array($entree['finger'], $entree['mot_cle'], $entree['mot_cle']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalIntegrationFinger.php');

				if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

				if ($reponse['finger'] == '0') {
					$checkBouton = '<button class="btn btn-success square-btn-adjust" data-toggle="modal" data-target=".finger_'.$reponse['id_trans_fact'].'" title="Valider l\'intégration dans Finger">
		                    <i class="fa fa-check"></i>
		                </button>';
				}else{
					$checkBouton = '';
				}
			?>
			<tr class="bg bg-teal">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_abr_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreDossierTransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
                    <button class="btn btn-primary square-btn-adjust" onclick="window.location.replace('exportFacturePartielleFinger.php?ref_trans_fact=<?php echo $reponse['ref_trans_fact']; ?>&id_trans_fact=<?php echo $reponse['id_trans_fact']; ?>','pop1','width=80,height=80');" title="Extraction Fichier Finger">
                      <i class="fas fa-upload"></i>
                    </button>
                    <?php
                    echo $checkBouton;
                    ?>
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDetailTransmisFacture.php?id_trans_fact=<?php echo $reponse['id_trans_fact'];?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning" title="Voir les Détails"><i class="fas fa-eye"></i></button>
					</a>
					<button type="button" title="Voir les Factures" class="btn btn-dark dropdown-toggle dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i> <!-- <sup><span class="badge badge-info"><?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?></span></sup> -->
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getFactureDossierTransmis($reponse['id_trans_fact']);
                          ?>
                        </div>
                      </button>
					<?php
						if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust" data-toggle="modal" data-target=".uploadTransmisFacture_<?php echo $reponse['id_trans_fact'];?>">
		                    <i class="fa fa-upload"></i> Loger Accusée de réception
		                </button>
						<?php
						}else{
						?>
						<button title="Voir l'Accusée de réception" class="btn bg bg-info square-btn-adjust" onclick="window.open('../transmis_factures/<?php echo $reponse['id_trans_fact'];?>/<?php echo $reponse['fichier_trans_fact'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-receipt"></i>
		                </button>
						<?php
						}
					?>
                    <button class="btn btn-success square-btn-adjust"title="Exporter en Excel" onclick="window.location.replace('exportTramisFacture.php?id_cli=<?php echo $reponse['id_cli']; ?>&id_trans_fact=<?php echo $reponse['id_trans_fact']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i>
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			echo "<tr><td colspan='3'><hr></td></tr>";

		}

		public function getNombreTransmisFacturePartiellePourFingerClient($id_cli, $finger){
			include("connexion.php");
			$entree['finger'] = $finger;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fact.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(tr.id_trans_fact)) AS nbre
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													$sqlClient
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
													AND tr.fichier_trans_fact IS NOT NULL
													AND tr.finger = ?
												ORDER BY tr.id_trans_fact DESC");
			$requete-> execute(array($entree['finger']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFacturePartiellePourFingerClient($id_cli, $finger){
			include("connexion.php");
			$entree['finger'] = $finger;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.finger = ?
													$sqlClient");
			$requete-> execute(array($entree['finger']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function afficherTransmisFactureGlobalePourFingerClient($id_cli){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;

			$bg = "";
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_fact) AS id_trans_fact, UPPER(cl.nom_cli) AS nom_cli,
													tr.id_trans_fact AS id_trans_fact,
													tr.ref_trans_fact AS ref_trans_fact,
													DATE_FORMAT(tr.date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													tr.fichier_trans_fact AS fichier_trans_fact,
													cl.id_cli AS id_cli
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													AND fact.id_cli = ?
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
												ORDER BY tr.id_trans_fact DESC");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalTransmisFacture.php');

				if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreDossierTransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDetailTransmisFacture.php?id_trans_fact=<?php echo $reponse['id_trans_fact'];?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning" title="Voir les Détails"><i class="fas fa-eye"></i></button>
					</a>
                    <button class="btn btn-primary square-btn-adjust" onclick="window.location.replace('exportFacturePartielleFinger.php?ref_trans_fact=<?php echo $reponse['ref_trans_fact']; ?>&id_trans_fact=<?php echo $reponse['id_trans_fact']; ?>','pop1','width=80,height=80');" title="Extraction Fichier Finger">
                      <i class="fas fa-upload"></i>
                    </button>
					<button type="button" title="Voir les Factures" class="btn btn-dark dropdown-toggle dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i> <!-- <sup><span class="badge badge-info"><?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?></span></sup> -->
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getFactureDossierTransmis($reponse['id_trans_fact']);
                          ?>
                        </div>
                      </button>
					<?php
						if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust" data-toggle="modal" data-target=".uploadTransmisFacture_<?php echo $reponse['id_trans_fact'];?>">
		                    <i class="fa fa-upload"></i> Loger Accusée de réception
		                </button>
						<?php
						}else{
						?>
						<button title="Voir l'Accusée de réception" class="btn bg bg-info square-btn-adjust" onclick="window.open('../transmis_factures/<?php echo $reponse['id_trans_fact'];?>/<?php echo $reponse['fichier_trans_fact'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-receipt"></i>
		                </button>
						<?php
						}
					?>
                    <button class="btn btn-success square-btn-adjust"title="Exporter en Excel" onclick="window.location.replace('exportTramisFacture.php?id_cli=<?php echo $reponse['id_cli']; ?>&id_trans_fact=<?php echo $reponse['id_trans_fact']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i>
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherTransmisFacturePopUp($id_cli, $id_mod_lic, $type_fact){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fact.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_fact) AS id_trans_fact, UPPER(cl.nom_cli) AS nom_cli,
													tr.id_trans_fact AS id_trans_fact,
													tr.ref_trans_fact AS ref_trans_fact,
													DATE_FORMAT(tr.date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													tr.fichier_trans_fact AS fichier_trans_fact,
													cl.id_cli AS id_cli
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													$sqlClient
													AND fact.id_mod_lic = ?
													AND fact.type_fact = ?
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
												ORDER BY tr.id_trans_fact DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalTransmisFacture.php');

				if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreDossierTransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDetailTransmisFacture.php?id_trans_fact=<?php echo $reponse['id_trans_fact'];?>&id_cli=<?php echo $entree['id_cli'];?>&id_mod_lic_fact=<?php echo $id_mod_lic; ?>&type_fact=<?php echo $_GET['type_fact']; ?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">Détails</button>
					</a>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherTransmisFacturePopUpSansFichier($id_cli, $id_mod_lic, $type_fact){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fact.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_fact) AS id_trans_fact, UPPER(cl.nom_cli) AS nom_cli,
													tr.id_trans_fact AS id_trans_fact,
													tr.ref_trans_fact AS ref_trans_fact,
													DATE_FORMAT(tr.date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													tr.fichier_trans_fact AS fichier_trans_fact,
													cl.id_cli AS id_cli
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													$sqlClient
													AND fact.id_mod_lic = ?
													AND fact.type_fact = ?
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
												ORDER BY tr.id_trans_fact DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalTransmisFacture.php');

				if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreDossierTransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDetailTransmisFacture.php?id_trans_fact=<?php echo $reponse['id_trans_fact'];?>&id_cli=<?php echo $entree['id_cli'];?>&id_mod_lic_fact=<?php echo $id_mod_lic; ?>&type_fact=<?php echo $_GET['type_fact']; ?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">Détails</button>
					</a>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherComplementDataDossier($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
												WHERE (
														fob = '' OR fob IS NULL OR fob = '0'
														OR ref_av IS NULL OR ref_av = ''
														OR montant_av IS NULL OR montant_av = ''
														OR road_manif IS NULL OR road_manif = ''
														OR ref_decl IS NULL OR ref_decl = ''
														OR montant_decl IS NULL OR montant_decl = ''
														OR ref_quit IS NULL OR ref_quit = ''
														OR ref_fact IS NULL OR ref_fact = ''
													)
													AND (cleared = '1' OR cleared = '0')
													AND id_mod_lic = ?
													$sqlClient
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				/*include('modalEditTransmissionApurement.php');

				if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="col_1" style="background-color: white; color: black; border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="col_6" style="background-color: white; color: black; border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td>
					<?php
					if (isset($reponse['fob']) && ($reponse['fob']!='') && ($reponse['fob']>0)) {
							$disabled = 'disabled';
						?>
						<input type="text" name="fob_<?php echo $compteur;?>" value="<?php echo $reponse['fob'];?>" <?php echo $disabled;?> >
						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
						<input type="number" step="0.001" name="fob_<?php echo $compteur;?>" value="<?php echo $reponse['fob'];?>" <?php echo $disabled;?> >
						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['ref_fact']) && ($reponse['ref_fact']!='')) {
						$disabled = 'disabled';
						?>
					<input type="text" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $reponse['ref_fact'];?>" <?php echo $disabled;?> >

						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
					<input type="text" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $reponse['ref_fact'];?>" <?php echo $disabled;?> >

						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['ref_av']) && ($reponse['ref_av']!='')) {
						$disabled = 'disabled';
						?>
					<input type="text" name="ref_av_<?php echo $compteur;?>" value="<?php echo $reponse['ref_av'];?>" <?php echo $disabled;?> >

						<?php

					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
					<input type="text" name="ref_av_<?php echo $compteur;?>" value="<?php echo $reponse['ref_av'];?>" <?php echo $disabled;?> >

						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['montant_av']) && ($reponse['montant_av']!='')) {
						$disabled = 'disabled';
						?>
					<input type="text" step="0.001" name="montant_av_<?php echo $compteur;?>" value="<?php echo $reponse['montant_av'];?>" <?php echo $disabled;?> >

						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
					<input type="number" name="montant_av_<?php echo $compteur;?>" value="<?php echo $reponse['montant_av'];?>" <?php echo $disabled;?> >

						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['road_manif']) && ($reponse['road_manif']!='')) {
						$disabled = 'disabled';
						?>
					<input type="text" name="road_manif_<?php echo $compteur;?>" value="<?php echo $reponse['road_manif'];?>" <?php echo $disabled;?> >

						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
					<input type="text" name="road_manif_<?php echo $compteur;?>" value="<?php echo $reponse['road_manif'];?>" <?php echo $disabled;?> >

						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['ref_decl']) && ($reponse['ref_decl']!='')) {
						$disabled = 'disabled';
						?>
						<input type="text" name="ref_decl_<?php echo $compteur;?>" value="<?php echo $reponse['ref_decl'];?>" <?php echo $disabled;?> >
						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
							<input type="text" name="ref_decl_<?php echo $compteur;?>" value="<?php echo $reponse['ref_decl'];?>" <?php echo $disabled;?> >
						<?php
					}
					?>

				</td>
				<td>
					<?php
					if (isset($reponse['montant_decl']) && ($reponse['montant_decl']!='')) {
						$disabled = 'disabled';
						?>
						<input type="text" step="0.001" name="montant_decl_<?php echo $compteur;?>" value="<?php echo $reponse['montant_decl'];?>" <?php echo $disabled;?> >
						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
						<input type="number" name="montant_decl_<?php echo $compteur;?>" value="<?php echo $reponse['montant_decl'];?>" <?php echo $disabled;?> >
						<?php
					}
					?>

				</td>
				<td>
					<?php
					if (isset($reponse['ref_quit']) && ($reponse['ref_quit']!='')) {
						$disabled = 'disabled';
						?>
						<input type="text" name="ref_quit_<?php echo $compteur;?>" value="<?php echo $reponse['ref_quit'];?>" <?php echo $disabled;?> >
						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
						<input type="text" name="ref_quit_<?php echo $compteur;?>" value="<?php echo $reponse['ref_quit'];?>" <?php echo $disabled;?> >
						<?php
					}
					?>

				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			$fin = $compteur;
			?>
			<input type="hidden" name="debut" value="<?php echo $debut;?>">
			<input type="hidden" name="fin" value="<?php echo $fin;?>">
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherDossierAttenteFacture($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
 												FROM dossier
												WHERE facture = '0'
													AND cleared = '1'
													AND id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: center;">
					<button class="btn bg-info square-btn-adjust" data-toggle="modal" data-target=".facture_<?php echo $reponse['id_dos'];?>">
	                    <i class="fa fa-calculator"></i> Facturer
	                </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFactureDossier($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-check"></i> <?php echo $etat;?>Valider la facture
			                </button>';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							Validée En attente d\'être Transmis
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validée et Transmise
							</span>';
					$btn ='';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact']), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $etat;?>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898) {
				?>
                    <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCC.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i> Transmis
                    </button>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
                    <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i> Transmis
                    </button>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 912) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else{
				?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
				<?php
					}
				?>
					<?php 
						echo 
						$btn;
						/*if ($reponse['type_fact'] == 'globale') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1900,height=900');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
	                <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportExcelFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $_GET['id_mod_lic_fact']; ?>&id_cli=<?php echo $_GET['id_cli']; ?>','pop1','width=80,height=80');">
	                  <i class="fas fa-file-excel"></i> Master Data Excel
	                </button>
						<?php
						}else if ($reponse['type_fact'] == 'partielle') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
						<?php
						}*/
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFactureDossierEnAttenteValidation($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													fd.id_t_trans AS id_t_trans
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '0'
													$sqlClient
												ORDER BY fd.date_fact ASC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');
				include('ajusterFactureSCM.php');
				include('ajusterFactureKCC.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>
			                ';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							Validée En attente d\'être Transmis
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validée et Transmise
							</span>';
					$btn ='';
				}

				$btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';

			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$btn = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$btn;
				}

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php 
					if ($reponse['id_t_trans']=='12') {
						echo number_format($this-> getMontantFactureLicence($reponse['ref_fact']), 2, ',', ' ');
					}else{
						echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
					}
					?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['id_t_trans'] == '12') {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureLicence.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                <button class="btn btn-xs bg-teal square-btn-adjust" onclick="window.open('../dossiers/<?php echo $this-> getLicenceFactureLicence($reponse['ref_fact'])['num_lic'];?>/<?php echo $this-> getLicenceFactureLicence($reponse['ref_fact'])['fichier_lic'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                   	Licence 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 883 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='883')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCCExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobaleExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                <button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFactureGlobaleExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 995 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='995')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKICOExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureKICOExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 928 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='928')) {
				?>
					<button class="btn btn-xs btn-warning square-btn-adjust" onclick="window.location.replace('editFactureFRONT.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&num_lic=<?php echo $this-> getLicenceFactureFRONT($reponse['ref_fact']);?>');" title="Editer la facture">
                      <i class="fas fa-edit"></i> 
                    </button>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierFRONTExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureFrontExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='883' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='898'))) {
				?>
	                <button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureKCC_<?php echo $reponse['ref_fact'];?>" title="Ajuster la facture">
			                    <i class="fas fa-cogs"></i> 
			                </button>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCC.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
                    <button class="btn btn-xs btn-warning square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCC2.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-invoice"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ((($reponse['id_cli'] == 888) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) && ($reponse['id_t_trans']=='4') ) {
				?>
	                <button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureSCM_<?php echo $reponse['ref_fact'];?>" title="Ajuster la facture">
			                    <i class="fas fa-cogs"></i> 
			                </button>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomineTR8.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureTR8SCM.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 888) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) {
				?>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=1','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
	                <button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureSCM_<?php echo $reponse['ref_fact'];?>" title="Ajuster la facture">
			                    <i class="fas fa-cogs"></i> 
			                </button>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 912 || ($this-> getModeleFacture($reponse['id_cli'], 2)=='912')) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='885') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='887')) ) {
				?>
                    <!-- <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierRCD.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureRCD.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button> -->
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '921' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || $reponse['id_cli']=='922' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='922')) ) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
	                
				<?php
					}
				?>
					<?php 
						echo 
						$btn;
						/*if ($reponse['type_fact'] == 'globale') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1900,height=900');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
	                <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportExcelFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $_GET['id_mod_lic_fact']; ?>&id_cli=<?php echo $_GET['id_cli']; ?>','pop1','width=80,height=80');">
	                  <i class="fas fa-file-excel"></i> Master Data Excel
	                </button>
						<?php
						}else if ($reponse['type_fact'] == 'partielle') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
						<?php
						}*/
					?>
					 <a href="advancedModificationInvoice.php?ref_fact=<?php echo $reponse['ref_fact'];?>" class="text-warning small"><i class="fa fa-edit"></i> Advanced Modification</a>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFactureDossierEnAttenteValidationAjax($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$rows = array();

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													fd.id_t_trans AS id_t_trans
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													$sqlClient
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				if(!empty($this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'])){
					$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
				}else{
					$reponse['commodity'] = NULL;
				}
				
				if ($reponse['id_t_trans']=='12') {
					$reponse['montant'] = $this-> getMontantFactureLicence($reponse['ref_fact']);
				}else{
					$reponse['montant'] = $this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27)));
				}

				if ($reponse['validation']=='0') {

					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$reponse['btn'] = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>
			                ';
			            }else{
			            	$reponse['btn'] = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else if ($reponse['transmission']=='0') {

					$reponse['btn'] = ' <button class="btn btn-xs bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button> ';
					$etat = '<span class="badge badge-primary">
							Validée En attente d\'être Transmis
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validée et Transmise
							</span>';
					$reponse['btn'] ='';
				}

				$reponse['btn'] .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';

			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$reponse['btn'] = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$reponse['btn'];
				}

				if ($reponse['id_t_trans'] == '12') {
					$reponse['btn'] .= '
									<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureLicence.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
					                    <i class="fas fa-eye"></i> 
					                </button>
					                <button class="btn btn-xs bg-teal square-btn-adjust" onclick="window.open(\'../dossiers/'.$this-> getLicenceFactureLicence($reponse['ref_fact'])['num_lic'].'/'.$this-> getLicenceFactureLicence($reponse['ref_fact'])['fichier_lic'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
					                   	Licence 
					                </button>';
					}else if (($reponse['id_cli'] == 883 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='883')) {
						$reponse['btn'] .= '
											<button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierKCCExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
						                      <i class="fas fa-file-excel"></i> 
						                    </button>
											<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureGlobaleExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
							                    <i class="fas fa-eye"></i> 
							                </button>
							                <button class="btn bg-warning btn-xs square-btn-adjust" onclick="window.location.replace(\'editFactureGlobaleExport.php?ref_fact='.$reponse['ref_fact'].'&id_mod_lic_fact='.$reponse['id_mod_lic'].'&id_cli='.$reponse['id_cli'].'\',\'pop1\',\'width=80,height=80\');" title="Modifier la facture">
							                    <i class="fa fa-edit"></i> 
							                </button>
									';
				?>
                    
				<?php
					}else if (($reponse['id_cli'] == 925 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='925')) {
						$reponse['btn'] .= '
										<button class="btn btn-xs btn-warning square-btn-adjust" onclick="window.location.replace(\'editFactureFRONT.php?ref_fact='.$reponse['ref_fact'].'&id_mod_lic_fact='.$reponse['id_mod_lic'].'&id_cli='.$reponse['id_cli'].'&num_lic='.$this-> getLicenceFactureFRONT($reponse['ref_fact']).'\');" title="Editer la facture">
					                      <i class="fas fa-edit"></i> 
					                    </button>
					                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierKICOExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
					                      <i class="fas fa-file-excel"></i> 
					                    </button>
										<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureKICOExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
						                    <i class="fas fa-eye"></i> 
						                </button>
										';
					}else if (($reponse['id_cli'] == 928 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='928')) {
						$reponse['btn'] .= '
										<button class="btn btn-xs btn-warning square-btn-adjust" onclick="window.location.replace(\'editFactureFRONT.php?ref_fact='.$reponse['ref_fact'].'&id_mod_lic_fact='.$reponse['id_mod_lic'].'&id_cli='.$reponse['id_cli'].'&num_lic='.$this-> getLicenceFactureFRONT($reponse['ref_fact']).'\');" title="Editer la facture">
					                      <i class="fas fa-edit"></i> 
					                    </button>
					                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierFRONTExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
					                      <i class="fas fa-file-excel"></i> 
					                    </button>
										<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureFrontExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
						                    <i class="fas fa-eye"></i> 
						                </button>
										';
					}else if (($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='883' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='898'))) {
						$reponse['btn'] .= '<button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureKCC_'.$reponse['ref_fact'].'" title="Ajuster la facture">
									                    <i class="fas fa-cogs"></i> 
									                </button>
						                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierKCC.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
						                      <i class="fas fa-file-excel"></i> 
						                    </button>
						                    <button class="btn btn-xs btn-warning square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierKCC2.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
						                      <i class="fas fa-file-invoice"></i> 
						                    </button>
											<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureGlobale.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
							                    <i class="fas fa-eye"></i> 
							                </button>';
					}else if ((($reponse['id_cli'] == 888) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) && ($reponse['id_t_trans']=='4') ) {
						$reponse['btn'] .= '
										<button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureSCM_'.$reponse['ref_fact'].'" title="Ajuster la facture">
								                    <i class="fas fa-cogs"></i> 
								                </button>
					                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierSicomineTR8.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
					                      <i class="fas fa-file-excel"></i> 
					                    </button>
										<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureTR8SCM.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
						                    <i class="fas fa-eye"></i> 
						                </button>';
					}else if (($reponse['id_cli'] == 888) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) {
						$reponse['btn'] .= '<button class="btn btn-xs bg-warning square-btn-adjust" onclick="window.location.replace(\'editFactureSicomine.php?ref_fact='.$reponse['ref_fact'].'&id_mod_lic_fact='.$reponse['id_mod_lic'].'&id_cli='.$reponse['id_cli'].'&id_mod_trans=1\',\'pop1\',\'width=80,height=80\');" title="Modifier la facture">
							                    <i class="fa fa-edit"></i> 
							                </button>
							                <button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureSCM_'.$reponse['ref_fact'].'" title="Ajuster la facture">
									                    <i class="fas fa-cogs"></i> 
									                </button>
						                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierSicomine.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
						                      <i class="fas fa-file-excel"></i> 
						                    </button>
											<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureSicomine.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
							                    <i class="fas fa-eye"></i> 
							                </button>';
					}

					/*else if ($reponse['id_cli'] == 912 || ($this-> getModeleFacture($reponse['id_cli'], 2)=='912')) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='885') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='887')) ) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierRCD.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureRCD.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '921' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || $reponse['id_cli']=='922' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='922')) ) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
	                
				<?php
					}*/

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function get_all_invoice_back($id_cli, $id_mod_lic, $statut){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$rows = array();

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													fd.id_t_trans AS id_t_trans
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													$sqlClient
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				if(!empty($this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'])){
					$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
				}else{
					$reponse['commodity'] = NULL;
				}
				
				if ($reponse['id_t_trans']=='12') {
					$reponse['montant'] = $this-> getMontantFactureLicence($reponse['ref_fact']);
				}else{
					$reponse['montant'] = $this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27)));
				}

				if ($reponse['validation']=='0') {

					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$reponse['btn'] = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>
			                ';
			            }else{
			            	$reponse['btn'] = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else if ($reponse['transmission']=='0') {

					$reponse['btn'] = ' <button class="btn btn-xs bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button> ';
					$etat = '<span class="badge badge-primary">
							Validée En attente d\'être Transmis
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validée et Transmise
							</span>';
					$reponse['btn'] ='';
				}

				$reponse['btn'] .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';

			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$reponse['btn'] = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$reponse['btn'];
				}

				if ($reponse['id_t_trans'] == '12') {
					$reponse['btn'] .= '
									<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureLicence.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
					                    <i class="fas fa-eye"></i> 
					                </button>
					                <button class="btn btn-xs bg-teal square-btn-adjust" onclick="window.open(\'../dossiers/'.$this-> getLicenceFactureLicence($reponse['ref_fact'])['num_lic'].'/'.$this-> getLicenceFactureLicence($reponse['ref_fact'])['fichier_lic'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
					                   	Licence 
					                </button>';
					}else if (($reponse['id_cli'] == 883 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='883')) {
						$reponse['btn'] .= '
											<button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierKCCExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
						                      <i class="fas fa-file-excel"></i> 
						                    </button>
											<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureGlobaleExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
							                    <i class="fas fa-eye"></i> 
							                </button>
							                <button class="btn bg-warning btn-xs square-btn-adjust" onclick="window.location.replace(\'editFactureGlobaleExport.php?ref_fact='.$reponse['ref_fact'].'&id_mod_lic_fact='.$reponse['id_mod_lic'].'&id_cli='.$reponse['id_cli'].'\',\'pop1\',\'width=80,height=80\');" title="Modifier la facture">
							                    <i class="fa fa-edit"></i> 
							                </button>
									';
				?>
                    
				<?php
					}else if (($reponse['id_cli'] == 925 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='925')) {
						$reponse['btn'] .= '
										<button class="btn btn-xs btn-warning square-btn-adjust" onclick="window.location.replace(\'editFactureFRONT.php?ref_fact='.$reponse['ref_fact'].'&id_mod_lic_fact='.$reponse['id_mod_lic'].'&id_cli='.$reponse['id_cli'].'&num_lic='.$this-> getLicenceFactureFRONT($reponse['ref_fact']).'\');" title="Editer la facture">
					                      <i class="fas fa-edit"></i> 
					                    </button>
					                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierKICOExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
					                      <i class="fas fa-file-excel"></i> 
					                    </button>
										<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureKICOExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
						                    <i class="fas fa-eye"></i> 
						                </button>
										';
					}else if (($reponse['id_cli'] == 928 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='928')) {
						$reponse['btn'] .= '
										<button class="btn btn-xs btn-warning square-btn-adjust" onclick="window.location.replace(\'editFactureFRONT.php?ref_fact='.$reponse['ref_fact'].'&id_mod_lic_fact='.$reponse['id_mod_lic'].'&id_cli='.$reponse['id_cli'].'&num_lic='.$this-> getLicenceFactureFRONT($reponse['ref_fact']).'\');" title="Editer la facture">
					                      <i class="fas fa-edit"></i> 
					                    </button>
					                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierFRONTExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
					                      <i class="fas fa-file-excel"></i> 
					                    </button>
										<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureFrontExport.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
						                    <i class="fas fa-eye"></i> 
						                </button>
										';
					}else if (($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='883' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='898'))) {
						$reponse['btn'] .= '<button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureKCC_'.$reponse['ref_fact'].'" title="Ajuster la facture">
									                    <i class="fas fa-cogs"></i> 
									                </button>
						                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierKCC.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
						                      <i class="fas fa-file-excel"></i> 
						                    </button>
						                    <button class="btn btn-xs btn-warning square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierKCC2.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
						                      <i class="fas fa-file-invoice"></i> 
						                    </button>
											<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureGlobale.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
							                    <i class="fas fa-eye"></i> 
							                </button>';
					}else if ((($reponse['id_cli'] == 888) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) && ($reponse['id_t_trans']=='4') ) {
						$reponse['btn'] .= '
										<button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureSCM_'.$reponse['ref_fact'].'" title="Ajuster la facture">
								                    <i class="fas fa-cogs"></i> 
								                </button>
					                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierSicomineTR8.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
					                      <i class="fas fa-file-excel"></i> 
					                    </button>
										<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureTR8SCM.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
						                    <i class="fas fa-eye"></i> 
						                </button>';
					}else if (($reponse['id_cli'] == 888) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) {
						$reponse['btn'] .= '<button class="btn btn-xs bg-warning square-btn-adjust" onclick="window.location.replace(\'editFactureSicomine.php?ref_fact='.$reponse['ref_fact'].'&id_mod_lic_fact='.$reponse['id_mod_lic'].'&id_cli='.$reponse['id_cli'].'&id_mod_trans=1\',\'pop1\',\'width=80,height=80\');" title="Modifier la facture">
							                    <i class="fa fa-edit"></i> 
							                </button>
							                <button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureSCM_'.$reponse['ref_fact'].'" title="Ajuster la facture">
									                    <i class="fas fa-cogs"></i> 
									                </button>
						                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace(\'exportTransmisFactureDossierSicomine.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=80,height=80\');" title="Transmis">
						                      <i class="fas fa-file-excel"></i> 
						                    </button>
											<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open(\'generateurFactureSicomine.php?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Générer la facture">
							                    <i class="fas fa-eye"></i> 
							                </button>';
					}

					/*else if ($reponse['id_cli'] == 912 || ($this-> getModeleFacture($reponse['id_cli'], 2)=='912')) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='885') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='887')) ) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierRCD.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureRCD.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '921' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || $reponse['id_cli']=='922' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='922')) ) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
	                
				<?php
					}*/

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherPlis($id_cli){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$compteur=0;

			$requete = $connexion-> prepare("SELECT * 
												FROM plis
												WHERE id_cli = ?");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include("modalEditPlisRedevance.php");
			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_plis'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['num_bp'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<button class="btn btn-xs bg-purple square-btn-adjust" onclick="window.open('../documents/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_plis'];?>','pop1','width=1000,height=800');" title="Voir le fichier">
	                    <i class="fas fa-eye"></i> 
	                </button>
               	<?php
               		if ($_SESSION['id_role']=='1' || $_SESSION['id_util']=='66') {
               		?>
               		<button class="btn btn-warning square-btn-adjust" data-toggle="modal" data-target=".editPlis_<?php echo $reponse['id_plis'];?>">
	                    <i class="fa fa-edit"></i>
	                </button>
               		<?php
               		}
               	?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFactureDossierRecherche($id_cli, $id_mod_lic, $ref_fact, $validation){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_fact'] = $ref_fact;
			$entree['validation'] = $validation;
			$compteur = 0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													fd.id_t_trans AS id_t_trans
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.validation = ?
													AND fd.ref_fact = ?
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['validation'], $entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');
				//include('modalAjusterFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>
			                ';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}/*else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							Validée En attente d\'être Transmis
							</span>';
				}*/else{
					$etat = '<span class="badge badge-success">
							Facture validée et Transmise
							</span>';
					$btn ='';
				}

				$btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';

			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$btn = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$btn;
				}

			?>
			<tr class="bg bg-teal">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php 
					if ($reponse['id_t_trans']=='12') {
						echo number_format($this-> getMontantFactureLicence($reponse['ref_fact']), 2, ',', ' ');
					}else{
						echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
					}
					?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['id_t_trans'] == '12') {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureLicence.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                <button class="btn btn-xs bg-teal square-btn-adjust" onclick="window.open('../dossiers/<?php echo $this-> getLicenceFactureLicence($reponse['ref_fact'])['num_lic'];?>/<?php echo $this-> getLicenceFactureLicence($reponse['ref_fact'])['fichier_lic'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                   	Licence 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 883 && $reponse['id_mod_lic'] == 1) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCCExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobaleExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                <button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFactureGlobaleExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 995 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='995')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKICOExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureKICOExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 928 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='928')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierFRONTExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureFrontExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898 || ($this-> getModeleFacture($reponse['id_cli'], 2)=='883')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCC.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ((($reponse['id_cli'] == 888) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) && ($reponse['id_t_trans']=='4') ) {
				?>
	                <button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureSCM_<?php echo $reponse['ref_fact'];?>" title="Ajuster la facture">
			                    <i class="fas fa-cogs"></i> 
			                </button>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomineTR8.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureTR8SCM.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 912) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885') ) {
				?>
                    <!-- <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierRCD.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureRCD.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button> -->

                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '921' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || $reponse['id_cli']=='922' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='922')) ) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if($reponse['validation']=='0'){
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
	                
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                
				<?php
					}
				?>
					<?php 
						echo 
						$btn;
						/*if ($reponse['type_fact'] == 'globale') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1900,height=900');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
	                <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportExcelFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $_GET['id_mod_lic_fact']; ?>&id_cli=<?php echo $_GET['id_cli']; ?>','pop1','width=80,height=80');">
	                  <i class="fas fa-file-excel"></i> Master Data Excel
	                </button>
						<?php
						}else if ($reponse['type_fact'] == 'partielle') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
						<?php
						}*/
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFactureDossierEnCours($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($_GET['id_mod_trans'])) {
				$entree['id_mod_trans'] = $_GET['id_mod_trans'];
			}else{
				$entree['id_mod_trans'] = 1;
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '2'
													AND fd.id_mod_trans = ?
													$sqlClient
												ORDER BY fd.ref_fact ASC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

			?>
			<tr style="">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact']), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
				<?php
				if ($id_cli == 888 || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) {
				?>
					<button class="btn btn-xs btn-info square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>

					<button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('editFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $id_mod_lic; ?>&id_cli=<?php echo $id_cli; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>');" title="Editer la facture">
                      <i class="fas fa-edit"></i> 
                    </button>
				<?php
				}else if ($id_cli == 921 || $id_cli == 922 || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921')) {
				?>
					<button class="btn btn-xs btn-info square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>

					<button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('editFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $id_mod_lic; ?>&id_cli=<?php echo $id_cli; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>');" title="Editer la facture">
                      <i class="fas fa-edit"></i> 
                    </button>
				<?php
				}else {
				?>
					<button class="btn btn-xs btn-info square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierRCD.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>

					<button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('editFactureRCD.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $id_mod_lic; ?>&id_cli=<?php echo $id_cli; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>');" title="Editer la facture">
                      <i class="fas fa-edit"></i> 
                    </button>
				<?php
				}
				?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFactureLicenceEnCours($num_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['num_lic'] = $num_lic;
			// $entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT DISTINCT(fd.ref_fact) AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													l.num_lic AS num_lic
 												FROM facture_dossier fd, detail_facture_dossier det, dossier dos, licence l, utilisateur u
												WHERE fd.id_util = u.id_util
													AND fd.validation = '2'
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													AND dos.num_lic LIKE CONCAT(SUBSTRING(?, 1, 10), '%')
													AND SUBSTRING(dos.num_lic, 1, 10) = SUBSTRING(l.num_lic, 1, 10)
												ORDER BY fd.ref_fact ASC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

			?>
			<tr style="">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact']), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
					<button class="btn btn-xs btn-warning square-btn-adjust" onclick="window.location.replace('editFactureFRONT.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&num_lic=<?php echo $_GET['num_lic']; ?>&id_mod_lic_fact=<?php echo $_GET['id_mod_lic_fact']; ?>&id_cli=<?php echo $_GET['id_cli']; ?>');" title="Editer la facture">
                      <i class="fas fa-edit"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureFrontExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
					<button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierFRONTExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFactureDossierValiseesEnAttenteTransmission($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													fd.id_t_trans AS id_t_trans
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.validation = '1'
													AND fd.transmission = '0'
													$sqlClient
												ORDER BY fd.ref_fact DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validée et Transmise
							</span>';
					$btn ='';
				}
				if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn .= '<button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".etatFacture_'.$reponse['ref_fact'].'" title="Changer etat de la facture">
			                    <i class="fas fa-arrow-left"></i> 
			                </button>';
			    }
				// $btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			    //                 <i class="fas fa-times"></i> 
			    //             </button>';
			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$btn = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');" title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$btn;
				}

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php 
					if ($reponse['id_t_trans']=='12') {
						echo number_format($this-> getMontantFactureLicence($reponse['ref_fact']), 2, ',', ' ');
					}else{
						echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
					}
					?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['id_t_trans'] == '12') {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureLicence.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                <button class="btn btn-xs bg-teal square-btn-adjust" onclick="window.open('../dossiers/<?php echo $this-> getLicenceFactureLicence($reponse['ref_fact'])['num_lic'];?>/<?php echo $this-> getLicenceFactureLicence($reponse['ref_fact'])['fichier_lic'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                   	Licence 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 883 && $reponse['id_mod_lic'] == 1) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCCExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobaleExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 995 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='995')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKICOExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureKICOExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 928 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='928')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierFRONTExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureFrontExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898 || ($this-> getModeleFacture($reponse['id_cli'], 2)=='883')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCC.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ((($reponse['id_cli'] == 888) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) && ($reponse['id_t_trans']=='4') ) {
				?>
	                <button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureSCM_<?php echo $reponse['ref_fact'];?>" title="Ajuster la facture">
			                    <i class="fas fa-cogs"></i> 
			                </button>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomineTR8.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureTR8SCM.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 912) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885') ) {
				?>
                    <!-- <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierRCD.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureRCD.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button> -->

                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '921' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || $reponse['id_cli']=='922' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='922')) ) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}
				?>
					<?php 
						echo 
						$btn;
						/*if ($reponse['type_fact'] == 'globale') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1900,height=900');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
	                <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportExcelFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $_GET['id_mod_lic_fact']; ?>&id_cli=<?php echo $_GET['id_cli']; ?>','pop1','width=80,height=80');">
	                  <i class="fas fa-file-excel"></i> Master Data Excel
	                </button>
						<?php
						}else if ($reponse['type_fact'] == 'partielle') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
						<?php
						}*/
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFactureDossierValideesTransmises($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													fd.id_t_trans AS id_t_trans
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.transmission = '1'
													$sqlClient
												ORDER BY DATE(fd.date_fact) DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							Validée En attente d\'être Transmis
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validée et Transmise
							</span>';
					$btn ='';
				}
				
				if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn .= '<button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".etatFacture_'.$reponse['ref_fact'].'" title="Changer etat de la facture">
			                    <i class="fas fa-arrow-left"></i> 
			                </button>';
			    }

				// $btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			    //                 <i class="fas fa-times"></i> 
			    //             </button>';
			                
			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$btn = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$btn;
				}

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php 
					if ($reponse['id_t_trans']=='12') {
						echo number_format($this-> getMontantFactureLicence($reponse['ref_fact']), 2, ',', ' ');
					}else{
						echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
					}
					?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['id_t_trans'] == '12') {
				?>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureLicence.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
	                <button class="btn btn-xs bg-teal square-btn-adjust" onclick="window.open('../dossiers/<?php echo $this-> getLicenceFactureLicence($reponse['ref_fact'])['num_lic'];?>/<?php echo $this-> getLicenceFactureLicence($reponse['ref_fact'])['fichier_lic'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                   	Licence 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 883 && $reponse['id_mod_lic'] == 1) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCCExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobaleExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 995 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='995')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKICOExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureKICOExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if (($reponse['id_cli'] == 928 && $reponse['id_mod_lic'] == 1) || ($this-> getModeleFacture($reponse['id_cli'], 1)=='928')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierFRONTExport.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureFrontExport.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898 || ($this-> getModeleFacture($reponse['id_cli'], 2)=='883')) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCC.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ((($reponse['id_cli'] == 888) || ($this-> getModeleFacture($reponse['id_cli'], 2)=='888')) && ($reponse['id_t_trans']=='4') ) {
				?>
	                <button class="btn btn-xs bg-purple square-btn-adjust" data-toggle="modal" data-target=".ajusterFactureSCM_<?php echo $reponse['ref_fact'];?>" title="Ajuster la facture">
			                    <i class="fas fa-cogs"></i> 
			                </button>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomineTR8.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureTR8SCM.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 912) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885') ) {
				?>
                   <!--  <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierRCD.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureRCD.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button> -->

                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '921' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921') || $reponse['id_cli']=='922' || ($this-> getModeleFacture($reponse['id_cli'], 2)=='921')  || ($this-> getModeleFacture($reponse['id_cli'], 2)=='922')) ) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSTF.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureSTF.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}
				?>
					<?php 
						echo 
						$btn;
						/*if ($reponse['type_fact'] == 'globale') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1900,height=900');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
	                <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportExcelFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $_GET['id_mod_lic_fact']; ?>&id_cli=<?php echo $_GET['id_cli']; ?>','pop1','width=80,height=80');">
	                  <i class="fas fa-file-excel"></i> Master Data Excel
	                </button>
						<?php
						}else if ($reponse['type_fact'] == 'partielle') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
						<?php
						}*/
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function get_all_invoice($id_cli, $id_mod_lic, $statut){

			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (($statut!='') && ($statut=='facture_no_valide')) {
				$sqlStatut = ' AND fd.validation = "0"';
			}else if (($statut!='') && ($statut=='facture_no_transmise')) {
				$sqlStatut = ' AND fd.validation = "1" AND fd.transmission = "0" ';
			}else if (($statut!='') && ($statut=='facture_transmises')) {
				$sqlStatut = ' AND fd.transmission = "1" ';
			}else{
				$sqlStatut = '';
			}

			$compteur = 0;
			$rows = array();

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													fd.id_t_trans AS id_t_trans,
													IF(cl.id_group=2,
														SUM( 
																IF(det.usd='1', 
																	IF(det.tva='1', ROUND(det.montant,2)*1.16, ROUND(det.montant,2))
																	,
																	IF(det.tva='1', ROUND((det.montant/dos.roe_decl),2)*1.16, ROUND((det.montant/dos.roe_decl),2))
																	
																) 
															),
														SUM( 
																IF(det.usd='1', 
																	IF(det.tva='1', det.montant*1.16, det.montant)
																	,
																	IF(det.tva='1', (det.montant/dos.roe_decl)*1.16, (det.montant/dos.roe_decl))
																	
																) 
															)
													)
													 AS montant,
													CONCAT('<a href=\"#\" title=\"View The Invoice\" class=\"btn btn-xs btn-info\"  onclick=\"window.open(\'',mf.view_invoice,'?ref_fact=',fd.ref_fact,'\',\'pop5\',\'width=1000,height=800\');\">
																<i class=\"fa fa-eye\"></i>
															</a>') AS btn_action
 												FROM facture_dossier fd, modele_facture mf, detail_facture_dossier det, dossier dos, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.id_cli = cl.id_cli
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													-- AND fd.validation = '1'
													-- AND fd.transmission = '1'
													$sqlClient
													$sqlStatut
												GROUP BY fd.date_fact
												ORDER BY fd.date_fact DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;
			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherFactureDossierValideesTransmisesIntervalle($debut, $fin){
			include("connexion.php");
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;
			$total=0;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.transmission = '1'
													AND (DATE(fd.date_transmis) BETWEEN ? AND ?)
												ORDER BY fd.date_fact DESC");
			$requete-> execute(array($entree['debut'], $entree['fin']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$total += $this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27)));
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							Validée En attente d\'être Transmis
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validée et Transmise
							</span>';
					$btn ='';
				}

				$btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';
			                
			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$btn = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$btn;
				}

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCC.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-danger square-btn-adjust" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-file-pdf"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 912) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}
				?>
					<?php 
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>

			<tr style="<?php echo $bg;?>">
				<th class="" style="text-align: right;" class="bg bg-dark" colspan="4">
					TOTAL
				</th>
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<th class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($total, 2, ',', ' ');?>
				</th>
			</tr>
			<?php

		}

		public function afficherFactureDossierValideesTransmisesClient($id_cli){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;
			$total=0;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.transmission = '1'
													AND fd.id_cli = ?
												ORDER BY fd.date_fact DESC");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$total += $this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27)));
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							Validée En attente d\'être Transmis
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validée et Transmise
							</span>';
					$btn ='';
				}

				$btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';
			                
			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$btn = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$btn;
				}

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
				<?php
					if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierKCC.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
                    <button class="btn btn-xs btn-success square-btn-adjust" onclick="window.location.replace('exportTransmisFactureDossierSicomine.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');" title="Transmis">
                      <i class="fas fa-file-excel"></i> 
                    </button>
					<button class="btn btn-xs bg-danger square-btn-adjust" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-file-pdf"></i> 
	                </button>
				<?php
					}else if ($reponse['id_cli'] == 912) {
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFactureDouble.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fa fa-eye"></i>
	                </button>
					<button class="btn bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button>
				<?php
					}else{
				?>
					<button class="btn bg-primary square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Générer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
				<?php
					}
				?>
					<button class="btn-success square-btn-adjust btn-xs" onclick="window.location.replace('exportFactureFingerClient.php?ref_fact=<?php echo $reponse['ref_fact']; ?>','pop1','width=80,height=80');">
	                  <i class="fas fa-file-excel"></i> Exporter
	                </button>
					<?php 
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>

			<tr style="<?php echo $bg;?>">
				<th class="" style="text-align: right;" class="bg bg-dark" colspan="4">
					TOTAL
				</th>
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<th class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($total, 2, ',', ' ');?>
				</th>
			</tr>
			<?php

		}

		public function afficherFactureDossierValideesTransmisesIntervallePourExportToFinger($debut, $fin){
			include("connexion.php");
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;
			$total=0;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													acm.code_finger AS code_finger,
													cl.nom_cli AS nom_cli,
													dos.ref_dos AS ref_dos,
													adcm.code_serv AS code_serv,
													deb.nom_deb AS nom_deb,
													IF(
														det.usd='1', (ROUND(det.montant, 2)*-1), (ROUND((det.montant/dos.roe_decl), 2)*-1)
													) AS valeur,
													IF(
														det.tva='1', 
															IF(
																det.usd='1', 
																((ROUND(det.montant, 2)*-1)*0.16), 
																((ROUND((det.montant/dos.roe_decl), 2)*-1)*0.16)
															),
														0
													) AS tva
 												FROM facture_dossier fd, client cl, modele_licence ml, 
 													affectation_client_modele_licence acm, dossier dos, 
 													detail_facture_dossier det, affectation_debours_client_modele_licence adcm,
 													debours deb
												WHERE fd.id_cli = cl.id_cli
													AND fd.note_debit = '0'
													AND fd.validation = '1'
													AND fd.transmission = '1'
													AND fd.id_mod_lic = ml.id_mod_lic
													AND ml.id_mod_lic = acm.id_mod_lic
													AND ml.id_mod_lic = adcm.id_mod_lic
													AND adcm.id_cli = cl.id_cli
													AND adcm.id_deb = deb.id_deb
													AND deb.id_deb = det.id_deb
													AND acm.id_cli = cl.id_cli
													AND (DATE(fd.date_fact) BETWEEN ? AND ?)
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['debut'], $entree['fin']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

			?>
			<tr style="">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					LUBUMBASHI
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['code_finger'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					USD
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					FACTURE
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_deb'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					E1004
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['code_serv'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					-1
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['valeur'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					1
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['valeur'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['tva'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['valeur']+$reponse['tva'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();


		}

		public function getNombreFactureDossierEnAttenteValidation($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '0'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureDossierEnCoursn($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($_GET['id_mod_trans'])) {
				$entree['id_mod_trans'] = $_GET['id_mod_trans'];
			}else{
				$entree['id_mod_trans'] = 1;
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '2'
													AND fd.id_mod_trans = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureDossierValideesEnAttenteTransmission($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.transmission = '0'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureDossierValideesTransmise($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.transmission = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureDossierEnCours($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			if (isset($_GET['id_mod_trans'])) {
				$entree['id_mod_trans'] = $_GET['id_mod_trans'];
			}else{
				$entree['id_mod_trans'] = 1;
			}

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '2'
													AND fd.id_mod_trans = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureDossierEnCoursLicence($num_lic){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$entree['num_lic'] = $num_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(fd.ref_fact)) AS nbre
 												FROM facture_dossier fd, detail_facture_dossier det, dossier d, licence l
												WHERE fd.validation = '2'
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = d.id_dos
													AND d.num_lic LIKE CONCAT(SUBSTRING(?, 1, 10), '%')
													AND SUBSTRING(d.num_lic, 1, 10) = SUBSTRING(l.num_lic, 1, 10)
													");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureDossierNonFactureLicence($num_lic){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$entree['num_lic'] = $num_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT count(id_dos) AS nbre
												FROM dossier
												WHERE (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NOT NULL)
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND not_fact = '0'
													AND num_lic LIKE CONCAT(SUBSTRING(?, 1, 10), '%')");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function afficherDossierEnAttenteFacture($id_cli, $id_mod_lic, $id_t_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_t_trans'] = $id_t_trans;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$ref_fact = $this-> buildRefFactureGlobale($id_cli);

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													ref_dos_2,
													commodity AS commodity,
													id_cli,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal, montant_decl
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NOT NULL)
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fd
																WHERE fd.id_t_trans = ?
																	AND fd.ref_fact = det.ref_fact
														)
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_t_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				if ($id_mod_lic == '2') {
					
					if ($reponse['principal'] == '0' && ($this-> verifierDossierFacture($this-> getDossierRefDos($reponse['ref_dos_2'])['id_dos'])==false) ) {

						include("modalNonFactureDossier.php");

					}else if ($reponse['principal'] == '0') {

						include("modalFactureSousDossier.php");

					}else{

						include("modalFactureDossier.php");

					}

				}else{
					include("modalFactureDossier.php");
				}
				
			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
					&nbsp;&nbsp;
					<?php
						if ($reponse['principal'] == '0' && ($this-> verifierDossierFacture($this-> getDossierRefDos($reponse['ref_dos_2'])['id_dos'])==false) ) {
						?>
						<button data-toggle="modal" data-target=".non_facture_<?php echo $reponse['id_dos'];?>" class="btn-xs btn btn-danger">
							<i class="fa fa-calculator"></i>
						</button>
						<?php
						}else if ($reponse['principal'] == '0') {
						?>
						<button data-toggle="modal" data-target=".facture_sous_dossier_<?php echo $reponse['id_dos'];?>" class="btn-xs btn btn-primary">
							<i class="fa fa-calculator"></i>
						</button>
						<?php
						}else{
						?>
						<button data-toggle="modal" data-target=".facture_<?php echo $reponse['id_dos'];?>" class="btn-xs btn btn-secondary">
							<i class="fa fa-calculator"></i>
						</button>
						<?php
						}
					?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['fret'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['assurance'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['cif'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['supplier'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['po_ref'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['bur_douane'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['incoterm'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDossierEnAttenteFactureAjax($id_cli, $id_mod_lic, $id_t_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_t_trans'] = $id_t_trans;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													ref_dos_2,
													commodity AS commodity,
													id_cli,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal, montant_decl
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NOT NULL)
														OR (
															id_mod_lic = '2'
															AND not_cotation = '1')
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fd
																WHERE fd.id_t_trans = ?
																	AND fd.ref_fact = det.ref_fact
														)
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_t_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				if ($id_mod_lic == '2') {
					
					if ($reponse['principal'] == '0' && ($this-> verifierDossierFacture($this-> getDossierRefDos($reponse['ref_dos_2'])['id_dos'])==false) ) {

						

					}else if ($reponse['principal'] == '0') { // Sous Dossier

						$reponse['ref_dos'] .= ' <button data-toggle="modal" class="btn-xs btn bg-purple" onclick="modal_facture_sous_dossier(\''.$reponse['id_dos'].'\', \''.$reponse['ref_dos'].'\', \''.$id_cli.'\', \''.$id_mod_lic.'\', \''.$reponse['ref_dos_2'].'\');">
							<i class="fa fa-calculator"></i>
						</button>';

					}else{

						$reponse['ref_dos'] .= ' <button data-toggle="modal" class="btn-xs btn bg-primary" onclick="modal_facture_dossier(\''.$reponse['id_dos'].'\', \''.$reponse['ref_dos'].'\', \''.$id_cli.'\', \''.$id_mod_lic.'\');">
							<i class="fa fa-calculator"></i>
						</button>';

					}

				}else{
					$reponse['ref_dos'] .= ' <button data-toggle="modal" class="btn-xs btn bg-primary" onclick="modal_facture_dossier(\''.$reponse['id_dos'].'\', \''.$reponse['ref_dos'].'\', \''.$id_cli.'\', \''.$id_mod_lic.'\');">
							<i class="fa fa-calculator"></i>
						</button>';
				}
				
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherDossierEnAttenteFactureAjax_backup($id_cli, $id_mod_lic, $id_t_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_t_trans'] = $id_t_trans;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			// $ref_fact = $this-> buildRefFactureGlobale($id_cli);
			$rows = array();

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													ref_dos_2,
													num_lot,
													ref_fact,
													YEAR(date_creat_dos) AS annee,
													CONCAT(
														IF(horse IS NOT NULL AND REPLACE(horse, ' ', '') NOT LIKE '',
															horse,
															''),
														IF(trailer_1 IS NOT NULL AND REPLACE(trailer_1, ' ', '') NOT LIKE '',
															CONCAT(' / ', trailer_1),
															''),
														IF(trailer_2 IS NOT NULL AND REPLACE(trailer_2, ' ', '') NOT LIKE '',
															CONCAT(' / ', trailer_2),
															'')
													) AS truck,
													commodity AS commodity,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal, montant_decl
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NOT NULL)
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fd
																WHERE fd.id_t_trans = ?
																	AND fd.ref_fact = det.ref_fact
														)
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_t_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				if ($reponse['principal'] == '0' && ($this-> verifierDossierFacture($this-> getDossierRefDos($reponse['ref_dos_2'])['id_dos'])==false) ) {
					$reponse['ref_dos'] .= ' <button data-toggle="modal" data-target=".non_facture_'.$reponse['id_dos'].'" class="btn-xs btn btn-danger">
												<i class="fa fa-calculator"></i>
											</button>';
				?>
				
				<?php
				}else if ($reponse['principal'] == '0') {
					$reponse['ref_dos'] .= ' <button data-toggle="modal" data-target=".facture_sous_dossier_'.$reponse['id_dos'].'" class="btn-xs btn btn-primary">
												<i class="fa fa-calculator"></i>
											</button>';
				}else{
					$reponse['ref_dos'] .= ' <button data-toggle="modal" data-target=".facture_'.$reponse['id_dos'].'" class="btn-xs btn btn-secondary">
												<i class="fa fa-calculator"></i>
											</button>';
				}

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;
				// if ($id_mod_lic == '2') {
					
				// 	if ($reponse['principal'] == '0' && ($this-> verifierDossierFacture($this-> getDossierRefDos($reponse['ref_dos_2'])['id_dos'])==false) ) {

				// 		include("modalNonFactureDossier.php");

				// 	}else if ($reponse['principal'] == '0') {

				// 		include("modalFactureSousDossier.php");

				// 	}else{

				// 		include("modalFactureDossier.php");

				// 	}

				// }else{
				// 	include("modalFactureDossier.php");
				// }

			}$requete-> closeCursor();

			return $rows;

		}

		public function tableau_check_client($id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			// $ref_fact = $this-> buildRefFactureGlobale($id_cli);
			$tableau = '';

			$requete = $connexion-> prepare("SELECT cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													cl.code_cli AS code_cli
												FROM client cl, affectation_client_modele_licence aff
												WHERE cl.id_cli = aff.id_cli
													AND aff.id_mod_lic = ?
												ORDER BY cl.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$tableau .= '<input type="hidden" name="id_cli_'.$compteur.'" value="'.$reponse['id_cli'].'">
							<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['code_cli'].'</td>
								<td>'.$reponse['nom_cli'].'</td>
								<td class="text-center"><input type="checkbox" name="check_'.$compteur.'"></td>
							</tr>';
				
			}$requete-> closeCursor();
			$tableau .='<input type="hidden" name="nbre" value="'.$compteur.'">';

			return $tableau;

		}

		public function dossiers_check_client($post){
			include("connexion.php");
			
			$sqlClient = 'AND dos.cleared<>"2"
							AND dos.id_mod_lic='.$post['id_mod_lic'].'
							AND (';

			for ($i=1; $i <= $post['nbre'] ; $i++) { 
				
				if(isset($post['check_'.$i])){
					$sqlClient .=' dos.id_cli = '.$post['id_cli_'.$i].' OR ';
				}

			}

			$sqlClient .= ' dos.id_cli = 1)';

			$compteur=0;

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> query("SELECT cl.*, dos.*
												FROM dossier dos, client cl
												WHERE dos.id_cli = cl.id_cli
													$sqlClient");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherStatutDossierFacture($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT dossier.ref_dos AS ref_dos,
													IF(dossier.not_fact='1',
														'Excel',
														facture_dossier.ref_fact 
														)
													AS ref_fact,
													dossier.commodity AS commodity,
													DATE_FORMAT(facture_dossier.date_fact, '%d/%m/%Y') AS date_fact,
													dossier.ref_fact AS ref_fact_dos,
													dossier.ref_decl AS ref_decl,
													DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
													dossier.ref_liq AS ref_liq,
													DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
													dossier.ref_quit AS ref_quit,
													DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier
													LEFT JOIN detail_facture_dossier
														ON detail_facture_dossier.id_dos = dossier.id_dos
													LEFT JOIN facture_dossier
														ON facture_dossier.ref_fact = detail_facture_dossier.ref_fact 
												WHERE dossier.id_mod_lic = ?
													AND dossier.id_cli = ?
												GROUP BY dossier.id_dos");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherStatutDossierFactureAjax_backup_30_05_24($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT 1 AS compteur,dossier.ref_dos AS ref_dos,
													IF(dossier.not_fact='1',
														'Excel',
														facture_dossier.ref_fact 
														)
													AS ref_fact,
													dossier.commodity AS commodity,
													DATE_FORMAT(facture_dossier.date_fact, '%d/%m/%Y') AS date_fact,
													dossier.ref_fact AS ref_fact_dos,
													dossier.ref_decl AS ref_decl,
													DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
													dossier.ref_liq AS ref_liq,
													DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
													dossier.ref_quit AS ref_quit,
													DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier
													LEFT JOIN detail_facture_dossier
														ON detail_facture_dossier.id_dos = dossier.id_dos
													LEFT JOIN facture_dossier
														ON facture_dossier.ref_fact = detail_facture_dossier.ref_fact 
												WHERE dossier.id_mod_lic = ?
													AND dossier.id_cli = ?
													AND dossier.ref_dos NOT LIKE 'EXPDEC%'
													AND dossier.ref_dos NOT LIKE '21EXP%'
													AND dossier.ref_dos NOT LIKE '21DEC%'
												GROUP BY dossier.id_dos
												ORDER BY dossier.id_dos ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherStatutDossierFactureAjax($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT 1 AS compteur,
													dossier.mca_b_ref AS mca_b_ref,
													CONCAT(dossier.ref_dos,' <button class=\'btn btn-warning btn-xs\' onclick=\'modal_edit_statut_dossier_facturation(',dossier.id_dos,')\'><i class=\'fa fa-edit\'></i></button>') AS ref_dos,
													IF(dossier.cleared='2',
														'<span class=\'badge badge-danger font-weight-bold\'>Cancelled</span>',
														IF(dossier.not_fact='1',
															'<span class=\'badge badge-danger font-weight-bold\'>Disabled</span>',
																IF(facture_dossier.ref_fact IS NOT NULL AND facture_dossier.note_debit='0',
																	'<span class=\'badge badge-success font-weight-bold\'>Invoiced</span>',
																	IF(dossier.ref_decl IS NULL OR dossier.date_decl IS NULL OR dossier.ref_liq IS NULL OR dossier.date_liq IS NULL OR dossier.ref_quit IS NULL OR dossier.date_quit IS NULL,
																		'<span class=\'badge badge-warning font-weight-bold\'>Missing E, L or Q</span>',
																		'<span class=\'badge badge-warning font-weight-bold\'>Waiting to be invoiced</span>'
																	)

																)
															)
													)
													AS statut,
													IF(dossier.ref_fact_dec IS NOT NULL AND (REPLACE(dossier.ref_fact_dec, ' ', '')<>''),
														dossier.ref_fact_dec,
														IF(facture_dossier.note_debit='0', facture_dossier.ref_fact, NULL)
														) AS ref_fact,
													IF(marchandise.nom_march IS NOT NULL,
														marchandise.nom_march,
														dossier.commodity
													) AS commodity,
													dossier.num_lic AS num_lic,
													DATE_FORMAT(facture_dossier.date_fact, '%d/%m/%Y') AS date_fact,
													IF(dossier.id_mod_lic='2',
														dossier.ref_fact,
														dossier.num_lot
														)
													 AS ref_fact_dos,
													dossier.ref_decl AS ref_decl,
													DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
													dossier.ref_liq AS ref_liq,
													DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
													dossier.ref_quit AS ref_quit,
													DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier
													LEFT JOIN detail_facture_dossier
														ON detail_facture_dossier.id_dos = dossier.id_dos
													LEFT JOIN facture_dossier
														ON facture_dossier.ref_fact = detail_facture_dossier.ref_fact 
															AND facture_dossier.id_t_trans IN ('1', '2')
													LEFT JOIN marchandise
														ON marchandise.id_march = dossier.id_march
												WHERE dossier.id_mod_lic = ?
													AND dossier.id_cli = ?
													AND dossier.ref_dos NOT LIKE 'EXPDEC%'
													AND dossier.ref_dos NOT LIKE '21EXP%'
													AND dossier.ref_dos NOT LIKE '21DEC%'
												GROUP BY dossier.id_dos
												ORDER BY dossier.id_dos ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function MAJ_not_fact($id_dos, $not_fact){

			//Log
			if ($this-> getDossier($id_dos)['not_fact'] != $not_fact) {
				
				// $colonne = $this-> getNomColonneClient('not_fact', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier('Facturation', $not_fact, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['not_fact'] = $not_fact;
			$requete = $connexion-> prepare("UPDATE dossier SET not_fact = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['not_fact'], $entree['id_dos']));

		} 

		public function MAJ_ref_fact_dec($id_dos, $ref_fact_dec){

			//Log
			if ($this-> getDossier($id_dos)['ref_fact_dec'] != $ref_fact_dec) {
				
				// $colonne = $this-> getNomColonneClient('ref_fact_dec', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier('Ref.Fact.Manuelle', $ref_fact_dec, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_fact_dec'] = $ref_fact_dec;
			$requete = $connexion-> prepare("UPDATE dossier SET ref_fact_dec = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_fact_dec'], $entree['id_dos']));

		} 

		public function MAJ_ldc_receiv($id_dos, $ldc_receiv){

			//Log
			if ($this-> getDossier($id_dos)['ldc_receiv'] != $ldc_receiv) {
				
				// $colonne = $this-> getNomColonneClient('ldc_receiv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier('LDC Received', $ldc_receiv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ldc_receiv'] = $ldc_receiv;
			$requete = $connexion-> prepare("UPDATE dossier SET ldc_receiv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ldc_receiv'], $entree['id_dos']));

		} 

		public function MAJ_query_resolv($id_dos, $query_resolv){

			//Log
			if ($this-> getDossier($id_dos)['query_resolv'] != $query_resolv) {
				
				// $colonne = $this-> getNomColonneClient('query_resolv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier('Query Resolve Date', $query_resolv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['query_resolv'] = $query_resolv;
			$requete = $connexion-> prepare("UPDATE dossier SET query_resolv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['query_resolv'], $entree['id_dos']));

		} 

		public function getAllTicket(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			// $entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> query("SELECT t.*,
													st.nom_stat AS nom_stat,
													prio.nom_prio AS nom_prio,
													u.nom_util AS nom_util,
													u.id_util AS id_util,
													module.nom_mod AS nom_mod,
													DATE_FORMAT(t.date_create, '%d/%m/%Y') AS date_create,
													t.date_create AS date_create_2,
													t.date_debut_trait AS date_debut_trait_2,
													t.date_fin_trait AS date_fin_trait_2,
													t.date_const AS date_const_2,
													DATE_FORMAT(t.date_const, '%d/%m/%Y à %H:%I') AS date_const,
													DATE_FORMAT(t.date_debut_trait, '%d/%m/%Y') AS date_debut_trait,
													DATE_FORMAT(t.date_fin_trait, '%d/%m/%Y') AS date_fin_trait,
													IF(t.id_prio='1',
														'bg bg-dark',
														IF(t.id_prio='2',
															'bg bg-primary',
															'bg bg-danger')
														) AS bg_prio,
													IF(t.id_prio='1',
														CONCAT('<span class=\'badge bg-dark\'>',prio.nom_prio,'</span>'),
														IF(t.id_prio='2',
															CONCAT('<span class=\'badge bg-primary\'>',prio.nom_prio,'</span>'),
															CONCAT('<span class=\'badge bg-danger\'>',prio.nom_prio,'</span>')
														)
													) AS nom_prio_2,

													IF(t.validation='0' and t.date_validation is null,
														CONCAT('<span class=\'badge bg-secondary\'>En attente validation</span>'),
														IF(t.id_stat='1',
															CONCAT('<span class=\'badge bg-warning\'>En attente Traitement</span>'),
															IF(t.id_stat='2',
																CONCAT('<span class=\'badge bg-primary\'>En cours traitement</span>'),
																IF(t.id_stat='3',
																	CONCAT('<span class=\'badge bg-info\'>Traitement en pause</span>'),
																	IF(t.id_stat='4',
																		CONCAT('<span class=\'badge bg-danger\'>Annulé</span>'),
																		CONCAT('<span class=\'badge bg-success\'>Cloturé</span>')
																	)
																)
															)
														)
													) AS statut,

													IF(t.id_stat='1',
														'bg bg-warning',
														IF(t.id_stat='2',
															'bg bg-primary',
															IF(t.id_stat='3',
																'bg bg-dark',	
																IF(t.id_stat='4',
																	'bg bg-danger',
																	'bg bg-success')
																)
															)
														) AS bg_stat,
													DATEDIFF(DATE(t.date_create), DATE(t.date_const)) AS delai_constat,
													IF(t.date_debut_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_debut_trait), DATE(t.date_create))
														) AS delai_trait_1,
													IF(t.date_debut_trait IS NULL,
														'0',
														IF(t.date_fin_trait IS NULL,
															DATEDIFF(CURRENT_DATE(), DATE(t.date_debut_trait)),
															DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_debut_trait)))
														) AS delai_trait_2,
													IF(t.date_fin_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_create))
													) AS delai,
													CONCAT('<a href=\'#\' onclick=\'getTicket(',t.id_tick,')\' class=\'fa fa-eye text-primary\'></a>') AS btn_action
 												FROM ticket t, priorite prio, statut_ticket st, module, utilisateur u
												WHERE t.id_util_emet = u.id_util
													AND t.id_prio = prio.id_prio
													AND t.id_stat = st.id_stat
													AND t.id_mod = module.id_mod
												ORDER BY t.id_tick DESC");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function getTicketEnAttenteTraitement(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			// $entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> query("SELECT t.*,
													st.nom_stat AS nom_stat,
													prio.nom_prio AS nom_prio,
													u.nom_util AS nom_util,
													u.id_util AS id_util,
													module.nom_mod AS nom_mod,
													DATE_FORMAT(t.date_create, '%d/%m/%Y') AS date_create,
													t.date_create AS date_create_2,
													t.date_debut_trait AS date_debut_trait_2,
													t.date_fin_trait AS date_fin_trait_2,
													t.date_const AS date_const_2,
													DATE_FORMAT(t.date_const, '%d/%m/%Y à %H:%I') AS date_const,
													DATE_FORMAT(t.date_debut_trait, '%d/%m/%Y') AS date_debut_trait,
													DATE_FORMAT(t.date_fin_trait, '%d/%m/%Y') AS date_fin_trait,
													IF(t.id_prio='1',
														'bg bg-dark',
														IF(t.id_prio='2',
															'bg bg-primary',
															'bg bg-danger')
														) AS bg_prio,
													IF(t.id_prio='1',
														CONCAT('<span class=\'badge bg-dark\'>',prio.nom_prio,'</span>'),
														IF(t.id_prio='2',
															CONCAT('<span class=\'badge bg-primary\'>',prio.nom_prio,'</span>'),
															CONCAT('<span class=\'badge bg-danger\'>',prio.nom_prio,'</span>')
														)
													) AS nom_prio_2,

													IF(t.validation='0' and t.date_validation is null,
														CONCAT('<span class=\'badge bg-secondary\'>En attente validation</span>'),
														IF(t.id_stat='1',
															CONCAT('<span class=\'badge bg-warning\'>En attente Traitement</span>'),
															IF(t.id_stat='2',
																CONCAT('<span class=\'badge bg-primary\'>En cours traitement</span>'),
																IF(t.id_stat='3',
																	CONCAT('<span class=\'badge bg-info\'>Traitement en pause</span>'),
																	IF(t.id_stat='4',
																		CONCAT('<span class=\'badge bg-danger\'>Annulé</span>'),
																		CONCAT('<span class=\'badge bg-success\'>Cloturé</span>')
																	)
																)
															)
														)
													) AS statut,

													IF(t.id_stat='1',
														'bg bg-warning',
														IF(t.id_stat='2',
															'bg bg-primary',
															IF(t.id_stat='3',
																'bg bg-dark',	
																IF(t.id_stat='4',
																	'bg bg-danger',
																	'bg bg-success')
																)
															)
														) AS bg_stat,
													DATEDIFF(DATE(t.date_create), DATE(t.date_const)) AS delai_constat,
													IF(t.date_debut_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_debut_trait), DATE(t.date_create))
														) AS delai_trait_1,
													IF(t.date_debut_trait IS NULL,
														'0',
														IF(t.date_fin_trait IS NULL,
															DATEDIFF(CURRENT_DATE(), DATE(t.date_debut_trait)),
															DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_debut_trait)))
														) AS delai_trait_2,
													IF(t.date_fin_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_create))
													) AS delai,
													CONCAT('<a href=\'#\' title=\'Voir les details\' onclick=\'getTicket(',t.id_tick,')\' class=\'fa fa-eye text-primary\'></a>') AS btn_action,
													IF(t.date_fin_trait IS NULL,
														CONCAT(' <a href=\'#\' title=\'Traitement du ticket\' onclick=\'modalTraitementTicket(',t.id_tick,')\' class=\'fa fa-cogs text-success\'></a>'),
														''
													) AS btn_traitement
 												FROM ticket t, priorite prio, statut_ticket st, module, utilisateur u
												WHERE t.id_util_emet = u.id_util
													AND t.id_prio = prio.id_prio
													AND t.id_stat = st.id_stat
													AND t.id_mod = module.id_mod
													AND t.validation='1' 
													AND t.date_validation IS NOT NULL 
													AND t.id_util_val IS NOT NULL
													AND t.id_stat='1'
												ORDER BY t.id_tick DESC");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				if($this-> getUtilisateur($_SESSION['id_util'])['traitement_ticket']=='1'){
					$reponse['btn_action'] .= $reponse['btn_traitement'];
				}

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function getTicketEncoursTraitement(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			// $entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> query("SELECT t.*,
													st.nom_stat AS nom_stat,
													prio.nom_prio AS nom_prio,
													u.nom_util AS nom_util,
													u.id_util AS id_util,
													module.nom_mod AS nom_mod,
													DATE_FORMAT(t.date_create, '%d/%m/%Y') AS date_create,
													t.date_create AS date_create_2,
													t.date_debut_trait AS date_debut_trait_2,
													t.date_fin_trait AS date_fin_trait_2,
													t.date_const AS date_const_2,
													DATE_FORMAT(t.date_const, '%d/%m/%Y à %H:%I') AS date_const,
													DATE_FORMAT(t.date_debut_trait, '%d/%m/%Y') AS date_debut_trait,
													DATE_FORMAT(t.date_fin_trait, '%d/%m/%Y') AS date_fin_trait,
													IF(t.id_prio='1',
														'bg bg-dark',
														IF(t.id_prio='2',
															'bg bg-primary',
															'bg bg-danger')
														) AS bg_prio,
													IF(t.id_prio='1',
														CONCAT('<span class=\'badge bg-dark\'>',prio.nom_prio,'</span>'),
														IF(t.id_prio='2',
															CONCAT('<span class=\'badge bg-primary\'>',prio.nom_prio,'</span>'),
															CONCAT('<span class=\'badge bg-danger\'>',prio.nom_prio,'</span>')
														)
													) AS nom_prio_2,

													IF(t.validation='0' and t.date_validation is null,
														CONCAT('<span class=\'badge bg-secondary\'>En attente validation</span>'),
														IF(t.id_stat='1',
															CONCAT('<span class=\'badge bg-warning\'>En attente Traitement</span>'),
															IF(t.id_stat='2',
																CONCAT('<span class=\'badge bg-primary\'>En cours traitement</span>'),
																IF(t.id_stat='3',
																	CONCAT('<span class=\'badge bg-info\'>Traitement en pause</span>'),
																	IF(t.id_stat='4',
																		CONCAT('<span class=\'badge bg-danger\'>Annulé</span>'),
																		CONCAT('<span class=\'badge bg-success\'>Cloturé</span>')
																	)
																)
															)
														)
													) AS statut,

													IF(t.id_stat='1',
														'bg bg-warning',
														IF(t.id_stat='2',
															'bg bg-primary',
															IF(t.id_stat='3',
																'bg bg-dark',	
																IF(t.id_stat='4',
																	'bg bg-danger',
																	'bg bg-success')
																)
															)
														) AS bg_stat,
													DATEDIFF(DATE(t.date_create), DATE(t.date_const)) AS delai_constat,
													IF(t.date_debut_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_debut_trait), DATE(t.date_create))
														) AS delai_trait_1,
													IF(t.date_debut_trait IS NULL,
														'0',
														IF(t.date_fin_trait IS NULL,
															DATEDIFF(CURRENT_DATE(), DATE(t.date_debut_trait)),
															DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_debut_trait)))
														) AS delai_trait_2,
													IF(t.date_fin_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_create))
													) AS delai,
													CONCAT('<a href=\'#\' title=\'Voir les details\' onclick=\'getTicket(',t.id_tick,')\' class=\'fa fa-eye text-primary\'></a>') AS btn_action,
													IF(t.date_fin_trait IS NULL,
														CONCAT(' <a href=\'#\' title=\'Traitement du ticket\' onclick=\'modalTraitementTicket(',t.id_tick,')\' class=\'fa fa-cogs text-success\'></a>'),
														''
													) AS btn_traitement
 												FROM ticket t, priorite prio, statut_ticket st, module, utilisateur u
												WHERE t.id_util_emet = u.id_util
													AND t.id_prio = prio.id_prio
													AND t.id_stat = st.id_stat
													AND t.id_mod = module.id_mod
													AND t.validation='1' 
													AND t.date_validation IS NOT NULL 
													AND t.id_util_val IS NOT NULL
													AND t.id_stat='2'
												ORDER BY t.id_tick DESC");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				if($this-> getUtilisateur($_SESSION['id_util'])['traitement_ticket']=='1'){
					$reponse['btn_action'] .= $reponse['btn_traitement'];
				}

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function getTicketCloture(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			// $entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> query("SELECT t.*,
													st.nom_stat AS nom_stat,
													prio.nom_prio AS nom_prio,
													u.nom_util AS nom_util,
													u.id_util AS id_util,
													module.nom_mod AS nom_mod,
													DATE_FORMAT(t.date_create, '%d/%m/%Y') AS date_create,
													t.date_create AS date_create_2,
													t.date_debut_trait AS date_debut_trait_2,
													t.date_fin_trait AS date_fin_trait_2,
													t.date_const AS date_const_2,
													DATE_FORMAT(t.date_const, '%d/%m/%Y à %H:%I') AS date_const,
													DATE_FORMAT(t.date_debut_trait, '%d/%m/%Y') AS date_debut_trait,
													DATE_FORMAT(t.date_fin_trait, '%d/%m/%Y') AS date_fin_trait,
													IF(t.id_prio='1',
														'bg bg-dark',
														IF(t.id_prio='2',
															'bg bg-primary',
															'bg bg-danger')
														) AS bg_prio,
													IF(t.id_prio='1',
														CONCAT('<span class=\'badge bg-dark\'>',prio.nom_prio,'</span>'),
														IF(t.id_prio='2',
															CONCAT('<span class=\'badge bg-primary\'>',prio.nom_prio,'</span>'),
															CONCAT('<span class=\'badge bg-danger\'>',prio.nom_prio,'</span>')
														)
													) AS nom_prio_2,

													IF(t.validation='0' and t.date_validation is null,
														CONCAT('<span class=\'badge bg-secondary\'>En attente validation</span>'),
														IF(t.id_stat='1',
															CONCAT('<span class=\'badge bg-warning\'>En attente Traitement</span>'),
															IF(t.id_stat='2',
																CONCAT('<span class=\'badge bg-primary\'>En cours traitement</span>'),
																IF(t.id_stat='3',
																	CONCAT('<span class=\'badge bg-info\'>Traitement en pause</span>'),
																	IF(t.id_stat='4',
																		CONCAT('<span class=\'badge bg-danger\'>Annulé</span>'),
																		CONCAT('<span class=\'badge bg-success\'>Cloturé</span>')
																	)
																)
															)
														)
													) AS statut,

													IF(t.id_stat='1',
														'bg bg-warning',
														IF(t.id_stat='2',
															'bg bg-primary',
															IF(t.id_stat='3',
																'bg bg-dark',	
																IF(t.id_stat='4',
																	'bg bg-danger',
																	'bg bg-success')
																)
															)
														) AS bg_stat,
													DATEDIFF(DATE(t.date_create), DATE(t.date_const)) AS delai_constat,
													IF(t.date_debut_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_debut_trait), DATE(t.date_create))
														) AS delai_trait_1,
													IF(t.date_debut_trait IS NULL,
														'0',
														IF(t.date_fin_trait IS NULL,
															DATEDIFF(CURRENT_DATE(), DATE(t.date_debut_trait)),
															DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_debut_trait)))
														) AS delai_trait_2,
													IF(t.date_fin_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_create))
													) AS delai,
													CONCAT('<a href=\'#\' title=\'Voir les details\' onclick=\'getTicket(',t.id_tick,')\' class=\'fa fa-eye text-primary\'></a>') AS btn_action,
													IF(t.date_fin_trait IS NULL,
														CONCAT(' <a href=\'#\' title=\'Traitement du ticket\' onclick=\'modalTraitementTicket(',t.id_tick,')\' class=\'fa fa-cogs text-success\'></a>'),
														''
													) AS btn_traitement
 												FROM ticket t, priorite prio, statut_ticket st, module, utilisateur u
												WHERE t.id_util_emet = u.id_util
													AND t.id_prio = prio.id_prio
													AND t.id_stat = st.id_stat
													AND t.id_mod = module.id_mod
													AND t.validation='1' 
													AND t.date_validation IS NOT NULL 
													AND t.id_util_val IS NOT NULL
													AND t.id_stat='5'
												ORDER BY t.id_tick DESC");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				// if($this-> getUtilisateur($_SESSION['id_util'])['traitement_ticket']=='1'){
				// 	$reponse['btn_action'] .= $reponse['btn_traitement'];
				// }

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function licenceAjax($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT l.*,
													l.num_lic AS num_lic,
													l.ref_fact AS ref_fact,
													DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
													DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
													DATE_FORMAT(exp.date_exp, '%d/%m/%Y') AS date_exp,
													l.fournisseur AS fournisseur,
													l.fob AS fob_l,
													IF(l.poids, l.poids, 0) AS poids_l,
													SUM(IF(md.fob, md.fob, 0)) AS fob_md,
													(l.fob-SUM(IF(md.fob, md.fob, 0))) AS solde_fob,
													SUM(IF(md.poids, md.poids, 0)) AS poids_md,
													(IF(l.poids, l.poids, 0)-SUM(IF(md.poids, md.poids, 0))) AS solde_poids,
													(IF(l.fob IS NULL, 0, l.fob) +IF(l.fret IS NULL, 0, l.fret)+IF(l.assurance IS NULL, 0, l.assurance)+IF(l.autre_frais IS NULL, 0, l.autre_frais)) AS cif_l,
													COUNT(md.id_march_dos) AS nbre_marchandise,
													CONCAT('
													  <div class=\"btn-group\" role=\"group\">
													    <button id=\"btnGroupDrop1\" type=\"button\" class=\"btn btn-xs btn-secondary dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">
													      <i class=\"fa fa-bars\"></i>
													    </button>
													    <div class=\"dropdown-menu\" aria-labelledby=\"btnGroupDrop1\">
													      <a class=\"dropdown-item\" href=\"#\" onclick=\"modal_edit_facture(\'',l.num_lic,'\')\"><i class=\"fa fa-edit\"></i> Modifier Facture</a>
													      <a class=\"dropdown-item\" href=\"#\" onclick=\"modal_edit_licence(\'',l.num_lic,'\')\"><i class=\"fa fa-edit\"></i> Modifier Licence</a>
													    </div>
													  </div>') AS btn_action
 												FROM licence l
 													LEFT JOIN marchandise_dossier md
 														ON SUBSTRING(l.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
 													LEFT JOIN expiration_licence exp
 														ON exp.num_lic = l.num_lic
 															AND exp.id_etat = '1'
 												WHERE l.id_mod_lic = ?
 													AND l.id_cli = ?
												GROUP BY l.date_creat_lic DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				// if($this-> getUtilisateur($_SESSION['id_util'])['traitement_ticket']=='1'){
				// 	$reponse['btn_action'] .= $reponse['btn_traitement'];
				// }

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function depense_dossier($id_cli, $id_mod_lic, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;

			$compteur=0;

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													CONCAT(
														IF(d.horse IS NOT NULL AND REPLACE(d.horse, ' ', '') NOT LIKE '',
															d.horse,
															''),
														IF(d.trailer_1 IS NOT NULL AND REPLACE(d.trailer_1, ' ', '') NOT LIKE '',
															CONCAT(' / ', d.trailer_1),
															''),
														IF(d.trailer_2 IS NOT NULL AND REPLACE(d.trailer_2, ' ', '') NOT LIKE '',
															CONCAT(' / ', d.trailer_2),
															'')
													) AS truck,
													d.commodity AS commodity,
													IF(d.ref_decl IS NOT NULL,
														CONCAT(d.ref_decl, ' du ', DATE_FORMAT(d.date_decl, '%d/%m/%Y')),
														NULL
														) AS declaration,
													SUM(
														IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL,
															adcml.montant,
															0
														)
													) AS prevision_hon_incl,
													SUM(
														IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL AND deb.id_deb NOT IN ('12', '25', '63', '90'),
															adcml.montant,
															0
														)
													) AS prevision_hon_excl,
													CONCAT('<span class=\'btn btn-xs btn btn-secondary\' onclick=\'modal_detail_depense(\"',d.id_dos,'\", \"',d.ref_dos,'\")\'>Details / Imputation</span>') AS btn_action
												FROM dossier d, affectation_debours_client_modele_licence adcml, debours deb
													WHERE adcml.id_cli = d.id_cli
														AND adcml.id_mod_lic = d.id_mod_lic
														AND adcml.id_mod_trans = d.id_mod_trans
														AND adcml.id_deb = deb.id_deb
														AND d.id_cli = ?
														AND d.id_mod_lic = ?
														AND d.id_mod_trans = ?
												GROUP BY d.id_dos
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['montant_depense'] = $this-> getMontantDepenseDossier($reponse['id_dos']);
				if($reponse['prevision_hon_excl']>$reponse['montant_depense']){
					$reponse['arrow_rentabilite_hon_excl'] = '<span class=\'fa fa-arrow-circle-up text-success\'></span>';
				}else if($reponse['prevision_hon_excl']<$reponse['montant_depense']){
					$reponse['arrow_rentabilite_hon_excl'] = '<span class=\'fa fa-arrow-circle-down text-danger\'></span>';
				}else{
					$reponse['arrow_rentabilite_hon_excl'] = '<span class=\'fa fa-minus text-info\'></span>';
				}
				$reponse['rentabilite_hon_excl'] = $reponse['prevision_hon_excl']-$reponse['montant_depense'];
				if($reponse['prevision_hon_incl']>$reponse['montant_depense']){
					$reponse['arrow_rentabilite_hon_incl'] = '<span class=\'fa fa-arrow-circle-up text-success\'></span>';
				}else if($reponse['prevision_hon_incl']<$reponse['montant_depense']){
					$reponse['arrow_rentabilite_hon_incl'] = '<span class=\'fa fa-arrow-circle-down text-danger\'></span>';
				}else{
					$reponse['arrow_rentabilite_hon_incl'] = '<span class=\'fa fa-minus text-info\'></span>';
				}
				$reponse['rentabilite_hon_incl'] = $reponse['prevision_hon_incl']-$reponse['montant_depense'];
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function getMontantDepenseDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare('SELECT SUM(montant) AS montant
												FROM depense_dossier
												WHERE id_dos = ?');
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['montant'];
			}else{
				return '0';
			}

		}

		public function depense_dossierBackUp($id_cli, $id_mod_lic, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;

			$compteur=0;

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													CONCAT(
														IF(d.horse IS NOT NULL AND REPLACE(d.horse, ' ', '') NOT LIKE '',
															d.horse,
															''),
														IF(d.trailer_1 IS NOT NULL AND REPLACE(d.trailer_1, ' ', '') NOT LIKE '',
															CONCAT(' / ', d.trailer_1),
															''),
														IF(d.trailer_2 IS NOT NULL AND REPLACE(d.trailer_2, ' ', '') NOT LIKE '',
															CONCAT(' / ', d.trailer_2),
															'')
													) AS truck,
													d.commodity AS commodity,
													IF(d.ref_decl IS NOT NULL,
														CONCAT(d.ref_decl, ' du ', DATE_FORMAT(d.date_decl, '%d/%m/%Y')),
														NULL
														) AS declaration,
													SUM(
														IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL,
															adcml.montant,
															0
														)
													) AS prevision_hon_incl,
													SUM(
														IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL AND deb.id_deb NOT IN ('12', '25', '63', '90'),
															adcml.montant,
															0
														)
													) AS prevision_hon_excl,
													SUM(IF(dd.montant IS NULL, 0, dd.montant)) AS montant_depense,
													(
														SUM(
															IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL AND deb.id_deb NOT IN ('12', '25', '63', '90'),
																adcml.montant,
																0
															)
														)
														- SUM(IF(dd.montant IS NULL, 0, dd.montant))
													) AS rentabilite_hon_excl,
													(
														SUM(
															IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL,
																adcml.montant,
																0
															)
														)
														- SUM(IF(dd.montant IS NULL, 0, dd.montant))
													) AS rentabilite_hon_incl,
													IF((SUM(IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL,adcml.montant,0))-SUM(IF(dd.montant IS NULL, 0, dd.montant)))>0, '<span class=\'fa fa-arrow-circle-up text-success\'></span>', IF((SUM(IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL,adcml.montant,0))-SUM(IF(dd.montant IS NULL, 0, dd.montant)))=0, '<span class=\'fa fa-minus text-primary\'></span>', '<span class=\'fa fa-arrow-circle-down text-danger\'></span>')) AS arrow_rentabilite_hon_incl,
													IF((SUM(IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL AND deb.id_deb NOT IN ('12', '25', '63', '90'),adcml.montant,0))-SUM(IF(dd.montant IS NULL, 0, dd.montant)))>0, '<span class=\'fa fa-arrow-circle-up text-success\'></span>', IF((SUM(IF(deb.id_t_deb <> '1' AND adcml.montant IS NOT NULL AND deb.id_deb NOT IN ('12', '25', '63', '90'),adcml.montant,0))-SUM(IF(dd.montant IS NULL, 0, dd.montant)))=0, '<span class=\'fa fa-minus text-primary\'></span>', '<span class=\'fa fa-arrow-circle-down text-danger\'></span>')) AS arrow_rentabilite_hon_excl,
													CONCAT('<span class=\'btn btn-xs btn btn-secondary\' onclick=\'modal_detail_depense(\"',d.ref_dos,'\")\'>Details / Imputation</span>') AS btn_action
												FROM dossier d
													LEFT JOIN affectation_debours_client_modele_licence adcml
														ON adcml.id_cli = d.id_cli
															AND adcml.id_mod_lic = d.id_mod_lic
															AND adcml.id_mod_trans = d.id_mod_trans
													LEFT JOIN debours deb
														ON adcml.id_deb = deb.id_deb
													LEFT JOIN depense_dossier dd
														ON dd.id_dos = d.id_dos
															-- AND deb.id_deb = dd.id_deb
												WHERE d.id_cli = ?
													AND d.id_mod_lic = ?
													AND d.id_mod_trans = ?
												GROUP BY d.id_dos, dd.id_dos
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				// if($this-> getUtilisateur($_SESSION['id_util'])['traitement_ticket']=='1'){
				// 	$reponse['btn_action'] .= $reponse['btn_traitement'];
				// }

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function selectionnerDeboursClient($id_cli, $id_mod_lic, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;

			$compteur=0;

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT deb.id_deb AS id_deb,
													deb.nom_deb AS nom_deb
												FROM debours deb, affectation_debours_client_modele_licence aff
												WHERE deb.id_t_deb <> 1
													AND deb.id_deb NOT IN ('12', '25', '63', '90')
													AND deb.id_deb = aff.id_deb
													AND aff.id_cli = ?
													AND aff.id_mod_lic = ?
													AND aff.id_mod_trans = ?
												ORDER BY deb.nom_deb");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				?>
				<option value="<?php echo $reponse['id_deb'];?>">
					<?php echo $reponse['nom_deb'];?>
				</option>
				<?php

			}$requete-> closeCursor();

		}

		public function selectionnerDepense(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$compteur=0;

			$requete = $connexion-> query("SELECT DISTINCT(REPLACE(nom_dep, ' ', '')) AS nom_dep_2,
												nom_dep,
												id_dep
											FROM depense
											ORDER BY nom_dep");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				?>
				<option value="<?php echo $reponse['id_dep'];?>">
					<?php echo $reponse['nom_dep'];?>
				</option>
				<?php
			}$requete-> closeCursor();

		}

		public function getDetailDepenseDossierAjax($id_cli, $id_mod_lic, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;

			$compteur=0;

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													dep.nom_dep AS nom_dep,
													deb.nom_deb AS nom_deb,
													dd.montant AS montant,
													DATE_FORMAT(dd.date_dep, '%d/%m/%Y') AS date_dep
												FROM dossier d, depense_dossier dd, depense dep, debours deb
													WHERE dd.id_dep = dep.id_dep
														AND dd.id_deb = deb.id_deb
														AND d.id_dos = dd.id_dos
														AND d.id_cli = ?
														AND d.id_mod_lic = ?
														AND d.id_mod_trans = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				// if($this-> getUtilisateur($_SESSION['id_util'])['traitement_ticket']=='1'){
				// 	$reponse['btn_action'] .= $reponse['btn_traitement'];
				// }

				$rows[] = $reponse;

			}$requete-> closeCursor();

			if (!empty($rows)) {
				return $rows;
			}else{
				return null;
			}

		}

		public function getTicketEnAttenteValidation(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			// $entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT t.*,
													st.nom_stat AS nom_stat,
													prio.nom_prio AS nom_prio,
													u.nom_util AS nom_util,
													u.id_util AS id_util,
													module.nom_mod AS nom_mod,
													DATE_FORMAT(t.date_create, '%d/%m/%Y') AS date_create,
													t.date_create AS date_create_2,
													t.date_debut_trait AS date_debut_trait_2,
													t.date_fin_trait AS date_fin_trait_2,
													t.date_const AS date_const_2,
													DATE_FORMAT(t.date_const, '%d/%m/%Y à %H:%I') AS date_const,
													DATE_FORMAT(t.date_debut_trait, '%d/%m/%Y') AS date_debut_trait,
													DATE_FORMAT(t.date_fin_trait, '%d/%m/%Y') AS date_fin_trait,
													IF(t.id_prio='1',
														'bg bg-dark',
														IF(t.id_prio='2',
															'bg bg-primary',
															'bg bg-danger')
														) AS bg_prio,
													IF(t.id_prio='1',
														CONCAT('<span class=\'badge bg-dark\'>',prio.nom_prio,'</span>'),
														IF(t.id_prio='2',
															CONCAT('<span class=\'badge bg-primary\'>',prio.nom_prio,'</span>'),
															CONCAT('<span class=\'badge bg-danger\'>',prio.nom_prio,'</span>')
														)
													) AS nom_prio_2,

													IF(t.validation='0' and t.date_validation is null,
														CONCAT('<span class=\'badge bg-secondary\'>En attente validation</span>'),
														IF(t.id_stat='1',
															CONCAT('<span class=\'badge bg-warning\'>En attente Traitement</span>'),
															IF(t.id_stat='2',
																CONCAT('<span class=\'badge bg-primary\'>En cours traitement</span>'),
																IF(t.id_stat='3',
																	CONCAT('<span class=\'badge bg-info\'>Traitement en pause</span>'),
																	IF(t.id_stat='4',
																		CONCAT('<span class=\'badge bg-danger\'>Annulé</span>'),
																		CONCAT('<span class=\'badge bg-success\'>Cloturé</span>')
																	)
																)
															)
														)
													) AS statut,

													IF(t.id_stat='1',
														'bg bg-warning',
														IF(t.id_stat='2',
															'bg bg-primary',
															IF(t.id_stat='3',
																'bg bg-dark',	
																IF(t.id_stat='4',
																	'bg bg-danger',
																	'bg bg-success')
																)
															)
														) AS bg_stat,
													DATEDIFF(DATE(t.date_create), DATE(t.date_const)) AS delai_constat,
													IF(t.date_debut_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_debut_trait), DATE(t.date_create))
														) AS delai_trait_1,
													IF(t.date_debut_trait IS NULL,
														'0',
														IF(t.date_fin_trait IS NULL,
															DATEDIFF(CURRENT_DATE(), DATE(t.date_debut_trait)),
															DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_debut_trait)))
														) AS delai_trait_2,
													IF(t.date_fin_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_create))
													) AS delai,
													CONCAT('<a href=\'#\' onclick=\'getTicket(',t.id_tick,')\' class=\'fa fa-eye text-primary\'></a>') AS btn_action,
													IF((t.validation='0' OR t.date_validation IS NULL OR t.id_util_val IS NULL) AND t.id_util_val = ?,
														CONCAT('<button onclick=\'valider_ticket(',t.id_tick,')\' class=\'form-control form-control-sm bg-success\'><i class=\'fa fa-check\'></i> Valider</button>'),
														''
													) AS btn_validation
 												FROM ticket t, priorite prio, statut_ticket st, module, utilisateur u
												WHERE t.id_util_emet = u.id_util
													AND t.id_prio = prio.id_prio
													AND t.id_stat = st.id_stat
													AND t.id_mod = module.id_mod
													AND (t.validation='0' OR t.date_validation IS NULL OR t.id_util_val IS NULL)
												ORDER BY t.id_tick DESC");
			$requete-> execute(array($_SESSION['id_util']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function getTicket($id_tick){
			include("connexion.php");
			$entree['id_tick'] = $id_tick;
			// $entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT t.*,
													st.nom_stat AS nom_stat,
													prio.nom_prio AS nom_prio,
													u.nom_util AS nom_util,
													u.id_util AS id_util,
													module.nom_mod AS nom_mod,
													DATE_FORMAT(t.date_create, '%d/%m/%Y') AS date_create,
													t.date_create AS date_create_2,
													t.date_debut_trait AS date_debut_trait_2,
													t.date_fin_trait AS date_fin_trait_2,
													t.date_const AS date_const_2,
													DATE_FORMAT(t.date_const, '%d/%m/%Y à %H:%I') AS date_const_2,
													DATE_FORMAT(t.date_validation, '%d/%m/%Y à %H:%I') AS date_validation,
													DATE_FORMAT(t.date_debut_trait, '%d/%m/%Y à %H:%I') AS date_debut_trait,
													DATE_FORMAT(t.date_fin_trait, '%d/%m/%Y à %H:%I') AS date_fin_trait,
													IF(t.id_prio='1',
														'bg bg-dark',
														IF(t.id_prio='2',
															'bg bg-primary',
															'bg bg-danger')
														) AS bg_prio,
													IF(t.id_prio='1',
														CONCAT('<input type=\'text\' class=\'form-control form-control-sm bg-dark\' value=\'',prio.nom_prio,'\'>'),
														IF(t.id_prio='2',
															CONCAT('<input type=\'text\' class=\'form-control form-control-sm bg-primary\' value=\'',prio.nom_prio,'\'>'),
															CONCAT('<input type=\'text\' class=\'form-control form-control-sm bg-danger\' value=\'',prio.nom_prio,'\'>')
														)
													) AS nom_prio_2,
													IF(t.fichier_ticket IS NOT NULL,
														CONCAT('<span onclick=\"window.open(\'../ticket/',t.id_tick,'/',t.fichier_ticket,'\',\'pop1\',\'width=500,height=600\');\" class=\'text-center form-control form-control-sm bg-primary\'><i class=\"fa fa-file\"></i> Piece Jointe</span>'),
														NULL
													) AS btn_fichier_ticket,
													IF(t.validation='0' and t.date_validation is null,
														CONCAT('<span class=\' bg-secondary form-control form-control-sm\'>En attente validation</span>'),
														IF(t.id_stat='1',
															CONCAT('<span class=\' bg-warning form-control form-control-sm\'>En attente Traitement</span>'),
															IF(t.id_stat='2',
																CONCAT('<span class=\' bg-primary form-control form-control-sm\'>En cours traitement</span>'),
																IF(t.id_stat='3',
																	CONCAT('<span class=\' bg-info form-control form-control-sm\'>Traitement en pause</span>'),
																	IF(t.id_stat='4',
																		CONCAT('<span class=\' bg-danger form-control form-control-sm\'>Annulé</span>'),
																		CONCAT('<span class=\' bg-success form-control form-control-sm\'>Cloturé</span>')
																	)
																)
															)
														)
													) AS statut,

													IF(t.id_stat='1',
														'bg bg-warning',
														IF(t.id_stat='2',
															'bg bg-primary',
															IF(t.id_stat='3',
																'bg bg-dark',	
																IF(t.id_stat='4',
																	'bg bg-danger',
																	'bg bg-success')
																)
															)
														) AS bg_stat,
													DATEDIFF(DATE(t.date_create), DATE(t.date_const)) AS delai_constat,
													IF(t.date_debut_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_debut_trait), DATE(t.date_create))
														) AS delai_trait_1,
													IF(t.date_debut_trait IS NULL,
														'0',
														IF(t.date_fin_trait IS NULL,
															DATEDIFF(CURRENT_DATE(), DATE(t.date_debut_trait)),
															DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_debut_trait)))
														) AS delai_trait_2,
													IF(t.date_fin_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_create))
													) AS delai,
													CONCAT('<a href=\'#\' onclick=\'view_ticket(',t.id_tick,')\' class=\'fa fa-eye text-primary\'></a>') AS btn_action,
													IF((t.validation='0' OR t.date_validation IS NULL OR t.id_util_val IS NULL) AND t.id_util_val = ?,
														CONCAT('<button onclick=\'valider_ticket(',t.id_tick,')\' class=\'form-control form-control-sm bg-success\'><i class=\'fa fa-check\'></i> Valider</button>'),
														''
													) AS btn_validation,
													IF(t.id_util_debut_trait IS NULL OR t.date_debut_trait IS NULL,
														CONCAT('<span onclick=\'debut_traitement(',t.id_tick,')\' class=\'btn btn-xs form-control form-control-sm bg-success\'>Debuter Traitement</span>'),
														CONCAT('<input type=\"datetime-local\" value=\'',t.date_debut_trait,'\' class=\'form-control form-control-sm\' disabled>')
													) AS btn_debut_trait,
													IF(t.id_util_debut_trait IS NULL OR t.date_debut_trait IS NULL,
														'',
														IF(t.id_util_fin_trait IS NULL OR t.date_fin_trait IS NULL,
															CONCAT('<span onclick=\'fin_traitement(',t.id_tick,')\' class=\'btn btn-xs form-control form-control-sm bg-success\'>Cloturer Traitement</span>'),
														CONCAT('<input type=\"datetime-local\" value=\'',t.date_fin_trait,'\' class=\'form-control form-control-sm\' disabled>')
														)
													) AS btn_fin_trait
 												FROM ticket t, priorite prio, statut_ticket st, module, utilisateur u
												WHERE t.id_util_emet = u.id_util
													AND t.id_prio = prio.id_prio
													AND t.id_stat = st.id_stat
													AND t.id_mod = module.id_mod
													AND t.id_tick = ?
												ORDER BY t.id_tick DESC");
			$requete-> execute(array($_SESSION['id_util'], $entree['id_tick']));
			$reponse = $requete-> fetch();
			$reponse['nom_util_val'] = $this-> getUtilisateur($reponse['id_util_val'])['nom_util'];
			if (isset($this-> getUtilisateur($reponse['id_util_debut_trait'])['nom_util'])) {
				$reponse['nom_util_debut_trait'] = $this-> getUtilisateur($reponse['id_util_debut_trait'])['nom_util'];
			}else{
				$reponse['nom_util_debut_trait'] = NULL;
			}
			
			if (isset($this-> getUtilisateur($reponse['id_util_fin_trait'])['nom_util'])) {
				$reponse['nom_util_fin_trait'] = $this-> getUtilisateur($reponse['id_util_fin_trait'])['nom_util'];
			}else{
				$reponse['nom_util_fin_trait'] = NULL;
			}
			
			return $reponse;

		}

		public function afficherStatutDossierRisqueDossierAjax($id_cli, $id_mod_lic, $statut){
			include("connexion.php");
			
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$sqlStatus= '';

			if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/AV/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888  AND d.date_assurance IS NULL  AND d.id_cli <> 883 
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/AV')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888  AND d.date_assurance IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL
								AND YEAR(d.date_creat_dos) > 2021  AND d.id_cli <> 883 ';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD')) {

				// $sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NOT NULL';
				$sqlStatus = ' AND d.ad_date IS NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AV/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888  AND d.date_assurance IS NULL
								AND YEAR(d.date_creat_dos) > 2021 AND d.id_cli <> 883 ';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AV')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888  AND d.date_assurance IS NOT NULL';
				$sqlStatus = ' AND d.date_av IS NULL AND d.id_cli <> 888  
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING INSURANCE')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';
				$sqlStatus = ' AND d.date_assurance IS NULL AND d.id_cli <> 883 
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING BAE')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';
				$sqlStatus = ' AND d.bae_date IS NULL
								AND d.date_quit IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING BS')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';
				$sqlStatus = ' AND d.bs_date IS NULL
								AND d.date_quit IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='En attente Liquidation')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';
				$sqlStatus = " AND (d.ref_decl IS NOT NULL AND TRIM(d.ref_decl)<>'')
								AND d.date_decl IS NOT NULL
								AND (d.ref_liq IS NULL OR TRIM(d.ref_liq)='')
								AND d.date_liq IS NULL
								AND YEAR(d.date_creat_dos) > 2021";

			}else if (isset($statut) && ($statut != '') && ($statut=='En attente Quittance')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';
				$sqlStatus = " AND (d.ref_liq IS NOT NULL AND TRIM(d.ref_liq)<>'')
								AND d.date_liq IS NOT NULL
								AND d.date_quit IS NULL
								AND (d.ref_quit IS NULL OR TRIM(d.ref_quit)='')";

			}

			$compteur = 0;

			if ($id_mod_lic==2) {
				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													-- DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos,
													DATE_FORMAT(d.date_av, '%d/%m/%Y') AS date_av,
													DATE_FORMAT(d.ad_date, '%d/%m/%Y') AS ad_date,
													DATE_FORMAT(d.date_assurance, '%d/%m/%Y') AS date_assurance,
													-- DATEDIFF(CURRENT_DATE(), d.date_preal) AS delai_preal,
													-- cl.nom_cli AS nom_cli,
													-- d.commodity AS commodity,
													-- d.horse AS horse,
													-- d.trailer_1 AS trailer_1,
													-- d.trailer_2 AS trailer_2,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_quit AS ref_quit,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
													-- DATE_FORMAT(d.ad_date, '%d/%m/%Y') AS ad_date,
													-- DATE_FORMAT(d.date_av, '%d/%m/%Y') AS date_av,
													-- DATE_FORMAT(d.date_assurance, '%d/%m/%Y') AS date_assurance,
													-- IF(d.id_mod_lic='2',
													-- 	IF(d.site_arriv IS NOT NULL,
													-- 		'AT SITE',
													-- 		IF(d.wiski_dep IS NOT NULL,
													-- 			'ON THE WAY TO SITE',
													-- 			IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
													-- 				'AT KLSA',
													-- 				IF(d.arrival_date IS NOT NULL,
													-- 					'ARRIVED AT DRC','OUT OF DRC')
													-- 				)
													-- 			)
													-- 		)
													-- 	,
													-- 	IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
													-- 		'OUT OF DRC',
													-- 		IF(d.site_dep IS NOT NULL,
													-- 			'ON THE WAY TO THE BORDER',
													-- 			'AT SITE'
													-- 			)
													-- 		)
													-- 	) AS location
												FROM dossier d, client cl
												WHERE d.id_cli = cl.id_cli
													AND d.id_mod_lic = ?
													$sqlClient
													$sqlStatus
												ORDER BY id_dos DESC");
			}else{
				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lot AS num_lot,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_quit AS ref_quit,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
													-- DATE_FORMAT(d.ad_date, '%d/%m/%Y') AS ad_date,
													-- DATE_FORMAT(d.date_av, '%d/%m/%Y') AS date_av,
													-- DATE_FORMAT(d.date_assurance, '%d/%m/%Y') AS date_assurance,
													-- IF(d.id_mod_lic='2',
													-- 	IF(d.site_arriv IS NOT NULL,
													-- 		'AT SITE',
													-- 		IF(d.wiski_dep IS NOT NULL,
													-- 			'ON THE WAY TO SITE',
													-- 			IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
													-- 				'AT KLSA',
													-- 				IF(d.arrival_date IS NOT NULL,
													-- 					'ARRIVED AT DRC','OUT OF DRC')
													-- 				)
													-- 			)
													-- 		)
													-- 	,
													-- 	IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
													-- 		'OUT OF DRC',
													-- 		IF(d.site_dep IS NOT NULL,
													-- 			'ON THE WAY TO THE BORDER',
													-- 			'AT SITE'
													-- 			)
													-- 		)
													-- 	) AS location
												FROM dossier d, client cl
												WHERE d.id_cli = cl.id_cli
													AND d.id_mod_lic = ?
													$sqlClient
													$sqlStatus
												ORDER BY id_dos DESC");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherDossierArchivageAjax($id_mod_lic, $id_cli){
			include("connexion.php");
			
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$compteur = 0;
			$rows = array();

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.code_cli AS code_cli,
												d.ref_decl AS ref_decl,
												DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
												d.ref_liq AS ref_liq,
												DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
												d.ref_quit AS ref_quit,
												DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
												CONCAT('<button title=\"Documents Joints\" onclick=\"window.open(\'popArchivageDossier.php?id_dos=',d.id_dos,'&ref_dos=',d.ref_dos,'&id_mod_trac=',d.id_mod_lic,'\',\'pop1\',\'width=1100,height=900\');\">
														<i class=\"fa fa-folder-open\"></i>
													</button>') AS btn_archive
											FROM dossier d, client cl
											WHERE d.id_cli = cl.id_cli
												AND d.id_mod_lic = ?
												AND d.id_cli = ?
											ORDER BY id_dos DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function master_transmis_apurement_backUp18_01_2024($id_mod_lic, $id_cli){
			include("connexion.php");
			
			$entree['id_mod_lic'] = $id_mod_lic;


			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND tr.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$compteur = 0;
			$rows = array();

			$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
														COUNT(DISTINCT(d.num_lic)) AS nbre_lic,
														COUNT(DISTINCT(d.id_dos)) AS nbre_dos,
														UPPER(cl.nom_cli) AS nom_cli,
														tr.ref_trans_ap AS ref_trans_ap,
														tr.id_trans_ap AS id_trans_ap,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
														UPPER(tr.banque) AS banque,
														tr.fichier_trans_ap AS fichier_trans_ap,
														IF(tr.fichier_trans_ap IS NOT NULL,
															CONCAT('<button class=\"btn btn-sm bg bg-info square-btn-adjust\" onclick=\"window.open(\'../transmision_apurements/',tr.id_trans_ap,'/',tr.fichier_trans_ap,'\',\'pop15\',\'width=1900,height=900\');\">
												                    <i class=\"fas fa-file\"></i> Accusée de réception
												                </button>'),
															NULL
															) AS fichier
													FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
													WHERE d.id_mod_lic = ?
														$sqlClient
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = tr.id_trans_ap
														AND tr.id_cli = cl.id_cli
													GROUP BY tr.id_trans_ap 
													ORDER BY tr.id_trans_ap DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function master_transmis_apurement($id_mod_lic, $id_cli, $num_lic, $date_quit_debut, $date_quit_fin){
			include("connexion.php");
			
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				// $sqlClient = ' AND d.id_cli = "'.$id_cli.'"';

				$sqlClient = ' AND (dos.id_cli = "'.$id_cli.'" 
									OR SUBSTRING(dos.num_lic, 1, 10) IN (
											SELECT SUBSTRING(num_lic, 1, 10)
												FROM licence
												WHERE id_cli = "'.$id_cli.'"
										)
								)';
				$sqlClient2 = '';
				// $sqlClient2 = 'OR num_lic IN (
				// 						SELECT num_lic
				// 							FROM licence 
				// 							WHERE id_cli = "'.$id_cli.'"
				// 					)
				// 				';
			}else{
				$sqlClient = '';
				$sqlClient2 = "";
			}

			$sqlQuittance = '';

			if (isset($date_quit_debut) && ($date_quit_debut != '')) {
				$sqlQuittance = ' AND (dos.date_quit BETWEEN "'.$date_quit_debut.'" AND "'.$date_quit_fin.'")';
			}

			$sqlLicence = '';
			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
			}

			$compteur = 0;
			$rows = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													md.num_lic AS num_lic,
													tr.ref_trans_ap AS ref_trans_ap,
													IF(lic.num_lic IS NOT NULL,
														lic.num_lic,
														md.num_lic
													) AS num_lic,
													-- exp.date_exp AS date_exp,
													(IF(lic.fob IS NULL, 0, lic.fob) +IF(lic.fret IS NULL, 0, lic.fret)+IF(lic.assurance IS NULL, 0, lic.assurance)+IF(lic.autre_frais IS NULL, 0, lic.autre_frais)) AS cif_lic,
													lic.fob AS fob_lic,
													mon.sig_mon AS sig_mon,
													md.num_av AS num_av,
													md.poids AS poids,
													md.ref_fact AS ref_fact,
													md.fob AS fob,
													dos.fret AS fret,
													dos.assurance AS assurance,
													dos.autre_frais AS autre_frais,
													(IF(md.fob IS NULL, 0, md.fob) +IF(dos.fret IS NULL, 0, dos.fret)+IF(dos.assurance IS NULL, 0, dos.assurance)+IF(dos.autre_frais IS NULL, 0, dos.autre_frais)) AS cif_dos,
													dos.road_manif AS road_manif,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													CONCAT(
														IF(dos.fichier_apurement IS NOT NULL,
															CONCAT('
																<button class=\"btn btn-xs btn-dark square-btn-adjust\" title=\"Liasse documentaire\" onclick=\"window.open(\'../attch/',dos.fichier_apurement,'\',\'',dos.ref_dos,'\',\'width=1900,height=900\');\">
												                    <i class=\"fas fa-paperclip\"></i>
												                </button>'),
															''
														),
														IF(tr.fichier_trans_ap IS NOT NULL,
															CONCAT('<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"window.open(\'../transmision_apurements/',tr.id_trans_ap,'/',tr.fichier_trans_ap,'\',\'Fichier Transmit\',\'width=1300,height=700\');\">
																	<button class=\"btn btn-xs bg bg-primary\"><i class=\'fa fa-file\'></i> A/R</button>
																</a>'),
															''
														)
													) AS btn_fichier
												FROM dossier dos
													LEFT JOIN detail_apurement det
														ON det.id_dos = dos.id_dos
													LEFT JOIN transmission_apurement tr
														ON det.id_trans_ap = tr.id_trans_ap
													LEFT JOIN marchandise_dossier md
														ON md.id_dos = dos.id_dos
													LEFT JOIN licence lic
														ON SUBSTRING(lic.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
															$sqlLicence
													LEFT JOIN monnaie mon
														ON lic.id_mon = mon.id_mon
												WHERE dos.id_mod_lic = ?
													$sqlClient
													$sqlQuittance
													AND dos.not_apurement = '0'");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['date_exp'] = $this-> getDateExpirationLicence($reponse['num_lic']);
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function master_transmis_apurement_client($id_mod_lic, $id_cli){
			include("connexion.php");
			
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			// $sqlQuittance = '';

			// if (isset($date_quit_debut) && ($date_quit_debut != '')) {
			// 	$sqlQuittance = ' AND (dos.date_quit BETWEEN "'.$date_quit_debut.'" AND "'.$date_quit_fin.'")';
			// }

			// $sqlLicence = '';
			// if (isset($num_lic) && ($num_lic != '')) {
			// 	$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
			// }

			$compteur = 0;
			$rows = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													md.num_lic AS num_lic,
													tr.ref_trans_ap AS ref_trans_ap,
													IF(lic.num_lic IS NOT NULL,
														lic.num_lic,
														md.num_lic
													) AS num_lic,
													-- exp.date_exp AS date_exp,
													(IF(lic.fob IS NULL, 0, lic.fob) +IF(lic.fret IS NULL, 0, lic.fret)+IF(lic.assurance IS NULL, 0, lic.assurance)+IF(lic.autre_frais IS NULL, 0, lic.autre_frais)) AS cif_lic,
													lic.fob AS fob_lic,
													mon.sig_mon AS sig_mon,
													md.num_av AS num_av,
													md.poids AS poids,
													md.ref_fact AS ref_fact,
													md.fob AS fob,
													dos.fret AS fret,
													dos.assurance AS assurance,
													dos.autre_frais AS autre_frais,
													(IF(md.fob IS NULL, 0, md.fob) +IF(dos.fret IS NULL, 0, dos.fret)+IF(dos.assurance IS NULL, 0, dos.assurance)+IF(dos.autre_frais IS NULL, 0, dos.autre_frais)) AS cif_dos,
													dos.road_manif AS road_manif,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													CONCAT(
														IF(dos.fichier_apurement IS NOT NULL,
															CONCAT('
																<button class=\"btn btn-xs btn-primary square-btn-adjust\" title=\"Liasse documentaire\" onclick=\"window.open(\'../attch/',dos.fichier_apurement,'\',\'',dos.ref_dos,'\',\'width=1900,height=900\');\">
												                    <i class=\"fas fa-paperclip\"></i>
												                </button>'),
															''
														),
														IF(tr.fichier_trans_ap IS NOT NULL,
															CONCAT('<a title=\"Visualiser les détails\" href=\"#\" style=\"color: black;\" onclick=\"window.open(\'../transmision_apurements/',tr.id_trans_ap,'/',tr.fichier_trans_ap,'\',\'Fichier Transmit\',\'width=1300,height=700\');\">
																	<button class=\"btn btn-xs bg bg-primary\"><i class=\'fa fa-file\'></i> A/R</button>
																</a>'),
															''
														)
													) AS btn_fichier
												FROM transmission_apurement tr
													LEFT JOIN detail_apurement det
														ON det.id_trans_ap = tr.id_trans_ap
													LEFT JOIN dossier dos
														ON det.id_dos = dos.id_dos
													LEFT JOIN marchandise_dossier md
														ON md.id_dos = dos.id_dos
													LEFT JOIN licence lic
														ON SUBSTRING(lic.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
													LEFT JOIN monnaie mon
														ON lic.id_mon = mon.id_mon
												WHERE tr.id_mod_lic = ?
													AND tr.id_cli = ?
													AND (tr.fichier_trans_ap IS NOT NULL OR tr.date_envoi IS NOT NULL)");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['date_exp'] = $this-> getDateExpirationLicence($reponse['num_lic']);
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function advancedModificationInvoice($ref_fact){
			include("connexion.php");
			
			$entree['ref_fact'] = $ref_fact;

			$compteur = 0;
			$rows = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													dos.id_dos AS id_dos,
													deb.nom_deb AS nom_deb,
													deb.id_deb AS id_deb,
													det.montant AS montant,
													det.usd AS usd,
													det.tva AS tva,
													IF(det.usd='1',
														'USD',
														'CDF'
													) AS monnaie,
													CONCAT('<span class=\'btn btn-xs btn-warning\' onclick=\'modal_advance_modification(',dos.id_dos,', \"',det.ref_fact,'\", ',det.id_deb,', ',det.montant,', ',det.usd,', ',det.tva,')\'><i class=\'fa fa-edit\'></i></span>') AS btn_action
												FROM dossier dos, detail_facture_dossier det, debours deb
												WHERE dos.id_dos = det.id_dos
													AND det.id_deb = deb.id_deb
													AND det.ref_fact  = ?
												ORDER BY dos.id_dos, deb.id_t_deb, deb.nom_deb");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherLicenceEnAttenteFacture($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_t_trans'] = $id_t_trans;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$ref_fact = $this-> buildRefFactureGlobale($id_cli);
			$requete = $connexion-> prepare("SELECT licence.*,
													DATE_FORMAT(licence.date_val, '%d/%m/%Y') AS date_val,
													DATE_FORMAT(MAX(expiration_licence.date_exp), '%d/%m/%Y') AS date_exp,
													IF(licence.id_march IS NOT NULL,
														marchandise.nom_march,
														licence.commodity) AS commodity,
													REPLACE(REPLACE(REPLACE(licence.num_lic, ' ', ''), '-', ''), '/', '') AS num_lic_2
												FROM licence
												LEFT JOIN expiration_licence
													ON expiration_licence.num_lic = licence.num_lic
												LEFT JOIN marchandise
													ON marchandise.id_march = licence.id_march
												WHERE licence.id_mod_lic = ?
													AND licence.id_cli = ?
													AND licence.num_lic NOT IN (
															SELECT num_lic 
																FROM detail_facture_licence
														)
													AND licence.not_fact = '0'
												GROUP BY licence.num_lic");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include("modalFactureLicence.php");
				
			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: left;" class="bg bg-dark">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<button data-toggle="modal" data-target=".facture_<?php echo $reponse['num_lic_2'];?>" class="btn-xs btn btn-secondary">
						<i class="fa fa-calculator"></i>
					</button>

				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_val'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_exp'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['fret'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['assurance'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format(($reponse['fob']+$reponse['assurance']+$reponse['fret']+$reponse['autre_frais']), 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function getEmailsTraiteurTicket($mail){
			include("connexion.php");
			$adresse = '';

			$requete = $connexion-> query("SELECT adresse_mail FROM utilisateur WHERE traitement_ticket = '1'");
			// $requete-> execute(array($entree['delay']));
			while($reponse = $requete-> fetch()){
				// $adresse.= '$mail->addAddress('.$reponse['adresse_mail'].')';
				$mail->addAddress($reponse['adresse_mail']);
			}$requete-> closeCursor();
			
			// return $adresse;

			

		}

		public function getNombreMonoImportEnAttenteIM4Delay($delay){
			include("connexion.php");
			$entree['delay'] = $delay;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_march <> '11'
													AND ref_decl IS NULL
													AND date_decl IS NULL
													AND id_mod_lic = 2
													AND DATEDIFF(CURRENT_DATE(), date_preal) > ?");
			$requete-> execute(array($entree['delay']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function afficherMonoImportEnAttenteIM4Delay($delay){
			include("connexion.php");
			$entree['delay'] = $delay;
			$compteur = 0;
			$tableau = '';

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.code_cli, 
													d.commodity AS commodity, 
													d.remarque AS remarque, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS delay
												FROM dossier d, client cl
												WHERE d.id_march <> '11'
													AND d.id_cli = cl.id_cli
													AND d.ref_decl IS NULL
													AND d.date_decl IS NULL
													AND d.id_mod_lic = 2
													AND DATEDIFF(CURRENT_DATE(), d.date_preal) > ?");
			$requete-> execute(array($entree['delay']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['ref_dos'].'</td>
								<td>'.$reponse['code_cli'].'</td>
								<td>'.$reponse['commodity'].'</td>
								<td>'.$reponse['date_preal'].'</td>
								<td>'.$reponse['delay'].'</td>
								<td>'.$reponse['remarque'].'</td>
							</tr>';
			}$requete-> closeCursor();
			return $tableau;

		}

		public function getNombreDiversImportEnAttenteIM4Delay($delay){
			include("connexion.php");
			$entree['delay'] = $delay;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_march = '11'
													AND ref_decl IS NULL
													AND date_decl IS NULL
													AND id_mod_lic = 2
													AND DATEDIFF(CURRENT_DATE(), date_preal) > ?");
			$requete-> execute(array($entree['delay']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function afficherDiversImportEnAttenteIM4Delay($delay){
			include("connexion.php");
			$entree['delay'] = $delay;
			$compteur = 0;
			$tableau = '';

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.code_cli, 
													d.commodity AS commodity, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS delay
												FROM dossier d, client cl
												WHERE d.id_march = '11'
													AND d.id_cli = cl.id_cli
													AND d.ref_decl IS NULL
													AND d.date_decl IS NULL
													AND d.id_mod_lic = 2
													AND DATEDIFF(CURRENT_DATE(), d.date_preal) > ?");
			$requete-> execute(array($entree['delay']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['ref_dos'].'</td>
								<td>'.$reponse['code_cli'].'</td>
								<td>'.$reponse['commodity'].'</td>
								<td>'.$reponse['date_preal'].'</td>
								<td>'.$reponse['delay'].'</td>
							</tr>';
			}$requete-> closeCursor();
			return $tableau;

		}

		public function afficherDiversImportEnAttenteIM4Delay2($delay){
			include("connexion.php");
			$entree['delay'] = $delay;
			$compteur = 0;
			$tableau = '';

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.code_cli, 
													d.commodity AS commodity, 
													d.remarque AS remarque, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS delay
												FROM dossier d, client cl
												WHERE d.id_march = '11'
													AND d.id_cli = cl.id_cli
													AND d.ref_decl IS NULL
													AND d.date_decl IS NULL
													AND d.id_mod_lic = 2
													AND DATEDIFF(CURRENT_DATE(), d.date_preal) > ?");
			$requete-> execute(array($entree['delay']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['ref_dos'].'</td>
								<td>'.$reponse['code_cli'].'</td>
								<td>'.$reponse['delay'].'</td>
								<td>'.$reponse['remarque'].'</td>
							</tr>';
			}$requete-> closeCursor();
			return $tableau;

		}

		public function getNombreDossierExportEnAttenteEX1Delay($delay){
			include("connexion.php");
			$entree['delay'] = $delay;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE ref_decl IS NULL
													AND date_decl IS NULL
													AND id_mod_lic = 1
													AND id_mod_trans <> 6
													AND id_mod_trans <> 27
													AND ref_dos <> 'TEST'
													AND DATEDIFF(CURRENT_DATE(), date_preal) > ?");
			$requete-> execute(array($entree['delay']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function afficherDossierExportEnAttenteEX1Delay($delay){
			include("connexion.php");
			$entree['delay'] = $delay;
			$compteur = 0;
			$tableau = '';
 
			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.code_cli, 
													d.commodity AS commodity, 
													d.remarque AS remarque, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS delay
												FROM dossier d, client cl
												WHERE d.id_cli = cl.id_cli
													AND d.ref_decl IS NULL
													AND d.date_decl IS NULL
													AND d.id_mod_lic = 1
													AND d.id_mod_trans <> 6
													AND d.id_mod_trans <> 27
													AND d.ref_dos <> 'TEST'
													AND DATEDIFF(CURRENT_DATE(), d.date_preal) > ?");
			$requete-> execute(array($entree['delay']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['ref_dos'].'</td>
								<td>'.$reponse['code_cli'].'</td>
								<td>'.$reponse['commodity'].'</td>
								<td>'.$reponse['date_preal'].'</td>
								<td>'.$reponse['delay'].'</td>
								<td>'.$reponse['remarque'].'</td>
							</tr>';
			}$requete-> closeCursor();
			return $tableau;

		}

		public function afficherTableauCoteur($debut=NULL, $fin=NULL, $id_util=NULL, $id_cli=NULL){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$compteur=0;
			$sqlUtilisateur = '';

			// if (!empty($id_util) && $id_util!='') {
			// 	$sqlUtilisateur = ' AND (d.id_util_verif_feuil_calc = '.$id_util.' OR d.id_util_feuil_calc = '.$id_util.')';
			// }

			if (!empty($id_util) && $id_util!='') {
				$sqlUtilisateur = ' AND u.id_util = '.$id_util;
			}


			$tableau = '';

			$requete = $connexion-> query("SELECT u.nom_util AS nom_util, u.id_util AS id_util
												FROM utilisateur u, dossier d
												WHERE (d.id_util_feuil_calc = u.id_util
														OR d.id_util_verif_feuil_calc = u.id_util)
													AND d.not_cotation = '0'
													AND u.id_util <> 1
													$sqlUtilisateur
												GROUP BY u.id_util
												ORDER BY u.nom_util");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['nom_util'].'</td>
								<td style="text-align: center;">'.$this-> nbreDossierCotationUtilisateur($reponse['id_util'], $debut, $fin, $id_cli).'</td>
								<td style="text-align: center;">'.$this-> nbreDossierCotationValideeUtilisateur($reponse['id_util'], $debut, $fin, $id_cli).'</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function getPVContentieux(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT bur.nom_bur_douane AS nom_bur_douane,
												pv.ref_pv AS ref_pv,
												DATE_FORMAT(pv.date_pv, '%d/%m/%Y') AS date_pv,
												DATE_FORMAT(pv.date_reception, '%d/%m/%Y') AS date_reception,
												pv.annee AS annee,
												client.nom_cli AS nom_cli,
												ml.nom_mod_lic AS nom_mod_lic,
												pv.marchandise AS marchandise,
												pv.observ_verb AS observ_verb,
												pv.argument_dec AS argument_dec,
												pv.risque_reel AS risque_reel,
												pv.action_en_cours AS action_en_cours,
												pv.remarque AS remarque,
												pv.fichier_pv AS fichier_pv,
												pv.id_pv AS id_pv,
												etat_pv.nom_etat AS nom_etat,
												REPLACE(pv.ref_pv, '/', '_') AS ref_pv_2,
												pv.infraction AS infraction,
												pv.droit_cdf AS droit_cdf,
												pv.droit_usd AS droit_usd,
												pv.amende_cdf AS amende_cdf,
												pv.amende_usd AS amende_usd,
												pv.risque_potentiel AS risque_potentiel
											FROM pv_contencieux pv, bureau_douane bur, client, modele_licence ml, etat_pv
											WHERE pv.id_bur_douane = bur.id_bur_douane
												AND pv.id_cli = client.id_cli
												AND pv.id_mod_lic = ml.id_mod_lic
												AND pv.id_etat = etat_pv.id_etat");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>
									'.$reponse['ref_pv'].'
									<a href="#" onclick="window.open(\'../pv/'.$reponse['ref_pv_2'].'/'.$reponse['fichier_pv'].'\',\'pop5\',\'width=900,height=500\');">
										<img src="../images/dossier (1).png" width="20px">
									</a>
									<a href="#" onclick="modalModificationPV('.$reponse['id_pv'].');;">
										<img src="../images/crayon.png" width="20px">
									</a>
								</td>
								<td>'.$reponse['nom_bur_douane'].'</td>
								<td>'.$reponse['date_pv'].'</td>
								<td>'.$reponse['date_reception'].'</td>
								<td>
									<a href="#" onclick="modal_actePV('.$reponse['id_pv'].');;">
										<img src="../images/presse-papiers.png" width="20px">
									</a>
									'.$this-> getDernierActePV($reponse['id_pv'])['detail_act'].'</td>
								<td>'.$reponse['annee'].'</td>
								<td>'.$reponse['nom_cli'].'</td>
								<td>'.$reponse['nom_mod_lic'].'</td>
								<td>'.$reponse['marchandise'].'</td>
								<td>'.$reponse['infraction'].'</td>
								<td style="text-align: right;">'.number_format($reponse['droit_cdf'], 2, ',', ' ').'</td>
								<td style="text-align: right;">'.number_format($reponse['droit_usd'], 2, ',', ' ').'</td>
								<td style="text-align: right;">'.number_format($reponse['amende_cdf'], 2, ',', ' ').'</td>
								<td style="text-align: right;">'.number_format($reponse['amende_usd'], 2, ',', ' ').'</td>
								<td>'.$reponse['risque_potentiel'].'</td>
								<td>'.$reponse['observ_verb'].'</td>
								<td>'.$reponse['argument_dec'].'</td>
								<td>'.$reponse['risque_reel'].'</td>
								<td>'.$reponse['action_en_cours'].'</td>
								<td>'.$reponse['remarque'].'</td>
								<td>'.$reponse['nom_etat'].'</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function getDataPVContentieux($id_pv){
			include("connexion.php");
			$entree['id_pv'] = $id_pv;
			$select = '';


			$requete = $connexion-> prepare("SELECT *,
												REPLACE(pv.ref_pv, '/', '_') AS ref_pv_2
											FROM pv_contencieux pv, bureau_douane bur, client, modele_licence ml, etat_pv
											WHERE pv.id_bur_douane = bur.id_bur_douane
												AND pv.id_cli = client.id_cli
												AND pv.id_mod_lic = ml.id_mod_lic
												AND pv.id_etat = etat_pv.id_etat
												AND pv.id_pv = ?");
			$requete-> execute(array($entree['id_pv']));
			$reponse = $requete-> fetch();
			$select = '<select name="id_bur_douane_edit" id="id_bur_douane_edit" class="form-control cc-exp" required><option value="'.$reponse['id_bur_douane'].'">'.$reponse['nom_bur_douane'].'</option><option></option>'.$this->selectionnerBureauDouaneAjax().'</select>';
			$reponse['select_id_bur'] = $select;
			return $reponse;

		}

		public function tableau_acte_pv($id_pv){
			include("connexion.php");
			$entree['id_pv'] = $id_pv;
			$compteur=0;

			$tableau = '<tr>
							<td></td>
							<td><input class="form-control-sm form-control" type="date" id="date_act"></td>
							<td><input class="form-control-sm form-control" type="text" id="detail_act"></td>
							<td><button class="btn btn-xs btn-primary" onclick="ajouterActePV(date_act.value, detail_act.value, id_pv_acte.value);"><i class="fa fa-check"></i> Inserer</button></td>
						</tr>';

			$requete = $connexion-> prepare("SELECT *
											FROM pv_contencieux pv, acte_pv
											WHERE pv.id_pv = acte_pv.id_pv
												AND pv.id_pv = ?
											ORDER BY acte_pv.id_act DESC");
			$requete-> execute(array($entree['id_pv']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['date_act'].'</td>
								<td>'.$reponse['detail_act'].'</td>
								<td>
									<button class="btn-xs btn-danger" onclick="supprimerActePV('.$reponse['id_act'].');">
										<span class="fa fa-times"></span>
									</button>
								</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function getDernierActePV($id_pv){
			include("connexion.php");
			$entree['id_pv'] = $id_pv;
			$select = '';


			$requete = $connexion-> prepare("SELECT *
												FROM acte_pv
												WHERE id_pv = ?
												ORDER BY id_act DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_pv']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse;
			}else{
				$reponse['detail_act']=null;
				return $reponse;
			}
			

		}

		public function selectionnerAgentCoteur(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT u.nom_util AS nom_util, u.id_util AS id_util
												FROM utilisateur u, dossier d
												WHERE (d.id_util_feuil_calc = u.id_util
														OR d.id_util_verif_feuil_calc = u.id_util)
													AND d.not_cotation = '0'
													AND u.id_util <> 1
												GROUP BY u.id_util
												ORDER BY u.nom_util");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				?>
				<option value="<?php echo $reponse['id_util'];?>">
					<?php echo $reponse['nom_util'];?>
				</option>
				<?php
			}$requete-> closeCursor();

		}

		public function selectionnerClientCoteur(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT cl.nom_cli AS nom_cli, cl.id_cli AS id_cli
												FROM client cl, dossier d
												WHERE d.id_cli = cl.id_cli
													AND d.not_cotation = '0'
												GROUP BY cl.id_cli
												ORDER BY cl.nom_cli");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				?>
				<option value="<?php echo $reponse['id_cli'];?>">
					<?php echo $reponse['nom_cli'];?>
				</option>
				<?php
			}$requete-> closeCursor();

		}

		public function nbreDossierCotationUtilisateur($id_util, $debut=NULL, $fin=NULL, $id_cli=NULL){
			include('connexion.php');
			$entree['id_util'] = $id_util;
			$sqlTemp = '';
			$sqlClient = '';

			if (!empty($debut) && $debut!='' && !empty($fin) && $fin!='') {
				$sqlTemp = ' AND (date_feuil_calc BETWEEN "'.$debut.'" AND "'.$fin.'")';
			}

			if (!empty($id_cli) && $id_cli!='') {
				$sqlClient = ' AND id_cli = '.$id_cli;
			}


			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE not_cotation = '0'
												AND etat_feuil_calc = '1'
												AND id_util_feuil_calc = ?
												AND date_feuil_calc IS NOT NULL
												$sqlTemp
												$sqlClient");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierCotationValideeUtilisateur($id_util, $debut=NULL, $fin=NULL, $id_cli=NULL){
			include('connexion.php');
			$entree['id_util'] = $id_util; 
			$sqlTemp = '';
			$sqlClient = '';

			if (!empty($debut) && $debut!='' && !empty($fin) && $fin!='') {
				$sqlTemp = ' AND (date_feuil_calc BETWEEN "'.$debut.'" AND "'.$fin.'")';
			}

			if (!empty($id_cli) && $id_cli!='') {
				$sqlClient = ' AND id_cli = '.$id_cli;
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE not_cotation = '0'
												AND etat_feuil_calc = '1'
												AND id_util_verif_feuil_calc = ?
												AND date_feuil_calc IS NOT NULL
												$sqlTemp
												$sqlClient");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function afficherDossierFactureGlobale($id_cli, $id_mod_lic, $id_march, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$sqlLimit = '';
			if ($id_march=='13') {
				$sqlLimit = 'LIMIT 0, 8';
			}else if($id_march=='1'){
				$sqlLimit = 'LIMIT 0, 15';
			}
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NOT NULL)
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fd
																WHERE fd.id_t_trans = ?
																	AND fd.ref_fact = det.ref_fact)
													AND not_fact = '0'
													AND id_march = ?
													AND id_mod_trans = ?
												ORDER BY dossier.date_quit, dossier.id_dos ASC
												$sqlLimit");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_lic'], $entree['id_march'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['horse'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['trailer_1'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['trailer_2'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo number_format($reponse['poids_brut'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
				<?php
					$this-> afficherLigneTableauDeboursFactureGlobale($id_march, $reponse['id_dos'], $compteur)
				?>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierFactureGlobaleFrontier($id_cli, $id_mod_lic, $num_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = $num_lic;
			// $entree['num_lic'] = '"%'.substr($num_lic, 0, 10).'%"';
			// $entree['id_mod_trans'] = $id_mod_trans;

			// echo '<br>-------------------------------id_cli = '.$id_cli;
			// echo '<br>-------------------------------id_mod_lic = '.$id_mod_lic;
			// echo '<br>-------------------------------num_lic = '.$num_lic;
			// echo '<br>-------------------------------id_mod_trans = '.$id_mod_trans;
			$sqlLimit = '';
			// if ($num_lic=='13') {
			// 	$sqlLimit = 'LIMIT 0, 8';
			// }else if($num_lic=='1'){
			// 	$sqlLimit = 'LIMIT 0, 15';
			// }
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal,
													round(IF(roe_decl > 0, roe_decl, 1), 3) AS roe_decl,
													((poids*5)/1000) AS lmc
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NOT NULL)
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND not_fact = '0'
													AND num_lic LIKE CONCAT(SUBSTRING(?, 1, 10), '%')
												ORDER BY REPLACE(ref_decl, ' ', '') ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo number_format($reponse['poids_brut'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<?php
					//$montant = $this-> getMontantDeboursClientModeleLicence(27, 1, $id_cli);
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" step="0.0001">
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_droits_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_droits_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_droits_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001">
				</td>
				<?php
					$montant = 0;
					$tva = '0';
					$usd = '0';
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_lse_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_lse_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_lse_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001">
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_comext_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_comext_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_comext_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_nac_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_nac_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_nac_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_occ_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_occ_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_occ_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_cgea_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_cgea_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_cgea_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					if (($this-> getDossier($reponse['id_dos'])['poids']/1000)>'30') {
						$montant = 450; 
					}else{
						$montant = 300; 
					}
					$tva = $this-> getMontantDeboursClientModeleLicence2(37, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(37, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_ceec_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_ceec_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_ceec_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_dgda_seal_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_dgda_seal_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_dgda_seal_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = ($this-> getDossier($reponse['id_dos'])['poids_brut']/1000)*3;
					$tva = $this-> getMontantDeboursClientModeleLicence2(43, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(43, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_fere_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_fere_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_fere_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_lmc_<?php echo $compteur;?>" value="0">
					<input type="hidden" name="usd_lmc_<?php echo $compteur;?>" value="1">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_lmc_<?php echo $compteur;?>" value="<?php echo $reponse['lmc'];?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_carte_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_carte_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_carte_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_op_cost_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_op_cost_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_op_cost_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_agency_fee_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_agency_fee_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_agency_fee_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierFactureGlobaleFrontierVenteLocale($id_cli, $id_mod_lic, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			// $entree['num_lic'] = $num_lic;
			// $entree['num_lic'] = '"%'.substr($num_lic, 0, 10).'%"';
			// $entree['id_mod_trans'] = $id_mod_trans;

			// echo '<br>-------------------------------id_cli = '.$id_cli;
			// echo '<br>-------------------------------id_mod_lic = '.$id_mod_lic;
			// echo '<br>-------------------------------num_lic = '.$num_lic;
			// echo '<br>-------------------------------id_mod_trans = '.$id_mod_trans;
			$sqlLimit = '';
			// if ($num_lic=='13') {
			// 	$sqlLimit = 'LIMIT 0, 8';
			// }else if($num_lic=='1'){
			// 	$sqlLimit = 'LIMIT 0, 15';
			// }
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal,
													round(IF(roe_decl > 0, roe_decl, 1), 3) AS roe_decl
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND not_fact = '0'
													AND id_mod_trans = ?
												ORDER BY REPLACE(ref_dos, ' ', '') ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo number_format($reponse['poids_brut'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<?php
					$montant = 135;
					$tva = 1;
					$usd = 1;
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_op_cost_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_op_cost_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_op_cost_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = 240;
					$tva = 1;
					$usd = 1;
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_agency_fee_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_agency_fee_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_agency_fee_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="checkbox" name="check_<?php echo $compteur;?>">
				</td>
				
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierFactureGlobaleTR8SCM($id_cli, $id_mod_lic, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			// $entree['num_lic'] = $num_lic;
			// $entree['num_lic'] = '"%'.substr($num_lic, 0, 10).'%"';
			// $entree['id_mod_trans'] = $id_mod_trans;

			// echo '<br>-------------------------------id_cli = '.$id_cli;
			// echo '<br>-------------------------------id_mod_lic = '.$id_mod_lic;
			// echo '<br>-------------------------------num_lic = '.$num_lic;
			// echo '<br>-------------------------------id_mod_trans = '.$id_mod_trans;
			$sqlLimit = '';
			// if ($num_lic=='13') {
			// 	$sqlLimit = 'LIMIT 0, 8';
			// }else if($num_lic=='1'){
			// 	$sqlLimit = 'LIMIT 0, 15';
			// }
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													tr8_ref AS tr8_ref,
													DATE_FORMAT(tr8_date, '%d/%m/%Y') AS tr8_date,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													roe_decl AS roe_decl,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal,
													round(IF(roe_decl > 0, roe_decl, 1), 3) AS roe_decl
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND not_fact = '0'
													AND tr8_ref IS NOT NULL
													AND tr8_date IS NOT NULL
													AND id_mod_trans = ?
												ORDER BY REPLACE(ref_dos, ' ', '') ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['horse'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['trailer_1'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['trailer_2'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['tr8_ref'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['tr8_date'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold; text-align: center;" type="number" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" step="0.0001" required>
				</td>
				<?php
					$montant = 0;
					$tva = 0;
					$usd = 0;
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_scelle_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_scelle_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold; text-align: center;" type="number" name="scelle_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = 0;
					$tva = 0;
					$usd = 0;
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_assurance_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_assurance_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold; text-align: center;" type="number" name="assurance_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="checkbox" name="check_<?php echo $compteur;?>">
				</td>
				
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function selectionnerDossierFactureGlobaleTR8SCMAjax($id_cli, $id_mod_lic, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$select = '<select class="form-control cc-exp" id="id_dos" onchange="getDossier(this.value)"><option></option>';

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													tr8_ref AS tr8_ref,
													DATE_FORMAT(tr8_date, '%d/%m/%Y') AS tr8_date,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													roe_decl AS roe_decl,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal,
													round(IF(roe_decl > 0, roe_decl, 1), 3) AS roe_decl
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND not_fact = '0'
													AND tr8_ref IS NOT NULL
													AND tr8_date IS NOT NULL
													AND id_mod_trans = ?
												ORDER BY REPLACE(ref_dos, ' ', '') ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$select .= '<option value="'.$reponse['id_dos'].'">'.$reponse['ref_dos'].'</option>';
			}$requete-> closeCursor();
			
			$select .= '</select>';

			return $select;

		}

		public function selectionnerDossierFactureGlobaleIM4SCMAjax($id_cli, $id_mod_lic, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$select = '<select class="form-control cc-exp" id="id_dos" onchange="getDossier(this.value)"><option></option>';

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													tr8_ref AS tr8_ref,
													DATE_FORMAT(tr8_date, '%d/%m/%Y') AS tr8_date,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													roe_decl AS roe_decl,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal,
													round(IF(roe_decl > 0, roe_decl, 1), 3) AS roe_decl,
													CONCAT(
														IF(horse IS NOT NULL AND REPLACE(horse, ' ', '') NOT LIKE '',
															horse,
															''),
														IF(trailer_1 IS NOT NULL AND REPLACE(trailer_1, ' ', '') NOT LIKE '',
															CONCAT(' / ', trailer_1),
															''),
														IF(trailer_2 IS NOT NULL AND REPLACE(trailer_2, ' ', '') NOT LIKE '',
															CONCAT(' / ', trailer_2),
															'')
													) AS truck
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fd
																WHERE det.ref_fact = fd.ref_fact
																AND fd.id_t_trans = '2'
															)
													AND not_fact = '0'
													AND ref_decl IS NOT NULL
													AND date_decl IS NOT NULL
													AND ref_liq IS NOT NULL
													AND date_liq IS NOT NULL
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$select .= '<option value="'.$reponse['id_dos'].'">'.$reponse['ref_dos'].'</option>';
			}$requete-> closeCursor();
			
			$select .= '</select>';

			return $select;

		}

		public function selectionnerDossierFactureGlobaleIM4Ajax($id_cli, $id_mod_lic, $id_mod_trans){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$select = '<select class="form-control cc-exp" id="id_dos" name="id_dos" onchange="getDossier(this.value)"><option></option>';

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													tr8_ref AS tr8_ref,
													DATE_FORMAT(tr8_date, '%d/%m/%Y') AS tr8_date,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													roe_decl AS roe_decl,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal,
													round(IF(roe_decl > 0, roe_decl, 1), 3) AS roe_decl
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND not_fact = '0'
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
												ORDER BY REPLACE(ref_dos, ' ', '') ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$select .= '<option value="'.$reponse['id_dos'].'">'.$reponse['ref_dos'].'</option>';
			}$requete-> closeCursor();
			
			$select .= '</select>';

			return $select;

		}

		public function selectionnerFactureSCMTR8Ajax($id_cli, $id_mod_lic, $id_t_trans, $validation){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_t_trans'] = $id_t_trans;
			$entree['validation'] = $validation;
			$select = '<select class="form-control cc-exp" id="ref_fact" onchange="afficherDetailFactureTR8Ajax(this.value)"><option></option>';

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM facture_dossier
													WHERE id_mod_lic = ?
														AND id_cli = ?
														AND id_t_trans = ?
														AND validation = ?");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_t_trans'], $entree['validation']));
			while ($reponse = $requete-> fetch()) {
				$select .= '<option value="'.$reponse['ref_fact'].'">'.$reponse['ref_fact'].'</option>';
			}$requete-> closeCursor();
			
			$select .= '</select>';

			return $select;

		}

		public function selectionnerFactureSCMIM4Ajax($id_cli, $id_mod_lic, $id_t_trans, $validation){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_t_trans'] = $id_t_trans;
			$entree['validation'] = $validation;
			$select = '<select class="form-control cc-exp" id="ref_fact" onchange="afficherDetailFactureIM4Ajax(this.value)"><option></option>';

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM facture_dossier
													WHERE id_mod_lic = ?
														AND id_cli = ?
														AND id_t_trans = ?
														AND validation = ?");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_t_trans'], $entree['validation']));
			while ($reponse = $requete-> fetch()) {
				$select .= '<option value="'.$reponse['ref_fact'].'">'.$reponse['ref_fact'].'</option>';
			}$requete-> closeCursor();
			
			$select .= '</select>';

			return $select;

		}

		public function selectionnerFactureRCDAjax($id_cli, $id_mod_lic, $id_t_trans, $validation){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_t_trans'] = $id_t_trans;
			$entree['validation'] = $validation;
			$select = '<select class="form-control cc-exp" id="ref_fact" onchange="afficherDetailFactureRCDAjax(this.value)"><option></option>';

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM facture_dossier
													WHERE id_mod_lic = ?
														AND id_cli = ?
														AND id_t_trans = ?
														AND validation = ?");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_t_trans'], $entree['validation']));
			while ($reponse = $requete-> fetch()) {
				$select .= '<option value="'.$reponse['ref_fact'].'">'.$reponse['ref_fact'].'</option>';
			}$requete-> closeCursor();
			
			$select .= '</select>';

			return $select;

		}

		public function selectionnerFactureSTFAjax($id_cli, $id_mod_lic, $id_t_trans, $validation){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_t_trans'] = $id_t_trans;
			$entree['validation'] = $validation;
			$select = '<select class="form-control cc-exp" id="ref_fact" name="ref_fact" onchange="afficherDetailFactureSTFAjax(this.value)"><option></option>';

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM facture_dossier
													WHERE id_mod_lic = ?
														AND id_cli = ?
														AND id_t_trans = ?
														AND validation = ?");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_t_trans'], $entree['validation']));
			while ($reponse = $requete-> fetch()) {
				$select .= '<option value="'.$reponse['ref_fact'].'">'.$reponse['ref_fact'].'</option>';
			}$requete-> closeCursor();
			
			$select .= '</select>';

			return $select;

		}

		public function afficherDetailFactureTR8Ajax($ref_fact){
			include("connexion.php");
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.tr8_ref AS tr8_ref,
													DATE_FORMAT(d.tr8_date, '%d/%m/%Y') AS tr8_date,
													d.roe_decl AS roe_decl
												FROM detail_facture_dossier det, dossier d
												WHERE det.ref_fact = ?
													AND det.id_dos = d.id_dos
												GROUP BY d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$tbl .= '<tr>
							<td style="text-align: center;">'.$compteur.'</td>
							<td style="text-align: center;">'.$reponse['ref_dos'].'</td>
							<td style="text-align: center;">'.$reponse['horse'].'</td>
							<td style="text-align: center;">'.$reponse['trailer_1'].'</td>
							<td style="text-align: center;">'.$reponse['trailer_2'].'</td>
							<td style="text-align: center;">'.$reponse['tr8_ref'].'</td>
							<td style="text-align: center;">'.$reponse['tr8_date'].'</td>
							<td style="text-align: center;">'.number_format($reponse['roe_decl'], 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 23, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 12, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;"><button class="btn btn-xs btn-danger" onclick="deleteDetailFacture(\''.$ref_fact.'\', '.$reponse['id_dos'].');"><i class="fa fa-times"></i></button></td>
						</tr>';
			}$requete-> closeCursor();

			return $tbl;

		}

		public function afficherDetailFactureIM4Ajax($ref_fact){
			include("connexion.php");
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.tr8_ref AS tr8_ref,
													DATE_FORMAT(d.tr8_date, '%d/%m/%Y') AS tr8_date,
													d.roe_decl AS roe_decl,
													IF(d.ref_decl IS NOT NULL,
														CONCAT(d.ref_decl, ' du ', DATE_FORMAT(d.date_decl, '%d/%m/%Y')),
														NULL
														) AS declaration,
													IF(d.ref_liq IS NOT NULL,
														CONCAT(d.ref_liq, ' du ', DATE_FORMAT(d.date_liq, '%d/%m/%Y')),
														NULL
														) AS liquidation,
													IF(d.ref_quit IS NOT NULL,
														CONCAT(d.ref_quit, ' du ', DATE_FORMAT(d.date_quit, '%d/%m/%Y')),
														NULL
														) AS quittance
												FROM detail_facture_dossier det, dossier d
												WHERE det.ref_fact = ?
													AND det.id_dos = d.id_dos
												GROUP BY d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$tbl .= '<tr>
							<td style="text-align: center;">'.$compteur.'</td>
							<td style="text-align: center;">'.$reponse['ref_dos'].'</td>
							<td style="text-align: center;">'.$reponse['horse'].'</td>
							<td style="text-align: center;">'.$reponse['trailer_1'].'</td>
							<td style="text-align: center;">'.$reponse['trailer_2'].'</td>
							<td style="text-align: center;">'.$reponse['declaration'].'</td>
							<td style="text-align: center;">'.$reponse['liquidation'].'</td>
							<td style="text-align: center;">'.$reponse['quittance'].'</td>
							<td style="text-align: center;">'.number_format($reponse['roe_decl'], 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 12, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;"><button class="btn btn-xs btn-warning" onclick="modal_edit_detail_facture_SICOMINE(\''.$ref_fact.'\', '.$reponse['id_dos'].');"><i class="fa fa-edit"></i></button> <button class="btn btn-xs btn-danger" onclick="deleteDetailFacture(\''.$ref_fact.'\', '.$reponse['id_dos'].');"><i class="fa fa-times"></i></button></td>
						</tr>';
			}$requete-> closeCursor();

			return $tbl;

		}

		public function file_SCM_IM4($ref_fact){
			include("connexion.php");
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.tr8_ref AS tr8_ref,
													DATE_FORMAT(d.tr8_date, '%d/%m/%Y') AS tr8_date,
													d.roe_decl AS roe_decl,
													IF(d.ref_decl IS NOT NULL,
														CONCAT(d.ref_decl, ' du ', DATE_FORMAT(d.date_decl, '%d/%m/%Y')),
														NULL
														) AS declaration,
													IF(d.ref_liq IS NOT NULL,
														CONCAT(d.ref_liq, ' du ', DATE_FORMAT(d.date_liq, '%d/%m/%Y')),
														NULL
														) AS liquidation,
													IF(d.ref_quit IS NOT NULL,
														CONCAT(d.ref_quit, ' du ', DATE_FORMAT(d.date_quit, '%d/%m/%Y')),
														NULL
														) AS quittance
												FROM detail_facture_dossier det, dossier d
												WHERE det.ref_fact = ?
													AND det.id_dos = d.id_dos
												GROUP BY d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$tbl .= '<input type="hidden" id="adr_mail_'.$compteur.'" name="id_dos_'.$compteur.'" value="'.$reponse['id_dos'].'">
						<tr>
							<td style="text-align: center;">'.$compteur.'</td>
							<td style="text-align: left;">'.$reponse['ref_dos'].'</td>
    						<td style="text-align: center;"><input class="" type="checkbox" id="check_'.$compteur.'" name="check_'.$compteur.'" checked></td>
						</tr>';
			}$requete-> closeCursor();

			$tbl .= '<input type="hidden" name="nbre" value="'.$compteur.'">';

			return $tbl;

		}

		public function afficherDetailFactureSTFAjax($ref_fact){
			include("connexion.php");
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.num_lic AS num_lic,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.tr8_ref AS tr8_ref,
													DATE_FORMAT(d.tr8_date, '%d/%m/%Y') AS tr8_date,
													d.roe_decl AS roe_decl,
													IF(d.tr8_ref IS NOT NULL,
														CONCAT(d.tr8_ref, ' du ', DATE_FORMAT(d.tr8_date, '%d/%m/%Y')),
														NULL
														) AS tr8,
													IF(d.ref_decl IS NOT NULL,
														CONCAT(d.ref_decl, ' du ', DATE_FORMAT(d.date_decl, '%d/%m/%Y')),
														NULL
														) AS declaration,
													IF(d.ref_liq IS NOT NULL,
														CONCAT(d.ref_liq, ' du ', DATE_FORMAT(d.date_liq, '%d/%m/%Y')),
														NULL
														) AS liquidation,
													IF(d.ref_quit IS NOT NULL,
														CONCAT(d.ref_quit, ' du ', DATE_FORMAT(d.date_quit, '%d/%m/%Y')),
														NULL
														) AS quittance
												FROM detail_facture_dossier det, dossier d
												WHERE det.ref_fact = ?
													AND det.id_dos = d.id_dos
												GROUP BY d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$tbl .= '<tr>
							<td style="text-align: center;">'.$compteur.'</td>
							<td style="text-align: center;">'.$reponse['ref_dos'].'</td>
							<td style="text-align: center;">'.$reponse['num_lic'].'</td>
							<td style="text-align: center;">'.$reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'].'</td>
							<td style="text-align: center;">'.$reponse['tr8'].'</td>
							<td style="text-align: center;">'.$reponse['declaration'].'</td>
							<td style="text-align: center;">'.number_format($reponse['roe_decl'], 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 16, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 106, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 23, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 26, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 34, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 63, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;"><button class="btn btn-xs btn-warning" onclick="modalDetailFactureSTF(\''.$ref_fact.'\', '.$reponse['id_dos'].');"><i class="fa fa-edit"></i></button></td>
							<td style="text-align: center;"><button class="btn btn-xs btn-danger" onclick="deleteDetailFacture(\''.$ref_fact.'\', '.$reponse['id_dos'].');"><i class="fa fa-times"></i></button></td>
						</tr>';
			}$requete-> closeCursor();

			return $tbl;

		}

		public function afficherDetailFactureSTFAjaxAir($ref_fact){
			include("connexion.php");
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.num_lic AS num_lic,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.tr8_ref AS tr8_ref,
													DATE_FORMAT(d.tr8_date, '%d/%m/%Y') AS tr8_date,
													d.roe_decl AS roe_decl,
													IF(d.tr8_ref IS NOT NULL,
														CONCAT(d.tr8_ref, ' du ', DATE_FORMAT(d.tr8_date, '%d/%m/%Y')),
														NULL
														) AS tr8,
													IF(d.ref_decl IS NOT NULL,
														CONCAT(d.ref_decl, ' du ', DATE_FORMAT(d.date_decl, '%d/%m/%Y')),
														NULL
														) AS declaration,
													IF(d.ref_liq IS NOT NULL,
														CONCAT(d.ref_liq, ' du ', DATE_FORMAT(d.date_liq, '%d/%m/%Y')),
														NULL
														) AS liquidation,
													IF(d.ref_quit IS NOT NULL,
														CONCAT(d.ref_quit, ' du ', DATE_FORMAT(d.date_quit, '%d/%m/%Y')),
														NULL
														) AS quittance
												FROM detail_facture_dossier det, dossier d
												WHERE det.ref_fact = ?
													AND det.id_dos = d.id_dos
												GROUP BY d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$tbl .= '<tr>
							<td style="text-align: center;">'.$compteur.'</td>
							<td style="text-align: center;">'.$reponse['ref_dos'].'</td>
							<td style="text-align: center;">'.$reponse['num_lic'].'</td>
							<td style="text-align: center;">'.$reponse['horse'].'</td>
							<td style="text-align: center;">'.$reponse['tr8'].'</td>
							<td style="text-align: center;">'.$reponse['declaration'].'</td>
							<td style="text-align: center;">'.number_format($reponse['roe_decl'], 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 16, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 106, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 26, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 61, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 59, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 34, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 63, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;"><button class="btn btn-xs btn-danger" onclick="deleteDetailFacture(\''.$ref_fact.'\', '.$reponse['id_dos'].');"><i class="fa fa-times"></i></button></td>
						</tr>';
			}$requete-> closeCursor();

			return $tbl;

		}

		public function afficherDetailFactureRCDAjax($ref_fact){
			include("connexion.php");
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.num_lic AS num_lic,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.tr8_ref AS tr8_ref,
													DATE_FORMAT(d.tr8_date, '%d/%m/%Y') AS tr8_date,
													d.roe_decl AS roe_decl,
													IF(d.tr8_ref IS NOT NULL,
														CONCAT(d.tr8_ref, ' du ', DATE_FORMAT(d.tr8_date, '%d/%m/%Y')),
														NULL
														) AS tr8,
													IF(d.ref_decl IS NOT NULL,
														CONCAT(d.ref_decl, ' du ', DATE_FORMAT(d.date_decl, '%d/%m/%Y')),
														NULL
														) AS declaration,
													IF(d.ref_liq IS NOT NULL,
														CONCAT(d.ref_liq, ' du ', DATE_FORMAT(d.date_liq, '%d/%m/%Y')),
														NULL
														) AS liquidation,
													IF(d.ref_quit IS NOT NULL,
														CONCAT(d.ref_quit, ' du ', DATE_FORMAT(d.date_quit, '%d/%m/%Y')),
														NULL
														) AS quittance
												FROM detail_facture_dossier det, dossier d
												WHERE det.ref_fact = ?
													AND det.id_dos = d.id_dos
												GROUP BY d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$tbl .= '<tr>
							<td style="text-align: center;">'.$compteur.'</td>
							<td style="text-align: center;">'.$reponse['ref_dos'].'</td>
							<td style="text-align: center;">'.$reponse['num_lic'].'</td>
							<td style="text-align: center;">'.$reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'].'</td>
							<td style="text-align: center;">'.$reponse['tr8'].'</td>
							<td style="text-align: center;">'.$reponse['declaration'].'</td>
							<td style="text-align: center;">'.number_format($reponse['roe_decl'], 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 16, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 106, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 23, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 62, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 10, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;">'.number_format($this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 63, $reponse['id_dos']), 2, ',', ' ').'</td>
							<td style="text-align: center;"><button class="btn btn-xs btn-danger" onclick="deleteDetailFacture(\''.$ref_fact.'\', '.$reponse['id_dos'].');"><i class="fa fa-times"></i></button></td>
						</tr>';
			}$requete-> closeCursor();

			return $tbl;

		}

		public function afficherDossierFactureGlobaleFrontierEdit($id_cli, $id_mod_lic, $num_lic, $ref_fact){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = $num_lic;
			$entree['ref_fact'] = $ref_fact;
			// $entree['num_lic'] = '"%'.substr($num_lic, 0, 10).'%"';
			// $entree['id_mod_trans'] = $id_mod_trans;

			// echo '<br>-------------------------------id_cli = '.$id_cli;
			// echo '<br>-------------------------------id_mod_lic = '.$id_mod_lic;
			// echo '<br>-------------------------------num_lic = '.$num_lic;
			// echo '<br>-------------------------------id_mod_trans = '.$id_mod_trans;
			$sqlLimit = '';
			// if ($num_lic=='13') {
			// 	$sqlLimit = 'LIMIT 0, 8';
			// }else if($num_lic=='1'){
			// 	$sqlLimit = 'LIMIT 0, 15';
			// }
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal,
													round(IF(roe_decl > 0, roe_decl, 1), 3) AS roe_decl,
													((poids*5)/1000) AS lmc
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NOT NULL)
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos IN (SELECT id_dos 
														FROM detail_facture_dossier WHERE ref_fact = ?)
													AND not_fact = '0'
													AND num_lic LIKE CONCAT(SUBSTRING(?, 1, 10), '%')
												ORDER BY REPLACE(ref_decl, ' ', '') ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['ref_fact'], $entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo number_format($reponse['poids_brut'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<?php
					//$montant = $this-> getMontantDeboursClientModeleLicence(27, 1, $id_cli);
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" step="0.0001">
				</td>
				<?php
					$montant = $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_droits_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_droits_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_droits_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001">
				</td>
				<?php
					$montant = $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 127, $reponse['id_dos']);
					$tva = '0';
					$usd = '0';
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_lse_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_lse_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_lse_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001">
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_comext_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_comext_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_comext_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_nac_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_nac_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_nac_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_occ_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_occ_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_occ_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_cgea_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_cgea_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_cgea_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					if (($this-> getDossier($reponse['id_dos'])['poids']/1000)>'30') {
						$montant = 450; 
					}else{
						$montant = 300; 
					}
					$tva = $this-> getMontantDeboursClientModeleLicence2(37, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(37, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_ceec_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_ceec_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_ceec_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_dgda_seal_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_dgda_seal_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_dgda_seal_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = ($this-> getDossier($reponse['id_dos'])['poids_brut']/1000)*3;
					$tva = $this-> getMontantDeboursClientModeleLicence2(43, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(43, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_fere_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_fere_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_fere_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_lmc_<?php echo $compteur;?>" value="0">
					<input type="hidden" name="usd_lmc_<?php echo $compteur;?>" value="1">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_lmc_<?php echo $compteur;?>" value="<?php echo $reponse['lmc'];?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_carte_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_carte_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_carte_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_op_cost_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_op_cost_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_op_cost_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_agency_fee_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_agency_fee_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_agency_fee_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				
			</tr>
			<?php
			}$requete-> closeCursor();
			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													ref_decl AS ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq AS ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit AS ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal,
													round(roe_decl, 3) AS roe_decl,
													((poids*5)/1000) AS lmc
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NOT NULL)
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND not_fact = '0'
													AND num_lic LIKE CONCAT(SUBSTRING(?, 1, 10), '%')
												ORDER BY REPLACE(ref_decl, ' ', '') ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo number_format($reponse['poids_brut'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<?php
					//$montant = $this-> getMontantDeboursClientModeleLicence(27, 1, $id_cli);
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" step="0.0001">
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_droits_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_droits_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_droits_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001">
				</td>
				<?php
					$montant = $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 127, $reponse['id_dos']);
					$tva = '0';
					$usd = '0';
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_lse_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_lse_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_lse_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001">
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_comext_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_comext_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_comext_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_nac_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_nac_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_nac_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_occ_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_occ_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_occ_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_cgea_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_cgea_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_cgea_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					if (($this-> getDossier($reponse['id_dos'])['poids']/1000)>='30') {
						$montant = 250; 
					}else{
						$montant = 125; 
					}
					$tva = $this-> getMontantDeboursClientModeleLicence2(37, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(37, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_ceec_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_ceec_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_ceec_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_dgda_seal_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_dgda_seal_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_dgda_seal_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = ($this-> getDossier($reponse['id_dos'])['poids_brut']/1000)*3;
					$tva = $this-> getMontantDeboursClientModeleLicence2(43, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(43, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_fere_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_fere_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_fere_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_lmc_<?php echo $compteur;?>" value="0">
					<input type="hidden" name="usd_lmc_<?php echo $compteur;?>" value="1">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_lmc_<?php echo $compteur;?>" value="<?php echo $reponse['lmc'];?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_carte_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_carte_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_carte_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_op_cost_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_op_cost_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_op_cost_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_agency_fee_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_agency_fee_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_agency_fee_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierFactureGlobaleFrontierEditBackup($id_cli, $ref_fact){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['ref_fact'] = $ref_fact;
			// $entree['id_mod_lic'] = $id_mod_lic;
			// $entree['id_march'] = $id_march;
			// $entree['id_mod_trans'] = $id_mod_trans;
			$sqlLimit = '';

			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													dos.id_dos,
													dos.num_lot,
													dos.horse,
													dos.trailer_1,
													dos.trailer_2,
													dos.poids_brut,
													dos.ref_dos_2,
													dos.commodity AS commodity,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													dos.fob, dos.fret, dos.assurance, dos.autre_frais, (dos.fob+dos.fret+dos.assurance+dos.autre_frais) AS cif,
													dos.supplier, dos.ref_fact, dos.po_ref, dos.poids, dos.bur_douane, dos.incoterm, dos.principal,
													dos.roe_decl
												FROM dossier dos, detail_facture_dossier det
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos
												ORDER BY REPLACE(dos.ref_decl, ' ', '') ASC");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo number_format($reponse['poids_brut'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<?php
					//$montant = $this-> getMontantDeboursClientModeleLicence(27, 1, $id_cli);
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" step="0.0001" required>
				</td>
				<?php
					$montant = $this-> getMontantFactureEnAttenteDeboursDossier($ref_fact, 27, $reponse['id_dos']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(27, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_droits_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_droits_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 10em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_droits_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(85, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_comext_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_comext_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_comext_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(11, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_nac_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_nac_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_nac_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(2, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_occ_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_occ_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_occ_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(41, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_cgea_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_cgea_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_cgea_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					if (($this-> getDossier($reponse['id_dos'])['poids']/1000)>='30') {
						$montant = 250; 
					}else{
						$montant = 125; 
					}
					$tva = $this-> getMontantDeboursClientModeleLicence2(37, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(37, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_ceec_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_ceec_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_ceec_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(80, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_dgda_seal_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_dgda_seal_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_dgda_seal_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = ($this-> getDossier($reponse['id_dos'])['poids_brut']/1000)*3;
					$tva = $this-> getMontantDeboursClientModeleLicence2(43, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(43, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_fere_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_fere_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_fere_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(100, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_carte_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_carte_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_carte_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(32, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_op_cost_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_op_cost_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_op_cost_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				<?php
					$montant = round($this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['montant']);
					$tva = $this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['tva'];
					$usd = $this-> getMontantDeboursClientModeleLicence2(12, 1, $id_cli)['usd'];
				?>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="tva_agency_fee_<?php echo $compteur;?>" value="<?php echo $tva;?>">
					<input type="hidden" name="usd_agency_fee_<?php echo $compteur;?>" value="<?php echo $usd;?>">
					<input style="width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_agency_fee_<?php echo $compteur;?>" value="<?php echo $montant;?>" step="0.0001" required>
				</td>
				
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierFactureTransfertLocal($id_cli, $id_mod_lic, $id_march){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$sqlLimit = '';
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT ref_dos AS ref_dos,
													id_dos,
													num_lot,
													horse,
													trailer_1,
													trailer_2,
													poids_brut,
													ref_dos_2,
													commodity AS commodity,
													fob, fret, assurance, autre_frais, (fob+fret+assurance+autre_frais) AS cif,
													supplier, ref_fact, po_ref, poids, bur_douane, incoterm, principal
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1')
														)
													AND id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fact
																WHERE fact.id_t_trans = 6
																	AND fact.ref_fact = det.ref_fact)
													AND not_fact = '0'
													AND id_mod_trans = 6
													AND id_march = ?
												ORDER BY id_dos ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_march']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['horse'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['trailer_1'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['trailer_2'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo number_format($reponse['poids_brut'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="id_deb_<?php echo $reponse['id_dos'];?>_1" value="36">
					<input type="hidden" name="usd_<?php echo $reponse['id_dos'];?>_1" value="1">
					<input type="hidden" name="tva_<?php echo $reponse['id_dos'];?>_1" value="0">
					<input style="text-align:  center; ;width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $reponse['id_dos'];?>_1" value="40" step="0.0001">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="id_deb_<?php echo $reponse['id_dos'];?>_2" value="83">
					<input type="hidden" name="usd_<?php echo $reponse['id_dos'];?>_2" value="1">
					<input type="hidden" name="tva_<?php echo $reponse['id_dos'];?>_2" value="0">
					<input style="text-align:  center; ;width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $reponse['id_dos'];?>_2" value="15" step="0.0001">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="id_deb_<?php echo $reponse['id_dos'];?>_3" value="41">
					<input type="hidden" name="usd_<?php echo $reponse['id_dos'];?>_3" value="1">
					<input type="hidden" name="tva_<?php echo $reponse['id_dos'];?>_3" value="0">
					<input style="text-align:  center; ;width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $reponse['id_dos'];?>_3" value="16" step="0.0001">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="id_deb_<?php echo $reponse['id_dos'];?>_4" value="37">
					<input type="hidden" name="usd_<?php echo $reponse['id_dos'];?>_4" value="1">
					<input type="hidden" name="tva_<?php echo $reponse['id_dos'];?>_4" value="0">
					<input style="text-align:  center; ;width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $reponse['id_dos'];?>_4" value="10" step="0.0001">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="id_deb_<?php echo $reponse['id_dos'];?>_5" value="32">
					<input type="hidden" name="usd_<?php echo $reponse['id_dos'];?>_5" value="1">
					<input type="hidden" name="tva_<?php echo $reponse['id_dos'];?>_5" value="0">
					<input style="text-align:  center; ;width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $reponse['id_dos'];?>_5" value="60" step="0.0001">
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<input type="hidden" name="id_deb_<?php echo $reponse['id_dos'];?>_6" value="25">
					<input type="hidden" name="usd_<?php echo $reponse['id_dos'];?>_6" value="1">
					<input type="hidden" name="tva_<?php echo $reponse['id_dos'];?>_6" value="1">
					<input style="text-align:  center; ;width: 8em; background-color: black; color: white; font-weight: bold;" type="number" name="montant_<?php echo $reponse['id_dos'];?>_6" value="20" step="0.0001">
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierEditeFactureGlobale($ref_fact){
			include("connexion.php");
			$entree['ref_fact'] = $ref_fact;
			$sqlLimit = '';
			// if ($id_march=='13') {
			// 	$sqlLimit = 'LIMIT 0, 10';
			// }else if($id_march=='1'){
			// 	$sqlLimit = 'LIMIT 0, 15';
			// }
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													d.id_dos AS id_dos,
													d.num_lot AS num_lot,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.poids_brut AS poids_brut,
													d.ref_dos_2 AS ref_dos_2,
													d.commodity AS commodity,
													d.id_march AS id_march,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_quit AS ref_quit,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													d.fob AS fob, 
													d.fret AS fret, 
													d.assurance AS assurance, 
													d.autre_frais AS autre_frais, 
													(d.fob+d.fret+d.assurance+d.autre_frais) AS cif,
													d.supplier AS supplier, 
													d.ref_fact AS ref_fact, 
													d.po_ref AS po_ref, 
													d.poids AS poids, 
													d.bur_douane AS bur_douane, 
													d.incoterm AS incoterm, 
													d.principal AS principal
												FROM dossier d, detail_facture_dossier det, facture_dossier fact
												WHERE fact.ref_fact = ?
													AND fact.ref_fact = det.ref_fact
													AND det.id_dos = d.id_dos
												GROUP BY d.id_dos
												ORDER BY d.id_dos ASC
												$sqlLimit");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['horse'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['trailer_1'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['trailer_2'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo number_format($reponse['poids_brut'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
				<?php
					$this-> afficherLigneTableauDeboursFactureGlobaleEdit($ref_fact, $reponse['id_march'], $reponse['id_dos'], $compteur)
				?>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function afficherDossierFactureDossier($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact, dos.ref_dos AS ref_dos,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													cl.nom_cli AS nom_cli,
													u.nom_util AS nom_util,
													fd.type_fact AS type_fact
 												FROM facture_dossier fd, client cl, utilisateur u, detail_facture_dossier det, dossier dos
												WHERE fd.id_util = u.id_util
													AND fd.id_mod_lic = ?
													AND fd.id_cli = cl.id_cli
													
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													$sqlClient
												GROUP BY dos.id_dos");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				//include('modalFacturationDossier.php');

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact']), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
					<?php 
						echo 
						$btn;
						if ($reponse['type_fact'] == 'globale') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1900,height=900');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
	                <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportExcelFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $_GET['id_mod_lic_fact']; ?>&id_cli=<?php echo $_GET['id_cli']; ?>','pop1','width=80,height=80');">
	                  <i class="fas fa-file-excel"></i> Master Data Excel
	                </button>
						<?php
						}else if ($reponse['type_fact'] == 'partielle') {
						?>
					<button class="btn bg-danger square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');">
	                    <i class="fas fa-file-pdf"></i> Générer
	                </button>
						<?php
						}
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherTicket($premiere_entree, $nombre_dossier_par_page, $id_util=NULL){
			include("connexion.php");
			$entree['id_util'] = $id_util;

			$compteur=$premiere_entree;

			if (isset($id_util) && ($id_util!='')) {
				$sqlUser = ' AND u.id_util = "'.$id_util.'"';
			}else{
				$sqlUser = '';
			}

			$requete = $connexion-> query("SELECT t.*,
													st.nom_stat AS nom_stat,
													prio.nom_prio AS nom_prio,
													u.nom_util AS nom_util,
													u.id_util AS id_util,
													module.nom_mod AS nom_mod,
													DATE_FORMAT(t.date_create, '%d/%m/%Y') AS date_create,
													t.date_create AS date_create_2,
													t.date_debut_trait AS date_debut_trait_2,
													t.date_fin_trait AS date_fin_trait_2,
													t.date_const AS date_const_2,
													DATE_FORMAT(t.date_const, '%d/%m/%Y à %H:%I') AS date_const,
													DATE_FORMAT(t.date_debut_trait, '%d/%m/%Y') AS date_debut_trait,
													DATE_FORMAT(t.date_fin_trait, '%d/%m/%Y') AS date_fin_trait,
													IF(t.id_prio='1',
														'bg bg-dark',
														IF(t.id_prio='2',
															'bg bg-primary',
															'bg bg-danger')
														) AS bg_prio,
													IF(t.id_stat='1',
														'bg bg-warning',
														IF(t.id_stat='2',
															'bg bg-primary',
															IF(t.id_stat='3',
																'bg bg-dark',	
																IF(t.id_stat='4',
																	'bg bg-danger',
																	'bg bg-success')
																)
															)
														) AS bg_stat,
													DATEDIFF(DATE(t.date_create), DATE(t.date_const)) AS delai_constat,
													IF(t.date_debut_trait IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(t.date_create)),
														DATEDIFF(DATE(t.date_debut_trait), DATE(t.date_create))
														) AS delai_trait_1,
													IF(t.date_debut_trait IS NULL,
														'0',
														IF(t.date_fin_trait IS NULL,
															DATEDIFF(CURRENT_DATE(), DATE(t.date_debut_trait)),
															DATEDIFF(DATE(t.date_fin_trait), DATE(t.date_debut_trait)))
														) AS delai_trait_2
 												FROM ticket t, priorite prio, statut_ticket st, module, utilisateur u
												WHERE t.id_util_emet = u.id_util
													$sqlUser
													AND t.id_prio = prio.id_prio
													AND t.id_stat = st.id_stat
													AND t.id_mod = module.id_mod
												ORDER BY t.id_tick DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditTicket.php');

			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: left;">
					<?php echo $reponse['detail_tick'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['nom_mod'];?>
				</td>
				<td class="" style="text-align: center;">
					<span class=" badge <?php echo $reponse['bg_prio'];?>">
						<?php echo $reponse['nom_prio'];?>
					</span>
				</td>
				<td style="text-align: center;">
					<span class=" badge <?php echo $reponse['bg_stat'];?>">
						<?php echo $reponse['nom_stat'];?>
					</span>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['date_const'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['date_create'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['delai_constat'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['date_debut_trait'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['delai_trait_1'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['date_fin_trait'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['delai_trait_2'];?>
				</td>
				<td class="" style="text-align: center;">
				<?php
					if ($reponse['id_util']==$_SESSION['id_util'] || $_SESSION['id_role']=='1') {
						?>
						<button class="btn btn-block btn-warning btn-xs" data-toggle="modal" data-target=".editTicket_<?php echo $reponse['id_tick'];?>">
							Modifier
						</button>
						<?php
					}
				?>
				</td>
				<td class="" style="text-align: center;">
				<?php
					/*if ($reponse['id_util']==$_SESSION['id_util'] || $_SESSION['id_role']=='1') {
						?>
						<button class="btn btn-block bg-purple btn-xs" data-toggle="modal" data-target=".editTicket_<?php echo $reponse['id_tick'];?>">
							Traiter
						</button>
						<?php
					}*/
				?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherClient($premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");

			$compteur=$premiere_entree;

			$requete = $connexion-> query("SELECT *,
											IF(actif='1', 'Actif', 'Non-Actif') AS label_active,
											IF(actif='1', 'bg bg-primary', 'bg bg-danger') AS class_active
											FROM client
											ORDER BY nom_cli ASC
											LIMIT $premiere_entree, $nombre_dossier_par_page");
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				//include('modalEditTicket.php');

			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;">
					<?php
					if (isset($reponse['photo'])) {
					?>
					<img src="../images/clients/<?php echo $reponse['photo'];?>" width="20px">
					<?php
					}else{
					?>
					<i class="fa fa-user"></i>
					<?php
					}
					?>
				</td>
				<td class="" style="text-align: left;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['code_cli'];?>
				</td>
				<td style="text-align: center;">
					<span class="badge <?php echo $reponse['class_active'];?>">
						<?php echo $reponse['label_active'];?>
					</span>
				</td>
				<td class="" style="text-align: center;">
					<button class="btn btn-xs btn-warning square-btn-adjust btn-xs" onclick="window.location.replace('editCompteClient.php?id_cli=<?php echo $reponse['id_cli'];?>','pop1','width=80,height=80');">
                       <i class="fas fa-edit"></i> Editer
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherClientAjax(){
			include("connexion.php");

			$compteur=0;
			$row = array();

			$requete = $connexion-> query("SELECT *,
											IF(actif='1', '<span=\'bg bg-primary\'>Actif</span>', '<span=\'bg bg-danger\'>Non-Actif</span>') AS label_active,
												IF(actif='1', '<span class=\'badge bg-primary\'>Compte Actif</span>', '<span class=\'badge bg-danger\'>Compte Non-Actif</span>') AS active,
											CONCAT('<button class=\'btn btn-xs btn-warning square-btn-adjust btn-xs\' onclick=\'window.location.replace(\"editCompteClient.php?id_cli=',id_cli,'\");\'>
								                       <i class=\'fas fa-edit\'></i> Editer
								                    </button>') AS btn
											FROM client
											ORDER BY nom_cli ASC");
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				if (isset($reponse['photo'])) {
					$reponse['img'] = '<img src="../images/clients/'.$reponse['photo'].'" width="20px">';
				}else{
					$reponse['img'] = '<i class="fa fa-user"></i>';
				}

				// $reponse['btn'] = '<button class=\'btn btn-xs btn-warning square-btn-adjust btn-xs\' onclick=\'window.location.replace("editCompteClient.php?id_cli='.$reponse['id_cli'].'");\'>
				//                        <i class=\'fas fa-edit\'></i> Editer
				//                     </button>';

				$row[] = $reponse;
			}$requete-> closeCursor();

			if ($row) {
				return $row;
			}else{
				return null;
			}

		}

		public function statutClient($id_cli, $id_mod_lic, $date_deb, $date_fin, $notification){
			include("connexion.php");

			$sqlDoc = 'AND dossier_document.id_doc = 0';
			$sql = '';
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if ($notification=='TR8') {
				$sql = ' AND dos.tr8_date BETWEEN "'.$date_deb.'" AND "'.$date_fin.'"';
				$sqlDoc = 'AND dossier_document.id_doc = 11';
			}
			else if ($notification=='T1') {
				$sql = ' AND dos.t1_date BETWEEN "'.$date_deb.'" AND "'.$date_fin.'"';
				$sqlDoc = 'AND dossier_document.id_doc = 12';
			}
			else if ($notification=='BS T1') {
				$sql = ' AND dos.bs_t1_date BETWEEN "'.$date_deb.'" AND "'.$date_fin.'"';
				$sqlDoc = 'AND dossier_document.id_doc = 53';
			}
			else if ($notification=='BFU') {
				$sql = ' AND dos.bfu BETWEEN "'.$date_deb.'" AND "'.$date_fin.'"';
				$sqlDoc = 'AND dossier_document.id_doc = 54';
			}
			else if ($notification=='Escort pyt date') {
				$sql = ' AND dos.escort_pyt_date BETWEEN "'.$date_deb.'" AND "'.$date_fin.'"';
			}
			else if ($notification=='Borders activities') {
				$sql = ' AND (
								(dos.tr8_date BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")
								OR
								(dos.t1_date BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")
								OR
								(dos.bs_t1_date BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")
								OR
								(dos.bfu BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")
								OR
								(dos.escort_pyt_date BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")
							)';
				$sqlDoc = 'AND (dossier_document.id_doc = 11 OR dossier_document.id_doc = 12)';
			}
			else if ($notification=='IM4') {
				$sql = ' AND (
								(dos.date_decl BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")
							)';
				$sqlDoc = 'AND dossier_document.id_doc = 4';
			}else if ($notification=='Liquidation') {
				$sql = ' AND (
								(dos.date_liq BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")
							)';
				$sqlDoc = 'AND dossier_document.id_doc = 5';
			}else if ($notification=='Quittance') {
				$sql = ' AND (
								(dos.date_quit BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")
							)';
				$sqlDoc = 'AND dossier_document.id_doc = 6';
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													DATE_FORMAT(dos.date_preal, '%d/%m/%Y') AS date_preal,
													dos.id_dos AS id_dos,
													dos.road_manif AS road_manif,
													dos.horse AS horse,
													CONCAT(
														IF(dos.trailer_1 IS NOT NULL AND LENGTH(dos.trailer_1) > 5,
															dos.trailer_1,
															''
														),
														IF(dos.trailer_2 IS NOT NULL AND LENGTH(dos.trailer_2) > 5,
															CONCAT(' / ',dos.trailer_2),
															''
														)
													) AS trailers,
													dos.tr8_ref AS tr8_ref,
													DATE_FORMAT(dos.tr8_date, '%d/%m/%Y') AS tr8_date,
													dos.t1 AS t1,
													DATE_FORMAT(dos.t1_date, '%d/%m/%Y') AS t1_date,
													DATE_FORMAT(dos.bs_t1_date, '%d/%m/%Y') AS bs_t1_date,
													DATE_FORMAT(dos.bfu, '%d/%m/%Y') AS bfu,
													DATE_FORMAT(dos.escort_pyt_date, '%d/%m/%Y') AS escort_pyt_date,
													dos.road_manif AS road_manif,
													dos.ref_fact AS ref_fact,
													dos.dgda_manif AS dgda_manif,
													dos.ref_decl AS ref_decl,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.ref_bfu AS ref_bfu,
													DATE_FORMAT(dos.dgda_manif_date, '%d/%m/%Y') AS dgda_manif_date,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													dossier_document.id_doc AS id_doc,
													document.nom_doc AS nom_doc
												FROM dossier dos
												LEFT JOIN dossier_document
													ON dossier_document.id_dos = dos.id_dos
													$sqlDoc
												LEFT JOIN document
													ON document.id_doc = dossier_document.id_doc
													$sqlDoc
												WHERE dos.id_cli = ?
													AND dos.id_mod_lic = ?
													$sql
												GROUP BY dos.id_dos");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['document'] = null;
				if($this-> getDocumentForDossier($reponse['id_dos'], $reponse['id_doc']) != '0' && file_exists('../documents/'.$this-> getDossier($reponse['id_dos'])['ref_dos'].'/'.$this-> getDocumentForDossier($reponse['id_dos'], $reponse['id_doc']))){
					$reponse['document'] = '<span class="btn btn-xs bg bg-dark" onclick="window.open(\'../documents/'.$this-> getDossier($reponse['id_dos'])['ref_dos'].'/'.$this-> getDocumentForDossier($reponse['id_dos'], $reponse['id_doc']).'\',\'pop4\',\'width=700,height=900\');">
						<i class="fa fa-file"></i>
					</span>';
				}

				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function master_data_dossier($id_cli, $id_mod_lic, $annee){
			include("connexion.php");

			$compteur = 0;
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = '';
			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND dos.id_cli = '.$id_cli;
			}

			$sqlAnnee = '';
			if (isset($annee) && ($annee!='')) {
				$sqlAnnee = ' AND YEAR(dos.date_creat_dos) = '.$annee;
			}


			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													DATE_FORMAT(dos.date_preal, '%d/%m/%Y') AS date_preal,
													dos.id_dos AS id_dos,
													cl.nom_cli AS nom_cli,
													dos.road_manif AS road_manif,
													dos.horse AS horse,
													CONCAT(
														IF(dos.trailer_1 IS NOT NULL AND LENGTH(dos.trailer_1) > 5,
															dos.trailer_1,
															''
														),
														IF(dos.trailer_2 IS NOT NULL AND LENGTH(dos.trailer_2) > 5,
															CONCAT(' / ',dos.trailer_2),
															''
														)
													) AS trailers,
													dos.tr8_ref AS tr8_ref,
													dos.ref_fact AS ref_fact,
													dos.po_ref AS po_ref,
													dos.bur_douane AS bur_douane,
													CONCAT(
														IF(dos.horse IS NOT NULL AND REPLACE(dos.horse, ' ', '') NOT LIKE '',
															dos.horse,
															''),
														IF(dos.trailer_1 IS NOT NULL AND REPLACE(dos.trailer_1, ' ', '') NOT LIKE '',
															CONCAT(' / ', dos.trailer_1),
															''),
														IF(dos.trailer_2 IS NOT NULL AND REPLACE(dos.trailer_2, ' ', '') NOT LIKE '',
															CONCAT(' / ', dos.trailer_2),
															'')
													) AS truck,
													DATE_FORMAT(dos.tr8_date, '%d/%m/%Y') AS tr8_date,
													dos.t1 AS t1,
													DATE_FORMAT(dos.t1_date, '%d/%m/%Y') AS t1_date,
													DATE_FORMAT(dos.bs_t1_date, '%d/%m/%Y') AS bs_t1_date,
													DATE_FORMAT(dos.bfu, '%d/%m/%Y') AS bfu,
													-- DATE_FORMAT(dos.escort_pyt_date, '%d/%m/%Y') AS escort_pyt_date,
													dos.road_manif AS road_manif,
													dos.ref_fact AS ref_fact,
													dos.dgda_manif AS dgda_manif,
													dos.ref_decl AS ref_decl,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													-- dos.ref_bfu AS ref_bfu,
													DATE_FORMAT(dos.dgda_manif_date, '%d/%m/%Y') AS dgda_manif_date,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier dos, client cl
												WHERE dos.id_mod_lic = ?
													AND dos.id_cli = cl.id_cli
													$sqlClient
													$sqlAnnee");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function client_border_activity($id_cli, $id_mod_lic, $date_deb, $date_fin){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['date_deb'] = $date_deb;
			$entree['date_fin'] = $date_fin;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													DATE_FORMAT(dos.date_preal, '%d/%m/%Y') AS date_preal,
													dos.road_manif AS road_manif,
													dos.horse AS horse,
													CONCAT(
														IF(dos.trailer_1 IS NOT NULL AND LENGTH(dos.trailer_1) > 5,
															dos.trailer_1,
															''
														),
														IF(dos.trailer_2 IS NOT NULL AND LENGTH(dos.trailer_2) > 5,
															CONCAT(' / ',dos.trailer_2),
															''
														)
													) AS trailers,
													dos.tr8_ref AS tr8_ref,
													DATE_FORMAT(dos.tr8_date, '%d/%m/%Y') AS tr8_date,
													dos.t1 AS t1,
													DATE_FORMAT(dos.t1_date, '%d/%m/%Y') AS t1_date,
													DATE_FORMAT(dos.bs_t1_date, '%d/%m/%Y') AS bs_t1_date,
													DATE_FORMAT(dos.bfu, '%d/%m/%Y') AS bfu,
													DATE_FORMAT(dos.escort_pyt_date, '%d/%m/%Y') AS escort_pyt_date,
													dos.ref_bfu AS ref_bfu
												FROM dossier dos
												WHERE dos.id_cli = ?
													AND dos.id_mod_lic = ?
													AND (
															(dos.tr8_date BETWEEN '$date_deb' AND '$date_fin')
															OR
															(dos.t1_date BETWEEN '$date_deb' AND '$date_fin')
															OR
															(dos.bs_t1_date BETWEEN '$date_deb' AND '$date_fin')
															OR
															(dos.bfu BETWEEN '$date_deb' AND '$date_fin')
															OR
															(dos.escort_pyt_date BETWEEN '$date_deb' AND '$date_fin')
														)
												");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;

				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function afficherClientCRMAjax($id_mod_lic=null, $annee=NULL){
			include("connexion.php");

			if (!empty($id_mod_lic) && ($id_mod_lic!='')) {
				$sqlModeLicence = " WHERE cl.id_cli IN (SELECT id_cli FROM affectation_client_modele_licence WHERE id_mod_lic = $id_mod_lic)";
				$sqlModeLicenceForPrevision = " AND prev.id_mod_lic = $id_mod_lic";
				$sqlModeLicenceForFacture = " AND fd.id_mod_lic = $id_mod_lic";
				$sqlModeLicenceForDossier = " AND dos.id_mod_lic = $id_mod_lic";
			}else{
				$sqlModeLicence = "";
				$sqlModeLicenceForPrevision = "";
				$sqlModeLicenceForFacture = "";
				$sqlModeLicenceForDossier = "";
			}

			if (!empty($annee) && ($annee!='')) {
				$sqlAnneeForPrevision = " AND prev.annee = '$annee'";
				$sqlAnneeForFacture = " AND YEAR(fd.date_fact) = '$annee'";
				$sqlAnneeForDossier = " AND YEAR(dos.date_creat_dos) = '$annee'";
			}else{
				$sqlAnneeForPrevision = "";
				$sqlAnneeForFacture = "";
				$sqlAnneeForDossier = "";
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> query("SELECT cl.*,
													COUNT(dos.id_dos) AS nbre_dos,
													IF(prev.id_cli IS NOT NULL,
														SUM(prev.nbre_dos),
														'-'
													) AS nbre_dos_prev,
													IF(prev.id_cli IS NOT NULL,
														COUNT(dos.id_dos)-SUM(prev.nbre_dos),
														'-'
													) AS ecart_dos,
													CONCAT('<div class=\"btn-group\" role=\"group\">
													    <button id=\"btnGroupDrop1\" type=\"button\" class=\"btn btn-xs btn-info dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">
													      Action
													    </button>
													    <div class=\"dropdown-menu\" aria-labelledby=\"btnGroupDrop1\">
													      <a class=\"dropdown-item\" href=\"#\" onclick=\"detail_client_crm(',cl.id_cli,', \'$id_mod_lic\', \'$annee\');\"><i class=\"fa fa-edit\"></i> Edit</a>
													      <a class=\"dropdown-item\" href=\"#\"><i class=\"fa fa-eye\"></i> Details</a>
													    </div>
													  </div>') AS btn_action
											FROM client cl
												LEFT JOIN dossier dos
													ON dos.id_cli = cl.id_cli
														AND dos.ref_dos NOT LIKE '%test%'
														$sqlModeLicenceForDossier
														$sqlAnneeForDossier
												LEFT JOIN prevision_crm prev
													ON prev.id_cli = cl.id_cli
													$sqlModeLicenceForPrevision
													$sqlAnneeForPrevision
												-- LEFT JOIN detail_facture_dossier det
												-- 	ON det.id_dos = dos.id_dos
												-- LEFT JOIN facture_dossier fd
												-- 	ON fd.ref_fact = det.ref_fact
												-- 	$sqlModeLicenceForFacture
												-- 	$sqlAnneeForFacture
												-- LEFT JOIN debours deb
												-- 	ON det.id_deb = deb.id_deb
												$sqlModeLicence
											GROUP BY cl.id_cli
											ORDER BY cl.nom_cli ASC");
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				if (isset($reponse['photo'])) {
					$reponse['img'] = '<img src="../images/clients/'.$reponse['photo'].'" width="20px">';
				}else{
					$reponse['img'] = '<i class="fa fa-user"></i>';
				}

				// $reponse['btn'] = '<button class=\'btn btn-xs btn-warning square-btn-adjust btn-xs\' onclick=\'window.location.replace("editCompteClient.php?id_cli='.$reponse['id_cli'].'");\'>
				//                        <i class=\'fas fa-edit\'></i> Editer
				//                     </button>';

				$row[] = $reponse;
			}$requete-> closeCursor();

			if ($row) {
				return $row;
			}else{
				return null;
			}

		}

		public function facture_licence($id_mod_lic, $id_cli, $etat, $debut_date_recep, $fin_date_recep){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = '';
			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fl.id_cli = '.$id_cli;
			}

			$sqlEtat = '';
			if (isset($etat) && ($etat!='')) {
				// if ($etat=='1') {
				// 	$sqlEtat = 'AND EXISTS (SELECT ref_fact FROM licence)';
				// }else{
				// 	$sqlEtat = 'AND NOT EXISTS (SELECT ref_fact FROM licence)';
				// }
				if ($etat=='1') {
					$sqlEtat = ' AND fl.ref_fact IN (SELECT ref_fact FROM licence WHERE ref_fact = fl.ref_fact)';
				}else{
					$sqlEtat = ' AND fl.ref_fact NOT IN (SELECT ref_fact FROM licence WHERE ref_fact = fl.ref_fact)';
				}
				
			}

			$sqlDateReception = '';
			if (isset($debut_date_recep) && ($debut_date_recep!='') && isset($fin_date_recep) && ($fin_date_recep!='')) {
				$sqlDateReception = ' AND (fl.date_fact_rec BETWEEN "'.$debut_date_recep.'" AND "'.$fin_date_recep.'")';
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT fl.*,
													cl.nom_cli AS nom_cli,
													DATEDIFF(CURRENT_DATE(), fl.date_fact_rec) AS delai,
													lic.num_lic AS num_lic,
													IF(lic.num_lic IS NOT NULL AND lic.num_lic NOT LIKE '%INV%',
														'Licence Validee',
														'En attente validation Licence'
													) AS etat,
													mon.sig_mon AS sig_mon,
													CONCAT('<a href=\'#\' onclick=\'modal_edit_facture(\"',fl.ref_fact,'\")\' class=\' btn btn-xs btn-warning btn\'><i class=\'fa fa-edit\'></i></a>
														<a href=\'#\' onclick=\'window.open(\"../factures/',fl.ref_fact,'/',fl.fichier_fact,'\", \"',fl.fichier_fact,'\", \"width=700,height=900\")\' class=\' btn btn-xs btn-info btn\'><i class=\'fa fa-file\'></i></a>
														<a href=\'#\' onclick=\'modal_edit_fichier_facture(\"',fl.ref_fact,'\")\' class=\' btn btn-xs btn-dark btn\'><i class=\'fa fa-upload\'></i></a>') AS btn_action
												FROM facture_licence fl 
													LEFT JOIN client cl
														ON fl.id_cli = cl.id_cli
													LEFT JOIN licence lic
														ON fl.ref_fact = lic.ref_fact
													LEFT JOIN monnaie mon
														ON mon.id_mon = fl.id_mon
												WHERE fl.id_mod_lic = ?
													$sqlClient
													$sqlEtat
													$sqlDateReception
												ORDER BY fl.date_creat_fact DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;

				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function dashboard_licence_($id_mod_lic){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT cl.id_cli AS id_cli, 
													cl.nom_cli AS nom_cli,
													COUNT(lic.num_lic) AS total_licence
												FROM client cl
												LEFT JOIN licence lic
													ON lic.id_mod_lic = ?
														AND lic.id_cli = cl.id_cli
												WHERE cl.id_cli IN (
														SELECT id_cli
														FROM affectation_client_modele_licence
															WHERE id_cli = cl.id_cli
																AND id_mod_lic = ?
													)
												GROUP BY cl.id_cli
												ORDER BY cl.nom_cli");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				// $reponse['total_licence'] = $this-> total_licence_client($id_mod_lic, $reponse['id_cli']);
				$reponse['total_nbre_licence_apurement_total'] = $this-> total_nbre_licence_apurement_total($id_mod_lic, $reponse['id_cli']);

				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function dashboard_licence($id_mod_lic, $debut, $fin){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;
			$row = array();

			if (isset($debut) && ($debut!='') && isset($fin) && ($fin!='')) {
				$sqlIntervalle = ' AND lic.date_val BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}else{
				$sqlIntervalle = '';
			}

			if ($id_mod_lic==2) {
				$requete = $connexion-> prepare("SELECT cl.id_cli AS id_cli, 
													cl.nom_cli AS nom_cli,
													COUNT(lic.num_lic) AS total_licence,
													COUNT(
														IF((lic.fob-lic.fob_apure)>=(-1*lic.fob*0.05) AND (lic.fob-lic.fob_apure)<=(lic.fob*0.05),
															-- lic.fob=lic.fob_apure,
															lic.num_lic,
															-- 1,
															NULL
															)
													) AS licence_apurement_total,
													COUNT(
														IF(lic.fob_apure>0 AND ((lic.fob-lic.fob_apure)>(lic.fob*0.05)),
															-- lic.fob>lic.fob_apure AND lic.fob_apure>0,
															lic.num_lic,
															-- 1,
															NULL
															)
													) AS licence_apurement_partiel,
													COUNT(
														IF((lic.fob-lic.fob_apure)<(-1*lic.fob*0.05),
															-- lic.fob<lic.fob_apure,
															lic.num_lic,
															-- 1,
															NULL
															)
													) AS licence_apurement_depassement,
													COUNT(
														IF(lic.fob_apure=0 OR lic.fob_apure IS NULL,
															lic.num_lic,
															-- 1,
															NULL
														)
													) AS licence_non_apuree
												FROM client cl
												LEFT JOIN licence lic
													ON lic.id_mod_lic = ?
														AND lic.id_cli = cl.id_cli
														$sqlIntervalle
												-- ---------------------------
												-- LEFT JOIN dossier dos
												-- 	ON dos.id_cli = cl.id_cli
												-- LEFT JOIN marchandise_dossier md
												-- 	ON md.id_dos = dos.id_dos
												-- LEFT JOIN licence lic
												-- 	ON SUBSTRING(lic.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
												-- 		AND lic.id_mod_lic = ?
												-- ---------------------------
												WHERE cl.id_cli IN (
														SELECT id_cli
														FROM affectation_client_modele_licence
															WHERE id_cli = cl.id_cli
																AND id_mod_lic = ?
													)
												GROUP BY cl.id_cli
												ORDER BY cl.nom_cli");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_lic']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['nbre_dossier_transmis'] = $this-> nbre_dossier_transmis($reponse['id_cli'], $id_mod_lic, $debut, $fin);
				// $reponse['nbre_non_transmis'] = $this-> nbre_dossiers_transmis($reponse['id_cli'], $id_mod_lic)['nbre_non_transmis'];
				// $reponse['nbre_total'] = $this-> nbre_dossiers_transmis($reponse['id_cli'], $id_mod_lic)['nbre_total'];
				$row[] = $reponse;
			}$requete-> closeCursor();

			}
			return $row;

		}

		public function nbre_dossier_transmis($id_cli, $id_mod_lic, $debut, $fin){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($debut) && ($debut!='') && isset($fin) && ($fin!='')) {
				$sqlIntervalle = ' AND dos.date_quit BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}else{
				$sqlIntervalle = '';
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT COUNT(det.id_dos) AS nbre
												FROM detail_apurement det, transmission_apurement ta, dossier dos
												WHERE (ta.fichier_trans_ap IS NOT NULL OR ta.id_util_envoi IS NOT NULL)
													AND det.id_trans_ap = ta.id_trans_ap
													AND det.id_dos = dos.id_dos
													AND dos.id_mod_lic = ?
													AND dos.id_cli = ?
													$sqlIntervalle");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];

		}

		public function nbre_dossiers_transmis($id_cli, $id_mod_lic){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT COUNT(
														IF(det.id_dos IS NOT NULL OR dos.not_apurement='1',
															dos.id_dos,
															NULL
														)
													) AS nbre_transmis,
													COUNT(
														IF(det.id_dos IS NULL AND dos.not_apurement='0' AND (dos.ref_quit IS NOT NULL AND dos.date_quit IS NOT NULL),
															dos.id_dos,
															NULL
														)
													) AS nbre_non_transmis,
													COUNT(
														IF((dos.ref_quit IS NOT NULL AND dos.date_quit IS NOT NULL) OR dos.not_apurement='1',
															dos.id_dos,
															NULL
														)
													) AS nbre_total
											FROM dossier dos
												LEFT JOIN detail_apurement det
													ON dos.id_dos = det.id_dos
												LEFT JOIN transmission_apurement trans
													ON det.id_trans_ap = trans.id_trans_ap
											WHERE dos.id_mod_lic = ?
												AND (dos.id_cli = ?
													OR dos.id_dos IN 
														(SELECT DISTINCT(md.id_dos)
															FROM marchandise_dossier md, licence l
																WHERE md.num_lic = l.num_lic
																	AND l.id_cli = ?)
													)
											");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_cli']));
			$reponse = $requete-> fetch();

			return $reponse;

		}

		public function marchandise_dossier_licence($num_lic){
			include("connexion.php");

			$entree['num_lic'] = $num_lic;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													md.ref_fact AS ref_fact,
													md.fob AS fob,
													md.num_av AS num_av,
													tr.ref_trans_ap AS ref_trans_ap,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													IF(tr.fichier_trans_ap IS NOT NULL,
														CONCAT('<button class=\"btn btn-xs btn-dark\" onclick=\"window.open(\'../transmision_apurements/',tr.id_trans_ap,'/',tr.fichier_trans_ap,'\',\'pop1\',\'width=1900,height=900\')\">
															<i class=\"fa fa-file\"></i>
														</button>'),
														''
													) AS fichier_trans_ap
												FROM marchandise_dossier md
													LEFT JOIN dossier dos
														ON md.id_dos = dos.id_dos
													LEFT JOIN detail_apurement det
														ON det.id_dos = dos.id_dos
													LEFT JOIN transmission_apurement tr
														ON tr.id_trans_ap = det.id_trans_ap
												WHERE md.num_lic = ?");
				$requete-> execute(array($entree['num_lic']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function dossiers_apurement($id_trans_ap){
			include("connexion.php");

			$entree['id_trans_ap'] = $id_trans_ap;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													IF(lic.num_lic IS NOT NULL,
														lic.num_lic,
														md.num_lic
													) AS num_lic,
													-- exp.date_exp AS date_exp,
													(IF(lic.fob IS NULL, 0, lic.fob) +IF(lic.fret IS NULL, 0, lic.fret)+IF(lic.assurance IS NULL, 0, lic.assurance)+IF(lic.autre_frais IS NULL, 0, lic.autre_frais)) AS cif_lic,
													lic.fob AS fob_lic,
													mon.sig_mon AS sig_mon,
													md.num_av AS num_av,
													md.poids AS poids,
													md.ref_fact AS ref_fact,
													md.fob AS fob,
													dos.fret AS fret,
													dos.assurance AS assurance,
													dos.autre_frais AS autre_frais,
													(IF(md.fob IS NULL, 0, md.fob) +IF(dos.fret IS NULL, 0, dos.fret)+IF(dos.assurance IS NULL, 0, dos.assurance)+IF(dos.autre_frais IS NULL, 0, dos.autre_frais)) AS cif_dos,
													dos.road_manif AS road_manif,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													CONCAT(
														IF(dos.fichier_apurement IS NOT NULL,
															CONCAT('
																<button class=\"btn btn-xs btn-primary square-btn-adjust\" title=\"Liasse documentaire\" onclick=\"window.open(\'../attch/',dos.fichier_apurement,'\',\'',dos.ref_dos,'\',\'width=1900,height=900\');\">
												                    <i class=\"fas fa-paperclip\"></i>
												                </button>'),
															''
														)
													) AS btn_fichier
												FROM transmission_apurement tr
													LEFT JOIN detail_apurement det
														ON det.id_trans_ap = tr.id_trans_ap
													LEFT JOIN dossier dos
														ON det.id_dos = dos.id_dos
													LEFT JOIN marchandise_dossier md
														ON md.id_dos = dos.id_dos
													LEFT JOIN licence lic
														ON SUBSTRING(lic.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
													LEFT JOIN monnaie mon
														ON lic.id_mon = mon.id_mon
												WHERE tr.id_trans_ap = ?");
				$requete-> execute(array($entree['id_trans_ap']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['date_exp'] = $this-> getDateExpirationLicence($reponse['num_lic']);
				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function dossiers_apurement2($id_trans_ap){
			include("connexion.php");

			$entree['id_trans_ap'] = $id_trans_ap;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													IF(lic.num_lic IS NOT NULL,
														lic.num_lic,
														md.num_lic
													) AS num_lic,
													-- exp.date_exp AS date_exp,
													(IF(lic.fob IS NULL, 0, lic.fob) +IF(lic.fret IS NULL, 0, lic.fret)+IF(lic.assurance IS NULL, 0, lic.assurance)+IF(lic.autre_frais IS NULL, 0, lic.autre_frais)) AS cif_lic,
													lic.fob AS fob_lic,
													mon.sig_mon AS sig_mon,
													md.num_av AS num_av,
													md.poids AS poids,
													md.ref_fact AS ref_fact,
													md.fob AS fob,
													dos.fret AS fret,
													dos.assurance AS assurance,
													dos.autre_frais AS autre_frais,
													(IF(md.fob IS NULL, 0, md.fob) +IF(dos.fret IS NULL, 0, dos.fret)+IF(dos.assurance IS NULL, 0, dos.assurance)+IF(dos.autre_frais IS NULL, 0, dos.autre_frais)) AS cif_dos,
													dos.road_manif AS road_manif,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													CONCAT(
														IF(dos.fichier_apurement IS NOT NULL,
															CONCAT('
																<button class=\"btn btn-xs btn-info square-btn-adjust\" title=\"Liasse documentaire\" onclick=\"window.open(\'../attch/',dos.fichier_apurement,'\',\'',dos.ref_dos,'\',\'width=1900,height=900\');\">
												                    <i class=\"fas fa-paperclip\"></i>
												                </button>'),
															''
														),
														' <button class=\"btn btn-xs bg bg-purple square-btn-adjust\" title=\"Liasse documentaire\" onclick=\"modal_upload_fichier_apurement(\'',dos.id_dos,'\', \'',dos.ref_dos,'\');\">
										                    <i class=\"fas fa-upload\"></i>
										                </button> '
													) AS btn_fichier
												FROM transmission_apurement tr
													LEFT JOIN detail_apurement det
														ON det.id_trans_ap = tr.id_trans_ap
													LEFT JOIN dossier dos
														ON det.id_dos = dos.id_dos
													LEFT JOIN marchandise_dossier md
														ON md.id_dos = dos.id_dos
													LEFT JOIN licence lic
														ON SUBSTRING(lic.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
													LEFT JOIN monnaie mon
														ON lic.id_mon = mon.id_mon
												WHERE tr.id_trans_ap = ?");
				$requete-> execute(array($entree['id_trans_ap']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['date_exp'] = $this-> getDateExpirationLicence($reponse['num_lic']);
				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function liste_dossier_transmit_apurement($id_trans_ap){
			include("connexion.php");

			$entree['id_trans_ap'] = $id_trans_ap;

			$compteur=0;
			$table = '';

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													IF(lic.num_lic IS NOT NULL,
														lic.num_lic,
														md.num_lic
													) AS num_lic,
													-- exp.date_exp AS date_exp,
													(IF(lic.fob IS NULL, 0, lic.fob) +IF(lic.fret IS NULL, 0, lic.fret)+IF(lic.assurance IS NULL, 0, lic.assurance)+IF(lic.autre_frais IS NULL, 0, lic.autre_frais)) AS cif_lic,
													lic.fob AS fob_lic,
													mon.sig_mon AS sig_mon,
													md.num_av AS num_av,
													md.poids AS poids,
													md.ref_fact AS ref_fact,
													md.fob AS fob,
													dos.fret AS fret,
													dos.assurance AS assurance,
													dos.autre_frais AS autre_frais,
													(IF(md.fob IS NULL, 0, md.fob) +IF(dos.fret IS NULL, 0, dos.fret)+IF(dos.assurance IS NULL, 0, dos.assurance)+IF(dos.autre_frais IS NULL, 0, dos.autre_frais)) AS cif_dos,
													dos.road_manif AS road_manif,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													CONCAT('<button class=\"btn btn-xs bg bg-danger square-btn-adjust\" title=\"Retirer le dossier\" onclick=\"remove_detail_apurement(\'',tr.id_trans_ap,'\', \'',dos.id_dos,'\');\">
										                    <i class=\"fas fa-times\"></i>
										                </button> '
													) AS btn_action
												FROM transmission_apurement tr
													LEFT JOIN detail_apurement det
														ON det.id_trans_ap = tr.id_trans_ap
													LEFT JOIN dossier dos
														ON det.id_dos = dos.id_dos
													LEFT JOIN marchandise_dossier md
														ON md.id_dos = dos.id_dos
													LEFT JOIN licence lic
														ON SUBSTRING(lic.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
													LEFT JOIN monnaie mon
														ON lic.id_mon = mon.id_mon
												WHERE tr.id_trans_ap = ?
												GROUP BY dos.id_dos");
				$requete-> execute(array($entree['id_trans_ap']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$table .= '<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['ref_dos'].'</td>
								<td>'.$reponse['num_lic'].'</td>
								<td>'.$reponse['ref_decl'].'</td>
								<td>'.$reponse['date_decl'].'</td>
								<td>'.$reponse['ref_liq'].'</td>
								<td>'.$reponse['date_liq'].'</td>
								<td>'.$reponse['ref_quit'].'</td>
								<td>'.$reponse['date_quit'].'</td>
								<td>'.$reponse['btn_action'].'</td>
							</tr>';
			}$requete-> closeCursor();

			return $table;

		}

		public function dossiers_en_attente_apurement($id_cli, $id_mod_lic, $num_lic, $date_quit_debut=null, $date_quit_fin=null){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				// $sqlClient = ' AND d.id_cli = "'.$id_cli.'"';

				$sqlClient = ' AND (d.id_cli = "'.$id_cli.'" 
									OR SUBSTRING(md.num_lic, 1, 10) IN (
											SELECT SUBSTRING(num_lic, 1, 10)
												FROM licence
												WHERE id_cli = "'.$id_cli.'"
										)
								)';
				$sqlClient2 = '';
				// $sqlClient2 = 'OR num_lic IN (
				// 						SELECT num_lic
				// 							FROM licence 
				// 							WHERE id_cli = "'.$id_cli.'"
				// 					)
				// 				';
			}else{
				$sqlClient = '';
				$sqlClient2 = "";
			}

			$sqlQuittance = '';

			if (isset($date_quit_debut) && ($date_quit_debut != '')) {
				$sqlQuittance = ' AND d.date_quit BETWEEN "'.$date_quit_debut.'" AND "'.$date_quit_fin.'"';
			}

			$sqlLicence = '';
			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic,
													-- d.ref_fact,
													-- d.fob AS fob, 
													-- d.ref_av AS ref_av, 
													-- d.montant_av AS montant_av,
													-- d.ref_fact AS ref_fact, 
													d.ref_decl AS ref_decl,
													d.ref_assurance AS ref_assurance,
													d.road_manif AS road_manif,
													-- d.fob AS fob,
													(IF(md.fob IS NULL, 0, md.fob) +IF(d.fret IS NULL, 0, d.fret)+IF(d.assurance IS NULL, 0, d.assurance)+IF(d.autre_frais IS NULL, 0, d.autre_frais)) AS cif_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													-- (d.fob+d.assurance+d.autre_frais+d.fret) AS cif,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(exp.date_exp, '%d/%m/%Y') AS date_exp,
													d.bur_douane AS bur_douane,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													d.ref_quit AS ref_quit,
													(IF(lic.fob IS NULL, 0, lic.fob) +IF(lic.fret IS NULL, 0, lic.fret)+IF(lic.assurance IS NULL, 0, lic.assurance)+IF(lic.autre_frais IS NULL, 0, lic.autre_frais)) AS cif_lic,
													lic.fob AS fob_lic,
													mon.sig_mon AS sig_mon,
													md.fob AS fob,
													md.num_av AS num_av,
													md.poids AS poids,
													md.ref_fact AS ref_fact,
													CONCAT(
														IF(d.fichier_apurement IS NOT NULL,
															CONCAT('
																<button class=\"btn btn-xs btn-dark square-btn-adjust\" title=\"Liasse documentaire\" onclick=\"window.open(\'../attch/',d.fichier_apurement,'\',\'',d.ref_dos,'\',\'width=1900,height=900\');\">
												                    <i class=\"fas fa-paperclip\"></i>
												                </button>'),
															''
														),
														' <button class=\"btn btn-xs bg bg-purple square-btn-adjust\" title=\"Liasse documentaire\" onclick=\"modal_upload_fichier_apurement(\'',d.id_dos,'\', \'',d.ref_dos,'\');\">
										                    <i class=\"fas fa-upload\"></i>
										                </button> '
													) AS btn_fichier
												FROM dossier d
													LEFT JOIN marchandise_dossier md
														ON md.id_dos = d.id_dos
															$sqlLicence
													LEFT JOIN expiration_licence exp
														ON SUBSTRING(md.num_lic, 1, 10) = SUBSTRING(exp.num_lic, 1, 10) 
															AND exp.id_etat = '1'
													LEFT JOIN licence lic
														ON SUBSTRING(md.num_lic, 1, 10) = SUBSTRING(lic.num_lic, 1, 10) 
													LEFT JOIN monnaie mon
														ON mon.id_mon = lic.id_mon
												WHERE d.id_mod_lic = ?
													$sqlClient
													AND d.ref_assurance IS NOT NULL
													AND TRIM(d.ref_assurance) <> ''
													AND d.ref_quit IS NOT NULL
													AND TRIM(d.ref_quit) <> ''
													AND d.ref_decl IS NOT NULL
													AND TRIM(d.ref_decl) <> ''
													AND d.not_apurement = '0'
													AND d.id_dos = md.id_dos
													AND trim(md.num_lic) <> 'N/A'
													AND trim(d.num_lic) <> 'N/A'
													AND md.num_lic <> 'UNDER VALUE'
													AND LENGTH(md.num_lic) > 4
													AND d.id_dos NOT IN(
															SELECT id_dos FROM detail_apurement
														)
													$sqlQuittance
												GROUP BY d.id_dos
												ORDER BY d.ref_dos ASC");
				$requete-> execute(array($entree['id_mod_lic']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function dossiers_en_attente_apurement_et_assurance($id_cli, $id_mod_lic, $num_lic, $date_quit_debut=null, $date_quit_fin=null){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				// $sqlClient = ' AND d.id_cli = "'.$id_cli.'"';

				$sqlClient = ' AND (d.id_cli = "'.$id_cli.'" 
									OR SUBSTRING(md.num_lic, 1, 10) IN (
											SELECT SUBSTRING(num_lic, 1, 10)
												FROM licence
												WHERE id_cli = "'.$id_cli.'"
										)
								)';
				$sqlClient2 = '';
				// $sqlClient2 = 'OR num_lic IN (
				// 						SELECT num_lic
				// 							FROM licence 
				// 							WHERE id_cli = "'.$id_cli.'"
				// 					)
				// 				';
			}else{
				$sqlClient = '';
				$sqlClient2 = "";
			}

			$sqlQuittance = '';

			if (isset($date_quit_debut) && ($date_quit_debut != '')) {
				$sqlQuittance = ' AND d.date_quit BETWEEN "'.$date_quit_debut.'" AND "'.$date_quit_fin.'"';
			}

			$sqlLicence = '';
			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic,
													-- d.ref_fact,
													-- d.fob AS fob, 
													-- d.ref_av AS ref_av, 
													-- d.montant_av AS montant_av,
													-- d.ref_fact AS ref_fact, 
													d.ref_decl AS ref_decl,
													d.ref_assurance AS ref_assurance,
													d.road_manif AS road_manif,
													-- d.fob AS fob,
													(IF(md.fob IS NULL, 0, md.fob) +IF(d.fret IS NULL, 0, d.fret)+IF(d.assurance IS NULL, 0, d.assurance)+IF(d.autre_frais IS NULL, 0, d.autre_frais)) AS cif_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													-- (d.fob+d.assurance+d.autre_frais+d.fret) AS cif,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(exp.date_exp, '%d/%m/%Y') AS date_exp,
													d.bur_douane AS bur_douane,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													d.ref_quit AS ref_quit,
													(IF(lic.fob IS NULL, 0, lic.fob) +IF(lic.fret IS NULL, 0, lic.fret)+IF(lic.assurance IS NULL, 0, lic.assurance)+IF(lic.autre_frais IS NULL, 0, lic.autre_frais)) AS cif_lic,
													lic.fob AS fob_lic,
													mon.sig_mon AS sig_mon,
													md.fob AS fob,
													md.num_av AS num_av,
													md.poids AS poids,
													md.ref_fact AS ref_fact,
													CONCAT(
														IF(d.fichier_apurement IS NOT NULL,
															CONCAT('
																<button class=\"btn btn-xs btn-dark square-btn-adjust\" title=\"Liasse documentaire\" onclick=\"window.open(\'../attch/',d.fichier_apurement,'\',\'',d.ref_dos,'\',\'width=1900,height=900\');\">
												                    <i class=\"fas fa-paperclip\"></i>
												                </button>'),
															''
														),
														' <button class=\"btn btn-xs bg bg-purple square-btn-adjust\" title=\"Liasse documentaire\" onclick=\"modal_upload_fichier_apurement(\'',d.id_dos,'\', \'',d.ref_dos,'\');\">
										                    <i class=\"fas fa-upload\"></i>
										                </button> '
													) AS btn_fichier
												FROM dossier d
													LEFT JOIN marchandise_dossier md
														ON md.id_dos = d.id_dos
															$sqlLicence
													LEFT JOIN expiration_licence exp
														ON SUBSTRING(md.num_lic, 1, 10) = SUBSTRING(exp.num_lic, 1, 10) 
															AND exp.id_etat = '1'
													LEFT JOIN licence lic
														ON SUBSTRING(md.num_lic, 1, 10) = SUBSTRING(lic.num_lic, 1, 10) 
													LEFT JOIN monnaie mon
														ON mon.id_mon = lic.id_mon
												WHERE d.id_mod_lic = ?
													$sqlClient
													AND (d.ref_assurance IS NULL OR TRIM(d.ref_assurance) = '')
													AND d.ref_quit IS NOT NULL
													AND TRIM(d.ref_quit) <> ''
													AND d.ref_decl IS NOT NULL
													AND TRIM(d.ref_decl) <> ''
													AND d.not_apurement = '0'
													AND d.id_dos = md.id_dos
													AND trim(md.num_lic) <> 'N/A'
													AND trim(d.num_lic) <> 'N/A'
													AND md.num_lic <> 'UNDER VALUE'
													AND LENGTH(md.num_lic) > 4
													AND d.id_dos NOT IN(
															SELECT id_dos FROM detail_apurement
														)
													$sqlQuittance
												GROUP BY d.id_dos
												ORDER BY d.ref_dos ASC");
				$requete-> execute(array($entree['id_mod_lic']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function transmis_en_attente_ar($id_cli, $id_mod_lic){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT tr.ref_trans_ap AS ref_trans_ap,
													DATE(tr.date_trans_ap) AS date_trans_ap,
													DATE_FORMAT(tr.date_envoi, '%d/%m/%Y %h:%i') AS date_envoi,
													COUNT(dos.id_dos) AS nbre_dos,
													CONCAT('<button class=\"btn btn-xs btn-success square-btn-adjust\" title=\"Exporter le fichier Excel\" onclick=\"window.location.replace(\'exportTransmissionApurement.php?id_cli=',tr.id_cli,'&id_mod_lic=',tr.id_mod_lic,'&id_trans_ap=',tr.id_trans_ap,'\',\'pop1\',\'width=80,height=80\');\">
								                      <i class=\"fas fa-file-excel\"></i>
								                    </button> 
								                    <button class=\"btn btn-xs btn-info square-btn-adjust\" title=\"Voir les details\" onclick=\"window.open(\'popUpDossiersApures2.php?id_cli=',tr.id_cli,'&id_mod_lic=',tr.id_mod_lic,'&id_trans_ap=',tr.id_trans_ap,'\',\'Details Transmit\',\'width=1800,height=800\');\">
								                      <i class=\"fas fa-list\"></i>
								                    </button>  
								                    <button class=\"btn btn-xs btn-primary square-btn-adjust\" title=\"Accuser Reception\" onclick=\"reception_transmit(',tr.id_trans_ap,');\">
								                      <i class=\"fas fa-check\"></i>
								                    </button>  
								                    <button class=\"btn btn-xs btn-danger square-btn-adjust\" title=\"Retourner Transmit\" onclick=\"modal_rejet_transmit(',tr.id_trans_ap,', \'',tr.ref_trans_ap,'\');\">
								                      <i class=\"fas fa-times\"></i>
								                    </button>
								                    <form method=\'POST\' action=\'\'>
														<input type=\'hidden\' name=\'id_trans_ap\' value=\'',tr.id_trans_ap,'\'>
														<input type=\'hidden\' name=\'ref_trans_ap\' value=\'',tr.ref_trans_ap,'\'>
														<button type=\'submit\' name=\'download_all_file_transmit_apurement\' class=\"btn btn-xs bg bg-purple\"><i class=\'fa fa-download\'></i></button>
													</form>') AS btn_action
												FROM transmission_apurement tr, detail_apurement det, dossier dos
												WHERE tr.id_cli = ?
													AND tr.id_mod_lic = ?
													AND tr.id_trans_ap = det.id_trans_ap 
													AND dos.id_dos = det.id_dos
													AND tr.fichier_trans_ap IS NULL
													AND tr.date_recep IS NULL
													AND tr.date_envoi IS NOT NULL
													AND tr.date_rejet IS NULL
													AND tr.not_envoi = '0'
												GROUP BY tr.id_trans_ap");
				$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function transmis_avec_ar($id_cli, $id_mod_lic){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT tr.ref_trans_ap AS ref_trans_ap,
													DATE(tr.date_trans_ap) AS date_trans_ap,
													-- DATE_FORMAT(tr.date_envoi, '%d/%m/%Y %h:%i') AS date_envoi,
													IF(tr.date_recep IS NULL,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y %h:%i'),
														DATE_FORMAT(tr.date_recep, '%d/%m/%Y %h:%i')
													) AS date_recep,
													IF(tr.date_envoi IS NULL,
														DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y %h:%i'),
														DATE_FORMAT(tr.date_envoi, '%d/%m/%Y %h:%i')
													) AS date_envoi,
													COUNT(dos.id_dos) AS nbre_dos,
													CONCAT('<button class=\"btn btn-xs btn-success square-btn-adjust\" title=\"Exporter le fichier Excel\" onclick=\"window.location.replace(\'exportTransmissionApurement.php?id_cli=',tr.id_cli,'&id_mod_lic=',tr.id_mod_lic,'&id_trans_ap=',tr.id_trans_ap,'\',\'pop1\',\'width=80,height=80\');\">
								                      <i class=\"fas fa-file-excel\"></i>
								                    </button> 
								                    <button class=\"btn btn-xs btn-info square-btn-adjust\" title=\"Voir les details\" onclick=\"window.open(\'popUpDossiersApures2.php?id_cli=',tr.id_cli,'&id_mod_lic=',tr.id_mod_lic,'&id_trans_ap=',tr.id_trans_ap,'\',\'Details Transmit\',\'width=1800,height=800\');\">
								                      <i class=\"fas fa-list\"></i>
								                    </button> ',
									                    IF(tr.fichier_trans_ap IS NOT NULL,
									                    	CONCAT('<button class=\"btn btn-xs btn-primary square-btn-adjust\" onclick=\"window.open(\'../transmision_apurements/',tr.id_trans_ap,'/',tr.fichier_trans_ap,'\',\'pop1\',\'width=1900,height=900\');\">
											                    <i class=\"fas fa-file\"></i> A/R
											                </button>'),
											                ''
									                    ),
									                    '
								                    <form method=\'POST\' action=\'\'>
														<input type=\'hidden\' name=\'id_trans_ap\' value=\'',tr.id_trans_ap,'\'>
														<input type=\'hidden\' name=\'ref_trans_ap\' value=\'',tr.ref_trans_ap,'\'>
														<button type=\'submit\' name=\'download_all_file_transmit_apurement\' class=\"btn btn-xs bg bg-purple\"><i class=\'fa fa-download\'></i></button>
													</form>'
								                    ) AS btn_action
												FROM transmission_apurement tr, detail_apurement det, dossier dos
												WHERE tr.id_cli = ?
													AND tr.id_mod_lic = ?
													AND tr.id_trans_ap = det.id_trans_ap 
													AND dos.id_dos = det.id_dos
													AND (tr.fichier_trans_ap IS NOT NULL
														OR tr.date_recep IS NOT NULL
														OR tr.not_envoi = '1')
												GROUP BY tr.id_trans_ap
												ORDER BY tr.id_trans_ap DESC");
				$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function transmis_rejet($id_cli, $id_mod_lic){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT tr.ref_trans_ap AS ref_trans_ap,
													DATE(tr.date_trans_ap) AS date_trans_ap,
													-- DATE_FORMAT(tr.date_envoi, '%d/%m/%Y %h:%i') AS date_envoi,
													DATE_FORMAT(tr.date_envoi, '%d/%m/%Y %h:%i') AS date_envoi,
													DATE_FORMAT(tr.date_rejet, '%d/%m/%Y %h:%i') AS date_rejet,
													tr.motif AS motif,
													COUNT(dos.id_dos) AS nbre_dos,
													CONCAT('<button class=\"btn btn-xs btn-success square-btn-adjust\" title=\"Exporter le fichier Excel\" onclick=\"window.location.replace(\'exportTransmissionApurement.php?id_cli=',tr.id_cli,'&id_mod_lic=',tr.id_mod_lic,'&id_trans_ap=',tr.id_trans_ap,'\',\'pop1\',\'width=80,height=80\');\">
								                      <i class=\"fas fa-file-excel\"></i>
								                    </button> 
								                    <button class=\"btn btn-xs btn-info square-btn-adjust\" title=\"Voir les details\" onclick=\"window.open(\'popUpDossiersApures2.php?id_cli=',tr.id_cli,'&id_mod_lic=',tr.id_mod_lic,'&id_trans_ap=',tr.id_trans_ap,'\',\'Details Transmit\',\'width=1800,height=800\');\">
								                      <i class=\"fas fa-list\"></i>
								                    </button> ',
									                    IF(tr.fichier_trans_ap IS NOT NULL,
									                    	CONCAT('<button class=\"btn btn-xs btn-primary square-btn-adjust\" onclick=\"window.open(\'../transmision_apurements/',tr.id_trans_ap,'/',tr.fichier_trans_ap,'\',\'pop1\',\'width=1900,height=900\');\">
											                    <i class=\"fas fa-file\"></i> A/R
											                </button>'),
											                ''
									                    ),
									                    '
								                    <form method=\'POST\' action=\'\'>
														<input type=\'hidden\' name=\'id_trans_ap\' value=\'',tr.id_trans_ap,'\'>
														<input type=\'hidden\' name=\'ref_trans_ap\' value=\'',tr.ref_trans_ap,'\'>
														<button type=\'submit\' name=\'download_all_file_transmit_apurement\' class=\"btn btn-xs bg bg-purple\"><i class=\'fa fa-download\'></i></button>
													</form>'
								                    ) AS btn_action
												FROM transmission_apurement tr, detail_apurement det, dossier dos
												WHERE tr.id_cli = ?
													AND tr.id_mod_lic = ?
													AND tr.id_trans_ap = det.id_trans_ap 
													AND dos.id_dos = det.id_dos
													AND tr.date_rejet IS NOT NULL
												GROUP BY tr.id_trans_ap
												ORDER BY tr.id_trans_ap DESC");
				$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			return $row;

		}

		public function dashboard_licence_notification($id_mod_lic, $id_cli, $notification, $debut=null, $fin=null){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;
			$row = array();

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND l.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($debut) && ($debut!='') && isset($fin) && ($fin!='')) {
				$sqlIntervalle = ' AND l.date_val BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}else{
				$sqlIntervalle = '';
			}

			if (isset($notification) && ($notification=='Apurement Total')) {

				// $sqlNotification = ' AND l.fob=l.fob_apure';
				$sqlNotification = ' AND ((l.fob-l.fob_apure)>=(-1*l.fob*0.05) AND (l.fob-l.fob_apure)<=(l.fob*0.05))';

			}else if (isset($notification) && ($notification=='Apurement Partiel')) {

				// $sqlNotification = ' AND l.fob>l.fob_apure AND l.fob_apure>0';
				$sqlNotification = ' AND l.fob_apure>0 AND ((l.fob-l.fob_apure)>(l.fob*0.05))';

			}else if (isset($notification) && ($notification=='Depassement')) {

				// $sqlNotification = ' AND l.fob<l.fob_apure';
				$sqlNotification = ' AND (l.fob-l.fob_apure)<(-1*l.fob*0.05)';

			}else if (isset($notification) && ($notification=='Non utilisees')) {

				$sqlNotification = ' AND (l.fob_apure=0 OR l.fob_apure IS NULL)';
				
			}else{
				$sqlNotification = '';
			}

			if ($id_mod_lic==2) {
				if ($notification=='Expiration -40 Jours') {
					$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
															cl.code_cli AS code_cli,
															DATE_FORMAT(l.date_val,'%d/%m/%Y') AS date_val,
															DATE_FORMAT(exp.date_exp,'%d/%m/%Y') AS date_exp,
															l.fob AS fob,
															l.fob_apure AS fob_apure,
															CONCAT('<a href=\'#\' onclick=\"window.open(\'popUpMarchandiseDossierLicence.php?num_lic=',l.num_lic,'&couleur=\',\'Dossiers ',l.num_lic,'\',\'width=900,height=900\');\">',COUNT(md.id_march_dos),'</a>') AS nbre_dos,
															(IF(l.fob IS NOT NULL, l.fob, 0)-IF(l.fob_apure IS NOT NULL, l.fob_apure, 0)) AS ecart,
															(((l.fob-l.fob_apure)*100)/l.fob) AS pourcentage_ecart
														FROM licence l, expiration_licence exp, marchandise_dossier md, client cl
														WHERE l.num_lic = exp.num_lic
															AND exp.id_etat='1'
															AND l.num_lic = md.num_lic
															AND l.id_cli = cl.id_cli
															AND l.id_mod_lic = ?
															AND (
																	(l.fob_apure<l.fob AND DATEDIFF(CURRENT_DATE(), exp.date_exp) <= 40)
																	AND
																	(CURRENT_DATE()<=DATE(exp.date_exp))
																	AND (((l.fob-l.fob_apure)*100)/l.fob)>0.5
																)
															$sqlClient
															$sqlNotification
															$sqlIntervalle
														GROUP BY l.num_lic");
				}else if ($notification=='Expirees') {
					$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
															cl.code_cli AS code_cli,
															DATE_FORMAT(l.date_val,'%d/%m/%Y') AS date_val,
															DATE_FORMAT(exp.date_exp,'%d/%m/%Y') AS date_exp,
															l.fob AS fob,
															l.fob_apure AS fob_apure,
															CONCAT('<a href=\'#\' onclick=\"window.open(\'popUpMarchandiseDossierLicence.php?num_lic=',l.num_lic,'&couleur=\',\'Dossiers ',l.num_lic,'\',\'width=900,height=900\');\">',COUNT(md.id_march_dos),'</a>') AS nbre_dos,
															(IF(l.fob IS NOT NULL, l.fob, 0)-IF(l.fob_apure IS NOT NULL, l.fob_apure, 0)) AS ecart,
															(((l.fob-l.fob_apure)*100)/l.fob) AS pourcentage_ecart
														FROM licence l, expiration_licence exp, marchandise_dossier md, client cl
														WHERE l.num_lic = exp.num_lic
															AND exp.id_etat='1'
															AND l.num_lic = md.num_lic
															AND l.id_cli = cl.id_cli
															AND l.id_mod_lic = ?
														AND (l.fob_apure<l.fob AND (CURRENT_DATE()>DATE(exp.date_exp)))
														AND (((l.fob-l.fob_apure)*100)/l.fob)>0.5
															$sqlClient
															$sqlNotification
															$sqlIntervalle
														GROUP BY l.num_lic");
				}else{
					$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
															cl.code_cli AS code_cli,
															DATE_FORMAT(l.date_val,'%d/%m/%Y') AS date_val,
															DATE_FORMAT(exp.date_exp,'%d/%m/%Y') AS date_exp,
															l.fob AS fob,
															l.fob_apure AS fob_apure,
															CONCAT('<a href=\'#\' onclick=\"window.open(\'popUpMarchandiseDossierLicence.php?num_lic=',l.num_lic,'&couleur=\',\'Dossiers ',l.num_lic,'\',\'width=900,height=900\');\">',COUNT(md.id_march_dos),'</a>') AS nbre_dos,
															(IF(l.fob IS NOT NULL, l.fob, 0)-IF(l.fob_apure IS NOT NULL, l.fob_apure, 0)) AS ecart,
															(((l.fob-l.fob_apure)*100)/l.fob) AS pourcentage_ecart
														FROM licence l
															LEFT JOIN expiration_licence exp
																ON l.num_lic = exp.num_lic
																	AND exp.id_etat='1'
															LEFT JOIN marchandise_dossier md
																ON l.num_lic = md.num_lic
															LEFT JOIN client cl
																ON l.id_cli = cl.id_cli
														WHERE l.id_mod_lic = ?
															$sqlClient
															$sqlNotification
															$sqlIntervalle
														GROUP BY l.num_lic");
				}
				
				$requete-> execute(array($entree['id_mod_lic']));
				while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			}
			return $row;

		}

		public function dossier_transmit_client($id_cli, $id_mod_lic){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													md.ref_fact AS ref_fact,
													md.fob AS fob,
													md.num_av AS num_av,
													tr.ref_trans_ap AS ref_trans_ap,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													IF(tr.fichier_trans_ap IS NOT NULL,
														CONCAT('<button class=\"btn btn-xs btn-dark\" onclick=\"window.open(\'../transmision_apurements/',tr.id_trans_ap,'/',tr.fichier_trans_ap,'\',\'pop1\',\'width=1900,height=900\')\">
															<i class=\"fa fa-file\"></i>
														</button>'),
														''
													) AS fichier_trans_ap
												FROM dossier dos, marchandise_dossier md, detail_apurement det, transmission_apurement tr, licence l
												WHERE dos.id_mod_lic = ?
													AND md.id_dos = dos.id_dos
													AND md.num_lic = l.num_lic
													AND det.id_dos = dos.id_dos
													AND tr.id_trans_ap = det.id_trans_ap
												 	AND (dos.id_cli = ? OR l.id_cli = ? )
													");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			
			return $row;

		}

		public function dossier_non_transmit_client($id_cli, $id_mod_lic){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													md.ref_fact AS ref_fact,
													SUM(md.fob) AS fob,
													md.num_av AS num_av,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier dos, marchandise_dossier md, licence l
												WHERE dos.id_mod_lic = ?
													AND dos.id_dos = md.id_dos
													AND md.num_lic = l.num_lic
													AND ( dos.id_cli = ? OR l.id_cli = ?)
													AND dos.id_dos NOT IN(SELECT id_dos FROM detail_apurement)
													AND dos.not_apurement = '0'
													AND dos.ref_quit IS NOT NULL
													AND dos.date_quit IS NOT NULL
												GROUP BY dos.id_dos");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			
			return $row;

		}

		public function rapportAAST($id_mod_lic, $id_cli, $debut, $fin){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND dos.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($debut) && ($debut!='') && isset($fin) && ($fin!='')) {
				$sqlPeriode = ' AND dos.dgda_manif_date BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}else{
				$sqlPeriode = '';
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													cl.code_cli AS code_cli,
													dos.t1 AS t1,
													DATE_FORMAT(dos.t1_date, '%d/%m/%Y') AS t1_date,
													dos.trs AS trs,
													DATE_FORMAT(dos.trs_date, '%d/%m/%Y') AS trs_date,
													dos.dgda_manif AS dgda_manif,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier dos, client cl
												WHERE dos.id_cli = cl.id_cli
													AND dos.id_mod_lic = ?
													AND dos.dgda_manif IS NOT NULL
													AND dos.dgda_manif <> ''
													$sqlClient
													$sqlPeriode
												ORDER BY dos.id_dos");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			
			return $row;

		}

		public function rapportSansAAST($id_mod_lic, $id_cli, $debut, $fin){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND dos.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($debut) && ($debut!='') && isset($fin) && ($fin!='')) {
				$sqlPeriode = ' AND dos.t1_date BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}else{
				$sqlPeriode = '';
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													cl.code_cli AS code_cli,
													dos.t1 AS t1,
													DATE_FORMAT(dos.t1_date, '%d/%m/%Y') AS t1_date,
													dos.trs AS trs,
													DATE_FORMAT(dos.trs_date, '%d/%m/%Y') AS trs_date,
													dos.dgda_manif AS dgda_manif,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier dos, client cl
												WHERE dos.id_cli = cl.id_cli
													AND dos.id_mod_lic = ?
													AND dos.ref_decl IS NOT NULL
													AND REPLACE(dos.ref_decl, ' ', '') <> ''
													AND (dos.dgda_manif IS NULL
														OR dos.dgda_manif = '')
													$sqlClient
													$sqlPeriode
												ORDER BY dos.id_dos");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;
			}$requete-> closeCursor();

			
			return $row;

		}

		public function getNombreNotificationLicence($id_mod_lic, $debut=NULL, $fin=NULL){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;
			$row = array();

			if (isset($debut) && ($debut!='') && isset($fin) && ($fin!='')) {
				$sqlIntervalle = ' AND lic.date_val BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}else{
				$sqlIntervalle = '';
			}

			// if ($id_mod_lic==2) {
				$requete = $connexion-> prepare("SELECT COUNT(lic.num_lic) AS total_licence,
													COUNT(
														IF((lic.fob-lic.fob_apure)>=(-1*lic.fob*0.05) AND (lic.fob-lic.fob_apure)<=(lic.fob*0.05),
															-- lic.fob=lic.fob_apure,
															lic.num_lic,
															-- 1,
															NULL
															)
													) AS nbre_licence_apurement_total,
													COUNT(
														IF(lic.fob_apure>0 AND (lic.fob-lic.fob_apure)>(lic.fob*0.05),
															-- lic.fob>lic.fob_apure AND lic.fob_apure>0,
															lic.num_lic,
															-- 1,
															NULL
															)
													) AS nbre_licence_apurement_partiel,
													COUNT(
														IF((lic.fob-lic.fob_apure)<(-1*lic.fob*0.05),
															-- lic.fob<lic.fob_apure,
															lic.num_lic,
															-- 1,
															NULL
															)
													) AS nbre_licence_apurement_depassement,
													COUNT(
														IF(lic.fob_apure=0 OR lic.fob_apure IS NULL,
															lic.num_lic,
															-- 1,
															NULL
														)
													) AS nbre_licence_non_apuree
												FROM licence lic
												WHERE lic.id_mod_lic = ?
													$sqlIntervalle");
				$requete-> execute(array($entree['id_mod_lic']));
				$reponse = $requete-> fetch();

			// }
			return $reponse;

		}

		public function getNombreNotificationLicence2($id_mod_lic, $debut=NULL, $fin=NULL){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;
			$row = array();

			if (isset($debut) && ($debut!='') && isset($fin) && ($fin!='')) {
				$sqlIntervalle = ' AND lic.date_val BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}else{
				$sqlIntervalle = '';
			}

			// if ($id_mod_lic==2) {
				$requete = $connexion-> prepare("SELECT COUNT(lic.num_lic) AS total_licence,
													COUNT(
														IF(lic.fob_apure<lic.fob AND (CURRENT_DATE()>DATE(exp.date_exp)) AND (((lic.fob-lic.fob_apure)*100)/lic.fob)>0.5,
															lic.num_lic,
															NULL
														)
													) AS nbre_licence_expiree,
													COUNT(
														IF(lic.fob_apure<lic.fob AND DATEDIFF(CURRENT_DATE(), exp.date_exp) <= 40 AND (CURRENT_DATE()<=DATE(exp.date_exp)) AND (((lic.fob-lic.fob_apure)*100)/lic.fob)>0.5,
															lic.num_lic,
															NULL
														)
													) AS nbre_licence_40
												FROM licence lic, expiration_licence exp
												WHERE lic.id_mod_lic = ?
													AND lic.num_lic = exp.num_lic
													AND exp.id_etat='1'
													$sqlIntervalle");
				$requete-> execute(array($entree['id_mod_lic']));
				$reponse = $requete-> fetch();

			// }
			return $reponse;

		}

		public function total_licence_client($id_mod_lic, $id_cli){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;


			$requete = $connexion-> prepare("SELECT COUNT(num_lic) AS nbre
												FROM licence
													WHERE id_mod_lic = ?
														AND id_cli = ?");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];

		}

		public function total_nbre_licence_apurement_total($id_mod_lic, $id_cli){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;


			$requete = $connexion-> prepare("SELECT COUNT(l.num_lic) AS nbre
												FROM licence l
												WHERE l.fob = (
													SELECT SUM(md.fob)
													FROM transmission_apurement tr, detail_apurement det, dossier d, marchandise_dossier md
													WHERE SUBSTRING(l.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
														AND md.id_dos = d.id_dos
														AND d.id_dos = det.id_dos
														AND det.id_trans_ap = tr.id_trans_ap
														AND tr.fichier_trans_ap IS NOT NULL
													)

													AND l.id_mod_lic = ?
													AND l.id_cli = ?
													");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}else{
				return 0;
			}

		}
		
		public function total_nbre_licence_apurement_partiel($id_mod_lic, $id_cli){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;


			$requete = $connexion-> prepare("SELECT COUNT(l.num_lic) AS nbre
												FROM licence l
												WHERE l.fob = (
													SELECT SUM(md.fob)
													FROM transmission_apurement tr, detail_apurement det, dossier d, marchandise_dossier md
													WHERE SUBSTRING(l.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
														AND md.id_dos = d.id_dos
														AND d.id_dos = det.id_dos
														AND det.id_trans_ap = tr.id_trans_ap
														AND tr.fichier_trans_ap IS NULL
													)

													AND l.id_mod_lic = ?
													AND l.id_cli = ?
													");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}else{
				return 0;
			}

		}
		
		public function total_nbre_licence_apurement($id_mod_lic, $id_cli){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;


			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(l.num_lic)) AS nbre
												FROM licence l, transmission_apurement tr, detail_apurement det, dossier d, marchandise_dossier md
													WHERE l.id_mod_lic = ?
														AND l.id_cli = ?
														AND SUBSTRING(l.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
														AND md.id_dos = d.id_dos
														AND d.id_dos = det.id_dos
														AND det.id_trans_ap = tr.id_trans_ap
														AND tr.fichier_trans_ap IS NOT NULL
													");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}else{
				return 0;
			}

		}
		
		public function detail_client_crm($id_cli, $id_mod_lic=null, $annee=NULL){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$table = '';

			if (!empty($id_mod_lic) && ($id_mod_lic!='')) {
				$sqlModeLicence = " AND cl.id_cli = $id_cli AND cl.id_cli IN (SELECT id_cli FROM affectation_client_modele_licence WHERE id_mod_lic = $id_mod_lic)";
				$sqlModeLicenceForPrevision = " AND prev.id_mod_lic = $id_mod_lic";
				$sqlModeLicenceForFacture = " AND fd.id_mod_lic = $id_mod_lic";
				$sqlModeLicenceForDossier = " AND dos.id_mod_lic = $id_mod_lic";
			}else{
				$sqlModeLicence = " AND cl.id_cli = $id_cli";
				$sqlModeLicenceForPrevision = "";
				$sqlModeLicenceForFacture = "";
				$sqlModeLicenceForDossier = "";
			}

			if (!empty($annee) && ($annee!='')) {
				$sqlAnneeForPrevision = " AND prev.annee = '$annee'";
				$sqlAnneeForFacture = " AND YEAR(fd.date_fact) = '$annee'";
				$sqlAnneeForDossier = " AND YEAR(dos.date_creat_dos) = '$annee'";
			}else{
				$sqlAnneeForPrevision = "";
				$sqlAnneeForFacture = "";
				$sqlAnneeForDossier = "";
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> query("SELECT cl.*,
													prev.annee AS annee,
													ml.nom_mod_lic AS nom_mod_lic,
													mt.nom_mod_trans AS nom_mod_trans,
													march.nom_march AS nom_march,
													prev.honoraire AS honoraire,
													prev.ops_cost AS ops_cost,
													prev.nbre_dos AS nbre_dos
											FROM client cl, prevision_crm prev, mode_transport mt, marchandise march, modele_licence ml
											WHERE prev.id_cli = cl.id_cli
												AND ml.id_mod_lic = prev.id_mod_lic
												AND mt.id_mod_trans = prev.id_mod_trans
												AND march.id_march = prev.id_march
													$sqlModeLicenceForPrevision
													$sqlAnneeForPrevision
													$sqlModeLicence
											ORDER BY prev.date_create DESC");
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$table .= '<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['annee'].'</td>
								<td>'.$reponse['nom_mod_lic'].'</td>
								<td>'.$reponse['nom_mod_trans'].'</td>
								<td>'.$reponse['nom_march'].'</td>
								<td>'.$reponse['nbre_dos'].'</td>
								<td>'.$reponse['honoraire'].'</td>
								<td>'.$reponse['ops_cost'].'</td>
							</tr>';
			}$requete-> closeCursor();

			return $table;
		}

		public function ajout_prevision($id_cli, $id_mod_lic, $id_mod_trans, $id_march, $annee, $nbre_dos, $ops_cost, $honoraire){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;
			$entree['annee'] = $annee;
			$entree['nbre_dos'] = $nbre_dos;
			$entree['ops_cost'] = $ops_cost;
			$entree['honoraire'] = $honoraire;

			$requete = $connexion-> prepare("INSERT INTO prevision_crm(id_cli, id_mod_lic, id_mod_trans, id_march, annee, nbre_dos, ops_cost, honoraire, id_util)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_march'], $entree['annee'], $entree['nbre_dos'], $entree['ops_cost'], $entree['honoraire'], $_SESSION['id_util']));
		}

		public function afficherClientCRMAjaxGraphique1($id_mod_lic=null, $annee=null){
			include("connexion.php");

			if (!empty($id_mod_lic) && ($id_mod_lic!='')) {
				$sqlModeLicence = " WHERE cl.id_cli IN (SELECT id_cli FROM affectation_client_modele_licence WHERE id_mod_lic = $id_mod_lic)";
				$sqlModeLicenceForPrevision = " AND prev.id_mod_lic = $id_mod_lic";
				$sqlModeLicenceForFacture = " AND fd.id_mod_lic = $id_mod_lic";
				$sqlModeLicenceForDossier = " AND dos.id_mod_lic = $id_mod_lic";
			}else{
				$sqlModeLicence = "";
				$sqlModeLicenceForPrevision = "";
				$sqlModeLicenceForFacture = "";
				$sqlModeLicenceForDossier = "";
			}

			if (!empty($annee) && ($annee!='')) {
				$sqlAnneeForPrevision = " AND prev.annee = '$annee'";
				$sqlAnneeForFacture = " AND YEAR(fd.date_fact) = '$annee'";
				$sqlAnneeForDossier = " AND YEAR(dos.date_creat_dos) = $annee";
			}else{
				$sqlAnneeForPrevision = "";
				$sqlAnneeForFacture = "";
				$sqlAnneeForDossier = "";
			}

			$compteur=0;
			// $row = array();
			$data = '';

			$requete = $connexion-> query("SELECT cl.*,
													COUNT(dos.id_dos) AS nbre_dos,
													IF(prev.id_cli IS NOT NULL,
														SUM(prev.nbre_dos),
														'-'
													) AS nbre_dos_prev,
													IF(prev.id_cli IS NOT NULL,
														COUNT(dos.id_dos)-SUM(prev.nbre_dos),
														'-'
													) AS ecart_dos
											FROM client cl
												LEFT JOIN dossier dos
													ON dos.id_cli = cl.id_cli
														AND dos.ref_dos NOT LIKE '%test%'
														$sqlModeLicenceForDossier
														$sqlAnneeForDossier
												LEFT JOIN prevision_crm prev
													ON prev.id_cli = cl.id_cli
													$sqlModeLicenceForPrevision
													$sqlAnneeForPrevision
												-- LEFT JOIN detail_facture_dossier det
												-- 	ON det.id_dos = dos.id_dos
												-- LEFT JOIN facture_dossier fd
												-- 	ON fd.ref_fact = det.ref_fact
												-- 	$sqlModeLicenceForFacture
												-- 	$sqlAnneeForFacture
												-- LEFT JOIN debours deb
												-- 	ON det.id_deb = deb.id_deb
											$sqlModeLicence
											GROUP BY cl.id_cli
											ORDER BY cl.nom_cli ASC");
			while ($reponse = $requete-> fetch()) {
				$data .= '{ name: "'.$reponse['nom_cli'].'", y: '.$reponse['nbre_dos'].' },';
			}$requete-> closeCursor();

			return $data;
		}

		public function afficherUtilisateur($premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");

			$compteur=$premiere_entree;

			$requete = $connexion-> query("SELECT u.*, r.*,
												IF(u.active='1', 'Compte Actif', 'Compte Non-Actif') AS active,
												IF(u.active='1', 'badge bg-primary', 'badge bg-danger') AS bg_active,
												IF(u.active='0', 'text-danger', '') AS class_text
											FROM utilisateur u, role r
											WHERE u.id_role = r.id_role
											ORDER BY u.nom_util ASC
											LIMIT $premiere_entree, $nombre_dossier_par_page");
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				//include('modalEditTicket.php');

			?>
			<tr class="<?php echo $reponse['class_text'];?>">
				<td class="" style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: left;">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['pseudo_util'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php echo $reponse['nom_role'];?>
				</td>
				<td class="" style="text-align: center;">
					<div class="<?php echo $reponse['bg_active'];?>">
						<?php echo $reponse['active'];?>
					</div>
				</td>
				<td class="" style="text-align: center;">
					<!-- <button class="btn btn-block btn-warning btn-xs" data-toggle="modal" data-target=".editClient_<?php echo $reponse['id_util'];?>">
							Modifier
						</button> -->
					<button class="btn btn-xs btn-warning square-btn-adjust btn-xs" onclick="window.location.replace('editCompteUtilisateur.php?id_util=<?php echo $reponse['id_util'];?>','pop1','width=80,height=80');">
                       <i class="fas fa-edit"></i> Editer
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherUtilisateurAjax(){
			include("connexion.php");

			$compteur=0;

			$rows = array();

			$requete = $connexion-> query("SELECT u.*, r.*,
												IF(u.active='1', '<span class=\'badge bg-primary\'>Compte Actif</span>', '<span class=\'badge bg-danger\'>Compte Non-Actif</span>') AS active,
												IF(u.active='1', 'badge bg-primary', 'badge bg-danger') AS bg_active,
												IF(u.active='0', 'text-danger', '') AS class_text,
												CONCAT('<button class=\"btn btn-xs btn-warning square-btn-adjust btn-xs\" onclick=\"window.location.replace(\'editCompteUtilisateur.php?id_util=',id_util,'\');\">
									                       <i class=\"fas fa-edit\"></i> Editer
									                    </button>') AS btn
											FROM utilisateur u, role r
											WHERE u.id_role = r.id_role
											ORDER BY u.nom_util ASC");
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
				$reponse['compteur'] = $compteur;

				$rows[] = $reponse;

			}$requete-> closeCursor();

			if ($rows) {
				return $rows;
			}else{
				return null;
			}

		}

		public function getNombreTicket($id_util=NULL){
			include("connexion.php");
			$entree['id_util'] = $id_util;

			$compteur=0;

			if (isset($id_util) && ($id_util!='')) {
				$sqlUser = ' AND u.id_util = "'.$id_util.'"';
			}else{
				$sqlUser = '';
			}

			$requete = $connexion-> query("SELECT COUNT(t.id_tick) AS nbre
 												FROM ticket t, priorite prio, statut_ticket st, module, utilisateur u
												WHERE t.id_util_emet = u.id_util
													$sqlUser
													AND t.id_prio = prio.id_prio
													AND t.id_stat = st.id_stat
													AND t.id_mod = module.id_mod
												ORDER BY t.id_tick DESC");
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNombreClient(){
			include("connexion.php");

			$compteur=0;


			$requete = $connexion-> query("SELECT COUNT(id_cli) AS nbre
 												FROM client");
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNombreUtilisateur(){
			include("connexion.php");

			$compteur=0;


			$requete = $connexion-> query("SELECT COUNT(id_util) AS nbre
 												FROM utilisateur");
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function afficherDossierNonFacture($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND c.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, 
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													d.ref_quit AS ref_quit,
													UPPER(c.nom_cli) AS nom_cli
											FROM dossier d, client c
											WHERE d.id_mod_lic = ?
												AND d.id_dos NOT IN(
													SELECT dos.id_dos AS id_dos
		 												FROM facture_dossier fd, client cl, utilisateur u, detail_facture_dossier det, dossier dos
														WHERE fd.id_util = u.id_util
															AND fd.id_cli = cl.id_cli
															AND fd.note_debit = '0'
															AND fd.ref_fact = det.ref_fact
															AND det.id_dos = dos.id_dos
														GROUP BY dos.id_dos
												)
												$sqlClient
												AND d.date_quit IS NOT NULL
												AND d.ref_quit IS NOT NULL
												AND d.etat_feuil_calc = '1'
													AND d.id_cli = c.id_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				//include('modalFacturationDossier.php');

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherClientCRM($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;//$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_lic) && ($id_mod_lic!='')) {
				$sqlModeLicence = ' AND cl.id_mod_lic = "'.$id_mod_lic.'"';
			}else{
				$sqlModeLicence = '';
			}

			//$bg = "background-color: #FA8072;";
			$bg='';
			$class = "";

			$debut = $compteur;

			$requete = $connexion-> query("SELECT client.*, 
													ROUND(SUM((affectation_client_domaine.volume*affectation_client_domaine.honnoraire*(affectation_client_domaine.target_init/100)))) AS valeur,
													UPPER(client.etat_cli) AS etat_cli_maj
												FROM client
												LEFT JOIN affectation_client_domaine ON client.id_cli = affectation_client_domaine.id_cli
												GROUP BY client.id_cli
												ORDER BY client.nom_cli");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditClient.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_cli_<?php echo $compteur;?>" value="<?php echo $reponse['id_cli'];?>">
				<td style="text-align: center;" class="<?php echo $class;?>" style=" <?php echo $bg;?>" >
					<?php echo $compteur;?>
				</td>
				<td class="<?php echo $class;?>" style=" <?php echo $bg;?>" >
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td>
				<?php 
					echo $reponse['info_cli'];
				?>
				</td>
				<td>
				<?php 
					echo $reponse['ville_cli'];
				?>
				</td>
				<td>
				<?php 
					echo $reponse['account_manager'];
				?>
				</td>
				<td style="text-align: center;">
				<?php 
				  if ($reponse['etat_cli']=='Prospect') {
	                echo '<span class="badge bg bg-danger">'.$reponse['etat_cli_maj'].'</span>';
	              }else if ($reponse['etat_cli']=='Client') {
	                echo '<span class="badge bg bg-success">'.$reponse['etat_cli_maj'].'</span>';
	              }
				?>
				</td>
				<td class="" style="text-align: right;" class="">
					<?php echo '$ '.number_format( $reponse['valeur'], 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<button class="btn btn-primary btn-sm" onclick="window.location.replace('detailClientCRM.php?id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_lic_crm=','pop1','width=80,height=80');">
						<i class="fa fa-eye"></i>
					</button>
					<!-- <button class="btn btn-warning btn-sm" data-toggle="modal" data-target=".edit_client_<?php echo $reponse['id_cli'];?>">
						<i class="fa fa-edit"></i>
					</button> -->
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDossierFacture($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
 												FROM dossier
												WHERE facture = '1'
													AND cleared = '1'
													AND id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherCotation($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND dos.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(cot.date_cot, '%d/%m/%Y') AS date_cot, 
													SUM(det.montant) AS montant,
													cot.ref_cot AS ref_cot,
													dos.ref_dos AS ref_dos,
													cot.id_cot AS id_cot
 												FROM cotation cot, detail_cotation det, dossier dos
												WHERE dos.id_mod_lic = ?
													AND dos.id_dos = cot.id_dos
													AND cot.id_cot = det.id_cot
													$sqlClient
												GROUP BY cot.id_cot
												ORDER BY cot.id_cot DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				//include('modalFacturationDossier.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_cot'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_cot'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo number_format( $reponse['montant'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="">
					<button class="btn btn-warning btn-sm"  onclick="window.open('generateurCotation.php?id_cot=<?php echo $reponse['id_cot'];?>','pop1','width=1000,height=800');">
						Génerer
					</button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFeuilleCalcul($id_cli, $id_mod_lic, $date_deb=NULL, $date_fin=NULL, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_feuil_calc) BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")';
			}else{
				$sqlDate = '';
			}

			$bg = "";

			$compteur = $premiere_entree;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													cli.nom_cli AS nom_cli,
													cli.code_cli AS code_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'Verifiée', 'En attente vérification') AS etat,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'bg-primary', 'bg-danger') AS textColor,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'', '<button class=\"btn btn-success btn-sm\" data-toggle=\"modal\" data-target=\".fc_d.id_dos\">
															Verifier
														</button>') AS button_verification,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '1'
													AND (d.id_util_verif_feuil_calc IS NULL AND date_verif_feuil_calc IS NULL)
													AND d.id_mod_lic = ?
													AND d.not_cotation = '0'
												ORDER BY d.date_feuil_calc DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalValidationVerification.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['code_cli'];?>
				</td>
				<!-- <td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_feuil_calc'];?>
				</td> -->
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_feuil_calc'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['location'];?>
				</td><!-- 
				<td class="" style="text-align: center;" class="">
					<span class="badge <?php echo $reponse['textColor'];?>">
						<font class=" " style="font-weight: bold; padding: 5px;">
							<?php echo $reponse['etat'];?>
						</font>
					</span>
				</td> -->
				<td class="" style="text-align: center;" class="">
					<?php
					if ($reponse['etat'] == 'En attente vérification') {
						?>
						<button class="btn btn-success btn-sm" data-toggle="modal" data-target=".fc_<?php echo $reponse['id_dos'];?>">
							<i class="fas fa-check"></i>
						</button>
						<button class="btn btn-primary square-btn-adjust btn-sm" onclick="window.location.replace('modifierFeuilleCalcul.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic_cot=<?php echo $id_mod_lic;?>&id_dos=<?php echo $reponse['id_dos']; ?>&debut=<?php echo $date_deb; ?>&fin=<?php echo $date_fin; ?>','pop1','width=80,height=80');">
	                      <i class="fas fa-edit"></i>
	                    </button>
						<?php
					}
					?>
					
					<button class="btn btn-warning btn-sm"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');">
						<i class="fas fa-file"></i>
					</button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFeuilleCalculApresRecherche($id_cli, $id_mod_lic, $ref_dos){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_feuil_calc) BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")';
			}else{
				$sqlDate = '';
			}

			$bg = "";

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													cli.code_cli AS code_cli,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'Verifiée', 'En attente vérification') AS etat,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'bg-primary', 'bg-danger') AS textColor,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'', '<button class=\"btn btn-success btn-sm\" data-toggle=\"modal\" data-target=\".fc_d.id_dos\">
															Verifier
														</button>') AS button_verification,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '1'
													AND (d.id_util_verif_feuil_calc IS NULL AND date_verif_feuil_calc IS NULL)
													AND d.id_mod_lic = ?
													AND d.not_cotation = '0'
													AND d.ref_dos = ?
												ORDER BY d.date_feuil_calc DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalValidationVerification.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr class="bg bg-primary">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center; " class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['code_cli'];?>
				</td>
				<!-- <td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_feuil_calc'];?>
				</td> -->
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_feuil_calc'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['location'];?>
				</td><!-- 
				<td class="" style="text-align: center;" class="">
					<span class="badge <?php echo $reponse['textColor'];?>">
						<font class=" " style="font-weight: bold; padding: 5px;">
							<?php echo $reponse['etat'];?>
						</font>
					</span>
				</td> -->
				<td class="" style="text-align: center;" class="">
					<?php
					if ($reponse['etat'] == 'En attente vérification') {
						?>
						<button class="btn btn-success btn-sm" data-toggle="modal" data-target=".fc_<?php echo $reponse['id_dos'];?>">
							<i class="fas fa-check"></i>
						</button>
						<button class="btn btn-primary square-btn-adjust btn-sm" onclick="window.location.replace('modifierFeuilleCalcul.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic_cot=<?php echo $id_mod_lic;?>&id_dos=<?php echo $reponse['id_dos']; ?>&debut=<?php echo $date_deb; ?>&fin=<?php echo $date_fin; ?>','pop1','width=80,height=80');">
	                      <i class="fas fa-edit"></i>
	                    </button>
						<?php
					}
					?>
					
					<button class="btn btn-warning btn-sm"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');">
						<i class="fas fa-file"></i>
					</button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td colspan="5" style="color: red; text-align: center; font-size: 15px;">
					<?php
					if ($compteur == 0) {
						echo 'Aucun resultat trouvé pour '.$ref_dos;
					}
					?>
					<br>
				</td>
			</tr>
			<?php

		}

		public function afficherFeuilleCalculValidee($id_cli, $id_mod_lic, $date_deb=NULL, $date_fin=NULL, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_feuil_calc) BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")';
			}else{
				$sqlDate = '';
			}

			$bg = "";

			$compteur = $premiere_entree;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													DATE_FORMAT(d.date_verif_feuil_calc, '%d/%m/%Y') AS date_verif_feuil_calc, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													cli.code_cli AS code_cli,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'Verifiée', 'En attente vérification') AS etat,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'bg-primary', 'bg-danger') AS textColor,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'', '<button class=\"btn btn-success btn-sm\" data-toggle=\"modal\" data-target=\".fc_d.id_dos\">
															Verifier
														</button>') AS button_verification,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '1'
													AND (d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL)
													AND d.id_mod_lic = ?
												ORDER BY d.date_verif_feuil_calc DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalValidationVerification.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['code_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_feuil_calc'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_verif_feuil_calc'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['location'];?>
				</td><!-- 
				<td class="" style="text-align: center;" class="">
					<span class="badge <?php echo $reponse['textColor'];?>">
						<font class=" " style="font-weight: bold; padding: 5px;">
							<?php echo $reponse['etat'];?>
						</font>
					</span>
				</td> -->
				<td class="" style="text-align: center;" class="">
					<?php
					if ($reponse['etat'] == 'En attente vérification') {
						?>
						<button class="btn btn-success btn-sm" data-toggle="modal" data-target=".fc_<?php echo $reponse['id_dos'];?>">
							<i class="fas fa-check"></i>
						</button>
						<button class="btn btn-primary square-btn-adjust btn-sm" onclick="window.location.replace('modifierFeuilleCalcul.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic_cot=<?php echo $id_mod_lic;?>&id_dos=<?php echo $reponse['id_dos']; ?>&debut=<?php echo $date_deb; ?>&fin=<?php echo $date_fin; ?>','pop1','width=80,height=80');">
	                      <i class="fas fa-edit"></i>
	                    </button>
						<?php
					}else if ($_SESSION['id_role']=='1' || $_SESSION['id_util']=='27' || $_SESSION['id_util']=='52' || $_SESSION['id_util']=='29') {
						?>
						<button class="btn btn-primary square-btn-adjust btn-sm" onclick="window.location.replace('modifierFeuilleCalcul.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic_cot=<?php echo $id_mod_lic;?>&id_dos=<?php echo $reponse['id_dos']; ?>&debut=<?php echo $date_deb; ?>&fin=<?php echo $date_fin; ?>','pop1','width=80,height=80');">
	                      <i class="fas fa-edit"></i>
	                    </button>
						<?php
					}
					?>
					
					<button class="btn btn-warning btn-sm"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');">
						<i class="fas fa-file"></i>
					</button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFeuilleCalculValideeApresRecherche($id_cli, $id_mod_lic, $ref_dos){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_feuil_calc) BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")';
			}else{
				$sqlDate = '';
			}

			$bg = "";

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													DATE_FORMAT(d.date_verif_feuil_calc, '%d/%m/%Y') AS date_verif_feuil_calc, 
													cli.nom_cli AS nom_cli,
													cli.code_cli AS code_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'Verifiée', 'En attente vérification') AS etat,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'bg-primary', 'bg-danger') AS textColor,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'', '<button class=\"btn btn-success btn-sm\" data-toggle=\"modal\" data-target=\".fc_d.id_dos\">
															Verifier
														</button>') AS button_verification,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '1'
													AND (d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL)
													AND d.id_mod_lic = ?
													AND d.ref_dos = ?
												ORDER BY d.date_verif_feuil_calc DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalValidationVerification.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr class="bg bg-primary">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['code_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_feuil_calc'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_verif_feuil_calc'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['location'];?>
				</td><!-- 
				<td class="" style="text-align: center;" class="">
					<span class="badge <?php echo $reponse['textColor'];?>">
						<font class=" " style="font-weight: bold; padding: 5px;">
							<?php echo $reponse['etat'];?>
						</font>
					</span>
				</td> -->
				<td class="" style="text-align: center;" class="">
					<?php
					if ($reponse['etat'] == 'En attente vérification') {
						?>
						<button class="btn btn-success btn-sm" data-toggle="modal" data-target=".fc_<?php echo $reponse['id_dos'];?>">
							<i class="fas fa-check"></i>
						</button>
						<?php
					}else if ($_SESSION['id_role']=='1' || $_SESSION['id_util']=='27' || $_SESSION['id_util']=='52' || $_SESSION['id_util']=='29') {
						?>
						<button class="btn btn-primary square-btn-adjust btn-sm" onclick="window.location.replace('modifierFeuilleCalcul.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic_cot=<?php echo $id_mod_lic;?>&id_dos=<?php echo $reponse['id_dos']; ?>&debut=<?php echo $date_deb; ?>&fin=<?php echo $date_fin; ?>','pop1','width=80,height=80');">
	                      <i class="fas fa-edit"></i>
	                    </button>
						<?php
					}
					?>
					
					<button class="btn btn-warning btn-sm"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');">
						<i class="fas fa-file"></i>
					</button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

			?>
			<tr>
				<td colspan="5" style="color: red; text-align: center; font-size: 15px;">
					<?php
					if ($compteur == 0) {
						echo 'Aucun resultat trouvé pour '.$ref_dos;
					}
					?>
					<br>
				</td>
			</tr>
			<?php

		}

		public function afficherFeuilleCalculVerifiee($id_cli, $id_mod_lic, $date_deb=NULL, $date_fin=NULL, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_feuil_calc) BETWEEN "'.$date_deb.'" AND "'.$date_fin.'")';
			}else{
				$sqlDate = '';
			}

			$bg = "";

			$compteur = $premiere_entree;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'Verifiée', 'En attente vérification') AS etat,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'bg-primary', 'bg-danger') AS textColor,
													IF((d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL),
													'', '<button class=\"btn btn-success btn-sm\" data-toggle=\"modal\" data-target=\".fc_d.id_dos\">
															Verifier
														</button>') AS button_verification
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '1'
													AND (d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL)
													AND d.id_mod_lic = ?
												ORDER BY d.date_feuil_calc DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalValidationVerification.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<!-- <td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_feuil_calc'];?>
				</td> -->
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_creat_dos'];?>
				</td><!-- 
				<td class="" style="text-align: center;" class="">
					<span class="badge <?php echo $reponse['textColor'];?>">
						<font class=" " style="font-weight: bold; padding: 5px;">
							<?php echo $reponse['etat'];?>
						</font>
					</span>
				</td> -->
				<td class="" style="text-align: center;" class="">
					<?php
					if ($reponse['etat'] == 'En attente vérification') {
						?>
						<button class="btn btn-success btn-sm" data-toggle="modal" data-target=".fc_<?php echo $reponse['id_dos'];?>">
							<i class="fas fa-check"></i>
						</button>
						<button class="btn btn-primary square-btn-adjust btn-sm" onclick="window.location.replace('modifierFeuilleCalcul.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic_cot=<?php echo $id_mod_lic;?>&id_dos=<?php echo $reponse['id_dos']; ?>&debut=<?php echo $date_deb; ?>&fin=<?php echo $date_fin; ?>','pop1','width=80,height=80');">
	                      <i class="fas fa-edit"></i>
	                    </button>
						<?php
					}
					?>
					
					<button class="btn btn-warning btn-sm"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');">
						<i class="fas fa-file"></i>
					</button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDossierEnAttenteFeuilleCalcul($id_cli, $id_mod_lic,$premiere_entree, $nombre_dossier_par_page, $date_deb=NULL, $date_fin=NULL){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_creat_dos) BETWEEN "'.$date_deb.'" AND "'.$date_deb.'")';
			}else{
				$sqlDate = '';
			}

			$bg = "";

			$compteur = $premiere_entree;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '0'
													AND d.not_cotation = '0'
													AND d.id_mod_lic = ?
												ORDER BY d.date_creat_dos ASC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_creat_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['location'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php
						echo $this-> getEtatDocumentDossier($reponse['id_dos']);
					?>
				</td>
				<td class="" style="text-align: center;" class="">
					<button class="btn btn-success square-btn-adjust" onclick="window.location.replace('nouvelleFeuilleCalcul.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic_cot=<?php echo $id_mod_lic;?>&id_dos=<?php echo $reponse['id_dos']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-plus"></i> Editer Feuille de calcul
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherStatusDossier($id_cli, $id_mod_lic,$statut){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$sqlStatus= '';

			if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/AV/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888  AND d.date_assurance IS NULL  AND d.id_cli <> 883 
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/AV')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888  AND d.date_assurance IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL
								AND YEAR(d.date_creat_dos) > 2021  AND d.id_cli <> 883 ';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD')) {

				// $sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NOT NULL';
				$sqlStatus = ' AND d.ad_date IS NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AV/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888  AND d.date_assurance IS NULL
								AND YEAR(d.date_creat_dos) > 2021 AND d.id_cli <> 883 ';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AV')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888  AND d.date_assurance IS NOT NULL';
				$sqlStatus = ' AND d.date_av IS NULL AND d.id_cli <> 888  
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING INSURANCE')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';
				$sqlStatus = ' AND d.date_assurance IS NULL AND d.id_cli <> 883 
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING BAE')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';
				$sqlStatus = ' AND d.bae_date IS NULL
								AND d.date_quit IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING BS')) {

				// $sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';
				$sqlStatus = ' AND d.bs_date IS NULL
								AND d.date_quit IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS delai_preal,
													cl.nom_cli AS nom_cli,
													d.commodity AS commodity,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													d.ref_decl AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_decl AS ref_quit,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(d.ad_date, '%d/%m/%Y') AS ad_date,
													DATE_FORMAT(d.date_av, '%d/%m/%Y') AS date_av,
													DATE_FORMAT(d.date_assurance, '%d/%m/%Y') AS date_assurance,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cl
												WHERE d.id_cli = cl.id_cli
													AND d.id_mod_lic = ?
													$sqlClient
													$sqlStatus
												ORDER BY id_dos DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_creat_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_preal'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['delai_preal'];?>
				</td>
				<td class="" style="text-align: left;" class="">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['horse'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['trailer_1'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['trailer_2'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ad_date'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_av'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_assurance'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['location'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDossierEnAttenteRemiseDocumentTransporteur($id_cli, $id_mod_lic){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS delai_preal,
													cl.nom_cli AS nom_cli,
													d.commodity AS commodity,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													d.ref_decl AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_decl AS ref_quit,
													d.tr8_ref AS tr8_ref,
													d.bur_douane AS bur_douane,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(d.ad_date, '%d/%m/%Y') AS ad_date,
													DATE_FORMAT(d.date_av, '%d/%m/%Y') AS date_av,
													DATE_FORMAT(d.tr8_date, '%d/%m/%Y') AS tr8_date,
													DATE_FORMAT(d.date_assurance, '%d/%m/%Y') AS date_assurance,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cl
												WHERE d.id_cli = cl.id_cli
													AND d.id_mod_lic = ?
													AND (
														(d.tr8_date IS NOT NULL
															AND d.date_rem_doc IS NULL
															AND d.bur_douane <> 'KASUMBALESA - 722B')
														OR (d.bur_douane = 'KASUMBALESA - 722B'
															AND d.date_decl IS NOT NULL
															AND d.date_rem_doc IS NULL
															)
													)
													AND DATE(d.date_creat_dos) > '2022-06-15'
													$sqlClient
												ORDER BY id_dos DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_creat_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_preal'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['delai_preal'];?>
				</td>
				<td class="" style="text-align: left;" class="">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['horse'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['trailer_1'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['trailer_2'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['tr8_ref'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['tr8_date'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['bur_douane'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['location'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherStatusDossierFilesStatus($id_cli, $id_mod_lic,$id_doc){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_doc'] = $id_doc;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$compteur = 0;
			
			if ($id_doc == 49) {

				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
														DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos,
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
														DATEDIFF(CURRENT_DATE(), d.date_preal) AS delai_preal,
														cl.nom_cli AS nom_cli,
														d.commodity AS commodity,
														d.horse AS horse,
														d.id_dos AS id_dos,
														d.trailer_1 AS trailer_1,
														d.trailer_2 AS trailer_2,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_decl AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_decl AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
														DATE_FORMAT(d.ad_date, '%d/%m/%Y') AS ad_date,
														DATE_FORMAT(d.date_av, '%d/%m/%Y') AS date_av,
														DATE_FORMAT(d.date_assurance, '%d/%m/%Y') AS date_assurance,
														IF(d.id_mod_lic='2',
															IF(d.site_arriv IS NOT NULL,
																'AT SITE',
																IF(d.wiski_dep IS NOT NULL,
																	'ON THE WAY TO SITE',
																	IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																		'AT KLSA',
																		IF(d.arrival_date IS NOT NULL,
																			'ARRIVED AT DRC','OUT OF DRC')
																		)
																	)
																)
															,
															IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
																'OUT OF DRC',
																IF(d.site_dep IS NOT NULL,
																	'ON THE WAY TO THE BORDER',
																	'AT SITE'
																	)
																)
															) AS location
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli
														AND d.id_mod_lic = ?
														$sqlClient
														AND d.num_bp NOT IN (
																SELECT num_bp
																	FROM plis
																	WHERE id_cli = cl.id_cli
															)
														AND YEAR(d.date_creat_dos) > 2021
														AND d.id_cli = cl.id_cli
														AND d.id_mod_trans <> 6
														$sqlClient");
				$requete-> execute(array($entree['id_mod_lic']));
				

			}else if($id_doc == 48){
				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
														DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos,
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
														DATEDIFF(CURRENT_DATE(), d.date_preal) AS delai_preal,
														cl.nom_cli AS nom_cli,
														d.commodity AS commodity,
														d.horse AS horse,
														d.id_dos AS id_dos,
														d.trailer_1 AS trailer_1,
														d.trailer_2 AS trailer_2,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
														DATE_FORMAT(d.ad_date, '%d/%m/%Y') AS ad_date,
														DATE_FORMAT(d.date_av, '%d/%m/%Y') AS date_av,
														DATE_FORMAT(d.date_assurance, '%d/%m/%Y') AS date_assurance,
														IF(d.id_mod_lic='2',
															IF(d.site_arriv IS NOT NULL,
																'AT SITE',
																IF(d.wiski_dep IS NOT NULL,
																	'ON THE WAY TO SITE',
																	IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																		'AT KLSA',
																		IF(d.arrival_date IS NOT NULL,
																			'ARRIVED AT DRC','OUT OF DRC')
																		)
																	)
																)
															,
															IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
																'OUT OF DRC',
																IF(d.site_dep IS NOT NULL,
																	'ON THE WAY TO THE BORDER',
																	'AT SITE'
																	)
																)
															) AS location
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli
														AND d.id_mod_lic = ?
														AND d.id_dos NOT IN (
																SELECT DISTINCT(id_dos)
																	FROM dossier_document
																	WHERE id_doc = ?
															)
														AND YEAR(d.date_creat_dos) > 2021
														AND d.id_mod_trans <> 6
														$sqlClient
													ORDER BY id_dos DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_doc']));
			}else if ($this-> getDataDocument($id_doc)['id_t_doc'] == 1) {

				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
														DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos,
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
														DATEDIFF(CURRENT_DATE(), d.date_preal) AS delai_preal,
														cl.nom_cli AS nom_cli,
														d.commodity AS commodity,
														d.horse AS horse,
														d.id_dos AS id_dos,
														d.trailer_1 AS trailer_1,
														d.trailer_2 AS trailer_2,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
														DATE_FORMAT(d.ad_date, '%d/%m/%Y') AS ad_date,
														DATE_FORMAT(d.date_av, '%d/%m/%Y') AS date_av,
														DATE_FORMAT(d.date_assurance, '%d/%m/%Y') AS date_assurance,
														IF(d.id_mod_lic='2',
															IF(d.site_arriv IS NOT NULL,
																'AT SITE',
																IF(d.wiski_dep IS NOT NULL,
																	'ON THE WAY TO SITE',
																	IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																		'AT KLSA',
																		IF(d.arrival_date IS NOT NULL,
																			'ARRIVED AT DRC','OUT OF DRC')
																		)
																	)
																)
															,
															IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
																'OUT OF DRC',
																IF(d.site_dep IS NOT NULL,
																	'ON THE WAY TO THE BORDER',
																	'AT SITE'
																	)
																)
															) AS location
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli
														AND d.id_mod_lic = ?

														AND d.id_dos NOT IN (
																SELECT DISTINCT(id_dos)
																	FROM dossier_document
																	WHERE id_doc = ? OR id_doc = 52
															)
														AND YEAR(d.date_creat_dos) > 2021
														AND d.id_mod_trans <> 6

														$sqlClient
													ORDER BY id_dos DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_doc']));

			}else{
				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
														DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos,
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
														DATEDIFF(CURRENT_DATE(), d.date_preal) AS delai_preal,
														cl.nom_cli AS nom_cli,
														d.commodity AS commodity,
														d.horse AS horse,
														d.id_dos AS id_dos,
														d.trailer_1 AS trailer_1,
														d.trailer_2 AS trailer_2,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
														DATE_FORMAT(d.ad_date, '%d/%m/%Y') AS ad_date,
														DATE_FORMAT(d.date_av, '%d/%m/%Y') AS date_av,
														DATE_FORMAT(d.date_assurance, '%d/%m/%Y') AS date_assurance,
														IF(d.id_mod_lic='2',
															IF(d.site_arriv IS NOT NULL,
																'AT SITE',
																IF(d.wiski_dep IS NOT NULL,
																	'ON THE WAY TO SITE',
																	IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																		'AT KLSA',
																		IF(d.arrival_date IS NOT NULL,
																			'ARRIVED AT DRC','OUT OF DRC')
																		)
																	)
																)
															,
															IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
																'OUT OF DRC',
																IF(d.site_dep IS NOT NULL,
																	'ON THE WAY TO THE BORDER',
																	'AT SITE'
																	)
																)
															) AS location
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli
														AND d.id_mod_lic = ?

														AND d.id_dos NOT IN (
																SELECT DISTINCT(id_dos)
																	FROM dossier_document
																	WHERE id_doc = ? OR id_doc = 48
															)
														AND YEAR(d.date_creat_dos) > 2021
														AND d.id_mod_trans <> 6

														$sqlClient
													ORDER BY id_dos DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_doc']));
			}
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
			<tr style="<?php echo $bg;?>">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td>
					<button type="button" class="btn btn-dark dropdown-toggle dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Liasse Doc<sup><span class="badge badge-info"><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $entree['id_mod_lic']);
                          ?>
                        </div>
                      </button>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_creat_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_preal'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['delai_preal'];?>
				</td>
				<td class="" style="text-align: left;" class="">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['horse'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['trailer_1'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['trailer_2'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ad_date'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_av'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_assurance'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['location'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherNotificationMailDossierEnAttenteFeuilleCalcul($id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.etat_feuil_calc = '0'
													AND d.id_mod_lic = '2'
													AND d.not_cotation = '0'
													AND d.id_mod_lic = ?
												ORDER BY d.date_creat_dos ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="" class="">
					'.$compteur.'
				</td>
				<td class="" style="" class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['commodity'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['location'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherNotificationMailDossierSansIM4ApresCotation($id_mod_lic){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.date_feuil_calc) AS duree,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree_preal
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND (
															(d.etat_feuil_calc = '1' 
																AND d.id_mod_lic = '2'
																AND d.id_util_verif_feuil_calc IS NOT NULL
																AND d.date_verif_feuil_calc IS NOT NULL)
															OR d.id_mod_lic = '1'
														)
													AND (d.ref_decl IS NULL OR TRIM(d.ref_decl)='')
													AND d.date_decl IS NULL
													AND (d.ref_dos NOT LIKE 'EXPDEC%' 
														AND d.ref_dos NOT LIKE '21EXP%')
													AND d.id_mod_lic = ?
													AND d.id_mod_trans <> 6
													AND d.id_mod_trans <> 27
													AND d.ref_dos <> 'TEST'
													AND d.ref_dos <> 'TEST'
												ORDER BY d.date_creat_dos ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="" class="">
					'.$compteur.'
				</td>
				<td class="" style="" class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['duree_preal'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_feuil_calc'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['commodity'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherNotificationMailDossierAttenteValidationCotation($id_mod_lic){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.date_feuil_calc) AS duree,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree_preal,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.not_cotation = '0'
													AND d.etat_feuil_calc = '1' 
													AND d.id_mod_lic = '2'
													AND d.date_verif_feuil_calc IS NULL
													AND d.id_util_verif_feuil_calc IS NULL
													AND (d.ref_dos NOT LIKE 'EXPDEC%' 
														AND d.ref_dos NOT LIKE '21EXP%')
													AND d.id_mod_lic = ?
												ORDER BY d.date_creat_dos ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="" class="">
					'.$compteur.'
				</td>
				<td class="" style="" class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['duree_preal'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_feuil_calc'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['commodity'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['location'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherNotificationMailDossierSansLiquidation($id_mod_lic){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl, 
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.date_decl) AS duree,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree_preal
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND (d.ref_decl IS NOT NULL AND TRIM(d.ref_decl)<>'')
													AND d.date_decl IS NOT NULL
													AND (d.ref_liq IS NULL OR TRIM(d.ref_liq)='')
													AND d.date_liq IS NULL
													AND d.id_mod_lic = ?
												ORDER BY d.date_creat_dos ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="" class="">
					'.$compteur.'
				</td>
				<td class="" style="" class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['duree_preal'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['ref_decl'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_decl'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['commodity'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherNotificationMailDossierSansQuittanceApresIM4($id_mod_lic){
			include("connexion.php");

			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATEDIFF(CURRENT_DATE(), d.date_liq) AS duree_liq,
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree_preal
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND (d.ref_liq IS NOT NULL AND TRIM(d.ref_liq)<>'')
													AND d.date_liq IS NOT NULL
													AND d.date_quit IS NULL
													AND (d.ref_quit IS NULL OR TRIM(d.ref_quit)='')
													AND d.id_mod_lic = ?
												ORDER BY d.date_creat_dos ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="" class="">
					'.$compteur.'
				</td>
				<td class="" style="" class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['duree_preal'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['ref_decl'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_decl'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['ref_liq'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['date_liq'].'
				</td>
				<td class="" style="text-align: center;" class="">
					'.$reponse['duree_liq'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="" class="">
					'.$reponse['commodity'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherDossierEnAttenteFeuilleCalculApresRecherche($id_cli, $id_mod_lic, $ref_dos){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m/%Y') AS date_feuil_calc, 
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													AND d.etat_feuil_calc = '0'
													AND d.not_cotation = '0'
													AND d.id_mod_lic = ?
													AND d.ref_dos = ?
												ORDER BY d.date_creat_dos ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				
			?>
			<tr class="bg bg-primary">
				<td class="" style="text-align: center;" class="">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['date_creat_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td class="" style="text-align: center;" class="">
					<?php echo $reponse['location'];?>
				</td>
				<td class="" style="text-align: center;">
					<?php
						echo $this-> getEtatDocumentDossier($reponse['id_dos']);
					?>
				</td>
				<td class="" style="text-align: center;" class="">
					<button class="btn btn-success square-btn-adjust" onclick="window.location.replace('nouvelleFeuilleCalcul.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic_cot=<?php echo $id_mod_lic;?>&id_dos=<?php echo $reponse['id_dos']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-plus"></i> Editer Feuille de calcul
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td colspan="5" style="color: red; text-align: center; font-size: 15px;">
					<?php
					if ($compteur == 0) {
						echo 'Aucun resultat trouvé pour '.$ref_dos;
					}
					?>
					<br>
				</td>
			</tr>
			<?php

		}

		public function afficherDossierAttenteFactureRecherche($id_cli, $id_mod_lic, $ref_dos){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
 												FROM dossier
												WHERE facture = '0'
													AND cleared = '1'
													AND id_mod_lic = ?
													AND ref_dos = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic'], $entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: center;">
					<button class="btn bg-info square-btn-adjust" data-toggle="modal" data-target=".facture_<?php echo $reponse['id_dos'];?>">
	                    <i class="fa fa-calculator"></i> Facturer
	                </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td>
					<hr>
				</td>
			</tr>
			<?php

		}

		public function afficherDossierFactureRecherche($id_cli, $id_mod_lic, $ref_dos){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
 												FROM dossier
												WHERE facture = '1'
													AND cleared = '1'
													AND id_mod_lic = ?
													AND ref_dos = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic'], $entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td>
					<hr>
				</td>
			</tr>
			<?php

		}

		public function afficherApurementLicenceDossier($id_cli, $id_mod_lic, $motCle){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['motCle'] = '%'.$motCle.'%';

			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND tr.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_ap) AS id_trans_ap, UPPER(cl.nom_cli) AS nom_cli,
													tr.ref_trans_ap AS ref_trans_ap,
													tr.id_trans_ap AS id_trans_ap,
													DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													UPPER(tr.banque) AS banque,
													tr.fichier_trans_ap AS fichier_trans_ap
												FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
												WHERE $sqlClient
													AND d.id_mod_lic = ?
													AND (d.ref_dos LIKE (?)
														OR d.num_lic LIKE (?)
														)
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = tr.id_trans_ap
													AND tr.id_cli = cl.id_cli
												ORDER BY tr.id_trans_ap DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['motCle'], $entree['motCle']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditTransmissionApurement.php');

				if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['banque'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreLicenceTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreDossierTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDossiersApures.php?id_trans_ap=<?php echo $reponse['id_trans_ap'];?>&id_mod_lic=<?php echo $id_mod_lic;?>&id_cli=<?php echo $entree['id_cli'];?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">Détails</button>
					</a>
					<?php
						if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust" data-toggle="modal" data-target=".editTransmission_<?php echo $reponse['id_trans_ap'];?>">
		                    <i class="fa fa-upload"></i> Loger Accusée de réception
		                </button>
						<?php
						}else{
						?>
						<button class="btn bg bg-info square-btn-adjust" onclick="window.open('../transmision_apurements/<?php echo $reponse['id_trans_ap'];?>/<?php echo $reponse['fichier_trans_ap'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-file"></i> Accusée de réception
		                </button>
						<?php
						}
					?>
                    <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportTransmissionApurement.php?id_cli=<?php echo $id_cli; ?>&id_mod_lic=<?php echo $id_mod_lic;?>&id_trans_ap=<?php echo $reponse['id_trans_ap']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i> Export
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td style="background-color: black;">
					<hr>
				</td>
				<td style="background-color: black;">
					<hr>
				</td>
				<td style="background-color: black;">
					<hr>
				</td>
			</tr>
			<?php
		}

		public function afficherApurementSansFichier($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page, $id_type_apur){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_ap) AS id_trans_ap, UPPER(cl.nom_cli) AS nom_cli,
													tr.ref_trans_ap AS ref_trans_ap,
													tr.id_trans_ap AS id_trans_ap,
													DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													UPPER(tr.banque) AS banque,
													tr.fichier_trans_ap AS fichier_trans_ap
												FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
												WHERE cl.id_cli = d.id_cli
													$sqlClient
													AND d.id_mod_lic = ?
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = tr.id_trans_ap
													AND (tr.fichier_trans_ap = ''
														OR tr.fichier_trans_ap IS NULL)
													AND tr.id_type_apur = ?
												ORDER BY tr.id_trans_ap DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
					$button = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['banque'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreLicenceTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreDossierTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les détails" href="#" style="color: black;" onclick="window.open('popUpDossiersApures.php?id_trans_ap=<?php echo $reponse['id_trans_ap'];?>&id_cli=<?php echo $entree['id_cli'];?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">Détails</button>
					</a>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersApuresTransmission($id_trans_ap, $id_mod_lic){
			include("connexion.php");
			$entree['id_trans_ap'] = $id_trans_ap;
			$compteur=0;

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic,
													d.ref_fact,
													d.fob AS fob, d.ref_av AS ref_av, d.montant_av AS montant_av,
													d.ref_fact AS ref_fact, d.ref_decl AS ref_decl,
													d.road_manif AS road_manif,
													d.num_lot AS num_lot,
													d.poids AS poids,
													d.ref_cvee AS ref_cvee,
													DATE_FORMAT(d.date_cvee, '%d/%m/%Y') AS date_cvee,
													d.poids_cvee AS poids_cvee,
													d.montant_cvee AS montant_cvee
												FROM dossier d, detail_apurement dt
												WHERE d.id_dos = dt.id_dos
													AND dt.id_trans_ap = ?
												ORDER BY d.num_lic");
			$requete-> execute(array($entree['id_trans_ap']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getDateExpirationLicence($reponse['num_lic']);
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['date_val'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $date_exp;?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
			<?php
				if($id_mod_lic==1){
			?>
				<td style="text-align: center;">
					<?php echo $reponse['poids'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_cvee'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_cvee'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['poids_cvee'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['montant_cvee'];?>
				</td>
			<?php
				}else if($id_mod_lic==2){
			?>
				<td style="text-align: center;">
					<?php echo $reponse['ref_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['montant_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
			<?php
				}
			?>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['road_manif'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersSansFOB($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT ref_dos, fob
												FROM dossier
												WHERE id_mod_lic = ?
													AND (fob = '' OR fob IS NULL OR fob <= 0)
												$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersApuresTransmissionNotification($id_mod_lic, $id_cli, $id_type_apur){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic,
													d.ref_fact,
													d.fob AS fob, d.ref_av AS ref_av, d.montant_av AS montant_av,
													d.ref_fact AS ref_fact, d.ref_decl AS ref_decl,
													d.road_manif AS road_manif,
													ta.ref_trans_ap AS ref_trans_ap,
													DATE_FORMAT(ta.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													UPPER(ta.banque) AS banque
												FROM dossier d, detail_apurement dt, transmission_apurement ta
												WHERE d.id_mod_lic = ?
													$sqlClient
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = ta.id_trans_ap
													AND ta.id_type_apur = ?
												ORDER BY ta.id_trans_ap ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getDateExpirationLicence($reponse['num_lic']);
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['banque'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['date_val'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $date_exp;?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['montant_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['road_manif'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersPretAEtreApures($id_mod_lic, $id_cli, $num_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				// $sqlClient = ' AND d.id_cli = "'.$id_cli.'"';

				$sqlClient = ' AND (d.id_cli = "'.$id_cli.'" 
									OR SUBSTRING(md.num_lic, 1, 10) IN (
											SELECT SUBSTRING(num_lic, 1, 10)
												FROM licence
												WHERE id_cli = "'.$id_cli.'"
										)
								)';
				$sqlClient2 = '';
				// $sqlClient2 = 'OR num_lic IN (
				// 						SELECT num_lic
				// 							FROM licence 
				// 							WHERE id_cli = "'.$id_cli.'"
				// 					)
				// 				';
			}else{
				$sqlClient = '';
				$sqlClient2 = "";
			}

			$sqlQuittance = '';

			if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
				$sqlQuittance = ' AND d.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
			}

			$sqlLicence = '';
			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
			}

			$compteur=0;

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic,
													d.ref_fact,
													d.fob AS fob, d.ref_av AS ref_av, d.montant_av AS montant_av,
													d.ref_fact AS ref_fact, d.ref_decl AS ref_decl,
													d.road_manif AS road_manif,
													d.fob AS fob,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													(d.fob+d.assurance+d.autre_frais+d.fret) AS cif,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													d.bur_douane AS bur_douane,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													d.ref_quit AS ref_quit
												FROM dossier d, marchandise_dossier md
												WHERE d.id_mod_lic = ?
													$sqlClient
													AND d.ref_quit IS NOT NULL
													AND TRIM(d.ref_quit) <> ''
													AND d.ref_decl IS NOT NULL
													AND TRIM(d.ref_decl) <> ''
													AND d.not_apurement = '0'
													AND d.id_dos = md.id_dos
													AND trim(md.num_lic) <> 'N/A'
													AND trim(d.num_lic) <> 'N/A'
													$sqlLicence
													AND md.num_lic <> 'UNDER VALUE'
													AND LENGTH(md.num_lic) > 4
													AND d.id_dos NOT IN(
															SELECT id_dos FROM detail_apurement
														)
													$sqlQuittance
												GROUP BY d.id_dos
												ORDER BY d.ref_dos DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getDateExpirationLicence($reponse['num_lic']);
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['fret'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['assurance'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['autre_frais'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['bur_douane'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['date_val'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $date_exp;?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( ($this-> getDataLicence($reponse['num_lic'])['fob']+$this-> getDataLicence($reponse['num_lic'])['fret']+$this-> getDataLicence($reponse['num_lic'])['assurance']+$this-> getDataLicence($reponse['num_lic'])['autre_frais']), 2, ',', ' ');?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['ref_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['montant_av'];?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['road_manif'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersPretAEtreApuresExport($id_mod_lic, $id_cli, $num_lic, $id_type_apur=1){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_trans_ap'] = $id_trans_ap;

			$sqlTypeApurement = '';

			if ($id_type_apur=='2') {
				$sqlTypeApurement = 'AND d.ref_cvee IS NOT NULL';
			}


			if (isset($id_cli) && ($id_cli!='')) {
				// $sqlClient = ' AND d.id_cli = "'.$id_cli.'"';

				$sqlClient = ' AND (d.id_cli = "'.$id_cli.'" 
									OR SUBSTRING(d.num_lic, 1, 10) IN (
											SELECT SUBSTRING(num_lic, 1, 10)
												FROM licence
												WHERE id_cli = "'.$id_cli.'"
										)
								)';
				$sqlClient2 = '';
				// $sqlClient2 = 'OR num_lic IN (
				// 						SELECT num_lic
				// 							FROM licence 
				// 							WHERE id_cli = "'.$id_cli.'"
				// 					)
				// 				';
			}else{
				$sqlClient = '';
				$sqlClient2 = "";
			}

			$sqlQuittance = '';

			if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
				$sqlQuittance = ' AND d.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
			}

			$sqlLicence = '';
			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND SUBSTRING(d.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
			}

			$compteur=0;

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic, d.num_lot AS num_lot,
													d.ref_cvee AS ref_cvee,
													d.fob AS fob, d.ref_av AS ref_av, d.montant_av AS montant_av,
													d.ref_fact AS ref_fact, d.ref_decl AS ref_decl,
													d.road_manif AS road_manif,
													d.fob AS fob,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													(d.fob+d.assurance+d.autre_frais+d.fret) AS cif,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													d.bur_douane AS bur_douane,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													d.ref_quit AS ref_quit
												FROM dossier d
												WHERE d.id_mod_lic = ?
													$sqlClient
													AND d.ref_quit IS NOT NULL
													AND TRIM(d.ref_quit) <> ''
													AND d.ref_decl IS NOT NULL
													AND TRIM(d.ref_decl) <> ''
													AND d.not_apurement = '0'
													AND d.id_dos = d.id_dos
													$sqlTypeApurement
													AND trim(d.num_lic) <> 'N/A'
													AND trim(d.num_lic) <> 'N/A'
													$sqlLicence
													AND d.num_lic <> 'UNDER VALUE'
													AND LENGTH(d.num_lic) > 4
													AND d.id_dos NOT IN(
															SELECT id_dos 
															FROM detail_apurement, transmission_apurement
															WHERE detail_apurement.id_trans_ap = transmission_apurement.id_trans_ap
																AND transmission_apurement.id_trans_ap = ?
														)
													$sqlQuittance
												GROUP BY d.id_dos
												ORDER BY d.ref_dos DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_trans_ap']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getDateExpirationLicence($reponse['num_lic']);
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_cvee'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['fret'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['assurance'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['autre_frais'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['bur_douane'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['date_val'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $date_exp;?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( ($this-> getDataLicence($reponse['num_lic'])['fob']+$this-> getDataLicence($reponse['num_lic'])['fret']+$this-> getDataLicence($reponse['num_lic'])['assurance']+$this-> getDataLicence($reponse['num_lic'])['autre_frais']), 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherFacturesEnAttenteTransmis($id_mod_lic, $id_cli, $type_fact){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$compteur=0;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													UPPER(cl.nom_cli) AS nom_cli,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													SUM( 
														IF(det.usd='1',
															IF(det.tva='1', (det.montant*1.16),det.montant) 
															,
															IF(det.tva='1', ((det.montant/dos.roe_decl)*1.16), (det.montant/dos.roe_decl))
														) 
													) AS montant,
													UPPER(march.nom_march) AS nom_march
												FROM facture_dossier fd, client cl, detail_facture_dossier det, dossier dos, marchandise march
												WHERE fd.id_mod_lic = ?
													AND fd.id_cli = cl.id_cli
													AND fd.ref_fact NOT IN(
															SELECT ref_fact FROM detail_transmis_facture_dossier
														)
													AND fd.type_fact = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													AND dos.id_march = march.id_march
													AND fd.validation = '1'
													AND fd.not_transmis = '0'
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			while ($reponse = $requete-> fetch()) {
				
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_march'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['montant'], 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherFacturesTransmis($id_mod_lic, $id_cli, $type_fact){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$compteur=0;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													UPPER(cl.nom_cli) AS nom_cli,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													SUM( 
														IF(det.usd='1',
															IF(det.tva='1', (det.montant*1.16),det.montant) 
															,
															IF(det.tva='1', ((det.montant/dos.roe_decl)*1.16), (det.montant/dos.roe_decl))
														) 
													) AS montant,
													UPPER(march.nom_march) AS nom_march
												FROM facture_dossier fd, client cl, detail_facture_dossier det, dossier dos, marchandise march
												WHERE fd.id_mod_lic = ?
													AND fd.id_cli = cl.id_cli
													AND fd.ref_fact IN(
															SELECT ref_fact FROM detail_transmis_facture_dossier
														)
													AND fd.type_fact = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													AND dos.id_march = march.id_march
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			while ($reponse = $requete-> fetch()) {
				
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_march'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['montant'], 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDetailFacturesTransmis($id_trans_fact){
			include("connexion.php");
			$entree['id_trans_fact'] = $id_trans_fact;

			$compteur=0;
			$montant = 0;
			$bfu = 0;
			$nac = 0;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													UPPER(cl.nom_cli) AS nom_cli,
													SUM(IF(det.usd='1',
														IF(det.tva='1', (det.montant*1.16),det.montant) 
														,
														IF(det.tva='1', ((det.montant/dos.roe_decl)*1.16), (det.montant/dos.roe_decl))
													)) AS montant,
													UPPER(march.nom_march) AS nom_march,
													dos.id_dos AS id_dos,
													dos.ref_dos AS ref_dos,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit
												FROM facture_dossier fd, transmis_facture_dossier tr, detail_transmis_facture_dossier dtfd, client cl, detail_facture_dossier det, dossier dos, marchandise march
												WHERE march.id_march = dos.id_march
													AND dos.id_cli = cl.id_cli
													AND dos.id_dos = det.id_dos
													AND det.ref_fact = fd.ref_fact
													AND fd.ref_fact = dtfd.ref_fact
													AND dtfd.id_trans_fact = tr.id_trans_fact
													AND tr.id_trans_fact = ?
												GROUP BY dos.id_dos
												ORDER BY dos.id_dos");
			$requete-> execute(array($entree['id_trans_fact']));
			while ($reponse = $requete-> fetch()) {
				
				$compteur++;
				$montant += $reponse['montant'];
				$bfu += $this-> getMontantFactureDossierDebours($reponse['ref_fact'], $reponse['id_dos'], 10);
				$nac += $this-> getMontantFactureDossierDebours($reponse['ref_fact'], $reponse['id_dos'], 11);
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_march'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['montant'], 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $this-> getMontantFactureDossierDebours($reponse['ref_fact'], $reponse['id_dos'], 10), 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $this-> getMontantFactureDossierDebours($reponse['ref_fact'], $reponse['id_dos'], 11), 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td style="text-align: right;" colspan="6">
					TOTAL
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $montant, 2, ',', ' ');?>
				</td>
				<td></td>
				<td></td>
				<td style="text-align: right;">
					<?php echo number_format( $bfu, 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $nac, 2, ',', ' ');?>
				</td>
			</tr>
			<?php
		}

		public function afficherLicence($id_mod_lic, $id_cli, $id_type_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = $premiere_entree;

			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							IF(l.id_mod_lic = '1', l.poids, l.fob) AS fob,
							l.date_val AS date_val2,
							IF(l.id_mod_lic = '1', l.unit_mes, m.sig_mon) AS sig_mon,
							m.id_mon AS id_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.autre_frais AS autre_frais,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							t.id_type_lic AS id_type_lic,
							UPPER(t.nom_type_lic) AS nom_type_lic,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							l.av_ara AS av_ara,
							l.ref_av AS ref_av,
							l.date_cloture AS date_cloture,
							l.statut_lic AS statut_lic
						FROM licence l, monnaie m, client cl, banque b, type_licence t
						WHERE l.id_mod_lic = ?
							AND l.id_type_lic = t.id_type_lic
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
						ORDER BY l.date_val DESC
						LIMIT $premiere_entree, $nombre_dossier_par_page";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				$bg = "bg-light";
				$couleur = "";

				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}
				//include('modalManipulation.php');
				include('modalEditLicence.php');
			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="" style=" padding: 0.8rem; text-align: left; border: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class=" <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['commodity'];?></td>
					<?php
				}
				?>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: right;border: 1px solid black;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']+$reponse['autre_frais']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){/*
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<?php*/
					}
				?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_banq'];?></td>
				<?php
				if($id_mod_lic == '1'){
					/*
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl']-$this-> getSommeQteLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<?php
					*/
				}
				/*if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
				}*/
				?>
				<td style="text-align: center; border: 1px solid black;">
					<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
				</td>
				<td style="text-align: center; border: 1px solid black;">
					<?php
						echo ($reponse['fob'] - $this-> getSommeFobLicence($reponse['num_lic']));
					?>
				</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<?php
				}
				?>
					<td style="text-align: center; border: 1px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Dossiers affectés" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1000,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<!--<form method="POST" action="">
							<input type="hidden" value="<?php echo $reponse['num_lic'];?>" name="num_lic">
							<button class="btn btn-sm btn-warning" name="edit">
								<i class="fa fa-edit"></i>
							</button>
						</form>-->
						<button class="btn btn-sm btn-warning" data-toggle="modal" data-target=".editLicence_<?php echo str_replace(' ', '_', $reponse['num_lic']);?>">
							<i class=" fas fa-edit" style="color: black;"></i>
						</button>
					</td><!--
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm bg bg-teal" data-toggle="modal" data-target=".manipulation_<?php echo $reponse['num_lic'];?>">
							<i class=" fas fa-indent" style="color: black;"></i>
						</button>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm btn-success" onclick="window.open('appurement.php?num_lic=<?php echo $reponse['num_lic'];?>','pop1','width=800,height=800');">
							<i class=" fas fa-check"></i>
						</button>
					</td> -->
				</tr>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherLicenceExport($id_mod_lic, $id_cli, $id_type_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = $premiere_entree;

			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							IF(l.id_mod_lic = '1', l.poids, l.fob) AS fob,
							l.date_val AS date_val2,
							IF(l.id_mod_lic = '1', l.unit_mes, m.sig_mon) AS sig_mon,
							m.id_mon AS id_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.unit_mes AS unit_mes,
							l.autre_frais AS autre_frais,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(mse.nom_march) AS nom_march,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							t.id_type_lic AS id_type_lic,
							UPPER(t.nom_type_lic) AS nom_type_lic,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							l.poids AS poids
						FROM licence l, monnaie m, client cl, banque b, type_licence t, marchandise mse
						WHERE l.id_mod_lic = ?
							AND l.id_type_lic = t.id_type_lic
							AND l.id_cli = cl.id_cli
							AND l.id_march = mse.id_march
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
						ORDER BY l.date_creat_lic DESC
						LIMIT $premiere_entree, $nombre_dossier_par_page";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				$bg = "bg-light";
				$couleur = "";

				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}
				//include('modalManipulation.php');
				include('modalEditLicence.php');
			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6_licence <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>

					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['nom_march'];?></td>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['unit_mes'];?></td>
					<td style="text-align: center;border: 1px solid black;">
						<?php echo number_format( $reponse['poids'], 2, ',', ' ');?>
					</td>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['nom_banq'];?></td>
					<td style="text-align: center; border: 1px solid black;">
						<?php
							echo number_format( ($this-> getSommeFobLicence($reponse['num_lic'])), 2, ',', ' ');
						?>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<?php
							echo number_format( ($reponse['poids']-$this-> getSommeFobLicence($reponse['num_lic'])), 2, ',', ' ');
						?>
					</td>
					<td style="text-align: center; border: 1px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Dossiers affectés" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1000,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<!--<form method="POST" action="">
							<input type="hidden" value="<?php echo $reponse['num_lic'];?>" name="num_lic">
							<button class="btn btn-sm btn-warning" name="edit">
								<i class="fa fa-edit"></i>
							</button>
						</form>-->
						<button class="btn btn-sm btn-warning" data-toggle="modal" data-target=".editLicence_<?php echo str_replace(' ', '_', $reponse['num_lic']);?>">
							<i class=" fas fa-edit" style="color: black;"></i>
						</button>
					</td><!--
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm bg bg-teal" data-toggle="modal" data-target=".manipulation_<?php echo $reponse['num_lic'];?>">
							<i class=" fas fa-indent" style="color: black;"></i>
						</button>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm btn-success" onclick="window.open('appurement.php?num_lic=<?php echo $reponse['num_lic'];?>','pop1','width=800,height=800');">
							<i class=" fas fa-check"></i>
						</button>
					</td> -->
				</tr>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherLicenceRecherche($id_mod_lic, $id_cli, $id_type_lic, $num_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = '%'.$num_lic.'%';

			$sql = "";
			$sql2 = "";

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = 0;

			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							l.autre_frais AS autre_frais,
							l.date_val AS date_val2,
							m.sig_mon AS sig_mon,
							m.id_mon AS id_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							l.av_ara AS av_ara,
							l.ref_av AS ref_av,
							l.date_cloture AS date_cloture,
							l.statut_lic AS statut_lic
						FROM licence l, monnaie m, client cl, banque b
						WHERE l.id_mod_lic = ?
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
							AND l.num_lic LIKE ?
						ORDER BY l.date_creat_lic DESC";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic'], $entree['num_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				$bg = "bg-light";
				$couleur = "";

				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}
				include('modalManipulation.php');
				include('modalEditLicence.php');
			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['commodity'];?></td>
					<?php
				}
				?>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: right;border: 1px solid black;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']+$reponse['autre_frais']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<?php
					}
				?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_banq'];?></td>
				<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl']-$this-> getSommeQteLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<?php
				}
				/*if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
				}*/
				?>
				<td style="text-align: center; border: 1px solid black;">
					<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
				</td>
				<td style="text-align: center; border: 1px solid black;">
					<?php
						echo ($reponse['fob'] - $this-> getSommeFobLicence($reponse['num_lic']));
					?>
				</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<?php
				}
				?>
					<td style="text-align: center; border: 1px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Dossiers affectés" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1000,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<!--<form method="POST" action="">
							<input type="hidden" value="<?php echo $reponse['num_lic'];?>" name="num_lic">
							<button class="btn btn-sm btn-warning" name="edit">
								<i class="fa fa-edit"></i>
							</button>
						</form>-->
						<button class="btn btn-sm btn-warning" data-toggle="modal" data-target=".editLicence_<?php echo str_replace(' ', '_', $reponse['num_lic']);?>">
							<i class=" fas fa-edit" style="color: black;"></i>
						</button>
					</td><!--
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm bg bg-teal" data-toggle="modal" data-target=".manipulation_<?php echo $reponse['num_lic'];?>">
							<i class=" fas fa-indent" style="color: black;"></i>
						</button>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm btn-success" onclick="window.open('appurement.php?num_lic=<?php echo $reponse['num_lic'];?>','pop1','width=800,height=800');">
							<i class=" fas fa-check"></i>
						</button>
					</td> -->
				</tr>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function editLicence($id_mod_lic, $id_cli, $id_type_lic, $num_lic){
			include("connexion.php");
			$entree['num_lic'] = $num_lic;

			$compteur = 0;

			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							l.date_val AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							cl.id_cli AS id_cli,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact
						FROM licence l, monnaie m, client cl, banque b
						WHERE l.num_lic = ?
							AND l.id_cli = cl.id_cli
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
						ORDER BY l.date_val DESC";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['num_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				$bg = "bg-light";
				$couleur = "";

				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}

			?>
				<form method="POST" action="">
					<input type="hidden" value="<?php echo $reponse['num_lic'];?>" name="num_lic_old">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6_licence <?php echo $bg;?>" style=" text-align: left; border: 1px solid black;">
						<input type="text" name="num_lic" value="<?php echo $reponse['num_lic'];?>" class="form-control cc-exp" required>
					</td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 1px solid black;">
						<input type="date" name="date_val" value="<?php echo $reponse['date_val'];?>" class="form-control cc-exp" required>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<input type="date" name="date_exp" value="<?php echo $this-> getLastEpirationLicence2($reponse['num_lic']);?>" class="form-control cc-exp" required>
					</td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><input type="text" name="acheteur" value="<?php echo $reponse['acheteur'];?>" class="form-control cc-exp" required></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><input type="text" name="fournisseur" value="<?php echo $reponse['fournisseur'];?>" class="form-control cc-exp" required></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><input type="text" name="commodity" value="<?php echo $reponse['commodity'];?>" class="form-control cc-exp" required></td>
					<?php
				}
				?>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: right;border: 1px solid black;">
						<input type="number" name="fob" value="<?php echo $reponse['fob'];?>" class="form-control cc-exp" required>
					</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<?php
					}
				?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_banq'];?></td>
				<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl']-$this-> getSommeQteLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<?php
				}
				/*if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
				}*/
				?>
				<td style="text-align: center; border: 1px solid black;">
					<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
				</td>
				<td style="text-align: center; border: 1px solid black;">
					<?php
						echo ($reponse['fob'] - $this-> getSommeFobLicence($reponse['num_lic']));
					?>
				</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<?php
				}
				?>
					<td style="text-align: center; border: 1px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Dossiers affectés" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1000,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-success" name="modifierLicence">
							<i class="fa fa-check"></i>
						</button>
					</td>
				</tr>
				</form>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherLicenceExcel($id_mod_lic, $id_cli, $id_type_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$status = "";

			$compteur = 0;

			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact
						FROM licence l, monnaie m, client cl, banque b
						WHERE l.id_mod_lic = ?
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
						ORDER BY l.date_val DESC";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				$bg = "bg-light";
				$couleur = "";

				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style='color: grey;'";
					$couleur = "dark";
					$status = 'Cloturée avec dossier';
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style='color: green;'";
					$couleur = "success";
					$status = 'Apurée Banque';
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style='color: red;'";
					$couleur = "danger";
					$status = 'Expirée';
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style='color: orange;'";
					$couleur = "warning";
					$status = 'Expiration -40 jours';
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style='color: red;'";
					$couleur = "danger";
					$status = 'Expirée';
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style='color: blue;'";
					$couleur = "info";
					$status = 'Partielle';
				}

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" text-align: left; border: 0.5px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 0.5px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 0.5px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['commodity'];?></td>
					<?php
				}
				?>
					<td style="text-align: right;border: 0.5px solid black;"><?php echo $reponse['fob'].' '.$reponse['sig_mon'];?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['assurance'];?></td>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['fret'];?></td>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo ($reponse['fob']+$reponse['assurance']+$reponse['fret']);?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['qte_decl'];?></td>
					<?php
					}
				?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['nom_banq'];?></td>
				<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']);?></td>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['qte_decl']-$this-> getSommeQteLicence($reponse['num_lic']);?></td>
					<?php
				}
				/*if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
				}*/
				?>
				<td style="text-align: center; border: 0.5px solid black;">
					<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
				</td>
				<td style="text-align: center; border: 0.5px solid black;">
					<?php
						echo ($reponse['fob'] - $this-> getSommeFobLicence($reponse['num_lic']));
					?>
				</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['date_fact'];?></td>
					<?php
				}
				?>
					<td style="text-align: center; border: 0.5px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 0.5px solid black; color: black; background-color: white;">
						<?php echo $status;?>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherLicenceUpload($id_mod_lic, $id_util){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM licence_upload
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['fournisseur'];?>
					</td>
					<td>
						<?php echo $reponse['commodity'];?>
					</td>
					<td>
						<?php echo $reponse['po'];?>
					</td>
					<td>
						<?php echo $reponse['facture'];?>
					</td>
					<td>
						<?php echo $reponse['num_licence'];?>
					</td>
					<td>
						<?php echo $reponse['monnaie'];?>
					</td>
					<td>
						<?php echo $reponse['fob'];?>
					</td>
					<td>
						<?php echo $reponse['fret'];?>
					</td>
					<td>
						<?php echo $reponse['assurance'];?>
					</td>
					<td>
						<?php echo $reponse['autre_frais'];?>
					</td>
					<td>
						<?php echo $reponse['fsi'];?>
					</td>
					<td>
						<?php echo $reponse['aur'];?>
					</td>
					<td>
						<?php echo $reponse['validation'];?>
					</td>
					<td>
						<?php echo $reponse['extreme'];?>
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteLicence">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierUpload($id_mod_lic, $id_util){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM dossier_upload
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td>
						<?php echo $reponse['num_lic'];?>
					</td>
					<td>
						<?php echo $reponse['cod'];?>
					</td>
					<td>
						<?php echo $reponse['fxi'];?>
					</td>
					<td>
						<?php echo $reponse['montant_av'];?>
					</td>
					<td>
						<?php echo $reponse['date_fact'];?>
					</td>
					<td>
						<?php echo $reponse['ref_fact'];?>
					</td>
					<td>
						<?php echo $reponse['fob'];?>
					</td>
					<td>
						<?php echo $reponse['fret'];?>
					</td>
					<td>
						<?php echo $reponse['assurance'];?>
					</td>
					<td>
						<?php echo $reponse['autre_frais'];?>
					</td>
					<td>
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td>
						<?php echo $reponse['montant_decl'];?>
					</td>
					<td>
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td>
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td>
						<?php echo $reponse['date_quit'];?>
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteDossierUpload">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierUploadTrackingKlsa($id_mod_lic, $id_util){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM dossier_upload_tracking
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td>
						<?php echo $reponse['num_lic'];?>
					</td>
					<td>
						<?php echo $reponse['t1'];?>
					</td>
					<td>
						<?php echo $reponse['poids'];?>
					</td>
					<td>
						<?php echo $reponse['ref_fact'];?>
					</td>
					<td>
						<?php echo $reponse['horse'];?>
					</td>
					<td>
						<?php echo $reponse['trailer_1'];?>
					</td>
					<td>
						<?php echo $reponse['trailer_2'];?>
					</td>
					<td>
						<?php echo $reponse['transporteur'];?>
					</td>
					<td>
						<?php echo $reponse['destination'];?>
					</td>
					<td>
						<?php echo $reponse['arrival_date'];?>
					</td>
					<td>
						<?php echo $reponse['crossing_date'];?>
					</td>
					<td>
						<?php echo $reponse['wiski_arriv'];?>
					</td>
					<td>
						<?php echo $reponse['wiski_dep'];?>
					</td>
					<td>
						<?php echo $reponse['remarque'];?>
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteDossierUpload">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierUploadExport($id_util){
			include("connexion.php");
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM dossier_upload_export
												WHERE id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td>
						<?php echo $reponse['num_lic'];?>
					</td>
					<td>
						<?php echo $reponse['date_exp'];?>
					</td>
					<td>
						<?php echo $reponse['tonnage'];?>
					</td>
					<td>
						<?php echo $reponse['ship_num'];?>
					</td>
					<td>
						<?php echo $reponse['barge'];?>
					</td>
					<td>
						<?php echo $reponse['horse'];?>
					</td>
					<td>
						<?php echo $reponse['trailer_1'];?>
					</td>
					<td>
						<?php echo $reponse['trailer_2'];?>
					</td>
					<td>
						<?php echo $reponse['num_lot'];?>
					</td>
					<td>
						<?php echo $reponse['nbr_bags'];?>
					</td>
					<td>
						<?php echo $reponse['poids'];?>
					</td>
					<td>
						<?php echo $reponse['kapulo_load'];?>
					</td>
					<td>
						<?php echo $reponse['dispatch_pweto'];?>
					</td>
					<td>
						<?php echo $reponse['arrival_pweto'];?>
					</td>
					<td>
						<?php echo $reponse['barge_load'];?>
					</td>
					<td>
						<?php echo $reponse['barge_dispatch_date'];?>
					</td>
					<td>
						<?php echo $reponse['doc_receiv'];?>
					</td>
					<td>
						<?php echo $reponse['nbre_seal'];?>
					</td>
					<td>
						<?php echo $reponse['dgda_seal'];?>
					</td>
					<td>
						<?php echo $reponse['remarque'];?>
					</td>
					<td>
						<?php echo $reponse['transporter'];?>
					</td>
					<td>
						<?php echo $reponse['load_date'];?>
					</td>
					<td>
						<?php echo $reponse['pv_mine'];?>
					</td>
					<td>
						<?php echo $reponse['demande_attestation'];?>
					</td>
					<td>
						<?php echo $reponse['assay_date'];?>
					</td>
					<td>
						<?php echo $reponse['ceec_in'];?>
					</td>
					<td>
						<?php echo $reponse['ceec_out'];?>
					</td>
					<td>
						<?php echo $reponse['min_div_in'];?>
					</td>
					<td>
						<?php echo $reponse['min_div_out'];?>
					</td>
					<td>
						<?php echo $reponse['date_decl'];?>
					</td>
					<td>
						<?php echo $reponse['dgda_in'];?>
					</td>
					<td>
						<?php echo $reponse['date_liq'];?>
					</td>
					<td>
						<?php echo $reponse['date_quit'];?>
					</td>
					<td>
						<?php echo $reponse['dgda_out'];?>
					</td>
					<td>
						<?php echo $reponse['gov_in'];?>
					</td>
					<td>
						<?php echo $reponse['gov_out'];?>
					</td>
					<td>
						<?php echo $reponse['dispatch_date'];?>
					</td>
					<td>
						<?php echo $reponse['klsa_arriv'];?>
					</td>
					<td>
						<?php echo $reponse['end_form'];?>
					</td>
					<td>
						<?php echo $reponse['exit_drc'];?>
					</td>
					<td>
						<?php echo $reponse['cleared'];?>
					</td>
					<td>
						<?php echo $reponse['statut'];?>
					</td>
					<td>
						<?php echo $reponse['site_load'];?>
					</td>
					<td>
						<?php echo $reponse['destination'];?>
					</td>
					<td>
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td>
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td>
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td>
						<?php echo $reponse['impala_sncc'];?>
					</td>
					<td>
						<?php echo $reponse['docs_sncc'];?>
					</td>
					<td>
						<?php echo $reponse['sncc_sakania'];?>
					</td>
					<td>
						<?php echo $reponse['sakania_date'];?>
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteDossierUpload">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierUpload2($id_mod_lic, $id_util){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM dossier_upload_tracking
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td>
						<?php echo $reponse['mca_b_ref'];?>
					</td>
					<td>
						<?php echo $reponse['road_manif'];?>
					</td>
					<td>
						<?php echo $reponse['date_preal'];?>
					</td>
					<td>
						<?php echo $reponse['t1'];?>
					</td>
					<td>
						<?php echo $reponse['poids'];?>
					</td>
					<td>
						<?php echo $reponse['fob'];?>
					</td>
					<td>
						<?php echo $reponse['fret'];?>
					</td>
					<td>
						<?php echo $reponse['assurance'];?>
					</td>
					<td>
						<?php echo $reponse['autre_frais'];?>
					</td>
					<td>
						<?php echo $reponse['ref_fact'];?>
					</td>
					<td>
						<?php echo $reponse['fournisseur'];?>
					</td>
					<td>
						<?php echo $reponse['po'];?>
					</td>
					<td>
						<?php echo $reponse['commodity'];?>
					</td>
					<td>
						<?php echo $reponse['horse'];?>
					</td>
					<td>
						<?php echo $reponse['trailer_1'];?>
					</td>
					<td>
						<?php echo $reponse['trailer_2'];?>
					</td>
					<td>
						<?php echo $reponse['num_lic'];?>
					</td>
					<td>
						<?php echo $reponse['num_exo'];?>
					</td>
					<td>
						<?php echo $reponse['crossing_date'];?>
					</td>
					<td>
						<?php echo $reponse['arrival_date'];?>
					</td>
					<td>
						<?php echo $reponse['wiski_arriv'];?>
					</td>
					<td>
						<?php echo $reponse['wiski_dep'];?>
					</td>
					<td>
						<?php echo $reponse['amicongo_arriv'];?>
					</td>
					<td>
						<?php echo $reponse['insp_report'];?>
					</td>
					<td>
						<?php echo $reponse['ir'];?>
					</td>
					<td>
						<?php echo $reponse['ref_crf'];?>
					</td>
					<td>
						<?php echo $reponse['date_crf'];?>
					</td>
					<td>
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td>
						<?php echo $reponse['dgda_in'];?>
					</td>
					<td>
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td>
						<?php echo $reponse['date_liq'];?>
					</td>
					<td>
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td>
						<?php echo $reponse['date_quit'];?>
					</td>
					<td>
						<?php echo $reponse['dgda_out'];?>
					</td>
					<td>
						<?php echo $reponse['custom_deliv'];?>
					</td>
					<td>
						<?php echo $reponse['dispatch_deliv'];?>
					</td>
					<td>
						<?php echo $reponse['statut'];?>
					</td>
					<td>
						<?php echo $reponse['remarque'];?>
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteDossierUpload">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherManipulationLicence($id_mod_lic, $id_cli, $id_type_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";

			$nbre_dossier = 0;
			$num_lic = '';
			$active_rowspan = 1;

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = 0;

			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							l.autre_frais AS autre_frais,
							l.fsi AS fsi,
							l.aur AS aur,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							d.ref_dos AS ref_dos,
							d.id_dos AS id_dos,
							d.fob AS fob_dos,
							d.fret AS fret_dos,
							d.assurance AS assurance_dos,
							d.autre_frais AS autre_frais_dos,
							d.ref_fact AS ref_fact_dos,
							d.date_fact AS date_fact_dos,
							d.ref_decl AS ref_decl,
							d.ref_liq AS ref_liq,
							d.ref_quit AS ref_quit,
							d.montant_decl AS montant_decl,
							d.cod AS cod_dos,
							d.fxi AS fxi,
							l.commodity AS commodityLic,
							d.montant_av AS montant_av,
							d.remarque_lic AS remarque_lic,
							DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
						FROM licence l, monnaie m, client cl, banque b, dossier d
						WHERE l.id_mod_lic = ?
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
							AND l.num_lic = d.num_lic
						ORDER BY l.date_val, l.num_lic DESC";
			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$nbre_dossier = $this-> getNbreDossierLicence($reponse['num_lic']);
				if ($num_lic != $reponse['num_lic']) {
					$num_lic = $reponse['num_lic'];
					$active_rowspan = 1;
				}
				$num_lic = $reponse['num_lic'];
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				$bg = "bg-light";
				$couleur = "";

				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style=" border-right: 1px solid black;vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<?php

					if ( ($nbre_dossier > 1) && ($num_lic == $reponse['num_lic']) && ($active_rowspan == 1) ) {
						$active_rowspan = 0;
					?>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: left; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['commodityLic'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fret'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['assurance'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob']+$reponse['fret']+$reponse['assurance']+$reponse['autre_frais'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fsi'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['aur'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
					}elseif ( ($nbre_dossier <= 1) && ($num_lic == $reponse['num_lic']) && ($active_rowspan == 1) ){
					?>
					<td style="text-align: left; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $marchandise;?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob']+$reponse['fret']+$reponse['assurance']+$reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fsi'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['aur'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php

					}

					?>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 12em;" type="text" name="cod_<?php echo $compteur;?>" value="<?php echo $reponse['cod_dos'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 10em;" type="text" name="fxi_<?php echo $compteur;?>" value="<?php echo $reponse['fxi'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 8em;" type="number" step="0.01" min="0" name="montant_av_<?php echo $compteur;?>" value="<?php echo $reponse['montant_av'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_fact_dos'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact_dos'];?></td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob_dos'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 8em; text-align: right;" type="number" step="0.01" min="0" name="fret_dos_<?php echo $compteur;?>" value="<?php echo $reponse['fret_dos'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 8em; text-align: right;" type="number" step="0.01" min="0" name="assurance_dos_<?php echo $compteur;?>" value="<?php echo $reponse['assurance_dos'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 8em; text-align: right;" type="number" step="0.01" min="0" name="autre_frais_dos_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais_dos'];?>">
					</td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob_dos']+$reponse['fret_dos']+$reponse['assurance_dos']+$reponse['autre_frais_dos'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_decl'];?></td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['montant_decl'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_liq'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_quit'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_quit'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input type="text" name="remarque_lic_<?php echo $compteur;?>" value="<?php echo $reponse['remarque_lic'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<a title="Dossiers affectés" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1000,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php

			}

		}

		public function manipulationLicence($num_lic, $i){
			include("connexion.php");
			$entree['num_lic'] = $num_lic;

			$compteur = 0;

				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							l.autre_frais AS autre_frais,
							l.fsi AS fsi,
							l.aur AS aur,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							d.ref_dos AS ref_dos,
							d.id_dos AS id_dos,
							d.fob AS fob_dos,
							d.fret AS fret_dos,
							d.assurance AS assurance_dos,
							d.autre_frais AS autre_frais_dos,
							d.ref_fact AS ref_fact_dos,
							d.date_fact AS date_fact_dos,
							d.ref_decl AS ref_decl,
							d.ref_liq AS ref_liq,
							d.ref_quit AS ref_quit,
							d.montant_decl AS montant_decl,
							d.cod AS cod_dos,
							d.fxi AS fxi,
							l.commodity AS commodityLic,
							d.montant_av AS montant_av,
							d.remarque_lic AS remarque_lic,
							DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
						FROM licence l, monnaie m, client cl, banque b, dossier d
						WHERE l.num_lic = ?
							AND l.id_cli = cl.id_cli
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
							AND l.num_lic = d.num_lic
						ORDER BY d.ref_dos ASC";
			$requete2 = $connexion-> prepare($sql);
			$requete2-> execute(array($entree['num_lic']));
			while($reponse2 = $requete2-> fetch()){
				$compteur++;
				if ($this-> verifierApurementDossier($reponse2['id_dos']) == true) {
					$apurement = 'APPURE';
				}else{
					$apurement = 'NON-APPURE';
				}
			?>
				<input type="hidden" name="id_dos_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['id_dos'];?>">
				<div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">MCA FILE REF</label>
		            <input type="text" value="<?php echo $reponse2['ref_dos'];?>" disabled="disabled" style="text-align: center; color: white; background-color: grey;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">N.COD</label>
		            <input type="text" name="cod_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['cod_dos'];?>" style="text-align: left; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">FXI</label>
		            <input type="text" name="fxi_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['fxi'];?>" style="text-align: left; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">MONTANT AV</label>
		            <input type="number" step='0.001' name="montant_av_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['montant_av'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">FOB FACTURE</label>
		            <input type="number" step='0.001' name="fob_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['fob_dos'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">FRET FACTURE</label>
		            <input type="number" step='0.001' name="fret_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['fret_dos'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">ASSURANCE</label>
		            <input type="number" step='0.001' name="assurance_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['assurance_dos'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">AUTRE FRAIS</label>
		            <input type="number" step='0.001' name="autre_frais_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['autre_frais_dos'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">DECLARATION</label>
		            <input type="text" style="text-align: center; color: white; background-color: black;" class="form-control cc-exp"value="<?php echo $reponse2['ref_decl'];?>" disabled="disabled">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">LIQUIDATION</label>
		            <input type="text" style="text-align: center; color: white; background-color: black;" class="form-control cc-exp"value="<?php echo $reponse2['ref_liq'];?>" disabled="disabled">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">QUITTANCE</label>
		            <input type="text" style="text-align: center; color: white; background-color: black;" class="form-control cc-exp"value="<?php echo $reponse2['ref_quit'];?>" disabled="disabled">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">ETAT</label>
		            <input disabled="" value="<?php echo $apurement;?>" style="text-align: center; color: white; background-color: black;" class="form-control cc-exp">
		          </div>
          			<div class="col-md-12"><hr></div>
			<?php
			}$requete2-> closeCursor();
			?>
	          <input type="hidden" name="nbre" value="<?php echo $compteur;?>">
	        <?php

		}

		public function afficherManipulationLicenceExcel($id_mod_lic, $id_cli, $id_type_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";

			$nbre_dossier = 0;
			$num_lic = '';
			$active_rowspan = 1;

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = 0;

			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							l.autre_frais AS autre_frais,
							l.fsi AS fsi,
							l.aur AS aur,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							d.ref_dos AS ref_dos,
							d.id_dos AS id_dos,
							d.fob AS fob_dos,
							d.fret AS fret_dos,
							d.assurance AS assurance_dos,
							d.autre_frais AS autre_frais_dos,
							d.ref_fact AS ref_fact_dos,
							d.date_fact AS date_fact_dos,
							d.ref_decl AS ref_decl,
							d.ref_liq AS ref_liq,
							d.ref_quit AS ref_quit,
							d.montant_decl AS montant_decl,
							d.cod AS cod_dos,
							d.fxi AS fxi,
							l.commodity AS commodityLic,
							d.montant_av AS montant_av,
							d.remarque_lic AS remarque_lic,
							DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
						FROM licence l, monnaie m, client cl, banque b, dossier d
						WHERE l.id_mod_lic = ?
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
							AND l.num_lic = d.num_lic
						ORDER BY l.date_val, l.num_lic DESC";
			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$nbre_dossier = $this-> getNbreDossierLicence($reponse['num_lic']);
				if ($num_lic != $reponse['num_lic']) {
					$num_lic = $reponse['num_lic'];
					$active_rowspan = 1;
				}
				$num_lic = $reponse['num_lic'];
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				$bg = "bg-light";
				$couleur = "";

				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style='color: grey;'";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style='color: green;'";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style='color: red;'";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style='color: orange;'";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style='color: red;'";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style='color: blue;'";
					$couleur = "info";
				}

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style=" border-right: 1px solid black;vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<?php

					if ( ($nbre_dossier > 1) && ($num_lic == $reponse['num_lic']) && ($active_rowspan == 1) ) {
						$active_rowspan = 0;
					?>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: left; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['commodityLic'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fret'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['assurance'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob']+$reponse['fret']+$reponse['assurance']+$reponse['autre_frais'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fsi'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['aur'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
					}elseif ( ($nbre_dossier <= 1) && ($num_lic == $reponse['num_lic']) && ($active_rowspan == 1) ){
					?>
					<td style="text-align: left; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $marchandise;?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob']+$reponse['fret']+$reponse['assurance']+$reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fsi'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['aur'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php

					}

					?>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['cod_dos'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['fxi'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['montant_av'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_fact_dos'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact_dos'];?></td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob_dos'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['fret_dos'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['assurance_dos'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['autre_frais_dos'];?>
					</td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob_dos']+$reponse['fret_dos']+$reponse['assurance_dos']+$reponse['autre_frais_dos'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_decl'];?></td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['montant_decl'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_liq'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_quit'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_quit'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['remarque_lic'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();

			}

		}

		public function afficherLicenceApresRecherche($num_lic, $id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = '%'.$num_lic.'%';

			if($_SESSION['id_role'] == '4'){
				$client = $this-> getClientUtilisateur($_SESSION['id_util']);
				$id_cli = $client['id_cli'];
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							l.assurance AS assurance,
							l.fret AS fret,
							l.acheteur AS acheteur,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							DATE(CURRENT_DATE()) AS aujourdhui
						FROM licence l, monnaie m, client cl
						WHERE l.num_lic LIKE ?
							AND l.id_mod_lic = ?
							AND l.id_mon = m.id_mon
							AND l.id_cli = cl.id_cli
							AND cl.id_cli = $id_cli";
			}else{
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							l.assurance AS assurance,
							l.fret AS fret,
							l.acheteur AS acheteur,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							DATE(CURRENT_DATE()) AS aujourdhui
						FROM licence l, monnaie m, client cl
						WHERE l.num_lic LIKE ?
							AND l.id_mod_lic = ?
							AND l.id_mon = m.id_mon
							AND l.id_cli = cl.id_cli";
			}

			$compteur = 0;

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['num_lic'], $entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				$bg = "bg-info";
				if( ($date_exp >= $reponse['aujourdhui']) ){
					$bg = "bg-success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
				}

			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="col_1 <?php echo $bg;?>" style=" text-align: left; border: 1px solid black;"><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style="text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $marchandise;?></td>
					<?php
				}
				?>
					<td style="text-align: right;border: 1px solid black;"><?php echo number_format( $reponse['fob'], 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php //echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']*0.6), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']*0.002), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
					}
				?>
					<td style="text-align: center; border: 1px solid black;">
						<a href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherFactureLicenceModele($id_mod_lic, $id_cli, $premiere_entree, $nombre_dossier_par_page, $etat){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$compteur = $premiere_entree;
			$bg = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql2 = ' AND cl.id_cli = '.$id_cli;
			}

			if ($etat == 'Factures sans licence') {

				$requete = $connexion-> prepare("SELECT f.ref_fact AS ref_fact,
												DATE_FORMAT(f.date_fact, '%d/%m/%Y') AS date_fact,
												DATE_FORMAT(f.date_fact_rec, '%d/%m/%Y') AS date_fact_rec,
												f.date_fact_rec AS date_fact_rec2,
												DATE_FORMAT(f.date_val, '%d/%m/%Y') AS date_val,
												UPPER(cl.nom_cli) AS nom_cli,
												f.fournisseur AS fournisseur,
												f.fichier_fact AS fichier_fact,
												DATE(CURRENT_DATE()) AS aujourdhui,
												f.commodity AS commodity,
												m.sig_mon AS sig_mon,
												f.montant_fact AS montant_fact,
												f.fret_fact AS fret_fact,
												f.assurance_fact AS assurance_fact,
												f.autre_frais_fact AS autre_frais_fact
											FROM facture_licence f, client cl, monnaie m
											WHERE f.id_mod_lic = ?
												AND f.id_cli = cl.id_cli
												$sql2
												AND f.id_mon = m.id_mon
												AND f.ref_fact NOT IN(
													SELECT f.ref_fact AS ref_fact
													FROM facture_licence f, client cl, monnaie m
													WHERE f.id_cli = cl.id_cli
														$sql2
														AND f.id_mon = m.id_mon
														AND f.ref_fact IN(SELECT ref_fact FROM licence)
													ORDER BY f.date_creat_fact DESC
												)
											ORDER BY f.date_creat_fact DESC
											LIMIT $premiere_entree, $nombre_dossier_par_page");

			}else if ($etat == 'Facture ayant licence') {

				$requete = $connexion-> prepare("SELECT f.ref_fact AS ref_fact,
												DATE_FORMAT(f.date_fact, '%d/%m/%Y') AS date_fact,
												DATE_FORMAT(f.date_fact_rec, '%d/%m/%Y') AS date_fact_rec,
												f.date_fact_rec AS date_fact_rec2,
												DATE_FORMAT(f.date_val, '%d/%m/%Y') AS date_val,
												UPPER(cl.nom_cli) AS nom_cli,
												f.fournisseur AS fournisseur,
												f.fichier_fact AS fichier_fact,
												DATE(CURRENT_DATE()) AS aujourdhui,
												f.commodity AS commodity,
												m.sig_mon AS sig_mon,
												f.montant_fact AS montant_fact,
												f.fret_fact AS fret_fact,
												f.assurance_fact AS assurance_fact,
												f.autre_frais_fact AS autre_frais_fact
											FROM facture_licence f, client cl, monnaie m
											WHERE f.id_mod_lic = ?
												AND f.id_cli = cl.id_cli
												$sql2
												AND f.id_mon = m.id_mon
												AND f.ref_fact IN(SELECT ref_fact FROM licence)
											ORDER BY f.date_creat_fact DESC
											LIMIT $premiere_entree, $nombre_dossier_par_page");

			}else{

				$requete = $connexion-> prepare("SELECT f.ref_fact AS ref_fact,
												DATE_FORMAT(f.date_fact, '%d/%m/%Y') AS date_fact,
												DATE_FORMAT(f.date_fact_rec, '%d/%m/%Y') AS date_fact_rec,
												f.date_fact_rec AS date_fact_rec2,
												DATE_FORMAT(f.date_val, '%d/%m/%Y') AS date_val,
												UPPER(cl.nom_cli) AS nom_cli,
												f.fournisseur AS fournisseur,
												f.fichier_fact AS fichier_fact,
												DATE(CURRENT_DATE()) AS aujourdhui,
												f.commodity AS commodity,
												m.sig_mon AS sig_mon,
												f.montant_fact AS montant_fact,
												f.fret_fact AS fret_fact,
												f.assurance_fact AS assurance_fact,
												f.autre_frais_fact AS autre_frais_fact
											FROM facture_licence f, client cl, monnaie m
											WHERE f.id_mod_lic = ?
												AND f.id_cli = cl.id_cli
												$sql2
												AND f.id_mon = m.id_mon
											ORDER BY f.date_creat_fact DESC
											LIMIT $premiere_entree, $nombre_dossier_par_page");

			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = '';
				if ( $this-> getLicenceFacture($reponse['ref_fact']) != null ) {
					$bg = "bg bg-success";
				}else if ( $this-> getDifferenceDate($reponse['aujourdhui'], $reponse['date_fact_rec2']) >= '2' ) {
					$bg = "bg bg-danger";
				}else{
					$bg = "bg bg-light";
				}

			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.75rem; border-top: 1px solid black;" ><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.75rem; border-top: 1px solid black;" ><?php echo $reponse['ref_fact'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $this-> getLicenceFacture($reponse['ref_fact']);?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact_rec']?></td>
					<td class="" style="text-align: center; border: 1px solid black;">
						<?php

							if ( $this-> getDelaiFactureLicence($reponse['ref_fact']) != null ) {
								echo $this-> getDelaiFactureLicence($reponse['ref_fact']);
							}else{
								echo $this-> getDifferenceDate($reponse['aujourdhui'], $reponse['date_fact_rec2']);
							}

						?>
					</td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;">
						<?php echo $reponse['date_val'];?>
					</td>
					<td class="" style="text-align: center; border: 1px solid black;">
						<?php echo $reponse['sig_mon'];?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['montant_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['fret_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['assurance_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['autre_frais_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['montant_fact']+$reponse['fret_fact']+$reponse['assurance_fact']+$reponse['autre_frais_fact'], 2, ',', ' ');?>
					</td>
					<td style="text-align: center; border: 1px solid black; background-color: white;">
						<button class="btn btn-default" onclick="window.open('../factures/<?php echo $reponse['ref_fact'];?>/<?php echo $reponse['fichier_fact'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</button>
					</td>
					<td style="background-color: white; border: 1px solid black;">
						<form method="POST" action="">
							<input type="hidden" name="ref_fact_old" value="<?php echo $reponse['ref_fact'];?>">
							<center>
								<button class="btn btn-warning" type="submit" name="modifier">
									<i class="fa fa-edit"></i>
								</button>
							</center>
						</form>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherFactureLicenceModeleRecherche($id_mod_lic, $id_cli, $ref_fact){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_fact'] = $ref_fact;
			$compteur = 0;
			$bg = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql2 = ' AND cl.id_cli = '.$id_cli;
			}

			$requete = $connexion-> prepare("SELECT f.ref_fact AS ref_fact,
										DATE_FORMAT(f.date_fact, '%d/%m/%Y') AS date_fact,
										DATE_FORMAT(f.date_fact_rec, '%d/%m/%Y') AS date_fact_rec,
										f.date_fact_rec AS date_fact_rec2,
										DATE_FORMAT(f.date_val, '%d/%m/%Y') AS date_val,
										UPPER(cl.nom_cli) AS nom_cli,
										f.fournisseur AS fournisseur,
										f.fichier_fact AS fichier_fact,
										DATE(CURRENT_DATE()) AS aujourdhui,
										f.commodity AS commodity,
										m.sig_mon AS sig_mon,
										f.montant_fact AS montant_fact,
										f.fret_fact AS fret_fact,
										f.assurance_fact AS assurance_fact,
										f.autre_frais_fact AS autre_frais_fact
									FROM facture_licence f, client cl, monnaie m
									WHERE (f.ref_fact = ?
											OR f.ref_fact IN (
												SELECT ref_fact FROM licence WHERE num_lic = ?
											))
										AND f.id_mod_lic = ?
										AND f.id_cli = cl.id_cli
										$sql2
										AND f.id_mon = m.id_mon
									ORDER BY f.date_creat_fact DESC");
			$requete-> execute(array($entree['ref_fact'], $entree['ref_fact'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = '';
				if ( $this-> getLicenceFacture($reponse['ref_fact']) != null ) {
					$bg = "bg bg-success";
				}else if ( $this-> getDifferenceDate($reponse['aujourdhui'], $reponse['date_fact_rec2']) >= '2' ) {
					$bg = "bg bg-danger";
				}else{
					$bg = "bg bg-light";
				}

			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.75rem; border-top: 1px solid black;" ><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.75rem; border-top: 1px solid black;" ><?php echo $reponse['ref_fact'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $this-> getLicenceFacture($reponse['ref_fact']);?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact_rec']?></td>
					<td class="" style="text-align: center; border: 1px solid black;">
						<?php

							if ( $this-> getDelaiFactureLicence($reponse['ref_fact']) != null ) {
								echo $this-> getDelaiFactureLicence($reponse['ref_fact']);
							}else{
								echo $this-> getDifferenceDate($reponse['aujourdhui'], $reponse['date_fact_rec2']);
							}

						?>
					</td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;">
						<?php echo $reponse['date_val'];?>
					</td>
					<td class="" style="text-align: center; border: 1px solid black;">
						<?php echo $reponse['sig_mon'];?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['montant_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['fret_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['assurance_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['autre_frais_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['montant_fact']+$reponse['fret_fact']+$reponse['assurance_fact']+$reponse['assurance_fact'], 2, ',', ' ');?>
					</td>
					<td style="text-align: center; border: 1px solid black; background-color: white;">
						<button class="btn btn-default" onclick="window.open('../factures/<?php echo $reponse['ref_fact'];?>/<?php echo $reponse['fichier_fact'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</button>
					</td>
					<td style="background-color: white; border: 1px solid black;">
						<form method="POST" action="">
							<input type="hidden" name="ref_fact_old" value="<?php echo $reponse['ref_fact'];?>">
							<center>
								<button class="btn btn-warning" type="submit" name="modifier">
									<i class="fa fa-edit"></i>
								</button>
							</center>
						</form>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td style=""><hr></td>
			</tr>
			<?php
		}

		public function afficherAV($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$compteur = 0;
			$bg = '';

			$requete = $connexion-> prepare("SELECT a.ref_av AS ref_av, DATE_FORMAT(a.date_av, '%d/%m/%Y') AS date_av,
													a.fxi AS fxi, a.montant_av AS montant_av, 
													a.fichier_av AS fichier_av, m.sig_mon AS sig_mon,
													a.num_lic AS num_lic,
													REPLACE(REPLACE(a.ref_av, ' ', '_'), '-', '_') AS ref_av_2
												FROM av a, monnaie m, licence l
												WHERE a.id_mon = m.id_mon
													AND a.num_lic = l.num_lic
													AND l.id_cli = ?
												ORDER BY a.date_creat DESC");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = '';
				if ( $reponse['montant_av'] == $this-> getFobDossierAv($reponse['ref_av']) ) {
					$bg = "text text-success";
				}else if ( $reponse['montant_av'] < $this-> getFobDossierAv($reponse['ref_av']) ) {
					$bg = "text text-danger";
				}else {
					$bg = "";
				}
			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="" style=" text-align: left; border: 1px solid black;"><?php echo $compteur;?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['ref_av'];?></td>
					<td class="" style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_av'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['fxi']?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['sig_mon']?></td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format( $reponse['montant_av'], 2, ',', ' ');;?>
					</td>
					<td style="text-align: center;text-align: center; border: 1px solid black;">
						<button class="btn-xs btn-info" onclick="window.open('popUpDossierAv.php?ref_av_2=<?php echo $reponse['ref_av_2'];?>&id_cli=<?php echo $id_cli;?>&ref_av=<?php echo $reponse['ref_av'];?>','pop1','width=1000,height=800');"><i class="fa fa-eye"></i></button>
					</td>
					<td class="" style="text-align: center; border: 1px solid black;"><?php echo $this-> getNombreDossierAv($reponse['ref_av']);?></td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format( $this-> getFobDossierAv($reponse['ref_av']), 2, ',', ' ');;?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format( ($reponse['montant_av'] - $this-> getFobDossierAv($reponse['ref_av'])), 2, ',', ' ');;?>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a href="#" style="color: black;" onclick="window.open('../av/<?php echo $reponse['fichier_av'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function getNombreDossierAv($ref_av){
			include('connexion.php');
			$entree['ref_av'] = $ref_av;
			//$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE ref_av = ?');
			$requete-> execute(array($entree['ref_av']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function afficherDossiersAv($ref_av, $id_cli){
			include("connexion.php");
			$entree['ref_av'] = $ref_av;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT ref_dos, fob
												FROM dossier
												WHERE ref_av = ?
												$sqlClient");
			$requete-> execute(array($entree['ref_av']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherAffectationDeboursClient($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			$requete = $connexion-> prepare("SELECT af.*, deb.nom_deb AS nom_deb, 
													deb.id_deb AS id_deb,
													mt.nom_mod_trans AS nom_mod_trans,
													IF(af.usd='1', 'USD', 'CDF') AS label_usd,
													IF(af.tva='1', 'Actif', 'Non-Actif') AS label_tva
												FROM affectation_debours_client_modele_licence af, mode_transport mt, debours deb
												WHERE af.id_cli = ?
													AND af.id_mod_lic = ?
													AND af.id_mod_trans = mt.id_mod_trans
													AND af.id_deb = deb.id_deb
												ORDER BY mt.id_mod_trans, deb.id_t_deb, deb.nom_deb ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
			<tr>
				<input type="hidden" name="id_deb_<?php echo $compteur;?>" value="<?php echo $reponse['id_deb'];?>">
				<input type="hidden" name="id_mod_trans_<?php echo $compteur;?>" value="<?php echo $reponse['id_mod_trans'];?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['nom_deb'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_mod_trans'];?>
				</td>
				<td style="text-align: right;">
					<input type="number" step="0.05" name="montant_<?php echo $compteur;?>" value="<?php echo $reponse['montant'];?>" class="bg bg-dark" style="width: 8em; text-align: right;">
				</td>
				<td style="text-align: center;">
					<select class="bg bg-dark" name="usd_<?php echo $compteur;?>"style="width: 5em;">
						<option value="<?php echo $reponse['usd'];?>">
							<?php echo $reponse['label_usd'];?>
						</option>
						<option></option>
						<option value="1">USD</option>
						<option value="0">CDF</option>
					</select>
				</td>
				<td style="text-align: center;">
					<select class="bg bg-dark" style="width: 8em;" name="tva_<?php echo $compteur;?>">
						<option value="<?php echo $reponse['tva'];?>">
							<?php echo $reponse['label_tva'];?>
						</option>
						<option></option>
						<option value="1">Actif</option>
						<option value="0">Non-actif</option>
					</select>
				</td>
				<td style="text-align: center;">
					<select class="bg bg-dark" style="" name="detail_<?php echo $compteur;?>">
						<option value="<?php echo $reponse['detail'];?>">
							<?php echo $reponse['detail'];?>
						</option>
						<option></option>
						<option value="1">1</option>
						<option value="0">0</option>
					</select>
				</td>
				<td style="text-align: center;">
					<input type="text" name="code_serv_<?php echo $compteur;?>" value="<?php echo $reponse['code_serv'];?>" class="bg bg-dark" style="width: 8em;">
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function getFobDossierAv($ref_av){
			include('connexion.php');
			$entree['ref_av'] = $ref_av;
			//$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare('SELECT SUM(fob) AS nbre
												FROM dossier
												WHERE ref_av = ?');
			$requete-> execute(array($entree['ref_av']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function afficherLicenceApresRechercheClient($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
													DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
													l.fob AS fob,
													l.assurance AS assurance,
													l.fret AS fret,
													UPPER(cl.nom_cli) AS nom_cli,
													l.fournisseur AS fournisseur,
													m.sig_mon AS sig_mon,
													l.qte_decl AS qte_decl,
													l.acheteur AS acheteur,
													l.fichier_lic AS fichier_lic,
													DATE(CURRENT_DATE()) AS aujourdhui
												FROM licence l, monnaie m, client cl
												WHERE l.id_cli = ?
													AND l.id_mod_lic = ?
													AND l.id_mon = m.id_mon
													AND l.id_cli = cl.id_cli");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);

				$bg = "bg-info";
				if( ($date_exp >= $reponse['aujourdhui']) ){
					$bg = "bg-success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
				}

			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="col_1 <?php echo $bg;?>" style=" text-align: left; border: 1px solid black;"><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style="text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $marchandise;?></td>
					<?php
				}
				?>
					<td style="text-align: right;border: 1px solid black;"><?php echo number_format( $reponse['fob'], 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<?php
					}
				?>
					<td style="text-align: center; border: 1px solid black;">
						<a href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossier($id_march, $id_cli, $id_mod_trans){
			include('connexion.php');

			$entree['id_march'] = $id_march;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}
			if( ($id_mod_trans != null) && ($id_mod_trans != '')){
				$sql2 = ' AND d.id_mod_trans = '.$id_mod_trans;
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.fournisseur AS fournisseur,
													l.num_lic AS num_lic,
													l.fob AS fob,
													l.tonnage AS tonnage,
													UPPER(m.nom_march) AS nom_march,
													s.nom_site AS nom_site
												FROM dossier d, client cl, marchandise m, licence l, site s
												WHERE d.id_march = ?
													AND d.id_march =  m.id_march
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													$sql2
													$sql
													AND d.id_cli =  cl.id_cli
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_march']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "bg-light";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<?php
						if ($this-> getStructureTracking($id_march) == '1') {
							include('acidRow.php');
						}else if ($this-> getStructureTracking($id_march) == '2') {
							include('diversRow.php');
						}
					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
						<select name="cleared_<?php echo $compteur;?>" class="control-form">
							<?php
							if ($reponse['cleared'] == '1') {
							?>
							<option>CLEARED</option>
							<option value="0">TRANSIT</option>
							<option value="2">CANCELED</option>
							<?php
							}if ($reponse['cleared'] == '2') {
							?>
							<option>CANCELED</option>
							<option value="1">CLEARED</option>
							<option value="0">TRANSIT</option>
							<?php
							}if ($reponse['cleared'] == '0') {
							?>
							<option>TRANSIT</option>
							<option value="1">CLEARED</option>
							<option value="2">CANCELED</option>
							<?php
							}
							?>
						</select>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherDossierClientModeTransportModeLicence($id_cli, $id_mod_trans, $id_mod_lic, $num_lic, $premiere_entree, $nombre_dossier_par_page){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.fournisseur AS fournisseur,
													l.num_lic AS num_lic,
													l.commodity AS commodity,
													l.fob AS fob,
													l.tonnage AS tonnage,
													s.nom_site AS nom_site
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND l.num_lic = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.id_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['num_lic'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "bg-light";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<?php
						if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}
					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
						<select name="cleared_<?php echo $compteur;?>" class="control-form">
							<?php
							if ($reponse['cleared'] == '1') {
							?>
							<option>CLEARED</option>
							<option value="0">TRANSIT</option>
							<option value="2">CANCELED</option>
							<?php
							}if ($reponse['cleared'] == '2') {
							?>
							<option>CANCELED</option>
							<option value="1">CLEARED</option>
							<option value="0">TRANSIT</option>
							<?php
							}if ($reponse['cleared'] == '0') {
							?>
							<option>TRANSIT</option>
							<option value="1">CLEARED</option>
							<option value="2">CANCELED</option>
							<?php
							}
							?>
						</select>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherDossierClientModeTransportModeLicence2($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$premiere_entree, $nombre_dossier_par_page){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.num_lic AS num_lic,
													l.fournisseur AS fournisseur,
													l.fob AS fob,
													l.tonnage AS tonnage,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND ((d.date_quit IS NULL AND d.ref_quit IS NULL)
														OR (d.date_quit = '' OR d.ref_quit = ''))
													$sql1
												ORDER BY d.ref_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<?php
						if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicence2($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$premiere_entree, $nombre_dossier_par_page,
														$id_march=NULL, $statut=NULL, $num_lic=NULL,
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.id_cli AS id_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													IF(d.id_mod_lic = '2',
														IF(d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL AND d.id_cli <> 883 ,
															'AWAITING AD/AV/INSURANCE, ',
															IF(d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL,
																'AWAITING AD/AV, ',
																IF(d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli <> 883 ,
																	'AWAITING AD/INSURANCE, ',
																	IF(d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NOT NULL,
																		'AWAITING AD, ',
																		IF(d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL AND d.id_cli <> 883 ,
																			'AWAITING AV/INSURANCE, ',
																			IF(d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL,
																				'AWAITING AV, ',
																				IF(d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli <> 888 AND d.id_cli <> 883 ,
																					'AWAITING INSURANCE, ',
																						IF(d.ad_date IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli = 888 AND d.id_cli <> 883 , 'AWAITING INSURANCE, ', 
														IF(d.ad_date IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli = 888 AND d.id_cli <> 883 , 'AWAITING INSURANCE, ', 
															IF(d.id_cli = 888 AND d.date_assurance IS NOT NULL AND d.ad_date IS NULL, 'AWAITING AD, ',
																	IF(d.id_cli = 888 AND d.id_cli <> 883  AND d.date_assurance IS NULL AND d.ad_date IS NULL, 'AWAITING AD/INSURANCE, ', '')
																)
															)
														)
																					)
																				)
																			)
																		)
																	)
																)
															),
														'') AS statut_preal,
													IF(d.date_decl IS NULL OR d.ref_decl IS NULL,
														'NOT DECLARED',
														IF(d.date_liq IS NULL OR d.ref_liq,
															'AWAITING LIQUIDATION',
															IF(d.date_quit IS NULL OR d.ref_quit IS NULL,
																'AWAITING QUITTANCE',
																IF(d.bae_date IS NULL,
																	'AWAITING BAE',
																	IF(d.bs_date IS NULL,
																		'AWAITING BS','CLEARING COMPLETED')
																	)
																)
														)
														) AS statut_sydonia,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location,
													DATE(d.date_creat_dos) AS date_creat_dos,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												ORDER BY d.id_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				//include('modalTrackingFacture.php');
				$bg = "";
				$color='';
				$class = "";
				$index++;

				if ($reponse['cleared'] == '1') {
					$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					$color = " background-color: rgb(140, 109, 245);";
					//$class = "bg-primary";
					//$class = "bg-light";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					$color = " background-color: rgb(252, 128, 83);";
					//$class = "bg-danger";
					//$class = "bg-light";
				}else{
					$style = "";
					// $color = "color: black;";
					// $class = "bg-light";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = null;//$this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDocumentsDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					 
					</td>
					<td class="" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>">
					<?php 
					echo $this-> getEtatDossierEnAttenteTransmisFacture($reponse['id_dos'], $page);
					  if(!isset($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'])){
					  ?>
						<?php
						if ($reponse['cleared'] != '2') {
							// if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_delete'] == '1' && ($index == '1' && $premiere_entree == '0')) {
							if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_delete'] == '1') {
							?>
							<span title="Delete File" onclick="window.location.replace('deleteFile.php?id_cli=<?php echo $_GET['id_cli']; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>&id_mod_trac=<?php echo $_GET['id_mod_trac']; ?>&commodity=<?php echo $_GET['commodity']; ?>&statut=<?php echo $_GET['statut'];?>&id_march=<?php echo $_GET['id_march'];?>&id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=80,height=80');">
			                    <i class="fa fa-times bg bg-danger" style="padding: 3px; border-radius: 5px;"></i>
			                </span>
			                <?php
							}
						}

						if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_log'] == '1') {
						?>
						<span title="Edit File" onclick="window.location.replace('editFile.php?id_cli=<?php echo $_GET['id_cli']; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>&id_mod_trac=<?php echo $_GET['id_mod_trac']; ?>&commodity=<?php echo $_GET['commodity']; ?>&statut=<?php echo $_GET['statut'];?>&id_march=<?php echo $_GET['id_march'];?>&id_dos=<?php echo $reponse['id_dos'];?>&page=<?php echo $page;?>','pop1','width=80,height=80');"><i class="fa fa-edit bg bg-warning" style="padding: 3px; border-radius: 5px;"></i></span>

					  	<span title="Historique du dossier" onclick="window.open('popUpLogFile.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=900,height=950');">
					  		<i class="fa fa-history bg bg-dark"  style="padding: 3px; border-radius: 5px;" aria-hidden="true"></i>
	                	</span>
		                <?php
						}
					
					  }
					  ?>
						<span  onclick="window.open('generateurPageDeGarde.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1500,height=950');" class="btn-xs bg-olive" title="Page de garde"><i class=" fas fa-file" style="color: white;"></i></span>
						<!-- <span class="btn-xs bg-dark" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');" title="Documents Joints"><i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup></span> -->
						<span class="btn-xs bg-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
	                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
	                        <span class="sr-only">Toggle Dropdown</span>
	                        <div class="dropdown-menu" role="menu">
	                        	<a class="dropdown-item sm" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');">
									<i class="fa fa-plus"></i> Ajouter
								</a>
								<hr>
	                          <?php
	                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
	                          ?>
	                        </div>
	                      </span>
						
					<?php
					if ($reponse['etat_feuil_calc'] == '1') {
					?>
						<span class="btn-xs bg-primary"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');" title="Feuille de Calcul">
							<i class="fas fa-calculator"></i>
						</span>
					<?php
					}

					?>
					</td>

					<?php
					$this-> afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $reponse['statut_preal'].$reponse['statut_sydonia'];
						?>
					</td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $reponse['location'];
						?>
					</td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $this-> getEtatDocumentDossier($reponse['id_dos']);
						?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1" colspan="3">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRowLicenceModeLicence($id_mod_lic, $id_cli, $id_march,$id_mod_trans,
														$premiere_entree=NULL, $nombre_dossier_par_page=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			// if (isset($_GET['page'])&&($_GET['page'] > 0)) {
			// 	$page = $_GET['page'];
			// }else{
			// 	$page = '';
			// }

			// if (isset($commodity) && ($commodity != '')) {
			// 	$sql1 = ' AND d.commodity = "'.$commodity.'"';
			// }
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			// if (isset($id_march) && ($id_march != '')) {
			// 	$sqlIdMarch = ' AND d.id_march = '.$id_march;
			// }

			// if (isset($statut) && ($statut != '')) {
			// 	$sqlStatus = ' AND d.statut = "'.$statut.'"';
			// }

			// if (isset($num_lic) && ($num_lic != '')) {
			// 	$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			// }

			// if (isset($cleared) && ($cleared != '')) {
			// 	$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			// }

			if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT *
													FROM licence
													WHERE id_cli = ?
														AND id_mod_trans = ?
														AND id_march = ?
														AND id_mod_lic = ?");
				$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_march'], $entree['id_mod_lic']));

				while ($reponse = $requete-> fetch()) {
					$compteur++;
					$bg = "";
					$clignote = '';

					$index++;

					if ($this-> getDifferenceDate($this-> getDateExpirationLicence2($reponse['num_lic']), date('Y-m-d'))<0 && ( ($this-> getLicence($reponse['num_lic'])['poids']-$this-> getSommePoidsLicenceExport($reponse['num_lic']))>0) ) {
						$bg = 'text-danger';
					}else if ($this-> getDifferenceDate($this-> getDateExpirationLicence2($reponse['num_lic']), date('Y-m-d'))<40 && ( ($this-> getLicence($reponse['num_lic'])['poids']-$this-> getSommePoidsLicenceExport($reponse['num_lic']))>0) ) {
						$bg = 'text-orange';
					}else if (($this-> getLicence($reponse['num_lic'])['poids']-$this-> getSommePoidsLicenceExport($reponse['num_lic']))==0) {
						$bg = 'text-success';
					}else if (($this-> getLicence($reponse['num_lic'])['poids']-$this-> getSommePoidsLicenceExport($reponse['num_lic']))<0) {
						$bg = 'text-danger';
						$clignote = 'clignoteb';
					}

					// if ($reponse['cleared'] == '1') {
					// 	$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					// 	$color = " background-color: rgb(140, 109, 245);";
					// 	//$class = "bg-primary";
					// 	//$class = "bg-light";
					// }else if ($reponse['cleared'] == '2') {
					// 	$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					// 	$color = " background-color: rgb(252, 128, 83);";
					// 	//$class = "bg-danger";
					// 	//$class = "bg-light";
					// }else{
					// 	$style = "";
					// 	// $color = "color: black;";
					// 	// $class = "bg-light";
					// }

					$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);

					include('modalEditLicence2.php');


				?>
					<!-- <input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>"> -->
					<tr class="<?php echo $bg.' '.$clignote;?>" <?php echo $style;?>>
						<td class="<?php echo $bg;?>"><?php echo $compteur;?></td>
						<td class="<?php echo $bg;?>">
							<?php echo $reponse['num_lic'];?>
						</td>
						<?php
						$this-> afficherRowLicence($id_mod_lic, $reponse['num_lic'], $compteur);
							/*if ($id_mod_trans == '1') {
								include('importRouteRow.php');
							}else if ($id_mod_trans == '3') {
								include('importAirRow.php');
							}*/
						?>
						<td class=" <?php echo $bg;?>">
							<button class="btn btn-xs bg-purple" title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
								<i class="fa fa-eye"></i>
							</button>
							<button class="btn btn-xs bg-primary" title="Dossiers affectés" href="#" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=primary','pop1','width=1000,height=900');">
								<i class="fa fa-folder-open"></i>
							</button>

							<span class="btn btn-warning btn-sm square-btn-adjust" data-toggle="modal" data-target=".editLicence_<?php echo str_replace(' ', '_', $reponse['num_lic']);?>">
			                    <i class="fa fa-edit"></i>
			                </span>

							<button class="btn btn-xs btn-success square-btn-adjust btn-xs" onclick="window.location.replace('exportExcelLicence.php?num_lic=<?php echo $reponse['num_lic']; ?>','pop1','width=80,height=80');">
		                      <i class="fas fa-file-excel"></i> Exporter en Excel
		                    </button>
						</td>
					</tr>
				<?php
				}$requete-> closeCursor();
			}else{
				$requete = $connexion-> prepare("SELECT *
													FROM licence
													WHERE id_cli = ?
														AND id_mod_trans = ?
														AND id_mod_lic = ?");
				$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));

				while ($reponse = $requete-> fetch()) {
					$compteur++;
					$bg = "";
					$clignote = '';

					$index++;

					if ($this-> getDifferenceDate($this-> getDateExpirationLicence2($reponse['num_lic']), date('Y-m-d'))<0 && ( ($this-> getLicence($reponse['num_lic'])['fob']-$this-> getSommeFobLicenceExport($reponse['num_lic']))>0) ) {
						$bg = 'text-danger';
					}else if ($this-> getDifferenceDate($this-> getDateExpirationLicence2($reponse['num_lic']), date('Y-m-d'))<40 && ( ($this-> getLicence($reponse['num_lic'])['fob']-$this-> getSommeFobLicenceExport($reponse['num_lic']))>0) ) {
						$bg = 'text-orange';
					}else if (($this-> getLicence($reponse['num_lic'])['fob']-$this-> getSommeFobLicenceExport($reponse['num_lic']))==0) {
						$bg = 'text-success';
					}else if (($this-> getLicence($reponse['num_lic'])['fob']-$this-> getSommeFobLicenceExport($reponse['num_lic']))<0) {
						$bg = 'text-danger';
						$clignote = 'clignoteb';
					}

					// if ($reponse['cleared'] == '1') {
					// 	$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					// 	$color = " background-color: rgb(140, 109, 245);";
					// 	//$class = "bg-primary";
					// 	//$class = "bg-light";
					// }else if ($reponse['cleared'] == '2') {
					// 	$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					// 	$color = " background-color: rgb(252, 128, 83);";
					// 	//$class = "bg-danger";
					// 	//$class = "bg-light";
					// }else{
					// 	$style = "";
					// 	// $color = "color: black;";
					// 	// $class = "bg-light";
					// }

					$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);

					include('modalEditLicence2.php');


				?>
					<!-- <input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>"> -->
					<tr class="<?php echo $bg.' '.$clignote;?>" <?php echo $style;?>>
						<td class="<?php echo $bg;?>"><?php echo $compteur;?></td>
						<td class="<?php echo $bg;?>">
							<?php echo $reponse['num_lic'];?>
						</td>
						<?php
						$this-> afficherRowLicence($id_mod_lic, $reponse['num_lic'], $compteur);
							/*if ($id_mod_trans == '1') {
								include('importRouteRow.php');
							}else if ($id_mod_trans == '3') {
								include('importAirRow.php');
							}*/
						?>
						<td class=" <?php echo $bg;?>">
							<button class="btn btn-xs bg-purple" title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
								<i class="fa fa-eye"></i>
							</button>
							<button class="btn btn-xs bg-primary" title="Dossiers affectés" href="#" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=primary','pop1','width=1000,height=900');">
								<i class="fa fa-folder-open"></i>
							</button>

							<span class="btn btn-warning btn-sm square-btn-adjust" data-toggle="modal" data-target=".editLicence_<?php echo str_replace(' ', '_', $reponse['num_lic']);?>">
			                    <i class="fa fa-edit"></i>
			                </span>

							<button class="btn btn-xs btn-success square-btn-adjust btn-xs" onclick="window.location.replace('exportExcelLicence.php?num_lic=<?php echo $reponse['num_lic']; ?>','pop1','width=80,height=80');">
		                      <i class="fas fa-file-excel"></i> Exporter en Excel
		                    </button>
						</td>
					</tr>
				<?php
				}$requete-> closeCursor();
			}

		}

		public function afficherLogDossier($id_dos){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$compteur = 0;
			$requete = $connexion-> prepare("SELECT DATE_FORMAT(ld.date_log, '%d/%m/%Y %h:%i:%s') AS date_log,
													ld.colonne AS colonne,
													ld.valeur AS valeur,
													UPPER(u.nom_util) AS nom_util  
												FROM log_dossier ld, utilisateur u
												WHERE ld.id_dos = ?
													AND ld.id_util =  u.id_util
												ORDER BY id_log DESC");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

			?>
				<tr>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['date_log'];?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['colonne'];?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['valeur'];?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['nom_util'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherRowDossierClientModeTransportModeLicence2FinOPS($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$premiere_entree, $nombre_dossier_par_page,
														$id_march=NULL, $statut=NULL, $num_lic=NULL,
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			$requete = $connexion-> prepare("SELECT d.*
												FROM dossier d, client cl, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.id_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";
				$index++;

				if ($reponse['cleared'] == '1') {
					$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					$color = " background-color: rgb(140, 109, 245);";
					//$class = "bg-primary";
					//$class = "bg-light";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					$color = " background-color: rgb(252, 128, 83);";
					//$class = "bg-danger";
					//$class = "bg-light";
				}else{
					$style = "";
					$color = "color: black;";
					$class = "";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				//$rentabilite_pourc = ($this-> getSommeDepenseDossier($reponse['id_dos'])*100)/$this-> getSommeDepenseClient($id_cli, $id_mod_lic, $id_mod_trans);
				$rentabilite_montant = $this-> getSommeDepenseDossier($reponse['id_dos'])-$this-> getSommeDepenseClient($id_cli, $id_mod_lic, $id_mod_trans);

				if ( ($this-> getSommeDepenseDossier($reponse['id_dos'])) < ($this-> getSommeDepenseClient($id_cli, $id_mod_lic, $id_mod_trans)) ) {
					$badge = 'success';
					$icon = '<i class="fa fa-arrow-up text-success"></i>';
				}else if ( ($this-> getSommeDepenseDossier($reponse['id_dos'])) == ($this-> getSommeDepenseClient($id_cli, $id_mod_lic, $id_mod_trans)) ) {
					$badge = 'info';
					$icon = '<i class="fa fa-minus text-info"></i>';
				}else{
					$badge = 'danger';
					$icon = '<i class="fa fa-arrow-down text-danger"></i>';
				}

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
						<span class="btn-xs btn-dark" onclick="window.open('generateurFicheRentabilite.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');">
							<i class="fa fa-file"></i>
						</span>
					 
					</td>
					<td class="" style="text-align: center; border-right: 1px solid black; vertical-align: middle; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?> font-weight: bold;">
						<span class="badge badge-<?php echo $badge;?>">
						<?php
							echo number_format($this-> getSommeDepenseDossier($reponse['id_dos']), 2, ',', ' ').'/'.number_format($this-> getSommeDepenseClient($id_cli, $id_mod_lic, $id_mod_trans), 2, ',', ' ');
						?>
						</span>
					</td>
					<td class="" style="text-align: center; border-right: 1px solid black; vertical-align: middle; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?> font-weight: bold;">
						<div class="text text-<?php echo $badge;?>">
						<?php
							echo $icon.' '.number_format(($this-> getSommeDepenseClient($id_cli, $id_mod_lic, $id_mod_trans))-($this-> getSommeDepenseDossier($reponse['id_dos'])), 2, ',', ' ');
						?>
						</div>
					</td>

					<?php
					$this-> afficherRowTableauFinOPS($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
					<td class="" style="text-align: center; border-right: 1px solid black; vertical-align: middle; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?> font-weight: bold;">
						<span class="badge badge-<?php echo $badge;?>">
						<?php
							echo number_format($this-> getSommeDepenseDossier($reponse['id_dos']), 2, ',', ' ').'/'.number_format($this-> getSommeDepenseClient($id_cli, $id_mod_lic, $id_mod_trans), 2, ',', ' ');
						?>
						</span>
					</td>
					<td class="" style="text-align: center; border-right: 1px solid black; vertical-align: middle; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?> font-weight: bold;">
						<div class="text text-<?php echo $badge;?>">
						<?php
							echo $icon.' '.number_format(($this-> getSommeDepenseClient($id_cli, $id_mod_lic, $id_mod_trans))-($this-> getSommeDepenseDossier($reponse['id_dos'])), 2, ',', ' ');
						?>
						</div>
					</td>

				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="" colspan="4">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceEncodeur($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$premiere_entree, $nombre_dossier_par_page,
														$id_march=NULL, $statut=NULL, $num_lic=NULL,
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.id_cli AS id_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													IF(d.id_mod_lic = '2',
														IF(d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL AND d.id_cli <> 883,
															'AWAITING AD/AV/INSURANCE, ',
															IF(d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL,
																'AWAITING AD/AV, ',
																IF(d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli <> 883,
																	'AWAITING AD/INSURANCE, ',
																	IF(d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NOT NULL,
																		'AWAITING AD, ',
																		IF(d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL AND d.id_cli <> 883 ,
																			'AWAITING AV/INSURANCE, ',
																			IF(d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL,
																				'AWAITING AV, ',
																				IF(d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli <> 888 AND d.id_cli <> 883 ,
																					'AWAITING INSURANCE, ',
																						IF(d.ad_date IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli = 888 AND d.id_cli <> 883 , 'AWAITING INSURANCE, ', 
														IF(d.ad_date IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli = 888 AND d.id_cli <> 883 , 'AWAITING INSURANCE, ', 
															IF(d.id_cli = 888 AND d.date_assurance IS NOT NULL AND d.ad_date IS NULL, 'AWAITING AD, ',
																	IF(d.id_cli = 888 AND d.date_assurance IS NULL AND d.ad_date IS NULL AND d.id_cli <> 883 , 'AWAITING AD/INSURANCE, ', '')
																)
															)
														)
																					)
																				)
																			)
																		)
																	)
																)
															),
														'') AS statut_preal,
													IF(d.date_decl IS NULL OR d.ref_decl IS NULL,
														'NOT DECLARED',
														IF(d.date_liq IS NULL OR d.ref_liq,
															'AWAITING LIQUIDATION',
															IF(d.date_quit IS NULL OR d.ref_quit IS NULL,
																'AWAITING QUITTANCE',
																IF(d.bae_date IS NULL,
																	'AWAITING BAE',
																	IF(d.bs_date IS NULL,
																		'AWAITING BS','CLEARING COMPLETED')
																	)
																)
														)
														) AS statut_sydonia,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												ORDER BY d.id_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";
				$index++;

				if ($reponse['cleared'] == '1') {
					$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					$color = " background-color: rgb(140, 109, 245);";
					//$class = "bg-primary";
					//$class = "bg-light";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					$color = " background-color: rgb(252, 128, 83);";
					//$class = "bg-danger";
					//$class = "bg-light";
				}else{
					$style = "";
					// $color = "color: black;";
					// $class = "bg-light";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDocumentsDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					 
					</td>
					<td class="" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>">

						<span  onclick="window.open('generateurPageDeGarde.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1500,height=950');" class="btn-xs bg-olive" title="Page de garde"><i class=" fas fa-file" style="color: white;"></i></span>
						<!-- <span class="btn-xs bg-dark" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');" title="Documents Joints"><i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup></span> -->
						<span class="btn-xs bg-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
	                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
	                        <span class="sr-only">Toggle Dropdown</span>
	                        <div class="dropdown-menu" role="menu">
	                        	<a class="dropdown-item sm" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');">
									<i class="fa fa-plus"></i> Ajouter
								</a>
								<hr>
	                          <?php
	                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
	                          ?>
	                        </div>
	                      </span>
						
					<?php
					if ($reponse['etat_feuil_calc'] == '1') {
					?>
						<span class="btn-xs bg-primary"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');" title="Feuille de Calcul">
							<i class="fas fa-calculator"></i>
						</span>
					<?php
					}

					?>
					</td>

					<?php
					$this-> afficherRowTableauEncodeur($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $_SESSION['id_util']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $reponse['statut_preal'].$reponse['statut_sydonia'];
						?>
					</td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $reponse['location'];
						?>
					</td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $this-> getEtatDocumentDossier($reponse['id_dos']);
						?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1" colspan="4">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceEncodeurSite($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $date_dos, $mot_cle){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;
			$compteur = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($mot_cle) && ($mot_cle!='')) {
				$sqlMotCle = " AND (REPLACE(d.ref_dos, ' ', '') = '$mot_cle' OR REPLACE(d.horse, ' ', '') = '$mot_cle' OR REPLACE(d.trailer_1, ' ', '') = '$mot_cle' OR REPLACE(d.trailer_2, ' ', '') = '$mot_cle' )";
				$sqlDate = '';
				//echo $sqlMotCle;
			}else{
				$sqlMotCle = '';
				if ($id_mod_lic == '1') {
					$sqlDate = " AND d.site_dep = '$date_dos' ";
				}else if ($id_mod_lic == '2') {
					$sqlDate = " AND d.site_arriv = '$date_dos' ";
				}

			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.id_cli AS id_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlDate
													$sqlMotCle
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";
				$index++;

				if ($reponse['cleared'] == '1') {
					$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					$color = " background-color: rgb(140, 109, 245);";
					//$class = "bg-primary";
					//$class = "bg-light";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					$color = " background-color: rgb(252, 128, 83);";
					//$class = "bg-danger";
					//$class = "bg-light";
				}else{
					$style = "";
					// $color = "color: black;";
					// $class = "bg-light";
				}

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDocumentsDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					 
					</td>
					<td class="" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>">

						<span  onclick="window.open('generateurPageDeGarde.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1500,height=950');" class="btn-xs bg-olive" title="Page de garde"><i class=" fas fa-file" style="color: white;"></i></span>
						<!-- <span class="btn-xs bg-dark" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');" title="Documents Joints"><i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup></span> -->
						<span class="btn-xs bg-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
	                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
	                        <span class="sr-only">Toggle Dropdown</span>
	                        <div class="dropdown-menu" role="menu">
	                          <?php
	                            $this-> getListeDocumentForDossier2($reponse['id_dos'], $reponse['id_mod_lic']);
	                          ?>
	                        </div>
	                      </span>
						
					<?php
					if ($reponse['etat_feuil_calc'] == '1') {
					?>
						<span class="btn-xs bg-primary"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');" title="Feuille de Calcul">
							<i class="fas fa-calculator"></i>
						</span>
					<?php
					}

					?>
					</td>

					<?php
					$this-> afficherRowTableauEncodeur($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $_SESSION['id_util']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1" colspan="4">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceEncodeur2($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$premiere_entree, $nombre_dossier_par_page,
														$id_march=NULL, $statut=NULL, $num_lic=NULL,
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.id_cli AS id_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												ORDER BY d.id_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";
				$index++;

				if ($reponse['cleared'] == '1') {
					$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					$color = " background-color: rgb(140, 109, 245);";
					//$class = "bg-primary";
					//$class = "bg-light";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					$color = " background-color: rgb(252, 128, 83);";
					//$class = "bg-danger";
					//$class = "bg-light";
				}else{
					$style = "";
					$color = "color: black;";
					$class = "";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDocumentsDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					 
					</td>
					<td class="" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>">

						<span  onclick="window.open('generateurPageDeGarde.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1500,height=950');" class="btn-xs bg-olive" title="Page de garde"><i class=" fas fa-file" style="color: white;"></i></span>
						<!-- <span class="btn-xs bg-dark" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');" title="Documents Joints"><i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup></span> -->
						<span class="btn-xs bg-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
	                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
	                        <span class="sr-only">Toggle Dropdown</span>
	                        <div class="dropdown-menu" role="menu">
	                          <?php
	                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
	                          ?>
	                        </div>
	                      </span>
						
					<?php
					if ($reponse['etat_feuil_calc'] == '1') {
					?>
						<span class="btn-xs bg-primary"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');" title="Feuille de Calcul">
							<i class="fas fa-calculator"></i>
						</span>
					<?php
					}

					?>
					</td>

					<?php
					$this-> afficherRowTableauEncodeur2($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $_SESSION['id_util']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<!-- <td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td> -->
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceEncodeur2Recherche($horse, $id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$premiere_entree, $nombre_dossier_par_page,
														$id_march=NULL, $statut=NULL, $num_lic=NULL,
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['horse'] = '%'.$horse.'%';
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlClient = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND d.id_cli = '.$id_cli;
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.id_cli AS id_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													-- AND cl.id_cli = ?
													$sqlClient
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND (d.horse LIKE (?) OR d.trailer_1 LIKE (?) OR d.trailer_2 LIKE (?) OR d.contenair LIKE (?))
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												ORDER BY d.id_dos ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic'], $entree['horse'], $entree['horse'], $entree['horse'], $entree['horse']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";
				$index++;

				if ($reponse['cleared'] == '1') {
					$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					$color = " background-color: rgb(140, 109, 245);";
					//$class = "bg-primary";
					//$class = "bg-light";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					$color = " background-color: rgb(252, 128, 83);";
					//$class = "bg-danger";
					//$class = "bg-light";
				}else{
					$style = "";
					$color = "color: black;";
					$class = "";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDocumentsDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					 
					</td>
					<td class="" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>">

						<span  onclick="window.open('generateurPageDeGarde.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1500,height=950');" class="btn-xs bg-olive" title="Page de garde"><i class=" fas fa-file" style="color: white;"></i></span>
						<!-- <span class="btn-xs bg-dark" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');" title="Documents Joints"><i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup></span> -->
						<span class="btn-xs bg-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
	                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
	                        <span class="sr-only">Toggle Dropdown</span>
	                        <div class="dropdown-menu" role="menu">
	                          <?php
	                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
	                          ?>
	                        </div>
	                      </span>
						
					<?php
					if ($reponse['etat_feuil_calc'] == '1') {
					?>
						<span class="btn-xs bg-primary"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');" title="Feuille de Calcul">
							<i class="fas fa-calculator"></i>
						</span>
					<?php
					}

					?>
					</td>

					<?php
					$this-> afficherRowTableauEncodeur2($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $_SESSION['id_util']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<!-- <td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td> -->
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceEncodeurPopUp($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$id_march=NULL, $statut=NULL, $num_lic=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			if ($_SESSION['id_util'] == '41' || $_SESSION['id_util'] == '43' || $_SESSION['id_util'] == '44' || $_SESSION['id_util'] == '45' || $_SESSION['id_util'] == '46') {
				
				$sqlColonne = ' AND (d.site_arriv IS NULL OR d.site_arriv = "") ';

			}else if ($_SESSION['id_util'] == '37' || $_SESSION['id_util'] == '47' || $_SESSION['id_util'] == '48' || $_SESSION['id_util'] == '49') {
				
				$sqlColonne = ' AND (d.arrival_date IS NULL OR  d.kbp_arrival_date IS NULL OR  d.kbp_dep_date IS NULL OR  d.wiski_arriv IS NULL OR  d.wiski_dep IS NULL) ';

			}else{
				$sqlColonne = '';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.id_cli AS id_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlColonne
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";
				$index++;

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDocumentsDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					 
					</td>

					<?php
					$this-> afficherRowTableauEncodeurPopUp($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $_SESSION['id_util']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceEncodeurPopUpArrivesSite($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$id_march=NULL, $statut=NULL, $num_lic=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			// if ($_GET['etat'] == 'all') {
				
			// 	$sqlColonne = ' ';

			// }else if ($_GET['etat'] == 'missing') {
				
			// 	if ($_SESSION['id_util'] == '37' || $_SESSION['id_util'] == '47' || $_SESSION['id_util'] == '48' || $_SESSION['id_util'] == '49') {
				
			// 		$sqlColonne = ' AND (d.arrival_date IS NULL OR  d.kbp_arrival_date IS NULL OR  d.kbp_dep_date IS NULL OR  d.wiski_arriv IS NULL OR  d.wiski_dep IS NULL) ';

			// 	}

			// }else if ($_GET['etat'] == 'with') {
				
			// 	if ($_SESSION['id_util'] == '37' || $_SESSION['id_util'] == '47' || $_SESSION['id_util'] == '48' || $_SESSION['id_util'] == '49') {
				
			// 		$sqlColonne = ' AND (d.arrival_date IS NOT NULL OR  d.kbp_arrival_date IS NOT NULL OR  d.kbp_dep_date IS NOT NULL OR  d.wiski_arriv IS NOT NULL OR  d.wiski_dep IS NOT NULL) ';

			// 	}

			// }else{
			// 	$sqlColonne = '';
			// }

			if ($_GET['etat'] == 'all') {
				
				$sqlColonne = ' ';

			}else if ($_GET['etat'] == 'missing') {
				
				$sqlColonne = ' AND (d.arrival_date IS NULL OR  d.kbp_arrival_date IS NULL OR  d.kbp_dep_date IS NULL OR  d.wiski_arriv IS NULL OR  d.wiski_dep IS NULL) ';


			}else if ($_GET['etat'] == 'with') {
				
				$sqlColonne = ' AND (d.arrival_date IS NOT NULL AND  d.kbp_arrival_date IS NOT NULL AND  d.kbp_dep_date IS NOT NULL AND  d.wiski_arriv IS NOT NULL AND  d.wiski_dep IS NOT NULL) ';

			}else{
				$sqlColonne = '';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.id_cli AS id_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATE_FORMAT(d.site_arriv, '%d/%m/%Y') AS site_arriv 
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.site_arriv IS NOT NULL
													$sqlColonne
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";
				$index++;

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDocumentsDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					 
					</td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; color:orange; <?php echo $color;?>"><?php echo $reponse['site_arriv'];?>
					 
					</td>
					
					<?php
					$this-> afficherRowTableauEncodeurPopUp($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $_SESSION['id_util']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			</tr>
			<?php
		}

		public function getNombreDossierClientModeTransportModeLicenceEncodeurPopUpArrivesSite($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $etat,
														$id_march=NULL, $statut=NULL, $num_lic=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			if ($etat == 'all') {
				
				$sqlColonne = ' ';

			}else if ($etat == 'missing') {
				
				$sqlColonne = ' AND (d.arrival_date IS NULL OR  d.kbp_arrival_date IS NULL OR  d.kbp_dep_date IS NULL OR  d.wiski_arriv IS NULL OR  d.wiski_dep IS NULL) ';


			}else if ($etat == 'with') {
				
				$sqlColonne = ' AND (d.arrival_date IS NOT NULL AND  d.kbp_arrival_date IS NOT NULL AND  d.kbp_dep_date IS NOT NULL AND  d.wiski_arriv IS NOT NULL AND  d.wiski_dep IS NOT NULL) ';

			}else{
				$sqlColonne = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.site_arriv IS NOT NULL
													$sqlColonne
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreDossierClientModeTransportModeLicenceEncodeurPopUp($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$id_march=NULL, $statut=NULL, $num_lic=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			if ($_SESSION['id_util'] == '41' || $_SESSION['id_util'] == '43' || $_SESSION['id_util'] == '44' || $_SESSION['id_util'] == '45' || $_SESSION['id_util'] == '46') {
				
				$sqlColonne = ' AND (d.site_arriv IS NULL OR d.site_arriv = "") ';

			}else if ($_SESSION['id_util'] == '37' || $_SESSION['id_util'] == '47' || $_SESSION['id_util'] == '48' || $_SESSION['id_util'] == '49') {
				
				$sqlColonne = ' AND (d.arrival_date IS NULL OR  d.kbp_arrival_date IS NULL OR  d.kbp_dep_date IS NULL OR  d.wiski_arriv IS NULL OR  d.wiski_dep IS NULL) ';

			}else{
				$sqlColonne = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlColonne
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function afficherRowDossierClientModeTransportModeLicence2Recherche($ref_dos, $id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$id_march=NULL, $statut=NULL, $num_lic=NULL,
														$cleared=NULL){
			include('connexion.php');

			$entree['ref_dos'] = $ref_dos;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			// if ($premiere_entree > 0) {
			// 	$page = $premiere_entree;
			// }else{
			// 	$page = '';
			// }

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.id_cli AS id_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													IF(d.id_mod_lic = '2',
														IF(d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL,
															'AWAITING AD/AV/INSURANCE, ',
															IF(d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL,
																'AWAITING AD/AV, ',
																IF(d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL,
																	'AWAITING AD/INSURANCE, ',
																	IF(d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NOT NULL,
																		'AWAITING AD, ',
																		IF(d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL,
																			'AWAITING AV/INSURANCE, ',
																			IF(d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL,
																				'AWAITING AV, ',
																				IF(d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli <> 888,
																					'AWAITING INSURANCE, ',
																						IF(d.ad_date IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli = 888, 'AWAITING INSURANCE, ', 
														IF(d.ad_date IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli = 888, 'AWAITING INSURANCE, ', 
															IF(d.id_cli = 888 AND d.date_assurance IS NOT NULL AND d.ad_date IS NULL, 'AWAITING AD, ',
																	IF(d.id_cli = 888 AND d.date_assurance IS NULL AND d.ad_date IS NULL, 'AWAITING AD/INSURANCE, ', '')
																)
															)
														)
																					)
																				)
																			)
																		)
																	)
																)
															),
														'') AS statut_preal,
													IF(d.date_decl IS NULL OR d.ref_decl IS NULL,
														'NOT DECLARED',
														IF(d.date_liq IS NULL OR d.ref_liq,
															'AWAITING LIQUIDATION',
															IF(d.date_quit IS NULL OR d.ref_quit IS NULL,
																'AWAITING QUITTANCE',
																IF(d.bae_date IS NULL,
																	'AWAITING BAE',
																	IF(d.bs_date IS NULL,
																		'AWAITING BS','CLEARING COMPLETED')
																	)
																)
														)
														) AS statut_sydonia,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE (d.ref_dos = ? OR d.num_lot = ? OR REPLACE(d.horse, ' ', '') = ? OR REPLACE(d.road_manif, ' ', '') = ? OR REPLACE(d.ref_fact, ' ', '') = ?)
													AND d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['ref_dos'], $entree['ref_dos'], str_replace(' ', '',$entree['ref_dos']), str_replace(' ', '',$entree['ref_dos']), str_replace(' ', '',$entree['ref_dos']), $entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";
				$index++;

				if ($reponse['cleared'] == '1') {
					$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					$color = " background-color: rgb(140, 109, 245);";
					//$class = "bg-primary";
					//$class = "bg-light";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					$color = " background-color: rgb(252, 128, 83);";
					//$class = "bg-danger";
					//$class = "bg-light";
				}else{
					$style = "";
					// $color = "color: black;";
					// $class = "bg-light";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDocumentsDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					 
					</td>
					<td class="" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>">
					<?php
					echo $this-> getEtatDossierEnAttenteTransmisFacture($reponse['id_dos'], $page); 
					  if(!isset($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'])){
					  ?>
						
						<?php
					
					  }
					  if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_log'] == '1') {
						?>
					  	<span title="Historique du dossier" onclick="window.open('popUpLogFile.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=900,height=950');">
					  		<i class="fa fa-history bg bg-dark"  style="padding: 3px; border-radius: 5px;" aria-hidden="true"></i>
	                	</span>
	                	<span title="Edit File" onclick="window.location.replace('editFile.php?id_cli=<?php echo $_GET['id_cli']; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>&id_mod_trac=<?php echo $_GET['id_mod_trac']; ?>&commodity=<?php echo $_GET['commodity']; ?>&statut=<?php echo $_GET['statut'];?>&id_march=<?php echo $_GET['id_march'];?>&id_dos=<?php echo $reponse['id_dos'];?>&page=<?php echo $page;?>','pop1','width=80,height=80');"><i class="fa fa-edit bg bg-warning" style="padding: 3px; border-radius: 5px;"></i></span>
		                <?php
						}
					  ?>

						<span  onclick="window.open('generateurPageDeGarde.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1500,height=950');" class="btn-xs bg-olive" title="Page de garde"><i class=" fas fa-file" style="color: white;"></i></span>

						<span class="btn-xs bg-dark" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');" title="Documents Joints"><i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup></span>
						
					<?php
					if ($reponse['etat_feuil_calc'] == '1') {
					?>
						<span class="btn-xs bg-primary"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');" title="Feuille de Calcul">
							<i class="fas fa-calculator"></i>
						</span>
					<?php
					}

					?>
					</td>

					<?php
					$this-> afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $reponse['statut_preal'].$reponse['statut_sydonia'];
						?>
					</td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $reponse['location'];
						?>
					</td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $this-> getEtatDocumentDossier($reponse['id_dos']);
						?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherRowDossierClientModeTransportModeLicenceEncodeurRecherche($ref_dos, $id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$id_march=NULL, $statut=NULL, $num_lic=NULL,
														$cleared=NULL){
			include('connexion.php');

			$entree['ref_dos'] = $ref_dos;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			// if ($premiere_entree > 0) {
			// 	$page = $premiere_entree;
			// }else{
			// 	$page = '';
			// }

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			// if ($id_mod_lic == '1') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2' && $id_cli == '857') {
			// 	$sqlOrder = ' ORDER BY d.id_dos DESC';
			// }else if ($id_mod_lic == '2') {
			// 	$sqlOrder = ' ORDER BY d.ref_dos DESC';
			// }

			if (isset($_GET['page'])&&($_GET['page'] > 0)) {
				$page = $_GET['page'];
			}else{
				$page = '';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.id_cli AS id_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													IF(d.id_mod_lic = '2',
														IF(d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL,
															'AWAITING AD/AV/INSURANCE, ',
															IF(d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL,
																'AWAITING AD/AV, ',
																IF(d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL,
																	'AWAITING AD/INSURANCE, ',
																	IF(d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NOT NULL,
																		'AWAITING AD, ',
																		IF(d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL,
																			'AWAITING AV/INSURANCE, ',
																			IF(d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL,
																				'AWAITING AV, ',
																				IF(d.ad_date IS NOT NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli <> 888,
																					'AWAITING INSURANCE, ',
																						IF(d.ad_date IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli = 888, 'AWAITING INSURANCE, ', 
														IF(d.ad_date IS NOT NULL AND d.date_assurance IS NULL AND d.id_cli = 888, 'AWAITING INSURANCE, ', 
															IF(d.id_cli = 888 AND d.date_assurance IS NOT NULL AND d.ad_date IS NULL, 'AWAITING AD, ',
																	IF(d.id_cli = 888 AND d.date_assurance IS NULL AND d.ad_date IS NULL, 'AWAITING AD/INSURANCE, ', '')
																)
															)
														)
																					)
																				)
																			)
																		)
																	)
																)
															),
														'') AS statut_preal,
													IF(d.date_decl IS NULL OR d.ref_decl IS NULL,
														'NOT DECLARED',
														IF(d.date_liq IS NULL OR d.ref_liq,
															'AWAITING LIQUIDATION',
															IF(d.date_quit IS NULL OR d.ref_quit IS NULL,
																'AWAITING QUITTANCE',
																IF(d.bae_date IS NULL,
																	'AWAITING BAE',
																	IF(d.bs_date IS NULL,
																		'AWAITING BS','CLEARING COMPLETED')
																	)
																)
														)
														) AS statut_sydonia,
													IF(d.id_mod_lic='2',
														IF(d.site_arriv IS NOT NULL,
															'AT SITE',
															IF(d.wiski_dep IS NOT NULL,
																'ON THE WAY TO SITE',
																IF((d.dispatch_klsa IS NOT NULL OR d.arrival_date IS NOT NULL OR d.kbp_arrival_date IS NOT NULL) AND d.id_mod_trans='1',
																	'AT KLSA',
																	IF(d.arrival_date IS NOT NULL,
																		'ARRIVED AT DRC','OUT OF DRC')
																	)
																)
															)
														,
														IF(d.klsa_dep IS NOT NULL OR d.exit_drc IS NOT NULL,
															'OUT OF DRC',
															IF(d.site_dep IS NOT NULL,
																'ON THE WAY TO THE BORDER',
																'AT SITE'
																)
															)
														) AS location,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE (d.ref_dos = ? OR d.num_lot = ? OR REPLACE(d.horse, ' ', '') = ? OR REPLACE(d.road_manif, ' ', '') = ? OR REPLACE(d.ref_fact, ' ', '') = ? OR REPLACE(d.ref_decl, ' ', '') = ?)
													AND d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['ref_dos'], $entree['ref_dos'], str_replace(' ', '',$entree['ref_dos']), str_replace(' ', '',$entree['ref_dos']), str_replace(' ', '',$entree['ref_dos']), str_replace(' ', '',$entree['ref_dos']), $entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";
				$index++;

				if ($reponse['cleared'] == '1') {
					$style = "style='color: white; background-color: rgb(140, 109, 245);'";
					$color = " background-color: rgb(140, 109, 245);";
					//$class = "bg-primary";
					//$class = "bg-light";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: white; background-color: rgb(252, 128, 83);'";
					$color = " background-color: rgb(252, 128, 83);";
					//$class = "bg-danger";
					//$class = "bg-light";
				}else{
					$style = "";
					// $color = "color: black;";
					// $class = "bg-light";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDocumentsDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $compteur;?></td>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					 
					</td>
					<td class="" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>">
						<span  onclick="window.open('generateurPageDeGarde.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1500,height=950');" class="btn-xs bg-olive" title="Page de garde"><i class=" fas fa-file" style="color: white;"></i></span>
						
						<span class="btn-xs bg-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
	                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
	                        <span class="sr-only">Toggle Dropdown</span>
	                        <div class="dropdown-menu" role="menu">
	                        	<a class="dropdown-item sm" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');">
									<i class="fa fa-plus"></i> Ajouter
								</a>
								<hr>
	                          <?php
	                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
	                          ?>
	                        </div>
	                      </span>
						
					<?php
					if ($reponse['etat_feuil_calc'] == '1') {
					?>
						<span class="btn-xs bg-primary"  onclick="window.open('generateurFeuilleCalcul.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=1000,height=800');" title="Feuille de Calcul">
							<i class="fas fa-calculator"></i>
						</span>
					<?php
					}

					?>
					</td>

					<?php
					$this-> afficherRowTableauEncodeur($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $_SESSION['id_util']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $reponse['statut_preal'].$reponse['statut_sydonia'];
						?>
					</td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $reponse['location'];
						?>
					</td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
						<?php
							echo $this-> getEtatDocumentDossier($reponse['id_dos']);
						?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherRowDossierClientModeTransportModeLicence3($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$id_march=NULL, $statut=NULL, $num_lic=NULL,
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			if ($id_mod_lic == '1') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '857') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2') {
				$sqlOrder = ' ORDER BY d.ref_dos DESC';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND REPLACE(d.statut,"\'","") = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

            if ($_GET['id_mod_lic'] == '1') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = '';
				}

            }else if ($_GET['id_mod_lic'] == '2') {

				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = '';
				}

            }

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													$sqlClient
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												$sqlOrder");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "color: black;";
					$class = "bg-dark";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDeleteDossier.php');


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					</td>
					<?php
					$this-> afficherRowTableau2($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherRowDossierClientModeTransportModeLicenceDashboard($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity,
														$premiere_entree, $nombre_dossier_par_page, $type){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			$sql1 = "";
			$sqlClient = "";
			$sqlType = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			if (isset($id_cli) && ($id_cli != '')) {
				$sql1 = ' AND d.id_cli = "'.$id_cli.'"';
			}

			if (isset($type) && ($type == 'TOTAL FILES')) {
				$sqlType = '';
			}

			if (isset($type) && ($type == 'CLEARING COMPLETED')) {
				$sqlType = " AND d.cleared = '1'";
			}

			if (isset($type) && ($type == 'FILES IN PROCESS')) {
				$sqlType = " AND d.cleared = '0'";
			}

			if (isset($type) && ($type == 'CANCELLED')) {
				$sqlType = " AND d.cleared = '2'";
			}

			if (isset($type) && ($type == 'KASUMBALESA')) {
				$sqlType = " AND DATE(d.arrival_date) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'WISKI ARRIVAL')) {
				$sqlType = " AND DATE(d.wiski_arriv) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT WISKI')) {
				$sqlType = " AND (d.wiski_arriv IS NOT NULL AND d.wiski_arriv <> '')
												AND (d.wiski_dep IS NULL OR d.wiski_dep = '')";
			}

			if (isset($type) && ($type == 'WISKI DEPARTURE')) {
				$sqlType = " AND DATE(d.wiski_dep) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'AWAIT CRF')) {
				$sqlType = " AND (d.wiski_dep IS NOT NULL AND d.wiski_dep <> '')
												AND ( (d.date_crf IS NULL OR d.date_crf = '') AND (d.ref_crf IS NULL OR d.ref_crf = '' ))";
			}

			if (isset($type) && ($type == 'DGDA IN')) {
				$sqlType = " AND DATE(d.dgda_in) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT DGDA')) {
				$sqlType = " AND (d.dgda_in IS NOT NULL AND d.dgda_in <> '')
												AND (d.dgda_out IS NULL OR d.dgda_out = '')";
			}

			if (isset($type) && ($type == 'LIQUIDATED / AWAIT QUITTANCE')) {
				$sqlType = " AND ( (d.date_liq IS NOT NULL OR d.date_liq <> '')
													OR (d.ref_liq IS NOT NULL AND d.ref_liq <> '') )
												AND ( (d.date_quit IS NULL OR d.date_quit = '')
													OR (d.ref_quit IS NULL OR d.ref_quit = '') )";
			}

			if (isset($type) && ($type == 'QUITTANCE')) {
				$sqlType = " AND DATE(d.date_quit) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'DGDA OUT')) {
				$sqlType = " AND DATE(d.dgda_out) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'FILES CLEARED WAITING INVOICE')) {
				$sqlType = " AND d.cleared = '1'
												AND d.facture = '0'";
			}

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sql1
													$sqlClient
													$sqlType
												ORDER BY d.ref_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<?php
					$this-> afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceExcel($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $id_march=NULL, $statut=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql1 = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlOrder = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			if ($id_mod_lic == '1') {
				$sqlOrder = ' ORDER BY d.id_dos ASC';
			}else if ($id_mod_lic == '2') {
				$sqlOrder = ' ORDER BY d.ref_dos ASC';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			/*echo '<br> sql1 = '.$sql1;
			echo '<br> sqlIdMarch = '.$sqlIdMarch;
			echo '<br> sqlStatus = '.$sqlStatus;
			echo '<br> sqlOrder = '.$sqlOrder;*/

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													d.cleared AS cleared,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sql1
												$sqlOrder");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
				}else{
					$style = "";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<tr <?php echo $style;?>>
					<td  style="border: 0.5px solid black; text-align: right;"><?php echo $compteur;?></td>
					<td style="border: 0.5px solid black; text-align: center;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<?php
					$this-> afficherRowTableauExcel($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierClientModeTransportModeLicenceExcel($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.num_lic AS num_lic,
													l.fournisseur AS fournisseur,
													l.fob AS fob,
													l.tonnage AS tonnage,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<tr>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 0.5px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 0.5px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 0.5px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 0.5px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<td class=" <?php echo $bg;?>" style="border: 0.5px solid black;"><?php echo $reponse['mca_num'];?></td>
					<?php
						if ($id_mod_trans == '1') {
							include('importRouteRowExcel.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRowExcel.php');
						}
					?>
				</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDossierLicence($num_lic){
			include('connexion.php');

			// $entree['num_lic'] = $num_lic;
			$entree['num_lic'] = '%'.substr($num_lic, 0, 10).'%';
			$compteur = 0;
			$bg = '';
			$style = '';


			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$sommePoids = 0;
			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, md.nom_march AS nom_march,
													md.ref_fact AS ref_fact, md.num_av AS num_av, 
													SUM(md.fob) AS fob,
													md.poids AS poids,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_quit AS ref_quit,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier d, marchandise_dossier md
												WHERE md.num_lic LIKE ?
													AND d.id_dos = md.id_dos
												GROUP BY d.id_dos");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];
				$sommePoids += $reponse['poids'];

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['nom_march'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['ref_fact'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['num_av'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['date_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['date_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['date_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<td class="<?php echo $bg;?>" colspan='11' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommePoids, 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommeFob, 2, ',', ' ');?>
					</td>
				</tr>
			<?php
		}

		public function afficherDossierLicenceExport($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['num_lic'] = '%'.substr($num_lic, 0, 10).'%';
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$sommePoids = 0;
			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.commodity AS commodity,
													d.ref_fact AS ref_fact, d.ref_cvee AS ref_cvee, 
													d.montant_decl AS fob, d.poids AS poids,
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													d.ref_quit AS ref_quit,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier d, client cl
												WHERE d.num_lic LIKE ?
													AND d.id_cli =  cl.id_cli
													AND d.id_dos = d.id_dos");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];
				$sommePoids += $reponse['poids'];

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['commodity'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_fact'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_cvee'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['date_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['date_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['date_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<td class="<?php echo $bg;?>" colspan='11' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommePoids, 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommeFob, 2, ',', ' ');?>
					</td>
				</tr>
			<?php
		}

		public function afficherDossierPopUp($id_cli, $id_mod_trans,
											$id_mod_lic, $commodity, $statut){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['statut'] = $statut;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			$sqlClient = "";
			$sqlType = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			if (isset($id_cli) && ($id_cli != '')) {
				$sql1 = ' AND d.id_cli = "'.$id_cli.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													d.num_lot AS num_lot,
													d.ref_fact AS ref_fact,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													d.ref_quit AS ref_quit,
													DATE_FORMAT(d.date_liq,'%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit,'%d/%m/%Y') AS date_quit,
													DATE_FORMAT(d.date_decl,'%d/%m/%Y') AS date_decl
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.statut = ?
													$sql1
													$sqlClient
												ORDER BY d.ref_dos DESC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic'], $entree['statut']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class=" <?php echo $bg;?>" style="" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['ref_dos'];?></td>
					<?php
					if ($_GET['id_mod_lic'] == '1') {
                     	?><td><?php echo $reponse['num_lot'];?></td><?php
                     }else if ($_GET['id_mod_lic'] == '2') {
                     	?><td><?php echo $reponse['ref_fact'];?></td><?php
                     }
					?>
					</td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['ref_decl'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['date_decl'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['ref_liq'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['date_liq'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['ref_quit'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['date_quit'];?></td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierPopUpBackUp($id_cli, $id_mod_trans,
											$id_mod_lic, $commodity, $type,
											$premiere_entree, $nombre_dossier_par_page){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			$sqlClient = "";
			$sqlType = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			if (isset($id_cli) && ($id_cli != '')) {
				$sql1 = ' AND d.id_cli = "'.$id_cli.'"';
			}

			if (isset($type) && ($type == 'TOTAL FILES')) {
				$sqlType = '';
			}

			if (isset($type) && ($type == 'CLEARING COMPLETED')) {
				$sqlType = " AND d.cleared = '1'";
			}

			if (isset($type) && ($type == 'FILES IN PROCESS')) {
				$sqlType = " AND d.cleared = '0'";
			}

			if (isset($type) && ($type == 'CANCELLED')) {
				$sqlType = " AND d.cleared = '2'";
			}

			if (isset($type) && ($type == 'KASUMBALESA')) {
				$sqlType = " AND DATE(d.arrival_date) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'WISKI ARRIVAL')) {
				$sqlType = " AND DATE(d.wiski_arriv) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT WISKI')) {
				$sqlType = " AND (d.wiski_arriv IS NOT NULL AND d.wiski_arriv <> '')
												AND (d.wiski_dep IS NULL OR d.wiski_dep = '')";
			}

			if (isset($type) && ($type == 'WISKI DEPARTURE')) {
				$sqlType = " AND DATE(d.wiski_dep) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'AWAIT CRF')) {
				$sqlType = " AND (d.wiski_dep IS NOT NULL AND d.wiski_dep <> '')
												AND ( (d.date_crf IS NULL OR d.date_crf = '') AND (d.ref_crf IS NULL OR d.ref_crf = '' ))";
			}

			if (isset($type) && ($type == 'DGDA IN')) {
				$sqlType = " AND DATE(d.dgda_in) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT DGDA')) {
				$sqlType = " AND (d.dgda_in IS NOT NULL AND d.dgda_in <> '')
												AND (d.dgda_out IS NULL OR d.dgda_out = '')";
			}

			if (isset($type) && ($type == 'LIQUIDATED / AWAIT QUITTANCE')) {
				$sqlType = " AND ( (d.date_liq IS NOT NULL OR d.date_liq <> '')
													OR (d.ref_liq IS NOT NULL AND d.ref_liq <> '') )
												AND ( (d.date_quit IS NULL OR d.date_quit = '')
													OR (d.ref_quit IS NULL OR d.ref_quit = '') )";
			}

			if (isset($type) && ($type == 'QUITTANCE')) {
				$sqlType = " AND DATE(d.date_quit) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'DGDA OUT')) {
				$sqlType = " AND DATE(d.dgda_out) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'FILES CLEARED WAITING INVOICE')) {
				$sqlType = " AND d.cleared = '1'
												AND d.facture = '0'";
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.num_lic AS num_lic,
													l.fournisseur AS fournisseur,
													l.fob AS fob,
													l.tonnage AS tonnage,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sql1
													$sqlClient
													$sqlType
												ORDER BY d.ref_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<?php
						if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre à jour
					</button>
				</td>
			</tr>
			<?php
		}


		public function afficherDossierPopUpExcel($id_mod_lic, $type, $id_cli, $id_type_lic){
			include('connexion.php');
/*
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			if ($type == 'EN ATTENTE FACTURATION') {

				$requete = $connexion-> prepare("SELECT d.*,
													UPPER(m.nom_march) AS nom_march,
													UPPER(cl.nom_cli) AS nom_cli
												FROM dossier d, client cl, marchandise m
												WHERE d.id_mod_lic = ?
													AND d.id_march =  m.id_march
													AND d.id_cli =  cl.id_cli
													AND d.cleared = '1'
													AND d.facture = '0'");

			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $bg;?>" style="border: 0.5px solid black; " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; border: 0.5px solid black;">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['mca_b_ref'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['nom_cli'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['nom_march'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; border: 0.5px solid black;">
						<?php echo $reponse['fob'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();

			*/
		}

		public function afficherLicencePopUp($id_mod_lic, $type, $id_cli, $id_type_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sql3 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND l.id_cli = '.$id_cli;
			}

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND l.id_cli = '.$id_cli;
			}

			if($type == 'EXPIRES'){
				$sql3 = ' AND l.date_val IS NOT NULL ';
			}

			$sommeFob = 0;

			if ($id_mod_lic == '1') {

				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
														DATE(CURRENT_DATE()) AS aujourdhui,
														l.poids AS fob,
														(l.poids) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														l.unit_mes AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3");
			}else{

				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
														DATE(CURRENT_DATE()) AS aujourdhui,
														l.fob AS fob,
														(l.fob+l.fret+l.assurance+l.autre_frais) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														mo.sig_mon AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				$date_exp2 = $this-> getLastEpirationLicence($reponse['num_lic']);
				$bg = "";
				$sommeFob += $reponse['fob'];

				if ($type == 'EN COURS') {

					if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<?php
							if ($id_mod_lic == '2') {
							?>
							<td style="text-align: right;">
								<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
							</td>
							<?php
							}
							?>

	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<?php
							if ($id_mod_lic == '2') {
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							<?php
							}
							?>

						</tr>
						<?php
					}

				}else if ($type == 'EXTREME VALIDATION -40 JOURS') {

					if(($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) <= 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<?php
							if ($id_mod_lic == '2') {
							?>
							<td style="text-align: right;">
								<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
							</td>
							<?php
							}
							?>

	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<?php
							if ($id_mod_lic == '2') {
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							<?php
							}
							?>

						</tr>
						<?php
					}

				}else if ($type == 'EXPIRES') {

					if(($date_exp < $reponse['aujourdhui']) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic'])) && ( $reponse['num_lic'] != $this-> getLicenceApuree($reponse['num_lic'])) ){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<?php
							if ($id_mod_lic == '2') {
							?>
							<td style="text-align: right;">
								<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
							</td>
							<?php
							}
							?>

	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<?php
							if ($id_mod_lic == '2') {
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							<?php
							}
							?>

						</tr>
						<?php
					}

				}else if ($type == 'APPUREES TRACKING ATTENTE BANQUE') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) &&  ( $reponse['num_lic'] != $this-> getLicenceApuree($reponse['num_lic'])) && ($this-> verifierApurementDossierLicence($reponse['num_lic']) == false)){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<?php
							if ($id_mod_lic == '2') {
							?>
							<td style="text-align: right;">
								<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
							</td>
							<?php
							}
							?>

	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<?php
							if ($id_mod_lic == '2') {
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							<?php
							}
							?>

						</tr>
						<?php
					}

				}else if ($type == 'APPUREES PAR BANQUE') {

					if( ($this-> verifierApurementDossierLicence($reponse['num_lic']) != false) && ($reponse['num_lic'] != 'UNDER VALUE') ){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<td style="text-align: right;"><?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'CIF LICENCE DIFFERENT CIF DOSSIER(S)') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['cif'] != $this-> getSommeCIFLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<td style="text-align: right; background-color: rgb(152,251,152);"><?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right; background-color: rgb(152,251,152);">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
						</tr>
						<?php
					}

				}

			?>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherLicencePopUpExcel($id_mod_lic, $type, $id_cli, $id_type_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sql3 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND l.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			if($type == 'EXPIRES'){
				$sql3 = ' AND l.date_val IS NOT NULL ';
			}

			$sommeFob = 0;


			if ($id_mod_lic == '1') {

				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
														DATE(CURRENT_DATE()) AS aujourdhui,
														l.poids AS fob,
														(l.poids) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														l.unit_mes AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3");
			}else{

				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
														DATE(CURRENT_DATE()) AS aujourdhui,
														l.fob AS fob,
														(l.fob+l.fret+l.assurance+l.autre_frais) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														mo.sig_mon AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				$date_exp2 = $this-> getLastEpirationLicence($reponse['num_lic']);
				$bg = "";
				$sommeFob += $reponse['fob'];

				if ($type == 'EN COURS') {

					if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'EXTREME VALIDATION -40 JOURS') {

					if(($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) <= 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'EXPIRES') {

					if(($date_exp < $reponse['aujourdhui']) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'APPUREES TRACKING ATTENTE BANQUE') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'APPUREES PAR BANQUE') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] == $this-> getSommeFobAppureLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'CIF LICENCE DIFFERENT CIF DOSSIER(S)') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['cif'] != $this-> getSommeCIFLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}

			?>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierLicencePretAppurement($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$requete = $connexion-> prepare("SELECT d.*
												FROM dossier d, client cl
												WHERE d.num_lic = ?
													AND d.id_cli =  cl.id_cli
													AND (d.ref_decl IS NOT NULL
														AND d.ref_decl <> ''
														AND d.ref_liq IS NOT NULL
														AND d.ref_quit IS NOT NULL
														AND d.ref_quit <> '')
													AND d.id_dos NOT IN(
															SELECT id_dos FROM appurement_licence
														)");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['cod'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['montant_av'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<input type="checkbox" name="check_<?php echo $compteur;?>">
						<?php //echo $reponse['ref_quit'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
					<td class="<?php echo $bg;?>" colspan='7' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommeFob, 2, ',', ' ');?>
					</td>
				</tr>
			<?php
		}

		public function afficherDossierLicencePretAppurementExcel($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$requete = $connexion-> prepare("SELECT d.*
												FROM dossier d, client cl
												WHERE d.num_lic = ?
													AND d.id_cli =  cl.id_cli
													AND (d.ref_decl IS NOT NULL
														AND d.ref_liq IS NOT NULL
														AND d.ref_quit IS NOT NULL)
													AND d.id_dos NOT IN(
															SELECT id_dos FROM appurement_licence
														)");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['cod'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['montant_av'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['fob'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<input type="checkbox" name="check_<?php echo $compteur;?>">
						<?php //echo $reponse['ref_quit'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
					<td class="<?php echo $bg;?>" colspan='7' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $sommeFob;?>
					</td>
				</tr>
			<?php
		}

		public function afficherDossierLicenceAppuresBanque($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$requete = $connexion-> prepare("SELECT d.*
												FROM dossier d, client cl
												WHERE d.num_lic = ?
													AND d.id_cli =  cl.id_cli
													AND d.id_dos IN(
															SELECT id_dos FROM appurement_licence
														)");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['cod'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['montant_av'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
					</td>
					<!--<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<input type="checkbox" name="check_<?php echo $compteur;?>">
						<?php //echo $reponse['ref_quit'];?>
					</td>-->
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
					<td class="<?php echo $bg;?>" colspan='7' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommeFob, 2, ',', ' ');?>
					</td>
				</tr>
			<?php
		}

		public function afficherDossierLicenceAppuresBanqueExcel($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$requete = $connexion-> prepare("SELECT d.*
												FROM dossier d, client cl
												WHERE d.num_lic = ?
													AND d.id_cli =  cl.id_cli
													AND (d.ref_decl IS NOT NULL
														AND d.ref_liq IS NOT NULL
														AND d.ref_quit IS NOT NULL)
													AND d.id_dos IN(
															SELECT id_dos FROM appurement_licence
														)");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];

				/*$ref_dos, $id_cli, $ref_fact, $fob,
				$fret, $assurance, $autre_frais, $num_lic,
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['cod'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['montant_av'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['fob'];?>
					</td>
					<!--<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<input type="checkbox" name="check_<?php echo $compteur;?>">
						<?php //echo $reponse['ref_quit'];?>
					</td>-->
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
					<td class="<?php echo $bg;?>" colspan='7' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $sommeFob;?>
					</td>
				</tr>
			<?php
		}

		//FIN Methodes permettant d'afficher

		//Methode permettant de verifier
		public function verifierUtilisateur($pseudo_util, $pass_util){
			include('connexion.php');
			$entree['pseudo_util'] = $pseudo_util;
			$entree['pass_util'] = $pass_util;

			$requete = $connexion-> prepare('SELECT id_util
												FROM utilisateur
												WHERE pseudo_util = ?
													AND pass_util = ?');
			$requete-> execute(array($entree['pseudo_util'], $entree['pass_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_util'];
			}else{
				return false;
			}
		}

		public function verifierUtilisateur2($pseudo_util, $pass_util, $id_util){
			include('connexion.php');
			$entree['pseudo_util'] = $pseudo_util;
			$entree['pass_util'] = $pass_util;
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare('SELECT id_util
												FROM utilisateur
												WHERE pseudo_util = ?
													AND pass_util = ?
													AND id_util <> ?');
			$requete-> execute(array($entree['pseudo_util'], $entree['pass_util'], $entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_util'];
			}else{
				return false;
			}
		}

		public function verifierDocumentApurement($num_lic, $ref_apure, $date_apure){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['ref_apure'] = $ref_apure;
			$entree['date_apure'] = $date_apure;

			$requete = $connexion-> prepare('SELECT id_doc
												FROM document_appurement
												WHERE num_lic = ?
													AND ref_apure = ?
													AND date_apure = ?');
			$requete-> execute(array($entree['num_lic'], $entree['ref_apure'], $entree['date_apure']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_doc'];
			}else{
				return false;
			}
		}

		public function verifierTransmissionApurement($ref_trans_ap, $date_trans_ap, $banque){
			include('connexion.php');
			$entree['ref_trans_ap'] = $ref_trans_ap;
			$entree['date_trans_ap'] = $date_trans_ap;
			$entree['banque'] = $banque;

			$requete = $connexion-> prepare("SELECT id_trans_ap
												FROM transmission_apurement
												WHERE ref_trans_ap = ?
													AND date_trans_ap = ?
													AND banque = ?");
			$requete-> execute(array($entree['ref_trans_ap'], $entree['date_trans_ap'], $entree['banque']));
			$reponse = $requete-> fetch();
			return $reponse['id_trans_ap'];
		}

		public function verifierTransmissionApurementRef($ref_trans_ap){
			include('connexion.php');
			$entree['ref_trans_ap'] = $ref_trans_ap;

			$requete = $connexion-> prepare("SELECT id_trans_ap
												FROM transmission_apurement
												WHERE ref_trans_ap = ?");
			$requete-> execute(array($entree['ref_trans_ap']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function verifierTransmisFactureDossier($ref_trans_fact, $date_trans_fact){
			include('connexion.php');
			$entree['ref_trans_fact'] = $ref_trans_fact;
			$entree['date_trans_fact'] = $date_trans_fact;

			$requete = $connexion-> prepare("SELECT id_trans_fact
												FROM transmis_facture_dossier
												WHERE ref_trans_fact = ?
													AND date_trans_fact = ?");
			$requete-> execute(array($entree['ref_trans_fact'], $entree['date_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse['id_trans_fact'];
		}

		public function getDataUtilisateur($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT *
												FROM utilisateur
												WHERE id_util = ?");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getEtatDocumentDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_mod_lic'] = $this-> getDossier($id_dos)['id_mod_lic'];

			$requete = $connexion-> prepare("SELECT id_doc
												FROM dossier_document
												WHERE id_doc = 48
													AND id_dos = ?
												");
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			if($reponse){
				return 'COMPLETED';
			}else{
				$requete = $connexion-> prepare("SELECT id_doc
													FROM affectation_document_modele_licence
													WHERE id_doc NOT IN (
															SELECT id_doc
																FROM dossier_document
																WHERE id_dos = ?
															)
														AND id_mod_lic = ?
														ANd id_doc <> 48
														AND active = '1'
													");
				$requete-> execute(array($entree['id_dos'], $entree['id_mod_lic']));
				$reponse = $requete-> fetch();
				if($reponse){
					return 'INCOMPLETE';
				}else{
					return 'COMPLETED';
				}
			}
		}

		public function getDataTypeTransit($id_t_trans){
			include('connexion.php');
			$entree['id_t_trans'] = $id_t_trans;

			$requete = $connexion-> prepare("SELECT *
												FROM type_transit
												WHERE id_t_trans = ?");
			$requete-> execute(array($entree['id_t_trans']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataDepenseDossier($ref_dep){
			include('connexion.php');
			$entree['ref_dep'] = $ref_dep;

			$requete = $connexion-> prepare("SELECT *
												FROM depense_dossier
												WHERE ref_dep = ?");
			$requete-> execute(array($entree['ref_dep']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getAllDataDepenseDossier($id_dep){
			include('connexion.php');
			$entree['id_dep'] = $id_dep;

			$requete = $connexion-> prepare("SELECT d.*, UPPER(cl.nom_cli) AS nom_cli, SUM(rd.montant) AS montant,
													DATE_FORMAT(d.date_dep, '%d/%m/%Y') AS date_dep
												FROM depense_dossier d, client cl, rubrique_dossier rd
												WHERE d.id_dep = ?
													AND d.id_cli = cl.id_cli
													AND d.id_dep = rd.id_dep");
			$requete-> execute(array($entree['id_dep']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getIdLastDepenseDossier($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT *
												FROM depense_dossier
												WHERE id_util = ?
												ORDER BY id_dep DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			
			return $reponse['id_dep'];
			
		}

		public function getAffectationRubriqueClient($id_cli, $id_rub){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_rub'] = $id_rub;

			$requete = $connexion-> prepare("SELECT *
												FROM affectation_client_rubrique_depense
												WHERE id_cli = ?
													AND id_rub = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_rub']));
			$reponse = $requete-> fetch();
			
			return $reponse;
			
		}

		public function getAffectationUtilisateurModule($id_util, $id_mod){
			include('connexion.php');
			$entree['id_util'] = $id_util;
			$entree['id_mod'] = $id_mod;

			$requete = $connexion-> prepare("SELECT *
												FROM affectation_utilisateur_module
												WHERE id_util = ?
													AND id_mod = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod']));
			$reponse = $requete-> fetch();
			
			return $reponse;
			
		}

		public function getDataRubrique($id_rub){
			include('connexion.php');
			$entree['id_rub'] = $id_rub;

			$requete = $connexion-> prepare("SELECT *
												FROM rubrique_depense
												WHERE id_rub = ?");
			$requete-> execute(array($entree['id_rub']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataDeboursClientModeleLicence($id_deb, $id_cli, $id_mod_lic, $id_mod_trans=null){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlModeTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlModeTrans = '';
			}

			$requete = $connexion-> prepare("SELECT *
												FROM affectation_debours_client_modele_licence
												WHERE id_deb = ?
													AND id_cli = ?
													AND id_mod_lic = ?
													$sqlModeTrans");
			$requete-> execute(array($entree['id_deb'], $entree['id_cli'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}else{
				$reponse['montant']=NULL;
				return $reponse;
			}
		}

		public function getDataFactureGlobale($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.code_cli AS code_cli,
													cl.id_cli AS id_cli,
													march.nom_march AS nom_march,
													march.nom_march_2 AS nom_march_2,
													cl.adr_cli AS adr_cli,
													fd.information AS information,
													fd.validation AS validation,
													fd.taux_commission AS taux_commission
												FROM client cl, facture_dossier fd, dossier dos, detail_facture_dossier det, marchandise march
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = det.ref_fact 
													AND det.id_dos = dos.id_dos 
													AND dos.id_march = march.id_march
													AND fd.id_cli = cl.id_cli");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataDossierFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT dos.*,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													(IF(dos.montant_decl IS NULL, 0, dos.montant_decl) +IF(dos.fret IS NULL, 0, dos.fret)+IF(dos.assurance IS NULL, 0, dos.assurance)+IF(dos.autre_frais IS NULL, 0, dos.autre_frais)) AS cif,
													IF(dos.id_mod_lic='1', cl.nom_cli, dos.supplier) AS supplier,
													IF(dos.id_mod_lic='2', dos.po_ref, dos.num_lot) AS po_ref
												FROM facture_dossier fd, detail_facture_dossier df, dossier dos, client cl
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos
													AND dos.id_cli = cl.id_cli");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataTransmisFacture($id_trans_fact){
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;

			$requete = $connexion-> prepare("SELECT *,
													DATE_FORMAT(date_trans_fact, '%d/%m/%Y') AS date_trans_fact
												FROM transmis_facture_dossier
												WHERE id_trans_fact = ?");
			$requete-> execute(array($entree['id_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getNbreDossierTransmisFacture($id_trans_fact){
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(dos.id_dos)) AS nbre
												FROM transmis_facture_dossier tr, detail_transmis_facture_dossier dtfd, facture_dossier fd, detail_facture_dossier det, dossier dos
												WHERE tr.id_trans_fact = ?
													AND tr.id_trans_fact = dtfd.id_trans_fact
													AND dtfd.ref_fact = fd.ref_fact
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos");
			$requete-> execute(array($entree['id_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreFactureransmisFacture($id_trans_fact){
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(fd.ref_fact)) AS nbre
												FROM transmis_facture_dossier tr, detail_transmis_facture_dossier dtfd, facture_dossier fd
												WHERE tr.id_trans_fact = ?
													AND tr.id_trans_fact = dtfd.id_trans_fact
													AND dtfd.ref_fact = fd.ref_fact");
			$requete-> execute(array($entree['id_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getBureauDouane($id_bur_douane){
			include('connexion.php');
			$entree['id_bur_douane'] = $id_bur_douane;

			$requete = $connexion-> prepare("SELECT *
												FROM bureau_douane
												WHERE id_bur_douane = ?");
			$requete-> execute(array($entree['id_bur_douane']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getSousDossierFeuilleCalculDossier($ref_dos, $id_dos){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$tbl = '';
			$sommeFob = 0;
			$sommePoids = 0;
			$sommePoidsBrut = 0;
			$sommeColis = 0;
			$requete = $connexion-> prepare("SELECT d.code_tarif_march AS code_tarif_march,
													d.commodity AS commodity,
													d.origine AS origine,
													d.ref_fact AS ref_fact,
													d.nbr_bags AS nbr_bags,
													emb.nom_emb AS nom_emb,
													d.poids AS poids,
													d.poids_brut AS poids_brut,
													d.fob AS fob,
													d.ref_av AS ref_av,
													d.num_lic AS num_lic,
													d.fxi AS fxi
												FROM dossier d, emballage emb
												WHERE d.ref_dos_2 = ?
													AND d.principal = '0'
													AND d.id_emb = emb.id_emb");
			$requete-> execute(array($entree['ref_dos']));
			while($reponse = $requete-> fetch()){
				$sommeFob += $reponse['fob'];
				$sommePoids += $reponse['poids'];
				$sommePoidsBrut += $reponse['poids_brut'];
				$sommeColis += $reponse['nbr_bags'];

				$tbl .= '
						<tr>
							<td style="font-size: 7px; " width="8%"> '.$reponse['code_tarif_march'].' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; " width="15%"> '.$reponse['commodity'].' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; " width="10%"> '.$reponse['origine'].' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; " width="7%"><b> '.$reponse['ref_fact'].' </b></td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; text-align: right; border-bottom: 0.5px dotted black;" width="3%"> '.number_format($reponse['nbr_bags'], 2, ',', ' ').' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; " width="6%"> '.$reponse['nom_emb'].' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; text-align: right; border-bottom: 0.5px dotted black;" width="5.5%"> '.number_format($reponse['poids'], 2, ',', ' ').' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; text-align: right; border-bottom: 0.5px dotted black;" width="5%"> '.number_format($reponse['poids_brut'], 2, ',', ' ').' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; text-align: right; border-bottom: 0.5px dotted black;" width="6%"> '.number_format($reponse['fob'], 2, ',', ' ').' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; " width="10%"> '.$reponse['ref_av'].' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; " width="10%"> '.$reponse['num_lic'].' </td>
							<td style="font-size: 7px; " width="0.5%"></td>
							<td style="font-size: 7px; " width="10%"> '.$reponse['fxi'].' </td>
						</tr>
				';
			}

			$tbl .= '
					<tr>
						<td style="font-size: 7px; " width="8%"></td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; " width="15%"></td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; " width="10%"> </td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px;" width="7%"><b> </b></td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; text-align: right; border-bottom: 0.5px solid black; border: 0.5px solid black;" width="3%"> '.number_format(($sommeColis+$this-> getDossier($id_dos)['nbr_bags']), 2, ',', ' ').' </td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; " width="6%"></td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; text-align: right; border-bottom: 0.5px solid black; border: 0.5px solid black;" width="5.5%"> '.number_format(($sommePoids+$this-> getDossier($id_dos)['poids']), 2, ',', ' ').' </td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; text-align: right; border-bottom: 0.5px solid black; border: 0.5px solid black;" width="5%"> '.number_format(($sommePoidsBrut+$this-> getDossier($id_dos)['poids_brut']), 2, ',', ' ').' </td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; text-align: right; border-bottom: 0.5px solid black; border: 0.5px solid black;" width="6%"> '.number_format(($sommeFob+$this-> getDossier($id_dos)['fob']), 2, ',', ' ').' </td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; " width="10%"> <b>'.$this-> getAllDataDossier($id_dos)['sig_mon'].'</b> </td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; " width="10%">  </td>
						<td style="font-size: 7px; " width="0.5%"></td>
						<td style="font-size: 7px; " width="10%"> </td>
					</tr>
			';

			return $tbl;
		}

		public function generateurBonDepense($id_dep){
			include('connexion.php');
			$entree['id_dep'] = $id_dep;
			$tbl = '';
			$sommeSousLettre = 0;
			$sommeSousChiffre = 0;
			$sommeTotal = 0;
			$compteur=0;
			$lettre = 'A';
			$requete = $connexion-> prepare("SELECT * 
												FROM categorie_rubrique 
												WHERE id_cat_rub IN (
														SELECT r.id_cat_rub
															FROM rubrique_dossier rd, rubrique_depense r
															WHERE r.id_rub = rd.id_rub
															AND rd.id_dep = ?
														)
														");
			$requete-> execute(array($entree['id_dep']));
			while($reponse = $requete-> fetch()){

				$tbl .= '
						<tr>
							<td style="font-size: 7px; border: 1px solid black; font-weight: bold;" width="100%"> '.$lettre.' '.$reponse['nom_cat_rub'].' </td>
						</tr>
				';
				$compteur1=0;
				$sommeSousLettre = 0;
				$requeteRubrique = $connexion-> prepare("SELECT DISTINCT(r.id_rub) AS id_rub, r.nom_rub AS nom_rub
															FROM rubrique_dossier rd, rubrique_depense r
															WHERE r.id_rub = rd.id_rub
															AND rd.id_dep = ?
															AND r.id_cat_rub = ?");
				$requeteRubrique-> execute(array($entree['id_dep'], $reponse['id_cat_rub']));
				while($reponseRubrique = $requeteRubrique-> fetch()){
					$compteur1++;
					$sommeSousChiffre = 0;
					$tbl .= '
							<tr>
								<td style="font-size: 7px; border: 1px solid black;" width="100%"> '.$lettre.'.'.$compteur1.' '.$reponseRubrique['nom_rub'].' </td>
							</tr>
					';
					$requeteDossier = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos, rd.montant AS montant
																FROM rubrique_dossier rd, rubrique_depense r, dossier dos
																WHERE r.id_rub = rd.id_rub
																AND rd.id_dep = ?
																ANd rd.id_rub = ?
																AND rd.id_dos = dos.id_dos");
					$requeteDossier-> execute(array($entree['id_dep'], $reponseRubrique['id_rub']));
					while($reponseDossier = $requeteDossier-> fetch()){
						$compteur++;
						$sommeSousLettre += $reponseDossier['montant'];
						$sommeSousChiffre += $reponseDossier['montant'];
						$sommeTotal += $reponseDossier['montant'];
						$tbl .= '
								<tr>
									<td style="font-size: 7px; border-bottom: 0.5px dotted black; border-right: 0.5px dotted black;" width="10%"> '.$compteur.' </td>
									<td style="font-size: 7px; border-bottom: 0.5px dotted black; border-right: 0.5px dotted black;" width="60%"> '.$reponseDossier['ref_dos'].' </td>
									<td style="font-size: 7px; border-bottom: 0.5px dotted black; border-right: 0.5px dotted black;" width="30%"> '.number_format($reponseDossier['montant'], 2, ',', ' ').' $ </td>
								</tr>
						';

					}$requeteDossier-> closeCursor();
					$tbl .= '
								<tr>
									<td style="text-align: right; font-size: 7px; border-bottom: 0.5px dotted black; border-right: 0.5px dotted black;" width="70%"> Sous Total '.$lettre.'.'.$compteur1.'&nbsp;&nbsp;</td>
									<td style="font-size: 7px; border-bottom: 0.5px dotted black; border-right: 0.5px dotted black;" width="30%"> '.number_format($sommeSousChiffre, 2, ',', ' ').' $ </td>
								</tr>
						';
				}$requeteRubrique-> closeCursor();
				$tbl .= '
							<tr>
								<td style="text-align: right; font-weight: bold; font-size: 7px; border-bottom: 0.5px dotted black; border-right: 0.5px dotted black;" width="70%"> Sous Total '.$lettre.'&nbsp;&nbsp;</td>
								<td style="font-size: 7px; font-weight: bold; border-bottom: 0.5px dotted black; border-right: 0.5px dotted black;" width="30%"> '.number_format($sommeSousLettre, 2, ',', ' ').' $ </td>
							</tr>
					';
				$lettre++;

			}$requete-> closeCursor();
			$tbl .= '
						<tr>
							<td style="text-align: right; font-weight: bold; font-size: 7px; border: 0.5px solid black;" width="70%"> Total Général &nbsp;&nbsp;</td>
							<td style="font-size: 7px; font-weight: bold; border: 0.5px solid black;" width="30%"> '.number_format($sommeTotal, 2, ',', ' ').' $ </td>
						</tr>
				';

			
			return $tbl;
		}

		public function getMarchandiseDossierFeuilleCalculDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$tbl = '';
			$sommeFob = 0;
			$sommePoids = 0;
			$sommePoidsBrut = 0;
			$sommeColis = 0;
			$compteur = 0;
			$requete = $connexion-> prepare("SELECT dm.code_tarif_march AS code_tarif_march,
													dm.nom_march AS nom_march,
													dm.origine AS origine,
													dm.ref_fact AS ref_fact,
													dm.nbr_bags AS nbr_bags,
													emb.nom_emb AS nom_emb,
													dm.poids AS poids,
													dm.poids_brut AS poids_brut,
													dm.fob AS fob,
													dm.num_av AS num_av,
													dm.num_lic AS num_lic,
													dm.fxi AS fxi,
													dm.num_exo AS num_exo
												FROM marchandise_dossier dm, emballage emb
												WHERE dm.id_dos = ?
													AND dm.id_emb = emb.id_emb");
			$requete-> execute(array($entree['id_dos']));
			while($reponse = $requete-> fetch()){
				$sommeFob += round($reponse['fob'], 2);
				$sommePoids += $reponse['poids'];
				$sommePoidsBrut += $reponse['poids_brut'];
				$sommeColis += $reponse['nbr_bags'];
				$compteur++;

				$tbl .= '
						<tr>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="1.5%"> '.$compteur.' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="5%"> '.$reponse['code_tarif_march'].' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="15%"> '.$reponse['nom_march'].' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="10%"> '.$reponse['origine'].' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="10%"><b> '.$reponse['ref_fact'].' </b></td>
							<td style="font-size: 7.5px; font-weight: bold;" width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; text-align: right; border-bottom: 0.5px dotted black;" width="3%"> '.number_format($reponse['nbr_bags'], 0, '', '').'&nbsp;</td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="6%"> '.$reponse['nom_emb'].' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; text-align: right; border-bottom: 0.5px dotted black;" width="5%"> '.number_format($reponse['poids_brut'], 2, ',', ' ').' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; text-align: right; border-bottom: 0.5px dotted black;" width="5%"> '.number_format($reponse['poids'], 2, ',', ' ').' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; text-align: right; border-bottom: 0.5px dotted black;" width="6%"> '.number_format($reponse['fob'], 2, ',', ' ').' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="7.5%"> '.$reponse['num_av'].' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="10%"> '.$reponse['num_lic'].' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="5%"> '.$reponse['fxi'].' </td>
							<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
							<td style="font-size: 7.5px; font-weight: bold; border-bottom: 0.5px dotted black;" width="6.5%"> '.$reponse['num_exo'].' </td>
						</tr>
				';
			}

			$tbl .= '
					<tr>
						<td style="font-size: 7.5px; font-weight: bold; " width="1.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="15%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="10%"> </td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold;" width="10%"><b> </b></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; text-align: right; border-bottom: 0.5px solid black; border: 0.5px solid black;" width="3%"> '.number_format(($sommeColis), 0, '', '').' &nbsp;</td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="6%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; text-align: right; border-bottom: 0.5px solid black; border: 0.5px solid black;" width="5%"> '.number_format(($sommePoidsBrut), 2, ',', ' ').' </td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; text-align: right; border-bottom: 0.5px solid black; border: 0.5px solid black;" width="5.5%"> '.number_format(($sommePoids), 2, ',', ' ').' </td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; text-align: right; border-bottom: 0.5px solid black; border: 0.5px solid black;" width="6%"> '.number_format(($sommeFob), 2, ',', ' ').' </td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="7.5%"> <b>'.$this-> getAllDataDossier($id_dos)['sig_mon'].'</b> </td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="10%">  </td>
						<td style="font-size: 7.5px; font-weight: bold; " width="0.5%"></td>
						<td style="font-size: 7.5px; font-weight: bold; " width="6.5%"> </td>
					</tr>
			';

			return $tbl;
		}

		public function getDeboursFactureGlobale($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';
			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													IF(det.usd="1", SUM(det.montant), SUM(det.montant/dos.roe_decl)) AS ht
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.montant > 0
												GROUP BY d.id_deb
												ORDER BY d.rang ASC');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht'];
				}else{
					if ($ref_fact == 'DECKCC2200221' && $id_t_deb == '3') {
						$tva = 40;
						$ttc = $reponse['ht'] + 40;
					}else{
						$tva = round(($reponse['ht'] * 0.16), 2);
						$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
					}
				}

				$tbl .= '
					<tr>
						<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;">&nbsp;&nbsp;'
							.$reponse['nom_deb'].
						'</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">'
							.number_format($reponse['ht'], 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">'
							.number_format($tva, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">'
							.number_format($ttc, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
					</tr>
				';
			}
			$tbl .='
					<tr>
						<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="16%"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="16%"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="16%"></td>
					</tr>
					';

			return $tbl;
		}

		public function testFactureDossierAir($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$requete = $connexion-> prepare('SELECT dos.id_dos
												FROM detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND dos.id_mod_trans = 3');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return true;
			}else{
				return false;
			}
		}

		public function getDeboursFactureGlobale2($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';
			$total['ht'] = 0;
			$total['tva'] = 0;
			$total['ttc'] = 0;
			$requete = $connexion-> prepare('SELECT d.id_deb AS id_deb, d.nom_deb AS nom_deb,
													det.tva AS tva,
													COUNT(dos.id_dos) AS nbre_dos,
													IF(dos.date_decl<"2025-02-01",
														300,
														600
													) AS ceec_moins_30,
													IF(dos.date_decl<"2025-02-01",
														450,
														800
													) AS ceec_plus_30,
													SUM(dos.poids_brut/1000) AS poids_brut,
													IF(det.id_deb=27, 
														IF(det.usd="1", SUM(det.montant), SUM(det.montant/dos.roe_decl)),
														IF(det.usd="1", SUM(det.montant)/COUNT(dos.id_dos), SUM(det.montant/dos.roe_decl)/COUNT(dos.id_dos))
													) AS ht,
													IF(det.tva="1",
														SUM(det.montant*0.16),
														0
													) AS tva,
													IF(det.tva="1",
														IF(det.usd="1", SUM(det.montant)*1.16, SUM(det.montant/dos.roe_decl)*1.16),
														IF(det.usd="1", SUM(det.montant), SUM(det.montant/dos.roe_decl))
													) AS ttc,
													SUM(dos.poids/1000) AS poids,
													get_nbre_remorque_facture(det.ref_fact) AS nbre_remorque
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.montant > 0
												GROUP BY d.id_deb
												ORDER BY d.nom_deb ASC');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){
				$total['ht'] += $reponse['ht']; 
				$total['tva'] += $reponse['tva']; 
				$total['ttc'] += $reponse['ttc']; 

				if ($reponse['id_deb']=='37') { // CEEC
					$tbl .= '
						<tr>
							<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							' 300</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($this-> getCEECFacture($ref_fact, 37, $reponse['ceec_moins_30'])['nbre_dos'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($this-> getCEECFacture($ref_fact, 37, $reponse['ceec_moins_30'])['ht'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($this-> getCEECFacture($ref_fact, 37, $reponse['ceec_moins_30'])['tva'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($this-> getCEECFacture($ref_fact, 37, $reponse['ceec_moins_30'])['ttc'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';
					$tbl .= '
						<tr>
							<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							' 450</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($this-> getCEECFacture($ref_fact, 37, $reponse['ceec_plus_30'])['nbre_dos'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($this-> getCEECFacture($ref_fact, 37, $reponse['ceec_plus_30'])['ht'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($this-> getCEECFacture($ref_fact, 37, $reponse['ceec_plus_30'])['tva'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($this-> getCEECFacture($ref_fact, 37, $reponse['ceec_plus_30'])['ttc'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}else if ($reponse['id_deb']=='136') { // KICO
					$tbl .= '
						<tr>
							<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['nbre_remorque'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format(20, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['tva'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['ttc'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}else if ($reponse['id_deb']=='43') { // FERE
					$tbl .= '
						<tr>
							<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['poids_brut'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format(3, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['tva'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['ttc'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}else if ($reponse['id_deb']=='27'){ // Droits
					$tbl .= '
						<tr>
							<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							' de douane à l’export</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['nbre_dos'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['ht'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['tva'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['ttc'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}else {
					$tbl .= '
						<tr>
							<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['nbre_dos'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['ht'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['tva'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
								.number_format($reponse['ttc'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}

			}
			$tbl .='
					<tr>
						<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="12%"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="12%"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="12%"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="12%"></td>
					</tr>
					';

			$tbl .= '
					<tr>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%">SOUS-TOTAL ('.$id_t_deb.')&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
							.number_format($total['ht'], 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
							.number_format($total['tva'], 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="12%">'
							.number_format($total['ttc'], 2, ',', ' ').
						'&nbsp;&nbsp;</td>
					</tr>
				';
			return $tbl;
		}

		public function getCEECFacture($ref_fact, $id_deb, $montant){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$tbl = '';
			$total['ht'] = 0;
			$total['tva'] = 0;
			$total['ttc'] = 0;
			$requete = $connexion-> prepare('SELECT d.id_deb AS id_deb, d.nom_deb AS nom_deb,
													det.tva AS tva,
													COUNT(dos.id_dos) AS nbre_dos,
													IF(det.id_deb=27, 
														IF(det.usd="1", SUM(det.montant), SUM(det.montant/dos.roe_decl)),
														IF(det.usd="1", SUM(det.montant)/COUNT(dos.id_dos), SUM(det.montant/dos.roe_decl)/COUNT(dos.id_dos))
													) AS ht,
													IF(det.tva="1",
														SUM(det.montant*0.16),
														0
													) AS tva,
													IF(det.tva="1",
														IF(det.usd="1", SUM(det.montant)*1.16, SUM(det.montant/dos.roe_decl)*1.16),
														IF(det.usd="1", SUM(det.montant), SUM(det.montant/dos.roe_decl))
													) AS ttc
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND d.id_deb = ?
													AND det.montant > 0
													AND det.montant = ?
												GROUP BY d.id_deb
												ORDER BY d.nom_deb ASC');
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['montant']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDeboursFactureLicence($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';
			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													SUM(det.montant) AS ht
												FROM debours d, detail_facture_licence det, licence dos
												WHERE det.ref_fact = ?
													AND det.num_lic = dos.num_lic
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.montant > 0
												GROUP BY d.id_deb
												ORDER BY d.rang ASC');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht'];
				}else{
					$tva = round(($reponse['ht'] * 0.16), 2);
					$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				}

				$tbl .= '
					<tr>
						<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;">&nbsp;&nbsp;'
							.$reponse['nom_deb'].
						'</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">'
							.number_format($reponse['ht'], 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">'
							.number_format($tva, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">'
							.number_format($ttc, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
					</tr>
				';
			}
			$tbl .='
					<tr>
						<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="16%"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="16%"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="16%"></td>
					</tr>
					';

			return $tbl;
		}

		public function getDeboursFacturePartielle($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black;" colspan="2" width="35%"></td>
						<td style="text-align: center; border-bottom: 0.5px dotted black; border-right: 0.5px dotted black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black;" width="25%"></td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black;" width="15%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black;" width="20%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													d.tva AS tva_deb,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if($id_t_deb == '1' && ($reponse['detail']=='') && ($reponse['tva_deb']=='1')){

					$tbl .= '
						<tr>
							<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" colspan="2" width="35%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; font-weight: bold; border-bottom: 0.5px dotted black; font-size: 7px; border-right: 0.5px dotted black;" colspan="2" width="5%">'
								.$reponse['abr_deb'].
							'</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="14%">'
								.number_format($reponse['ht_cdf'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="11%">'
								.number_format(0, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="15%">'
								.number_format($reponse['ht_usd'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
								.number_format($ttc, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';

				}else if($id_t_deb == '1' && ($reponse['detail']=='')){

					$tbl .= '
						<tr>
							<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" colspan="2" width="35%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; font-weight: bold; border-bottom: 0.5px dotted black; font-size: 7px; border-right: 0.5px dotted black;" colspan="2" width="5%">'
								.$reponse['abr_deb'].
							'</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="14%">'
								.number_format($reponse['ht_cdf'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="15%">'
								.number_format($tva, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
								.number_format($ttc, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';

				}else if($reponse['detail']!='' && isset($reponse['detail'])){

					$tbl .= '
						<tr>
							<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" colspan="2" width="40%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].$reponse['detail'].
							'</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="25%">'
								.number_format($reponse['ht_usd'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="15%">'
								.number_format($tva, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
								.number_format($ttc, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';

				}else{

					$tbl .= '
						<tr>
							<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" colspan="2" width="35%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; font-weight: bold; border-bottom: 0.5px dotted black; font-size: 7px; border-right: 0.5px dotted black;" colspan="2" width="5%">'
								.$reponse['abr_deb'].
							'</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="25%">'
								.number_format($reponse['ht_usd'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="15%">'
								.number_format($tva, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; font-weight: bold; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
								.number_format($ttc, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';

				}

			}
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="35%"></td>
						<td style="text-align: center; border-bottom: 0.5px dotted black; font-size: 7px; border-right: 0.5px dotted black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="25%"></td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="15%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%"></td>
					</tr>
					';

			return $tbl;
		}

		public function getDeboursFacturePartielleDouble($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black;" colspan="2" width="35%"></td>
						<td style="text-align: center; border-bottom: 0.5px dotted black; border-right: 0.5px dotted black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black;" width="25%"></td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black;" width="15%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black;" width="20%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													IF(d.id_t_deb=3, 1, det.tva) AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if($id_t_deb == '1' && $this-> getDataDossierFacturePartielle($entree['ref_fact'])['id_cli']=='7'){

					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" colspan="2" width="35%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-bottom: 0.5px dotted black; font-size: 7px; border-right: 0.5px dotted black;" colspan="2" width="5%">'
								.$reponse['abr_deb'].
							'</td>
							<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
								.number_format($reponse['ht_cdf'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
								.number_format($tva, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
								.number_format($reponse['ht_cdf'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';

				}
				// else if($id_t_deb == '1'){

				// 	$tbl .= '
				// 		<tr>
				// 			<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" colspan="2" width="35%">&nbsp;&nbsp;'
				// 				.$reponse['nom_deb'].
				// 			'</td>
				// 			<td style="text-align: center; border-bottom: 0.5px dotted black; font-size: 7px; border-right: 0.5px dotted black;" colspan="2" width="5%">'
				// 				.$reponse['abr_deb'].
				// 			'</td>
				// 			<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="12%">'
				// 				.number_format($reponse['ht_cdf'], 2, ',', ' ').
				// 			'&nbsp;&nbsp;</td>
				// 			<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="8%">'
				// 				.number_format($reponse['ht_usd'], 2, ',', ' ').
				// 			'&nbsp;&nbsp;</td>
				// 			<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
				// 				.number_format($tva, 2, ',', ' ').
				// 			'&nbsp;&nbsp;</td>
				// 			<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
				// 				.number_format($ttc, 2, ',', ' ').
				// 			'&nbsp;&nbsp;</td>
				// 		</tr>
				// 	';

				// }
				else{

					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" colspan="2" width="35%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].$reponse['detail'].
							'</td>
							<td style="text-align: center; border-bottom: 0.5px dotted black; font-size: 7px; border-right: 0.5px dotted black;" colspan="2" width="5%">'
								.$reponse['abr_deb'].
							'</td>
							<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="25%">'
								.number_format($reponse['ht_usd'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="15%">'
								.number_format($tva, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%">'
								.number_format($ttc, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';

				}

			}
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="35%"></td>
						<td style="text-align: center; border-bottom: 0.5px dotted black; font-size: 7px; border-right: 0.5px dotted black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="25%"></td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 7px;" width="15%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="20%"></td>
					</tr>
					';

			return $tbl;
		}

		public function getTotalDeboursFacturePartielle($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeHTCDF = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													d.tva AS tva_deb
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];
				$sommeHTCDF += $reponse['ht_cdf'];

				if($reponse['tva_deb'] == '1'){
					$sommeHT = $sommeHT-$reponse['ht_usd'];
					$tva = $reponse['ht_usd'];
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'];
					$sommeTTC += $ttc;
				}else if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else {
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

			}
			if ($id_t_deb == '1') {
				$tbl .= '
					<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; background-color: rgb(255,165,0); font-size: 7px;" width="14%">'
						.number_format($sommeHTCDF, 2, ',', ' ').
					'&nbsp;&nbsp;</td>
					<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; background-color: rgb(255,165,0); font-size: 7px;" width="11%">'
						.number_format($sommeHT, 2, ',', ' ').
					'&nbsp;&nbsp;</td>
					<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; background-color: rgb(255,165,0); font-size: 7px;" width="15%">'
						.number_format($sommeTVA, 2, ',', ' ').
					'&nbsp;&nbsp;</td>
					<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-weight: bold; background-color: rgb(255,165,0); font-size: 7px;" width="20%">'
						.number_format($sommeTTC, 2, ',', ' ').
					'&nbsp;&nbsp;</td>
				
					';
			}else{
				$tbl .= '
					<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; background-color: rgb(255,165,0); font-size: 7px;" width="25%">'
						.number_format($sommeHT, 2, ',', ' ').
					'&nbsp;&nbsp;</td>
					<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; background-color: rgb(255,165,0); font-size: 7px;" width="15%">'
						.number_format($sommeTVA, 2, ',', ' ').
					'&nbsp;&nbsp;</td>
					<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-weight: bold; background-color: rgb(255,165,0); font-size: 7px;" width="20%">'
						.number_format($sommeTTC, 2, ',', ' ').
					'&nbsp;&nbsp;</td>
				
					';
			}

			return $tbl;
		}

		public function getTotalAllDeboursFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			//$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										det.tva AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb');

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													d.tva AS tva_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

			}

				$tbl .= '
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; font-size: 7px; background-color: rgb(255,215,0);" width="25%">'
							.number_format($sommeHT, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; font-size: 7px; background-color: rgb(255,215,0);" width="15%">'
							.number_format($sommeTVA, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-weight: bold; font-size: 7px; background-color: rgb(255,215,0);" width="20%">'
							.number_format($sommeTTC, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
					
						';
			return $tbl;
		}

		public function getTotalAllDeboursFacturePartielleWithOutTypeDebours($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										det.tva AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb');

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													d.tva AS tva_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND d.id_t_deb <> ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

			}

				$tbl .= '
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; font-size: 7px; background-color: rgb(255,215,0);" width="25%">'
							.number_format($sommeHT, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; font-size: 7px; background-color: rgb(255,215,0);" width="15%">'
							.number_format($sommeTVA, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-weight: bold; font-size: 7px; background-color: rgb(255,215,0);" width="20%">'
							.number_format($sommeTTC, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
					
						';
			return $tbl;
		}

		public function getTotalForFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										det.tva AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb');

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

				$tbl .= '
						<td style="text-align: right; font-size: 12px; border: 1px solid black;font-weight: bold; color: rgb(30,144,255);" width="20%">'
							.number_format($sommeTTC, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						';
			return $tbl;
		}

		public function getTotalForFacturePartielleDouble($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										IF(d.id_t_deb=3, 1, det.tva) AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb');

			if ($id_t_deb=='1') {
				$requete = $connexion-> prepare('SELECT SUM(det.montant) AS montant
													FROM debours d, detail_facture_dossier det, dossier dos
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND d.id_t_deb = ?
														AND det.id_dos = dos.id_dos
													GROUP BY det.ref_fact');
				$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
				$reponse = $requete-> fetch();

					$tbl .= '
							<td style="text-align: right; font-size: 10px; border: 1px solid black;font-weight: bold; color: rgb(30,144,255);" width="20%">'
								.number_format($reponse['montant'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							';
			}else{
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														IF(d.id_t_deb=3, 1, det.tva) AS tva,
														d.abr_deb AS abr_deb,
														SUM(det.montant) AS ht,
														SUM( 
															IF(det.usd="1", 
																0,
																det.montant
															) 
														) AS ht_cdf,
														SUM( 
															IF(det.usd="1", 
																det.montant,
																(det.montant/dos.roe_decl)
															) 
														) AS ht_usd
													FROM debours d, detail_facture_dossier det, dossier dos
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND d.id_t_deb <> 1
														AND det.id_dos = dos.id_dos
													GROUP BY d.id_deb');
				$requete-> execute(array($entree['ref_fact']));
				while($reponse = $requete-> fetch()){

					$sommeHT += $reponse['ht_usd'];

					if($reponse['tva'] == '0'){
						$sommeTVA += 0;
						$sommeTTC += $reponse['ht_usd'];
					}else{
						$tva = round(($reponse['ht_usd'] * 0.16), 2);
						$sommeTVA += $tva;
						$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
						$sommeTTC += $ttc;
					}

					// $sommeHT += $reponse['ht'];

					// if($reponse['tva'] == '0'){
					// 	$sommeTVA += 0;
					// 	$sommeTTC += $reponse['ht'];
					// }else{
					// 	$tva = round(($reponse['ht'] * 0.16), 2);
					// 	$sommeTVA += $tva;
					// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
					// 	$sommeTTC += $ttc;
					// }

				}


					$tbl .= '
							<td style="text-align: right; font-size: 10px; border: 1px solid black;font-weight: bold; color: rgb(30,144,255);" width="20%">'
								.number_format(($sommeTTC-($this-> getMontantARSPForFacturePartielleAllTVA($ref_fact))), 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							';
			}

			return $tbl;
		}

		public function getTotalForFacturePartielleDouble2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			// $entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										IF(d.id_t_deb=3, 1, det.tva) AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb');

			
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														-- IF(d.id_t_deb=3, 1, det.tva) AS tva,
														det.tva AS tva,
														d.abr_deb AS abr_deb,
														SUM(det.montant) AS ht,
														SUM( 
															IF(det.usd="1", 
																0,
																det.montant
															) 
														) AS ht_cdf,
														SUM( 
															IF(det.usd="1", 
																det.montant,
																(det.montant/dos.roe_decl)
															) 
														) AS ht_usd
													FROM debours d, detail_facture_dossier det, dossier dos
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND det.id_dos = dos.id_dos
													GROUP BY d.id_deb');
				$requete-> execute(array($entree['ref_fact']));
				while($reponse = $requete-> fetch()){

					$sommeHT += $reponse['ht_usd'];

					if($reponse['tva'] == '0'){
						$sommeTVA += 0;
						$sommeTTC += $reponse['ht_usd'];
					}else{
						$tva = round(($reponse['ht_usd'] * 0.16), 2);
						$sommeTVA += $tva;
						$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
						$sommeTTC += $ttc;
					}

					// $sommeHT += $reponse['ht'];

					// if($reponse['tva'] == '0'){
					// 	$sommeTVA += 0;
					// 	$sommeTTC += $reponse['ht'];
					// }else{
					// 	$tva = round(($reponse['ht'] * 0.16), 2);
					// 	$sommeTVA += $tva;
					// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
					// 	$sommeTTC += $ttc;
					// }

				}


					$tbl .= '
							<td style="text-align: right; font-size: 10px; border: 1px solid black;font-weight: bold; color: rgb(30,144,255);" width="20%">'
								.number_format(($sommeTTC-($this-> getMontantARSPForFacturePartielleAllTVA($ref_fact))), 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							';
			

			return $tbl;
		}

		public function getTotalForFacturePartielleDoubleBack($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$sommeHTArsp =0;

			$sommeTVAArsp =0;
			$sommeTTCArsp =0;

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										IF(d.id_t_deb=3, 1, det.tva) AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb');

			if ($id_t_deb=='1') {
				$requete = $connexion-> prepare('SELECT SUM(det.montant/dos.roe_decl) AS montant
													FROM debours d, detail_facture_dossier det, dossier dos
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND d.id_t_deb = ?
														AND det.id_dos = dos.id_dos
													GROUP BY det.ref_fact');
				$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
				$reponse = $requete-> fetch();

					$tbl .= '
							<td style="text-align: right; font-size: 10px; border: 1px solid black;font-weight: bold; color: rgb(30,144,255);" width="20%">'
								.number_format($reponse['montant'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							';
			}else{
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														IF(d.id_t_deb=3, 1, det.tva) AS tva,
														d.abr_deb AS abr_deb,
														SUM(det.montant) AS ht,
														SUM( 
															IF(det.usd="1", 
																0,
																det.montant
															) 
														) AS ht_cdf,
														SUM( 
															IF(det.usd="1", 
																det.montant,
																(det.montant/dos.roe_decl)
															) 
														) AS ht_usd
													FROM debours d, detail_facture_dossier det, dossier dos
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND d.id_t_deb <> 1
														AND det.id_dos = dos.id_dos
													GROUP BY d.id_deb');
				$requete-> execute(array($entree['ref_fact']));
				while($reponse = $requete-> fetch()){

					$sommeHT += $reponse['ht_usd'];

					if($reponse['tva'] == '0'){
						$sommeTVA += 0;
						$sommeTTC += $reponse['ht_usd'];
					}else{
						$tva = round(($reponse['ht_usd'] * 0.16), 2);
						$sommeTVA += $tva;
						$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
						$sommeTTC += $ttc;
					}

					// $sommeHT += $reponse['ht'];

					// if($reponse['tva'] == '0'){
					// 	$sommeTVA += 0;
					// 	$sommeTTC += $reponse['ht'];
					// }else{
					// 	$tva = round(($reponse['ht'] * 0.16), 2);
					// 	$sommeTVA += $tva;
					// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
					// 	$sommeTTC += $ttc;
					// }

				}

				// $requete = $connexion-> prepare("SELECT d.nom_deb AS nom_deb,
				// 										IF(d.id_t_deb=3, 1, det.tva) AS tva,
				// 										(det.montant) AS ht
				// 									FROM debours d, detail_facture_dossier det
				// 									WHERE det.ref_fact = ?
				// 										AND det.id_deb = d.id_deb
				// 										AND det.tva = '1'");
				// $requete-> execute(array($entree['ref_fact']));
				// while($reponse = $requete-> fetch()){

				// 	$sommeHTArsp += $reponse['ht'];

				// 	$sommeTVAArsp += 0;
				// 	$sommeTTCArsp += $reponse['ht'];

				// }

					// $tbl .= '
					// 		<td style="text-align: right; font-size: 10px; border: 1px solid black;font-weight: bold; color: rgb(30,144,255);" width="20%">'
					// 			.number_format(($sommeTTC-($sommeTTCArsp*0.012)), 2, ',', ' ').
					// 		'&nbsp;&nbsp;</td>
					// 		';

					$tbl .= '
							<td style="text-align: right; font-size: 10px; border: 1px solid black;font-weight: bold; color: rgb(30,144,255);" width="20%">'
								.number_format($sommeTTC, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							';
			}

			return $tbl;
		}

		public function getARSPForFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			//if ($this-> getFactureGlobale($ref_fact)['id_mod_lic']=='1' && $this-> getFactureGlobale($ref_fact)['id_cli']=='918') {
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND det.tva = "1"');
			/*}
			else if ($this-> getFactureGlobale($ref_fact)['id_mod_lic']=='1') {
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND (d.id_deb = 25 OR d.id_deb = 90)');
			}else if ($this-> getFactureGlobale($ref_fact)['id_cli']=='906') {
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND det.tva = "1"');
			}else{
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND (d.id_deb = 12 OR d.id_deb = 63)');
			}*/

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										det.tva AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb
			// 										AND d.id_deb = 12');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht'];

				$sommeTVA += 0;
				$sommeTTC += $reponse['ht'];

			}

				$tbl .= '
						<td style="text-align: right; border: 1px solid black;font-weight: bold;" width="20%">'
							.number_format(($sommeTTC*0.012), 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						';
			return $tbl;
		}

		public function getARSPForFacturePartielleAllTVA($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND det.tva="1"');
			

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										det.tva AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb
			// 										AND d.id_deb = 12');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht'];

				$sommeTVA += 0;
				$sommeTTC += $reponse['ht'];

			}

				$tbl .= '
						<td style="text-align: right; border: 1px solid black;font-weight: bold; font-size: 7px;" width="20%">'
							.number_format(($sommeTTC*0.012), 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						';
			return $tbl;
		}

		public function getMontantARSPForFacturePartielleAllTVA($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND det.tva="1"');
			

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										det.tva AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb
			// 										AND d.id_deb = 12');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht'];

				$sommeTVA += 0;
				$sommeTTC += $reponse['ht'];

			}

			return ($sommeTTC*0.012);
		}

		public function getMontantARSPForFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			if ($this-> getFactureGlobale($ref_fact)['id_mod_lic']=='1' && $this-> getFactureGlobale($ref_fact)['id_cli']=='883') {
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det, facture_dossier fact
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND (
																(fact.id_cli = 883 AND det.tva = "1")
																OR 
																(d.id_deb = 25 AND fact.id_cli<>883)
															)
														AND det.ref_fact = fact.ref_fact
														');
			}else if ($this-> getFactureGlobale($ref_fact)['id_mod_lic']=='1' && $this-> getFactureGlobale($ref_fact)['id_cli']=='928') {
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det, facture_dossier fact
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND det.tva ="1"
														AND det.ref_fact = fact.ref_fact
														');
			}else{
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND d.id_t_deb = 3');
			}

			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht'];

				$sommeTVA += 0;
				$sommeTTC += $reponse['ht'];

			}

				$tbl .= '
						<td style="text-align: right; border: 1px solid black;font-weight: bold;" width="20%">'
							.number_format(($sommeTTC*0.012), 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						';
			return ($sommeTTC*0.012);
		}

		public function getMontantDeboursClientModeleLicence($id_deb, $id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare("SELECT af.montant AS montant
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
													ORDER BY deb.nom_deb ASC");
			$requete-> execute(array($entree['id_deb'], $entree['id_deb'], $entree['id_deb']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantDeboursClientModeleLicence2($id_deb, $id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare("SELECT *
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
													ORDER BY deb.nom_deb ASC");
			$requete-> execute(array($entree['id_deb'], $entree['id_mod_lic'], $entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getMontantDeboursFactureDossierExcluDebours($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(det.montant) AS montant
													FROM debours deb, detail_facture_dossier det
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND (det.id_deb <> ? AND det.id_deb<>127)
														AND det.id_dos = ?
													GROUP BY det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantTVADeboursFactureDossierExcluDebours($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(det.montant*0.16) AS montant
													FROM debours deb, detail_facture_dossier det
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND (det.id_deb <> ? OR det.id_deb <> 127)
														AND det.id_dos = ?
														AND det.tva = '1'");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantDeboursFactureDossier($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(IF(det.usd='1', det.montant, det.montant/dos.roe_decl)) AS montant
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantTVAFactureDossier($ref_fact, $id_dos){
			include('connexion.php');
			// $entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(
														IF(det.tva='1',
															IF(det.usd='1', 
																det.montant*0.16, 
																(det.montant/dos.roe_decl)*0.16
															),
															0
														)
													) AS montant
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantDeboursDetailFactureDossier($id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			// $entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(IF(det.usd='1', det.montant, det.montant/dos.roe_decl)) AS montant
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														-- AND det.ref_fact = ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantDeboursDetailFactureDossierExlu($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(IF(det.usd='1', det.montant, det.montant/dos.roe_decl)) AS montant
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact <> ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getDeboursCotation($id_cot, $id_t_deb){
			include('connexion.php');
			$entree['id_cot'] = $id_cot;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';
			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													SUM(det.montant) AS ht
												FROM debours d, detail_cotation det
												WHERE det.id_cot = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['id_cot'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){
				$reponse['tva'] = 0;
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht'];
				}else{
					$tva = round(($reponse['ht'] * 0.16), 2);
					$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				}

				$tbl .= '
					<tr>
						<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;">&nbsp;&nbsp;'
							.$reponse['nom_deb'].
						'</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">'
							.number_format($reponse['ht'], 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">'
							.number_format($tva, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">'
							.number_format($ttc, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
					</tr>
				';
			}
			$tbl .='
					<tr>
						<td style="text-align: center; border-left: 1px solid black; border-right: 1px solid black;" colspan="2" width="52%" style="border-left: 1px solid black;"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="16%"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="16%"></td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black;" width="16%"></td>
					</tr>
					';

			return $tbl;
		}

		public function getTotalDeboursFactureGlobale($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													-- (det.montant) AS ht,
													IF(det.usd="1", det.montant, (det.montant/dos.roe_decl)) AS ht,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*0.16), 
															((det.montant/dos.roe_decl)*0.16)),
														"0"
														) AS tva,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*1.16), 
															((det.montant/dos.roe_decl)*1.16)), 
														IF(det.usd="1", 
															(det.montant), 
															((det.montant/dos.roe_decl)))
														) AS ttc
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){
				
				if ($ref_fact == 'DECKCC2200221' && $id_t_deb == '3') {
					$sommeHT += $reponse['ht'];
					$sommeTTC += $reponse['ht']+40;
					$sommeTVA += 40;
				}else{

					$sommeHT += $reponse['ht'];
					$sommeTTC += $reponse['ttc'];
					$sommeTVA += $reponse['tva'];

				}

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeHT, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeTVA, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeTTC, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						';
			return $tbl;
		}

		public function getTotalFactureGlobale($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													-- (det.montant) AS ht,
													IF(det.usd="1", det.montant, (det.montant/dos.roe_decl)) AS ht,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*0.16), 
															((det.montant/dos.roe_decl)*0.16)),
														"0"
														) AS tva,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*1.16), 
															((det.montant/dos.roe_decl)*1.16)), 
														IF(det.usd="1", 
															(det.montant), 
															((det.montant/dos.roe_decl)))
														) AS ttc
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht'];
				$sommeTTC += $reponse['ttc'];
				$sommeTVA += $reponse['tva'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeHT, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeTVA, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeTTC, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						';
			return $tbl;
		}

		public function getTotalDeboursFactureLicence($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													-- (det.montant) AS ht,
													det.montant AS ht,
													IF(det.tva="1",
														(det.montant*0.16),
														0) AS tva,
													IF(det.tva="1",
														(det.montant*1.16),
														0)AS ttc
												FROM debours d, detail_facture_licence det, licence dos
												WHERE det.ref_fact = ?
													AND det.num_lic = dos.num_lic
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht'];
				$sommeTTC += $reponse['ttc'];
				$sommeTVA += $reponse['tva'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeHT, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeTVA, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeTTC, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						';
			return $tbl;
		}

		public function getTotalCotation($id_cot, $id_t_deb){
			include('connexion.php');
			$entree['id_cot'] = $id_cot;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													(det.montant) AS ht
												FROM debours d, detail_cotation det
												WHERE det.id_cot = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?');
			$requete-> execute(array($entree['id_cot'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				$reponse['tva'] = 0;

				$sommeHT += $reponse['ht'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht'];
				}else{
					$tva = round(($reponse['ht'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

			}

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeHT, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeTVA, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black;" width="16%">
							'.number_format($sommeTTC, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						';
			return $tbl;
		}

		public function getTotalForFactureGlobale($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.id_t_deb AS id_t_deb,
													-- (det.montant) AS ht,
													IF(det.usd="1", det.montant, (det.montant/dos.roe_decl)) AS ht,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*0.16), 
															((det.montant/dos.roe_decl)*0.16)),
														"0"
														) AS tva,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*1.16), 
															((det.montant/dos.roe_decl)*1.16)), 
														IF(det.usd="1", 
															(det.montant), 
															((det.montant/dos.roe_decl)))
														) AS ttc
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				// $sommeHT += $reponse['ht'];
				// $sommeTVA += $reponse['tva'];
				// $sommeTTC += $reponse['ttc'];

				if ($ref_fact == 'DECKCC2200221' && $reponse['id_t_deb'] == '3') {
					$sommeHT += $reponse['ht'];
					$sommeTTC += $reponse['ht']+40;
					$sommeTVA += 40;
				}else{

					$sommeHT += $reponse['ht'];
					$sommeTTC += $reponse['ttc'];
					$sommeTVA += $reponse['tva'];

				}

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							'.number_format($sommeHT, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							'.number_format($sommeTVA, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							<b>'.number_format($sommeTTC, 2, ',', ' ').' </b>
						</td>
						';
			return $tbl;
		}

		public function getTotalForFactureGlobaleTaxeAndTransit($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.id_t_deb AS id_t_deb,
													-- (det.montant) AS ht,
													IF(det.usd="1", det.montant, (det.montant/dos.roe_decl)) AS ht,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*0.16), 
															((det.montant/dos.roe_decl)*0.16)),
														"0"
														) AS tva,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*1.16), 
															((det.montant/dos.roe_decl)*1.16)), 
														IF(det.usd="1", 
															(det.montant), 
															((det.montant/dos.roe_decl)))
														) AS ttc
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND (d.id_t_deb = 1 
															OR d.id_t_deb = 2)');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				// $sommeHT += $reponse['ht'];
				// $sommeTVA += $reponse['tva'];
				// $sommeTTC += $reponse['ttc'];

				if ($ref_fact == 'DECKCC2200221' && $reponse['id_t_deb'] == '3') {
					$sommeHT += $reponse['ht'];
					$sommeTTC += $reponse['ht']+40;
					$sommeTVA += 40;
				}else{

					$sommeHT += $reponse['ht'];
					$sommeTTC += $reponse['ttc'];
					$sommeTVA += $reponse['tva'];

				}

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							'.number_format($sommeHT, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							'.number_format($sommeTVA, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							<b>'.number_format($sommeTTC, 2, ',', ' ').' </b>
						</td>
						';
			return $tbl;
		}

		public function getTotalForFactureGlobaleHonoraire($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.id_t_deb AS id_t_deb,
													-- (det.montant) AS ht,
													IF(det.usd="1", det.montant, (det.montant/dos.roe_decl)) AS ht,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*0.16), 
															((det.montant/dos.roe_decl)*0.16)),
														"0"
														) AS tva,
													IF(det.tva="1", 
														IF(det.usd="1", 
															(det.montant*1.16), 
															((det.montant/dos.roe_decl)*1.16)), 
														IF(det.usd="1", 
															(det.montant), 
															((det.montant/dos.roe_decl)))
														) AS ttc
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND (d.id_t_deb = 3)');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				// $sommeHT += $reponse['ht'];
				// $sommeTVA += $reponse['tva'];
				// $sommeTTC += $reponse['ttc'];

				if ($ref_fact == 'DECKCC2200221' && $reponse['id_t_deb'] == '3') {
					$sommeHT += $reponse['ht'];
					$sommeTTC += $reponse['ht']+40;
					$sommeTVA += 40;
				}else{

					$sommeHT += $reponse['ht'];
					$sommeTTC += $reponse['ttc'];
					$sommeTVA += $reponse['tva'];

				}

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							'.number_format($sommeHT, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							'.number_format($sommeTVA, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							<b>'.number_format($sommeTTC, 2, ',', ' ').' </b>
						</td>
						';
			return $tbl;
		}

		public function getTotalForFactureGlobale2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													-- IF(det.id_deb=27, 
													-- 	IF(det.usd="1", SUM(det.montant), SUM(det.montant/dos.roe_decl)),
													-- 	IF(det.usd="1", SUM(det.montant)/COUNT(dos.id_dos), SUM(det.montant/dos.roe_decl)/COUNT(dos.id_dos))
													-- ) AS ht,
													SUM(IF(det.usd="1", det.montant, det.montant/dos.roe_decl))AS ht,
													SUM(IF(det.tva="1",
														det.montant*0.16,
														0
													)) AS tva,
													SUM(IF(det.tva="1",
														IF(det.usd="1", (det.montant)*1.16, (det.montant/dos.roe_decl)*1.16),
														IF(det.usd="1", (det.montant), (det.montant/dos.roe_decl))
													)) AS ttc
												FROM debours d, detail_facture_dossier det, dossier dos, facture_dossier fd
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND det.montant > 0
													AND det.ref_fact = fd.ref_fact
												GROUP BY fd.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-weight: bold;" width="12%">&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-weight: bold; font-size: 10px;" width="12%">
							'.number_format($reponse['ht'], 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-weight: bold; font-size: 10px;" width="12%">
							'.number_format($reponse['tva'], 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-weight: bold; font-size: 10px;" width="12%">
							'.number_format($reponse['ttc'], 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						';
			return $tbl;
		}

		public function getTotalForFactureLicence($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													-- (det.montant) AS ht,
													det.montant AS ht,
													IF(det.tva="1", 
														(det.montant*0.16), 
														"0"
														) AS tva,
													IF(det.tva="1", 
														(det.montant*1.16), 
														(det.montant)) AS ttc
												FROM debours d, detail_facture_licence det, licence dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.num_lic = dos.num_lic');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht'];
				$sommeTVA += $reponse['tva'];
				$sommeTTC += $reponse['ttc'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							'.number_format($sommeHT, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							'.number_format($sommeTVA, 2, ',', ' ').'&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="16%">
							<b>'.number_format($sommeTTC, 2, ',', ' ').' </b>
						</td>
						';
			return $tbl;
		}

		public function getGenTotalCotation($id_cot){
			include('connexion.php');
			$entree['id_cot'] = $id_cot;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													(det.montant) AS ht
												FROM debours d, detail_cotation det
												WHERE det.id_cot = ?
													AND det.id_deb = d.id_deb');
			$requete-> execute(array($entree['id_cot']));
			while($reponse = $requete-> fetch()){

				$reponse['tva'] = 0;

				$sommeHT += $reponse['ht'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht'];
				}else{
					$tva = round(($reponse['ht'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

			}

				$tbl .= '
						<td style="text-align: right; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black; font-size: 13px;" width="48%" colspan="4">
							<b>'.number_format($sommeTTC, 2, ',', ' ').' </b>
						</td>
						';
			return $tbl;
		}

		public function getTransmissionApurement($id_trans_ap){
			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare("SELECT t.ref_trans_ap AS ref_trans_ap, DATE_FORMAT(t.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													DATE_FORMAT(t.date_trans_ap, '%d-%m-%Y') AS date_trans_ap2,
													DATE_FORMAT(t.date_envoi, '%d/%m/%Y %h:%i') AS date_envoi,
													UPPER(t.banque) AS banque, cl.nom_cli AS nom_cli,
													LOWER(ml.nom_mod_lic) AS nom_mod_lic,
													t.id_cli AS id_cli,
													t.id_util_envoi AS id_util_envoi
												FROM transmission_apurement t, client cl, dossier d, detail_apurement det, modele_licence ml
												WHERE t.id_trans_ap = ?
													AND t.id_cli = cl.id_cli
													AND t.id_trans_ap = det.id_trans_ap
													AND det.id_dos = d.id_dos
													AND d.id_mod_lic = ml.id_mod_lic
												GROUP BY t.id_trans_ap");
			$requete-> execute(array($entree['id_trans_ap']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataTransmissionApurement($id_trans_ap){
			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare("SELECT t.ref_trans_ap AS ref_trans_ap, DATE_FORMAT(t.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													DATE_FORMAT(t.date_trans_ap, '%d-%m-%Y') AS date_trans_ap2,
													-- DATE_FORMAT(t.date_envoi, '%d/%m/%Y %h:%i') AS date_envoi,
													DATE_FORMAT(DATE_ADD(t.date_envoi, INTERVAL 1 hour), '%d/%m/%Y %H:%i')  AS date_envoi,
													DATE_FORMAT(DATE_ADD(t.date_recep, INTERVAL 1 hour), '%d/%m/%Y %H:%i')  AS date_recep,
													DATE_FORMAT(DATE_ADD(t.date_rejet, INTERVAL 1 hour), '%d/%m/%Y %H:%i')  AS date_rejet,
													-- DATE_FORMAT(t.date_rejet, '%d/%m/%Y %h:%i') AS date_rejet,
													UPPER(t.banque) AS banque,
													t.id_cli AS id_cli,
													t.id_util_envoi AS id_util_envoi,
													t.id_util_recep AS id_util_recep,
													t.id_util_rejet AS id_util_rejet
												FROM transmission_apurement t
												WHERE t.id_trans_ap = ?");
			$requete-> execute(array($entree['id_trans_ap']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getTransmisFactureDossier($id_trans_fact){
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;

			$requete = $connexion-> prepare("SELECT ref_trans_fact, DATE_FORMAT(date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													DATE_FORMAT(date_trans_fact, '%d-%m-%Y') AS date_trans_fact2
												FROM transmis_facture_dossier
												WHERE id_trans_fact = ?");
			$requete-> execute(array($entree['id_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getClientFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT cl.*
												FROM facture_dossier f, client cl
												WHERE f.ref_fact = ?
													AND f.id_cli =  cl.id_cli");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getMarchandiseFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT IF(COUNT(DISTINCT(march.id_march))>1, 
														'DIVERSES MARCHANDISES', 
														UPPER(march.nom_march)
													) AS nom_march
												FROM facture_dossier f, detail_facture_dossier df, dossier dos, marchandise march
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos
													AND dos.id_march = march.id_march
                                                GROUP BY march.id_march");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();

			if ($reponse) {
				return $reponse;
			}else{
				$reponse['nom_march'] = null;
				return $reponse;
			}

		}

		public function getNbreLotFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(dos.num_lot)) AS nbre
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getPoidsBrutFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$poids = 0;

			$requete = $connexion-> prepare("SELECT dos.poids_brut AS poids_brut
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos
												GROUP BY dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$poids += $reponse['poids_brut'];
			}
			return ($poids/1000);
		}

		public function getPoidsNetFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$poids = 0;

			$requete = $connexion-> prepare("SELECT dos.poids AS poids
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos
												GROUP BY dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$poids += $reponse['poids'];
			}
			return ($poids/1000);
		}

		public function getMarchandiseFacture2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT DISTINCT(march.id_march) AS id_march, march.nom_march_2 AS nom_march_2, 
													f.id_cli AS id_cli, dos.id_mod_trans AS id_mod_trans
												FROM facture_dossier f, detail_facture_dossier df, dossier dos, marchandise march
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos
													AND dos.id_march = march.id_march
                                                GROUP BY march.id_march");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getFournisseurFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT IF(COUNT(DISTINCT(dos.supplier))>1 OR dos.supplier IS NULL, 
														'FOURNISSEURS MULTIPLES', 
														UPPER(dos.supplier)
													) AS supplier
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getCommodityFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT IF(COUNT(DISTINCT(dos.commodity))>1 OR dos.commodity IS NULL, 
														'DIVERS MARCHANDISES', 
														UPPER(dos.commodity)
													) AS commodity
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getTauxFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT ROUND(AVG(dos.roe_decl) ,4) AS roe_decl
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getInfoFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(dos.id_dos)) AS nbre
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getFactureGlobale($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT *, 
													IF(validation = '1',
														DATE_FORMAT(date_validation, '%d/%m/%Y'),
														DATE_FORMAT(date_fact, '%d/%m/%Y')
													) AS date_fact,
													IF(affichage_bloc='1', 'Un bloc', 'Un deux bloc (Bulletin de Liquidation & Frais hors bulletin)') AS label_affichage_bloc
												FROM facture_dossier
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getMontantDetailFactureDossierDebours($ref_fact, $id_dos, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;
			$entree['id_deb'] = $id_deb;

			$requete = $connexion-> prepare("SELECT montant
												FROM detail_facture_dossier
												WHERE ref_fact = ?
													AND id_dos = ?
													AND id_deb = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['montant'];
			}else{
				return null;
			}
			
		}

		public function getRefFactureDossierDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM detail_facture_dossier
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function verifierClient($nom_cli){
			include('connexion.php');
			$entree['nom_cli'] = $nom_cli;
			//$entree['pass_util'] = $pass_util;

			$requete = $connexion-> prepare('SELECT id_cli
												FROM client
												WHERE nom_cli = ?');
			$requete-> execute(array($entree['nom_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_cli'];
			}else{
				return false;
			}
		}

		public function verifierCodeClient($code_cli){
			include('connexion.php');
			$entree['code_cli'] = $code_cli;
			//$entree['pass_util'] = $pass_util;

			$requete = $connexion-> prepare('SELECT id_cli
												FROM client
												WHERE code_cli = ?');
			$requete-> execute(array($entree['code_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_cli'];
			}else{
				return false;
			}
		}

		public function verifierDossierFacture($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			//$entree['pass_util'] = $pass_util;

			$requete = $connexion-> prepare('SELECT id_dos
												FROM detail_facture_dossier
												WHERE id_dos = ?');
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_dos'];
			}else{
				return false;
			}
		}

		public function verifierDossier($ref_dos){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			//$entree['pass_util'] = $pass_util;

			$requete = $connexion-> prepare('SELECT id_dos
												FROM dossier
												WHERE ref_dos = ?');
			$requete-> execute(array($entree['ref_dos']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_dos'];
			}else{
				return false;
			}
		}
		//FIN Methode permettant de verifier

		//Methode permettant de recuperer

		public function getTailleCompteur($i){
			if(strlen($i) == '1' ){
				$i = '00'.$i;
			}else if(strlen($i) == '2' ){
				$i = '0'.$i;
			}else if(strlen($i) == '3' ){
				$i = ''.$i;
			}
			return $i;
		}

		public function getTailleCompteur2($i){
			if(strlen($i) == '1' ){
				$i = '000'.$i;
			}else if(strlen($i) == '2' ){
				$i = '00'.$i;
			}else if(strlen($i) == '3' ){
				$i = '0'.$i;
			}else if(strlen($i) == '4' ){
				$i = ''.$i;
			}
			return $i;
		}

		public function getTailleCompteur3($i){
			if(strlen($i) == '1' ){
				$i = '0000'.$i;
			}else if(strlen($i) == '2' ){
				$i = '000'.$i;
			}else if(strlen($i) == '3' ){
				$i = '00'.$i;
			}else if(strlen($i) == '4' ){
				$i = '0'.$i;
			}else if(strlen($i) == '4' ){
				$i = ''.$i;
			}
			return $i;
		}

		public function nbreSummary($statut, $id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['statut'] = $statut;

			$sqlClient = '';
			$sqlModeTransport = '';
			$sqlCommodity = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlModeTransport = ' AND id_mod_trans = "'.$id_mod_trans.'"';
			}else{
				$sqlModeTransport = '';
			}

			if (isset($commodity) && ($commodity!='')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE id_mod_lic = ?
												AND statut = ?
												$sqlClient
												$sqlModeTransport
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic'], $entree['statut']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDocumentsFilesStatus($id_doc, $id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_doc'] = $id_doc;

			$sqlClient = '';
			$sqlModeTransport = '';
			$sqlCommodity = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlModeTransport = ' AND id_mod_trans = "'.$id_mod_trans.'"';
			}else{
				$sqlModeTransport = '';
			}

			if (isset($commodity) && ($commodity!='')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			if ($id_doc == 49) {

				$requete = $connexion-> prepare("SELECT COUNT(dos.ref_dos) AS nbre
												FROM dossier dos
												WHERE dos.id_mod_lic = ?
													AND dos.num_bp NOT IN (
															SELECT num_bp
																FROM plis
																WHERE id_cli = dos.id_cli
														)
													AND YEAR(dos.date_creat_dos) > 2021
													AND id_mod_trans <> 6
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");
				$requete-> execute(array($entree['id_mod_lic']));
				

			}else if ($id_doc == 48) {

				$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_dos NOT IN (
															SELECT DISTINCT(id_dos)
																FROM dossier_document
																WHERE id_doc = ?
														)
													AND YEAR(date_creat_dos) > 2021
													AND id_mod_trans <> 6
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_doc']));

			}
			else if ($this-> getDataDocument($id_doc)['id_t_doc'] == 1) {

				$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_dos NOT IN (
															SELECT DISTINCT(id_dos)
																FROM dossier_document
																WHERE id_doc = ?
																	OR id_doc = 52
														)
													AND YEAR(date_creat_dos) > 2021
													AND id_mod_trans <> 6
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_doc']));

			}
			else{

				$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_dos NOT IN (
															SELECT DISTINCT(id_dos)
																FROM dossier_document
																WHERE id_doc = ? 
																	OR id_doc = 48 
															-- SELECT DISTINCT(dd.id_dos)
															-- 	FROM dossier_document dd, document d
															-- 	WHERE (d.id_doc = ? 
															-- 			OR d.id_doc = 48 
															-- 			OR (d.id_doc = 52 AND d.id_t_doc = 2)
															-- 		)
															-- 		AND dd.id_doc = d.id_doc
														)
													AND YEAR(date_creat_dos) > 2021
													AND id_mod_trans <> 6
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_doc']));

			}
			
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function getDataDocument($id_doc){
			include('connexion.php');
			$entree['id_doc'] = $id_doc;

			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			$requete = $connexion-> prepare("SELECT *
												FROM document
													WHERE id_doc = ?");
			$requete-> execute(array($entree['id_doc']));
			$reponse=$requete-> fetch();
			return $reponse;
		}

		public function getSummary($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			$requete = $connexion-> prepare("SELECT REPLACE(nom_stat, '\'','') AS nom_stat, nom_stat AS nom_stat2
												FROM status_dashboard
													WHERE id_mod_lic = ?
													AND active ='1'
												ORDER BY rang_stat");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse=$requete-> fetch()){
			?>

	          <div class="col-md-3 col-sm-6 col-12">

	            <div class="small-box bg-<?php echo $bg[rand(1, 8)];?>">
	              <div class="inner">
	                <h3>
	                  <?php echo number_format($this-> nbreSummary($reponse['nom_stat2'], $id_mod_lic, $id_cli, $id_mod_trans, $commodity), 0, ',', ' ');?>
	                </h3>

	                <p> <?php echo $reponse['nom_stat2'];?> </p>
	              </div>
	              <div class="icon">
	                <i class="fas fa-file"></i>
	              </div>
	              <a href="#" class="small-box-footer" onclick="window.open('popUpDashboardDossier.php?statut=<?php echo $reponse['nom_stat'];?>&id_mod_lic=<?php echo $_GET['id_mod_trac'];?>&id_mod_trans=<?php echo $_GET['id_mod_trans'];?>&id_cli=<?php echo $_GET['id_cli'];?>&commodity=<?php echo $_GET['commodity'];?>','pop1','width=1500,height=950');">
	                More info <i class="fas fa-arrow-circle-right"></i>
	              </a>
	            </div>

	            <!-- /.info-box -->
	          </div>

			<?php
			}$requete-> closeCursor();
		}

		public function getDocumentsFilesStatus($id_mod_lic, $id_cli, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			$requete = $connexion-> prepare("SELECT UPPER(doc.nom_doc) AS nom_doc, 
													-- REPLACE(doc.nom_doc, '\'', '') AS nom_doc,
													doc.id_doc AS id_doc
												FROM affectation_document_modele_licence aff, document doc
													WHERE aff.id_mod_lic = ?
													AND aff.active ='1'
													ANd aff.id_doc = doc.id_doc
												ORDER BY aff.rang");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse=$requete-> fetch()){
			?>

	          <div class="col-md-3 col-sm-6 col-12">

	            <div class="small-box bg-<?php echo $bg[rand(1, 8)];?>">
	              <div class="inner">
	                <h3>
	                  <?php echo number_format($this-> nbreDocumentsFilesStatus($reponse['id_doc'], $id_mod_lic, $id_cli, $commodity), 0, ',', ' ');?>
	                </h3>

	                <p style="font-size: 100%;"> SANS <?php echo $reponse['nom_doc'];?> </p>
	              </div>
	              <div class="icon">
	                <i class="fas fa-file"></i>
	              </div>
	              <a href="#" class="small-box-footer" onclick="window.open('popUpDashboardGeneralDossier3.php?id_doc=<?php echo $reponse['id_doc'];?>&nom_doc=SANS <?php echo $reponse['nom_doc'];?>&id_mod_lic=<?php echo $_GET['id_mod_trac'];?>&id_cli=<?php echo $_GET['id_cli'];?>&commodity=<?php echo $_GET['commodity'];?>','pop1','width=1000,height=700');">
	                More info <i class="fas fa-arrow-circle-right"></i>
	              </a>
	            </div>

	            <!-- /.info-box -->
	          </div>

			<?php
			}$requete-> closeCursor();
		}

		public function getDataRow($champ_col, $id_dos){
			include('connexion.php');
			$entree['champ_col'] = $champ_col;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT $champ_col
												FROM dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse["$champ_col"];
			}
		}

		public function getDataRowLicence($champ_col, $num_lic){
			include('connexion.php');
			$entree['champ_col'] = $champ_col;
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT $champ_col
												FROM licence
													WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse["$champ_col"];
			}
		}

		public function getDataRowFinOPS($id_dep, $id_dos){
			include('connexion.php');
			$entree['id_dep'] = $id_dep;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT montant, date_dep
												FROM depense_dossier
													WHERE id_dos = ?
														AND id_dep = ?");
			$requete-> execute(array($entree['id_dos'], $entree['id_dep']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataRowCalcul($champ_col, $id_dos){
			include('connexion.php');
			$entree['champ_col'] = $champ_col;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT DATEDIFF(dgda_out, dgda_in) AS dgda_delay,
													DATEDIFF(dispatch_deliv, arrival_date) AS arrival_deliver_delay
												FROM dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataRowCalculNetDays($champ_col, $id_dos){
			include('connexion.php');
			$entree['champ_col'] = $champ_col;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT DATEDIFF(dgda_out, dgda_in) AS dgda_delay,
													DATEDIFF(dispatch_deliv, arrival_date) AS arrival_deliver_delay,
													arrival_date, dispatch_deliv
												FROM dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return ( $reponse['arrival_deliver_delay'] - $this-> getWeekendsAndHolidays($reponse['arrival_date'], $reponse['dispatch_deliv']) );
			}
		}

		public function codePourClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT code_cli
												FROM client
													WHERE id_cli = ?");
			$requete-> execute(array($entree['id_cli']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['code_cli'];
			}
		}

		public function getBalanceLicenceDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;


			$requete = $connexion-> prepare("SELECT SUM(poids) AS somme
												FROM dossier
													WHERE id_dos < ?
														AND num_lic = ?");
			$requete-> execute(array($entree['id_dos'], $this-> getDossier($id_dos)['num_lic']));
			$reponse=$requete-> fetch();


			if($reponse){
				return ( ($this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids']) - ($reponse['somme']) - ($this-> getDossier($id_dos)['poids']) );
			}
		}

		public function getDataMarchandise($id_march){
			include('connexion.php');
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("SELECT *
												FROM marchandise
													WHERE id_march = ?");
			$requete-> execute(array($entree['id_march']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT *,
													IF(cleared='1',
														'Cleared',
														IF(cleared='0',
															'In Transit',
															'Cancelled'
														)
													) AS label_statut,
													IF(tr8_ref IS NOT NULL,
														CONCAT(tr8_ref, ' du ', DATE_FORMAT(tr8_date, '%d/%m/%Y')),
														NULL
														) AS tr8,
													IF(ref_decl IS NOT NULL,
														CONCAT(ref_decl, ' du ', DATE_FORMAT(date_decl, '%d/%m/%Y')),
														NULL
														) AS declaration,
													IF(ref_liq IS NOT NULL,
														CONCAT(ref_liq, ' du ', DATE_FORMAT(date_liq, '%d/%m/%Y')),
														NULL
														) AS liquidation,
													IF(ref_quit IS NOT NULL,
														CONCAT(ref_quit, ' du ', DATE_FORMAT(date_quit, '%d/%m/%Y')),
														NULL
														) AS quittance,
													CONCAT(
														IF(horse IS NOT NULL AND REPLACE(horse, ' ', '') NOT LIKE '',
															horse,
															''),
														IF(trailer_1 IS NOT NULL AND REPLACE(trailer_1, ' ', '') NOT LIKE '',
															CONCAT(' / ', trailer_1),
															''),
														IF(trailer_2 IS NOT NULL AND REPLACE(trailer_2, ' ', '') NOT LIKE '',
															CONCAT(' / ', trailer_2),
															'')
													) AS truck,
													CONCAT(
														ref_decl,' ', DATE_FORMAT(date_decl, '%d/%m/%Y')
													) AS declaration,
													CONCAT(
														ref_liq,' ', DATE_FORMAT(date_liq, '%d/%m/%Y')
													) AS liquidation,
													CONCAT(
														ref_quit,' ', DATE_FORMAT(date_quit, '%d/%m/%Y')
													) AS quittance,
													get_nbre_remorque(id_dos) AS nbre_remorque
												FROM dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDossierFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT DISTINCT(id_dos) AS id_dos
												FROM detail_facture_dossier
													WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse=$requete-> fetch();
			return $reponse['id_dos'];
		}

		public function getDossierFactureDec($ref_fact_dec){
			include('connexion.php');
			$entree['ref_fact_dec'] = $ref_fact_dec;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
													WHERE ref_fact_dec = ?");
			$requete-> execute(array($entree['ref_fact_dec']));
			$reponse=$requete-> fetch();
			return $reponse;
		}

		public function getDebours($id_deb){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;

			$requete = $connexion-> prepare("SELECT *
												FROM debours
													WHERE id_deb = ?");
			$requete-> execute(array($entree['id_deb']));
			$reponse=$requete-> fetch();
			return $reponse;
		}

		public function getAllDataDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT d.*, cl.*, UPPER(ml.nom_mod_lic) AS nom_mod_lic,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_ouvert,
													-- DATE_FORMAT(DATE_ADD(d.date_creat_dos, INTERVAL 2 hour), '%d/%m/%Y %H:%i:%s') AS date_ouvert_2,
													d.date_creat_dos AS date_ouvert_2,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(DATE_ADD(d.date_feuil_calc, INTERVAL 2 hour), '%d/%m/%Y %H:%i:%s') AS date_feuil_calc,
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos,
													CONCAT(' du ', DATE_FORMAT(d.dgda_manif_date, '%d/%m/%Y')) AS dgda_manif_date,
													CONCAT(' du ', DATE_FORMAT(d.ad_date, '%d/%m/%Y')) AS ad_date,
													UPPER(march.nom_march) AS nom_march,
													march.taux_tarif_march AS taux_tarif_march,
													march.code_tarif_march AS code_tarif_march,
													UPPER(mt.nom_mod_trans) AS nom_mod_trans,
													(IF(d.fob IS NULL, 0, d.fob)+IF(d.fret IS NULL, 0, d.fret)+IF(d.assurance IS NULL, 0, d.assurance)+IF(d.autre_frais IS NULL, 0, d.autre_frais)) AS cif,
													d.fob AS fob,
													d.date_ouvert AS date_ouvert2,
													DATE(d.date_creat_dos) AS date_creat_dos_2,
													mon.sig_mon AS sig_mon,
													um.nom_unit_mes AS nom_unit_mes,
													um.id_unit_mes AS id_unit_mes,
													um.abreg_unit_mes AS abreg_unit_mes,
													d.reg_dgda AS reg_dgda,
													s.nom_site AS nom_site,
													d.incoterm AS incoterm,
													emb.nom_emb AS nom_emb
												FROM dossier d, client cl, modele_licence ml, mode_transport mt, marchandise march, monnaie mon, unite_mesure um, site s, emballage emb
													WHERE d.id_dos = ?
														AND d.id_cli = cl.id_cli
														AND d.id_mod_lic = ml.id_mod_lic
														AND d.id_mod_trans = mt.id_mod_trans
														AND d.id_march = march.id_march
														AND d.id_mon = mon.id_mon
														AND d.id_unit_mes = um.id_unit_mes
														AND d.id_site = s.id_site
														AND d.id_emb = emb.id_emb");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getFournisseurDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$fournisseur = '';

			$requete = $connexion-> prepare("SELECT DISTINCT(supplier) AS supplier
												FROM marchandise_dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			
			while ($reponse=$requete-> fetch()) {
				
				$fournisseur .= ', '.$reponse['supplier'];

			}$requete-> closeCursor();
			
			return $fournisseur;
		}

		public function getFOBFretAssuranceAutreFraisDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$fournisseur = '';

			$requete = $connexion-> prepare("SELECT SUM(fob) AS fob, SUM(fret) AS fret, SUM(autre_frais) AS autre_frais, 
													SUM(poids) AS poids, SUM(poids_brut) AS poids_brut, 
													SUM(assurance) AS assurance
												FROM marchandise_dossier
													WHERE id_dos = ?
													GROUP BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			
			$reponse=$requete-> fetch();

			return $reponse;
		}

		public function getMarchandiseDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$fournisseur = '';

			$requete = $connexion-> prepare("SELECT *
												FROM marchandise_dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			
			$reponse=$requete-> fetch();

			return $reponse;
		}

		public function getFactureLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM facture
													WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getFactureLicence2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT *
												FROM facture_licence
													WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse=$requete-> fetch();
			// if($reponse){
				return $reponse;
			// }
		}

		public function getDossierRefDos($ref_dos){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
													WHERE ref_dos = ?
														OR num_lot = ?");
			$requete-> execute(array($entree['ref_dos'], $entree['ref_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDossierRefDos2($ref_dos){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
													WHERE ref_dos_2 = ?
														OR num_lot = ?");
			$requete-> execute(array($entree['ref_dos'], $entree['ref_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDossierRefTRS($trs){
			include('connexion.php');
			$entree['trs'] = $trs;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
													WHERE trs = ?
														OR num_lot = ?");
			$requete-> execute(array($entree['trs'], $entree['trs']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDossierRefTRS2($trs){
			include('connexion.php');
			$entree['trs'] = $trs;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
													WHERE trs = ?
														OR num_lot = ?");
			$requete-> execute(array($entree['trs'], $entree['trs']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDossierLIKERefDos($ref_dos){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
													WHERE replace(replace(ref_dos, '/2021', ''), '21DEC', 'DEC') = ?");
			$requete-> execute(array($entree['ref_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDelaiFactureLicence($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT DATEDIFF(DATE(l.date_creat_lic), f.date_fact_rec) AS diff
												FROM licence l, facture_licence f
													WHERE f.ref_fact = ?
														AND f.ref_fact = l.ref_fact");
			$requete-> execute(array($entree['ref_fact']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['diff'];
			}else{
				return null;
			}
		}

		public function verifierExistanceMCAFile($mca_file){
			include('connexion.php');
			$entree['mca_file'] = $mca_file;

			$requete = $connexion-> prepare("SELECT id_dos
												FROM dossier
													WHERE ref_dos = ?");
			$requete-> execute(array($entree['mca_file']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierExistanceRefDos($mca_file){
			include('connexion.php');
			$entree['mca_file'] = $mca_file;

			$requete = $connexion-> prepare("SELECT id_dos
												FROM dossier
													WHERE ref_dos = ?");
			$requete-> execute(array($entree['mca_file']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierExistanceRefDos2($mca_file){
			include('connexion.php');
			$entree['mca_file'] = $mca_file;

			$requete = $connexion-> prepare("SELECT id_dos
												FROM dossier
													WHERE ref_dos_2 = ?");
			$requete-> execute(array($entree['mca_file']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierExistanceRefFactureDossier($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM facture_dossier
													WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierReferenceTransmissionApurement($ref_trans_ap){
			include('connexion.php');
			$entree['ref_trans_ap'] = $ref_trans_ap;

			$requete = $connexion-> prepare("SELECT id_trans_ap
												FROM transmission_apurement
													WHERE ref_trans_ap = ?");
			$requete-> execute(array($entree['ref_trans_ap']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierReferenceDepenseDossier($ref_dep){
			include('connexion.php');
			$entree['ref_dep'] = $ref_dep;

			$requete = $connexion-> prepare("SELECT id_dep
												FROM depense_dossier
													WHERE ref_dep = ?");
			$requete-> execute(array($entree['ref_dep']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierReferenceTransmissionFacture($ref_trans_fact){
			include('connexion.php');
			$entree['ref_trans_fact'] = $ref_trans_fact;

			$requete = $connexion-> prepare("SELECT id_trans_fact
												FROM transmis_facture_dossier
													WHERE ref_trans_fact = ?");
			$requete-> execute(array($entree['ref_trans_fact']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierReferenceCotation($ref_cat){
			include('connexion.php');
			$entree['ref_cat'] = $ref_cat;

			$requete = $connexion-> prepare("SELECT id_cot
												FROM cotation
													WHERE ref_cot = ?");
			$requete-> execute(array($entree['ref_cat']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierApurementDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT id_dos
												FROM detail_apurement
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function getMontantFactureGlobale_backup_16_11_23($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													d.id_t_deb AS id_t_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													IF(client.id_group=2,
														SUM( 
																IF(det.usd="1", 
																	ROUND(det.montant,2),
																	(det.montant/ROUND(dos.roe_decl,2))
																) 
															),
														SUM( 
																IF(det.usd="1", 
																	det.montant,
																	(det.montant/dos.roe_decl)
																) 
															)
													)
													 AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos, client, facture_dossier
												WHERE facture_dossier.id_cli = client.id_cli
													AND facture_dossier.ref_fact = det.ref_fact
													AND det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if ($ref_fact == 'DECKCC2200221' && $reponse['id_t_deb'] == '3') {
					
					if($reponse['tva'] == '0'){
						$sommeTVA += 0;
						$sommeTTC += $reponse['ht_usd'];
					}else{
						$tva = 40;
						$sommeTVA += $tva;
						$ttc = $reponse['ht_usd'] + 40;
						$sommeTTC += $ttc;
					}

				}else{

					if($reponse['tva'] == '0'){
						$sommeTVA += 0;
						$sommeTTC += $reponse['ht_usd'];
					}else{
						$tva = round(($reponse['ht_usd'] * 0.16), 2);
						$sommeTVA += $tva;
						$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
						$sommeTTC += $ttc;
					}

				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function getMontantFactureGlobale($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													-- SUM( 
													-- 	IF(det.usd="1", 
													-- 		det.montant,
													-- 		(det.montant/dos.roe_decl)
													-- 	) 
													-- ) AS ht_usd,
													IF(client.id_group=2,
														SUM( 
																IF(det.usd="1", 
																	ROUND(det.montant,2),
																	ROUND((det.montant/dos.roe_decl),2)
																) 
															),
														SUM( 
																IF(det.usd="1", 
																	det.montant,
																	(det.montant/dos.roe_decl)
																) 
															)
													)
													 AS ht_usd,
													IF(client.id_group=2,
														SUM( 
																IF(det.usd="1", 
																	IF(det.tva="1", ROUND(det.montant,2)*1.16, ROUND(det.montant,2))
																	,
																	IF(det.tva="1", ROUND((det.montant/dos.roe_decl),2)*1.16, ROUND((det.montant/dos.roe_decl),2))
																	
																) 
															),
														SUM( 
																IF(det.usd="1", 
																	IF(det.tva="1", det.montant*1.16, det.montant)
																	,
																	IF(det.tva="1", (det.montant/dos.roe_decl)*1.16, (det.montant/dos.roe_decl))
																	
																) 
															)
													)
													 AS ttc_usd
												FROM debours d, detail_facture_dossier det, dossier dos, client, facture_dossier
												WHERE facture_dossier.id_cli = client.id_cli
													AND facture_dossier.ref_fact = det.ref_fact
													AND det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													-- AND det.id_deb = ?
												GROUP BY facture_dossier.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();

			return $reponse['ttc_usd'];
		}

		public function getLicenceFactureFRONT($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare('SELECT dos.num_lic AS num_lic
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.num_lic');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse['num_lic'];
		}

		public function getMontantFactureLicence($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare('SELECT SUM(
														IF(det.tva="1",
															det.montant*1.16,
															det.montant)
													) AS montant
												FROM debours d, detail_facture_licence det, licence dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.num_lic = dos.num_lic');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getLicenceFactureLicence($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare('SELECT dos.num_lic AS num_lic, dos.fichier_lic AS fichier_lic
												FROM debours d, detail_facture_licence det, licence dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.num_lic = dos.num_lic
												GROUP BY dos.num_lic');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getMontantFactureDebours_backup_16_11_23($ref_fact, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													-- SUM( 
													-- 	IF(det.usd="1", 
													-- 		det.montant,
													-- 		(det.montant/dos.roe_decl)
													-- 	) 
													-- ) AS ht_usd,
													IF(client.id_group=2,
														SUM( 
																IF(det.usd="1", 
																	ROUND(det.montant,2),
																	ROUND((det.montant/dos.roe_decl),2)
																) 
															),
														SUM( 
																IF(det.usd="1", 
																	det.montant,
																	(det.montant/dos.roe_decl)
																) 
															)
													)
													 AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos, client, facture_dossier
												WHERE facture_dossier.id_cli = client.id_cli
													AND facture_dossier.ref_fact = det.ref_fact
													AND det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND det.id_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function getMontantFactureDebours($ref_fact, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													-- SUM( 
													-- 	IF(det.usd="1", 
													-- 		det.montant,
													-- 		(det.montant/dos.roe_decl)
													-- 	) 
													-- ) AS ht_usd,
													IF(client.id_group=2,
														SUM( 
																IF(det.usd="1", 
																	ROUND(det.montant,2),
																	ROUND((det.montant/dos.roe_decl),2)
																) 
															),
														SUM( 
																IF(det.usd="1", 
																	det.montant,
																	(det.montant/dos.roe_decl)
																) 
															)
													)
													 AS ht_usd,
													IF(client.id_group=2,
														SUM( 
																IF(det.usd="1", 
																	IF(det.tva="1", ROUND(det.montant,2)*1.16, ROUND(det.montant,2))
																	,
																	IF(det.tva="1", ROUND((det.montant/dos.roe_decl),2)*1.16, ROUND((det.montant/dos.roe_decl),2))
																	
																) 
															),
														SUM( 
																IF(det.usd="1", 
																	IF(det.tva="1", det.montant*1.16, det.montant)
																	,
																	IF(det.tva="1", (det.montant/dos.roe_decl)*1.16, (det.montant/dos.roe_decl))
																	
																) 
															)
													)
													 AS ttc_usd
												FROM debours d, detail_facture_dossier det, dossier dos, client, facture_dossier
												WHERE facture_dossier.id_cli = client.id_cli
													AND facture_dossier.ref_fact = det.ref_fact
													AND det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND det.id_deb = ?
												GROUP BY facture_dossier.ref_fact');
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			$reponse = $requete-> fetch();

			return $reponse['ttc_usd'];
		}

		public function getMontantFactureDeboursUSDSansTVA($ref_fact, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													-- SUM( 
													-- 	IF(det.usd="1", 
													-- 		det.montant,
													-- 		(det.montant/dos.roe_decl)
													-- 	) 
													-- ) AS ht_usd,
													IF(client.id_group=2,
														SUM( 
																IF(det.usd="1", 
																	ROUND(det.montant,2),
																	ROUND((det.montant/dos.roe_decl),2)
																) 
															),
														SUM( 
																IF(det.usd="1", 
																	det.montant,
																	(det.montant/dos.roe_decl)
																) 
															)
													)
													 AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos, client, facture_dossier
												WHERE facture_dossier.id_cli = client.id_cli
													AND facture_dossier.ref_fact = det.ref_fact
													AND det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND det.id_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function getMontantFactureEnAttenteDeboursDossier($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT ROUND(det.montant, 3) AS montant
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND det.id_deb = ?
													AND dos.id_dos = ?');
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();

			if ($reponse) {
				return $reponse['montant'];
			}

			
		}

		public function getMontantDeboursDossier($id_deb, $id_dos){
			include('connexion.php');
			// $entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT ROUND(det.montant, 3) AS montant
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND det.id_deb = ?
													AND dos.id_dos = ?');
			$requete-> execute(array($entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();

			if ($reponse) {
				return $reponse['montant'];
			}

			
		}

		public function getMontantFactureDossier($ref_fact, $id_dos){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND dos.id_dos = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function getMontantFactureDeboursDossier($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND dos.id_dos = ?
													AND det.id_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return round($sommeTTC,3);
		}

		public function getMontantFactureDeboursDossier2($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND dos.id_dos = ?
													AND det.id_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return round($sommeTTC,3);
		}

		public function getMontantFactureDeboursDossier3($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht_usd,
													det.detail AS detail
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND dos.id_dos = ?
													AND det.id_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return round($sommeHT,3);
		}

		public function getDataFactureDeboursDossier($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT det.*
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND dos.id_dos = ?
													AND det.id_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getMarchandiseFactureDossier($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			//$entree['id_deb'] = $id_deb;

			$commodity = '';


			$requete = $connexion-> prepare('SELECT DISTINCT(dos.commodity) AS commodity
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$commodity .= $reponse['commodity'].', ';
			}

			$commodity = substr($commodity, 0, -2);
			return $commodity;
		}

		public function getMontantTotalTypeFacture($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['type_fact'] = $type_fact;
			$entree['id_mod_lic'] = $id_mod_lic;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'" ';
			}


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare("SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd='1', 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd='1', 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos, facture_dossier fd
												WHERE fd.type_fact = ?
													AND fd.id_mod_lic = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY det.id_deb");
			$requete-> execute(array($entree['type_fact'], $entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function getMontantFactureDossierDebours($ref_fact, $id_dos, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;
			$entree['id_deb'] = $id_deb;

			$requete = $connexion-> prepare("SELECT montant
												FROM detail_facture_dossier
													WHERE ref_fact = ?
														AND id_dos = ?
														AND id_deb = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
			$reponse=$requete-> fetch();
			return $reponse['montant'];
		}

		public function verifierApurementDossierLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT COUNT(da.id_dos) AS nbre
												FROM dossier d, detail_apurement da
													WHERE d.num_lic = ?
														AND d.id_dos = da.id_dos");
			$requete-> execute(array($entree['num_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getNbreMcaFile($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$annee = date('y');

			// if ($id_mod_lic == '1') {
			// 	$entree['masque_date']= '\''.date('y').'EXPDEC%\'';
			// }else if ($id_mod_lic == '2') {
			// 	$entree['masque_date']= '\''.date('y').'DEC%\'';
			// }

			if ($id_mod_lic == '1' && $id_mod_trans!='27') {
				$masque_date= date('y').'EXPDEC';
			}else if ($id_mod_lic == '2' || $id_mod_trans='27') {
				$masque_date= date('y').'DEC';
			}
			
			$sql =' AND ref_dos LIKE "'.$annee.'DEC%"';

			if (isset($_GET['id_mod_trac']) && ($_GET['id_mod_trac']=='1') && isset($_GET['id_march'])) {
				$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE id_cli = ?
														AND id_mod_trans = ?
														AND id_mod_lic = ?
														AND id_march = ?
														AND ref_dos LIKE '$masque_date%'");
				$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], $_GET['id_march']));
			}
			// else if ($id_cli == 883) {
			// 	$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
			// 										FROM dossier
			// 										WHERE id_cli = ?
			// 											AND id_mod_trans = ?
			// 											AND id_mod_lic = ?
			// 											AND id_march = ?
			// 											AND ref_dos LIKE '$masque_date%'");
			// 	$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], $_GET['id_march']));
			// }
			else{
				$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE id_cli = ?
														AND principal = '1'
														-- AND id_mod_trans = ?
														AND id_mod_lic = ?
														AND ref_dos LIKE CONCAT(SUBSTRING(YEAR(CURRENT_DATE()),3,2), 'DEC%')
														-- AND ref_dos LIKE '$masque_date%'
														");
				$requete-> execute(array($entree['id_cli'], /*$entree['id_mod_trans'],*/ $entree['id_mod_lic']));
			}

			
			$reponse=$requete-> fetch();
			if($reponse){
				if ($id_cli == '888' && date('Y')=='2021') {
					return ($reponse['nbre']+1787);
				}else{
					return $reponse['nbre'];
				}
				
			}else{
				return false;
			}
		}

		public function getMaxMcaFile($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$annee = date('y');

			if ($id_mod_lic == '1') {
				$masque_date= date('y').'EXPDEC';
			}else if ($id_mod_lic == '2') {
				$masque_date= date('y').'DEC';
			}

			
			$sql =' AND ref_dos LIKE "'.$annee.'DEC%"';

			$requete = $connexion-> prepare("SELECT MAX(ref_dos) AS ref_dos
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_trans = ?
													AND id_mod_lic = ?
													AND ref_dos LIKE '$masque_date%'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['ref_dos'];	
			}
		}

		public function getNbreDossierEnAttenteCotation($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND etat_feuil_calc = '0'
													AND not_cotation = '0'");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getNbreDossierEnAttenteFacture($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NOT NULL)
														OR (
															id_mod_lic = '2'
															AND not_cotation = '1')
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fact
																WHERE fact.id_t_trans = ?
																	AND fact.ref_fact = det.ref_fact
														)
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getNbreDossierEnAttenteTransmissionFacture($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NULL)
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fact
																WHERE fact.id_t_trans = ?
																	AND fact.ref_fact = det.ref_fact
														)
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getEtatDossierEnAttenteTransmisFacture($id_dos, $page=NULL){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT id_dos
												FROM dossier
												WHERE id_mod_lic = 1
													AND id_dos = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1'
															AND date_trans_fact IS NULL)
														)
													AND date_quit IS NOT NULL AND ref_quit IS NOT NULL
													AND id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fact
																WHERE fact.id_t_trans = 1
																	AND fact.ref_fact = det.ref_fact
														)
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return '<span class="btn-xs clignoteb bg-purple" type="button" onclick="window.location.replace(\'trackingFacture.php?id_cli='.$_GET['id_cli'].'&id_mod_trans='.$_GET['id_mod_trans'].'&id_mod_trac='.$_GET['id_mod_trac'].'&commodity='.$_GET['commodity'].'&statut='.$_GET['statut'].'&id_march='.$_GET['id_march'].'&id_dos='.$reponse['id_dos'].'&page='.$page.'\');">Transmettre pour facturation</span>';
			}else{
				return false;
			}
		}
							

		public function getNbreLicenceEnAttenteFacture($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT COUNT(num_lic) AS nbre
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND num_lic NOT IN (
															SELECT num_lic 
																FROM detail_facture_licence det
														)
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'],));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getNbreDossierEnAttenteFactureTransfertLocal($id_mod_lic, $id_cli, $id_march){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND (
															(etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL
															AND id_util_verif_feuil_calc IS NOT NULL
															AND id_mod_lic = '2')
														OR (
															id_mod_lic = '1')
														)
													AND id_dos NOT IN (
															SELECT det.id_dos 
																FROM detail_facture_dossier det, facture_dossier fact
																WHERE fact.id_t_trans = 6
																	AND fact.ref_fact = det.ref_fact
														)
													AND id_march = ?
													AND not_fact = '0'
													AND id_mod_trans = '6'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_march']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getMcaFile($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$code = '';
			if ($id_mod_trans == '4' && $id_cli == '884' && $id_mod_lic == '1') {
				$mask_transp = 'R';
				if ($id_mod_lic == '1' && $id_mod_trans != '27' && $id_mod_trans != '28') {
					$mod_lic_cod = 'EXP';
				}else{
					$mod_lic_cod = '';
				}

				$nbre = $this->  getNbreMcaFile($id_cli, $id_mod_trans, $id_mod_lic);
				if ($nbre > 200) {

					$i = $nbre-100;
					
				}else{
					$i = 1;
				}

				//$i = $nbre;

				//$a = $this-> getTailleCompteur($i);

				//$code = $this-> getMaxMcaFile($id_cli, $id_mod_trans, $id_mod_lic)+1;

				if($id_mod_trans == '27' || $id_mod_trans == '28'){
					$code_marchandise = NULL;
				}else{
					$code_marchandise = $this-> getCodeModeMarchandise($id_cli, $id_mod_lic, $_GET['id_march']);
				}

				$a = $this-> getTailleCompteur2($i);
				$code = date('y').$mod_lic_cod.'DEC'.$this-> codePourClient($id_cli).$mask_transp.$code_marchandise.$a;

				while($this-> verifierExistanceRefDos2($code) == true){
					$i++;
					$a = $this-> getTailleCompteur2($i);
					$code = date('y').$mod_lic_cod.'DEC'.$this-> codePourClient($id_cli).$mask_transp.$code_marchandise.$a;
				}
			}else{
				if ($id_mod_lic == '1' && $id_mod_trans != '27' && $id_mod_trans != '28') {
					$mod_lic_cod = 'EXP';
				}else{
					$mod_lic_cod = '';
				}

				if ($id_mod_trans == '6') {
					$mask_transp = 'T';
				}else if ($id_mod_trans == '27') {
					$mask_transp = 'V';
				}else if ($id_mod_trans == '28') {
					$mask_transp = 'ECH';
				}else{
					$mask_transp = '';
				}

				$nbre = $this->  getNbreMcaFile($id_cli, $id_mod_trans, $id_mod_lic);
				if ($nbre > 20) {

					$i = $nbre-10;
					
				}else{
					$i = 1;
				}

				//$i = $nbre;

				//$a = $this-> getTailleCompteur($i);

				//$code = $this-> getMaxMcaFile($id_cli, $id_mod_trans, $id_mod_lic)+1;

				if($id_mod_trans == '27' || $id_mod_trans == '28'){
					$code_marchandise = NULL;
				}else{
					$code_marchandise = $this-> getCodeModeMarchandise($id_cli, $id_mod_lic, $_GET['id_march']);
				}

				$a = $this-> getTailleCompteur3($i);
				$code = date('y').$mod_lic_cod.'DEC'.$this-> codePourClient($id_cli).$mask_transp.$code_marchandise.$a;

				while($this-> verifierExistanceRefDos2($code) == true){
					$i++;
					$a = $this-> getTailleCompteur3($i);
					$code = date('y').$mod_lic_cod.'DEC'.$this-> codePourClient($id_cli).$mask_transp.$code_marchandise.$a;
				}
			}

			return $code;

		}

		public function buildReferenceTransmissionApurementModeleLicence($id_mod_lic){
			include('connexion.php');

			$code = '';

			$i = 1;

			$a = $this-> getTailleCompteur2($i);

			$code = $a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');

			while($this-> verifierReferenceTransmissionApurement($code) == true){
				$i++;

				$a = $this-> getTailleCompteur2($i);

				$code = $a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');
			}

			return $code;
		}

		public function buildReferenceBonDepenseModeleLicence($id_mod_lic, $id_cli){
			include('connexion.php');

			$code = '';

			$i = 1;

			$a = $this-> getTailleCompteur2($i);

			$code = 'BD-'.$this-> codePourClient($id_cli).'-'.$a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');

			while($this-> verifierReferenceDepenseDossier($code) == true){
				$i++;

				$a = $this-> getTailleCompteur2($i);

				$code = 'BD-'.$this-> codePourClient($id_cli).'-'.$a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');
			}

			return $code;
		}

		public function buildReferenceTransmissionFactureModeleLicence($id_mod_lic){
			include('connexion.php');

			$code = '';

			$i = 1;

			$a = $this-> getTailleCompteur2($i);

			$code = $a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');

			while($this-> verifierReferenceTransmissionFacture($code) == true){
				$i++;

				$a = $this-> getTailleCompteur2($i);

				$code = $a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');
			}

			return $code;
		}

		public function buildReferenceTransmissionFactureClient($id_cli){
			include('connexion.php');

			$code = '';

			$i = 1;

			$a = $this-> getTailleCompteur2($i);

			if (isset($_GET['id_mod_lic_fact']) && ($_GET['id_mod_lic_fact']==1)) {
				$code_ml = 'EXP';
			}else{
				$code_ml = '';
			}

			$code = $code_ml.$a.$this-> getClient($id_cli)['code_cli'].date('y');

			while($this-> verifierReferenceTransmissionFacture($code) == true){
				$i++;

				$a = $this-> getTailleCompteur2($i);

				$code = $code_ml.$a.$this-> getClient($id_cli)['code_cli'].date('y');
			}

			return $code;
		}

		public function buildReferenceCotationClientModeleLicence($id_cli, $id_mod_lic){
			include('connexion.php');

			//DEC-COT-IB-KCC001-2021

			$code = '';

			$i = 1;

			$a = $this-> getTailleCompteur2($i);

			$code = 'DEC-'.$this-> getClient($id_cli)['code_cli'].$a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');

			while($this-> verifierReferenceCotation($code) == true){
				$i++;

				$a = $this-> getTailleCompteur2($i);

				$code = 'DEC-'.$this-> getClient($id_cli)['code_cli'].$a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');
			}

			return $code;
		}

		public function getNombreMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_trans = ?
													AND id_march = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'],
									$entree['id_march'], $entree['id_mod_lic']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function buildKpiDossier($id_cli, $debut, $fin, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre_dossier
												FROM dossier
												WHERE id_cli = ?
													AND site_arriv BETWEEN  ? AND ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_cli'], $entree['debut'],
									$entree['fin'], $entree['id_mod_lic']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function buildKpiDossierProblemeExclut($id_cli, $debut, $fin, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre_dossier
												FROM dossier
												WHERE id_cli = ?
													AND site_arriv BETWEEN  ? AND ?
													AND id_mod_lic = ?
													AND id_dos NOT IN(
														SELECT id_dos
															FROM dossier
															WHERE (
																	(date_quit IS NULL 
																		AND ref_quit IS NULL
																		AND remarque IS NOT NULL)
																	)
																	OR 
																	(
																		(DATEDIFF(site_arriv, date_quit)<0)
																		AND remarque IS NOT NULL
																	) 

												)");
			$requete-> execute(array($entree['id_cli'], $entree['debut'],
									$entree['fin'], $entree['id_mod_lic']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function buildKpiPreaclearing($id_cli, $debut, $fin, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre_dossier
												FROM dossier
												WHERE id_cli = ?
													AND site_arriv BETWEEN  ? AND ?
													AND (DATEDIFF(site_arriv, date_quit) >= 0)
													AND date_quit IS NOT NULL
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_cli'], $entree['debut'],
									$entree['fin'], $entree['id_mod_lic']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function buildKpiLeadtime($id_cli, $debut, $fin, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT ROUND(AVG(DATEDIFF(date_quit, date_preal)),2) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND site_arriv BETWEEN  ? AND ?
													AND (DATEDIFF(date_quit, date_preal) >= 0)
													AND date_quit IS NOT NULL
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_cli'], $entree['debut'],
									$entree['fin'], $entree['id_mod_lic']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function buildKpiLeadtimeExclutDossierProbleme($id_cli, $debut, $fin, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT ROUND(AVG(DATEDIFF(date_quit, date_preal)),2) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND site_arriv BETWEEN  ? AND ?
													AND (DATEDIFF(date_quit, date_preal) >= 0)
													AND date_quit IS NOT NULL
													AND id_mod_lic = ?
													AND id_dos NOT IN(
														SELECT id_dos
															FROM dossier
															WHERE (
																	(date_quit IS NULL 
																		AND ref_quit IS NULL
																		AND probleme = '1')
																	)
																	OR 
																	(
																		(DATEDIFF(site_arriv, date_quit)<0)
																		AND probleme = '1'
																	) 

												)");
			$requete-> execute(array($entree['id_cli'], $entree['debut'],
									$entree['fin'], $entree['id_mod_lic']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $compteur, $step=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$code = '';
			$nbre = $this-> getNombreMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic);
			if ($nbre > 20) {
				$i = $nbre-10;
			}else{
				$i = $compteur;
			}



			$code_marchandise = $this-> getCodeModeMarchandise($id_cli, $id_mod_lic, $id_march);
			//$code_2_marchandise = $this-> getCode2ModeMarchandise($id_cli, $id_mod_lic, $id_march);

			$cod_mod_trans = '';

			if ($id_mod_trans == '4') {
				$cod_mod_trans = $this-> getCodeModeTransport($id_mod_trans);
			}else if ($id_mod_trans == '5') {
				$cod_mod_trans = $this-> getCodeModeTransport($id_mod_trans);
			}

			if ($id_cli == 869 && $id_march == 6 && $id_mod_lic == 2) {
				$a = $this-> getTailleCompteur2($i);
				$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'-'.date('y').'-'.$cod_mod_trans.$a;
			}else{
				$a = $this-> getTailleCompteur($i);
				$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$a;
			}

			while($this-> verifierExistanceMCAFile($code) == true){
				$i++;

				if ($id_cli == 869 && $id_march == 6 && $id_mod_lic == 2) {
					$a = $this-> getTailleCompteur2($i);
					$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'-'.date('y').'-'.$cod_mod_trans.$a;
				}else{
					$a = $this-> getTailleCompteur($i);
					$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$a;
				}

			}

			if (isset($step)) {
				//$a = $this-> getTailleCompteur($a+$step);
				//$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$a;
				if ($id_cli == 869 && $id_march == 6 && $id_mod_lic == 2) {
					$a = $this-> getTailleCompteur2($a+$step);
					$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'-'.date('y').'-'.$cod_mod_trans.$a;
				}else{
					$a = $this-> getTailleCompteur($a+$step);
					$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$a;
				}

			}

			return $code;
		}

		public function getMcaFileImport($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$code = '';
			$i = 1;

			$a = $this-> getTailleCompteur3($i);
			$code = date('y').'DEC'.$this-> codePourClient($id_cli).$a;

			while($this-> verifierExistanceRefDos2($code) == true){
				$i++;
				$a = $this-> getTailleCompteur3($i);
				$code = date('y').'DEC'.$this-> codePourClient($id_cli).$a;
			}

			return $code;
		}

		public function buildRefFactureGlobale($id_cli, $id_t_trans=NULL){
			include('connexion.php');

			if (isset($id_cli) && ($id_cli!=null)) {

				$entree['id_cli'] = $id_cli;
				$code = '';

				if ($id_cli == 883 && isset($_GET['id_mod_lic_fact']) && ($_GET['id_mod_lic_fact']=='2')) {
					
					$i = 1;
					$a = $this-> getTailleCompteur3($i);
					$code = 'DEC'.$this-> codePourClient($id_cli).date('y').$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur3($i);

						$code = 'DEC'.$this-> codePourClient($id_cli).date('y').$a;
					}

				}else if ($id_cli == 883 && isset($_GET['id_mod_lic_fact']) && ($_GET['id_mod_lic_fact']=='1')) {
					
					$i = 1;
					$a = $this-> getTailleCompteur($i);

					if (isset($id_t_trans) && ($id_t_trans!='')) {
						$code_2 = 'T';
					}else{
						$code_2 = 'EX';
					}

					$code = 'DEC'.$this-> codePourClient($id_cli).$code_2.date('y').$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur($i);

						$code = 'DEC'.$this-> codePourClient($id_cli).$code_2.date('y').$a;
					}

				}else if ($_GET['id_mod_lic_fact']=='1') {
					
					// $i = $this-> getClient($id_cli)['compt_fact'];

					// $a = $this-> getTailleCompteur3($i);
					// $code = 'DEC'.$this-> codePourClient($id_cli).$a;

					// while($this-> verifierExistanceRefFactureDossier($code) == true){
					// 	$i++;

					// 	$a = $this-> getTailleCompteur3($i);

					// 	$code = 'DEC'.$this-> codePourClient($id_cli).$a;
					// }



					$i = 1;
					$a = $this-> getTailleCompteur3($i);
					$code = date('y').'DEC'.$this-> codePourClient($id_cli).'E'.$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur3($i);

						$code = date('y').'DEC'.$this-> codePourClient($id_cli).'E'.$a;
					}

				}else{

					$i = 1;
					$a = $this-> getTailleCompteur3($i);
					$code = date('y').'DEC'.$this-> codePourClient($id_cli).$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur3($i);

						$code = date('y').'DEC'.$this-> codePourClient($id_cli).$a;
					}
				}

				return $code;

			}else{

				return null;

			}

		}

		public function buildRefFactureGlobale2($id_cli, $id_mod_lic=NULL){
			include('connexion.php');

			if (isset($id_cli) && ($id_cli!=null)) {

				$entree['id_cli'] = $id_cli;
				$code = '';

				if ($id_cli == 883 && isset($_GET['id_mod_lic_fact']) && ($_GET['id_mod_lic_fact']=='2')) {
					
					$i = 1;
					$a = $this-> getTailleCompteur3($i);
					$code = 'DEC'.$this-> codePourClient($id_cli).date('y').$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur3($i);

						$code = 'DEC'.$this-> codePourClient($id_cli).date('y').$a;
					}

				}else if ($id_cli == 883 && isset($_GET['id_mod_lic_fact']) && ($_GET['id_mod_lic_fact']=='1')) {
					
					$i = 1;
					$a = $this-> getTailleCompteur($i);

					if (isset($id_t_trans) && ($id_t_trans!='')) {
						$code_2 = 'T';
					}else{
						$code_2 = 'EX';
					}

					$code = 'DEC'.$this-> codePourClient($id_cli).$code_2.date('y').$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur($i);

						$code = 'DEC'.$this-> codePourClient($id_cli).$code_2.date('y').$a;
					}

				}else if ($id_mod_lic=='1') {
					
					// $i = $this-> getClient($id_cli)['compt_fact'];

					// $a = $this-> getTailleCompteur3($i);
					// $code = 'DEC'.$this-> codePourClient($id_cli).$a;

					// while($this-> verifierExistanceRefFactureDossier($code) == true){
					// 	$i++;

					// 	$a = $this-> getTailleCompteur3($i);

					// 	$code = 'DEC'.$this-> codePourClient($id_cli).$a;
					// }



					$i = 1;
					$a = $this-> getTailleCompteur3($i);
					$code = date('y').'DEC'.$this-> codePourClient($id_cli).'E'.$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur3($i);

						$code = date('y').'DEC'.$this-> codePourClient($id_cli).'E'.$a;
					}

				}else{

					$i = 1;
					$a = $this-> getTailleCompteur3($i);
					$code = date('y').'DEC'.$this-> codePourClient($id_cli).$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur3($i);

						$code = date('y').'DEC'.$this-> codePourClient($id_cli).$a;
					}
				}

				return $code;

			}else{

				return null;

			}

		}

		public function buildRefFactureGlobaleAjax($id_cli, $id_mod_lic, $id_t_trans=NULL){
			include('connexion.php');

			if (isset($id_cli) && ($id_cli!=null)) {

				$entree['id_cli'] = $id_cli;
				$code = '';

				if ($id_cli == 883 && isset($id_mod_lic) && ($id_mod_lic=='2')) {
					
					$i = 1;
					$a = $this-> getTailleCompteur3($i);
					$code = 'DEC'.$this-> codePourClient($id_cli).date('y').$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur3($i);

						$code = 'DEC'.$this-> codePourClient($id_cli).date('y').$a;
					}

				}else if ($id_cli == 883 && isset($id_mod_lic) && ($id_mod_lic=='1')) {
					
					$i = 1;
					$a = $this-> getTailleCompteur($i);

					if (isset($id_t_trans) && ($id_t_trans!='')) {
						$code_2 = 'T';
					}else{
						$code_2 = 'EX';
					}

					$code = 'DEC'.$this-> codePourClient($id_cli).$code_2.date('y').$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur($i);

						$code = 'DEC'.$this-> codePourClient($id_cli).$code_2.date('y').$a;
					}

				}else if ($id_mod_lic=='1') {
					
					// $i = $this-> getClient($id_cli)['compt_fact'];

					// $a = $this-> getTailleCompteur3($i);
					// $code = 'DEC'.$this-> codePourClient($id_cli).$a;

					// while($this-> verifierExistanceRefFactureDossier($code) == true){
					// 	$i++;

					// 	$a = $this-> getTailleCompteur3($i);

					// 	$code = 'DEC'.$this-> codePourClient($id_cli).$a;
					// }



					$i = 1;
					$a = $this-> getTailleCompteur3($i);
					$code = date('y').'DEC'.$this-> codePourClient($id_cli).'E'.$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur3($i);

						$code = date('y').'DEC'.$this-> codePourClient($id_cli).'E'.$a;
					}

				}else{

					$i = 1;
					$a = $this-> getTailleCompteur3($i);
					$code = date('y').'DEC'.$this-> codePourClient($id_cli).$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true || !empty($this-> getDossierFactureDec($code))){
						$i++;

						$a = $this-> getTailleCompteur3($i);

						$code = date('y').'DEC'.$this-> codePourClient($id_cli).$a;
					}
				}

				return $code;

			}else{

				return null;

			}

		}

		public function getNbreFactureRefFact($ref_fact){
			include('connexion.php');

			$entree['ref_fact'] = '"%'.$ref_fact.'%"';


			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre
												FROM facture_dossier
												WHERE ref_fact LIKE ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function buildRefNoteDebit($ref_fact){
			include('connexion.php');

			if (isset($ref_fact) && ($ref_fact!=null)) {

				//$entree['id_cli'] = $id_cli;
				$code = '';

				$i = 1;
				//$a = $this-> getTailleCompteur3($i);
				if ($this-> getNbreFactureRefFact($ref_fact)>5) {

					$a = $this-> getNbreFactureRefFact($ref_fact)-2;

				}else if ($this-> getNbreFactureRefFact($ref_fact)==0) {

					$a = 1;

				}else{

					$a = $this-> getNbreFactureRefFact($ref_fact);

				}
				
				$code = $a.'-'.$ref_fact;

				while($this-> verifierExistanceRefFactureDossier($code) == true){
					$i++;

					$a = $i;

					$code = $a.'-'.$ref_fact;
				}
			
				return $code;

			}else{

				return null;

			}

		}

		/*public function getMcaFileExportData($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $compteur){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$code = '';

			$i = $compteur;

			$a = $this-> getTailleCompteur($i);

			$code_marchandise = $this-> getCodeModeMarchandise($id_cli, $id_mod_lic, $id_march);

			$cod_mod_trans = '';

			if ($id_mod_trans == '4') {
				$cod_mod_trans = $this-> getCodeModeTransport($id_mod_trans);
			}

			$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$a;

			while($this-> verifierExistanceMCAFile($code) == true){
				$i++;

				$a = $this-> getTailleCompteur($i);

				$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$a;
			}

			return $code;
		}*/

		public function getCodeModeTransport($id_mod_trans){
			include('connexion.php');
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT UPPER(cod_mod_trans) AS cod_mod_trans
												FROM mode_transport
												WHERE id_mod_trans = ?");
			$requete-> execute(array($entree['id_mod_trans']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['cod_mod_trans'];
			}
		}

		public function getCodeModeMarchandise($id_cli, $id_mod_lic, $id_march){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("SELECT code
												FROM affectation_marchandise_client_modele_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_march = ?
													AND active = '1'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['code'];
			}
		}

		public function getCode2ModeMarchandise($id_cli, $id_mod_lic, $id_march){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("SELECT code_2
												FROM affectation_marchandise_client_modele_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_march = ?
													AND active = '1'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['code_2'];
			}
		}

		public function getNom($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT UPPER(nom_util) AS nom_util
												FROM utilisateur
												WHERE id_util = ?");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_util'];
			}
		}

		// public function getNombreDocumentDossier($id_dos){
		// 	include('connexion.php');
		// 	$entree['id_dos'] = $id_dos;
		// 	$plis = 0;
		// 	if($this-> verifierPlisBP($this-> getDossier($id_dos)['num_bp'], $this-> getDossier($id_dos)['id_cli'])){
		// 		$plis++;
		// 	}

		// 	$requete = $connexion-> prepare("SELECT COUNT(id_doc) AS nbre
		// 										FROM dossier_document
		// 										WHERE id_dos = ?");
		// 	$requete-> execute(array($entree['id_dos']));
		// 	$reponse = $requete-> fetch();
		// 	if($reponse){
		// 		return $reponse['nbre']+$plis;
		// 	}else{
		// 		return $plis;
		// 	}
		// }

		public function getNombreDocumentDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$plis = 0;
			if($this-> verifierPlisBP($this-> getDossier($id_dos)['num_bp'], $this-> getDossier($id_dos)['id_cli'])){
				$plis++;
			}
			
			$compteur = $plis;
			$requete = $connexion-> prepare("SELECT *
											FROM dossier_document
											WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));


			while($reponse = $requete-> fetch()){
				if($this-> getDocumentForDossier($id_dos, $reponse['id_doc']) != '0' && file_exists('../documents/'.$this-> getDossier($id_dos)['ref_dos'].'/'.$this-> getDocumentForDossier($id_dos, $reponse['id_doc']))){
						$compteur++;
				}
				
			}$requete-> closeCursor();
			
			return $compteur;
		}

		public function getNombreClientEtat($etat_cli){
			include('connexion.php');
			$entree['etat_cli'] = $etat_cli;

			$requete = $connexion-> prepare("SELECT COUNT(id_cli) AS nbre
												FROM client
												WHERE etat_cli = ?");
			$requete-> execute(array($entree['etat_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return '0';
			}
		}

		public function getNomModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT UPPER(nom_mod_lic) AS nom_mod_lic
												FROM modele_licence
												WHERE id_mod_lic = ?");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_mod_lic'];
			}
		}

		public function getValeurClient(){
			include('connexion.php');
			//$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> query("SELECT SUM((affectation_client_domaine.volume*affectation_client_domaine.honnoraire*(affectation_client_domaine.target_init/100))) AS valeur
												FROM client, affectation_client_domaine
												WHERE client.id_cli = affectation_client_domaine.id_cli");
			//$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['valeur'];
			}
		}

		public function getWeekendsAndHolidays($debut, $fin){
			include('connexion.php');
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			$requete = $connexion-> prepare("SELECT COUNT(id) AS nbre
												FROM time_dimension
												WHERE (weekend_flag = '1'
													OR holiday_flag = '1')
													AND la_date BETWEEN ? AND ?");
			$requete-> execute(array($entree['debut'], $entree['fin']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT *, UPPER(cl.etat_cli) AS etat_cli_maj,
													IF(cl.actif=1, 'Actif', 'Non-Actif') AS label_actif
												FROM client cl
												WHERE cl.id_cli = ?");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getClientModeleLicence($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM affectation_client_modele_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLastLicenceClient($id_cli, $id_mod_lic, $id_mod_trans, $id_march=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			if ( ($id_mod_lic==1) && (isset($id_march) && ($id_march!=NULL))) {
				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_march = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC
												LIMIT 0, 1");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
				# code...
			}else{

				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC
												LIMIT 0, 1");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			}

			/*$requete = $connexion-> prepare("SELECT *
												FROM licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
												ORDER BY date_creat_lic DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));*/
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLastLicenceClientActive($id_cli, $id_mod_lic, $id_mod_trans, $id_march=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			if ( ($id_mod_lic==1) && (isset($id_march) && ($id_march!=NULL))) {
				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_march = ?
													AND id_mod_trans = ?
													AND affichier_tracking = '1'
												ORDER BY date_creat_lic  DESC
												LIMIT 0, 1");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
				# code...
			}else{

				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC
												LIMIT 0, 1");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			}

			/*$requete = $connexion-> prepare("SELECT *
												FROM licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
												ORDER BY date_creat_lic DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));*/
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getIdClient($nom_cli){
			include('connexion.php');
			$entree['nom_cli'] = $nom_cli;

			$requete = $connexion-> prepare("SELECT *
												FROM client
												WHERE nom_cli = ?");
			$requete-> execute(array($entree['nom_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_cli'];
			}
		}

		public function getIdDossierClientLicence($ref_dos, $id_cli, $num_lic){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['id_cli'] = $id_cli;
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT id_dos
												FROM dossier
												WHERE ref_dos = ?
													AND id_cli = ?
													AND num_lic = ?");
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_dos'];
			}
		}

		public function getIdMonnaie($sig_mon){
			include('connexion.php');
			$entree['sig_mon'] = $sig_mon;

			$requete = $connexion-> prepare("SELECT *
												FROM monnaie
												WHERE sig_mon = ?");
			$requete-> execute(array($entree['sig_mon']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_mon'];
			}else{
				return false;
			}
		}

		public function getStructureTracking($id_march){
			include('connexion.php');
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("SELECT id_struct
												FROM marchandise
												WHERE id_march = ?");
			$requete-> execute(array($entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_struct'];
			}
		}

		public function getDataFactureDossier($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_fact, '%d/%m/%Y') AS date_fact
												FROM facture_dossier
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getNumLotFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT d.num_lot AS num_lot
												FROM facture_dossier fd, detail_facture_dossier det, dossier d
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['num_lot'];
			}
		}

		public function getDataFeuilleCalculDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(DATE_ADD(d.date_feuil_calc, INTERVAL 2 hour), '%d/%m/%Y %H:%i:%s') AS date_feuil_calc,
													u.nom_util AS nom_util,
													IF(d.date_verif_feuil_calc IS NOT NULL, u.nom_util, '') AS verificateur,
													IF(d.date_verif_feuil_calc IS NOT NULL, DATE_FORMAT(d.date_verif_feuil_calc, '%d/%m%/%Y'), '') AS date_verif
												FROM dossier d, utilisateur u
												WHERE d.id_dos = ?
													AND d.id_util_feuil_calc = u.id_util");
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataFeuilleCalculDossier2($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.date_feuil_calc, '%d/%m%/%Y') AS date_feuil_calc,
													u.nom_util AS nom_util,
													IF(d.date_verif_feuil_calc IS NOT NULL, u.nom_util, '') AS verificateur,
													IF(d.date_verif_feuil_calc IS NOT NULL, DATE_FORMAT(DATE_ADD(d.date_verif_feuil_calc, INTERVAL 2 hour), '%d/%m/%Y %H:%i:%s'), '') AS date_verif
												FROM dossier d, utilisateur u
												WHERE d.id_dos = ?
													AND d.id_util_verif_feuil_calc = u.id_util");
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataCotationRef($ref_cot){
			include('connexion.php');
			$entree['ref_cot'] = $ref_cot;

			$requete = $connexion-> prepare("SELECT *
												FROM cotation
												WHERE ref_cot = ?");
			$requete-> execute(array($entree['ref_cot']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getAllDataCotation($id_cot){
			include('connexion.php');
			$entree['id_cot'] = $id_cot;

			$requete = $connexion-> prepare("SELECT cot.*, DATE_FORMAT(cot.date_cot, '%d/%m/%Y') AS date_cot,
													dos.ref_dos AS ref_dos,
													cli.code_cli AS code_cli,
													cli.nom_cli AS nom_cli,
													march.nom_march AS nom_march,
													dos.supplier AS nom_four,
													dos.poids AS poids,
													ml.nom_mod_lic AS transit,
													(IF(dos.fob IS NULL, 0, dos.fob)+IF(dos.fret IS NULL, 0, dos.fret)+IF(dos.assurance IS NULL, 0, dos.assurance)+IF(dos.autre_frais IS NULL, 0, dos.autre_frais)) AS cif
												FROM cotation cot, dossier dos, client cli, marchandise march, modele_licence ml
												WHERE cot.id_cot = ?
													AND cot.id_dos = dos.id_dos
													AND dos.id_cli = cli.id_cli
													AND dos.id_march = march.id_march
													AND dos.id_mod_lic = ml.id_mod_lic");
			$requete-> execute(array($entree['id_cot']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLicenceFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT num_lic
												FROM licence
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['num_lic'];
			}
		}

		public function getLicenceApuree($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT num_lic
												FROM licence
												WHERE num_lic = ?
													AND apurement = '1'");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['num_lic'];
			}
		}

		public function getIdDocumentAppurement($fichier_doc, $id_util){
			include('connexion.php');
			$entree['fichier_doc'] = $fichier_doc;
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT id_doc
												FROM document_appurement
												WHERE fichier_doc = ?
													AND id_util = ?
												ORDER BY id_doc DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['fichier_doc'], $entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_doc'];
			}
		}

		public function getLastIdDocumentAppurement($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT id_doc
												FROM document_appurement
												WHERE id_util = ?
												ORDER BY id_doc DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_doc'];
			}
		}

		public function getLastIdTicket($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT id_tick
												FROM ticket
												WHERE id_util_emet = ?
												ORDER BY id_tick DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_tick'];
			}
		}

		public function getLastTauxEchange(){
			include('connexion.php');
			//$entree['id_util'] = $id_util;

			$requete = $connexion-> query("SELECT *
												FROM taux_echange
												ORDER BY id_taux_e DESC
												LIMIT 0, 1");
			//$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT l.*, cl.*, IF(l.poids IS NULL, '0', l.poids) AS poids_lic
												FROM licence l, client cl
												WHERE l.num_lic = ?
													AND l.id_cli = cl.id_cli");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}else{
				return null;
			}
		}

		public function getLicenceSousTypeModePaiement($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT l.*, cl.*, s.id_sous_type_paie AS id_sous_type_paie,
													CONCAT(s.code,' - ',UPPER(s.nom_sous_type_paie)) AS nom_sous_type_paie,
													CONCAT(m.code,' - ',UPPER(m.nom_mod_paie)) AS nom_mod_paie,
													m.id_mod_paie AS id_mod_paie
												FROM licence l, client cl, sous_type_paiement s, modalite_paiement m
												WHERE l.num_lic = ?
													AND l.id_cli = cl.id_cli
													AND l.id_sous_type_paie = s.id_sous_type_paie
													AND l.id_mod_paie = m.id_mod_paie");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}else{
				return null;
			}
		}

		public function getLicence2($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM licence
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT l.*, m.*, (l.fob+l.fret+l.assurance+l.autre_frais) AS cif,
													DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
												FROM licence l, monnaie m
												WHERE l.num_lic = ?
													AND l.id_mon = m.id_mon");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataLicence2($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT l.*, m.*, (l.fob+l.fret+l.assurance+l.autre_frais) AS cif
												FROM licence l, monnaie m
												WHERE l.num_lic = ?
													AND l.id_mon = m.id_mon");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDateExpirationLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(date_exp, '%d/%m/%Y') AS date_exp
												FROM expiration_licence
												WHERE num_lic = ?
												ORDER BY id_date_exp DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['date_exp'];
			}
		}

		public function getDateExpirationLicence2($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT DATE(date_exp) AS date_exp
												FROM expiration_licence
												WHERE num_lic = ?
												ORDER BY id_date_exp DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['date_exp'];
			}
		}

		public function getNomModeTransport($id_mod_trans){
			include('connexion.php');
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT UPPER(nom_mod_trans) AS nom_mod_trans
												FROM mode_transport
												WHERE id_mod_trans = ?");
			$requete-> execute(array($entree['id_mod_trans']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_mod_trans'];
			}
		}

		
		public function getEmballage($id_emb){
			include('connexion.php');
			$entree['id_emb'] = $id_emb;

			$requete = $connexion-> prepare("SELECT *, UPPER(nom_emb) AS nom_emb
												FROM emballage
												WHERE id_emb = ?");
			$requete-> execute(array($entree['id_emb']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getSommeFobLicence($num_lic){
			include('connexion.php');

			$num_lic = substr($num_lic, 0, 10);
			
			$entree['num_lic'] = '%'.$num_lic.'%';

			// if ( $this-> getLicence($num_lic)['tonnage'] == '1') {

			// 	$requete = $connexion-> prepare("SELECT SUM(poids) AS fob
			// 										FROM dossier
			// 										WHERE num_lic LIKE ?");

			// }else{

				$requete = $connexion-> prepare("SELECT SUM(fob) AS fob
													FROM marchandise_dossier
													WHERE num_lic LIKE ?");
			// }

			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['fob'];
			}
		}

		public function getUtilisateur($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare('SELECT u.*, r.*,
													IF(u.tracking_delete="1", "Activer", "Désactiver") AS label_tracking_delete,
													IF(u.tracking_log="1", "Activer", "Désactiver") AS label_tracking_log,
													IF(u.val_cotation_valide="1", "Activer", "Désactiver") AS label_val_cotation_valide,
													IF(u.ret_cotation_valide="1", "Activer", "Désactiver") AS label_ret_cotation_valide,
													IF(u.validation_facture="1", "Activer", "Désactiver") AS label_validation_facture,
													IF(u.active="1", "Actif", "Non-Actif") AS label_active,
													IF(u.active="1", "bg bg-primary", "bg bg-danger") AS class_active
												FROM utilisateur u, role r
												WHERE u.id_util = ?
													AND u.id_role = r.id_role');
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }

		public function getAdresseMailTransmis($id_trans_ap, $mail){
			include('connexion.php');
			
			$entree['id_trans_ap'] = $id_trans_ap;

			$adresse_mail = '';
			
			$requete = $connexion-> prepare('SELECT adr.adresse_mail AS adresse_mail
														FROM adresse_mail_transmis adr, client cl, transmission_apurement tr
														WHERE tr.id_trans_ap = ?
															AND tr.id_cli = cl.id_cli
															AND cl.id_cli = adr.id_cli
															AND adr.id_mod_lic = tr.id_mod_lic');
			$requete-> execute(array($entree['id_trans_ap']));
			while($reponse = $requete-> fetch()){
				$mail->addAddress($reponse['adresse_mail']);
			}$requete-> closeCursor();

		}

		public function getNombreStatutClient($id_cli, $date_deb, $date_fin, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['date_deb'] = $date_deb;
			$entree['date_fin'] = $date_fin;
			$entree['id_mod_lic'] = $id_mod_lic;

			// TR8
			$requete = $connexion-> prepare('SELECT COUNT(*) AS nbre_tr8
												FROM dossier
												WHERE id_cli = ?
													AND tr8_date BETWEEN ? AND ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['date_deb'], $entree['date_fin'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			$return['nbre_tr8'] = $reponse['nbre_tr8'];


			// T1
			$requete = $connexion-> prepare('SELECT COUNT(*) AS nbre_t1
												FROM dossier
												WHERE id_cli = ?
													AND t1_date BETWEEN ? AND ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['date_deb'], $entree['date_fin'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			$return['nbre_t1'] = $reponse['nbre_t1'];


			// BS T1
			$requete = $connexion-> prepare('SELECT COUNT(*) AS nbre_bs_t1
												FROM dossier
												WHERE id_cli = ?
													AND bs_t1_date BETWEEN ? AND ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['date_deb'], $entree['date_fin'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			$return['nbre_bs_t1'] = $reponse['nbre_bs_t1'];


			// bfu
			$requete = $connexion-> prepare('SELECT COUNT(*) AS nbre_bfu
												FROM dossier
												WHERE id_cli = ?
													AND bfu BETWEEN ? AND ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['date_deb'], $entree['date_fin'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			$return['nbre_bfu'] = $reponse['nbre_bfu'];


			// escort
			$requete = $connexion-> prepare('SELECT COUNT(*) AS nbre_escort
												FROM dossier
												WHERE id_cli = ?
													AND escort_pyt_date BETWEEN ? AND ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['date_deb'], $entree['date_fin'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			$return['nbre_escort'] = $reponse['nbre_escort'];


			// border
			$requete = $connexion-> prepare('SELECT COUNT(*) AS nbre_border
												FROM dossier
												WHERE id_cli = ?
													AND (
															(tr8_date BETWEEN ? AND ?)
															OR
															(t1_date BETWEEN ? AND ?)
															OR
															(bs_t1_date BETWEEN ? AND ?)
															OR
															(bfu BETWEEN ? AND ?)
															OR
															(escort_pyt_date BETWEEN ? AND ?)
														)
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['date_deb'], $entree['date_fin'], $entree['date_deb'], $entree['date_fin'], $entree['date_deb'], $entree['date_fin'], $entree['date_deb'], $entree['date_fin'], $entree['date_deb'], $entree['date_fin'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			$return['nbre_border'] = $reponse['nbre_border'];

			// Im4
			$requete = $connexion-> prepare('SELECT COUNT(*) AS nbre_im4
												FROM dossier
												WHERE id_cli = ?
													AND date_decl BETWEEN ? AND ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['date_deb'], $entree['date_fin'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			$return['nbre_im4'] = $reponse['nbre_im4'];

			// Liquidation
			$requete = $connexion-> prepare('SELECT COUNT(*) AS nbre_liquidation
												FROM dossier
												WHERE id_cli = ?
													AND date_liq BETWEEN ? AND ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['date_deb'], $entree['date_fin'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			$return['nbre_liquidation'] = $reponse['nbre_liquidation'];

			// Quittance
			$requete = $connexion-> prepare('SELECT COUNT(*) AS nbre_quittance
												FROM dossier
												WHERE id_cli = ?
													AND date_quit BETWEEN ? AND ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['date_deb'], $entree['date_fin'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			$return['nbre_quittance'] = $reponse['nbre_quittance'];

			return $return;

        }

		public function getSommeFobLicenceExport($num_lic){
			include('connexion.php');
			
			$entree['num_lic'] = '%'.substr($num_lic, 0, 10).'%';

			$requete = $connexion-> prepare("SELECT SUM(montant_decl) AS montant_decl
													FROM dossier
													WHERE num_lic LIKE ?");

			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['montant_decl'];
			}
		}

		public function getSommePoidsLicenceExport($num_lic){
			include('connexion.php');
			
			$entree['num_lic'] = '%'.substr($num_lic, 0, 10).'%';

			$requete = $connexion-> prepare("SELECT SUM(poids) AS poids
													FROM dossier
													WHERE num_lic LIKE ?");

			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['poids'];
			}
		}

		public function getSommePoidsLicence($num_lic){
			include('connexion.php');
			
			$entree['num_lic'] = '%'.substr($num_lic, 0, 10).'%';

			$requete = $connexion-> prepare("SELECT SUM(poids) AS poids
													FROM marchandise_dossier
													WHERE num_lic LIKE ?");

			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['poids'];
			}
		}

		public function getSommeCIFLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT SUM(IFNULL(fob, 0)+IFNULL(fret, 0)+IFNULL(assurance, 0)+IFNULL(autre_frais, 0)) AS cif
												FROM dossier
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['cif'];
			}
		}

		public function getSommeDepenseDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(montant) AS montant
												FROM depense_dossier
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['montant'];
			}
		}

		public function getSommeDepenseClient($id_cli, $id_mod_lic, $id_mod_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT SUM(montant) AS montant
												FROM affectation_depense_client
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_mod_trans = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['montant'];
			}
		}

		public function getSommeFobAppureLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT SUM(d.fob) AS fob
												FROM dossier d
												WHERE d.num_lic = ?
													AND d.id_dos IN(
														SELECT id_dos FROM appurement_licence
													)
												");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['fob'];
			}
		}

		public function getSommeQteLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT SUM(qte_decl) AS qte_decl
												FROM dossier
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['qte_decl'];
			}
		}

		public function getNbreDossierLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = '%'.substr($num_lic, 0, 10).'%';

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(id_dos)) AS nbre
												FROM marchandise_dossier
												WHERE num_lic LIKE ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNbreDossierLicenceExport($num_lic){
			include('connexion.php');
			$entree['num_lic'] = '%'.substr($num_lic, 0, 10).'%';

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(id_dos)) AS nbre
												FROM dossier
												WHERE num_lic LIKE ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getMarchandiseLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare('SELECT UPPER(m.nom_march) AS nom_march
												FROM licence l, marchandise m
												WHERE l.num_lic = ?
													AND l.id_march = m.id_march');
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_march'];
			}
		}

		public function getMarchandise($id_march){
			include('connexion.php');
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare('SELECT UPPER(m.nom_march) AS nom_march
												FROM marchandise m
												WHERE m.id_march = ?');
			$requete-> execute(array($entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_march'];
			}
		}

		public function getLastEpirationLicence($num_lic){
			include("connexion.php");
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(date_exp, '%d/%m/%Y') AS date_exp
												FROM expiration_licence
												WHERE num_lic = ?
												ORDER BY id_date_exp DESC LIMIT 0, 1");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();

			// return $reponse['date_exp'];
			if ($reponse) {
				return $reponse['date_exp'];
			}else{
				return null;
			}
		}

		public function getLastEpirationLicence2($num_lic){
			include("connexion.php");
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT date_exp
												FROM expiration_licence
												WHERE SUBSTRING(num_lic, 1, 10) = SUBSTRING(?, 1, 10)
												ORDER BY id_date_exp DESC LIMIT 0, 1");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();

			return $reponse['date_exp'];
		}

		public function getElementFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare('SELECT cl.id_cli AS id_cli,
													UPPER(cl.nom_cli) AS nom_cli,
													f.date_fact AS date_fact,
													f.date_fact_rec AS date_fact_rec,
													f.fournisseur AS fournisseur,
													f.date_val AS date_val,
													f.ref_fact AS ref_fact,
													f.commodity AS commodity,
													f.montant_fact AS montant_fact,
													f.fret_fact AS fret_fact,
													f.assurance_fact AS assurance_fact,
													f.autre_frais_fact AS autre_frais_fact,
													m.id_mon AS id_mon,
													m.sig_mon AS sig_mon,
													f.fichier_fact AS fichier_fact
												FROM facture_licence f, client cl, monnaie m
												WHERE f.ref_fact = ?
													AND f.id_cli = cl.id_cli
													AND f.id_mon = m.id_mon');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }

		public function getElementModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT id_mod_lic,
													UPPER(nom_mod_lic) AS nom_mod_lic,
													sigle_mod_lic
												FROM modele_licence
												WHERE id_mod_lic = ?');
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }

		public function getElementMarchandise($id_march){
			include('connexion.php');
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare('SELECT id_march,
													UPPER(nom_march) AS nom_march
												FROM marchandise
												WHERE id_march = ?');
			$requete-> execute(array($entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }

		public function getElementClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare('SELECT *, id_cli,
													UPPER(nom_cli) AS nom_cli
												FROM client
												WHERE id_cli = ?');
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }

		public function getNomClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare('SELECT nom_cli AS nom_cli
												FROM client
												WHERE id_cli = ?');
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_cli'];
			}
        }

		public function getNomTypeLicence($id_type_lic){
			include('connexion.php');
			$entree['id_type_lic'] = $id_type_lic;

			$requete = $connexion-> prepare('SELECT UPPER(nom_type_lic) AS nom_type_lic
												FROM type_licence
												WHERE id_type_lic = ?');
			$requete-> execute(array($entree['id_type_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_type_lic'];
			}
        }

		public function getIdRoleUtilisateur($id){
			include('connexion.php');
			$entree['id'] = $id;

			$requete = $connexion-> prepare('SELECT r.id_role AS id_role
												FROM utilisateur u, role r
												WHERE u.id_util = ?
													AND u.id_role = r.id_role');
			$requete-> execute(array($entree['id']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_role'];
			}
        }

		public function getNomRoleUtilisateur($id){
			include('connexion.php');
			$entree['id'] = $id;

			$requete = $connexion-> prepare('SELECT r.nom_role AS nom
												FROM utilisateur u, role r
												WHERE u.id_util = ?
													AND u.id_role = r.id_role');
			$requete-> execute(array($entree['id']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom'];
			}
		}

		public function getNombreLicenceModele($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT COUNT(num_lic) AS nbre
												FROM licence
												WHERE id_mod_lic = ?');
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmissionApurement($id_mod_lic, $id_cli, $id_type_apur=1){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;

			$sqlClient = "";
			$sqlClient2 = "";

			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND ta.id_trans_ap IN(
									SELECT DISTINCT(det.id_trans_ap) AS id_trans_ap
										FROM detail_apurement det, dossier d
										WHERE det.id_dos = d.id_dos
											AND d.id_cli = "'.$id_cli.'") ';
				$sqlClient2 = ' OR ta.id_trans_ap IN(
									SELECT DISTINCT(det.id_trans_ap) AS id_trans_ap
										FROM detail_apurement det, dossier d, licence l
										WHERE det.id_dos = d.id_dos
											AND d.num_lic = l.num_lic
											AND l.id_cli = "'.$id_cli.'") ';
											
			}

			$requete = $connexion-> prepare("SELECT COUNT(ta.id_trans_ap) AS nbre
												FROM transmission_apurement ta
												WHERE ((ta.id_mod_lic = ?
													$sqlClient)
													$sqlClient2)
													AND ta.id_type_apur = ?");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmissionNonEnvoyes_backup_13012024($id_mod_lic, $id_cli, $id_type_apur=1){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;

			$sqlClient = "";
			$sqlClient2 = "";

			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND ta.id_cli = "'.$id_cli.'"';
											
			}

			$requete = $connexion-> prepare("SELECT COUNT(ta.id_trans_ap) AS nbre
												FROM transmission_apurement ta
												WHERE ta.id_mod_lic = ?
													$sqlClient
													AND ta.id_type_apur = ?
													AND ta.date_envoi IS NULL
													AND ta.fichier_trans_ap IS NULL");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmissionNonEnvoyes($id_mod_lic, $id_cli, $id_type_apur=1){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;

			$sqlClient = "";
			$sqlClient2 = "";

			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
											
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
			}else{
				$sqlLicence = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(ta.id_trans_ap)) AS nbre
													FROM client cl, transmission_apurement ta, detail_apurement dt, dossier d, marchandise_dossier md
													WHERE d.id_mod_lic = ?
														AND d.id_dos = md.id_dos
														$sqlLicence
														AND d.id_dos = dt.id_dos
														AND dt.id_trans_ap = ta.id_trans_ap
														AND ta.id_type_apur = ?
														AND ta.id_cli = cl.id_cli
														$sqlClient
														AND ta.date_envoi IS NULL
														AND ta.fichier_trans_ap IS NULL
													");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmissionApurementBySupplier($id_mod_lic, $supplier){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($supplier) && ($supplier != '')) {
				$sqlClient = ' AND ta.id_trans_ap IN(
									SELECT DISTINCT(det.id_trans_ap) AS id_trans_ap
										FROM detail_apurement det, dossier d
										WHERE det.id_dos = d.id_dos
											AND d.supplier LIKE "%'.$supplier.'%") ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ta.id_trans_ap) AS nbre
												FROM transmission_apurement ta
												WHERE ta.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmissionApurementSansFichier($id_mod_lic, $id_cli, $id_type_apur=1){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND ta.id_trans_ap IN(
									SELECT DISTINCT(det.id_trans_ap) AS id_trans_ap
										FROM detail_apurement det, dossier d
										WHERE det.id_dos = d.id_dos
											AND d.id_cli = "'.$id_cli.'") ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ta.id_trans_ap) AS nbre
												FROM transmission_apurement ta
												WHERE ta.id_mod_lic = ?
													$sqlClient
													AND (ta.fichier_trans_ap IS NULL
														OR ta.fichier_trans_ap = '')
													AND ta.id_type_apur = ?");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmissionApurementSansFichierBySupplier($id_mod_lic, $supplier){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($supplier) && ($supplier != '')) {
				$sqlClient = ' AND ta.id_trans_ap IN(
									SELECT DISTINCT(det.id_trans_ap) AS id_trans_ap
										FROM detail_apurement det, dossier d
										WHERE det.id_dos = d.id_dos
											AND d.supplier = "'.$supplier.'") ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ta.id_trans_ap) AS nbre
												FROM transmission_apurement ta
												WHERE ta.id_mod_lic = ?
													$sqlClient
													AND (ta.fichier_trans_ap IS NULL
														OR ta.fichier_trans_ap = '')");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierApures($id_mod_lic, $id_cli, $id_type_apur=1){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_type_apur'] = $id_type_apur;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM detail_apurement det, dossier d, transmission_apurement ta
												WHERE ta.id_mod_lic = ?
													AND ta.id_type_apur = ?
													AND ta.id_trans_ap = det.id_trans_ap
													AND det.id_dos = d.id_dos
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierApuresBySupplier($id_mod_lic, $supplier){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($supplier) && ($supplier != '')) {
				$sqlClient = ' AND d.supplier = "'.$supplier.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM detail_apurement det, dossier d
												WHERE det.id_dos = d.id_dos
													AND d.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierPretAEtreApuresLicenceClient($id_mod_lic, $id_cli, $num_lic, $id_type_apur=1){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_type_apur'] = $id_type_apur;

			$sqlTypeApurement = '';

			if ($id_type_apur=='2') {
				$sqlTypeApurement = 'AND dos.ref_cvee IS NOT NULL';
			}



			$sqlClient = "";
			$sqlLicence = "";
			$sqlClient2 = "";
			$sqlQuittance = "";

			if ($id_mod_lic=='2') {
				
				if (isset($id_cli) && ($id_cli != '')) {
					$sqlClient = ' AND (dos.id_cli = "'.$id_cli.'" 
										OR SUBSTRING(md.num_lic, 1, 10) IN (
												SELECT SUBSTRING(num_lic, 1, 10)
													FROM licence
													WHERE id_cli = "'.$id_cli.'"
											)
									)';
				}

				if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
					$sqlQuittance = ' AND dos.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
				}

				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}


				$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(md.id_dos)) AS nbre
													FROM dossier dos, marchandise_dossier md
													WHERE dos.id_mod_lic = ?
														AND dos.not_apurement = '0'
														 $sqlClient
															AND (dos.ref_quit IS NOT NULL
															AND dos.ref_decl IS NOT NULL
															AND dos.ref_assurance IS NOT NULL
															AND TRIM(dos.ref_quit) <> ''
															AND TRIM(dos.ref_decl) <> ''
															AND TRIM(dos.ref_assurance) <> ''
															AND dos.id_dos NOT IN(
																SELECT detail_apurement.id_dos 
																FROM detail_apurement, transmission_apurement
																	WHERE detail_apurement.id_trans_ap = transmission_apurement.id_trans_ap
																		AND transmission_apurement.id_type_apur = ?
															)
														) 
														AND LENGTH(TRIM(md.num_lic)) > 9
														AND trim(dos.num_lic) <> 'N/A'
														AND dos.id_dos = md.id_dos
														AND md.num_lic <> 'N/A'
														AND md.num_lic <> 'UNDER VALUE'
														$sqlClient2
														$sqlLicence
														$sqlQuittance");
			}else if ($id_mod_lic=='1') {
				
				if (isset($id_cli) && ($id_cli != '')) {
					$sqlClient = ' AND (dos.id_cli = "'.$id_cli.'" 
										OR SUBSTRING(dos.num_lic, 1, 10) IN (
												SELECT SUBSTRING(num_lic, 1, 10)
													FROM licence
													WHERE id_cli = "'.$id_cli.'"
											)
									)';
				}

				if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
					$sqlQuittance = ' AND dos.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
				}

				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(dos.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}


				$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(dos.id_dos)) AS nbre
													FROM dossier dos
													WHERE dos.id_mod_lic = ?
														AND dos.not_apurement = '0'
														 $sqlClient
															AND (dos.ref_quit IS NOT NULL
															AND dos.ref_decl IS NOT NULL
															AND TRIM(dos.ref_quit) <> ''
															AND TRIM(dos.ref_decl) <> ''
															AND dos.id_dos NOT IN(
																SELECT detail_apurement.id_dos 
																FROM detail_apurement, transmission_apurement
																	WHERE detail_apurement.id_trans_ap = transmission_apurement.id_trans_ap
																		AND transmission_apurement.id_type_apur = ?
															)
														) 
														AND LENGTH(TRIM(dos.num_lic)) > 9
														AND trim(dos.num_lic) <> 'N/A'
														$sqlTypeApurement
														AND dos.num_lic <> 'N/A'
														AND dos.num_lic <> 'UNDER VALUE'
														$sqlClient2
														$sqlLicence
														$sqlQuittance");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierPretAEtreApuresLicenceClientEnAttenteAssurance($id_mod_lic, $id_cli, $num_lic, $id_type_apur=1){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_type_apur'] = $id_type_apur;

			$sqlTypeApurement = '';

			if ($id_type_apur=='2') {
				$sqlTypeApurement = 'AND dos.ref_cvee IS NOT NULL';
			}



			$sqlClient = "";
			$sqlLicence = "";
			$sqlClient2 = "";
			$sqlQuittance = "";

			if ($id_mod_lic=='2') {
				
				if (isset($id_cli) && ($id_cli != '')) {
					$sqlClient = ' AND (dos.id_cli = "'.$id_cli.'" 
										OR SUBSTRING(md.num_lic, 1, 10) IN (
												SELECT SUBSTRING(num_lic, 1, 10)
													FROM licence
													WHERE id_cli = "'.$id_cli.'"
											)
									)';
				}

				if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
					$sqlQuittance = ' AND dos.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
				}

				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(md.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}


				$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(md.id_dos)) AS nbre
													FROM dossier dos, marchandise_dossier md
													WHERE dos.id_mod_lic = ?
														AND dos.not_apurement = '0'
														 $sqlClient
															AND (dos.ref_quit IS NOT NULL
															AND dos.ref_decl IS NOT NULL
															AND (dos.ref_assurance IS NULL OR TRIM(dos.ref_assurance) = '')
															AND TRIM(dos.ref_quit) <> ''
															AND TRIM(dos.ref_decl) <> ''
															AND dos.id_dos NOT IN(
																SELECT detail_apurement.id_dos 
																FROM detail_apurement, transmission_apurement
																	WHERE detail_apurement.id_trans_ap = transmission_apurement.id_trans_ap
																		AND transmission_apurement.id_type_apur = ?
															)
														) 
														AND LENGTH(TRIM(md.num_lic)) > 9
														AND trim(dos.num_lic) <> 'N/A'
														AND dos.id_dos = md.id_dos
														AND md.num_lic <> 'N/A'
														AND md.num_lic <> 'UNDER VALUE'
														$sqlClient2
														$sqlLicence
														$sqlQuittance");
			}else if ($id_mod_lic=='1') {
				
				if (isset($id_cli) && ($id_cli != '')) {
					$sqlClient = ' AND (dos.id_cli = "'.$id_cli.'" 
										OR SUBSTRING(dos.num_lic, 1, 10) IN (
												SELECT SUBSTRING(num_lic, 1, 10)
													FROM licence
													WHERE id_cli = "'.$id_cli.'"
											)
									)';
				}

				if (isset($_GET['date_quit_debut']) && ($_GET['date_quit_debut'] != '')) {
					$sqlQuittance = ' AND dos.date_quit BETWEEN "'.$_GET['date_quit_debut'].'" AND "'.$_GET['date_quit_fin'].'"';
				}

				if (isset($num_lic) && ($num_lic != '')) {
					$sqlLicence = ' AND SUBSTRING(dos.num_lic, 1, 10) = SUBSTRING("'.$num_lic.'", 1, 10)';
				}


				$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(dos.id_dos)) AS nbre
													FROM dossier dos
													WHERE dos.id_mod_lic = ?
														AND dos.not_apurement = '0'
														 $sqlClient
															AND (dos.ref_quit IS NOT NULL
															AND dos.ref_decl IS NOT NULL
															AND TRIM(dos.ref_quit) <> ''
															AND TRIM(dos.ref_decl) <> ''
															AND dos.id_dos NOT IN(
																SELECT detail_apurement.id_dos 
																FROM detail_apurement, transmission_apurement
																	WHERE detail_apurement.id_trans_ap = transmission_apurement.id_trans_ap
																		AND transmission_apurement.id_type_apur = ?
															)
														) 
														AND LENGTH(TRIM(dos.num_lic)) > 9
														AND trim(dos.num_lic) <> 'N/A'
														$sqlTypeApurement
														AND dos.num_lic <> 'N/A'
														AND dos.num_lic <> 'UNDER VALUE'
														$sqlClient2
														$sqlLicence
														$sqlQuittance");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_type_apur']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierPretAEtreApuresLicenceClientBySupplier($id_mod_lic, $supplier){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['supplier'] = '%'.$supplier.'%';


			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND supplier LIKE ?
													AND ref_quit IS NOT NULL
													AND ref_decl IS NOT NULL
													AND ref_decl <> ''
													AND ref_quit <> ''
													AND num_lic <> 'N/A'
													AND num_lic <> 'UNDER VALUE'
													AND LENGTH(num_lic) > 4
													AND id_dos NOT IN(
														SELECT id_dos FROM detail_apurement
													)");
			$requete-> execute(array($entree['id_mod_lic'], $entree['supplier']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierSansCVEE($id_cli, $num_lic){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			if(!empty($id_cli)&&($id_cli!='')){
				$sqlClient = 'AND id_cli = '.$id_cli;
			}else{
				$sqlClient = '';
			}

			if(!empty($num_lic)&&($num_lic!='')){
				$sqlLicence = 'AND SUBSTRING(TRIM(num_lic), 1, 10) = SUBSTRING(TRIM("'.$num_lic.'"), 1, 10)';
			}else{
				$sqlLicence = '';
			}


			$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE ref_quit IS NOT NULL
													AND ref_decl IS NOT NULL
													AND ref_decl <> ''
													AND ref_quit <> ''
													AND (ref_cvee IS NULL OR REPLACE(ref_cvee, ' ', '')='')
													AND not_apurement = '0'
													AND id_mod_lic = 1
													$sqlClient
													$sqlLicence");
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreFactureTransmis($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['type_fact'] = $type_fact;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}


			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre
												FROM facture_dossier
												WHERE id_mod_lic = ?
													AND type_fact = ?
													$sqlClient
													AND ref_fact IN(SELECT ref_fact FROM detail_transmis_facture_dossier)");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmisFactureSansFichier($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['type_fact'] = $type_fact;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'" ';
			}


			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(tr.id_trans_fact)) AS nbre
												FROM facture_dossier fd, transmis_facture_dossier tr, detail_transmis_facture_dossier det
												WHERE fd.id_mod_lic = ?
													AND fd.type_fact = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_trans_fact = tr.id_trans_fact
													AND (tr.fichier_trans_fact IS NULL OR tr.fichier_trans_fact = '')");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmisFacture2($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['type_fact'] = $type_fact;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'" ';
			}


			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(tr.id_trans_fact)) AS nbre
												FROM facture_dossier fd, transmis_facture_dossier tr, detail_transmis_facture_dossier det
												WHERE fd.id_mod_lic = ?
													AND fd.type_fact = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_trans_fact = tr.id_trans_fact");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreFactureAttenteTransmis($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['type_fact'] = $type_fact;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}


			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre
												FROM facture_dossier
												WHERE id_mod_lic = ?
													AND type_fact = ?
													$sqlClient
													AND ref_fact NOT IN(SELECT ref_fact FROM detail_transmis_facture_dossier)
													AND validation = '1'
													AND not_transmis = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierAttenteFacture($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND cleared = '1'
													AND facture = '0'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreFactureAttenteLicence($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre, ref_fact
												FROM facture_licence
												WHERE id_mod_lic = ?
													AND NOT EXISTS (SELECT ref_fact FROM licence)
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureAvecLicence($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM facture_licence
												WHERE id_mod_lic = ?
													AND (num_lic NOT LIKE '%INV%' AND num_lic IS NOT NULL)
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNombreDossierFacture($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND cleared = '1'
													AND facture = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierFacture2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(d.id_dos)) AS nbre
												FROM dossier d, detail_facture_dossier det, facture_dossier fd
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierManqueFob($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (fob = '' OR fob IS NULL OR fob = '0')
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierManqueAv($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (ref_av = '' OR ref_av IS NULL OR montant_av = '' OR montant_av IS NULL)
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierManqueRoadManifest($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (road_manif = '' OR road_manif IS NULL)
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		/*public function getNombreDossierManqueRoadManifest($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (road_manif = '' OR road_manif IS NULL)
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}*/

		public function getNombreDossierManqueDeclarationOuQuittance($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (ref_decl = '' OR ref_decl IS NULL OR ref_quit = '' OR ref_quit IS NULL)
													AND cleared = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierTransmissionApurement($id_trans_ap){
			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM detail_apurement
												WHERE id_trans_ap = ?');
			$requete-> execute(array($entree['id_trans_ap']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreLicenceTransmissionApurement($id_trans_ap){
			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare('SELECT COUNT(DISTINCT(l.num_lic)) AS nbre
												FROM detail_apurement dt, dossier d, licence l
												WHERE dt.id_trans_ap = ?
													AND dt.id_dos = d.id_dos
													AND d.num_lic = l.num_lic');
			$requete-> execute(array($entree['id_trans_ap']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierClientModeTransportModeLicence3($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND ((d.date_quit IS NULL AND d.ref_quit IS NULL)
														OR (d.date_quit = '' OR d.ref_quit = ''))
													$sql1
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreDossierLicence($num_lic){
			include('connexion.php');

			$entree['num_lic'] = '%'.substr($num_lic, 0, 10).'%';

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(id_march_dos) AS nbre
												FROM marchandise_dossier
												WHERE num_lic LIKE ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreDossierFactureDossier($ref_fact){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;

			/*echo '<br> ref_fact = '.$ref_fact;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> ref_fact = '.$ref_fact;*/

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(det.id_dos)) AS nbre_dossier
												FROM facture_dossier fd, detail_facture_dossier det
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = det.ref_fact");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();

			return $reponse['nbre_dossier'];
		}

		public function getNombreDossierApureLicence($num_lic, $id_trans_ap){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['id_trans_ap'] = $id_trans_ap;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM detail_apurement
												WHERE id_dos IN (
													SELECT id_dos FROM dossier WHERE num_lic = ?
												)
												AND id_trans_ap = ?");
			$requete-> execute(array($entree['num_lic'], $entree['id_trans_ap']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $debut, $fin){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND ((d.date_quit IS NULL AND d.ref_quit IS NULL)
														OR (d.date_quit = '' OR d.ref_quit = ''))
													$sql1
													AND d.id_dos BETWEEN ? AND ?
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'],
									$entree['debut'], $entree['fin']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreLicenceEnCoursModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = "";
			$sql2 = "";

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob, poids
												FROM licence
												WHERE id_mod_lic = ?
												$sql
												$sql2");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				if ($id_mod_lic == '1') {
					if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['poids'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$nbre++;
					}
				}else if ($id_mod_lic == '2') {
					if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$nbre++;
					}
				}

			}$requete-> closeCursor();

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicenceExpiration40JoursModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, poids AS fob
													FROM licence
													WHERE id_mod_lic = ?
													$sql
													$sql2");
			}else{
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob
													FROM licence
													WHERE id_mod_lic = ?
													$sql
													$sql2");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) <= 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
					$nbre++;
				}
			}$requete-> closeCursor();

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicenceExpireModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, poids AS fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
														AND apurement <> '1'
													$sql
													$sql2");
			}else{
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
														AND apurement <> '1'
													$sql
													$sql2");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				if( ($date_exp < $reponse['aujourdhui']) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
					$nbre++;
				}
			}$requete-> closeCursor();

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicenceClotureeAppureeModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, poids AS fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
														AND apurement <> '1'
													$sql
													$sql2");
			}else{
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
														AND apurement <> '1'
													$sql
													$sql2");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) && ($this-> verifierApurementDossierLicence($reponse['num_lic']) == false) ){
					$nbre++;
				}
			}$requete-> closeCursor();

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicenceCIFLicenceDifferentCIFDossier($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob,
													(fob+fret+assurance+autre_frais) AS cif
												FROM licence
												WHERE id_mod_lic = ?
												$sql
												$sql2");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['cif'] != $this-> getSommeCIFLicence($reponse['num_lic'])) ){
					$nbre++;
				}
			}$requete-> closeCursor();

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicenceClotureeTrackingAttenteBanqueAppureeModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, poids AS fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
													$sql
													$sql2");
			}else{
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
													$sql
													$sql2");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				if( ($this-> verifierApurementDossierLicence($reponse['num_lic']) != false) && ($reponse['num_lic'] != 'UNDER VALUE') ){
					$nbre++;
				}
			}$requete-> closeCursor();

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreDossierClientModeTransportModeLicence($id_cli, $id_mod_trans, $id_mod_lic, $num_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.*) AS nbre
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND l.num_lic = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['num_lic'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierClientModeTransportModeLicence2($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierEnAttenteCotationModeLicence($id_cli, $id_mod_lic, $date_deb=NULL, $date_fin=NULL){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_creat_dos) BETWEEN "'.$date_deb.'" AND "'.$date_deb.'")';
			}else{
				$sqlDate = '';
			}

			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '0'
													AND d.not_cotation = '0'
													AND d.id_mod_lic = ?
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierEnAttenteCotationModeLicence2($id_cli, $id_mod_lic, $date_deb=NULL, $date_fin=NULL){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_creat_dos) BETWEEN "'.$date_deb.'" AND "'.$date_deb.'")';
			}else{
				$sqlDate = '';
			}

			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '0'
													AND d.id_mod_lic = ?
													AND d.not_cotation = '0'
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierEnAttenteValidationCotationModeLicence2($id_cli, $id_mod_lic, $date_deb=NULL, $date_fin=NULL){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_creat_dos) BETWEEN "'.$date_deb.'" AND "'.$date_deb.'")';
			}else{
				$sqlDate = '';
			}

			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '1'
													AND d.id_util_verif_feuil_calc IS NULL
													AND d.date_verif_feuil_calc IS NULL
													AND d.id_mod_lic = ?
													AND d.not_cotation = '0'
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierSansIM4ApresCotation($id_cli=NULL, $id_mod_lic=NULL){
			include("connexion.php");

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$entree['id_mod_lic'] = $id_mod_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier d
												WHERE (
														(d.etat_feuil_calc = '1' 
															AND d.id_mod_lic='2'
															AND d.id_util_verif_feuil_calc IS NOT NULL
															AND d.date_verif_feuil_calc IS NOT NULL)
														OR d.id_mod_lic = '1')
													AND (d.ref_decl IS NULL OR TRIM(d.ref_decl)='')
													AND d.date_decl IS NULL
													AND (d.ref_dos NOT LIKE 'EXPDEC%' 
														AND d.ref_dos NOT LIKE '21EXP%')
													AND d.id_mod_lic = ?
													AND d.id_mod_trans <> 6
													AND d.id_mod_trans <> 27
													AND d.ref_dos <> 'TEST'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierSEnAttenteRemiseDocumentTransporteur($id_cli=NULL, $id_mod_lic=NULL){
			include("connexion.php");

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$entree['id_mod_lic'] = $id_mod_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier d
												WHERE (
														(d.tr8_date IS NOT NULL
															AND d.date_rem_doc IS NULL
															AND d.bur_douane <> 'KASUMBALESA - 722B')
														OR (d.bur_douane = 'KASUMBALESA - 722B'
															AND d.date_decl IS NOT NULL
															AND d.date_rem_doc IS NULL
															)
													)
													AND d.id_mod_lic = ?
													AND d.id_mod_trans <> 6
													AND d.id_mod_trans <> 27
													AND d.ref_dos <> 'TEST'
													AND DATE(d.date_creat_dos) > '2022-06-15'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierSansLiquidationApresCotation($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$entree['id_mod_lic'] = $id_mod_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier d
												WHERE (d.ref_decl IS NOT NULL AND TRIM(d.ref_decl)<>'')
													AND d.date_decl IS NOT NULL
													AND (d.ref_liq IS NULL OR TRIM(d.ref_liq)='')
													AND d.date_liq IS NULL
													AND d.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierSansQuittanceApresIM4($id_cli=NULL, $id_mod_lic=NULL){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier d
												WHERE (d.ref_liq IS NOT NULL AND TRIM(d.ref_liq)<>'')
													AND d.date_liq IS NOT NULL
													AND d.date_quit IS NULL
													AND (d.ref_quit IS NULL OR TRIM(d.ref_quit)='')
													AND d.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierStatus($statut, $id_cli=NULL, $id_mod_lic=NULL){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$sqlStatus= '';

			if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/AV/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL AND d.id_cli <> 883 
								AND YEAR(d.date_creat_dos) > 2021';

			}/*else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/AV')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';

			}*/
			else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD')) {

				$sqlStatus = ' AND d.ad_date IS NULL 
								AND YEAR(d.date_creat_dos) > 2021';

			}/*else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AV/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL';

			}*/else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AV')) {

				$sqlStatus = ' AND d.date_av IS NULL AND d.id_cli <> 888 
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING INSURANCE')) {

				$sqlStatus = ' AND d.date_assurance IS NULL  AND d.id_cli <> 883 
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING BAE')) {

				$sqlStatus = ' AND d.bae_date IS NULL 
								AND d.date_quit IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING BS')) {

				$sqlStatus = ' AND d.bs_date IS NULL 
								AND d.date_quit IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}

			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier d
												WHERE d.id_mod_lic = ?
													$sqlClient
													$sqlStatus");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
			//return $statut;

		}

		public function getNombreDossierEnAttenteValidationCotationModeLicence($id_cli, $id_mod_lic, $date_deb=NULL, $date_fin=NULL){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_creat_dos) BETWEEN "'.$date_deb.'" AND "'.$date_deb.'")';
			}else{
				$sqlDate = '';
			}

			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '1'
													AND (d.id_util_verif_feuil_calc IS  NULL AND date_verif_feuil_calc IS  NULL)
													AND d.id_mod_lic = ?
													AND d.not_cotation = '0'
												ORDER BY d.date_feuil_calc DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierCotationValideeModeLicence($id_cli, $id_mod_lic, $date_deb=NULL, $date_fin=NULL){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($date_deb) && ($date_deb!='') && isset($date_fin) && ($date_fin!='')) {
				$sqlDate = ' AND (DATE(d.date_creat_dos) BETWEEN "'.$date_deb.'" AND "'.$date_deb.'")';
			}else{
				$sqlDate = '';
			}

			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													$sqlClient
													$sqlDate
													AND d.etat_feuil_calc = '1'
													AND (d.id_util_verif_feuil_calc IS NOT NULL AND date_verif_feuil_calc IS NOT NULL)
													AND d.id_mod_lic = ?
												ORDER BY d.date_feuil_calc DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreLicenceClientModeLicenceTypeLicence($id_cli, $id_mod_lic, $id_type_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;


			if((isset($id_type_lic)) && ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}else{
				$sql2 = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(*) AS nbre
												FROM licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
													$sql2");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreFactureClientModeldeLicence($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;


			if((isset($id_cli)) && ($id_cli != null) && ($id_cli != '')){
				$sql2 = ' AND id_cli = '.$id_cli;
			}else{
				$sql2 = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(*) AS nbre
												FROM facture_licence
												WHERE id_mod_lic = ?
													$sql2");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDocumentApurement($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;


			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(tr.id_trans_ap)) AS nbre
												FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
												WHERE cl.id_cli = ?
													AND cl.id_cli = d.id_cli
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = tr.id_trans_ap");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreTransmisFacture($id_cli, $id_mod_lic, $type_fact){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;


			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(tr.id_trans_fact)) AS nbre
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = ?
													AND cl.id_cli = fact.id_cli
													AND fact.id_mod_lic = ?
													AND fact.type_fact = ?
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierComplementDataDossier($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;



			if((isset($id_cli)) && ($id_cli != null) && ($id_cli != '')){
				$sqlClient = ' AND id_cli = '.$id_cli;
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE (
														fob = '' OR fob IS NULL OR fob = '0'
														OR ref_av IS NULL OR ref_av = ''
														OR montant_av IS NULL OR montant_av = ''
														OR road_manif IS NULL OR road_manif = ''
														OR ref_decl IS NULL OR ref_decl = ''
														OR montant_decl IS NULL OR montant_decl = ''
														OR ref_quit IS NULL OR ref_quit = ''
														OR ref_fact IS NULL OR ref_fact = ''
													)
													AND id_mod_lic = ?
													AND (cleared = '1' OR cleared = '0')
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}
		/*
		public function getNombreDossierClientModeTransportModeLicence($id_cli, $id_mod_trans, $id_mod_lic, $num_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT COUNT(d.*) AS nbre
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND l.num_lic = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['num_lic'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}
		*/
		public function getDifferenceDate($date1, $date2){
			include('connexion.php');
			$entree['date1'] = $date1;
			$entree['date2'] = $date2;

			$requete = $connexion-> prepare('SELECT DATEDIFF(?,?) AS difference');
			$requete-> execute(array($entree['date1'], $entree['date2']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['difference'];
			}
		}

		public function nbreImportKlsa(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(klsa_arriv) = CURRENT_DATE()");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreWiskiArrived($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(wiski_arriv) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreWiskiDeparture($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(wiski_dep) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDgdaIn($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(dgda_in) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreUnderWiski($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE (wiski_arriv IS NOT NULL AND wiski_arriv <> '')
												AND (wiski_dep IS NULL OR wiski_dep = '')
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreUnderDgda($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE (dgda_in IS NOT NULL AND dgda_in <> '')
												AND (dgda_out IS NULL OR dgda_out = '')
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierLiquidation($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE ( (date_liq IS NOT NULL OR date_liq <> '')
													OR (ref_liq IS NOT NULL OR ref_liq <> '') )
												AND ( (date_quit IS NULL OR date_quit = '')
													OR (ref_quit IS NULL OR ref_quit = '') )
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierQuittance($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(date_quit) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDgdaOut($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(dgda_out) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreAwaitCRF($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE (wiski_dep IS NOT NULL AND wiski_dep <> '')
												AND ( (date_crf IS NULL OR date_crf = '') AND (ref_crf IS NULL OR ref_crf = '' ))
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportWiskiDeparture(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(wiski_dep) = CURRENT_DATE()");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportDgdaIn(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(dgda_in) = CURRENT_DATE()");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportDgdaOrLiquidation(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(dgda_in) IS NOT NULL
												AND (dgda_out IS NULL
														AND date_liq IS NULL AND ref_liq IS NULL)
												AND DATEDIFF(CURRENT_DATE(), ADDDATE(dgda_in, 1)) > 1");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierModeleLicence($id_mod_lic, $id_cli, $id_mod_trans=NULL, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE id_mod_lic = ?
											$sql
											$sqlTrans
											$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreFactureModeleLicence($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($type_fact) && ($type_fact != '')) {
				$sqlTypeFact = ' AND type_fact = "'.$type_fact.'"';
			}else{
				$sqlTypeFact = '';
			}


			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre
											FROM facture_dossier
											WHERE id_mod_lic = ?
												AND note_debit = '0'
											$sql
											$sqlTypeFact");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierFacturesModeleLicence($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND fd.id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(det.id_dos)) AS nbre
											FROM facture_dossier fd, detail_facture_dossier det
											WHERE fd.id_mod_lic = ?
												AND fd.note_debit = '0'
												AND fd.ref_fact = det.ref_fact
											$sql");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierNonFacturesModeleLicence($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND d.id_cli = '.$id_cli;
			}else{
				$sqlClient = '';
			}


			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client c
												WHERE d.id_mod_lic = ?
													AND d.id_dos NOT IN(
														SELECT dos.id_dos AS id_dos
			 												FROM facture_dossier fd, client cl, utilisateur u, detail_facture_dossier det, dossier dos
															WHERE fd.id_util = u.id_util
																AND fd.id_cli = cl.id_cli
																AND fd.note_debit = '0'
																AND fd.ref_fact = det.ref_fact
																AND det.id_dos = dos.id_dos
															GROUP BY dos.id_dos
													)
													$sqlClient
													AND d.date_quit IS NOT NULL
													AND d.ref_quit IS NOT NULL
													AND d.etat_feuil_calc = '1'
													AND d.id_cli = c.id_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierCleared($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE cleared = '1'
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierProcess($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE cleared = '0'
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierCanceled($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE cleared = '2'
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierKlsaToDay($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(arrival_date) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportLiquidation(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE date_liq IS NOT NULL
												AND date_quit IS NULL
												AND ref_quit IS NULL");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportQuitance(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE date_quit IS NOT NULL
												AND ref_quit IS NOT NULL
												AND dgda_out IS NULL");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportDgdaOut(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE (DATE(dgda_out) = CURRENT_DATE()
													OR DATE(dgda_out) = ADDDATE(CURRENT_DATE(),-1))");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierClearedWaitFacture($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE cleared = '1'
												AND facture = '0'
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		//FIN Methode permettant de recuperer

		//Methodes permettant de Selectionner

		public function selectionnerDossierAvecFeuilleDeCalcul($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$option = "";
			$objResponse = new xajaxResponse();
			$bg = '';
			$style = '';
			$option = '';

			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
											FROM dossier
											WHERE id_mod_lic = ?
												AND id_cli = ?
												AND etat_feuil_calc = '1'
												AND not_cotation = '0'
											ORDER BY id_dos DESC");

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_dos']; ?>">
					<?php echo $reponse['ref_dos']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerClientModeleLicenceFacturation($id_mod_lic){
			include('connexion.php');

			// $entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;


			$requete = $connexion-> prepare("SELECT *
											FROM client cl, facture_dossier fd
											WHERE cl.id_cli = fd.id_cli
												AND fd.id_mod_lic = ?
											GROUP BY cl.id_cli
											ORDER BY cl.nom_cli ASC");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_cli']; ?>">
					<?php echo $reponse['nom_cli']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerDossierPourFacturation($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$option = "";
			$objResponse = new xajaxResponse();
			$bg = '';
			$style = '';
			$option = '';

			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
											FROM dossier
											WHERE id_mod_lic = ?
												AND id_cli = ?
												AND facture = '0'
												AND cleared = '1'
												AND id_dos NOT IN(
													SELECT id_dos FROm detail_facture_dossier
												)
											ORDER BY id_dos DESC");

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_dos']; ?>">
					<?php echo $reponse['ref_dos']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerModule(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT *
												FROM module");

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_mod']; ?>">
					<?php echo $reponse['nom_mod']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerPriorite(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT *
												FROM priorite");

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_prio']; ?>">
					<?php echo $reponse['nom_prio']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerDossierPrincipalEnAttenteFacture($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$option = "";
			$objResponse = new xajaxResponse();
			$bg = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT ref_dos, id_dos
											FROM dossier
											WHERE id_cli = ?
												AND id_mod_lic = ?
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												AND ref_liq IS NOT NULL
												AND ref_liq <> ''
												AND id_dos NOT IN (
														SELECT id_dos FROM detail_facture_dossier
													)
												AND principal = '1'
												AND (
														(id_mod_lic = 2
															AND etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL)
														OR
														id_mod_lic = 1
													)
											ORDER BY id_dos  DESC");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				echo '<option value="'.$reponse['id_dos'].'">
								'.$reponse['ref_dos'].'
							</option>';
			}$requete-> closeCursor();
		}

		public function selectionnerDossierPrincipalEnAttenteFacture2($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$option = "<option></option>";

			$requete = $connexion-> prepare("SELECT ref_dos, id_dos
											FROM dossier
											WHERE id_cli = ?
												AND id_mod_lic = ?
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												AND ref_liq IS NOT NULL
												AND ref_liq <> ''
												AND id_dos NOT IN (
														SELECT id_dos FROM detail_facture_dossier
													)
												AND principal = '1'
												AND (
														(id_mod_lic = 2
															AND etat_feuil_calc = '1'
															AND date_verif_feuil_calc IS NOT NULL)
														OR
														id_mod_lic = 1
													)
											ORDER BY id_dos  DESC");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$option .= '<option value="'.$reponse['id_dos'].'">
								'.$reponse['ref_dos'].'
							</option>';
			}$requete-> closeCursor();

			return $option;
		}

		public function selectionnerDossierPrincipal($id_cli, $id_mod_lic, $id_march){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$option = "";
			$objResponse = new xajaxResponse();
			$bg = '';
			$style = '';
			$option = '';

			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
											FROM dossier
											WHERE id_mod_lic = ?
												AND id_cli = ?
												AND principal = '1'
												AND date_quit IS NULL
												AND ref_quit IS NULL
											ORDER BY ref_dos DESC");

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_dos']; ?>">
					<?php echo $reponse['ref_dos']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerFacturePourClientModele($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$option = "";
			$objResponse = new xajaxResponse();
			$bg = '';
			$style = '';
			$option = '';

			$requete = $connexion-> prepare("SELECT *
											FROM facture_licence
											WHERE id_mod_lic = ?
												AND id_cli = ?
												AND ref_fact NOT IN (
													SELECT ref_fact
														FROM licence
														WHERE ref_fact IS NOT NULL
												)
											ORDER BY date_creat_fact  DESC");

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['ref_fact']; ?>">
					<?php echo $reponse['ref_fact']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerSiteUtilisateur($id_util){
			include('connexion.php');

			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT s.*
											FROM site s, affectation_utilisateur_site aff, utilisateur u
											WHERE u.id_util = ?
												AND u.id_util = aff.id_util
												AND aff.id_site = s.id_site
												AND aff.active = '1'");

			$requete-> execute(array($entree['id_util']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_site']; ?>">
					<?php echo $reponse['nom_site']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerRegimeDouanier($id_mod_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
											FROM regime_douanier
											WHERE id_mod_lic = ?
											ORDER BY nom_reg_douan");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['nom_reg_douan']; ?>">
					<?php echo $reponse['nom_reg_douan']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerRole(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT *
											FROM role
											ORDER BY nom_role");

			//$requete-> execute(array($entree['id_role']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_role']; ?>">
					<?php echo $reponse['nom_role']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerColonne(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT *
											FROM colonne
											ORDER BY titre_col");

			//$requete-> execute(array($entree['id_role']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_col']; ?>">
					<?php echo $reponse['titre_col']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerColonne2(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT *
											FROM colonne
											WHERE id_col IN (
													SELECT id_col
														FROM affectation_client_modele_licence
												)
											ORDER BY titre_col");

			//$requete-> execute(array($entree['id_role']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_col']; ?>">
					<?php echo $reponse['titre_col']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerModeleLicence(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT *
											FROM modele_licence
											ORDER BY nom_mod_lic");

			//$requete-> execute(array($entree['id_role']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_mod_lic']; ?>">
					<?php echo $reponse['nom_mod_lic']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerBureauDouane(){
			include('connexion.php');
			echo "'";

			$requete = $connexion-> query("SELECT *
											FROM bureau_douane");


			while($reponse = $requete-> fetch()){

				?>
				+'<option value="<?php echo $reponse['nom_bur_douane']; ?>"><?php echo $reponse['nom_bur_douane']; ?></option>'
				<?php
			}$requete-> closeCursor();
			echo "+'";
		}

		public function selectionnerBureauDouane2(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM bureau_douane
											WHERE active = '1'");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['nom_bur_douane']; ?>">
					<?php echo $reponse['nom_bur_douane']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerBureauDouane3(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM bureau_douane
											WHERE active = '1'");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_bur_douane']; ?>">
					<?php echo $reponse['nom_bur_douane']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerBureauDouaneAjax(){
			include('connexion.php');
			$select = "";
			$requete = $connexion-> query("SELECT *
											FROM bureau_douane
											WHERE active = '1'");


			while($reponse = $requete-> fetch()){
				$select .= '<option value="'.$reponse['id_bur_douane'].'">
								'.$reponse['nom_bur_douane'].'
							</option>';
			}$requete-> closeCursor();

			return $select;
		}

		public function selectionnerCategorieClient(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT id_cat_cli, UPPER(nom_cat_cli) AS nom_cat_cli
											FROM categorie_client");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_cat_cli']; ?>">
					<?php echo $reponse['nom_cat_cli']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerEtatPV(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM etat_pv");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_etat']; ?>">
					<?php echo $reponse['nom_etat']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerCategorieClient2(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT id_cat_cli, UPPER(nom_cat_cli) AS nom_cat_cli, 
													CONCAT('(',IF(min_cam IS NULL, '', min_cam),'-',IF(max_cam IS NULL, '', max_cam),')') AS camion
											FROM categorie_client");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_cat_cli']; ?>">
					<?php echo $reponse['nom_cat_cli'].' '.$reponse['camion']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerDomaineActivite(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT id_dom, UPPER(nom_dom) AS nom_dom
											FROM domaine_activite");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_dom']; ?>">
					<?php echo $reponse['nom_dom']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function afficherDocumentDossier($id_mod_lic, $id_dos){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				?>
				<tr>
					<td>
						<?php 
						echo $compteur;
						?>
					</td>
					<td>
					<?php 
						echo $reponse['nom_doc'];
					?>
					</td>
					<td>
					<?php
					if($this-> getDocumentForDossier($id_dos, $reponse['id_doc']) != '0' && file_exists('../documents/'.$this-> getDossier($id_dos)['ref_dos'].'/'.$this-> getDocumentForDossier($id_dos, $reponse['id_doc']))){
						?>
			            <span class="bg bg-dark" style="padding: 5px; border-radius: 5px;" onclick="window.open('../documents/<?php echo $this-> getDossier($id_dos)['ref_dos'];?>/<?php echo $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);?>','pop4','width=700,height=900');">
							<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
						</span>
						<?php
					}
					?>
					</td>
					<td>
		            	<input type="hidden" name="id_doc_<?php echo $compteur;?>" value="<?php echo $reponse['id_doc'];?>">
						<input type="file" name="fichier_<?php echo $compteur;?>" class="form-control cc-exp">
					</td>
				</tr>
				<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherDossiersSansCVEE($id_cli, $num_lic){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			if(!empty($id_cli)&&($id_cli!='')){
				$sqlClient = ' AND id_cli = '.$id_cli;
			}else{
				$sqlClient = '';
			}

			if(!empty($num_lic)&&($num_lic!='')){
				$sqlLicence = ' AND SUBSTRING(TRIM(num_lic), 1, 10) = SUBSTRING(TRIM("'.$num_lic.'"), 1, 10)';
			}else{
				$sqlLicence = '';
			}

			$compteur = 0;

			$requete = $connexion-> query("SELECT ref_dos, num_lot, num_lic, ref_cvee, montant_cvee
												FROM dossier
												WHERE ref_quit IS NOT NULL
													AND ref_decl IS NOT NULL
													AND ref_decl <> ''
													AND ref_quit <> ''
													AND (ref_cvee IS NULL OR REPLACE(ref_cvee, ' ', '')='')
													AND id_mod_lic = 1
													AND not_apurement = '0'
													$sqlClient
													$sqlLicence");
			
			while($reponse = $requete-> fetch()){
				$compteur++;
				// include("modalDeleteColonneClient.php");
				?>
				<tr>
					<td>
						<?php 
						echo $compteur;
						?>
					</td>
					<td>
					<?php 
						echo $reponse['ref_dos'];
					?>
					</td>
					<td>
					<?php 
						echo $reponse['num_lot'];
					?>
					</td>
					<td>
					<?php 
						echo $reponse['num_lic'];
					?>
					</td>
					<td style="text-align: right;">
					<?php 
						echo $reponse['ref_cvee'];
					?>
					</td>
					<td style="text-align: center;">
					<?php 
						echo $reponse['montant_cvee'];
					?>
					</td>
				</tr>
				<?php
			}$requete-> closeCursor();
			
		}

		public function afficherColonneUtilisateur($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT col.*, ml.*, mt.*, af.*
												FROM colonne col, modele_licence ml, mode_transport mt, affectation_colonne_utilisateur af
												WHERE col.id_col = af.id_col
													AND ml.id_mod_lic = af.id_mod_lic
													AND mt.id_mod_trans = af.id_mod_trans
													AND af.id_util = ?
												ORDER BY ml.id_mod_lic, mt.id_mod_trans, af.rang");
			$requete-> execute(array($entree['id_util']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				include("modalDeleteColonneClient.php");
				?>
				<tr>
					<td>
						<?php 
						echo $compteur;
						?>
					</td>
					<td>
					<?php 
						echo $reponse['titre_col'];
					?>
					</td>
					<td>
					<?php 
						echo $reponse['nom_mod_lic'];
					?>
					</td>
					<td>
					<?php 
						echo $reponse['nom_mod_trans'];
					?>
					</td>
					<td style="text-align: right;">
					<?php 
						echo $reponse['rang'];
					?>
					</td>
					<td style="text-align: center;">
					<?php 
						echo $reponse['edit_tracking'];
					?>
					</td>
					<td style="text-align: center;">
					<?php 
						echo $reponse['important'];
					?>
					</td>
					<td>
						<span class="btn btn-block btn-danger btn-xs" title="Supprimer l'affectation" data-toggle="modal" data-target=".delete_<?php echo $entree['id_util'];?>_<?php echo $reponse['id_col'];?>_<?php echo $reponse['id_mod_lic'];?>_<?php echo $reponse['id_mod_trans'];?>">
							<i class="fas fa-times"></i>
						</span>
					</td>
				</tr>
				<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherMarchandiseClientModeleLicence($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT march.nom_march AS nom_march,
													aff.code AS code,
													march.id_march AS id_march
												FROM marchandise march, 
													affectation_marchandise_client_modele_licence aff
												WHERE march.id_march = aff.id_march
													AND aff.id_cli = ?
													AND aff.id_mod_lic = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				//include("modalDeleteColonneClient.php");
				?>
				<tr>
					<td>
					<?php 
						echo $reponse['nom_march'];
					?>
					</td>
					<td>
					<?php 
						echo $reponse['code'];
					?>
					</td>
					<td>
						<span class="btn btn-block btn-danger btn-xs" title="Supprimer l'affectation" data-toggle="modal" data-target=".delete_<?php echo $entree['id_cli'];?>_<?php echo $reponse['id_march'];?>_<?php echo $reponse['id_mod_lic'];?>">
							<i class="fas fa-times"></i>
						</span>
					</td>
				</tr>
				<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherFacturationClientModeleLicence($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT *, cl.nom_cli AS nom_cli
												FROM affectation_client_modele_licence aff, client cl
												WHERE aff.id_cli = ?
													AND aff.id_mod_lic = ?
													AND aff.modele_facture = cl.id_cli
													AND aff.modele_facture IS NOT NULL");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
				//$compteur++;
				//include("modalDeleteColonneClient.php");
			if (!empty($reponse)) {
				?>
				<tr>
					<td>
					<?php 
						echo $reponse['nom_cli'];
					?>
					</td>
					<td>
						<span class="btn btn-sm btn-info" onclick="window.open('popUpFacturationClient.php?id_cli=<?php echo $id_cli;?>&id_mod_lic=<?php echo $id_mod_lic;?>','pop1','width=1300,height=800');"><i class="fa fa-eye"></i></span>
					</td>
				</tr>
				<?php
			}else{
				$requete2 = $connexion-> prepare("SELECT cl.*
													FROM facture_dossier fd, client cl
													WHERE fd.id_cli = ?
														AND fd.id_mod_lic = ?
														AND fd.id_cli = cl.id_cli
													GROUP BY fd.id_cli");
				$requete2-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
				$reponse2 = $requete2-> fetch();
				if ($reponse2) {
					?>
					<tr>
						<td>
						<?php 
							echo $reponse2['nom_cli'];
						?>
						</td>
						<td>
							<button class="btn btn-sm btn-info" onclick="window.open('popUpFacturationClient.php?id_cli=<?php echo $reponse2['id_cli'];?>&id_mod_lic=<?php echo $id_mod_lic;?>','pop1','width=1300,height=800');"><i class="fa fa-eye"></i></button>
						</td>
					</tr>
					<?php
				}
			}
				
		}

		public function afficherModeTransportClientModeleLicence($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT mt.nom_mod_trans AS nom_mod_trans
												FROM mode_transport mt, dossier d
												WHERE d.id_mod_trans = mt.id_mod_trans
													AND d.id_cli = ?
													AND d.id_mod_lic = ?
												GROUP BY mt.id_mod_trans
												ORDER BY mt.id_mod_trans");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				//include("modalDeleteColonneClient.php");
				?>
				<tr>
					<td>
					<?php 
						echo $reponse['nom_mod_trans'];
					?>
					</td>
					<td>
						<span class="btn btn-block btn-danger btn-xs" title="Supprimer l'affectation" data-toggle="modal" data-target=".delete_<?php echo $entree['id_cli'];?>_<?php echo $reponse['id_mod_trans'];?>_<?php echo $entree['id_mod_lic'];?>">
							<i class="fas fa-times"></i>
						</span>
					</td>
				</tr>
				<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherDocumentDossierBackUp($id_mod_lic, $id_dos){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				if($reponse['id_doc']==49 && ($this-> verifierPlisBP($this-> getDossier($id_dos)['num_bp'], $this-> getDossier($id_dos)['id_cli']))){
					$num_dos = $this-> getDossier($id_dos)['ref_dos'];
						
					// if(stristr($num_dos, '/') == true) {
					// 	$num_dos = str_replace("/", "_", "$num_dos");
					// }
					
					// $piece = $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);
					?>
		            <div class="col-md-4">
						<span class="bg bg-dark" style="padding: 5px; border-radius: 5px;" onclick="window.open('../documents/<?php echo $this-> verifierPlisBP($this-> getDossier($id_dos)['num_bp'], $this-> getDossier($id_dos)['id_cli'])['num_lic'];?>/<?php echo $this-> verifierPlisBP($this-> getDossier($id_dos)['num_bp'], $this-> getDossier($id_dos)['id_cli'])['fichier_plis'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
						</span>
					</div>
					<?php
				}else if($this-> getDocumentForDossier($id_dos, $reponse['id_doc']) == '0'){
					?>

		            <div class="col-md-4">
		            	<input type="hidden" name="id_doc_<?php echo $compteur;?>" value="<?php echo $reponse['id_doc'];?>">
		              <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['nom_doc'];?></label>
		              <input type="file" name="fichier_<?php echo $compteur;?>" class="form-control cc-exp">
		            </div>

					<?php
				}else{
					$num_dos = $this-> getDossier($id_dos)['ref_dos'];
						
					if(stristr($num_dos, '/') == true) {
						$num_dos = str_replace("/", "_", "$num_dos");
					}
					
					$piece = $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);
					?>
		            <div class="col-md-4">
						<span class="bg bg-dark" style="padding: 5px; border-radius: 5px;" onclick="window.open('../documents/<?php echo $num_dos;?>/<?php echo $piece;?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
						</span>
					</div>

		            <!-- <div class="col-md-3">
		            	<input type="hidden" name="id_doc_<?php echo $compteur;?>" value="<?php echo $reponse['id_doc'];?>">
		              <label for="x_card_code" class="control-label mb-1"><i class="fa fa-edit"></i><?php echo $reponse['nom_doc'];?></label>
		              <input type="file" name="fichier_<?php echo $compteur;?>" class="form-control cc-exp">
		            </div> -->

					<?php
				}

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherDocumentDossierCreate($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;

				?>

	            <div class="col-md-4">
	            	<input type="hidden" name="id_doc_<?php echo $compteur;?>" value="<?php echo $reponse['id_doc'];?>">
	              <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['nom_doc'];?></label>
	              <input type="file" name="fichier_<?php echo $compteur;?>" class="form-control cc-exp">
	            </div>

				<?php
			

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre_document" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherDossierModeleLicenceClient($id_mod_lic, $id_cli, $rubriques=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$compteur=0;
			$sqlNotIn = ' AND id_dos NOT IN (SELECT rd.id_dos FROM rubrique_dossier rd, depense_dossier dep WHERE (';

	        $rubriques = unserialize($rubriques);

	        for($i = 0, $size = count($rubriques); $i < $size; ++$i) {

	            $sqlNotIn .= ' id_rub = '.$rubriques[$i].' OR ';

	        }

	        $sqlNotIn = substr($sqlNotIn, 0, -3);

	        $sqlNotIn .= ') AND dep.id_dep = rd.id_dep AND dep.etat <> "2")';

	        if ($rubriques==NULL) {
	        	$sqlNotIn = NULL;
	        }

			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													$sqlNotIn ");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while($reponse = $requete-> fetch()){
				$compteur++;

				?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr>
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td>
						<input type="checkbox" name="check_<?php echo $compteur;?>">
					</td>
				</tr>
				<?php
			

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function selectionnerDossierEnAttenteApurement($id_cli, $id_mod_lic){
			include('connexion.php');

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}

			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
											FROM dossier
											WHERE id_mod_lic = ?
												AND id_dos NOT IN (
													SELECT id_dos
														FROM detail_apurement
													)
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												AND LENGTH(ref_quit) > 2
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												AND LENGTH(ref_decl) > 2
												AND num_lic <> 'N/A'
												AND num_lic <> 'UNDER VALUE'
												AND LENGTH(num_lic) > 4
												$sqlClient
											ORDER BY id_dos");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_dos']; ?>">
					<?php echo $reponse['ref_dos']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerFactureEnAttenteTransmis($id_cli, $id_mod_lic, $type_fact){
			include('connexion.php');

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;

			if ($entree['id_mod_lic']=='1') {
				
				$requete = $connexion-> prepare("SELECT *
												FROM facture_dossier
												WHERE id_mod_lic = ?
													AND ref_fact NOT IN (
														SELECT ref_fact
															FROM detail_transmis_facture_dossier
														)
													AND validation = '1'
													AND not_transmis = '0'
													$sqlClient
												ORDER BY date_fact");

				$requete-> execute(array($entree['id_mod_lic']));

			}else{
				
				$requete = $connexion-> prepare("SELECT *
												FROM facture_dossier
												WHERE id_mod_lic = ?
													AND ref_fact NOT IN (
														SELECT ref_fact
															FROM detail_transmis_facture_dossier
														)
													AND type_fact = ?
													AND validation = '1'
													AND not_transmis = '0'
													$sqlClient
												ORDER BY date_fact");

				$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));

			}

			// $requete = $connexion-> prepare("SELECT *
			// 								FROM facture_dossier
			// 								WHERE id_mod_lic = ?
			// 									AND ref_fact NOT IN (
			// 										SELECT ref_fact
			// 											FROM detail_transmis_facture_dossier
			// 										)
			// 									AND type_fact = ?
			// 									AND validation = '1'
			// 									AND not_transmis = '0'
			// 									$sqlClient
			// 								ORDER BY date_fact");

			// $requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['ref_fact']; ?>">
					<?php echo $reponse['ref_fact']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerClientPourFactureModeleLicence($id_mod_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$option = "";
			$objResponse = new xajaxResponse();
			$bg = '';
			$style = '';
			$option = '';

			$requete = $connexion-> prepare("SELECT DISTINCT(cl.id_cli) AS id_cli,
													UPPER(cl.nom_cli) AS nom_cli
											FROM facture_licence f, client cl
											WHERE f.id_mod_lic = ?
												AND cl.id_cli = f.id_cli");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_cli']; ?>">
					<?php echo $reponse['nom_cli']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerClientModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli,
													c.id_cli AS id_cli
												FROM client c, modele_licence ml,
													affectation_client_modele_licence a
												WHERE ml.id_mod_lic = ?
													AND ml.id_mod_lic = a.id_mod_lic
													AND a.id_cli = c.id_cli
													AND a.id_etat = 1
												ORDER BY c.nom_cli ASC");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_cli'];?>">
				<?php echo $reponse['nom_cli'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerLicenceAttenteApurement($id_mod_lic, $id_cli=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND dos.id_cli = "'.$id_cli.'"';
			}


			$requete = $connexion-> prepare("SELECT md.num_lic AS num_lic
												FROM marchandise_dossier md, dossier dos
												WHERE md.id_dos = dos.id_dos
													AND dos.not_apurement = '0'
													AND dos.id_dos NOT IN (
															SELECT id_dos
															FROM detail_apurement
														)
													AND dos.ref_quit IS NOT NULL
													AND dos.date_quit IS NOT NULL
													AND dos.id_mod_lic = ?
                                                    AND LENGTH(TRIM(md.num_lic)) > 9
                                                    $sqlClient
												GROUP BY SUBSTRING(TRIM(md.num_lic), 1, 10)
												ORDER BY SUBSTRING(TRIM(md.num_lic), 1, 10)  ASC


											-- SELECT l.num_lic AS num_lic, 
											-- 			l.fob AS fob, 
											-- 			DATE(CURRENT_DATE()) AS aujourdhui, 
											-- 			l.date_val
											-- 	FROM licence l, marchandise_dossier md, dossier dos
											-- 	WHERE SUBSTRING(l.num_lic, 1, 10) = SUBSTRING(md.num_lic, 1, 10)
											-- 		AND md.id_dos = dos.id_dos
											-- 		AND dos.not_apurement = '0'
											-- 		AND dos.id_dos NOT IN (
											-- 				SELECT id_dos
											-- 				FROM detail_apurement
											-- 			)
											-- 		AND l.id_mod_lic = ?
											-- 	GROUP BY l.num_lic
											-- 	ORDER BY l.num_lic  ASC
												");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerBPClient($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT DISTINCT(num_bp), ref_dos, id_dos, commodity
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND num_bp IS NOT NULL
													AND num_bp NOT IN(
															SELECT num_bp
																FROM plis
														)
													AND YEAR(date_creat_dos) > '2021'
												GROUP BY num_bp
												ORDER BY num_bp ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['num_bp'];?>">
				<?php echo $reponse['num_bp'].'-'.$reponse['commodity'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerLicenceDossierClient($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT DISTINCT(SUBSTRING(num_lic, 1, 10)) AS num_lic
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
												ORDER BY num_lic ");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerDossierClientModeTransportModeLicence2($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													$sqlClient
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.cleared = '0'
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['ref_dos'];?>">
				<?php echo $reponse['ref_dos'];?>
			</option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerDossierClientModeTransportModeLicence3($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $type){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}

			if (isset($type) && ($type == 'TOTAL FILES')) {
				$sqlType = '';
			}

			if (isset($type) && ($type == 'CLEARING COMPLETED')) {
				$sqlType = " AND cleared = '1'";
			}

			if (isset($type) && ($type == 'FILES IN PROCESS')) {
				$sqlType = " AND cleared = '0'";
			}

			if (isset($type) && ($type == 'CANCELLED')) {
				$sqlType = " AND cleared = '2'";
			}

			if (isset($type) && ($type == 'KASUMBALESA')) {
				$sqlType = " AND DATE(arrival_date) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'WISKI ARRIVAL')) {
				$sqlType = " AND DATE(wiski_arriv) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT WISKI')) {
				$sqlType = " AND (wiski_arriv IS NOT NULL AND wiski_arriv <> '')
												AND (wiski_dep IS NULL OR wiski_dep = '')";
			}

			if (isset($type) && ($type == 'WISKI DEPARTURE')) {
				$sqlType = " AND DATE(wiski_dep) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'AWAIT CRF')) {
				$sqlType = " AND (wiski_dep IS NOT NULL AND wiski_dep <> '')
												AND ( (date_crf IS NULL OR date_crf = '') AND (ref_crf IS NULL OR ref_crf = '' ))";
			}

			if (isset($type) && ($type == 'DGDA IN')) {
				$sqlType = " AND DATE(dgda_in) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT DGDA')) {
				$sqlType = " AND (dgda_in IS NOT NULL AND dgda_in <> '')
												AND (dgda_out IS NULL OR dgda_out = '')";
			}

			if (isset($type) && ($type == 'LIQUIDATED / AWAIT QUITTANCE')) {
				$sqlType = " AND ( (date_liq IS NOT NULL OR date_liq <> '')
													OR (refORq IS NOT NULL AND ref_liq <> '') )
												AND ( (date_quit IS NULL OR date_quit = '')
													OR (ref_quit IS NULL OR ref_quit = '') )";
			}

			if (isset($type) && ($type == 'QUITTANCE')) {
				$sqlType = " AND DATE(date_quit) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'DGDA OUT')) {
				$sqlType = " AND DATE(dgda_out) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'FILES CLEARED WAITING INVOICE')) {
				$sqlType = " AND cleared = '1'
												AND facture = '0'";
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													$sqlClient
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlType
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['ref_dos'];?>">
				<?php echo $reponse['ref_dos'];?>
			</option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerMarchandiseClientModeleLicence($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT DISTINCT(UPPER(commodity)) AS commodity
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
												ORDER BY commodity");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['commodity'];?>">
				<?php echo $reponse['commodity'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerMarchandiseClientModeleLicence2($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT UPPER(m.nom_march) AS nom_march, m.id_march AS id_march
												FROM marchandise m, client cl, modele_licence ml, affectation_marchandise_client_modele_licence af
												WHERE cl.id_cli = ?
													AND cl.id_cli = af.id_cli
													AND af.id_march = m.id_march
													AND af.id_mod_lic = ml.id_mod_lic
													AND ml.id_mod_lic = ?
												ORDER BY m.nom_march");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_march'];?>">
				<?php echo $reponse['nom_march'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerMarchandiseClientModeleLicence3($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT UPPER(m.nom_march) AS nom_march, m.id_march AS id_march
												FROM marchandise m, client cl, modele_licence ml, affectation_marchandise_client_modele_licence af
												WHERE cl.id_cli = ?
													AND cl.id_cli = af.id_cli
													AND af.id_march = m.id_march
													AND af.id_mod_lic = ml.id_mod_lic
													AND ml.id_mod_lic = ?
												ORDER BY m.nom_march");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['nom_march'];?>">
				<?php echo $reponse['nom_march'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerMarchandiseModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT DISTINCT(UPPER(commodity)) AS commodity
												FROM dossier
												WHERE id_mod_lic = ?
												ORDER BY commodity");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['commodity'];?>">
				<?php echo $reponse['commodity'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerMarchandiseModeleLicence2($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT UPPER(nom_march) AS nom_march, id_march
												FROM marchandise
												WHERE id_mod_lic = ?
												ORDER BY nom_march");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_march'];?>">
				<?php echo $reponse['nom_march'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerMarchandiseModeleLicenceAjax($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$select = '<select id="id_march" name="id_march" class="form-control form-control-sm cc-exp" required><option></option>';
			$requete = $connexion-> prepare("SELECT UPPER(nom_march) AS nom_march, id_march
												FROM marchandise
												WHERE id_mod_lic = ?
													AND id_march IN (SELECT id_march FROM dossier GROUP BY id_march)
												ORDER BY nom_march");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$select .= '<option value="'.$reponse['id_march'].'">'.$reponse['nom_march'].'</option>';
			}$requete-> closeCursor();

			$select .='</option>';

			return $select;

		}

		public function selectionnerFournisseur(){
			include('connexion.php');

			//$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_four;

			$requete = $connexion-> query("SELECT UPPER(nom_four) AS nom_four, id_four
												FROM fournisseur
												ORDER BY nom_four");
			//$requete-> execute(array($entree['id_four']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_four'];?>">
				<?php echo $reponse['nom_four'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerPays(){
			include('connexion.php');

			//$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_four;

			echo '<option value="DIVERS">DIVERS</option>';

			$requete = $connexion-> query("SELECT UPPER(REPLACE(nom_en_gb, '\'','')) AS nom_en_gb
												FROM pays
												ORDER BY nom_en_gb");
			//$requete-> execute(array($entree['id_four']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['nom_en_gb'];?>">
				<?php echo $reponse['nom_en_gb'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerStatusModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT DISTINCT(UPPER(nom_stat)) AS statut
												FROM status_dashboard
												WHERE id_mod_lic = ?
													AND active = '1'");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['statut'];?>">
				<?php echo $reponse['statut'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerTruckLocationModeleLicenceModeTransportClient($id_mod_lic, $id_mod_trans, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT tl.nom_truck_loc AS nom_truck_loc, 
													tl.id_truck_loc AS id_truck_loc
												FROM truck_location tl, affectation_truck_location_modele_licence_mode_transport_client aff
												WHERE tl.id_truck_loc = aff.id_truck_loc
													AND aff.id_mod_lic = ?
													AND aff.id_mod_trans = ?
													AND aff.id_cli = ?");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_cli']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['nom_truck_loc'];?>">
				<?php echo $reponse['nom_truck_loc'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerClient(){
			include('connexion.php');
			//$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> query("SELECT UPPER(c.nom_cli) AS nom_cli,
													c.id_cli AS id_cli
												FROM client c
												ORDER BY c.nom_cli ASC");
			//$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_cli'];?>">
				<?php echo $reponse['nom_cli'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerBanque(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_banq) AS nom_banq,
													id_banq
												FROM banque
												ORDER BY nom_banq ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_banq'];?>">
				<?php echo $reponse['nom_banq'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerNomBanque(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_banq) AS nom_banq,
													id_banq
												FROM banque
												ORDER BY nom_banq ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['nom_banq'];?>">
				<?php echo $reponse['nom_banq'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerPoste(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_post) AS nom_post,
													id_post
												FROM poste_entree
												ORDER BY nom_post ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_post'];?>">
				<?php echo $reponse['nom_post'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerTypeLicence(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_type_lic) AS nom_type_lic,
													id_type_lic
												FROM type_licence");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_type_lic'];?>">
				<?php echo $reponse['nom_type_lic'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerTypeDebours(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb,
													id_t_deb
												FROM type_debours");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_t_deb'];?>">
				<?php echo $reponse['nom_t_deb'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerModalitePaiement(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_mod_paie) AS nom_mod_paie, code,
													id_mod_paie
												FROM modalite_paiement");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_mod_paie'];?>">
				<?php echo $reponse['code'].' - '.$reponse['nom_mod_paie'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerEmballage(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_emb) AS nom_emb,
													id_emb
												FROM emballage
												ORDER BY nom_emb");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_emb'];?>">
				<?php echo $reponse['nom_emb'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerEmballage2(){
			include('connexion.php');
			echo "'";

			$requete = $connexion-> query("SELECT UPPER(nom_emb) AS nom_emb,
													id_emb
												FROM emballage");
			while($reponse = $requete-> fetch()){

				?>
				+'<option value="<?php echo $reponse['id_emb']; ?>"><?php echo $reponse['nom_emb']; ?></option>'
				<?php
			}$requete-> closeCursor();
			echo "+'";
		}

		public function selectionnerDebours2($id_t_deb, $id_mod_lic){
			include('connexion.php');
			echo "'";
			$entree['id_t_deb'] = $id_t_deb;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, deb.id_deb AS id_deb
												FROM debours deb, modele_licence ml, affectation_debours_modele_licence af
												WHERE deb.id_t_deb = ?
													AND deb.id_deb = af.id_deb
													AND af.id_mod_lic = ?
													AND af.id_mod_lic = ml.id_mod_lic");
			$requete-> execute(array($entree['id_t_deb'], $entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){

				?>
				+'<option value="<?php echo $reponse['id_deb']; ?>"><?php echo $reponse['nom_deb']; ?></option>'
				<?php
			}$requete-> closeCursor();
			echo "+'";
		}

		public function selectionnerAutresDebours($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> query("SELECT * 
												FROM debours
												ORDER BY nom_deb ASC
											");
			// $requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){

				?><option value="<?php echo $reponse['id_deb']; ?>"><?php echo $reponse['nom_deb']; ?></option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerAutresDebours2($id_cli, $id_mod_lic){
			include('connexion.php');
			echo "'";
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT * 
												FROM debours
												WHERE id_deb NOT IN (
													SELECT deb.id_deb
														FROM debours deb, modele_licence ml, affectation_debours_client_modele_licence af
														WHERE af.id_cli = ?
															AND deb.id_deb = af.id_deb
															AND af.id_mod_lic = ?
															AND af.id_mod_lic = ml.id_mod_lic
												)
											");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){

				?>
				+'<option value="<?php echo $reponse['id_deb']; ?>"><?php echo $reponse['nom_deb']; ?></option>'
				<?php
			}$requete-> closeCursor();
			echo "+'";
		}

		public function selectionnerDebours($id_mod_lic){
			include('connexion.php');
			echo "'";
			// $entree['id_t_deb'] = $id_t_deb;
			$entree['id_mod_lic'] = $id_mod_lic;

			//$requete = $connexion-> prepare("SELECT UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, deb.id_deb AS id_deb
			$requete = $connexion-> query("SELECT (deb.nom_deb) AS nom_deb, 
													deb.id_deb AS id_deb
												FROM debours deb
												WHERE deb.id_t_deb <> 1
													ORDER BY deb.nom_deb ASC");
			//$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_deb']; ?>"><?php echo $reponse['nom_deb']; ?></option>
				<?php
			}$requete-> closeCursor();
			echo "+'";
		}

		public function selectionnerDebours3($id_mod_lic){
			include('connexion.php');
			echo "'";
			//$entree['id_t_deb'] = $id_t_deb;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){


				?>
				+'<optgroup label="<?php echo $reponseTypeDebours['nom_t_deb']; ?>">'
					<?php 
						$requete = $connexion-> prepare("SELECT UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, deb.id_deb AS id_deb
															FROM debours deb, modele_licence ml, affectation_debours_modele_licence af
															WHERE deb.id_t_deb = ?
																AND deb.id_deb = af.id_deb
																AND af.id_mod_lic = ?
																AND af.id_mod_lic = ml.id_mod_lic");
						$requete-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic']));
						while($reponse = $requete-> fetch()){

							?>
							+'<option value="<?php echo $reponse['id_deb']; ?>"><?php echo $reponse['nom_deb']; ?></option>'
							<?php
						}$requete-> closeCursor();
					?>
				+'</optgroup>'
				<?php

			}$requeteTypeDebours-> closeCursor();
			
			echo "+'";
		}

		public function selectionnerSousTypePaiement($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$requete = $connexion-> prepare("SELECT id_sous_type_paie, code,
												UPPER(nom_sous_type_paie) AS nom_sous_type_paie
											FROM sous_type_paiement
											WHERE id_mod_lic = ?");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['id_sous_type_paie'];?>">
				<?php echo $reponse['code'].' - '.$reponse['nom_sous_type_paie'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerMonnaie(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT id_mon, UPPER(sig_mon) AS nom_mon
											FROM monnaie");
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['id_mon'];?>">
				<?php echo $reponse['nom_mon'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerUniteMesure(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_unit_mes) AS nom_unit_mes,
													id_unit_mes
												FROM unite_mesure");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_unit_mes'];?>">
				<?php echo $reponse['nom_unit_mes'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerUtilisateurValidationTicket(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_util) AS nom_util,
													id_util
												FROM utilisateur
												WHERE validation_ticket = '1'
												ORDER BY nom_util");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_util'];?>">
				<?php echo $reponse['nom_util'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerUtilisateurTraitementTicket(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_util) AS nom_util,
													id_util
												FROM utilisateur
												WHERE traitement_ticket = '1'
												ORDER BY nom_util");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_util'];?>">
				<?php echo $reponse['nom_util'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerMonnaie2(){
			include('connexion.php');
			echo "'";

			$requete = $connexion-> query("SELECT id_mon, UPPER(sig_mon) AS nom_mon
											FROM monnaie");
			while($reponse = $requete-> fetch()){

				?>
				+'<option value="<?php echo $reponse['id_mon']; ?>"><?php echo $reponse['nom_mon']; ?></option>'
				<?php
			}$requete-> closeCursor();
			echo "+'";
		}

		public function selectionnerModeTransport(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT id_mod_trans, UPPER(nom_mod_trans) AS nom_mod_trans
											FROM mode_transport");
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['id_mod_trans'];?>">
				<?php echo $reponse['nom_mod_trans'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherBoutonClientEncodeurSite($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			$requete = $connexion-> prepare("SELECT CONCAT(cl.nom_abr_cli, ' - ', ml.nom_mod_lic, ' - ', UPPER(mt.nom_mod_trans)) AS intitule,
													cl.id_cli AS id_cli, ml.id_mod_lic AS id_mod_lic, mt.id_mod_trans AS id_mod_trans,
													cl.photo As photo
											FROM client cl, modele_licence ml, mode_transport mt, 
													affectation_utilisateur_client_modele_licence aff
											WHERE aff.id_cli = cl.id_cli
												AND aff.id_mod_lic = ml.id_mod_lic
												AND aff.id_mod_trans = mt.id_mod_trans
												AND aff.id_util = ?
											ORDER BY cl.nom_abr_cli");
			$requete-> execute(array($entree['id_util']));
			while($reponse = $requete-> fetch()){
			?>
	          <div class="col-md-4 col-sm-6 col-12">
	            <a href="dossier.php?id_cli=<?php echo $reponse['id_cli'];?>&id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&date_dos=">

	            <div class="small-box bg-<?php echo $bg[rand(1, 8)];?>">
	              <div class="icon">
	                
	              </div>
	              <div class="inner">
	                <h4>
	                  <img src="../../images/clients/<?php echo $reponse['photo'];?>" width="50px">
	                  <?php echo $reponse['intitule'];?>
	                </h4>

	              </div>
	            </div>
	        	</a>

	            <!-- /.info-box -->
	          </div>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherBoutonClientEncodeurSite2($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			$requete = $connexion-> prepare("SELECT CONCAT(cl.nom_abr_cli, ' - ', ml.nom_mod_lic) AS intitule,
													cl.id_cli AS id_cli, ml.id_mod_lic AS id_mod_lic, mt.id_mod_trans AS id_mod_trans,
													cl.photo As photo
											FROM client cl, modele_licence ml, mode_transport mt, 
													affectation_utilisateur_client_modele_licence aff
											WHERE aff.id_cli = cl.id_cli
												AND aff.id_mod_lic = ml.id_mod_lic
												AND aff.id_mod_trans = mt.id_mod_trans
												AND aff.id_util = ?
											GROUP BY aff.id_cli, aff.id_mod_lic
											ORDER BY cl.nom_abr_cli");
			$requete-> execute(array($entree['id_util']));
			while($reponse = $requete-> fetch()){
			?>
	          <div class="col-md-4 col-sm-6 col-12">
	            <a href="dossier.php?id_cli=<?php echo $reponse['id_cli'];?>&id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&id_mod_trans=&date_dos=">

	            <div class="small-box bg-<?php echo $bg[rand(1, 8)];?>">
	              <div class="icon">
	                
	              </div>
	              <div class="inner">
	                <h4>
	                  <img src="../../images/clients/<?php echo $reponse['photo'];?>" width="50px">
	                  <?php echo $reponse['intitule'];?>
	                </h4>

	              </div>
	            </div>
	        	</a>

	            <!-- /.info-box -->
	          </div>
			<?php
			}$requete-> closeCursor();
		}

		/*public function selectionnerMarchandiseModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$requete = $connexion-> prepare("SELECT id_march, UPPER(nom_march) AS nom_march
											FROM marchandise
											WHERE id_mod_lic = ?
											ORDER BY nom_march  ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['id_march'];?>">
				<?php echo $reponse['nom_march'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		} */

		public function selectionnerLicenceModele($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$requete = $connexion-> prepare("SELECT num_lic
											FROM licence
											WHERE id_mod_lic = ?
											ORDER BY date_creat_lic  DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerLicenceModele2($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = '';
			$sql2 = '';

			if (isset($id_cli)) {
				$sql = ' AND id_cli = '.$id_cli;
			}
			if (isset($id_type_lic)) {
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			$requete = $connexion-> prepare("SELECT num_lic
											FROM licence
											WHERE id_mod_lic = ?
											$sql
											$sql2
											ORDER BY date_creat_lic  DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerLicenceModeleClient($id_mod_lic, $id_cli, $id_mod_trans, $id_march=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			if ( ($id_mod_lic==1) && (isset($id_march) && ($id_march!=NULL))) {
				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_march = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'],
										$entree['id_march'], $entree['id_mod_trans']));
				# code...
			}else{

				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			}

			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'].' '.$reponse['comment'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerLicenceModeleClientActive($id_mod_lic, $id_cli, $id_mod_trans, $id_march=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			if ( ($id_mod_lic==1) && (isset($id_march) && ($id_march!=NULL))) {
				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_march = ?
													AND id_mod_trans = ?
													AND affichier_tracking = '1'
												ORDER BY date_creat_lic  DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'],
										$entree['id_march'], $entree['id_mod_trans']));
				# code...
			}else{

				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			}

			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'].' '.$reponse['comment'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerLicenceEnCoursModele($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$bg = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT num_lic, fob, DATE(CURRENT_DATE()) AS aujourdhui
											FROM licence
											WHERE id_mod_lic = ?
											ORDER BY date_creat_lic  DESC");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				$bg = "bg-light";

				if( (!$date_exp) && ($this-> getSommeFobLicence($reponse['num_lic']) <= $fob) ){
					?>
					  <option value="<?php echo $reponse['num_lic'];?>">
						<?php echo $reponse['num_lic'];?>
					  </option>
					<?php
				}else{

					$style = '';//" style='color: black; background-color: orange;'";
					if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
						$bg = "bg-success";
						$style = " style=''";
					}else if($date_exp < $reponse['aujourdhui']){
						$bg = "bg-danger";
						$style = " style=''";
					}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 30) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
						$bg = "bg-warning";
						$style = " style=''";
					}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 30) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
						$bg = "bg-danger";
						$style = " style=''";
					} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
						$bg = "bg-info";
						$style = " style=''";
						?>
						  <option value="<?php echo $reponse['num_lic'];?>">
							<?php echo $reponse['num_lic'];?>
						  </option>
						<?php
					}else{
						?>
						  <option value="<?php echo $reponse['num_lic'];?>">
							<?php echo $reponse['num_lic'];?>
						  </option>
						<?php
					}
				}
			}$requete-> closeCursor();
		}

		public function selectionnerLicenceEnCoursModeleClient($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$bg = '';
			$style = '';
			$compteur = 0;

			if ($id_mod_lic == 1) {
				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														l.fob AS fob, 
														l.poids AS poids, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.date_val
												FROM licence l
												WHERE l.id_mod_lic = ?
													AND l.id_cli = ?
													AND (
														
														l.poids > ROUND((
															SELECT SUM(poids) AS poids
																FROM dossier
																WHERE num_lic = l.num_lic
														))+1

														OR l.num_lic NOT IN(
															SELECT DISTINCT(num_lic) FROM dossier
															)

													)
													AND DATE(CURRENT_DATE()) <= (
															SELECT date_exp
																FROM expiration_licence
																WHERE num_lic = l.num_lic
																ORDER BY id_date_exp DESC
																LIMIT 0, 1
														)
												ORDER BY l.num_lic  ASC");

				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			}else{
				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
															l.fob AS fob, 
															DATE_FORMAT(exp.date_exp, '%d/%m/%Y') AS date_exp,
                                                            (l.fob-IF(l.fob_marchandise_dossier > 0, l.fob_marchandise_dossier, 0)) AS balance_fob,
															DATE(CURRENT_DATE()) AS aujourdhui, 
															l.date_val AS date_val,
															IF(l.fob_marchandise_dossier > 0, l.fob_marchandise_dossier, 0) AS fob_marchandise_dossier
															FROM licence l
																LEFT JOIN expiration_licence exp
																	ON l.num_lic = exp.num_lic
															WHERE l.id_mod_lic = ?
																AND l.id_cli = ?
																AND ROUND(l.fob) > 0
																AND ROUND(l.fob-IF(l.fob_marchandise_dossier > 0, l.fob_marchandise_dossier, 0))>0
																-- $sqlMotCle
																AND exp.num_lic IS NOT NULL
																AND exp.id_etat = '1'
																AND exp.date_exp >= CURRENT_DATE()
															ORDER BY l.num_lic  ASC");

				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			}

			while($reponse = $requete-> fetch()){
				?>
				  <option value="<?php echo $reponse['num_lic'];?>">
					<?php echo $reponse['num_lic'];?>
				  </option>
				<?php
			
			}$requete-> closeCursor();
		}

		//FIN Methodes permettant de Selectionner

		//Methodes permettant de mettre à jour, 

		public function modifierLicence($num_lic, $date_val, $date_exp,
										$fournisseur, $commodity, $fob,
										$fret, $assurance, $autre_frais,
										$num_lic_old, $id_mon, $id_mod_paie,
										$id_type_lic, $id_sous_type_paie, $remarque,
										$av_ara, $date_cloture, $statut_lic, $ref_av){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['num_lic_old'] = $num_lic_old;
			/*if (!isset($date_val) || $date_val = '' ) {
				$date_val = NULL;
			}*/
			$entree['date_val'] = $date_val;
			$entree['fournisseur'] = $fournisseur;
			$entree['commodity'] = $commodity;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['id_mon'] = $id_mon;
			$entree['id_mod_paie'] = $id_mod_paie;
			$entree['id_type_lic'] = $id_type_lic;
			$entree['id_sous_type_paie'] = $id_sous_type_paie;
			$entree['remarque'] = $remarque;
			$entree['av_ara'] = $av_ara;
			$entree['date_cloture'] = $date_cloture;
			$entree['statut_lic'] = $statut_lic;
			$entree['ref_av'] = $ref_av;

			if (isset($date_cloture) && ($date_cloture!='')) {
				$entree['date_cloture'] = $date_cloture;
			}else{
				$entree['date_cloture'] = NULL;
			}

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;
			echo '<br> fret = '.$fret;
			echo '<br> assurance = '.$assurance;
			echo '<br> autre_frais = '.$autre_frais;
			echo '<br> id_mod_paie = '.$id_mod_paie;
			echo '<br> id_type_lic = '.$id_type_lic;
			echo '<br> id_sous_type_paie = '.$id_sous_type_paie;*/

			$requete = $connexion-> prepare("UPDATE licence SET num_lic= ?,  date_val = ?,
													fournisseur = ?, commodity = ?, fob = ?,
													fret = ?, assurance = ?, autre_frais = ?,
													id_mon = ?, id_mod_paie = ?, id_type_lic = ?,
													id_sous_type_paie = ?, remarque = ?, av_ara = ?,
													date_cloture = ?, statut_lic = ?, ref_av = ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic'], $entree['date_val'], $entree['fournisseur'],
									$entree['commodity'], $entree['fob'], $entree['fret'],
									$entree['assurance'], $entree['autre_frais'], $entree['id_mon'],
									$entree['id_mod_paie'], $entree['id_type_lic'], $entree['id_sous_type_paie'],
									$entree['remarque'], $entree['av_ara'], $entree['date_cloture'], $entree['statut_lic'], $entree['ref_av'], $entree['num_lic_old']));

			if ($date_exp != $this-> getLastEpirationLicence2($num_lic)) {
				$this-> annulerDateExpirationLicence($num_lic);
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

			$this-> modifierLicencePourDossier($num_lic, $num_lic_old);

		}

		public function modifierLicenceExport($num_lic, $date_val, $date_exp,
										$acheteur, $commodity, $fob,
										$fret, $assurance, $autre_frais,
										$num_lic_old, $id_mon, $id_mod_paie,
										$id_type_lic, $id_sous_type_paie){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['num_lic_old'] = $num_lic_old;
			/*if (!isset($date_val) || $date_val = '' ) {
				$date_val = NULL;
			}*/
			$entree['date_val'] = $date_val;
			$entree['acheteur'] = $acheteur;
			$entree['commodity'] = $commodity;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['id_mon'] = $id_mon;
			$entree['id_mod_paie'] = $id_mod_paie;
			$entree['id_type_lic'] = $id_type_lic;
			$entree['id_sous_type_paie'] = $id_sous_type_paie;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> acheteur = '.$acheteur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;
			echo '<br> fret = '.$fret;
			echo '<br> assurance = '.$assurance;
			echo '<br> autre_frais = '.$autre_frais;
			echo '<br> id_mod_paie = '.$id_mod_paie;
			echo '<br> id_type_lic = '.$id_type_lic;
			echo '<br> id_sous_type_paie = '.$id_sous_type_paie;*/

			$requete = $connexion-> prepare("UPDATE licence SET num_lic= ?,  date_val = ?,
													acheteur = ?, commodity = ?, fob = ?,
													fret = ?, assurance = ?, autre_frais = ?,
													id_mon = ?, id_mod_paie = ?, id_type_lic = ?,
													id_sous_type_paie = ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic'], $entree['date_val'], $entree['acheteur'],
									$entree['commodity'], $entree['fob'], $entree['fret'],
									$entree['assurance'], $entree['autre_frais'], $entree['id_mon'],
									$entree['id_mod_paie'], $entree['id_type_lic'], $entree['id_sous_type_paie'],
									$entree['num_lic_old']));

			if ($date_exp != $this-> getLastEpirationLicence2($num_lic)) {
				$this-> annulerDateExpirationLicence($num_lic);
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

			$this-> modifierLicencePourDossier($num_lic, $num_lic_old);

		}

		public function modifierClient2($id_cli, $nom_cli, $code_cli,
										$rccm_cli, $id_nat, $num_imp_exp,
										$num_tva, $adr_cli, $actif, $photo, $tmp, 
										$nif_cli, $tel_cli, $mail_cli){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['nom_cli'] = $nom_cli;
			$entree['code_cli'] = $code_cli;
			$entree['rccm_cli'] = $rccm_cli;
			$entree['id_nat'] = $id_nat;
			$entree['num_imp_exp'] = $num_imp_exp;
			$entree['num_tva'] = $num_tva;
			$entree['adr_cli'] = $adr_cli;
			$entree['actif'] = $actif;
			$entree['photo'] = $photo;
			$entree['nif_cli'] = $nif_cli;
			$entree['tel_cli'] = $tel_cli;
			$entree['mail_cli'] = $mail_cli;

			$requete = $connexion-> prepare("UPDATE client SET nom_cli= ?,  code_cli = ?,
													rccm_cli = ?, id_nat = ?, num_imp_exp = ?,
													num_tva = ?, adr_cli = ?, actif = ?, nif_cli = ?, 
													tel_cli = ?, mail_cli = ?
												WHERE id_cli = ?");
			$requete-> execute(array($entree['nom_cli'], $entree['code_cli'], 
									$entree['rccm_cli'], $entree['id_nat'], 
									$entree['num_imp_exp'], $entree['num_tva'],
									$entree['adr_cli'], $entree['actif'], 
									$entree['nif_cli'], $entree['tel_cli'], 
									$entree['mail_cli'], $entree['id_cli']));

			if ($tmp != null) {
				
				move_uploaded_file($tmp, '../images/clients/' . basename($photo));
				
				$requete = $connexion-> prepare("UPDATE client SET photo= ?
													WHERE id_cli = ?");
				$requete-> execute(array($entree['photo'], $entree['id_cli']));
				
			}

		}

		public function modifierMarchandiseDossier($nom_march, $id_dos, $id_util,
											$origine, $ref_fact, $nbr_bags, 
											$id_emb, $supplier, $poids_brut, 
											$poids, $id_unit_mes, $fob, 
											$fret, $assurance, $autre_frais, 
											$num_av, $num_lic, $fxi, 
											$code_tarif_march, $id_mon, $id_march_dos, $num_exo){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['nom_march'] = $nom_march;
			$entree['id_dos'] = $id_dos;

			$entree['origine'] = $origine;
			$entree['ref_fact'] = $ref_fact;
			$entree['nbr_bags'] = $nbr_bags;
			$entree['id_emb'] = $id_emb;
			$entree['supplier'] = $supplier;
			$entree['poids_brut'] = $poids_brut;
			$entree['poids'] = $poids;
			$entree['id_unit_mes'] = $id_unit_mes;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['num_av'] = $num_av;
			$entree['num_lic'] = $num_lic;
			$entree['fxi'] = $fxi;
			$entree['code_tarif_march'] = $code_tarif_march;
			$entree['id_mon'] = $id_mon;
			$entree['id_march_dos'] = $id_march_dos;
			$entree['num_exo'] = $num_exo;

			// echo '<br>-----------------------------------id_util = '.$id_util;
			// //echo '<br>-----------------------------------id_march = '.$id_march;
			// echo '<br>-----------------------------------id_dos = '.$id_dos;
			// echo '<br>-----------------------------------origine = '.$origine;
			// echo '<br>-----------------------------------ref_fact = '.$ref_fact;
			// echo '<br>-----------------------------------nbr_bags = '.$nbr_bags;
			// echo '<br>-----------------------------------id_emb = '.$id_emb;
			// echo '<br>-----------------------------------supplier = '.$supplier;
			// echo '<br>-----------------------------------poids_brut = '.$poids_brut;
			// echo '<br>-----------------------------------poids = '.$poids;
			// echo '<br>-----------------------------------id_unit_mes = '.$id_unit_mes;
			// echo '<br>-----------------------------------fob = '.$fob;
			// echo '<br>-----------------------------------fret = '.$fret;
			// echo '<br>-----------------------------------assurance = '.$assurance;
			// echo '<br>-----------------------------------autre_frais = '.$autre_frais;
			// echo '<br>-----------------------------------num_av = '.$num_av;
			// echo '<br>-----------------------------------num_lic = '.$num_lic;
			// echo '<br>-----------------------------------fxi = '.$fxi;
			// echo '<br>-----------------------------------code_tarif_march = '.$code_tarif_march;
			// echo '<br>-----------------------------------id_mon = '.$id_mon;
			// echo '<br>-----------------------------------id_march_dos = '.$id_march_dos;

			$requete = $connexion-> prepare("UPDATE marchandise_dossier 
													SET nom_march = ?, id_dos = ?, id_util = ?,
														origine = ?, ref_fact = ?, nbr_bags = ?, id_emb = ?, 
														supplier = ?, poids_brut = ?, poids = ?, id_unit_mes = ?, 
														fob = ?, fret = ?, assurance = ?, autre_frais = ?, num_av = ?, 
														num_lic = ?, fxi = ?, code_tarif_march = ?, id_mon = ?, num_exo = ? 
													WHERE id_march_dos = ?");
			$requete-> execute(array($entree['nom_march'], $entree['id_dos'], $entree['id_util'],
									$entree['origine'], $entree['ref_fact'], $entree['nbr_bags'],
									$entree['id_emb'], $entree['supplier'], $entree['poids_brut'],
									$entree['poids'], $entree['id_unit_mes'], $entree['fob'], 
									$entree['fret'], $entree['assurance'], $entree['autre_frais'],
									$entree['num_av'], $entree['num_lic'], $entree['fxi'], 
									$entree['code_tarif_march'], $entree['id_mon'],  $entree['num_exo'], $entree['id_march_dos']));

			$requeteMarchandise = $connexion-> prepare('SELECT SUM(nbr_bags) AS nbr_bags, 
																SUM(poids_brut) AS poids_brut, 
																SUM(poids) AS poids,
																SUM(fob) AS fob,
																SUM(fret) AS fret,
																SUM(assurance) AS assurance,
																SUM(autre_frais) AS autre_frais,
																id_mon
															FROM marchandise_dossier
															WHERE id_dos = ?');
			$requeteMarchandise-> execute(array($entree['id_dos']));
			$reponseMarchandise = $requeteMarchandise-> fetch();

			$this-> MAJ_nbr_bags($entree['id_dos'], $reponseMarchandise['nbr_bags']);
			$this-> MAJ_poids_brut($entree['id_dos'], $reponseMarchandise['poids_brut']);
			$this-> MAJ_poids($entree['id_dos'], $reponseMarchandise['poids']);
			$this-> MAJ_fob($entree['id_dos'], $reponseMarchandise['fob']);
			$this-> MAJ_montant_decl($entree['id_dos'], $reponseMarchandise['fob']);
			$this-> MAJ_id_mon($id_dos, $id_mon);
		}

		public function modifierLicencePourDossier($num_lic, $num_lic_old){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['num_lic_old'] = $num_lic_old;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/

			$requete = $connexion-> prepare("UPDATE dossier SET num_lic= ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic'], $entree['num_lic_old']));

		}

		public function reception_transmit($id_trans_ap){

			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare("UPDATE transmission_apurement 
												SET date_recep = NOW(), id_util_recep = ?
												WHERE id_trans_ap = ?");
			$requete-> execute(array($_SESSION['id_util'], $entree['id_trans_ap']));

		}

		public function rejet_transmit($id_trans_ap, $motif){

			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;
			$entree['motif'] = $motif;

			$requete = $connexion-> prepare("UPDATE transmission_apurement 
												SET date_recep = NULL, id_util_recep = NULL,
													-- date_envoi = NULL, id_util_envoi = NULL,
													date_rejet = NOW(), id_util_rejet = ?, motif = ?
												WHERE id_trans_ap = ?");
			$requete-> execute(array($_SESSION['id_util'], $entree['motif'], $entree['id_trans_ap']));

		}

		public function envoyer_transmis($id_trans_ap){

			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare("UPDATE transmission_apurement 
												SET date_envoi = NOW(), id_util_envoi = ?,
													date_rejet = NULL, id_util_rejet = NULL
												WHERE id_trans_ap = ?");
			$requete-> execute(array($_SESSION['id_util'], $entree['id_trans_ap']));

		}

		// public function reception_transmis($id_trans_ap){

		// 	include('connexion.php');
		// 	$entree['id_trans_ap'] = $id_trans_ap;

		// 	$requete = $connexion-> prepare("UPDATE transmission_apurement 
		// 										SET date_recep = NOW(), id_util_recep = ?
		// 										WHERE id_trans_ap = ?");
		// 	$requete-> execute(array($_SESSION['id_util'], $entree['id_trans_ap']));

		// }

		public function valider_ticket($id_tick){

			include('connexion.php');
			$entree['id_tick'] = $id_tick;

			$requete = $connexion-> prepare("UPDATE ticket SET date_validation = NOW(), validation = '1', id_util_val = ?
												WHERE id_tick = ?");
			$requete-> execute(array($_SESSION['id_util'], $entree['id_tick']));

		}

		public function maj_date_debut_trait($id_tick, $date_debut_trait){

			include('connexion.php');
			$entree['id_tick'] = $id_tick;
			$entree['date_debut_trait'] = $date_debut_trait;

			// echo '<br>id_tick = '.$id_tick;
			// echo '<br>date_debut_trait = '.$date_debut_trait;

			$requete = $connexion-> prepare("UPDATE ticket SET date_debut_trait = ?, id_stat = '2', id_util_debut_trait = ?
												WHERE id_tick = ?");
			$requete-> execute(array($entree['date_debut_trait'], $_SESSION['id_util'], $entree['id_tick']));

		}

		public function debut_traitement($id_tick){

			include('connexion.php');
			$entree['id_tick'] = $id_tick;

			// echo '<br>id_tick = '.$id_tick;
			// echo '<br>date_debut_trait = '.$date_debut_trait;

			$requete = $connexion-> prepare("UPDATE ticket SET date_debut_trait = NOW(), id_stat = '2', id_util_debut_trait = ?
												WHERE id_tick = ?");
			$requete-> execute(array($_SESSION['id_util'], $entree['id_tick']));

		}

		public function fin_traitement($id_tick){

			include('connexion.php');
			$entree['id_tick'] = $id_tick;

			// echo '<br>id_tick = '.$id_tick;
			// echo '<br>date_fin_trait = '.$date_fin_trait;

			$requete = $connexion-> prepare("UPDATE ticket SET date_fin_trait = NOW(), id_stat = '5', id_util_fin_trait = ?
												WHERE id_tick = ?");
			$requete-> execute(array($_SESSION['id_util'], $entree['id_tick']));

		}

		public function maj_date_fin_trait($id_tick, $date_fin_trait){

			include('connexion.php');
			$entree['id_tick'] = $id_tick;
			$entree['date_fin_trait'] = $date_fin_trait;

			$requete = $connexion-> prepare("UPDATE ticket SET date_fin_trait = ?, id_stat = '5', id_util_fin_trait = ?
												WHERE id_tick = ?");
			$requete-> execute(array($entree['date_fin_trait'], $_SESSION['id_util'], $entree['id_tick']));

		}

		public function modifierClient($nom_cli, $id_cli,$ville_cli, $account_manager, $influence_intern, $influence_extern, $info_cli, $etat_cli){

			include('connexion.php');
			$entree['nom_cli'] = $nom_cli;
			$entree['id_cli'] = $id_cli;
			$entree['ville_cli'] = $ville_cli;
			$entree['account_manager'] = $account_manager;
			$entree['influence_intern'] = $influence_intern;
			$entree['influence_extern'] = $influence_extern;
			$entree['info_cli'] = $info_cli;
			$entree['etat_cli'] = $etat_cli;

			// echo '<br> nom_cli = '.$nom_cli;
			// echo '<br> ville_cli = '.$ville_cli;
			// echo '<br> account_manager = '.$account_manager;
			// echo '<br> contact_cli = '.$contact_cli;
			// echo '<br> tel_contact_cli = '.$tel_contact_cli;
			// echo '<br> mail_contact_cli = '.$mail_contact_cli;
			// echo '<br> influence_intern = '.$influence_intern;
			// echo '<br> influence_extern = '.$influence_extern;
			// echo '<br> domain_activ = '.$domain_activ;
			// echo '<br> date_appel_offre = '.$date_appel_offre;
			// echo '<br> info_cli = '.$info_cli;

			$requete = $connexion-> prepare("UPDATE client SET nom_cli = ?, ville_cli = ?, account_manager= ?, 
																influence_intern= ?, influence_extern= ?, info_cli= ?, etat_cli = ?
												WHERE id_cli = ?");
			$requete-> execute(array($entree['nom_cli'], $entree['ville_cli'], $entree['account_manager'], 
										$entree['influence_intern'], $entree['influence_extern'], $entree['info_cli'], $entree['etat_cli'], $entree['id_cli']));

		}

		public function validerFeuilleCalcul($id_dos, $id_util){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_util'] = $id_util;

			/*echo '<br> id_dos = '.$id_dos;
			echo '<br> id_util = '.$id_util;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/

			$requete = $connexion-> prepare("UPDATE dossier SET id_util_verif_feuil_calc = ?, date_verif_feuil_calc = NOW()
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_dos']));


			$requeteMarchandise = $connexion-> prepare('SELECT SUM(nbr_bags) AS nbr_bags, 
																SUM(poids_brut) AS poids_brut, 
																SUM(poids) AS poids,
																SUM(fob) AS fob,
																SUM(fret) AS fret,
																SUM(assurance) AS assurance,
																SUM(autre_frais) AS autre_frais,
																id_mon
															FROM marchandise_dossier
															WHERE id_dos = ?');
			$requeteMarchandise-> execute(array($entree['id_dos']));
			$reponseMarchandise = $requeteMarchandise-> fetch();

			$this-> MAJ_nbr_bags($entree['id_dos'], $reponseMarchandise['nbr_bags']);
			$this-> MAJ_poids_brut($entree['id_dos'], $reponseMarchandise['poids_brut']);
			$this-> MAJ_poids($entree['id_dos'], $reponseMarchandise['poids']);
			$this-> MAJ_fob($entree['id_dos'], $reponseMarchandise['fob']);
			// $this-> MAJ_fret($entree['id_dos'], $reponseMarchandise['fret']);
			// $this-> MAJ_assurance($entree['id_dos'], $reponseMarchandise['assurance']);
			// $this-> MAJ_autre_frais($entree['id_dos'], $reponseMarchandise['autre_frais']);
			// $this-> MAJ_id_mon($entree['id_dos'], $reponseMarchandise['id_mon']);

		}

		public function validerDepenseDossier($id_dep, $id_util){

			include('connexion.php');
			$entree['id_dep'] = $id_dep;
			$entree['id_util'] = $id_util;

			/*echo '<br> id_dep = '.$id_dep;
			echo '<br> id_util = '.$id_util;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/

			$requete = $connexion-> prepare("UPDATE depense_dossier SET id_util_val = ?, date_val = NOW(), etat = '1'
												WHERE id_dep = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_dep']));

		}

		public function uploadAccuseeRecpetionTransmissionApurement($id_trans_ap, $fichier_trans_ap, $tmp){

			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;
			$entree['fichier_trans_ap'] = $fichier_trans_ap;

			$transmision_apurement = '../transmision_apurements/'.$id_trans_ap;

			if(!is_dir($transmision_apurement)){
				mkdir("../transmision_apurements/$id_trans_ap", 0777);
			}

			move_uploaded_file($tmp, '../transmision_apurements/'.$id_trans_ap.'/' . basename($fichier_trans_ap));

			$requete = $connexion-> prepare("UPDATE transmission_apurement SET fichier_trans_ap= ?
												WHERE id_trans_ap = ?");
			$requete-> execute(array($entree['fichier_trans_ap'], $entree['id_trans_ap']));



		}

		public function uploadAccuseeReceptionTransmisFacture($id_trans_fact, $fichier_trans_fact, $tmp){

			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;
			$entree['fichier_trans_fact'] = $fichier_trans_fact;

			// echo '<br>------------------------------------------id_trans_fact = '.$id_trans_fact;
			// echo '<br>------------------------------------------fichier_trans_fact = '.$fichier_trans_fact;

			$transmision_apurement = '../transmis_factures/'.$id_trans_fact;

			if(!is_dir($transmision_apurement)){
				mkdir("../transmis_factures/$id_trans_fact", 0777);
			}

			move_uploaded_file($tmp, '../transmis_factures/'.$id_trans_fact.'/' . basename($fichier_trans_fact));

			$requete = $connexion-> prepare("UPDATE transmis_facture_dossier SET fichier_trans_fact= ?
												WHERE id_trans_fact = ?");
			$requete-> execute(array($entree['fichier_trans_fact'], $entree['id_trans_fact']));



		}

		public function validerFinger($id_trans_fact){

			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;

			$requete = $connexion-> prepare("UPDATE transmis_facture_dossier 
												SET finger = '1', id_util_finger = ?, 
													date_finger = CURRENT_DATE()
												WHERE id_trans_fact = ?");
			$requete-> execute(array($_SESSION['id_util'], $entree['id_trans_fact']));



		}

		public function validerFinger2($ref_fact){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("UPDATE facture_dossier 
												SET finger = '1', id_util_finger = ?, 
													date_finger = NOW()
												WHERE ref_fact = ?");
			$requete-> execute(array($_SESSION['id_util'], $entree['ref_fact']));



		}

		public function fingerOut($ref_fact){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("UPDATE facture_dossier 
												SET finger = '0', id_util_finger = NULL, 
													date_finger = NULL
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));



		}

		public function updateMultipleFiles($debut, $fin, $klsa_arriv,
			                                  $crossing_date, $wiski_arriv, $wiski_dep,
			                                  $amicong_arriv, $insp_receiv, $ir,
			                                  $ref_crf, $date_crf, $dgda_in, $ref_decl,
			                                  $ref_liq, $date_liq, $ref_quit,
			                                  $date_quit, $custom_deliv, $cleared,
			                                  $dispatch_deliv, $statut, $remarque,
			                                  $nbre, $id_cli, $id_mod_trans, $id_mod_lic,
			                                  $commodity){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) {
				# code...
			}*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.ref_dos BETWEEN ? AND ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'],
									$entree['debut'], $entree['fin']));

			while($reponse = $requete-> fetch()){

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($date_decl) && ($date_decl != '')) {
		        $this-> MAJ_date_decl($reponse['id_dos'], $date_decl);
		      }

		      if (isset($ref_liq) && ($ref_liq != '')) {
		        $this-> MAJ_ref_liq($reponse['id_dos'], $ref_liq);
		      }

		      if (isset($date_liq) && ($date_liq != '')) {
		        $this-> MAJ_date_liq($reponse['id_dos'], $date_liq);
		      }

		      if (isset($ref_quit) && ($ref_quit != '')) {
		        $this-> MAJ_ref_quit($reponse['id_dos'], $ref_quit);
		      }

		      if (isset($date_quit) && ($date_quit != '')) {
		        $this-> MAJ_date_quit($reponse['id_dos'], $date_quit);
		      }

		      if (isset($montant_decl) && ($montant_decl != '')) {
		        $this-> MAJ_montant_decl($reponse['id_dos'], $montant_decl);
		      }

		      if (isset($klsa_arriv) && ($klsa_arriv != '')) {
		        $this-> MAJ_klsa_arriv($reponse['id_dos'], $klsa_arriv);
		      }

		      if (isset($crossing_date) && ($crossing_date != '')) {
		        $this-> MAJ_crossing_date($reponse['id_dos'], $crossing_date);
		      }

		      if (isset($wiski_arriv) && ($wiski_arriv != '')) {
		        $this-> MAJ_wiski_arriv($reponse['id_dos'], $wiski_arriv);
		      }

		      if (isset($wiski_dep) && ($wiski_dep != '')) {
		        $this-> MAJ_wiski_dep($reponse['id_dos'], $wiski_dep);
		      }

		      if (isset($ref_crf) && ($ref_crf != '')) {
		        $this-> MAJ_ref_crf($reponse['id_dos'], $ref_crf);
		      }

		      if (isset($date_crf) && ($date_crf != '')) {
		        $this-> MAJ_date_crf($reponse['id_dos'], $date_crf);
		      }

		      if (isset($dgda_in) && ($dgda_in != '')) {
		        $this-> MAJ_dgda_in($reponse['id_dos'], $dgda_in);
		      }

		      if (isset($dgda_out) && ($dgda_out != '')) {
		        $this-> MAJ_dgda_out($reponse['id_dos'], $dgda_out);
		      }

		      if (isset($date_preal) && ($date_preal != '')) {
		        $this-> MAJ_date_preal($reponse['id_dos'], $date_preal);
		      }

		      if (isset($custom_deliv) && ($custom_deliv != '')) {
		        $this-> MAJ_custom_deliv($reponse['id_dos'], $custom_deliv);
		      }

		      if (isset($dispatch_klsa) && ($dispatch_klsa != '')) {
		        $this-> MAJ_dispatch_klsa($reponse['id_dos'], $dispatch_klsa);
		      }

		      if (isset($dispatch_deliv) && ($dispatch_deliv != '')) {
		        $this-> MAJ_dispatch_deliv($reponse['id_dos'], $dispatch_deliv);
		      }

		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($statut) && ($statut != '')) {
		        $this-> MAJ_statut($reponse['id_dos'], $statut);
		      }

		      if (isset($remarque) && ($remarque != '')) {
		        $this-> MAJ_remarque($reponse['id_dos'], $remarque);
		      }

		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($amicongo_arriv) && ($amicongo_arriv != '')) {
		        $this-> MAJ_amicongo_arriv($reponse['id_dos'], $amicongo_arriv);
		      }

		      if (isset($insp_receiv) && ($insp_receiv != '')) {
		        $this-> MAJ_insp_receiv($reponse['id_dos'], $insp_receiv);
		      }

		      if (isset($ir) && ($ir != '')) {
		        $this-> MAJ_ir($reponse['id_dos'], $ir);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		      	//echo "<br> $ref_decl";
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

			}

		}

		public function updateMultipleFiles2($debut, $fin, $data){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) {
				# code...
			}*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.ref_dos BETWEEN ? AND ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'],
									$entree['debut'], $entree['fin']));

			while($reponse = $requete-> fetch()){

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($date_decl) && ($date_decl != '')) {
		        $this-> MAJ_date_decl($reponse['id_dos'], $date_decl);
		      }

		      if (isset($ref_liq) && ($ref_liq != '')) {
		        $this-> MAJ_ref_liq($reponse['id_dos'], $ref_liq);
		      }

		      if (isset($date_liq) && ($date_liq != '')) {
		        $this-> MAJ_date_liq($reponse['id_dos'], $date_liq);
		      }

		      if (isset($ref_quit) && ($ref_quit != '')) {
		        $this-> MAJ_ref_quit($reponse['id_dos'], $ref_quit);
		      }

		      if (isset($date_quit) && ($date_quit != '')) {
		        $this-> MAJ_date_quit($reponse['id_dos'], $date_quit);
		      }

		      if (isset($montant_decl) && ($montant_decl != '')) {
		        $this-> MAJ_montant_decl($reponse['id_dos'], $montant_decl);
		      }

		      if (isset($klsa_arriv) && ($klsa_arriv != '')) {
		        $this-> MAJ_klsa_arriv($reponse['id_dos'], $klsa_arriv);
		      }

		      if (isset($crossing_date) && ($crossing_date != '')) {
		        $this-> MAJ_crossing_date($reponse['id_dos'], $crossing_date);
		      }

		      if (isset($wiski_arriv) && ($wiski_arriv != '')) {
		        $this-> MAJ_wiski_arriv($reponse['id_dos'], $wiski_arriv);
		      }

		      if (isset($wiski_dep) && ($wiski_dep != '')) {
		        $this-> MAJ_wiski_dep($reponse['id_dos'], $wiski_dep);
		      }

		      if (isset($ref_crf) && ($ref_crf != '')) {
		        $this-> MAJ_ref_crf($reponse['id_dos'], $ref_crf);
		      }

		      if (isset($date_crf) && ($date_crf != '')) {
		        $this-> MAJ_date_crf($reponse['id_dos'], $date_crf);
		      }

		      if (isset($dgda_in) && ($dgda_in != '')) {
		        $this-> MAJ_dgda_in($reponse['id_dos'], $dgda_in);
		      }

		      if (isset($dgda_out) && ($dgda_out != '')) {
		        $this-> MAJ_dgda_out($reponse['id_dos'], $dgda_out);
		      }

		      if (isset($date_preal) && ($date_preal != '')) {
		        $this-> MAJ_date_preal($reponse['id_dos'], $date_preal);
		      }

		      if (isset($custom_deliv) && ($custom_deliv != '')) {
		        $this-> MAJ_custom_deliv($reponse['id_dos'], $custom_deliv);
		      }

		      if (isset($dispatch_klsa) && ($dispatch_klsa != '')) {
		        $this-> MAJ_dispatch_klsa($reponse['id_dos'], $dispatch_klsa);
		      }

		      if (isset($dispatch_deliv) && ($dispatch_deliv != '')) {
		        $this-> MAJ_dispatch_deliv($reponse['id_dos'], $dispatch_deliv);
		      }

		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($statut) && ($statut != '')) {
		        $this-> MAJ_statut($reponse['id_dos'], $statut);
		      }

		      if (isset($remarque) && ($remarque != '')) {
		        $this-> MAJ_remarque($reponse['id_dos'], $remarque);
		      }

		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($amicongo_arriv) && ($amicongo_arriv != '')) {
		        $this-> MAJ_amicongo_arriv($reponse['id_dos'], $amicongo_arriv);
		      }

		      if (isset($insp_receiv) && ($insp_receiv != '')) {
		        $this-> MAJ_insp_receiv($reponse['id_dos'], $insp_receiv);
		      }

		      if (isset($ir) && ($ir != '')) {
		        $this-> MAJ_ir($reponse['id_dos'], $ir);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		      	//echo "<br> $ref_decl";
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

			}

		}

		public function updateMultipleFilesExport($debut, $fin, $id_cli, $id_mod_trans, $id_mod_lic){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) {
				# code...
			}*/

			$sql1 = "";
			/*if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}*/
			$method = '';
			$increment = 0;
			$maj = 'MAJ_';
			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.ref_dos BETWEEN ? AND ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'],
									$entree['debut'], $entree['fin']));

			while($reponse = $requete-> fetch()){
				$increment = 0;
				foreach ($this->getNameRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans']) as $champCol) {

				  if (isset($_POST[$champCol]) && ($_POST[$champCol] != '')) {
				  	$maj = 'MAJ_'.$champCol;
				  	//echo '<br>-------------------'.$champCol.' = '.$_POST[$champCol];
			        //$this-> $maj($reponse['id_dos'], $this-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment]);
			        $this-> $maj($reponse['id_dos'], $_POST[$champCol]);
			      }

			        //echo '<br>----------------------------'.$champCol.' = '.$maClasse-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment];
			        $increment++;
		      	}

		      /*if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }*/
			}

		}

		public function creerDepenseDossier($id_dep, $id_dos, $id_util, $id_deb, $montant, $date_dep){
			include('connexion.php');

			$entree['id_dep'] = $id_dep;
			$entree['id_dos'] = $id_dos;
			$entree['id_util'] = $id_util;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$entree['date_dep'] = $date_dep;

			// echo '<br>-----------------id_dep = '.$id_dep;
			// echo '<br>-----------------id_dos = '.$id_dos;
			// echo '<br>-----------------id_dos = '.$id_dos;
			// echo '<br>-----------------id_util = '.$id_util;

			$requete = $connexion-> prepare('INSERT INTO depense_dossier(id_dep, id_dos, id_util, id_deb, montant, date_dep)
												VALUES(?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['id_dep'], $entree['id_dos'], $entree['id_util'], $entree['id_deb'], $entree['montant'], $entree['date_dep']));
		}
		
		public function creerLogDossier($colonne, $valeur, $id_dos, $id_util){
			include('connexion.php');

			$entree['colonne'] = $colonne;
			$entree['valeur'] = $valeur;
			$entree['id_dos'] = $id_dos;
			$entree['id_util'] = $id_util;

			// echo '<br>-----------------colonne = '.$colonne;
			// echo '<br>-----------------valeur = '.$valeur;
			// echo '<br>-----------------id_dos = '.$id_dos;
			// echo '<br>-----------------id_util = '.$id_util;

			$requete = $connexion-> prepare('INSERT INTO log_dossier(colonne, valeur, id_dos, id_util)
												VALUES(?, ?, ?, ?)');
			$requete-> execute(array($entree['colonne'], $entree['valeur'], $entree['id_dos'], $entree['id_util']));
		}
		
			
		public function ajouterActePV($date_act, $detail_act, $id_pv){
			include('connexion.php');

			$entree['date_act'] = $date_act;
			$entree['detail_act'] = $detail_act;
			$entree['id_pv'] = $id_pv;
			// $entree['id_util'] = $id_util;

			// echo '<br>-----------------date_act = '.$date_act;
			// echo '<br>-----------------detail_act = '.$detail_act;
			// echo '<br>-----------------id_pv = '.$id_pv;
			// echo '<br>-----------------id_util = '.$id_util;

			$requete = $connexion-> prepare('INSERT INTO acte_pv(date_act, detail_act, id_pv, id_util)
												VALUES(?, ?, ?, ?)');
			$requete-> execute(array($entree['date_act'], $entree['detail_act'], $entree['id_pv'], $_SESSION['id_util']));
		}
			
		public function creerDebours($nom_deb, $abr_deb, $id_t_deb){
			include('connexion.php');

			$entree['nom_deb'] = $nom_deb;
			$entree['abr_deb'] = $abr_deb;
			$entree['id_t_deb'] = $id_t_deb;
			// $entree['id_util'] = $id_util;

			// echo '<br>-----------------nom_deb = '.$nom_deb;
			// echo '<br>-----------------abr_deb = '.$abr_deb;
			// echo '<br>-----------------id_t_deb = '.$id_t_deb;
			// echo '<br>-----------------id_util = '.$id_util;

			$requete = $connexion-> prepare('INSERT INTO debours(nom_deb, abr_deb, id_t_deb)
												VALUES(?, ?, ?)');
			$requete-> execute(array($entree['nom_deb'], $entree['abr_deb'], $entree['id_t_deb']));
		}
			
		public function creerUtilisateur($nom_util, $pseudo_util, $pass_util, $id_role, $tracking_delete, $tracking_log, $validation_facture){
			include('connexion.php');

			$entree['nom_util'] = $nom_util;
			$entree['pseudo_util'] = $pseudo_util;
			$entree['pass_util'] = $pass_util;
			$entree['id_role'] = $id_role;
			$entree['tracking_delete'] = $tracking_delete;
			$entree['tracking_log'] = $tracking_log;
			$entree['validation_facture'] = $validation_facture;

			// echo '<br>-----------------nom_util = '.$nom_util;
			// echo '<br>-----------------pseudo_util = '.$pseudo_util;
			// echo '<br>-----------------pass_util = '.$pass_util;
			// echo '<br>-----------------id_role = '.$id_role;

			$requete = $connexion-> prepare('INSERT INTO utilisateur(nom_util, pseudo_util, pass_util, id_role, tracking_delete, tracking_log, validation_facture)
												VALUES(?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['nom_util'], $entree['pseudo_util'], $entree['pass_util'], $entree['id_role'], $entree['tracking_delete'], $entree['tracking_log'], $entree['validation_facture']));
		}

		public function nouvelleLicenceSimple($num_lic, $id_cli, $fob, $fret, $assurance, $autre_frais, $id_mod_lic, $id_mon, $id_banq, $id_type_lic, $date_val, $date_exp){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['id_cli'] = $id_cli;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mon'] = $id_mon;
			$entree['id_banq'] = $id_banq;
			$entree['id_type_lic'] = $id_type_lic;
			$entree['date_val'] = $date_val;


			// echo '<br><br><br><br><br>------------------num_lic = '.$num_lic;
			// echo '<br>------------------id_cli = '.$id_cli;
			// echo '<br>------------------fob = '.$fob;
			// echo '<br>------------------fret = '.$fret;
			// echo '<br>------------------assurance = '.$assurance;
			// echo '<br>------------------autre_frais = '.$autre_frais;
			// echo '<br>------------------id_mod_lic = '.$id_mod_lic;
			// echo '<br>------------------id_mon = '.$id_mon;

			$requete = $connexion-> prepare('INSERT INTO licence(num_lic, id_cli, fob, fret, assurance, autre_frais, id_mod_lic, id_mon, id_banq, id_type_lic, date_val)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['num_lic'], $entree['id_cli'], $entree['fob'], $entree['fret'], $entree['assurance'], $entree['autre_frais'], $entree['id_mod_lic'], $entree['id_mon'], $entree['id_banq'], $entree['id_type_lic'], $entree['date_val']));
			if ($date_exp != null) {
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

		}
		
		public function modifierAdresseMailUtilisateur($adresse_mail, $id_util){
			include('connexion.php');

			$entree['adresse_mail'] = $adresse_mail;
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare('UPDATE utilisateur
												SET adresse_mail = ?
												WHERE id_util = ?');
			$requete-> execute(array($entree['adresse_mail'], $entree['id_util']));
		}
		
		public function modifierUtilisateur($nom_util, $pseudo_util, $pass_util, $id_role, $tracking_delete, $tracking_log, $validation_facture, $active, $id_util, $adresse_mail, $val_cotation_valide, $ret_cotation_valide){
			include('connexion.php');

			$entree['nom_util'] = $nom_util;
			$entree['pseudo_util'] = $pseudo_util;
			$entree['pass_util'] = $pass_util;
			$entree['id_role'] = $id_role;
			$entree['tracking_delete'] = $tracking_delete;
			$entree['tracking_log'] = $tracking_log;
			$entree['validation_facture'] = $validation_facture;
			$entree['active'] = $active;
			$entree['id_util'] = $id_util;
			$entree['adresse_mail'] = $adresse_mail;
			$entree['val_cotation_valide'] = $val_cotation_valide;
			$entree['ret_cotation_valide'] = $ret_cotation_valide;

			// echo '<br>-----------------nom_util = '.$nom_util;
			// echo '<br>-----------------pseudo_util = '.$pseudo_util;
			// echo '<br>-----------------pass_util = '.$pass_util;
			// echo '<br>-----------------id_role = '.$id_role;

			$requete = $connexion-> prepare('UPDATE utilisateur
												SET nom_util = ?, pseudo_util = ?, pass_util = ?, 
													id_role = ?, tracking_delete = ?, tracking_log = ?, 
													validation_facture = ?, active = ?, adresse_mail = ?,
													val_cotation_valide = ?, ret_cotation_valide = ?
												WHERE id_util = ?');
			$requete-> execute(array($entree['nom_util'], $entree['pseudo_util'], $entree['pass_util'], $entree['id_role'], $entree['tracking_delete'], $entree['tracking_log'], $entree['validation_facture'], $entree['active'], $entree['adresse_mail'], $entree['val_cotation_valide'], $entree['ret_cotation_valide'], $entree['id_util']));
		}
		
		public function creerAffectationColonneUtilisateur($id_util, $id_col, $id_mod_lic, $id_mod_trans, $rang, $edit_tracking, $important){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_col'] = $id_col;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['rang'] = $rang;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['edit_tracking'] = $edit_tracking;
			$entree['important'] = $important;


			$requete = $connexion-> prepare('INSERT INTO affectation_colonne_utilisateur(id_util, id_col, id_mod_lic, id_mod_trans, rang, edit_tracking, important)
												VALUES(?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['id_util'], $entree['id_col'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['rang'], $entree['edit_tracking'], $entree['important']));
		}
		
		public function creerAffectationMarchandiseClientModeleLicence($id_cli, $id_march, $id_mod_lic, $code){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['code'] = $code;


			$requete = $connexion-> prepare('INSERT INTO affectation_marchandise_client_modele_licence(id_cli, id_march, id_mod_lic, code, menu_tracking)
												VALUES(?, ?, ?, ?, "1")');
			$requete-> execute(array($entree['id_cli'], $entree['id_march'], $entree['id_mod_lic'], $entree['code']));
		}
		
		public function AjoutFacturationModeleLicence($id_cli, $id_mod_lic, $modele_facture){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['modele_facture'] = $modele_facture;


			$requete = $connexion-> prepare('UPDATE affectation_client_modele_licence
												SET modele_facture = ?
												WHERE id_cli = ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['modele_facture'], $entree['id_cli'], $entree['id_mod_lic']));

			$requeteClient = $connexion-> prepare("DELETE FROM 
													affectation_debours_client_modele_licence
													WHERE  id_cli = ?
														AND id_mod_lic = ?");
			$requeteClient-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			$requeteClient = $connexion-> prepare("SELECT * 
													FROM affectation_debours_client_modele_licence
													WHERE  id_cli = ?
														AND id_mod_lic = ?");
			$requeteClient-> execute(array($entree['modele_facture'], $entree['id_mod_lic']));
			while($reponseClient = $requeteClient-> fetch()){

				$requeteInsertionDebours = $connexion-> prepare("INSERT INTO affectation_debours_client_modele_licence VALUES(?, ?, ?, NULL, ?, ?, ?, ?, ?, ?)");
				$requeteInsertionDebours-> execute(array($reponseClient['id_deb'], $entree['id_cli'], $reponseClient['id_mod_lic'], $reponseClient['montant'], $reponseClient['usd'], $reponseClient['tva'], $reponseClient['detail'], $reponseClient['id_mod_trans'], $reponseClient['id_t_trans']));

			}$requeteClient-> closeCursor();
		}
		
		public function creerAffectationDeboursClient($id_deb, $id_cli, $id_mod_lic, 
														$code_serv, $montant, $usd, 
														$tva, $detail, $id_mod_trans, 
														$id_t_trans){
			include("connexion.php");

			if ($montant == '') {
				$montant = NULL;
			}

			$entree['id_deb'] = $id_deb;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['code_serv'] = $code_serv;
			$entree['montant'] = $montant;
			$entree['usd'] = $usd;
			$entree['tva'] = $tva;
			$entree['detail'] = $detail;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_t_trans'] = $id_t_trans;

			$requeteInsertionDebours = $connexion-> prepare("INSERT INTO affectation_debours_client_modele_licence VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
				$requeteInsertionDebours-> execute(array($entree['id_deb'], $entree['id_cli'], $entree['id_mod_lic'], $entree['code_serv'], $entree['montant'], $entree['usd'], $entree['tva'], $entree['detail'], $entree['id_mod_trans'], $entree['id_t_trans']));
		}

		public function updateAffectationDeboursClient($id_deb, $id_cli, $id_mod_lic, 
														$code_serv, $montant, $usd, 
														$tva, $detail, $id_mod_trans){
			include("connexion.php");

			if ($montant == '') {
				$montant = NULL;
			}

			$entree['id_deb'] = $id_deb;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['code_serv'] = $code_serv;
			$entree['montant'] = $montant;
			$entree['usd'] = $usd;
			$entree['tva'] = $tva;
			$entree['detail'] = $detail;
			$entree['id_mod_trans'] = $id_mod_trans;

			// echo '<br>id_deb = '.$id_deb;
			// echo '<br>id_cli = '.$id_cli;
			// echo '<br>id_mod_lic = '.$id_mod_lic;
			// echo '<br>code_serv = '.$code_serv;
			// echo '<br>montant = '.$montant;
			// echo '<br>usd = '.$usd;
			// echo '<br>tva = '.$tva;
			// echo '<br>detail = '.$detail;

			$requeteInsertionDebours = $connexion-> prepare("UPDATE affectation_debours_client_modele_licence
								SET code_serv = ?, montant=?, usd=?, tva=?, detail=?
								WHERE id_deb = ?
									AND id_cli = ?
									AND id_mod_lic = ?
									AND id_mod_trans = ?");
				$requeteInsertionDebours-> execute(array($entree['code_serv'], $entree['montant'], $entree['usd'], $entree['tva'], $entree['detail'], $entree['id_deb'], $entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
		}

		public function creerAffectationClientModeleLicence($id_cli, $id_mod_lic, $code_finger){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['code_finger'] = $code_finger;


			$requete = $connexion-> prepare('INSERT INTO affectation_client_modele_licence(id_cli, id_mod_lic, code_finger)
												VALUES(?, ?, ?)');
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['code_finger']));
		}
		
		public function creerDossierTestClientLicenceMarchandiseTransport($id_cli, $id_mod_lic, 
																			$id_march, $id_mod_trans, 
																			$id_util){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_util'] = $id_util;

			//Récuperation des colonnes du dernier client créé
			$requeteDossier = $connexion-> prepare("INSERT INTO dossier(ref_dos, id_cli, num_lic, id_march, id_mod_lic, id_mod_trans, id_util, not_cotation, not_fact)
														VALUES('Test', ?, 'N/A', ?, ?, ?, ?, '1', '1')");
			$requeteDossier-> execute(array($entree['id_cli'], $entree['id_march'], $entree['id_mod_lic'], 
										$entree['id_mod_trans'], $entree['id_util']));
		}
		
		public function creerDossierTestClientLicenceMarchandiseTransport2($id_cli, $id_mod_lic, 
																			$id_march, $id_mod_trans){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			//Récuperation des colonnes du dernier client créé
			$requeteClient = $connexion-> prepare("SELECT id_cli
													FROM client 
													WHERE id_cli IN (
															SELECT id_cli 
																FROM affectation_colonne_client_modele_licence
																WHERE id_mod_lic = ?
																	AND id_mod_trans = ?
													)
													ORDER BY id_cli DESC
													LIMIT 0, 1");
			$requeteClient-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			$reponseClient = $requeteClient-> fetch();


			$requeteRecuperationColonne = $connexion-> prepare("SELECT * 
																	FROM affectation_colonne_client_modele_licence
																	WHERE id_cli = ?
																		AND id_mod_lic = ?
																		AND id_mod_trans = ?");
			$requeteRecuperationColonne-> execute(array($reponseClient['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			while($reponseRecuperationColonne=$requeteRecuperationColonne-> fetch()){

				//Affectation colonnes
				$requeteInsertionColonne = $connexion-> prepare("INSERT INTO 
																	affectation_colonne_client_modele_licence VALUES(?, ?, ?, ?, ?, ?, ?)");
				$requeteInsertionColonne-> execute(array($reponseRecuperationColonne['id_col'], 
														$entree['id_cli'], 
														$reponseRecuperationColonne['id_mod_lic'], 
														$reponseRecuperationColonne['id_mod_trans'], 
														$reponseRecuperationColonne['rang'], 
														$reponseRecuperationColonne['rang_tracking'], 
														$reponseRecuperationColonne['creation_dossier']));
				//FIN Affectation colonnes

			}$requeteRecuperationColonne-> closeCursor();

			//FIN Récuperation des colonnes du dernier client créé

		}
		
		public function affectationDeboursTaxeImportClient($id_cli, $code_serv){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;

			$connexion-> exec("INSERT INTO `affectation_debours_client_modele_licence` (
											`id_deb`, `id_cli`, `id_mod_lic`, `code_serv`, `montant`, `usd`, `tva`, `detail`, `id_mod_trans`, `id_t_trans`) 
								VALUES (1, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(2, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(3, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(4, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(5, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(6, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(7, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(8, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(9, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(16, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(17, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(18, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(19, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(20, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(30, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(48, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(50, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(56, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(57, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(58, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(66, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 3, 2),
									(67, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 3, 2),
									(68, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 3, 2),
									(69, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(70, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(71, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 2),
									(73, $id_cli, 2, '$code_serv', NULL, '0', '0', '0', 1, 1),
									(74, $id_cli, 2, '$code_serv', NULL, '0', '0', '1', 1, 1)");

		}
		
		public function affectationDeboursClient($id_deb, $id_cli, $id_mod_lic, $code_serv, $montant, $usd, 
													$tva, $detail, $id_mod_trans, $id_t_trans){
			include('connexion.php');

			$entree['id_deb'] = $id_deb;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['code_serv'] = $code_serv;
			$entree['montant'] = $montant;
			$entree['usd'] = $usd;
			$entree['tva'] = $tva;
			$entree['detail'] = $detail;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_t_trans'] = $id_t_trans;

			$requete = $connexion-> prepare("INSERT INTO `affectation_debours_client_modele_licence` (
											`id_deb`, `id_cli`, `id_mod_lic`, `code_serv`, `montant`, `usd`, `tva`, `detail`, `id_mod_trans`, `id_t_trans`) 
												VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['id_deb'], $entree['id_cli'], $entree['id_mod_lic'], 
									$entree['code_serv'], $entree['montant'], $entree['usd'], 
									$entree['tva'], $entree['detail'], $entree['id_mod_trans'], 
									$entree['id_t_trans']));

		}
		
		public function creerTicket($titre, $detail_tick, $id_mod, $id_prio, $date_const, $id_util, $fichier_ticket, $id_util_val){
			include('connexion.php');

			$entree['titre'] = $titre;
			$entree['detail_tick'] = $detail_tick;
			$entree['id_mod'] = $id_mod;
			$entree['id_prio'] = $id_prio;
			$entree['id_util'] = $id_util;
			$entree['date_const'] = $date_const;
			$entree['fichier_ticket'] = $fichier_ticket;
			$entree['id_util_val'] = $id_util_val;

			// echo '<br>detail_tick = '.$detail_tick;
			// echo '<br>id_mod = '.$id_mod;
			// echo '<br>id_prio = '.$id_prio;
			// echo '<br>id_util = '.$id_util;
			// echo '<br>date_const = '.$date_const;
			// echo '<br>fichier_ticket = '.$fichier_ticket;
			// echo '<br>id_util_val = '.$id_util_val;

			$requete = $connexion-> prepare('INSERT INTO ticket(titre, detail_tick, id_mod, id_prio, 
																date_const, id_util_emet, fichier_ticket, id_util_val)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['titre'], $entree['detail_tick'], $entree['id_mod'], $entree['id_prio'], $entree['date_const'], $entree['id_util'], $entree['fichier_ticket'], $entree['id_util_val']));
		}
		
		public function editTicket($detail_tick, $id_mod, $id_prio, $date_const, $id_tick){
			include('connexion.php');

			$entree['detail_tick'] = $detail_tick;
			$entree['id_mod'] = $id_mod;
			$entree['id_prio'] = $id_prio;
			$entree['id_tick'] = $id_tick;
			$entree['date_const'] = $date_const;

			// echo '<br>detail_tick = '.$detail_tick;
			// echo '<br>id_mod = '.$id_mod;
			// echo '<br>id_prio = '.$id_prio;
			// echo '<br>date_const = '.$date_const;
			// echo '<br>id_tick = '.$id_tick;

			$requete = $connexion-> prepare('UPDATE ticket 
												SET detail_tick = ?, 
													id_mod = ?,
													id_prio = ?,
													date_const = ?
												WHERE id_tick = ?');
			$requete-> execute(array($entree['detail_tick'], $entree['id_mod'], $entree['id_prio'], $entree['date_const'], $entree['id_tick']));
		}
		
		public function creerDossierViaRows($id_cli, $id_mod_trans, $id_mod_lic, $ref_dos, $ref_dos_2, $id_march, $num_lic, $id_util, $fob, $fret, $assurance, $autre_frais, $first_exp, $last_provenance, $origine, $bur_douane, $front_in, $front_out, $reg_dgda, $nbr_bags, $id_emb, $site_load, $site_offload, $remarque){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;
			$entree['ref_dos_2'] = $ref_dos_2;
			$entree['id_march'] = $id_march;
			$entree['num_lic'] = $num_lic;
			$entree['id_util'] = $id_util;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['first_exp'] = $first_exp;
			$entree['last_provenance'] = $last_provenance;
			$entree['origine'] = $origine;
			$entree['bur_douane'] = $bur_douane;
			$entree['front_in'] = $front_in;
			$entree['front_out'] = $front_out;
			$entree['reg_dgda'] = $reg_dgda;
			$entree['nbr_bags'] = $nbr_bags;
			$entree['id_emb'] = $id_emb;
			$entree['site_load'] = $site_load;
			$entree['site_offload'] = $site_offload;
			$entree['remarque'] = $remarque;
			$entree['montant_decl'] = $fob;


			// echo '<br> id_cli = '.$id_cli;
			// echo '<br> id_mod_trans = '.$id_mod_trans;
			// echo '<br> id_mod_lic = '.$id_mod_lic;
			// echo '<br> ref_dos = '.$ref_dos;
			// echo '<br> ref_dos_2 = '.$ref_dos_2;
			// echo '<br> id_march = '.$id_march;
			// echo '<br> num_lic = '.$num_lic;
			// echo '<br> id_util = '.$id_util;
			// echo '<br> fob = '.$fob;
			// echo '<br> fret = '.$fret;
			// echo '<br> assurance = '.$assurance;
			// echo '<br> autre_frais = '.$autre_frais;

			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) {
				# code...
			}*/

			if (isset($_GET['id_march']) && ($_GET['id_march'] == '11')) {
				$entree['id_t_dos'] = 2;
			}else{
				$entree['id_t_dos'] = 1;
			}

			$method = '';
			$increment = 0;
			$maj = 'MAJ_';

			if (($this-> getDossierRefDos($ref_dos)==NULL)) {

				$requeteCreationDossier = $connexion-> prepare("INSERT INTO dossier(id_cli, id_mod_trans, id_mod_lic, 
																					ref_dos, ref_dos_2, id_march, num_lic, 
																					id_util, fob, fret, assurance, autre_frais, 
																					id_t_dos, first_exp, last_provenance, origine,
																					bur_douane, front_in, front_out, reg_dgda, nbr_bags, id_emb, site_load, site_offload, remarque, 
																					montant_decl)
																		VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
				$requeteCreationDossier-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], 
														$entree['ref_dos'], $entree['ref_dos_2'], $entree['id_march'], $entree['num_lic'], $entree['id_util'], $entree['fob'], $entree['fret'], $entree['assurance'], $entree['autre_frais'], $entree['id_t_dos'], $entree['first_exp'], $entree['last_provenance'], $entree['origine'], $entree['bur_douane'], $entree['front_in'], $entree['front_out'], $entree['reg_dgda'], $entree['nbr_bags'], $entree['id_emb'], $entree['site_load'], $entree['site_offload'], $entree['remarque'], $entree['montant_decl']));

				$id_dos = $this-> getDossierRefDos($ref_dos)['id_dos'];

	            $this-> MAJ_statut($id_dos, 'Not declared');

				$increment = 0;
				foreach ($this->getNameRowUpdateCreationDossier($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans']) as $champCol) {

					if ($champCol == 'trailer_1' && $id_cli == '883' && $id_mod_lic == '2') {
						$this-> MAJ_trailer_1($id_dos, $_POST['trailer_1']);
						$this-> MAJ_trailer_2($id_dos, $_POST['trailer_2']);
					}else{

					  if (isset($_POST[$champCol]) && ($_POST[$champCol] != '')) {
					  	$maj = 'MAJ_'.$champCol;
					  	
				        $this-> $maj($id_dos, $_POST[$champCol]);
				        //Road manifest = Facture = Num Lot pour export
				        if ($champCol == 'num_lot') {
				        	$this-> MAJ_road_manif($id_dos, $_POST['num_lot']);
				        	$this-> MAJ_ref_fact($id_dos, $_POST['num_lot']);
				        }
				      }

					}

			        //echo '<br>----------------------------'.$champCol.' = '.$maClasse-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment];
			        $increment++;
		      	}

			    for ($i=1; $i <= $_POST['nbre_document']; $i++) { 
			      
			      if(isset($_FILES['fichier_'.$i]['name']) && $_FILES['fichier_'.$i]['name'] != ''){
			        $fichier=$_FILES['fichier_'.$i]['name'];
			        $tmp=$_FILES['fichier_'.$i]['tmp_name'];
			        //$num_dos = $maClasse-> getNumDossier($_POST['id_dos']);

			        $this-> archiver($id_dos, $_POST['id_doc_'.$i], $fichier, $tmp, $_POST['ref_dos']);
			      }

			    }

			    if ($id_march == '11') {
			    	$this-> MAJ_id_t_dos($id_dos, '2');
			    }
			}

		}

		public function creerDossierViaRowsDivers($id_cli, $id_mod_trans, $id_mod_lic, $ref_dos, $ref_dos_2, $id_march, $num_lic, $id_util, $fob, $fret, $assurance, $autre_frais, $first_exp, $last_provenance, $origine, $bur_douane, $front_in, $front_out, $reg_dgda, $nbr_bags, $id_emb, $site_load, $site_offload, $remarque){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;
			$entree['ref_dos_2'] = $ref_dos_2;
			$entree['id_march'] = $id_march;
			$entree['num_lic'] = $num_lic;
			$entree['id_util'] = $id_util;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['first_exp'] = $first_exp;
			$entree['last_provenance'] = $last_provenance;
			$entree['origine'] = $origine;
			$entree['bur_douane'] = $bur_douane;
			$entree['front_in'] = $front_in;
			$entree['front_out'] = $front_out;
			$entree['reg_dgda'] = $reg_dgda;
			$entree['nbr_bags'] = $nbr_bags;
			$entree['id_emb'] = $id_emb;
			$entree['site_load'] = $site_load;
			$entree['site_offload'] = $site_offload;
			$entree['remarque'] = $remarque;
			$entree['montant_decl'] = $fob;


			// echo '<br> id_cli = '.$id_cli;
			// echo '<br> id_mod_trans = '.$id_mod_trans;
			// echo '<br> id_mod_lic = '.$id_mod_lic;
			// echo '<br> ref_dos = '.$ref_dos;
			// echo '<br> ref_dos_2 = '.$ref_dos_2;
			// echo '<br> id_march = '.$id_march;
			// echo '<br> num_lic = '.$num_lic;
			// echo '<br> id_util = '.$id_util;
			// echo '<br> fob = '.$fob;
			// echo '<br> fret = '.$fret;
			// echo '<br> assurance = '.$assurance;
			// echo '<br> autre_frais = '.$autre_frais;

			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) {
				# code...
			}*/

			$sql1 = "";
			/*if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}*/
			$method = '';
			$increment = 0;
			$maj = 'MAJ_';

			if (($this-> getDossierRefDos($ref_dos)==NULL)) {

				$requeteCreationDossier = $connexion-> prepare("INSERT INTO dossier(id_cli, id_mod_trans, id_mod_lic, 
																					ref_dos, ref_dos_2, id_march, num_lic, 
																					id_util, fob, fret, assurance, autre_frais, 
																					principal, id_t_dos, first_exp, last_provenance, origine, bur_douane, front_in, front_out, reg_dgda, nbr_bags, id_emb, site_load, site_offload, remarque, montant_decl)
																		VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, '0', 2, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
				$requeteCreationDossier-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], 
														$entree['ref_dos'], $entree['ref_dos_2'], $entree['id_march'], $entree['num_lic'], $entree['id_util'], $entree['fob'], $entree['fret'], $entree['assurance'], $entree['autre_frais'], $entree['first_exp'], $entree['last_provenance'], $entree['origine'], $entree['bur_douane'], $entree['front_in'], $entree['front_out'], $entree['reg_dgda'], $entree['nbr_bags'], $entree['id_emb'], $entree['site_load'], $entree['site_offload'], $entree['remarque'], $entree['montant_decl']));

				$id_dos = $this-> getDossierRefDos($ref_dos)['id_dos'];

				$increment = 0;
				foreach ($this->getNameRowUpdateCreationDossier($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans']) as $champCol) {

				  if (isset($_POST[$champCol]) && ($_POST[$champCol] != '')) {

				  	// if ($_POST[$champCol] == 'supplier') {
				  	// 	echo '-----------------------------------------------------'.$_POST[$champCol];
				  	// }

				  	$maj = 'MAJ_'.$champCol;
				  	//echo '<br>-------------------'.$champCol.' = '.$_POST[$champCol];
			        //$this-> $maj($reponse['id_dos'], $this-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment]);
			        $this-> $maj($id_dos, $_POST[$champCol]);
			      }

			        //echo '<br>----------------------------'.$champCol.' = '.$maClasse-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment];
			        $increment++;
		      	}

			    for ($i=1; $i <= $_POST['nbre_document']; $i++) { 
			      
			      if(isset($_FILES['fichier_'.$i]['name']) && $_FILES['fichier_'.$i]['name'] != ''){
			        $fichier=$_FILES['fichier_'.$i]['name'];
			        $tmp=$_FILES['fichier_'.$i]['tmp_name'];
			        //$num_dos = $maClasse-> getNumDossier($_POST['id_dos']);

			        $this-> archiver($id_dos, $_POST['id_doc_'.$i], $fichier, $tmp, $_POST['ref_dos']);
			      }

			    }

			    if ($id_march == '11') {
			    	$this-> MAJ_id_t_dos($id_dos, '2');
			    }
			}

		}

		public function updateFile($id_dos, $id_cli, $id_mod_trans, $id_mod_lic){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_dos'] = $id_dos;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $id_dos, $fin);

			for ($i=1; $i <= $nbre ; $i++) {
				# code...
			}*/

			$sql1 = "";
			/*if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}*/
			$method = '';
			$increment = 0;
			$maj = 'MAJ_';
			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.id_dos = ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'],
									$entree['id_dos']));

			while($reponse = $requete-> fetch()){
				$increment = 0;
				foreach ($this->getNameRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans']) as $champCol) {

				  if (isset($_POST[$champCol]) && ($_POST[$champCol] != '')) {
				  	$maj = 'MAJ_'.$champCol;

				  	$this-> $maj($reponse['id_dos'], $this-> getRowUpdate2($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment]);

			        //$this-> $maj($reponse['id_dos'], $this-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment]);
			      }else{

				  		$requeteUpdate = $connexion-> prepare("UPDATE dossier SET $champCol = NULL WHERE id_dos = ?");
				  		$requeteUpdate-> execute(array($entree['id_dos']));

			      }

			        //echo '<br>----------------------------'.$champCol.' = '.$maClasse-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment];
			        $increment++;
		      	}

		      /*if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }*/
			}

		}

		public function updateMultipleFilesPopUp($debut, $fin, $klsa_arriv,
			                                  $crossing_date, $wiski_arriv, $wiski_dep,
			                                  $amicong_arriv, $insp_receiv, $ir,
			                                  $ref_crf, $date_crf, $dgda_in, $ref_decl,
			                                  $ref_liq, $date_liq, $ref_quit,
			                                  $date_quit, $dgda_out, $custom_deliv, $cleared,
			                                  $dispatch_deliv, $statut, $remarque,
			                                  $nbre, $id_cli, $id_mod_trans, $id_mod_lic,
			                                  $commodity, $type){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			/*echo '<br> debut = '.$debut;
			echo '<br> fin = '.$fin;
			echo '<br> dgda_out = '.$dgda_out;
			echo '<br> type = '.$type;
			echo '<br> id_cli = '.$id_cli;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans,
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) {
				# code...
			}*/
			$sqlType = '';
			$sqlClient = '';

			if (isset($type) && ($type == 'TOTAL FILES')) {
				$sqlType = '';
			}

			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND d.id_cli = '.$id_cli;
			}

			if (isset($type) && ($type == 'CLEARING COMPLETED')) {
				$sqlType = " AND d.cleared = '1'";
			}

			if (isset($type) && ($type == 'FILES IN PROCESS')) {
				$sqlType = " AND d.cleared = '0'";
			}

			if (isset($type) && ($type == 'CANCELLED')) {
				$sqlType = " AND d.cleared = '2'";
			}

			if (isset($type) && ($type == 'KASUMBALESA')) {
				$sqlType = " AND DATE(d.arrival_date) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'WISKI ARRIVAL')) {
				$sqlType = " AND DATE(d.wiski_arriv) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT WISKI')) {
				$sqlType = " AND (d.wiski_arriv IS NOT NULL AND d.wiski_arriv <> '')
												AND (d.wiski_dep IS NULL OR d.wiski_dep = '')";
			}

			if (isset($type) && ($type == 'WISKI DEPARTURE')) {
				$sqlType = " AND DATE(d.wiski_dep) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'AWAIT CRF')) {
				$sqlType = " AND (d.wiski_dep IS NOT NULL AND d.wiski_dep <> '')
												AND ( (d.date_crf IS NULL OR d.date_crf = '') AND (d.ref_crf IS NULL OR d.ref_crf = '' ))";
			}

			if (isset($type) && ($type == 'DGDA IN')) {
				$sqlType = " AND DATE(dgda_in) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT DGDA')) {
				$sqlType = " AND (d.dgda_in IS NOT NULL AND d.dgda_in <> '')
												AND (d.dgda_out IS NULL OR d.dgda_out = '')";
			}

			if (isset($type) && ($type == 'LIQUIDATED / AWAIT QUITTANCE')) {
				$sqlType = " AND ( (d.date_liq IS NOT NULL OR d.date_liq <> '')
													OR (d.ref_liq IS NOT NULL OR d.ref_liq <> '') )
												AND ( (d.date_quit IS NULL AND d.date_quit = '')
													AND (d.ref_quit IS NULL AND d.ref_quit = '') )";
			}

			if (isset($type) && ($type == 'QUITTANCE')) {
				$sqlType = " AND DATE(d.date_quit) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'DGDA OUT')) {
				$sqlType = " AND DATE(d.dgda_out) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'FILES CLEARED WAITING INVOICE')) {
				$sqlType = " AND d.cleared = '1'
												AND d.facture = '0'";
			}

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.ref_dos BETWEEN ? AND ?
													$sql1
													$sqlType
													$sqlClient
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic'],
									$entree['debut'], $entree['fin']));

			while($reponse = $requete-> fetch()){
				//echo $reponse['id_dos'].'<br>';
		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($date_decl) && ($date_decl != '')) {
		        $this-> MAJ_date_decl($reponse['id_dos'], $date_decl);
		      }

		      if (isset($ref_liq) && ($ref_liq != '')) {
		        $this-> MAJ_ref_liq($reponse['id_dos'], $ref_liq);
		      }

		      if (isset($date_liq) && ($date_liq != '')) {
		        $this-> MAJ_date_liq($reponse['id_dos'], $date_liq);
		      }

		      if (isset($ref_quit) && ($ref_quit != '')) {
		        $this-> MAJ_ref_quit($reponse['id_dos'], $ref_quit);
		      }

		      if (isset($date_quit) && ($date_quit != '')) {
		        $this-> MAJ_date_quit($reponse['id_dos'], $date_quit);
		      }

		      if (isset($montant_decl) && ($montant_decl != '')) {
		        $this-> MAJ_montant_decl($reponse['id_dos'], $montant_decl);
		      }

		      if (isset($klsa_arriv) && ($klsa_arriv != '')) {
		        $this-> MAJ_klsa_arriv($reponse['id_dos'], $klsa_arriv);
		      }

		      if (isset($crossing_date) && ($crossing_date != '')) {
		        $this-> MAJ_crossing_date($reponse['id_dos'], $crossing_date);
		      }

		      if (isset($wiski_arriv) && ($wiski_arriv != '')) {
		        $this-> MAJ_wiski_arriv($reponse['id_dos'], $wiski_arriv);
		      }

		      if (isset($wiski_dep) && ($wiski_dep != '')) {
		        $this-> MAJ_wiski_dep($reponse['id_dos'], $wiski_dep);
		      }

		      if (isset($ref_crf) && ($ref_crf != '')) {
		        $this-> MAJ_ref_crf($reponse['id_dos'], $ref_crf);
		      }

		      if (isset($date_crf) && ($date_crf != '')) {
		        $this-> MAJ_date_crf($reponse['id_dos'], $date_crf);
		      }

		      if (isset($dgda_in) && ($dgda_in != '')) {
		        $this-> MAJ_dgda_in($reponse['id_dos'], $dgda_in);
		      }

		      if (isset($dgda_out) && ($dgda_out != '')) {
		        $this-> MAJ_dgda_out($reponse['id_dos'], $dgda_out);
		      	//echo "<br> $dgda_out";
		      }

		      if (isset($date_preal) && ($date_preal != '')) {
		        $this-> MAJ_date_preal($reponse['id_dos'], $date_preal);
		      }

		      if (isset($custom_deliv) && ($custom_deliv != '')) {
		        $this-> MAJ_custom_deliv($reponse['id_dos'], $custom_deliv);
		      }

		      if (isset($dispatch_klsa) && ($dispatch_klsa != '')) {
		        $this-> MAJ_dispatch_klsa($reponse['id_dos'], $dispatch_klsa);
		      }

		      if (isset($dispatch_deliv) && ($dispatch_deliv != '')) {
		        $this-> MAJ_dispatch_deliv($reponse['id_dos'], $dispatch_deliv);
		      }

		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($statut) && ($statut != '')) {
		        $this-> MAJ_statut($reponse['id_dos'], $statut);
		      }

		      if (isset($remarque) && ($remarque != '')) {
		        $this-> MAJ_remarque($reponse['id_dos'], $remarque);
		      }

		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($amicongo_arriv) && ($amicongo_arriv != '')) {
		        $this-> MAJ_amicongo_arriv($reponse['id_dos'], $amicongo_arriv);
		      }

		      if (isset($insp_receiv) && ($insp_receiv != '')) {
		        $this-> MAJ_insp_receiv($reponse['id_dos'], $insp_receiv);
		      }

		      if (isset($ir) && ($ir != '')) {
		        $this-> MAJ_ir($reponse['id_dos'], $ir);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		      	//echo "<br> $ref_decl";
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

			}$requete-> closeCursor();

		}

		public function modifierFacture($ref_fact, $date_fact, $date_fact_rec, $fournisseur, $date_val,
										$id_cli, $commodity, $montant_fact, $id_mon, $fret_fact, $assurance_fact,
										$autre_frais_fact, $ref_fact_old){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['date_fact'] = $date_fact;
			$entree['date_fact_rec'] = $date_fact_rec;
			$entree['fournisseur'] = $fournisseur;
			$entree['date_val'] = $date_val;
			$entree['id_cli'] = $id_cli;
			$entree['commodity'] = $commodity;
			$entree['montant_fact'] = $montant_fact;
			$entree['id_mon'] = $id_mon;
			$entree['fret_fact'] = $fret_fact;
			$entree['assurance_fact'] = $assurance_fact;
			$entree['autre_frais_fact'] = $autre_frais_fact;
			$entree['ref_fact_old'] = $ref_fact_old;


			if ($fret_fact == '') {
				$fret_fact = NULL;
			}
			if ($assurance_fact == '') {
				$assurance_fact = NULL;
			}
			if ($autre_frais_fact == '') {
				$autre_frais_fact = NULL;
			}
			if ($montant_fact == '') {
				$montant_fact = NULL;
			}
			/*echo '<br> ref_fact = '.$ref_fact;
			echo '<br> date_fact = '.$date_fact;
			echo '<br> date_fact_rec = '.$date_fact_rec;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> date_val = '.$date_val;
			echo '<br> id_cli = '.$id_cli;
			echo '<br> commodity = '.$commodity;
			echo '<br> montant_fact = '.$montant_fact;
			echo '<br> id_mon = '.$id_mon;
			echo '<br> fret_fact = '.$fret_fact;
			echo '<br> assurance_fact = '.$assurance_fact;
			echo '<br> autre_frais_fact = '.$autre_frais_fact;
			echo '<br> ref_fact_old = '.$ref_fact_old;*/

			$requete = $connexion-> prepare("UPDATE facture_licence
														SET ref_fact = ?, date_fact = ?, date_fact_rec = ?,
															fournisseur = ?, date_val = ?, id_cli = ?,
															commodity = ?, montant_fact = ?, id_mon = ?,
															fret_fact = ?, assurance_fact = ?,
															autre_frais_fact = ?
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['date_fact'], $entree['date_fact_rec'],
									$entree['fournisseur'], $entree['date_val'], $entree['id_cli'],
									$entree['commodity'], $entree['montant_fact'], $entree['id_mon'],
									$entree['fret_fact'], $entree['assurance_fact'], $entree['autre_frais_fact'],
									$entree['ref_fact_old']));

		}

		public function modifierFichierFacture($ref_fact, $fichier_fact, $tmp_fact){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['fichier_fact'] = $fichier_fact;
			/*echo '<br> ref_fact = '.$ref_fact;
			echo '<br> date_fact = '.$date_fact;
			echo '<br> date_fact_rec = '.$date_fact_rec;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> date_val = '.$date_val;
			echo '<br> id_cli = '.$id_cli;
			echo '<br> commodity = '.$commodity;
			echo '<br> montant_fact = '.$montant_fact;
			echo '<br> id_mon = '.$id_mon;
			echo '<br> fret_fact = '.$fret_fact;
			echo '<br> assurance_fact = '.$assurance_fact;
			echo '<br> autre_frais_fact = '.$autre_frais_fact;
			echo '<br> ref_fact_old = '.$ref_fact_old;*/

			$requete = $connexion-> prepare("UPDATE facture_licence
														SET fichier_fact = ?
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['fichier_fact'], $entree['ref_fact']));

			$facture = '../factures/'.$ref_fact;

			if(!is_dir($facture)){
				mkdir("../factures/$ref_fact", 0777);
			}

			move_uploaded_file($tmp_fact, '../factures/'.$ref_fact.'/' . basename($fichier_fact));

		}

		
		public function modifierFichierLicence($num_lic, $fichier_lic, $tmp){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['fichier_lic'] = $fichier_lic;
			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> date_fact = '.$date_fact;
			echo '<br> date_fact_rec = '.$date_fact_rec;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> date_val = '.$date_val;
			echo '<br> id_cli = '.$id_cli;
			echo '<br> commodity = '.$commodity;
			echo '<br> montant_fact = '.$montant_fact;
			echo '<br> id_mon = '.$id_mon;
			echo '<br> fret_fact = '.$fret_fact;
			echo '<br> assurance_fact = '.$assurance_fact;
			echo '<br> autre_frais_fact = '.$autre_frais_fact;
			echo '<br> num_lic_old = '.$num_lic_old;*/

			$requete = $connexion-> prepare("UPDATE licence
														SET fichier_lic = ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['fichier_lic'], $entree['num_lic']));

			$dossier = '../dossiers/'.$num_lic;

			if(!is_dir($dossier)){
				mkdir("../dossiers/$num_lic", 0777);
			}

			move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
		}

		public function annulerDateExpirationLicence($num_lic){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$requete = $connexion-> prepare("UPDATE expiration_licence SET id_etat = '2'
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));

		}

		public function updateCodeImport($id_cli, $id_mod_lic, $code_finger){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['code_finger'] = $code_finger;

			$requete = $connexion-> prepare("UPDATE affectation_client_modele_licence 
													SET code_finger = ?
												WHERE id_cli = ? 
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['code_finger'], $entree['id_cli'], 
										$entree['id_mod_lic']));

		}

		public function MAJ_ref_dos($id_dos, $ref_dos){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_dos'] = $ref_dos;
			//Log
			if ($this-> getDossier($id_dos)['ref_dos'] != $ref_dos) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_dos', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_dos, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_dos = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_dos'], $entree['id_dos']));

		}

		public function MAJ_ref_dos_2($id_dos, $ref_dos_2){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_dos_2'] = $ref_dos_2;
			//Log
			if ($this-> getDossier($id_dos)['ref_dos_2'] != $ref_dos_2) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_dos_2', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_dos_2, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_dos_2 = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_dos_2'], $entree['id_dos']));

		}

		public function MAJ_id_march($id_dos, $id_march){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_march'] = $id_march;
			//Log
			if ($this-> getDossier($id_dos)['id_march'] != $id_march) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('id_march', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $id_march, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET id_march = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_march'], $entree['id_dos']));

		}

		public function MAJ_id_mod_trans($id_dos, $id_mod_trans){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_mod_trans'] = $id_mod_trans;
			//Log
			if ($this-> getDossier($id_dos)['id_mod_trans'] != $id_mod_trans) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('id_mod_trans', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $id_mod_trans, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET id_mod_trans = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_dos']));

		}

		public function MAJ_fichier_apurement($id_dos, $fichier_apurement){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fichier_apurement'] = $fichier_apurement;
			//Log
			if ($this-> getDossier($id_dos)['fichier_apurement'] != $fichier_apurement) {
				
				$this-> creerLogDossier('Fichier apurement', $fichier_apurement, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fichier_apurement = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fichier_apurement'], $entree['id_dos']));

		}

		public function MAJ_bfu($id_dos, $bfu){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bfu'] = $bfu;
			//Log
			if ($this-> getDossier($id_dos)['bfu'] != $bfu) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('bfu', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bfu, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET bfu = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bfu'], $entree['id_dos']));

		}

		public function MAJ_ref_bfu($id_dos, $ref_bfu){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_bfu'] = $ref_bfu;
			//Log
			if ($this-> getDossier($id_dos)['ref_bfu'] != $ref_bfu) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_bfu', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_bfu, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_bfu = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_bfu'], $entree['id_dos']));

		}

		public function MAJ_site_arriv($id_dos, $site_arriv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['site_arriv'] = $site_arriv;
			//Log
			if ($this-> getDossier($id_dos)['site_arriv'] != $site_arriv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('site_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $site_arriv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET site_arriv = ?
												WHERE id_dos = ?
													OR ref_dos_2 = ?");
			$requete-> execute(array($entree['site_arriv'], $entree['id_dos'], $this-> getDossier($entree['id_dos'])['ref_dos_2']));

		}

		public function MAJ_date_assurance($id_dos, $date_assurance){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_assurance'] = $date_assurance;
			//Log
			if ($this-> getDossier($id_dos)['date_assurance'] != $date_assurance) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_assurance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_assurance, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_assurance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_assurance'], $entree['id_dos']));

		}

		public function MAJ_date_rem_doc($id_dos, $date_rem_doc){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_rem_doc'] = $date_rem_doc;
			//Log
			if ($this-> getDossier($id_dos)['date_rem_doc'] != $date_rem_doc) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_rem_doc', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_rem_doc, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_rem_doc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_rem_doc'], $entree['id_dos']));

		}

		public function MAJ_front_in($id_dos, $front_in){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['front_in'] = $front_in;
			//Log
			if ($this-> getDossier($id_dos)['front_in'] != $front_in) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('front_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $front_in, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET front_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['front_in'], $entree['id_dos']));

		}

		public function MAJ_contenair($id_dos, $contenair){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['contenair'] = $contenair;
			//Log
			if ($this-> getDossier($id_dos)['contenair'] != $contenair) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('contenair', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $contenair, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET contenair = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['contenair'], $entree['id_dos']));

		}

		public function MAJ_front_out($id_dos, $front_out){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['front_out'] = $front_out;
			//Log
			if ($this-> getDossier($id_dos)['front_out'] != $front_out) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('front_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $front_out, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET front_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['front_out'], $entree['id_dos']));

		}

		public function MAJ_site_offload($id_dos, $site_offload){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['site_offload'] = $site_offload;
			//Log
			if ($this-> getDossier($id_dos)['site_offload'] != $site_offload) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('site_offload', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $site_offload, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET site_offload = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['site_offload'], $entree['id_dos']));

		}

		public function MAJ_id_emb($id_dos, $id_emb){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_emb'] = $id_emb;
			//Log
			if ($this-> getDossier($id_dos)['id_emb'] != $id_emb) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('id_emb', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $id_emb, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET id_emb = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_emb'], $entree['id_dos']));

		}

		public function MAJ_first_exp($id_dos, $first_exp){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['first_exp'] = $first_exp;
			//Log
			if ($this-> getDossier($id_dos)['first_exp'] != $first_exp) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('first_exp', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $first_exp, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET first_exp = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['first_exp'], $entree['id_dos']));

		}

		public function MAJ_id_t_dos($id_dos, $id_t_dos){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_t_dos'] = $id_t_dos;
			//Log
			if ($this-> getDossier($id_dos)['id_t_dos'] != $id_t_dos) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('id_t_dos', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $id_t_dos, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET id_t_dos = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_t_dos'], $entree['id_dos']));

		}

		public function MAJ_etat_feuil_calc($id_dos, $etat_feuil_calc){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['etat_feuil_calc'] = $etat_feuil_calc;
			// //Log
			// if ($this-> getDossier($id_dos)['ref_decl'] != $ref_decl) {
				
			// 	$colonne = $this-> getNomColonneClient('ref_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
			// 	$this-> creerLogDossier($colonne, $ref_decl, $id_dos, $_SESSION['id_util']);

			// }

			$requete = $connexion-> prepare("UPDATE dossier SET etat_feuil_calc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['etat_feuil_calc'], $entree['id_dos']));

		}

		public function MAJ_date_feuil_calc($id_dos, $date_feuil_calc){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_feuil_calc'] = $date_feuil_calc;
			//Log
			// if ($this-> getDossier($id_dos)['ref_decl'] != $ref_decl) {
				
			// 	$colonne = $this-> getNomColonneClient('ref_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
			// 	$this-> creerLogDossier($colonne, $ref_decl, $id_dos, $_SESSION['id_util']);

			// }

			$requete = $connexion-> prepare("UPDATE dossier SET date_feuil_calc = NOW()
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));

		}

		public function MAJ_id_util_feuil_calc($id_dos, $id_util_feuil_calc){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_util_feuil_calc'] = $id_util_feuil_calc;
			//Log
			// if ($this-> getDossier($id_dos)['ref_decl'] != $ref_decl) {
				
			// 	$colonne = $this-> getNomColonneClient('ref_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
			// 	$this-> creerLogDossier($colonne, $ref_decl, $id_dos, $_SESSION['id_util']);

			// }

			$requete = $connexion-> prepare("UPDATE dossier SET id_util_feuil_calc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_util_feuil_calc'], $entree['id_dos']));

		}

		public function MAJ_reg_dgda($id_dos, $reg_dgda){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['reg_dgda'] = $reg_dgda;
			//Log
			if ($this-> getDossier($id_dos)['reg_dgda'] != $reg_dgda) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('reg_dgda', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $reg_dgda, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET reg_dgda = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['reg_dgda'], $entree['id_dos']));

		}

		public function MAJ_origine($id_dos, $origine){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['origine'] = $origine;
			//Log
			if ($this-> getDossier($id_dos)['origine'] != $origine) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('origine', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $origine, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET origine = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['origine'], $entree['id_dos']));

		}

		public function MAJ_provenance($id_dos, $provenance){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['provenance'] = $provenance;
			//Log
			if ($this-> getDossier($id_dos)['provenance'] != $provenance) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('provenance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $provenance, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET provenance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['provenance'], $entree['id_dos']));

		}

		public function MAJ_last_provenance($id_dos, $last_provenance){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['last_provenance'] = $last_provenance;
			//Log
			if ($this-> getDossier($id_dos)['last_provenance'] != $last_provenance) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('last_provenance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $last_provenance, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET last_provenance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['last_provenance'], $entree['id_dos']));

		}

		public function MAJ_id_unit_mes($id_dos, $id_unit_mes){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_unit_mes'] = $id_unit_mes;
			//Log
			if ($this-> getDossier($id_dos)['id_unit_mes'] != $id_unit_mes) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('id_unit_mes', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $id_unit_mes, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET id_unit_mes = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_unit_mes'], $entree['id_dos']));

		}

		public function MAJ_code_tarif_march($id_dos, $code_tarif_march){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['code_tarif_march'] = $code_tarif_march;
			//Log
			if ($this-> getDossier($id_dos)['code_tarif_march'] != $code_tarif_march) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('code_tarif_march', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $code_tarif_march, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET code_tarif_march = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['code_tarif_march'], $entree['id_dos']));

		}

		public function MAJ_id_mon($id_dos, $id_mon){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_mon'] = $id_mon;
			//Log
			if ($this-> getDossier($id_dos)['id_mon'] != $id_mon) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('id_mon', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $id_mon, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET id_mon = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_mon'], $entree['id_dos']));

		}

		public function MAJ_incoterm($id_dos, $incoterm){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['incoterm'] = $incoterm;
			//Log
			if ($this-> getDossier($id_dos)['incoterm'] != $incoterm) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('incoterm', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $incoterm, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET incoterm = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['incoterm'], $entree['id_dos']));

		}

		public function MAJ_warehouse_arriv($id_dos, $warehouse_arriv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['warehouse_arriv'] = $warehouse_arriv;
			//Log
			if ($this-> getDossier($id_dos)['warehouse_arriv'] != $warehouse_arriv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('warehouse_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $warehouse_arriv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET warehouse_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['warehouse_arriv'], $entree['id_dos']));

		}

		public function MAJ_sous_trait($id_dos, $sous_trait){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['sous_trait'] = $sous_trait;
			//Log
			if ($this-> getDossier($id_dos)['sous_trait'] != $sous_trait) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('sous_trait', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $sous_trait, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET sous_trait = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['sous_trait'], $entree['id_dos']));

		}

		public function MAJ_bp_od_ref($id_dos, $bp_od_ref){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bp_od_ref'] = $bp_od_ref;
			//Log
			if ($this-> getDossier($id_dos)['bp_od_ref'] != $bp_od_ref) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('bp_od_ref', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bp_od_ref, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET bp_od_ref = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bp_od_ref'], $entree['id_dos']));

		}

		public function MAJ_heure_bp($id_dos, $heure_bp){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['heure_bp'] = $heure_bp;
			//Log
			if ($this-> getDossier($id_dos)['heure_bp'] != $heure_bp) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('heure_bp', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $heure_bp, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET heure_bp = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['heure_bp'], $entree['id_dos']));

		}

		public function MAJ_num_bp($id_dos, $num_bp){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['num_bp'] = $num_bp;
			//Log
			if ($this-> getDossier($id_dos)['num_bp'] != $num_bp) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('num_bp', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $num_bp, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET num_bp = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['num_bp'], $entree['id_dos']));

		}

		public function MAJ_date_bp($id_dos, $date_bp){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_bp'] = $date_bp;

			//Log
			if ($this-> getDossier($id_dos)['date_bp'] != $date_bp) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_bp', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_bp, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_bp = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_bp'], $entree['id_dos']));

		}

		public function MAJ_date_creat_dos($id_dos, $date_creat_dos){


		}

		public function MAJ_ad_date($id_dos, $ad_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ad_date'] = $ad_date;
			
			//Log
			if ($this-> getDossier($id_dos)['ad_date'] != $ad_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ad_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ad_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ad_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ad_date'], $entree['id_dos']));

		}

		public function MAJ_ad_num($id_dos, $ad_num){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ad_num'] = $ad_num;
			
			//Log
			if ($this-> getDossier($id_dos)['ad_num'] != $ad_num) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ad_num', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ad_num, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ad_num = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ad_num'], $entree['id_dos']));

		}

		public function MAJ_mca_b_ref($id_dos, $mca_b_ref){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['mca_b_ref'] = $mca_b_ref;
			
			//Log
			if ($this-> getDossier($id_dos)['mca_b_ref'] != $mca_b_ref) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('mca_b_ref', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $mca_b_ref, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET mca_b_ref = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['mca_b_ref'], $entree['id_dos']));

		}

		public function MAJ_date_trans_fact($id_dos){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$date_trans_fact = date('d/m/Y h:i:s');
			
			//Log
			//if ($this-> getDossier($id_dos)['mca_b_ref'] != $mca_b_ref) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$this-> creerLogDossier('Trasmission Dossier Pour Facturation', $date_trans_fact, $id_dos, $_SESSION['id_util']);

			//}

			$requete = $connexion-> prepare("UPDATE dossier SET date_trans_fact = NOW(), 
																id_util_trans_fact=?
												WHERE id_dos = ?");
			$requete-> execute(array($_SESSION['id_util'], $entree['id_dos']));

		}

		public function MAJ_ref_decl($id_dos, $ref_decl){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_decl'] = $ref_decl;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_decl'] != $ref_decl) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_decl, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_decl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_decl'], $entree['id_dos']));

		}

		public function MAJ_preal_ok($id_dos, $preal_ok){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['preal_ok'] = $preal_ok;
			
			//Log
			if ($this-> getDossier($id_dos)['preal_ok'] != $preal_ok) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('preal_ok', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $preal_ok, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET preal_ok = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['preal_ok'], $entree['id_dos']));

		}

		public function MAJ_date_decl($id_dos, $date_decl){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_decl'] = $date_decl;
			
			//Log
			if ($this-> getDossier($id_dos)['date_decl'] != $date_decl) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_decl, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_decl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_decl'], $entree['id_dos']));

		}

		public function MAJ_date_cvee($id_dos, $date_cvee){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_cvee'] = $date_cvee;
			
			//Log
			if ($this-> getDossier($id_dos)['date_cvee'] != $date_cvee) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_cvee', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_cvee, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_cvee = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_cvee'], $entree['id_dos']));

		}

		public function MAJ_ref_cvee($id_dos, $ref_cvee){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_cvee'] = $ref_cvee;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_cvee'] != $ref_cvee) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_cvee', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_cvee, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_cvee = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_cvee'], $entree['id_dos']));

		}

		public function MAJ_montant_cvee($id_dos, $montant_cvee){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['montant_cvee'] = $montant_cvee;
			
			//Log
			if ($this-> getDossier($id_dos)['montant_cvee'] != $montant_cvee) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('montant_cvee', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $montant_cvee, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET montant_cvee = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['montant_cvee'], $entree['id_dos']));

		}

		public function MAJ_ref_liq($id_dos, $ref_liq){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_liq'] = $ref_liq;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_liq'] != $ref_liq) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_liq', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_liq, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_liq = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_liq'], $entree['id_dos']));

		}

		public function MAJ_date_liq($id_dos, $date_liq){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_liq'] = $date_liq;
			
			//Log
			if ($this-> getDossier($id_dos)['date_liq'] != $date_liq) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_liq', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_liq, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_liq = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_liq'], $entree['id_dos']));

		}

		public function MAJ_ref_quit($id_dos, $ref_quit){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_quit'] = $ref_quit;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_quit'] != $ref_quit) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_quit', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_quit, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_quit = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_quit'], $entree['id_dos']));

		}

		public function MAJ_date_quit($id_dos, $date_quit){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_quit'] = $date_quit;
			
			//Log
			if ($this-> getDossier($id_dos)['date_quit'] != $date_quit) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_quit', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_quit, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_quit = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_quit'], $entree['id_dos']));

		}

		public function MAJ_montant_decl($id_dos, $montant_decl){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['montant_decl'] = $montant_decl;
			
			//Log
			if ($this-> getDossier($id_dos)['montant_decl'] != $montant_decl) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('montant_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $montant_decl, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET montant_decl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['montant_decl'], $entree['id_dos']));

		}

		public function MAJ_montant_liq($id_dos, $montant_liq){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['montant_liq'] = $montant_liq;
			
			//Log
			if ($this-> getDossier($id_dos)['montant_liq'] != $montant_liq) {
				
				$this-> creerLogDossier('montant_liq', $montant_liq, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET montant_liq = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['montant_liq'], $entree['id_dos']));

		}

		public function MAJ_date_receipt_ac_oc($id_dos, $date_receipt_ac_oc){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_receipt_ac_oc'] = $date_receipt_ac_oc;
			
			//Log
			if ($this-> getDossier($id_dos)['date_receipt_ac_oc'] != $date_receipt_ac_oc) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_receipt_ac_oc', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_receipt_ac_oc, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_receipt_ac_oc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_receipt_ac_oc'], $entree['id_dos']));

		}

		public function MAJ_date_recept_fact($id_dos, $date_recept_fact){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_recept_fact'] = $date_recept_fact;
			
			//Log
			if ($this-> getDossier($id_dos)['date_recept_fact'] != $date_recept_fact) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_recept_fact', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_recept_fact, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_recept_fact = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_recept_fact'], $entree['id_dos']));

		}

		public function MAJ_cod($id_dos, $cod){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['cod'] = $cod;
			
			//Log
			if ($this-> getDossier($id_dos)['cod'] != $cod) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('cod', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $cod, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET cod = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['cod'], $entree['id_dos']));

		}

		public function MAJ_fxi($id_dos, $fxi){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fxi'] = $fxi;
			
			//Log
			if ($this-> getDossier($id_dos)['fxi'] != $fxi) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('fxi', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fxi, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fxi = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fxi'], $entree['id_dos']));

		}

		public function MAJ_fxo($id_dos, $fxo){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fxo'] = $fxo;
			
			//Log
			if ($this-> getDossier($id_dos)['fxo'] != $fxo) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('fxo', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fxo, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fxo = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fxo'], $entree['id_dos']));

		}

		public function MAJ_partielle_av($id_dos, $partielle_av){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['partielle_av'] = $partielle_av;
			
			//Log
			if ($this-> getDossier($id_dos)['partielle_av'] != $partielle_av) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('partielle_av', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $partielle_av, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET partielle_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['partielle_av'], $entree['id_dos']));

		}

		public function MAJ_statut_av($id_dos, $statut_av){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['statut_av'] = $statut_av;
			
			//Log
			if ($this-> getDossier($id_dos)['statut_av'] != $statut_av) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('statut_av', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $statut_av, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET statut_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['statut_av'], $entree['id_dos']));

		}

		public function MAJ_montant_av($id_dos, $montant_av){
			/*
			?>
			<script type="text/javascript">
				alert("id_dos = <?php echo $id_dos;?> montant_av = <?php echo $montant_av;?>");
			</script>
			<?php
			*/
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['montant_av'] = $montant_av;
			
			//Log
			if ($this-> getDossier($id_dos)['montant_av'] != $montant_av) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('montant_av', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $montant_av, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET montant_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['montant_av'], $entree['id_dos']));

		}

		public function MAJ_ref_av($id_dos, $ref_av){
			/*
			?>
			<script type="text/javascript">
				alert("id_dos = <?php echo $id_dos;?> ref_av = <?php echo $ref_av;?>");
			</script>
			<?php
			*/
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_av'] = $ref_av;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_av'] != $ref_av) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_av', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_av, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_av'], $entree['id_dos']));

		}

		public function MAJ_fret_dos($id_dos, $fret){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fret'] = $fret;
			
			//Log
			if ($this-> getDossier($id_dos)['fret'] != $fret) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('fret', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fret, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fret = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fret'], $entree['id_dos']));

		}

		public function MAJ_assurance_dos($id_dos, $assurance){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['assurance'] = $assurance;
			
			//Log
			if ($this-> getDossier($id_dos)['assurance'] != $assurance) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('assurance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $assurance, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET assurance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['assurance'], $entree['id_dos']));

		}

		public function MAJ_ref_assurance($id_dos, $ref_assurance){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_assurance'] = $ref_assurance;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_assurance'] != $ref_assurance) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_assurance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_assurance, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_assurance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_assurance'], $entree['id_dos']));

		}

		public function MAJ_autre_frais_dos($id_dos, $autre_frais){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['autre_frais'] = $autre_frais;
			
			//Log
			if ($this-> getDossier($id_dos)['autre_frais'] != $autre_frais) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('autre_frais', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $autre_frais, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET autre_frais = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['autre_frais'], $entree['id_dos']));

		}

		public function MAJ_t1($id_dos, $t1){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['t1'] = $t1;
			
			//Log
			if ($this-> getDossier($id_dos)['t1'] != $t1) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('t1', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $t1, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET t1 = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['t1'], $entree['id_dos']));

		}

		public function MAJ_trs($id_dos, $trs){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['trs'] = $trs;
			
			//Log
			if ($this-> getDossier($id_dos)['trs'] != $trs) {
				
				$this-> creerLogDossier('trs', $trs, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET trs = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['trs'], $entree['id_dos']));

		}

		public function MAJ_escort_pyt_date($id_dos, $escort_pyt_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['escort_pyt_date'] = $escort_pyt_date;
			
			//Log
			if ($this-> getDossier($id_dos)['escort_pyt_date'] != $escort_pyt_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('escort_pyt_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $escort_pyt_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET escort_pyt_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['escort_pyt_date'], $entree['id_dos']));

		}

		public function MAJ_bs_t1_date($id_dos, $bs_t1_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bs_t1_date'] = $bs_t1_date;
			
			//Log
			if ($this-> getDossier($id_dos)['bs_t1_date'] != $bs_t1_date) {
				
				$colonne = $this-> getNomColonneClient('bs_t1_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bs_t1_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET bs_t1_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bs_t1_date'], $entree['id_dos']));

		}

		public function MAJ_date_pv_dm_site($id_dos, $date_pv_dm_site){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_pv_dm_site'] = $date_pv_dm_site;
			
			//Log
			if ($this-> getDossier($id_dos)['date_pv_dm_site'] != $date_pv_dm_site) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_pv_dm_site', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_pv_dm_site, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_pv_dm_site = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_pv_dm_site'], $entree['id_dos']));

		}

		public function MAJ_date_cert_cgea($id_dos, $date_cert_cgea){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_cert_cgea'] = $date_cert_cgea;
			
			//Log
			if ($this-> getDossier($id_dos)['date_cert_cgea'] != $date_cert_cgea) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_cert_cgea', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_cert_cgea, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_cert_cgea = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_cert_cgea'], $entree['id_dos']));

		}

		public function MAJ_date_pv_dgda($id_dos, $date_pv_dgda){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_pv_dgda'] = $date_pv_dgda;
			
			//Log
			if ($this-> getDossier($id_dos)['date_pv_dgda'] != $date_pv_dgda) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_pv_dgda', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_pv_dgda, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_pv_dgda = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_pv_dgda'], $entree['id_dos']));

		}

		public function MAJ_date_pv_ceec($id_dos, $date_pv_ceec){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_pv_ceec'] = $date_pv_ceec;
			
			//Log
			if ($this-> getDossier($id_dos)['date_pv_ceec'] != $date_pv_ceec) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_pv_ceec', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_pv_ceec, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_pv_ceec = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_pv_ceec'], $entree['id_dos']));

		}

		public function MAJ_date_rapp_occ($id_dos, $date_rapp_occ){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_rapp_occ'] = $date_rapp_occ;
			
			//Log
			if ($this-> getDossier($id_dos)['date_rapp_occ'] != $date_rapp_occ) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_rapp_occ', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_rapp_occ, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_rapp_occ = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_rapp_occ'], $entree['id_dos']));

		}

		public function MAJ_date_cert_labo($id_dos, $date_cert_labo){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_cert_labo'] = $date_cert_labo;
			
			//Log
			if ($this-> getDossier($id_dos)['date_cert_labo'] != $date_cert_labo) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_cert_labo', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_cert_labo, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_cert_labo = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_cert_labo'], $entree['id_dos']));

		}

		public function MAJ_doc_gu_in($id_dos, $doc_gu_in){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['doc_gu_in'] = $doc_gu_in;
			
			//Log
			if ($this-> getDossier($id_dos)['doc_gu_in'] != $doc_gu_in) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('doc_gu_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $doc_gu_in, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET doc_gu_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['doc_gu_in'], $entree['id_dos']));

		}

		public function MAJ_site_dep($id_dos, $site_dep){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['site_dep'] = $site_dep;
			
			//Log
			if ($this-> getDossier($id_dos)['site_dep'] != $site_dep) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('site_dep', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $site_dep, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET site_dep = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['site_dep'], $entree['id_dos']));

		}

		public function MAJ_doc_gu_out($id_dos, $doc_gu_out){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['doc_gu_out'] = $doc_gu_out;
			
			//Log
			if ($this-> getDossier($id_dos)['doc_gu_out'] != $doc_gu_out) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('doc_gu_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $doc_gu_out, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET doc_gu_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['doc_gu_out'], $entree['id_dos']));

		}

		public function MAJ_date_pv_com_ext($id_dos, $date_pv_com_ext){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_pv_com_ext'] = $date_pv_com_ext;
			
			//Log
			if ($this-> getDossier($id_dos)['date_pv_com_ext'] != $date_pv_com_ext) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_pv_com_ext', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_pv_com_ext, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_pv_com_ext = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_pv_com_ext'], $entree['id_dos']));

		}

		public function MAJ_vag($id_dos, $vag){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['vag'] = $vag;
			
			//Log
			if ($this-> getDossier($id_dos)['vag'] != $vag) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('vag', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $vag, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET vag = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['vag'], $entree['id_dos']));

		}

		public function MAJ_fsi($id_dos, $fsi){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fsi'] = $fsi;
			
			//Log
			if ($this-> getDossier($id_dos)['fsi'] != $fsi) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('fsi', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fsi, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fsi = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fsi'], $entree['id_dos']));

		}

		public function MAJ_fci($id_dos, $fci){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fci'] = $fci;
			
			//Log
			if ($this-> getDossier($id_dos)['fci'] != $fci) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('fci', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fci, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fci = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fci'], $entree['id_dos']));

		}

		public function MAJ_fin($id_dos, $fin){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fin'] = $fin;
			
			//Log
			if ($this-> getDossier($id_dos)['fin'] != $fin) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('fin', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fin, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fin = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fin'], $entree['id_dos']));

		}

		public function MAJ_dgda_manif_date($id_dos, $dgda_manif_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dgda_manif_date'] = $dgda_manif_date;
			
			//Log
			if ($this-> getDossier($id_dos)['dgda_manif_date'] != $dgda_manif_date) {
				
				$this-> creerLogDossier('dgda_manif_date', $dgda_manif_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET dgda_manif_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dgda_manif_date'], $entree['id_dos']));

		}

		public function MAJ_t1_date($id_dos, $t1_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['t1_date'] = $t1_date;
			
			//Log
			if ($this-> getDossier($id_dos)['t1_date'] != $t1_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('t1_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $t1_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET t1_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['t1_date'], $entree['id_dos']));

		}

		public function MAJ_trs_date($id_dos, $trs_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['trs_date'] = $trs_date;
			
			//Log
			if ($this-> getDossier($id_dos)['trs_date'] != $trs_date) {
				
				$this-> creerLogDossier('trs_date', $trs_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET trs_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['trs_date'], $entree['id_dos']));

		}

		public function MAJ_poids($id_dos, $poids){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['poids'] = $poids;
			
			//Log
			if ($this-> getDossier($id_dos)['poids'] != $poids) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('poids', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $poids, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET poids = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['poids'], $entree['id_dos']));

		}

		public function MAJ_poids_brut($id_dos, $poids_brut){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['poids_brut'] = $poids_brut;
			
			//Log
			if ($this-> getDossier($id_dos)['poids_brut'] != $poids_brut) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('poids_brut', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $poids_brut, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET poids_brut = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['poids_brut'], $entree['id_dos']));

		}

		public function MAJ_acheteur($id_dos, $acheteur){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['acheteur'] = $acheteur;
			
			//Log
			if ($this-> getDossier($id_dos)['acheteur'] != $acheteur) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('acheteur', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $acheteur, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET acheteur = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['acheteur'], $entree['id_dos']));

		}

		public function MAJ_horse($id_dos, $horse){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['horse'] = $horse;
			
			//Log
			if ($this-> getDossier($id_dos)['horse'] != $horse) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('horse', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $horse, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET horse = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['horse'], $entree['id_dos']));

		}

		public function MAJ_trailer_1($id_dos, $trailer_1){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['trailer_1'] = $trailer_1;
			
			//Log
			if ($this-> getDossier($id_dos)['trailer_1'] != $trailer_1) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('trailer_1', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $trailer_1, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET trailer_1 = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['trailer_1'], $entree['id_dos']));

		}

		public function MAJ_trailer_2($id_dos, $trailer_2){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['trailer_2'] = $trailer_2;
			
			//Log
			if ($this-> getDossier($id_dos)['trailer_2'] != $trailer_2) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('trailer_2', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $trailer_2, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET trailer_2 = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['trailer_2'], $entree['id_dos']));

		}

		public function MAJ_klsa_arriv($id_dos, $klsa_arriv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['klsa_arriv'] = $klsa_arriv;
			
			//Log
			if ($this-> getDossier($id_dos)['klsa_arriv'] != $klsa_arriv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('klsa_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $klsa_arriv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET klsa_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['klsa_arriv'], $entree['id_dos']));

		}

		public function MAJ_tr8_ref($id_dos, $tr8_ref){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['tr8_ref'] = $tr8_ref;
			
			//Log
			if ($this-> getDossier($id_dos)['tr8_ref'] != $tr8_ref) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('tr8_ref', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $tr8_ref, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET tr8_ref = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['tr8_ref'], $entree['id_dos']));

		}

		public function MAJ_tr8_date($id_dos, $tr8_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['tr8_date'] = $tr8_date;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_decl'] != $ref_decl) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_decl, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET tr8_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['tr8_date'], $entree['id_dos']));

		}

		public function MAJ_crossing_date($id_dos, $crossing_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['crossing_date'] = $crossing_date;
			
			//Log
			if ($this-> getDossier($id_dos)['crossing_date'] != $crossing_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('crossing_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $crossing_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET crossing_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['crossing_date'], $entree['id_dos']));

		}

		public function MAJ_kaniaka_arriv($id_dos, $kaniaka_arriv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['kaniaka_arriv'] = $kaniaka_arriv;
			
			//Log
			if ($this-> getDossier($id_dos)['kaniaka_arriv'] != $kaniaka_arriv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('kaniaka_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $kaniaka_arriv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET kaniaka_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['kaniaka_arriv'], $entree['id_dos']));

		}

		public function MAJ_kaniaka_dep($id_dos, $kaniaka_dep){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['kaniaka_dep'] = $kaniaka_dep;
			
			//Log
			if ($this-> getDossier($id_dos)['kaniaka_dep'] != $kaniaka_dep) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('kaniaka_dep', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $kaniaka_dep, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET kaniaka_dep = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['kaniaka_dep'], $entree['id_dos']));

		}

		public function MAJ_wiski_arriv($id_dos, $wiski_arriv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['wiski_arriv'] = $wiski_arriv;
			
			//Log
			if ($this-> getDossier($id_dos)['wiski_arriv'] != $wiski_arriv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('wiski_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $wiski_arriv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET wiski_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['wiski_arriv'], $entree['id_dos']));

		}

		public function MAJ_wiski_dep($id_dos, $wiski_dep){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['wiski_dep'] = $wiski_dep;
			
			//Log
			if ($this-> getDossier($id_dos)['wiski_dep'] != $wiski_dep) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('wiski_dep', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $wiski_dep, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET wiski_dep = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['wiski_dep'], $entree['id_dos']));

		}

		public function MAJ_kbp_arrival_date($id_dos, $kbp_arrival_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['kbp_arrival_date'] = $kbp_arrival_date;
			
			//Log
			if ($this-> getDossier($id_dos)['kbp_arrival_date'] != $kbp_arrival_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('kbp_arrival_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $kbp_arrival_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET kbp_arrival_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['kbp_arrival_date'], $entree['id_dos']));

		}

		public function MAJ_kbp_dep_date($id_dos, $kbp_dep_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['kbp_dep_date'] = $kbp_dep_date;
			
			//Log
			if ($this-> getDossier($id_dos)['kbp_dep_date'] != $kbp_dep_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('kbp_dep_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $kbp_dep_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET kbp_dep_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['kbp_dep_date'], $entree['id_dos']));

		}

		public function MAJ_truck_location($id_dos, $truck_location){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['truck_location'] = $truck_location;
			
			//Log
			if ($this-> getDossier($id_dos)['truck_location'] != $truck_location) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('truck_location', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $truck_location, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET truck_location = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['truck_location'], $entree['id_dos']));

		}

		public function MAJ_bur_douane($id_dos, $bur_douane){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bur_douane'] = $bur_douane;
			
			//Log
			if ($this-> getDossier($id_dos)['bur_douane'] != $bur_douane) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('bur_douane', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bur_douane, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET bur_douane = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bur_douane'], $entree['id_dos']));

		}

		public function MAJ_ref_crf($id_dos, $ref_crf){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_crf'] = $ref_crf;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_crf'] != $ref_crf) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_crf', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_crf, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_crf = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_crf'], $entree['id_dos']));

		}

		public function MAJ_date_crf($id_dos, $date_crf){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_crf'] = $date_crf;
			
			//Log
			if ($this-> getDossier($id_dos)['date_crf'] != $date_crf) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_crf', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_crf, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_crf  = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_crf'], $entree['id_dos']));

		}

		public function MAJ_dgda_manif($id_dos, $dgda_manif){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dgda_manif'] = $dgda_manif;
			
			//Log
			if ($this-> getDossier($id_dos)['dgda_manif'] != $dgda_manif) {
				
				$this-> creerLogDossier('dgda_manif', $dgda_manif, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET dgda_manif = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dgda_manif'], $entree['id_dos']));

		}

		public function MAJ_dgda_in($id_dos, $dgda_in){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dgda_in'] = $dgda_in;
			
			//Log
			if ($this-> getDossier($id_dos)['dgda_in'] != $dgda_in) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('dgda_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dgda_in, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET dgda_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dgda_in'], $entree['id_dos']));

		}

		public function MAJ_dgda_out($id_dos, $dgda_out){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dgda_out'] = $dgda_out;
			
			//Log
			if ($this-> getDossier($id_dos)['dgda_out'] != $dgda_out) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('dgda_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dgda_out, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET dgda_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dgda_out'], $entree['id_dos']));

		}

		public function MAJ_date_preal($id_dos, $date_preal){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_preal'] = $date_preal;
			
			//Log
			if ($this-> getDossier($id_dos)['date_preal'] != $date_preal) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_preal', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_preal, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_preal = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_preal'], $entree['id_dos']));

		}

		public function MAJ_po_ref($id_dos, $po_ref){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['po_ref'] = $po_ref;
			
			//Log
			if ($this-> getDossier($id_dos)['po_ref'] != $po_ref) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('po_ref', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $po_ref, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET po_ref = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['po_ref'], $entree['id_dos']));

		}

		public function MAJ_road_manif($id_dos, $road_manif){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['road_manif'] = $road_manif;
			
			//Log
			if ($this-> getDossier($id_dos)['road_manif'] != $road_manif) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('road_manif', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $road_manif, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET road_manif = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['road_manif'], $entree['id_dos']));

		}

		public function MAJ_trip_number($id_dos, $trip_number){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['trip_number'] = $trip_number;
			
			//Log
			if ($this-> getDossier($id_dos)['trip_number'] != $trip_number) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('trip_number', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $trip_number, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET trip_number = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['trip_number'], $entree['id_dos']));

		}

		public function MAJ_roe_decl($id_dos, $roe_decl){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['roe_decl'] = $roe_decl;

			// echo '<br>id_dos = '.$id_dos;
			// echo '<br>roe_decl = '.$roe_decl.'<br><br>';

			
			//Log
			if ($this-> getDossier($id_dos)['roe_decl'] != $roe_decl) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('roe_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $roe_decl, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET roe_decl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['roe_decl'], $entree['id_dos']));

		}

		public function MAJ_validation_facture_dossier($ref_fact, $validation){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['validation'] = $validation;
			
			//Log
			if ($this-> getDossier($id_dos)['validation'] != $validation) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('validation', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $validation, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE facture_dossier SET validation = ?, date_validation = NOW()
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['validation'], $entree['ref_fact']));

		}

		public function ajusterFactureSCM($ref_fact, $roe_decl, $taux_commission){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['roe_decl'] = $roe_decl;
			$entree['taux_commission'] = $taux_commission;
			
			$requete = $connexion-> prepare("UPDATE dossier SET roe_decl = ?
												WHERE id_dos IN (
													SELECT id_dos
														FROM detail_facture_dossier
														WHERE ref_fact = ?
												)");
			$requete-> execute(array($entree['roe_decl'], $entree['ref_fact']));

			$requete = $connexion-> prepare("UPDATE facture_dossier SET taux_commission = ?
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['taux_commission'], $entree['ref_fact']));

		}

		public function ajusterFactureKCC($ref_fact, $montant_fact, $montant_MD){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['montant_fact'] = $montant_fact;
			$entree['montant_MD'] = $montant_MD;
			
			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre 
												FROM detail_facture_dossier
												WHERE ref_fact = ?
													AND id_deb = 1");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();

			$entree['montant'] = ($montant_MD-$montant_fact)/$reponse['nbre'];

			$requete = $connexion-> prepare("UPDATE detail_facture_dossier SET montant = montant+?
												WHERE ref_fact = ?
													AND id_deb = 1");
			$requete-> execute(array($entree['montant'], $entree['ref_fact']));

			//echo $entree['montant'];

		}

		public function updateDetailFactureDossier($ref_fact, $id_dos, $id_deb, $montant, $usd, $tva){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$entree['usd'] = $usd;
			$entree['tva'] = $tva;
			
			$requete = $connexion-> prepare("UPDATE detail_facture_dossier
												SET montant = ?, usd = ?, tva = ?
												WHERE ref_fact = ?
													AND id_dos = ?
													AND id_deb = ?");
			$requete-> execute(array($entree['montant'], $entree['usd'], $entree['tva'], $entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));

		}

		public function getMontantFactureAdvance($ref_fact){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur = 0;
			$ht_usd = 0;
			$tva_usd = 0;
			$ttc_usd = 0;

			$requete = $connexion-> prepare("SELECT type.nom_t_deb AS nom_t_deb,
													SUM(
														IF(det.tva='0',
															IF(det.usd='1',
																det.montant,
																det.montant/dos.roe_decl
															),
															IF(det.usd='1',
																det.montant*1.16,
																(det.montant/dos.roe_decl)*1.16
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd='1',
															det.montant,
															(det.montant/dos.roe_decl)
														)
													) AS ht_usd,
													SUM(
														IF(det.usd='1' AND det.tva='1',
															det.montant*0.16,
															0
														)
													) AS tva_usd
												FROM type_debours type, debours deb, detail_facture_dossier det, dossier dos
												WHERE type.id_t_deb = deb.id_t_deb
													AND deb.id_deb = det.id_deb
													AND det.id_dos = dos.id_dos
													AND det.ref_fact = ?
												GROUP BY type.id_t_deb");
			$requete-> execute(array($entree['ref_fact']));
			while($reponse=$requete-> fetch()){
				$compteur++;

				$ht_usd += $reponse['ht_usd']; 
				$tva_usd += $reponse['tva_usd']; 
				$ttc_usd += $reponse['ttc_usd']; 

				$tbl .= '<tr>
							<td>'.$compteur.'</td>
							<td>'.$reponse['nom_t_deb'].'</td>
							<td class="text-right">'.number_format($reponse['ht_usd'], 2, '.', ',').'</td>
							<td class="text-right">'.number_format($reponse['tva_usd'], 2, '.', ',').'</td>
							<td class="text-right">'.number_format($reponse['ttc_usd'], 2, '.', ',').'</td>
						</tr>';
			}$requete-> closeCursor();

			$tbl .= '<tr>
						<td colspan="2">TOTAL</td>
						<td class="text-right">'.number_format($ht_usd, 2, '.', ',').'</td>
						<td class="text-right">'.number_format($tva_usd, 2, '.', ',').'</td>
						<td class="text-right">'.number_format($ttc_usd, 2, '.', ',').'</td>
					</tr>';

			return $tbl;

		}


		public function MAJ_transmission_facture_dossier($ref_fact, $transmission, $id_util){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['transmission'] = $transmission;
			$entree['id_util'] = $id_util;
			$requete = $connexion-> prepare("UPDATE facture_dossier SET transmission = ?, id_util_transmis = ?, date_transmis = NOW()
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['transmission'], $entree['id_util'], $entree['ref_fact']));

		}

		public function MAJ_arr_bond($id_dos, $arr_bond){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['arr_bond'] = $arr_bond;
			
			//Log
			if ($this-> getDossier($id_dos)['arr_bond'] != $arr_bond) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('arr_bond', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $arr_bond, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET arr_bond = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['arr_bond'], $entree['id_dos']));

		}

		public function MAJ_custom_deliv($id_dos, $custom_deliv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['custom_deliv'] = $custom_deliv;
			
			//Log
			if ($this-> getDossier($id_dos)['custom_deliv'] != $custom_deliv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('custom_deliv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $custom_deliv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET custom_deliv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['custom_deliv'], $entree['id_dos']));

		}

		public function MAJ_lshi_arriv($id_dos, $lshi_arriv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['lshi_arriv'] = $lshi_arriv;
			
			//Log
			if ($this-> getDossier($id_dos)['lshi_arriv'] != $lshi_arriv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('lshi_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $lshi_arriv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET lshi_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['lshi_arriv'], $entree['id_dos']));

		}

		public function MAJ_dispatch_klsa($id_dos, $dispatch_klsa){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dispatch_klsa'] = $dispatch_klsa;
			
			//Log
			if ($this-> getDossier($id_dos)['dispatch_klsa'] != $dispatch_klsa) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('dispatch_klsa', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dispatch_klsa, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET dispatch_klsa = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dispatch_klsa'], $entree['id_dos']));

		}

		public function MAJ_dispatch_deliv($id_dos, $dispatch_deliv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dispatch_deliv'] = $dispatch_deliv;
			
			//Log
			if ($this-> getDossier($id_dos)['dispatch_deliv'] != $dispatch_deliv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('dispatch_deliv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dispatch_deliv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET dispatch_deliv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dispatch_deliv'], $entree['id_dos']));

		}

		public function MAJ_arrival_date($id_dos, $arrival_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['arrival_date'] = $arrival_date;
			
			//Log
			if ($this-> getDossier($id_dos)['arrival_date'] != $arrival_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('arrival_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $arrival_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET arrival_date = ?
												WHERE id_dos = ?
													OR ref_dos_2 = ?");
			$requete-> execute(array($entree['arrival_date'], $entree['id_dos'], $this-> getDossier($entree['id_dos'])['ref_dos_2']));

		}

		public function MAJ_frontiere($id_dos, $frontiere){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['frontiere'] = $frontiere;
			
			//Log
			if ($this-> getDossier($id_dos)['frontiere'] != $frontiere) {
				
				$this-> creerLogDossier('frontiere', $frontiere, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET frontiere = ?
												WHERE id_dos = ?
													OR ref_dos_2 = ?");
			$requete-> execute(array($entree['frontiere'], $entree['id_dos'], $this-> getDossier($entree['id_dos'])['ref_dos_2']));

		}

		public function MAJ_date_cert_quarant($id_dos, $date_cert_quarant){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_cert_quarant'] = $date_cert_quarant;
			
			//Log
			if ($this-> getDossier($id_dos)['date_cert_quarant'] != $date_cert_quarant) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_cert_quarant', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_cert_quarant, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_cert_quarant = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_cert_quarant'], $entree['id_dos']));

		}

		public function MAJ_date_nac($id_dos, $date_nac){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_nac'] = $date_nac;
			
			//Log
			if ($this-> getDossier($id_dos)['date_nac'] != $date_nac) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_nac', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_nac, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_nac = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_nac'], $entree['id_dos']));

		}

		public function MAJ_date_gov_list($id_dos, $date_gov_list){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_gov_list'] = $date_gov_list;
			
			//Log
			if ($this-> getDossier($id_dos)['date_gov_list'] != $date_gov_list) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_gov_list', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_gov_list, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_gov_list = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_gov_list'], $entree['id_dos']));

		}

		public function MAJ_relev_dgda_out($id_dos, $relev_dgda_out){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['relev_dgda_out'] = $relev_dgda_out;
			
			//Log
			if ($this-> getDossier($id_dos)['relev_dgda_out'] != $relev_dgda_out) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('relev_dgda_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $relev_dgda_out, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET relev_dgda_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['relev_dgda_out'], $entree['id_dos']));

		}

		public function MAJ_kisanga_in($id_dos, $kisanga_in){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['kisanga_in'] = $kisanga_in;
			
			//Log
			if ($this-> getDossier($id_dos)['kisanga_in'] != $kisanga_in) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('kisanga_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $kisanga_in, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET kisanga_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['kisanga_in'], $entree['id_dos']));

		}

		public function MAJ_kisanga_out($id_dos, $kisanga_out){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['kisanga_out'] = $kisanga_out;
			
			//Log
			if ($this-> getDossier($id_dos)['kisanga_out'] != $kisanga_out) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('kisanga_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $kisanga_out, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET kisanga_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['kisanga_out'], $entree['id_dos']));

		}

		public function MAJ_klsa_dep($id_dos, $klsa_dep){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['klsa_dep'] = $klsa_dep;
			
			//Log
			if ($this-> getDossier($id_dos)['klsa_dep'] != $klsa_dep) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('klsa_dep', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $klsa_dep, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET klsa_dep = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['klsa_dep'], $entree['id_dos']));

		}

		public function MAJ_cleared($id_dos, $cleared){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['cleared'] = $cleared;
			
			//Log
			if ($this-> getDossier($id_dos)['cleared'] != $cleared) {
				
				$this-> creerLogDossier('Cleared', $cleared, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET cleared = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['cleared'], $entree['id_dos']));

		}

		public function MAJ_ref_fact($id_dos, $ref_fact){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_fact'] != $ref_fact) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_fact', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_fact, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_fact = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos']));

		}

		public function MAJ_date_fact($id_dos, $date_fact){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_fact'] = $date_fact;
			
			//Log
			if ($this-> getDossier($id_dos)['date_fact'] != $date_fact) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_fact', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_fact, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_fact = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_fact'], $entree['id_dos']));

		}

		public function MAJ_date_fact_dos($ref_fact, $date_fact){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['date_fact'] = $date_fact;
			
			//Log
			if ($this-> getDossier($id_dos)['date_fact'] != $date_fact) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_fact', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_fact, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE facture_dossier SET date_fact = ?
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['date_fact'], $entree['ref_fact']));

		}

		public function MAJ_partiel_av($id_dos, $partiel_av){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['partiel_av'] = $partiel_av;
			
			//Log
			if ($this-> getDossier($id_dos)['partiel_av'] != $partiel_av) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('partiel_av', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $partiel_av, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET partiel_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['partiel_av'], $entree['id_dos']));

		}

		public function MAJ_date_av($id_dos, $date_av){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_av'] = $date_av;
			
			//Log
			if ($this-> getDossier($id_dos)['date_av'] != $date_av) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('date_av', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_av, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET date_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_av'], $entree['id_dos']));

		}

		public function MAJ_ref_rap_insp($id_dos, $ref_rap_insp){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_rap_insp'] = $ref_rap_insp;
			
			//Log
			if ($this-> getDossier($id_dos)['ref_rap_insp'] != $ref_rap_insp) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ref_rap_insp', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_rap_insp, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ref_rap_insp = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_rap_insp'], $entree['id_dos']));

		}

		public function MAJ_fournisseur($id_dos, $fournisseur){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fournisseur'] = $fournisseur;
			
			//Log
			if ($this-> getDossier($id_dos)['fournisseur'] != $fournisseur) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('fournisseur', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fournisseur, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fournisseur = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fournisseur'], $entree['id_dos']));

		}

		public function MAJ_commodity($id_dos, $commodity){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['commodity'] = $commodity;
			
			//Log
			if ($this-> getDossier($id_dos)['commodity'] != $commodity) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('commodity', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $commodity, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET commodity = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['commodity'], $entree['id_dos']));

		}

		public function MAJ_num_lic($id_dos, $num_lic){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['num_lic'] = $num_lic;
			
			//Log
			if ($this-> getDossier($id_dos)['num_lic'] != $num_lic) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('num_lic', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $num_lic, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET num_lic = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['num_lic'], $entree['id_dos']));

		}

		public function MAJ_amicongo_arriv($id_dos, $amicongo_arriv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['amicongo_arriv'] = $amicongo_arriv;
			
			//Log
			if ($this-> getDossier($id_dos)['amicongo_arriv'] != $amicongo_arriv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('amicongo_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $amicongo_arriv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET amicongo_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['amicongo_arriv'], $entree['id_dos']));

		}

		public function MAJ_insp_receiv($id_dos, $insp_receiv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['insp_receiv'] = $insp_receiv;
			
			//Log
			if ($this-> getDossier($id_dos)['insp_receiv'] != $insp_receiv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('insp_receiv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $insp_receiv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET insp_receiv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['insp_receiv'], $entree['id_dos']));

		}

		public function MAJ_ir($id_dos, $ir){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ir'] = $ir;
			
			//Log
			if ($this-> getDossier($id_dos)['ir'] != $ir) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ir', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ir, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ir = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ir'], $entree['id_dos']));

		}

		public function MAJ_remarque($id_dos, $remarque){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['remarque'] = $remarque;
			
			//Log
			if ($this-> getDossier($id_dos)['remarque'] != $remarque) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('remarque', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $remarque, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET remarque = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['remarque'], $entree['id_dos']));

		}

		public function MAJ_statut($id_dos, $statut){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['statut'] = $statut;
			
			//Log
			if ($this-> getDossier($id_dos)['statut'] != $statut) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('statut', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $statut, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET statut = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['statut'], $entree['id_dos']));

		}

		public function MAJ_fob($id_dos, $fob){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fob'] = $fob;
			
			//Log
			if ($this-> getDossier($id_dos)['fob'] != $fob) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('fob', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fob, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fob = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fob'], $entree['id_dos']));

		}

		public function MAJ_fret($id_dos, $fret){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fret'] = $fret;
			
			//Log
			if ($this-> getDossier($id_dos)['fret'] != $fret) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('fret', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fret, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET fret = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fret'], $entree['id_dos']));

		}

		public function MAJ_assurance($id_dos, $assurance){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['assurance'] = $assurance;
			
			//Log
			if ($this-> getDossier($id_dos)['assurance'] != $assurance) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('assurance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $assurance, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET assurance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['assurance'], $entree['id_dos']));

		}

		public function MAJ_autre_frais($id_dos, $autre_frais){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['autre_frais'] = $autre_frais;
			
			//Log
			if ($this-> getDossier($id_dos)['autre_frais'] != $autre_frais) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('autre_frais', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $autre_frais, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET autre_frais = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['autre_frais'], $entree['id_dos']));

		}

		public function MAJ_supplier($id_dos, $supplier){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['supplier'] = $supplier;
			
			//Log
			if ($this-> getDossier($id_dos)['supplier'] != $supplier) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('supplier', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $supplier, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET supplier = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['supplier'], $entree['id_dos']));

		}

		public function MAJ_bl($id_dos, $bl){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bl'] = $bl;
			
			//Log
			if ($this-> getDossier($id_dos)['bl'] != $bl) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('bl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bl, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET bl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bl'], $entree['id_dos']));

		}

		public function MAJ_pv_mine($id_dos, $pv_mine){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['pv_mine'] = $pv_mine;
			
			//Log
			if ($this-> getDossier($id_dos)['pv_mine'] != $pv_mine) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('pv_mine', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $pv_mine, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET pv_mine = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['pv_mine'], $entree['id_dos']));

		}

		public function MAJ_transporter($id_dos, $transporter){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['transporter'] = $transporter;
			
			//Log
			if ($this-> getDossier($id_dos)['transporter'] != $transporter) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('transporter', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $transporter, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET transporter = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['transporter'], $entree['id_dos']));

		}

		public function MAJ_probleme($id_dos, $probleme){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['probleme'] = $probleme;
			
			//Log
			if ($this-> getDossier($id_dos)['probleme'] != $probleme) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('probleme', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $probleme, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET probleme = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['probleme'], $entree['id_dos']));

		}

		public function MAJ_demande_attestation($id_dos, $demande_attestation){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['demande_attestation'] = $demande_attestation;
			
			//Log
			if ($this-> getDossier($id_dos)['demande_attestation'] != $demande_attestation) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('demande_attestation', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $demande_attestation, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET demande_attestation = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['demande_attestation'], $entree['id_dos']));

		}
		public function MAJ_assay_date($id_dos, $assay_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['assay_date'] = $assay_date;
			
			//Log
			if ($this-> getDossier($id_dos)['assay_date'] != $assay_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('assay_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $assay_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET assay_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['assay_date'], $entree['id_dos']));

		}
		public function MAJ_ceec_in($id_dos, $ceec_in){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ceec_in'] = $ceec_in;
			
			//Log
			if ($this-> getDossier($id_dos)['ceec_in'] != $ceec_in) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ceec_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ceec_in, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ceec_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ceec_in'], $entree['id_dos']));

		}
		public function MAJ_ceec_out($id_dos, $ceec_out){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ceec_out'] = $ceec_out;
			
			//Log
			if ($this-> getDossier($id_dos)['ceec_out'] != $ceec_out) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ceec_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ceec_out, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ceec_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ceec_out'], $entree['id_dos']));

		}
		public function MAJ_min_div_in($id_dos, $min_div_in){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['min_div_in'] = $min_div_in;
			
			//Log
			if ($this-> getDossier($id_dos)['min_div_in'] != $min_div_in) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('min_div_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $min_div_in, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET min_div_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['min_div_in'], $entree['id_dos']));

		}
		public function MAJ_min_div_out($id_dos, $min_div_out){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['min_div_out'] = $min_div_out;
			
			//Log
			if ($this-> getDossier($id_dos)['min_div_out'] != $min_div_out) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('min_div_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $min_div_out, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET min_div_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['min_div_out'], $entree['id_dos']));

		}
		public function MAJ_gov_in($id_dos, $gov_in){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['gov_in'] = $gov_in;
			
			//Log
			if ($this-> getDossier($id_dos)['gov_in'] != $gov_in) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('gov_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $gov_in, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET gov_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['gov_in'], $entree['id_dos']));

		}
		public function MAJ_gov_out($id_dos, $gov_out){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['gov_out'] = $gov_out;
			
			//Log
			if ($this-> getDossier($id_dos)['gov_out'] != $gov_out) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('gov_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $gov_out, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET gov_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['gov_out'], $entree['id_dos']));

		}
		public function MAJ_dispatch_date($id_dos, $dispatch_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dispatch_date'] = $dispatch_date;
			
			//Log
			if ($this-> getDossier($id_dos)['dispatch_date'] != $dispatch_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('dispatch_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dispatch_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET dispatch_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dispatch_date'], $entree['id_dos']));

		}
		public function MAJ_end_form($id_dos, $end_form){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['end_form'] = $end_form;
			
			//Log
			if ($this-> getDossier($id_dos)['end_form'] != $end_form) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('end_form', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $end_form, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET end_form = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['end_form'], $entree['id_dos']));

		}
		public function MAJ_exit_drc($id_dos, $exit_drc){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['exit_drc'] = $exit_drc;
			
			//Log
			if ($this-> getDossier($id_dos)['exit_drc'] != $exit_drc) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('exit_drc', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $exit_drc, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET exit_drc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['exit_drc'], $entree['id_dos']));

		}
		public function MAJ_site_load($id_dos, $site_load){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['site_load'] = $site_load;
			
			//Log
			if ($this-> getDossier($id_dos)['site_load'] != $site_load) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('site_load', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $site_load, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET site_load = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['site_load'], $entree['id_dos']));

		}
		public function MAJ_num_lot($id_dos, $num_lot){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['num_lot'] = $num_lot;
			
			//Log
			if ($this-> getDossier($id_dos)['num_lot'] != $num_lot) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('num_lot', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $num_lot, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET num_lot = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['num_lot'], $entree['id_dos']));

		}
		public function MAJ_nbre_seal($id_dos, $nbre_seal){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['nbre_seal'] = $nbre_seal;
			
			//Log
			if ($this-> getDossier($id_dos)['nbre_seal'] != $nbre_seal) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('nbre_seal', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $nbre_seal, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET nbre_seal = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['nbre_seal'], $entree['id_dos']));

		}
		public function MAJ_dgda_seal($id_dos, $dgda_seal){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dgda_seal'] = $dgda_seal;
			
			//Log
			if ($this-> getDossier($id_dos)['dgda_seal'] != $dgda_seal) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('dgda_seal', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dgda_seal, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET dgda_seal = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dgda_seal'], $entree['id_dos']));

		}
		public function MAJ_dispatch_pweto($id_dos, $dispatch_pweto){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dispatch_pweto'] = $dispatch_pweto;
			
			//Log
			if ($this-> getDossier($id_dos)['dispatch_pweto'] != $dispatch_pweto) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('dispatch_pweto', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dispatch_pweto, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET dispatch_pweto = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dispatch_pweto'], $entree['id_dos']));

		}
		public function MAJ_arrival_pweto($id_dos, $arrival_pweto){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['arrival_pweto'] = $arrival_pweto;
			
			//Log
			if ($this-> getDossier($id_dos)['arrival_pweto'] != $arrival_pweto) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('arrival_pweto', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $arrival_pweto, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET arrival_pweto = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['arrival_pweto'], $entree['id_dos']));

		}
		public function MAJ_barge_load($id_dos, $barge_load){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['barge_load'] = $barge_load;
			
			//Log
			if ($this-> getDossier($id_dos)['barge_load'] != $barge_load) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('barge_load', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $barge_load, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET barge_load = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['barge_load'], $entree['id_dos']));

		}
		public function MAJ_bae_date($id_dos, $bae_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bae_date'] = $bae_date;
			
			//Log
			if ($this-> getDossier($id_dos)['bae_date'] != $bae_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('bae_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bae_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET bae_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bae_date'], $entree['id_dos']));

		}
		public function MAJ_bs_date($id_dos, $bs_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bs_date'] = $bs_date;
			
			//Log
			if ($this-> getDossier($id_dos)['bs_date'] != $bs_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('bs_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bs_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET bs_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bs_date'], $entree['id_dos']));

		}
		public function MAJ_barge_dispatch_date($id_dos, $barge_dispatch_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['barge_dispatch_date'] = $barge_dispatch_date;
			
			//Log
			if ($this-> getDossier($id_dos)['barge_dispatch_date'] != $barge_dispatch_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('barge_dispatch_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $barge_dispatch_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET barge_dispatch_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['barge_dispatch_date'], $entree['id_dos']));

		}
		public function MAJ_doc_receiv($id_dos, $doc_receiv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['doc_receiv'] = $doc_receiv;
			
			//Log
			if ($this-> getDossier($id_dos)['doc_receiv'] != $doc_receiv) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('doc_receiv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $doc_receiv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET doc_receiv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['doc_receiv'], $entree['id_dos']));

		}

		public function MAJ_load_date($id_dos, $load_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['load_date'] = $load_date;
			
			//Log
			if ($this-> getDossier($id_dos)['load_date'] != $load_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('load_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $load_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET load_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['load_date'], $entree['id_dos']));

		}

		public function MAJ_localisation($id_dos, $localisation){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['localisation'] = $localisation;
			
			//Log
			if ($this-> getDossier($id_dos)['localisation'] != $localisation) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('localisation', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $localisation, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET localisation = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['localisation'], $entree['id_dos']));

		}

		public function MAJ_nbr_bags($id_dos, $nbr_bags){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['nbr_bags'] = $nbr_bags;
			
			//Log
			if ($this-> getDossier($id_dos)['nbr_bags'] != $nbr_bags) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('nbr_bags', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $nbr_bags, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET nbr_bags = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['nbr_bags'], $entree['id_dos']));

		}
		public function MAJ_docs_sncc($id_dos, $docs_sncc){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['docs_sncc'] = $docs_sncc;
			
			//Log
			if ($this-> getDossier($id_dos)['docs_sncc'] != $docs_sncc) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('docs_sncc', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $docs_sncc, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET docs_sncc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['docs_sncc'], $entree['id_dos']));

		}
		public function MAJ_sncc_sakania($id_dos, $sncc_sakania){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['sncc_sakania'] = $sncc_sakania;
			
			//Log
			if ($this-> getDossier($id_dos)['sncc_sakania'] != $sncc_sakania) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('sncc_sakania', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $sncc_sakania, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET sncc_sakania = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['sncc_sakania'], $entree['id_dos']));

		}
		public function MAJ_sakania_date($id_dos, $sakania_date){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['sakania_date'] = $sakania_date;
			
			//Log
			if ($this-> getDossier($id_dos)['sakania_date'] != $sakania_date) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('sakania_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $sakania_date, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET sakania_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['sakania_date'], $entree['id_dos']));

		}
		public function MAJ_destination($id_dos, $destination){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['destination'] = $destination;
			
			//Log
			if ($this-> getDossier($id_dos)['destination'] != $destination) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('destination', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $destination, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET destination = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['destination'], $entree['id_dos']));

		}
		public function MAJ_impala_sncc($id_dos, $impala_sncc){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['impala_sncc'] = $impala_sncc;
			
			//Log
			if ($this-> getDossier($id_dos)['impala_sncc'] != $impala_sncc) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('impala_sncc', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $impala_sncc, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET impala_sncc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['impala_sncc'], $entree['id_dos']));

		}

		public function MAJ_barge($id_dos, $barge){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['barge'] = $barge;
			
			//Log
			if ($this-> getDossier($id_dos)['barge'] != $barge) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('barge', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $barge, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET barge = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['barge'], $entree['id_dos']));

		}

		public function MAJ_ship_num($id_dos, $ship_num){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ship_num'] = $ship_num;
			
			//Log
			if ($this-> getDossier($id_dos)['ship_num'] != $ship_num) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('ship_num', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ship_num, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET ship_num = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ship_num'], $entree['id_dos']));

		}

		public function MAJ_kapulo_load($id_dos, $kapulo_load){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['kapulo_load'] = $kapulo_load;
			
			//Log
			if ($this-> getDossier($id_dos)['kapulo_load'] != $kapulo_load) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('kapulo_load', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $kapulo_load, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET kapulo_load = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['kapulo_load'], $entree['id_dos']));

		}

		public function MAJ_facture($id_dos, $facture){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['facture'] = $facture;
			
			//Log
			if ($this-> getDossier($id_dos)['facture'] != $facture) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('facture', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $facture, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET facture = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['facture'], $entree['id_dos']));

		}

		public function MAJ_bond_warehouse($id_dos, $bond_warehouse){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bond_warehouse'] = $bond_warehouse;
			
			//Log
			if ($this-> getDossier($id_dos)['bond_warehouse'] != $bond_warehouse) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('bond_warehouse', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bond_warehouse, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET bond_warehouse = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bond_warehouse'], $entree['id_dos']));

		}

		/*public function MAJ_montant_av($id_dos, $montant_av){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['montant_av'] = $montant_av;
			$requete = $connexion-> prepare("UPDATE dossier SET montant_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['montant_av'], $entree['id_dos']));

		} */

		public function MAJ_apurement_lic($num_lic, $apurement){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['apurement'] = $apurement;
			$requete = $connexion-> prepare("UPDATE licence SET apurement = ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['apurement'], $entree['num_lic']));

		}
/*
*/
		//FIN Methodes permettant de mettre à jour

		//Methode permettant de supprimer
		public function deleteDetailFacture($ref_fact, $id_dos){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			/*echo '<br>  ref_fact= '.$ref_fact;
			echo '<br>  id_dos= '.$id_dos;*/

			$requete = $connexion-> prepare("DELETE FROM detail_facture_dossier
												WHERE ref_fact = ?
													AND id_dos = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos']));

		}
	
		public function remove_detail_apurement($id_trans_ap, $id_dos){

			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;
			$entree['id_dos'] = $id_dos;

			/*echo '<br>  id_trans_ap= '.$id_trans_ap;
			echo '<br>  id_dos= '.$id_dos;*/

			$requete = $connexion-> prepare("DELETE FROM detail_apurement
												WHERE id_trans_ap = ?
													AND id_dos = ?");
			$requete-> execute(array($entree['id_trans_ap'], $entree['id_dos']));

		}
	
		public function deleteLicenceUpload($id_mod_lic, $id_util){

			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_util= '.$id_util;*/

			$requete = $connexion-> prepare("DELETE FROM licence_upload
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));

		}

		public function deleteDossierUpload($id_mod_lic, $id_util){

			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_util= '.$id_util;*/

			$requete = $connexion-> prepare("DELETE FROM dossier_upload
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));

		}

		public function deleteDossierUploadTracking($id_mod_lic, $id_util){

			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_util= '.$id_util;*/

			$requete = $connexion-> prepare("DELETE FROM dossier_upload_tracking
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));

		}

		public function supprimerFactureDossier($ref_fact){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  ref_fact= '.$ref_fact;*/

			$requete = $connexion-> prepare("DELETE FROM facture_dossier
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));

		}

		public function etatFactureDossier($ref_fact, $validation){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['validation'] = $validation;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  ref_fact= '.$ref_fact;*/

			$requete = $connexion-> prepare("UPDATE facture_dossier
												SET validation = ?, transmission = '0', date_transmis = NULL, id_util_transmis = NULL, finger = '0', id_util_finger = NULL, date_finger = NULL
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['validation'], $entree['ref_fact']));

		}

		public function deleteDossierEBUpload($id_util){

			include('connexion.php');
			$entree['id_util'] = $id_util;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_util= '.$id_util;*/

			$requete = $connexion-> prepare("DELETE FROM dossier_upload_export
												WHERE id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util']));

		}

		public function deleteMarchandiseDossier($id_march_dos){

			include('connexion.php');
			$entree['id_march_dos'] = $id_march_dos;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_march_dos= '.$id_march_dos;*/

			$requete = $connexion-> prepare("DELETE FROM marchandise_dossier
												WHERE id_march_dos = ?");
			$requete-> execute(array($entree['id_march_dos']));

		}

		public function deleteDossier($id_dos){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_dos= '.$id_dos;*/

			$requete = $connexion-> prepare("DELETE FROM dossier
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));

		}


		public function selectionnerFactureNonValideeClient($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$select = '<select class="form-control form-control-sm bg bg-dark" type="text" name="ref_fact" id="ref_fact" onchange="detail_invoice_acid(this.value);">
              			<option></option>';

			$requete = $connexion-> prepare("SELECT *
											FROM facture_dossier
											WHERE id_cli = ?
												-- AND id_mod_trans = ?
												AND id_mod_lic = ?
												AND validation = '0'
											ORDER BY ref_fact DESC");
			// $requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				$select .= '<option value="'.$reponse['ref_fact'].'">
								'.$reponse['ref_fact'].'
							</option>';
			}$requete-> closeCursor();

			$select .= '</select>';

			return $select;
		}

		public function detail_invoice_acid($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			// $entree['id_mod_trans'] = $id_mod_trans;
			// $entree['id_mod_lic'] = $id_mod_lic;

			$file = '';
			$compteur = 0;
			$duty_cdf = 0;
			$duty_usd = 0;
			$other_usd = 0;
			$total_usd = 0;
			$liquidation = 0;
			$liquidation_usd = 0;

			$requete = $connexion-> prepare("SELECT dossier.ref_dos AS ref_dos,
													dossier.id_dos AS id_dos,
													dossier.id_cli AS id_cli,
													dossier.id_mod_lic AS id_mod_lic,
													dossier.id_march AS id_march,
													dossier.id_mod_trans AS id_mod_trans,
													dossier.num_lic AS num_lic,
													dossier.roe_decl AS roe_decl,
													SUM(
														IF(detail_facture_dossier.usd='0', 
															IF(detail_facture_dossier.tva='1',
																detail_facture_dossier.montant*0.16,
																detail_facture_dossier.montant
															),
															0
														)
													) AS ttc_cdf,
													SUM(
														IF(debours.id_t_deb='1' AND detail_facture_dossier.usd='0',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant*dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant*dossier.roe_decl)
																)
															, 0)
														) AS liquidation,
													SUM(
														IF(debours.id_t_deb='1' AND detail_facture_dossier.usd='0',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='0',
																	(detail_facture_dossier.montant*1.16)/dossier.roe_decl,
																	(detail_facture_dossier.montant*dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant/dossier.roe_decl,
																	detail_facture_dossier.montant)
																)
															, 0)
														) AS liquidation_usd,
													SUM(
														IF(debours.id_t_deb='1',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant*dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant*dossier.roe_decl)
																)
															, 0)
														) AS duty_cdf,
													SUM(
														IF(debours.id_t_deb='1',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant/dossier.roe_decl)
																)
															, 0)
														) AS duty_usd,
													SUM(
														IF(debours.id_t_deb<>'1',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant/dossier.roe_decl)
																)
															, 0)
														) AS other_usd,
													SUM(
														IF(detail_facture_dossier.tva='1',
															IF(detail_facture_dossier.usd='1',
																detail_facture_dossier.montant*1.16,
																(detail_facture_dossier.montant/dossier.roe_decl)*1.16),
															IF(detail_facture_dossier.usd='1',
																detail_facture_dossier.montant,
																(detail_facture_dossier.montant/dossier.roe_decl))
															)
														) AS total_usd
												FROM dossier, detail_facture_dossier, debours
												WHERE detail_facture_dossier.ref_fact = ?
													AND detail_facture_dossier.id_dos = dossier.id_dos
													AND detail_facture_dossier.id_deb = debours.id_deb
												GROUP BY dossier.id_dos");
			$requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$duty_cdf += $reponse['duty_cdf'];
				$duty_usd += $reponse['duty_usd'];
				$other_usd += $reponse['other_usd'];
				$total_usd += $reponse['total_usd'];
				$liquidation += $reponse['liquidation'];
				$liquidation_usd += $reponse['liquidation_usd'];

				$file .= '<tr>
							<td>'.$compteur.'</td>
							<td>'.$reponse['ref_dos'].'</td>
							<td style="text-align: right;">'.number_format($reponse['roe_decl'], 4, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['liquidation'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['liquidation_usd'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['ttc_cdf'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['duty_usd'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['other_usd'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['total_usd'], 2, ',', ' ').'</td>
							<td style="text-align: center;">
								<span class="btn btn-xs btn btn-warning" onclick="modalEditDetailFactureDossier('.$reponse['id_dos'].', \''.$ref_fact.'\', \''.$reponse['ref_dos'].'\', '.$reponse['id_cli'].', '.$reponse['id_mod_lic'].', '.$reponse['id_march'].', '.$reponse['id_mod_trans'].', \''.$reponse['num_lic'].'\', \''.$ref_fact.'\');">
									<i class="fa fa-edit"></i>
								</span>
								<span class="btn btn-xs btn btn-danger" onclick="supprimerDetailFactureDossier2('.$reponse['id_dos'].', \''.$ref_fact.'\', \''.$reponse['ref_dos'].'\', '.$reponse['id_cli'].', '.$reponse['id_mod_lic'].', '.$reponse['id_march'].', '.$reponse['id_mod_trans'].', \''.$reponse['num_lic'].'\');">
									<i class="fa fa-times"></i>
								</span>
							</td>
						</tr>';
			}$requete-> closeCursor();

			$file .= '<tr>
						<td colspan="3">TOTAL</td>
						<td style="text-align: right;">'.number_format($liquidation, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($liquidation_usd, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($duty_cdf, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($duty_usd, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($other_usd, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($total_usd, 2, ',', ' ').'</td>
					</tr>';

			return $file;
		}

		public function getDeboursPourFactureClientModeleLicenceAjaxEdit($id_cli, $id_mod_lic, $id_march, $id_mod_trans, $id_dos, $ref_fact){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$compteur = 0;
			$active = '';
			$sqlTypeDebours = '';
			$detail_input = '';
			$usd_input = '';
			$tva_input = '';
			$montant_input = '';
			$unite_input = '';

			$debours = '';

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				$debours .= '
							<tr id="">
								<th colspan="6" class="bg bg-secondary">
									<u>'.$reponseTypeDebours['nom_t_deb'].'</u>
								</th>
							</tr>
							<div>';
				?>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, 
														UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant_deb,
														af.detail AS detail
														-- af.unite AS unite,
														-- af.montant_min AS montant_min
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
														-- AND af.id_march = ?
														AND af.id_mod_trans = ?
													ORDER BY deb.rang, deb.id_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$compteur++;

					$mask_tva='';
					$montant_tva_input = '';

					$reponseDebours['montant'] = $this-> getMontantDeboursFactureDossier($ref_fact, $reponseDebours['id_deb'], $id_dos);
					$montant_tva = $this-> getMontantTVADeboursFactureDossier($ref_fact, $reponseDebours['id_deb'], $id_dos);
					// $reponseDebours['pourcentage_qte'] = $this-> getPourcentageDeboursFactureDossier2($ref_fact, $reponseDebours['id_deb'], $id_dos);
					$reponseDebours['tva'] = $this-> getTVADeboursFactureDossier($ref_fact, $reponseDebours['id_deb'], $id_dos);
					

					if ($reponseDebours['id_deb']=='109') {

						$unite_input = '<span id=""></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="tva" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='95') {

						$unite_input = '<span id="unite_fpi"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="fpi" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'fpi';
						
					}else if ($reponseDebours['id_deb']=='38') {

						$unite_input = '<span id="unite_rri"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="rri" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'rri';
						
					}else if ($reponseDebours['id_deb']=='35') {

						$unite_input = '<span id="unite_cog"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="cog" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'cog';
						
					}else if ($reponseDebours['id_deb']=='3') {

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="" id="unite_rls" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="rls" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'rls';
						
					}else if ($reponseDebours['id_deb']=='96') {

						$unite_input = '<span id="unite_dci"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="dci" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" value="'.$montant_tva.'" id="montant_tva_dci" onblur="calculDroit2();">';
						$mask_tva = 'dci';
						
					}else if ($reponseDebours['id_deb']=='97') {

						$unite_input = '<span id="unite_autres_taxes"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="autres_taxes" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'autre_taxe';
						
					}else if ($reponseDebours['id_deb']=='29') {

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="" id="unite_frais_bancaire"  value="'.$reponseDebours['montant_deb'].'" onblur="calculDroit2();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="frais_bancaire" value="'.$reponseDebours['montant'].'"><input type="hidden" id="montant_min" name="montant_min" value="'.$reponseDebours['montant_min'].'">';
						
					}else{

						$unite_input = '<span id="unite_'.$compteur.'"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="montant_'.$reponseDebours['id_deb'].'" value="'.$reponseDebours['montant'].'" onblur="getTotal()">';
						
					}

					if ($reponseDebours['detail']=='1') {
						$detail_input = ' : <input type="text" style="width: 20em;" name="detail_'.$compteur.'">';
					}else{
						$detail_input = '';
					}

					if ($reponseDebours['usd'] == '0') {
						$usd_input = '<option value="0">CDF</option><option value="1">USD</option>';
					}else{
						$usd_input = '<option value="1">USD</option><option value="0">CDF</option>';
					}

					if ($reponseDebours['tva'] == '0') {
						$tva_input = '<option value="0">NO</option><option value="1">YES</option>';
					}else{
						$tva_input = '<option value="1">YES</option><option value="0">NO</option>';
					}
				
					$debours .= '<tr>
									<td width="10%">
										<input type="hidden" id="id_deb_'.$compteur.'" name="id_deb_'.$compteur.'" value="'.$reponseDebours['id_deb'].'">
										'.$reponseDebours['abr_deb'].'
									</td>
									<td width="50%">
										'.$reponseDebours['nom_deb'].$detail_input.'
									</td>
									<td style="text-align: center;">
										'.$unite_input.'
									</td>
									<td style="text-align: center;">
										'.$montant_input.'

									</td>
									<td style="text-align: center;">
										<select name="usd_'.$compteur.'" id="usd_'.$compteur.'" onchange="getTotal()">
											'.$usd_input.'
										</select>
									</td>
									<td style="text-align: center;">
										<select name="tva_'.$compteur.'" id="tva_'.$mask_tva.'" onchange="calculDroit()">
											'.$tva_input.'
										</select>
									</td>
									<td style="text-align: center;">
										'.$montant_tva_input.'

									</td>
								</tr>';

					?>
					
					<?php
				}$requeteDebours-> closeCursor();
				$debours .= '</div>';

			}$requeteTypeDebours-> closeCursor();
			$debours .= '<input type="hidden" name="compteur" value="'.$compteur.'">';

			return $debours;
		}

		public function getMontantTVADeboursFactureDossier($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT ROUND(det.montant_tva, 3) AS montant_tva
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['montant_tva'];
			}else{
				return NULL;
			}
			
		}

		public function getTVADeboursFactureDossier($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT det.tva AS tva
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['tva'];
			}else{
				return '0';
			}
			
		}

		public function supprimerDetailFactureDossier2($id_dos){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_dos= '.$id_dos;*/

			$requete = $connexion-> prepare("DELETE FROM detail_facture_dossier
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));

		}

		public function getNbreDossier2(){
			include('connexion.php');
			$mois = date('m');
			$annee = date('Y');

			$donnee = '';

			$requete = $connexion-> query("SELECT COUNT(
														IF(DATE(date_creat_dos)=CURRENT_DATE(),
															id_dos,
															NULL
														)
													) AS dos_today,
													COUNT(
														IF(date_decl IS NULL AND id_mod_trans <> 27 AND ref_dos <> 'test',
															id_dos,
															NULL
														)
													) AS sans_E,
													COUNT(
														IF(date_liq IS NULL AND date_decl IS NOT NULL,
															id_dos,
															NULL
														)
													) AS sans_L,
													COUNT(
														IF(date_quit IS NULL AND date_liq IS NOT NULL,
															id_dos,
															NULL
														)
													) AS sans_Q,
													COUNT(
														IF(klsa_arriv IS NULL AND id_mod_lic='2',
															id_dos,
															NULL
														)
													) AS no_arrive_import,
													COUNT(
														IF(klsa_arriv IS NOT NULL AND dispatch_klsa IS NULL AND id_mod_lic='2',
															id_dos,
															NULL
														)
													) AS at_border_import,
													COUNT(
														IF(dispatch_klsa IS NOT NULL AND site_arriv IS NULL AND id_mod_lic='2',
															id_dos,
															NULL
														)
													) AS on_way_site_import,
													COUNT(
														IF(site_arriv = DATE(CURRENT_DATE()) AND id_mod_lic='2',
															id_dos,
															NULL
														)
													) AS at_site_today_import
												FROM dossier
												WHERE id_mod_lic <> 3
													AND id_mod_trans <> 27
													 AND ref_dos <> 'test'");
			// $requete-> execute(array($entree['mois']));
			$reponse=$requete-> fetch();

			return $reponse;
		}

		public function getReportGraphique1(){
			include('connexion.php');
			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');

			$donnee = '';

			$requete = $connexion-> query("SELECT ml.nom_mod_lic AS nom_mod_lic,
															ml.id_mod_lic AS id_mod_lic
														FROM modele_licence ml
														WHERE ml.id_etat = '1'
														ORDER BY ml.id_mod_lic");
			while ($reponse=$requete-> fetch()) {
				$donnee.='{
				        name: \''.$reponse['nom_mod_lic'].'\',
				        data: [';
		        for ($i=1; $i <= date('m') ; $i++) { 
		    		$donnee.= $this-> getNbreDosReportGraphique1($reponse['id_mod_lic'], $i).', ';
				}
				$donnee.='
						]
				    },';
			}$requete-> closeCursor();

			return $donnee;
		}

		public function getNbreDosReportGraphique1($id_mod_lic, $mois){
			include('connexion.php');
			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['mois'] = $mois;

			$donnee = '';

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre_dos
															FROM dossier
															WHERE 
															IF(id_util='1', IF(id_mod_lic<>3, MONTH(date_decl), MONTH(date_creat_dos)), MONTH(date_creat_dos)) = ?
																-- MONTH(date_creat_dos) = ?
																AND YEAR(date_creat_dos) = YEAR(CURRENT_DATE())
																AND id_mod_lic = ?");
			$requete-> execute(array($entree['mois'], $entree['id_mod_lic']));
			$reponse=$requete-> fetch();

			return $reponse['nbre_dos'];
		}


		public function getNbreDosMoisActuel($mois){
			include('connexion.php');
			$entree['mois'] = $mois;

			$donnee = '';

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre_dos
															FROM dossier
															WHERE IF(id_util='1', IF(id_mod_lic<>3, MONTH(date_decl), MONTH(date_creat_dos)), MONTH(date_creat_dos)) = ?
																AND IF(date_decl IS NOT NULL, YEAR(date_decl), YEAR(date_creat_dos)) = YEAR(CURRENT_DATE())");
			$requete-> execute(array($entree['mois']));
			$reponse=$requete-> fetch();

			if ($reponse['nbre_dos']>1) {
				return $reponse['nbre_dos'];
			}else{
				$reponse['nbre_dos'] = 1;
				return $reponse['nbre_dos'];
			}

		}

		public function getReportGraphique2($mois, $total){
			include('connexion.php');

			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');
			$entree['mois'] = $mois;

			$donnee = '';

			$requete = $connexion-> prepare("SELECT cl.nom_cli AS nom_cli,
															cl.id_cli AS id_cli,
															COUNT(d.id_dos) AS nbre_dos
														FROM client cl, dossier d
														WHERE d.id_cli = cl.id_cli
															AND MONTH(d.date_creat_dos) = ?
															AND YEAR(d.date_creat_dos) = YEAR(CURRENT_DATE())
														GROUP BY cl.id_cli
														ORDER BY cl.nom_cli");
			$requete-> execute(array($entree['mois']));
			while ($reponse=$requete-> fetch()) {
				$donnee.='{
				            name: "'.$reponse['nom_cli'].'",
				            y: '.round(($reponse['nbre_dos']*$total)/$total, 2).',
				            sliced: false,
				            selected: false
				        },';
			}$requete-> closeCursor();

			return $donnee;
		}

		public function graphique_1($mois, $id_mod_lic){
			include('connexion.php');
			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['mois'] = $mois;
			$compteur = 0;

			$rows=array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli,
													march.nom_march AS nom_march,
													dos.num_lot AS num_lot,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(dos.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(dos.load_date, '%d/%m/%Y') AS load_date,
													DATE_FORMAT(dos.site_dep, '%d/%m/%Y') AS site_dep,
													IF(dos.id_mod_lic='2' OR dos.id_mod_lic='3',
														DATE_FORMAT(dos.date_preal, '%d/%m/%Y'),
														DATE_FORMAT(dos.doc_receiv, '%d/%m/%Y')
													) AS date_preal,
													IF(dos.id_mod_lic='2',
														IF(dos.date_decl IS NOT NULL,
															DATEDIFF(dos.date_decl, dos.date_preal),
															DATEDIFF(CURRENT_DATE(), dos.date_preal)
														),
														IF(dos.id_mod_lic='3',
															IF(dos.site_dep IS NOT NULL,
																DATEDIFF(dos.site_dep, dos.load_date),
																DATEDIFF(CURRENT_DATE(), dos.load_date)
															),
															IF(dos.date_decl IS NOT NULL,
																DATEDIFF(dos.date_decl, dos.doc_receiv),
																DATEDIFF(CURRENT_DATE(), dos.doc_receiv)
															)
														)
													) AS delai_date_preal
													FROM dossier dos, client cl, marchandise march
													WHERE MONTHNAME(dos.date_creat_dos) = ?
														-- MONTH(date_creat_dos) = ?
														AND YEAR(dos.date_creat_dos) = YEAR(CURRENT_DATE())
														AND dos.id_mod_lic = ?
														AND dos.id_cli = cl.id_cli
														AND dos.id_march = march.id_march");
			$requete-> execute(array($entree['mois'], $entree['id_mod_lic']));
			while($reponse=$requete-> fetch()){

				$compteur++;
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}

		public function graphique_2($mois, $id_mod_lic, $nom_cli){
			include('connexion.php');
			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['mois'] = $mois;
			$entree['nom_cli'] = $nom_cli;
			$compteur = 0;

			$rows=array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli,
													march.nom_march AS nom_march,
													dos.ref_decl AS ref_decl,
													dos.num_lot AS num_lot,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(dos.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(dos.load_date, '%d/%m/%Y') AS load_date,
													DATE_FORMAT(dos.site_dep, '%d/%m/%Y') AS site_dep
													FROM dossier dos, client cl, marchandise march
													WHERE MONTH(dos.date_creat_dos) = ?
														-- MONTH(date_creat_dos) = ?
														AND YEAR(dos.date_creat_dos) = YEAR(CURRENT_DATE())
														AND dos.id_mod_lic = ?
														AND dos.id_cli = cl.id_cli
														AND cl.nom_cli = ?
														AND dos.id_march = march.id_march");
			$requete-> execute(array($entree['mois'], $entree['id_mod_lic'], $entree['nom_cli']));
			while($reponse=$requete-> fetch()){

				$compteur++;
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}

		public function graphique_3($statut){
			include('connexion.php');
			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');

			$compteur = 0;

			$rows=array();

			$sqlStatut = '';

			if ($statut=='dos_today') {
				$sqlStatut = 'AND DATE(dos.date_creat_dos) = CURRENT_DATE()';
			}else if ($statut=='sans_E') {
				$sqlStatut = 'AND dos.date_decl IS NULL AND dos.id_mod_trans <> 27';
			}else if ($statut=='sans_L') {
				$sqlStatut = 'AND dos.date_liq IS NULL AND dos.date_decl IS NOT NULL';
			}else if ($statut=='sans_Q') {
				$sqlStatut = 'AND dos.date_quit IS NULL AND dos.date_liq IS NOT NULL';
			}else if ($statut=='no_arrive_import') {
				$sqlStatut = 'AND dos.klsa_arriv IS NULL AND dos.id_mod_lic=2';
			}else if ($statut=='at_border_import') {
				$sqlStatut = 'AND dos.klsa_arriv IS NOT NULL AND dos.dispatch_klsa IS NULL AND dos.id_mod_lic=2';
			}else if ($statut=='on_way_site_import') {
				$sqlStatut = 'AND dos.dispatch_klsa IS NOT NULL AND dos.site_arriv IS NULL AND dos.id_mod_lic=2';
			}else if ($statut=='at_site_today_import') {
				$sqlStatut = 'AND dos.site_arriv = DATE(CURRENT_DATE()) AND dos.id_mod_lic=2';
			}else if ($statut=='dossier_pending') {
				$sqlStatut = 'AND 
								(
									(
										dos.ref_decl IS NOT NULL
										AND dos.date_decl IS NOT NULL
										AND dos.ref_liq IS NOT NULL
										AND dos.date_liq IS NOT NULL
										AND dos.ref_quit IS NOT NULL
										AND dos.date_quit IS NOT NULL
										AND dos.id_mod_lic <> 3
									)
									OR
									(
										dos.id_mod_lic = 3
										AND dos.site_dep IS NOT NULL
									)
								)
								AND dos.not_fact = \'0\'
								AND dos.id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)';
			}

			$requete = $connexion-> query("SELECT dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli,
													march.nom_march AS nom_march,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													ml.nom_mod_lic AS nom_mod_lic,
													-- IF(dos.id_mod_lic='2' OR dos.id_mod_lic='3',
													-- 	DATE_FORMAT(dos.date_preal, '%d/%m/%Y'),
													-- 	DATE_FORMAT(dos.doc_receiv, '%d/%m/%Y')
													-- ) AS date_preal,
													-- IF(dos.id_mod_lic='2',
													-- 	IF(dos.date_decl IS NOT NULL,
													-- 		DATEDIFF(dos.date_decl, dos.date_preal),
													-- 		DATEDIFF(CURRENT_DATE(), dos.date_preal)
													-- 	),
													-- 	IF(dos.date_decl IS NOT NULL,
													-- 		DATEDIFF(dos.date_decl, dos.doc_receiv),
													-- 		DATEDIFF(CURRENT_DATE(), dos.doc_receiv)
													-- 	)
													-- ) AS delai_date_preal,
													DATE_FORMAT(dos.date_preal, '%d/%m/%Y') AS date_preal,
													IF(dos.date_decl IS NOT NULL,
														DATEDIFF(dos.date_decl, dos.date_preal),
														DATEDIFF(CURRENT_DATE(), dos.date_preal)
													) AS delai_date_preal,
													dos.remarque AS remarque
													FROM dossier dos, client cl, marchandise march, modele_licence ml
													WHERE dos.id_cli = cl.id_cli
														AND dos.id_march = march.id_march
														ANd dos.id_mod_lic = ml.id_mod_lic
														AND dos.id_mod_trans <> 27
														AND dos.ref_dos <> 'test'
														-- AND dos.id_mod_lic <> 3
														$sqlStatut");
			// $requete-> execute(array($entree['mois'], $entree['id_mod_lic'], $entree['nom_cli']));
			while($reponse=$requete-> fetch()){

				$compteur++;
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}

		public function getReportGraphiqueHistogrammeFacture(){
			include('connexion.php');
			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');

			$donnee = '';

			$requete = $connexion-> query("SELECT ml.nom_mod_lic AS nom_mod_lic,
															ml.id_mod_lic AS id_mod_lic
														FROM modele_licence ml
														WHERE ml.id_etat = '1'
														ORDER BY ml.id_mod_lic");
			while ($reponse=$requete-> fetch()) {
				$donnee.='{
				        name: \''.$reponse['nom_mod_lic'].'\',
				        data: [';
		        for ($i=1; $i <= date('m') ; $i++) { 
		    		$donnee.= $this-> getFactureHistogrammeDashboard($reponse['id_mod_lic'], $i).', ';
				}
				$donnee.='
						]
				    },';
			}$requete-> closeCursor();

			return $donnee;
		}

		public function getFactureHistogrammeDashboard($id_mod_lic, $mois){
			include('connexion.php');
			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['mois'] = $mois;

			$donnee = '';

			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre_fact
												FROM facture_dossier
												WHERE MONTH(date_fact) = ?
													AND YEAR(date_fact) = YEAR(CURRENT_DATE())
													AND validation = '1'
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['mois'], $entree['id_mod_lic']));
			$reponse=$requete-> fetch();

			return $reponse['nbre_fact'];
		}

		public function getNbreFactureMoisActuel($mois){
			include('connexion.php');
			$entree['mois'] = $mois;

			$donnee = '';

			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre_fact
															FROM facture_dossier
															WHERE MONTH(date_fact) = ?
																AND YEAR(date_fact) = YEAR(CURRENT_DATE())");
			$requete-> execute(array($entree['mois']));
			$reponse=$requete-> fetch();

			return $reponse['nbre_fact'];
		}

		public function getReportGraphiquePieFacturation($mois, $total){
			include('connexion.php');
			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');
			$entree['mois'] = $mois;

			$donnee = '';

			$requete = $connexion-> prepare("SELECT cl.nom_cli AS nom_cli,
															cl.id_cli AS id_cli,
															COUNT(fd.ref_fact) AS nbre_fact
														FROM client cl, facture_dossier fd
														WHERE fd.id_cli = cl.id_cli
															AND MONTH(fd.date_fact) = ?
															AND YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
														GROUP BY cl.id_cli
														ORDER BY cl.nom_cli");
			$requete-> execute(array($entree['mois']));
			while ($reponse=$requete-> fetch()) {
				$donnee.='{
				            name: "'.$reponse['nom_cli'].'",
				            y: '.round(($reponse['nbre_fact']*$total)/$total, 2).',
				            sliced: false,
				            selected: false
				        },';
			}$requete-> closeCursor();

			return $donnee;
		}

		public function getNotificationFacturationDashboard(){
			include('connexion.php');
			$mois = date('m');
			$annee = date('Y');

			$donnee = '';

			$requete = $connexion-> query("SELECT COUNT(
														IF(fd.validation = '0',
															fd.ref_fact,
															NULL
														)
													) AS no_valid
												FROM facture_dossier fd");
			// $requete-> execute(array($entree['mois']));
			$reponse=$requete-> fetch();

			return $reponse;
		}

		public function getNbreDossierEnAttenteFacture2(){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;
			// $entree['id_cli'] = $id_cli;


			$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE 
													(
														(
															ref_decl IS NOT NULL
															AND date_decl IS NOT NULL
															AND ref_liq IS NOT NULL
															AND date_liq IS NOT NULL
															AND ref_quit IS NOT NULL
															AND date_quit IS NOT NULL
															AND id_mod_lic <> 3
														)
														OR
														(
															id_mod_lic = 3
															AND site_dep IS NOT NULL
														)
													)
													-- AND (
													-- 		()
													-- 	)
													AND not_fact = '0'
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}


		public function graphique_histogramme_dashboard_facturation($id_mod_lic, $mois){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['mois'] = $mois;

			$compteur = 0;

			$rows=array();


			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													dos.ref_dos AS ref_dos,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													-- mf.edit_page AS edit_page,
													-- mf.view_page AS view_page,
													-- mf.excel AS excel,
													SUM( 
														IF(det.usd='1', 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva='1',
																((det.montant*1.16)/dos.roe_decl),
																(det.montant/dos.roe_decl)
															)
														) 
													) AS montant
 												FROM facture_dossier fd, client cl, utilisateur u, detail_facture_dossier det, dossier dos
												WHERE fd.id_mod_lic = ?
													AND MONTHNAME(fd.date_fact) = ?
													AND YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													-- AND fd.id_mod_fact = mf.id_mod_fact
													-- AND fd.validation = '0'
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['mois']));
			while($reponse=$requete-> fetch()){

				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}

		public function graphique_pie_dashboard_facturation($id_mod_lic, $nom_cli, $mois){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['nom_cli'] = $nom_cli;
			$entree['mois'] = $mois;

			$compteur = 0;

			$rows=array();


			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													dos.ref_dos AS ref_dos,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													SUM( 
														IF(det.usd='1', 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva='1',
																((det.montant*1.16)/dos.roe_decl),
																(det.montant/dos.roe_decl)
															)
														) 
													) AS montant
 												FROM facture_dossier fd, client cl, utilisateur u,detail_facture_dossier det, dossier dos
												WHERE fd.id_mod_lic = ?
													AND MONTH(fd.date_fact) = ?
													AND YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND cl.nom_cli = ?
													-- AND fd.validation = '0'
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['mois'], $entree['nom_cli']));
			while($reponse=$requete-> fetch()){

				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['solde_usd'] = $reponse['ttc_usd']-$reponse['arsp_usd'];
				$reponse['solde_cdf'] = $reponse['ttc_cdf']-$reponse['arsp_cdf'];
				$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}

		public function notification_dashboard_facturation($statut){
			include('connexion.php');
			$debut = '01-01-'.date('Y');
			$fin = date('d-m-Y');

			$compteur = 0;

			$rows=array();

			$sqlStatut = '';

			if ($statut=='no_valid') {
				$sqlStatut = ' WHERE fd.validation=\'0\' ';
			}

			$requete = $connexion-> query("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													dos.ref_dos AS ref_dos,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													SUM( 
														IF(det.usd='1', 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva='1',
																((det.montant*1.16)/dos.roe_decl),
																(det.montant/dos.roe_decl)
															)
														) 
													) AS montant
 												FROM facture_dossier fd
 													LEFT JOIN client cl
 														ON fd.id_cli = cl.id_cli 
 													LEFT JOIN utilisateur u
 														ON fd.id_util = u.id_util 
 													LEFT JOIN detail_facture_dossier det
 														ON fd.ref_fact = det.ref_fact 
 													LEFT JOIN dossier dos
 														ON det.id_dos = dos.id_dos
												$sqlStatut
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact ASC");
			// $requete-> execute(array($entree['mois'], $entree['id_mod_lic'], $entree['nom_cli']));
			while($reponse=$requete-> fetch()){

				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}

		public function lister_dossier_site($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT dos.id_dos AS id_dos,
													dos.ref_dos AS ref_dos,
													dos.num_lot AS num_lot,
													dos.commodity AS commodity,
													dos.transporter AS transporter,
													dos.road_manif AS road_manif,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													DATE_FORMAT(dos.site_arriv, '%d/%m/%Y') AS site_arriv,
													DATE_FORMAT(dos.load_date, '%d/%m/%Y') AS load_date,
													DATE_FORMAT(dos.site_dep, '%d/%m/%Y') AS site_dep,
													mt.nom_mod_trans AS nom_mod_trans,
													CONCAT('
													<button class=\"btn btn-xs bg bg-dark square-btn-adjust\" onclick=\"window.open(\'../popUpDocumentDossier.php?id_dos=',dos.id_dos,'&id_mod_lic=',dos.id_mod_lic,'&ref_dos=',dos.ref_dos,'\',\'Archive\',\'width=400,height=700\');\">
									                    <i class=\"fas fa-archive\"></i>
									                </button> 
									                <button class=\"btn btn-xs bg bg-warning\" onclick=\'modal_edit_dossier(',dos.id_dos,');\'>
														<i class=\'fa fa-edit\'></i>
													</button>') AS btn_action
												FROM dossier dos, mode_transport mt
												WHERE dos.id_mod_trans = mt.id_mod_trans
													AND dos.id_cli = ?
													AND dos.id_mod_lic = ?
													AND dos.cleared <> '2'
													AND dos.principal = '1'
												ORDER BY dos.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while($reponse=$requete-> fetch()){

				$compteur++;
				$reponse['compteur'] = $compteur;
				// $reponse['btn_action'] .= 
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}

		public function table_aff_module($id_util){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$compteur = 0;

			$table = '';

			$requete = $connexion-> prepare("SELECT m.nom_mod AS nom_mod,
													m.id_mod AS id_mod
												FROM module m, affectation_utilisateur_module aff
												WHERE aff.id_util = ?
													AND aff.id_mod = m.id_mod");
			$requete-> execute(array($entree['id_util']));
			while($reponse=$requete-> fetch()){

				$compteur++;
				$table .='<tr>
							<td>'.$compteur.'</td>
							<td>'.$reponse['nom_mod'].'</td>
							<td><span class="btn btn-xs text-danger" onclick="delete_aff_module('.$entree['id_util'].', '.$reponse['id_mod'].');"></span></td>
						</tr>';

			}$requete-> closeCursor();

			return $table;
		}

		public function lister_dossier_site_popup($id_cli, $id_mod_lic, $statut, $date_dos=null){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;

			$sqlStatut = '';

			if ($statut=='no_arrive') {
				$sqlStatut = ' AND site_arriv IS NULL ';
			}else if ($statut=='arrive_today') {
				$sqlStatut = ' AND site_arriv = CURRENT_DATE() ';
			}else if ($statut=='no_out') {
				$sqlStatut = ' AND site_dep IS NULL ';
			}else if ($statut=='out_today') {
				$sqlStatut = ' AND site_dep = CURRENT_DATE() ';
			}else if ($statut=='date_dos') {
				$sqlStatut = ' AND (site_dep = "'.$date_dos.'" OR site_arriv = "'.$date_dos.'")';
			}

			$rows = array();

			$requete = $connexion-> prepare("SELECT dos.id_dos AS id_dos,
													dos.ref_dos AS ref_dos,
													dos.num_lot AS num_lot,
													dos.commodity AS commodity,
													dos.transporter AS transporter,
													dos.road_manif AS road_manif,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													DATE_FORMAT(dos.site_arriv, '%d/%m/%Y') AS site_arriv,
													DATE_FORMAT(dos.load_date, '%d/%m/%Y') AS load_date,
													DATE_FORMAT(dos.site_dep, '%d/%m/%Y') AS site_dep,
													mt.nom_mod_trans AS nom_mod_trans,
													CONCAT('<button class=\"btn btn-xs bg bg-primary\" onclick=\'modal_edit_dossier(',dos.id_dos,');\'>
														<i class=\'fa fa-arrow-circle-right\'></i>
													</button>') AS btn_action
												FROM dossier dos, mode_transport mt
												WHERE dos.id_mod_trans = mt.id_mod_trans
													AND dos.id_cli = ?
													AND dos.id_mod_lic = ?
													AND dos.cleared <> '2'
													AND dos.principal = '1'
													$sqlStatut
												ORDER BY dos.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while($reponse=$requete-> fetch()){

				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['btn_action'] .= '<span class="btn-xs bg-dark dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
	                        <i class="fa fa-folder-open"></i><sup><span class="">'.$this-> getNombreDocumentDossier($reponse['id_dos']).'</span></sup>
	                        <span class="sr-only">Toggle Dropdown</span>
	                        <div class="dropdown-menu" role="menu">
	                          '.$this-> getListeDocumentForDossier($reponse['id_dos'], $entree['id_mod_lic']).'
	                        </div>
	                      </span>';
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}

		public function getNombreNotificationSite($id_cli, $id_mod_lic){
			include("connexion.php");

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT COUNT(
														IF(site_arriv IS NULL AND id_mod_lic = 2, id_dos, NULL)
													) AS nbre_no_arrive,
													COUNT(
														IF(site_arriv IS NOT NULL AND site_arriv = CURRENT_DATE() AND id_mod_lic = 2, id_dos, NULL)
													) AS nbre_arrive_today,
													COUNT(
														IF(site_dep IS NULL AND id_mod_lic = 1, id_dos, NULL)
													) AS nbre_no_out,
													COUNT(
														IF(site_dep IS NOT NULL AND site_dep = CURRENT_DATE() AND id_mod_lic = 1, id_dos, NULL)
													) AS nbre_out_today
												FROM dossier
												WHERE cleared <> '2'
													AND id_mod_lic = ?
													AND principal = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));

			$reponse = $requete-> fetch();

			return $reponse;
		}


		public function getNombreNotificationFrontiere(){
			include("connexion.php");
			// $entree['id_pres'] = $id_pres;

			$requete = $connexion-> query("SELECT COUNT(
														IF((arrival_date IS NULL AND klsa_arriv IS NULL), id_dos, NULL)
													) AS nbre_no_arrive,
													COUNT(
														IF((arrival_date IS NOT NULL OR klsa_arriv IS NOT NULL) AND kbp_dep_date IS NULL, id_dos, NULL)
													) AS nbre_at_border,
													COUNT(
														IF((arrival_date IS NOT NULL OR klsa_arriv IS NOT NULL) AND kbp_dep_date IS NULL AND DATEDIFF(CURRENT_DATE(), arrival_date)>=2, id_dos, NULL)
													) AS nbre_at_border_2_jours,
													COUNT(
														IF((arrival_date IS NOT NULL OR klsa_arriv IS NOT NULL) AND kbp_dep_date IS NOT NULL AND kbp_dep_date=CURRENT_DATE(), id_dos, NULL)
													) AS nbre_dispatch_today
												FROM dossier
												WHERE cleared = '0'");
			// $requete-> execute(array($entree['id_pres']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function selectionnerFrontiere(){
			include("connexion.php");
			// $entree['id_pres'] = $id_pres;

			$requete = $connexion-> query("SELECT *
												FROM frontiere");

			while ($reponse=$requete-> fetch()) {
			?>
				<option value="<?php echo $reponse['nom_front'];?>"><?php echo $reponse['nom_front'];?></option>
			<?php
			}$requete-> closeCursor();
		}

		public function afficher_mouvement_border($id_mod_lic){
			include('connexion.php');

			$compteur=0;
			$entree['id_mod_lic'] = $id_mod_lic;

			$rows = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
												dos.id_dos AS id_dos,
												dos.num_lot AS num_lot,
												CONCAT(
													IF(dos.horse IS NOT NULL AND REPLACE(dos.horse, ' ', '') NOT LIKE '',
														dos.horse,
														''),
													IF(dos.trailer_1 IS NOT NULL AND REPLACE(dos.trailer_1, ' ', '') NOT LIKE '',
														CONCAT(' / ', dos.trailer_1),
														''),
													IF(dos.trailer_2 IS NOT NULL AND REPLACE(dos.trailer_2, ' ', '') NOT LIKE '',
														CONCAT(' / ', dos.trailer_2),
														'')
												) AS truck,
												dos.transporter AS transporter,
												dos.frontiere AS frontiere,
												ml.nom_mod_lic AS nom_mod_lic,
												cl.nom_cli AS nom_cli,
												DATE_FORMAT(dos.klsa_arriv, '%d/%m/%Y') AS klsa_arriv,
												DATE_FORMAT(dos.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa,
												DATE_FORMAT(dos.arrival_date, '%d/%m/%Y') AS arrival_date,
												DATE_FORMAT(dos.wiski_arriv, '%d/%m/%Y') AS wiski_arriv,
												DATE_FORMAT(dos.wiski_dep, '%d/%m/%Y') AS wiski_dep,
												DATE_FORMAT(dos.kisanga_in, '%d/%m/%Y') AS kisanga_in,
												DATE_FORMAT(dos.kisanga_out, '%d/%m/%Y') AS kisanga_out,
												DATE_FORMAT(dos.klsa_arriv, '%d/%m/%Y') AS klsa_arriv,
												DATE_FORMAT(dos.klsa_dep, '%d/%m/%Y') AS klsa_dep,
												IF(dos.ref_decl IS NOT NULL,
													CONCAT(dos.ref_decl, ' du ', DATE_FORMAT(dos.date_decl, '%d/%m/%Y')),
													NULL
													) AS declaration,
												IF(dos.ref_liq IS NOT NULL,
													CONCAT(dos.ref_liq, ' du ', DATE_FORMAT(dos.date_liq, '%d/%m/%Y')),
													NULL
													) AS liquidation,
												IF(dos.ref_quit IS NOT NULL,
													CONCAT(dos.ref_quit, ' du ', DATE_FORMAT(dos.date_quit, '%d/%m/%Y')),
													NULL
													) AS quittance,
												DATE_FORMAT(dos.bae_date, '%d/%m/%Y') AS bae_date,
												DATE_FORMAT(dos.bs_date, '%d/%m/%Y') AS bs_date,
												DATE_FORMAT(dos.site_arriv, '%d/%m/%Y') AS site_arriv,
												DATE_FORMAT(dos.site_dep, '%d/%m/%Y') AS site_dep,
												IF(dos.kbp_arrival_date IS NULL,
													0,
													IF(dos.kbp_dep_date IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(dos.kbp_arrival_date)),
														DATEDIFF(DATE(dos.kbp_dep_date), DATE(dos.kbp_arrival_date))
													)
												) AS delai_import,
												IF(dos.klsa_arriv IS NULL,
													0,
													IF(dos.klsa_dep IS NULL,
														DATEDIFF(CURRENT_DATE(), DATE(dos.klsa_arriv)),
														DATEDIFF(DATE(dos.klsa_dep), DATE(dos.klsa_arriv))
													)
												) AS delai_export,
												DATE_FORMAT(dos.kbp_arrival_date, '%d/%m/%Y') AS kbp_arrival_date,
												DATE_FORMAT(dos.kbp_dep_date, '%d/%m/%Y') AS kbp_dep_date,
												CONCAT(
												' <button class=\"btn btn-xs btn-info\" title=\"Details\" onclick=\"modal_detail_dossier(\'',dos.id_dos,'\');\">
														<i class=\"fa fa-arrow-circle-right\"></i>
													</button> '
												) AS btn_action
											FROM dossier dos, client cl, modele_licence ml
											WHERE dos.id_cli = cl.id_cli
												AND dos.id_mod_lic = ml.id_mod_lic
												AND dos.id_mod_lic = ?
												-- AND dos.id_mod_trans = 1
												AND dos.cleared = '0'
												AND YEAR(dos.date_creat_dos)>2022
											ORDER BY dos.id_dos DESC
											");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){

				$compteur++;
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();
			
			return $rows;

		}

	}
?>
