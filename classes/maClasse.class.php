<?php
	class maClasse{

		//Methodes permettant de crÃ©er
		public function creerLicenceIB($id_banq, $num_lic, $id_cli, $id_post, 
										$id_mon, $fob, $assurance, $fret, 
										$autre_frais, $fsi, $aur, 
										$id_mod_trans, $ref_fact, $date_fact, $fournisseur, 
										$date_val, $date_exp, $id_march, $id_mod_lic, 
										$id_util, $fichier_lic, $tmp, $fichier_fact, $tmp_fact, 
										$id_type_lic, $id_mod_paie, $id_sous_type_paie,
										$provenance, $commodity){
			include('connexion.php');
			$entree['id_banq'] = $id_banq;$entree['num_lic'] = $num_lic;
			$entree['id_cli'] = $id_cli;$entree['id_post'] = $id_post;
			$entree['id_mon'] = $id_mon;$entree['fob'] = $fob;
			$entree['assurance'] = $assurance;$entree['fret'] = $fret;$entree['autre_frais'] = $autre_frais;
			$entree['fsi'] = $fsi;$entree['aur'] = $aur;
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_fact'] = $ref_fact;$entree['date_fact'] = $date_fact;
			$entree['fournisseur'] = $fournisseur;$entree['date_val'] = $date_val;$entree['date_exp'] = $date_exp;
			$entree['id_march'] = $id_march;$entree['id_mod_lic'] = $id_mod_lic;$entree['id_util'] = $id_util;
			$entree['fichier_lic'] = $fichier_lic;$entree['fichier_fact'] = $fichier_fact;
			$entree['id_type_lic'] = $id_type_lic;$entree['id_mod_paie'] = $id_mod_paie;
			$entree['id_sous_type_paie'] = $id_sous_type_paie; $entree['provenance'] = $provenance;
			$entree['commodity'] = $commodity;

			if ($entree['date_fact'] == '') {
				$entree['date_fact'] = NULL;
			}

			if ($entree['date_val'] == '') {
				$entree['date_val'] = NULL;
			}

			if ($entree['date_exp'] == '') {
				$entree['date_exp'] = NULL;
			}
			/*
			if ($entree[''] == '') {
				$entree[''] = NULL;
			}

			if ($entree[''] == '') {
				$entree[''] = NULL;
			}*/

			/*echo "<br> id_banq = $id_banq";echo "<br> num_lic = $num_lic";echo "<br> id_cli = $id_cli";
			echo "<br> id_post = $id_post";echo "<br> id_mon = $id_mon";echo "<br> fob = $fob";
			echo "<br> assurance = $assurance";echo "<br> fret = $fret";echo "<br> autre_frais = $autre_frais";
			echo "<br> fsi = $fsi";echo "<br> aur = $aur";echo "<br> id_mod_trans = $id_mod_trans";
			echo "<br> ref_fact = $ref_fact";echo "<br> date_fact = $date_fact";echo "<br> fournisseur = $fournisseur";
			echo "<br> date_val = $date_val";echo "<br> date_exp = $date_exp";echo "<br> id_march = $id_march";
			echo "<br> id_mod_lic = $id_mod_lic";echo "<br> id_util = $id_util";echo "<br> fichier_lic = $fichier_lic";
			echo "<br> fichier_fact = $fichier_fact";echo "<br> id_type_lic = $id_type_lic";echo "<br> id_mod_paie = $id_mod_paie";
			echo "<br> id_sous_type_paie = $id_sous_type_paie";echo "<br> provenance = $provenance";echo "<br> commodity = $commodity";
			echo "<br>--------------------------------";*/

			$requete = $connexion-> prepare('INSERT INTO licence(id_banq, num_lic, id_cli, 
																id_post, id_mon, fob, 
																assurance, fret, autre_frais, 
																fsi, aur, 
																id_mod_trans, ref_fact, date_fact, 
																fournisseur, date_val, id_march, 
																id_mod_lic, id_util, fichier_lic, fichier_fact,
																id_type_lic, id_mod_paie, id_sous_type_paie, provenance, commodity) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?,
													?, ?)');
			$requete-> execute(array($entree['id_banq'], $entree['num_lic'], $entree['id_cli'], 
									$entree['id_post'], $entree['id_mon'], $entree['fob'], 
									$entree['assurance'], $entree['fret'], $entree['autre_frais'], 
									$entree['fsi'], $entree['aur'], 
									$entree['id_mod_trans'], $entree['ref_fact'], $entree['date_fact'], 
									$entree['fournisseur'], $entree['date_val'], $entree['id_march'], 
									$entree['id_mod_lic'], $entree['id_util'], $entree['fichier_lic'], 
									$entree['fichier_fact'], $entree['id_type_lic'], $entree['id_mod_paie'], 
									$entree['id_sous_type_paie'], $entree['provenance'], $entree['commodity']));
			
			$this-> creerDateExpirationLicence($num_lic, $date_exp);

			$dossier = '../dossiers/'.$num_lic;

			if(!is_dir($dossier)){
				mkdir("../dossiers/$num_lic", 0777);
			}

			move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
			move_uploaded_file($tmp_fact, '../dossiers/'.$num_lic.'/' . basename($fichier_fact));
			//move_uploaded_file($tmp, '../dossiers/');
		}
		
		public function creerDossierLogistique($ref_dos, $ref_mca, $road_manif, $ref_fact, 
										$ref_batch, $poids, $ref_po, $montant_po, $origine, 
										$destination, $transit, $id_cli, 
										$id_mod_trans, $id_trans, $id_util){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['ref_mca'] = $ref_mca;
			$entree['road_manif'] = $road_manif;
			$entree['ref_fact'] = $ref_fact;
			$entree['ref_batch'] = $ref_batch;
			$entree['poids'] = $poids;
			$entree['ref_po'] = $ref_po;
			$entree['montant_po'] = $montant_po;
			$entree['origine'] = $origine;
			$entree['destination'] = $destination;
			$entree['transit'] = $transit;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_trans'] = $id_trans;
			$entree['id_util'] = $id_util;
			
			$requete = $connexion-> prepare('INSERT INTO dossier_logistique(ref_dos, ref_mca, road_manif, ref_fact, ref_batch, poids, ref_po, montant_po, origine, destination, transit, id_cli, id_mod_trans, id_trans, id_util, statut) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, \'IN TRANSIT\')');
			$requete-> execute(array($entree['ref_dos'], $entree['ref_mca'], $entree['road_manif'], $entree['ref_fact'], $entree['ref_batch'], $entree['poids'], $entree['ref_po'], $entree['montant_po'], $entree['origine'], $entree['destination'], $entree['transit'], $entree['id_cli'], $entree['id_mod_trans'], $entree['id_trans'], $entree['id_util']));
			
		}

		public function creerDossierLogistique2($ref_dos, $point_load, $horse, $trailer_1, 
										$nom_chauf, $lic_num, $tel_chauf, $remarque, $frontiere, 
										$destination, $transit, $id_cli, 
										$id_mod_trans, $id_trans, $id_util){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['point_load'] = $point_load;
			$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;
			$entree['nom_chauf'] = $nom_chauf;
			$entree['lic_num'] = $lic_num;
			$entree['tel_chauf'] = $tel_chauf;
			$entree['remarque'] = $remarque;
			$entree['frontiere'] = $frontiere;
			$entree['destination'] = $destination;
			$entree['transit'] = $transit;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_trans'] = $id_trans;
			$entree['id_util'] = $id_util;
			
			$requete = $connexion-> prepare('INSERT INTO dossier_logistique(ref_dos, point_load, horse, trailer_1, nom_chauf, lic_num, tel_chauf, remarque, frontiere, destination, transit, id_cli, id_mod_trans, id_trans, id_util, statut) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, \'IN TRANSIT\')');
			$requete-> execute(array($entree['ref_dos'], $entree['point_load'], $entree['horse'], $entree['trailer_1'], $entree['nom_chauf'], $entree['lic_num'], $entree['tel_chauf'], $entree['remarque'], $entree['frontiere'], $entree['destination'], $entree['transit'], $entree['id_cli'], $entree['id_mod_trans'], $entree['id_trans'], $entree['id_util']));
			
		}

		public function creerLicenceIB2($id_banq, $num_lic, $id_cli, $id_post, 
										$id_mon, $fob, $assurance, $fret, 
										$autre_frais, $fsi, $aur, 
										$id_mod_trans, $ref_fact, $date_fact, $fournisseur, 
										$date_val, $date_exp, $id_march, $id_mod_lic, 
										$id_util, $fichier_lic, $tmp, $fichier_fact, $tmp_fact, 
										$id_type_lic, $id_mod_paie, $id_sous_type_paie,
										$provenance, $commodity, $tonnage, $poids, $unit_mes, $cod, $consommable){
			include('connexion.php');
			$entree['id_banq'] = $id_banq;$entree['num_lic'] = $num_lic;
			$entree['id_cli'] = $id_cli;$entree['id_post'] = $id_post;
			$entree['id_mon'] = $id_mon;$entree['fob'] = $fob;
			$entree['assurance'] = $assurance;$entree['fret'] = $fret;$entree['autre_frais'] = $autre_frais;
			$entree['fsi'] = $fsi;$entree['aur'] = $aur;
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_fact'] = $ref_fact;$entree['date_fact'] = $date_fact;
			$entree['fournisseur'] = $fournisseur;$entree['date_val'] = $date_val;$entree['date_exp'] = $date_exp;
			$entree['id_march'] = $id_march;$entree['id_mod_lic'] = $id_mod_lic;$entree['id_util'] = $id_util;
			$entree['fichier_lic'] = $fichier_lic;$entree['fichier_fact'] = $fichier_fact;
			$entree['id_type_lic'] = $id_type_lic;$entree['id_mod_paie'] = $id_mod_paie;
			$entree['id_sous_type_paie'] = $id_sous_type_paie; $entree['provenance'] = $provenance;
			$entree['commodity'] = $commodity;
			$entree['tonnage'] = $tonnage; $entree['poids'] = $poids;
			$entree['unit_mes'] = $unit_mes;
			$entree['cod'] = $cod;
			$entree['consommable'] = $consommable;

			if ($entree['date_fact'] == '') {
				$entree['date_fact'] = NULL;
			}

			if ($entree['date_val'] == '') {
				$entree['date_val'] = NULL;
			}

			if ($entree['date_exp'] == '') {
				$entree['date_exp'] = NULL;
			}

			if ($entree['fob'] == '') {
				$entree['fob'] = NULL;
			}
			if ($entree['fret'] == '') {
				$entree['fret'] = NULL;
			}
			if ($entree['assurance'] == '') {
				$entree['assurance'] = NULL;
			}
			if ($entree['autre_frais'] == '') {
				$entree['autre_frais'] = NULL;
			}
			/*
			if ($entree[''] == '') {
				$entree[''] = NULL;
			}

			if ($entree[''] == '') {
				$entree[''] = NULL;
			}*/

			/*echo "<br> id_banq = $id_banq";echo "<br> num_lic = $num_lic";echo "<br> id_cli = $id_cli";
			echo "<br> id_post = $id_post";echo "<br> id_mon = $id_mon";echo "<br> fob = $fob";
			echo "<br> assurance = $assurance";echo "<br> fret = $fret";echo "<br> autre_frais = $autre_frais";
			echo "<br> fsi = $fsi";echo "<br> aur = $aur";echo "<br> id_mod_trans = $id_mod_trans";
			echo "<br> ref_fact = $ref_fact";echo "<br> date_fact = $date_fact";echo "<br> fournisseur = $fournisseur";
			echo "<br> date_val = $date_val";echo "<br> date_exp = $date_exp";echo "<br> id_march = $id_march";
			echo "<br> id_mod_lic = $id_mod_lic";echo "<br> id_util = $id_util";echo "<br> fichier_lic = $fichier_lic";
			echo "<br> fichier_fact = $fichier_fact";echo "<br> id_type_lic = $id_type_lic";echo "<br> id_mod_paie = $id_mod_paie";
			echo "<br> id_sous_type_paie = $id_sous_type_paie";echo "<br> provenance = $provenance";echo "<br> commodity = $commodity";
			echo "<br>--------------------------------";*/

			$requete = $connexion-> prepare('INSERT INTO licence(id_banq, num_lic, id_cli, 
																id_post, id_mon, fob, 
																assurance, fret, autre_frais, 
																fsi, aur, 
																id_mod_trans, ref_fact, date_fact, 
																fournisseur, date_val, id_march, 
																id_mod_lic, id_util, fichier_lic, fichier_fact,
																id_type_lic, id_mod_paie, id_sous_type_paie, provenance, commodity, tonnage, poids, unit_mes, cod, consommable) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?,
													?, ?, ?,
													?, ?, ?, ?)');
			$requete-> execute(array($entree['id_banq'], $entree['num_lic'], $entree['id_cli'], 
									$entree['id_post'], $entree['id_mon'], $entree['fob'], 
									$entree['assurance'], $entree['fret'], $entree['autre_frais'], 
									$entree['fsi'], $entree['aur'], 
									$entree['id_mod_trans'], $entree['ref_fact'], $entree['date_fact'], 
									$entree['fournisseur'], $entree['date_val'], $entree['id_march'], 
									$entree['id_mod_lic'], $entree['id_util'], $entree['fichier_lic'], 
									$entree['fichier_fact'], $entree['id_type_lic'], $entree['id_mod_paie'], 
									$entree['id_sous_type_paie'], $entree['provenance'], $entree['commodity'], 
									$entree['tonnage'], $entree['poids'], $entree['unit_mes'], $entree['cod'], 
									$entree['consommable']));
			if ($date_exp != null) {
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}
			
			if ($tmp != null) {
				$dossier = '../dossiers/'.$num_lic;

				if(!is_dir($dossier)){
					mkdir("../dossiers/$num_lic", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
				move_uploaded_file($tmp_fact, '../dossiers/'.$num_lic.'/' . basename($fichier_fact));
				}
				//move_uploaded_file($tmp, '../dossiers/');
		}

		public function creerEBTracking($num_lic, $date_val, $poids, $unit_mes, $id_cli, 
										$id_march, $date_exp, $id_util, $destination, 
										$acheteur, $id_mod_trans, $id_banq, $ref_fact=NULL, $fichier_lic=NULL, $tmp=NULL){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['date_val'] = $date_val;
			$entree['poids'] = $poids;
			$entree['unit_mes'] = $unit_mes;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_util'] = $id_util;
			$entree['destination'] = $destination;
			$entree['acheteur'] = $acheteur;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_banq'] = $id_banq;
			$entree['ref_fact'] = $ref_fact;
			$entree['fichier_lic'] = $fichier_lic;

			/*echo "<br> num_lic = $num_lic";
			echo "<br> date_val = $date_val";
			echo "<br> poids = $poids";
			echo "<br> unit_mes = $unit_mes";
			echo "<br> id_cli = $id_cli";
			echo "<br> id_march = $id_march";
			echo "<br> id_util = $id_util";
			echo "<br> destination = $destination";
			echo "<br> acheteur = $acheteur";
			echo "<br> id_mod_trans = $id_mod_trans";*/

			$requete = $connexion-> prepare("INSERT INTO licence(num_lic, date_val, tonnage, 
																poids, unit_mes, id_cli, id_march, 
																id_mod_lic, id_util,
																id_type_lic, id_mon, 
																destination, acheteur, id_mod_trans, ref_fact, fichier_lic, id_banq) 
													VALUES(?, ?, '1', ?, ?, ?, ?, '1', ?, '1', '1', ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['num_lic'], $entree['date_val'], $entree['poids'], 
								$entree['unit_mes'], $entree['id_cli'], $entree['id_march'], $entree['id_util'], 
								$entree['destination'], $entree['acheteur'], $entree['id_mod_trans'], 
								$entree['ref_fact'], $entree['fichier_lic'], $entree['id_banq']));

			if ($date_exp != null) {
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}
			
			if ($tmp != null) {
				$dossier = '../dossiers/'.$num_lic;

				if(!is_dir($dossier)){
					mkdir("../dossiers/$num_lic", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
				//cmove_uploaded_file($tmp_fact, '../dossiers/'.$num_lic.'/' . basename($fichier_fact));
			}
		}

		public function creerEBTrackingAjax($num_lic, $date_val, $poids, $unit_mes, $id_cli, 
										$id_march, $date_exp, $id_util, $destination, 
										$acheteur, $id_mod_trans, $id_banq, $fob, $id_type_lic, $ref_fact=NULL, $fichier_lic=NULL, $tmp=NULL, $id_mon){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['date_val'] = $date_val;
			$entree['poids'] = $poids;
			$entree['unit_mes'] = $unit_mes;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_util'] = $id_util;
			$entree['destination'] = $destination;
			$entree['acheteur'] = $acheteur;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_banq'] = $id_banq;
			$entree['ref_fact'] = $ref_fact;
			$entree['fichier_lic'] = $fichier_lic;
			$entree['fob'] = $fob;
			// $entree['id_unit_mes'] = $id_unit_mes;
			$entree['id_type_lic'] = $id_type_lic;
			$entree['id_mon'] = $id_mon;

			// echo "<br> num_lic = $num_lic";
			// echo "<br> date_val = $date_val";
			// echo "<br> poids = $poids";
			// echo "<br> unit_mes = $unit_mes";
			// echo "<br> id_cli = $id_cli";
			// echo "<br> id_march = $id_march";
			// echo "<br> id_util = $id_util";
			// echo "<br> destination = $destination";
			// echo "<br> acheteur = $acheteur";
			// echo "<br> id_mod_trans = $id_mod_trans";
			// echo "<br> id_banq = $id_banq";
			// echo "<br> ref_fact = $ref_fact";
			// echo "<br> fichier_lic = $fichier_lic";
			// echo "<br> fob = $fob";
			// echo "<br> id_type_lic = $id_type_lic";
			// echo "<br> id_mon = $id_mon";

			$requete = $connexion-> prepare("INSERT INTO licence(num_lic, date_val, tonnage, 
																poids, unit_mes, id_cli, id_march, 
																id_mod_lic, id_util,
																destination, acheteur, id_mod_trans, 
																ref_fact, fichier_lic, id_banq,
																fob, id_type_lic, id_mon) 
													VALUES(?, ?, '1', ?, ?, ?, ?, '1', ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['num_lic'], $entree['date_val'], $entree['poids'], 
								$entree['unit_mes'], $entree['id_cli'], $entree['id_march'], $entree['id_util'], 
								$entree['destination'], $entree['acheteur'], $entree['id_mod_trans'], 
								$entree['ref_fact'], $entree['fichier_lic'], $entree['id_banq'], 
								$entree['fob'], $entree['id_type_lic'], $entree['id_mon']));

			if ($date_exp != null) {
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}
			
			if ($tmp != null) {
				$dossier = '../dossiers/'.$num_lic;

				if(!is_dir($dossier)){
					mkdir("../dossiers/$num_lic", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));
				//cmove_uploaded_file($tmp_fact, '../dossiers/'.$num_lic.'/' . basename($fichier_fact));
			}
		}

		public function creerLicenceIBUpload($client, $fournisseur, $commodity, $po, $facture, 
										$num_licence, $monnaie, $fob, $fret, 
										$assurance, $autre_frais, $fsi, $aur, 
										$validation, $id_util, $id_mod_lic, $extreme){
			include('connexion.php');
			$entree['client'] = $client;$entree['fournisseur'] = $fournisseur;
			$entree['po'] = $po;$entree['facture'] = $facture;
			$entree['num_licence'] = $num_licence;$entree['monnaie'] = $monnaie;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['aur'] = $aur;
			$entree['validation'] = $validation;$entree['id_util'] = $id_util;$entree['id_mod_lic'] = $id_mod_lic;
			$entree['extreme'] = $extreme;$entree['commodity'] = $commodity;$entree['fsi'] = $fsi;

			$requete = $connexion-> prepare('INSERT INTO licence_upload(client, fournisseur, po, 
																facture, num_licence, monnaie, 
																fob, fret, assurance, 
																autre_frais, fsi, aur, 
																validation, id_util, id_mod_lic,
																extreme, commodity) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['fournisseur'], $entree['po'], 
									$entree['facture'], $entree['num_licence'], $entree['monnaie'], 
									$entree['fob'], $entree['fret'], $entree['assurance'], 
									$entree['autre_frais'], $entree['fsi'], $entree['aur'], 
									$entree['validation'], $entree['id_util'], $entree['id_mod_lic'], 
									$entree['extreme'], $entree['commodity']));
			
			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		/*public function creerDossierIBUpload($client, $ref_dos, $num_lic, $cod, $fxi, $montant_av, 
										$date_fact, $ref_fact, $fob, $fret, 
										$assurance, $autre_frais, $ref_decl, $montant_decl, 
										$ref_liq, $id_util, $ref_quit, $date_quit, $id_mod_lic){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['fxi'] = $fxi;$entree['montant_av'] = $montant_av;
			$entree['date_fact'] = $date_fact;$entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['montant_decl'] = $montant_decl;
			$entree['ref_liq'] = $ref_liq;$entree['id_util'] = $id_util;$entree['ref_quit'] = $ref_quit;
			$entree['date_quit'] = $date_quit;$entree['cod'] = $cod;$entree['ref_decl'] = $ref_decl;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('INSERT INTO dossier_upload(client, ref_dos, num_lic, fxi, 
																montant_av, date_fact, ref_fact, 
																fob, fret, assurance, 
																autre_frais, ref_decl, montant_decl, 
																ref_liq, id_util, ref_quit,
																date_quit, cod, id_mod_lic) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['num_lic'], $entree['fxi'], 
									$entree['montant_av'], $entree['date_fact'], $entree['ref_fact'], 
									$entree['fob'], $entree['fret'], $entree['assurance'], 
									$entree['autre_frais'], $entree['ref_decl'], $entree['montant_decl'], 
									$entree['ref_liq'], $entree['id_util'], $entree['ref_quit'], 
									$entree['date_quit'], $entree['cod'], $entree['id_mod_lic']));
			
			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}*/

		public function creerDossierIBUpload($client, $ref_dos, $num_lic, $cod, $fxi, $montant_av, 
										$date_fact, $ref_fact, $fob, $fret, 
										$assurance, $autre_frais, $ref_decl, $montant_decl, 
										$ref_liq, $id_util, $ref_quit, $date_quit, $id_mod_lic){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['fxi'] = $fxi;$entree['montant_av'] = $montant_av;
			$entree['date_fact'] = $date_fact;$entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['montant_decl'] = $montant_decl;
			$entree['ref_liq'] = $ref_liq;$entree['id_util'] = $id_util;$entree['ref_quit'] = $ref_quit;
			$entree['date_quit'] = $date_quit;$entree['cod'] = $cod;$entree['ref_decl'] = $ref_decl;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('INSERT INTO dossier_upload(client, ref_dos, num_lic, fxi, 
																montant_av, date_fact, ref_fact, 
																fob, fret, assurance, 
																autre_frais, ref_decl, montant_decl, 
																ref_liq, id_util, ref_quit,
																date_quit, cod, id_mod_lic) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['num_lic'], $entree['fxi'], 
									$entree['montant_av'], $entree['date_fact'], $entree['ref_fact'], 
									$entree['fob'], $entree['fret'], $entree['assurance'], 
									$entree['autre_frais'], $entree['ref_decl'], $entree['montant_decl'], 
									$entree['ref_liq'], $entree['id_util'], $entree['ref_quit'], 
									$entree['date_quit'], $entree['cod'], $entree['id_mod_lic']));
			
			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierIBUploadTrackingKlsa($client, $ref_dos, $num_lic, $t1, $poids, $ref_fact, 
										$horse, $trailer_1, $trailer_2, $transporteur, 
										$destination, $arrival_date, $crossing_date, $wiski_arriv, 
										$wiski_dep, $remarque, $id_util, $id_mod_lic, $id_mod_trans){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['poids'] = $poids;$entree['ref_fact'] = $ref_fact;
			$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['transporteur'] = $transporteur;$entree['destination'] = $destination;
			$entree['arrival_date'] = $arrival_date;$entree['wiski_arriv'] = $wiski_arriv;
			$entree['wiski_dep'] = $wiski_dep;$entree['remarque'] = $remarque;
			$entree['id_util'] = $id_util;$entree['t1'] = $t1;$entree['crossing_date'] = $crossing_date;
			$entree['id_mod_lic'] = $id_mod_lic;$entree['id_mod_trans'] = $id_mod_trans;
			/*echo $client.' = client<br>';echo $ref_dos.' = ref_dos<br>';echo $num_lic.' = num_lic<br>';
			echo $poids.' = poids<br>';echo $ref_fact.' = ref_fact<br>';echo $horse.' = horse<br>';
			echo $trailer_1.' = trailer_1<br>';echo $trailer_2.' = trailer_2<br>';echo $transporteur.' = transporteur<br>';
			echo $destination.' = destination<br>';echo $arrival_date.' = arrival_date<br>';echo $crossing_date.' = crossing_date<br>';
			echo $wiski_arriv.' = wiski_arriv<br>';echo $wiski_dep.' = wiski_dep<br>';echo $remarque.' = remarque<br>';
			echo $id_util.' = id_util<br>';echo $t1.' = t1<br>';echo $id_mod_lic.' = id_mod_lic<br>';
			echo $id_mod_trans.' = id_mod_trans<br><br>------------';*/
			$requete = $connexion-> prepare('INSERT INTO dossier_upload_tracking(client, ref_dos, num_lic, poids, 
																ref_fact, horse, trailer_1, 
																trailer_2, transporteur, destination, 
																arrival_date, crossing_date, wiski_arriv, 
																wiski_dep, remarque,
																id_util, t1, id_mod_lic, id_mod_trans) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['num_lic'], $entree['poids'], 
									$entree['ref_fact'], $entree['horse'], $entree['trailer_1'], 
									$entree['trailer_2'], $entree['transporteur'], $entree['destination'], 
									$entree['arrival_date'], $entree['crossing_date'], $entree['wiski_arriv'], 
									$entree['wiski_dep'], $entree['remarque'], 
									$entree['id_util'], $entree['t1'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			
			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		} 

		public function creerDossierIBUploadExport($ref_dos, $num_lic, $date_exp, $tonnage, $ship_num, $barge, $horse, $trailer_1, $trailer_2, $num_lot, $nbr_bags, $poids, $kapulo_load, $dispatch_pweto, $arrival_pweto, $barge_load, $barge_dispatch_date, $doc_receiv, $nbre_seal, $dgda_seal, $remarque, $transporter, $load_date, $pv_mine, $demande_attestation, $assay_date, $ceec_in, $ceec_out, $min_div_in, $min_div_out, $date_decl, $dgda_in, $date_liq, $date_quit, $dgda_out, $gov_in, $gov_out, $dispatch_date, $klsa_arriv, $end_form, $exit_drc, $cleared, $statut, $site_load, $destination, $ref_decl, $ref_liq, $ref_quit, $impala_sncc, $docs_sncc, $sncc_sakania, $sakania_date, $id_cli, $id_util, $id_mod_trans){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['date_exp'] = $date_exp;$entree['tonnage'] = $tonnage;
			$entree['ship_num'] = $ship_num;$entree['barge'] = $barge;
			$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['num_lot'] = $num_lot;
			$entree['nbr_bags'] = $nbr_bags;$entree['poids'] = $poids;
			$entree['kapulo_load'] = $kapulo_load;$entree['dispatch_pweto'] = $dispatch_pweto;
			$entree['arrival_pweto'] = $arrival_pweto;$entree['barge_load'] = $barge_load;
			$entree['barge_dispatch_date'] = $barge_dispatch_date;$entree['doc_receiv'] = $doc_receiv;
			$entree['nbre_seal'] = $nbre_seal;$entree['dgda_seal'] = $dgda_seal;
			$entree['remarque'] = $remarque;$entree['transporter'] = $transporter;
			$entree['load_date'] = $load_date;$entree['pv_mine'] = $pv_mine;
			$entree['demande_attestation'] = $demande_attestation;$entree['assay_date'] = $assay_date;
			$entree['ceec_in'] = $ceec_in;$entree['ceec_out'] = $ceec_out;
			$entree['min_div_in'] = $min_div_in;$entree['min_div_out'] = $min_div_out;
			$entree['date_decl'] = $date_decl;$entree['dgda_in'] = $dgda_in;
			$entree['date_liq'] = $date_liq;$entree['date_quit'] = $date_quit;
			$entree['dgda_out'] = $dgda_out;$entree['gov_in'] = $gov_in;
			$entree['gov_out'] = $gov_out;$entree['dispatch_date'] = $dispatch_date;
			$entree['klsa_arriv'] = $klsa_arriv;$entree['end_form'] = $end_form;
			$entree['exit_drc'] = $exit_drc;$entree['cleared'] = $cleared;
			$entree['statut'] = $statut;$entree['site_load'] = $site_load;
			$entree['destination'] = $destination;$entree['ref_decl'] = $ref_decl;
			$entree['ref_liq'] = $ref_liq;$entree['impala_sncc'] = $impala_sncc;
			$entree['ref_quit'] = $ref_quit;$entree['docs_sncc'] = $docs_sncc;
			$entree['sncc_sakania'] = $sncc_sakania;$entree['sakania_date'] = $sakania_date;
			$entree['id_cli'] = $id_cli; $entree['id_util'] = $id_util; $entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare('INSERT INTO dossier_upload_export(ref_dos, num_lic, date_exp, tonnage, ship_num, barge, horse, trailer_1, trailer_2, num_lot, nbr_bags, poids, kapulo_load, dispatch_pweto, arrival_pweto, barge_load, barge_dispatch_date, doc_receiv, nbre_seal, dgda_seal, remarque, transporter, load_date, pv_mine, demande_attestation, assay_date, ceec_in, ceec_out, min_div_in, min_div_out, date_decl, dgda_in, date_liq, date_quit, dgda_out, gov_in, gov_out, dispatch_date, klsa_arriv, end_form, exit_drc, cleared, statut, site_load, destination, ref_decl, ref_liq, ref_quit, impala_sncc, docs_sncc, sncc_sakania, sakania_date, id_cli, id_util, id_mod_trans) 
												VALUES(?, ?, ?, 
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?, 
													?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['num_lic'], $entree['date_exp'], $entree['tonnage'], $entree['ship_num'], $entree['barge'], $entree['horse'], $entree['trailer_1'], $entree['trailer_2'], $entree['num_lot'], $entree['nbr_bags'], $entree['poids'], $entree['kapulo_load'], $entree['dispatch_pweto'], $entree['arrival_pweto'], $entree['barge_load'], $entree['barge_dispatch_date'], $entree['doc_receiv'], $entree['nbre_seal'], $entree['dgda_seal'], $entree['remarque'], $entree['transporter'], $entree['load_date'], $entree['pv_mine'], $entree['demande_attestation'], $entree['assay_date'], $entree['ceec_in'], $entree['ceec_out'], $entree['min_div_in'], $entree['min_div_out'], $entree['date_decl'], $entree['dgda_in'], $entree['date_liq'], $entree['date_quit'], $entree['dgda_out'], $entree['gov_in'], $entree['gov_out'], $entree['dispatch_date'], $entree['klsa_arriv'], $entree['end_form'], $entree['exit_drc'], $entree['cleared'], $entree['statut'], $entree['site_load'], $entree['destination'], $entree['ref_decl'], $entree['ref_liq'], $entree['ref_quit'], $entree['impala_sncc'], $entree['docs_sncc'], $entree['sncc_sakania'], $entree['sakania_date'], $entree['id_cli'], $entree['id_util'], $entree['id_mod_trans']));
			
			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierIBUpload2($client, $ref_dos, $mca_b_ref, $road_manif, $date_preal, $t1, 
										$poids, $ref_fact, $fob, $fret, 
										$assurance, $autre_frais, $fournisseur, $po, 
										$commodity, $horse, $trailer_1, $trailer_2, $num_lic, $num_exo,
										$arrival_date, $crossing_date, $wiski_arriv, $wiski_dep, $amicongo_arriv,
										$insp_report, $ir, $ref_crf, $date_crf, $ref_decl, $dgda_in, $ref_liq, 
										$date_liq, $ref_quit, $date_quit, $dgda_out, $custom_deliv, $dispatch_deliv,
										$remarque, $statut, $id_mod_trac, $id_util, $bl, $supplier, $credit_enlev_by, $bond_warehouse){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['mca_b_ref'] = $mca_b_ref;
			$entree['date_preal'] = $date_preal;$entree['t1'] = $t1;
			$entree['poids'] = $poids;$entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['po'] = $po;
			$entree['commodity'] = $commodity;$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['road_manif'] = $road_manif;$entree['fournisseur'] = $fournisseur;
			$entree['num_lic'] = $num_lic;$entree['num_exo'] = $num_exo;$entree['arrival_date'] = $arrival_date;
			$entree['crossing_date'] = $crossing_date;$entree['wiski_arriv'] = $wiski_arriv;$entree['wiski_dep'] = $wiski_dep;
			$entree['amicongo_arriv'] = $amicongo_arriv;$entree['insp_report'] = $insp_report;$entree['ir'] = $ir;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;$entree['ref_decl'] = $ref_decl;
			$entree['dgda_in'] = $dgda_in;$entree['ref_liq'] = $ref_liq;$entree['date_liq'] = $date_liq;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;$entree['dgda_out'] = $dgda_out;
			$entree['custom_deliv'] = $custom_deliv;$entree['dispatch_deliv'] = $dispatch_deliv;$entree['remarque'] = $remarque;
			$entree['statut'] = $statut;$entree['id_mod_trac'] = $id_mod_trac;$entree['id_util'] = $id_util;
			$entree['bl'] = $bl; $entree['supplier'] = $supplier; $entree['credit_enlev_by'] = $credit_enlev_by;
			$entree['bond_warehouse'] = $bond_warehouse;
			/*echo $client.' - '.$ref_dos.' - '.$mca_b_ref.' - '.$road_manif.' - '.$date_preal.' - '.$t1.' - '.$poids.' - '.$fob.' - '.$fret.' - '.$assurance.' - '.$autre_frais.' - '.$ref_fact.' - '.$fournisseur.' - '.$po.' - '.$commodity.' - '.$horse.' - '.$trailer_1.' - '.$trailer_2.' - '.$num_lic.' - '.$num_exo.' - '.$crossing_date.' - '.$arrival_date.' - '.$wiski_arriv.' - '.$wiski_dep.' - '.$amicongo_arriv.' - '.$insp_report.' - '.$ir.' - '.$ref_crf.' - '.$date_crf.' - '.$ref_decl.' - '.$dgda_in.' - '.$ref_liq.' - '.$date_liq.' - '.$ref_quit.' - '.$date_quit.' - '.$dgda_out.' - '.$custom_deliv.' - '.$dispatch_deliv.' - '.$statut.' - '.$remarque.'<br><br><br>';*/
			$requete = $connexion-> prepare('INSERT INTO dossier_upload_tracking(client, ref_dos, mca_b_ref, date_preal, 
																t1, poids, ref_fact, 
																fob, fret, assurance, 
																autre_frais, fournisseur, po, 
																commodity, horse, trailer_1,
																trailer_2, road_manif, num_lic, 
																num_exo, arrival_date, crossing_date, wiski_arriv, wiski_dep, amicongo_arriv, insp_report, ir, ref_crf, date_crf, ref_decl, dgda_in, ref_liq, date_liq, ref_quit, date_quit, dgda_out, custom_deliv, dispatch_deliv, remarque, statut,
																id_mod_lic, id_util, bl, supplier, credit_enlev_by, bond_warehouse) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['mca_b_ref'], $entree['date_preal'], 
									$entree['t1'], $entree['poids'], $entree['ref_fact'], 
									$entree['fob'], $entree['fret'], $entree['assurance'], 
									$entree['autre_frais'], $entree['fournisseur'], $entree['po'], 
									$entree['commodity'], $entree['horse'], $entree['trailer_1'], 
									$entree['trailer_2'], $entree['road_manif'], $entree['num_lic'], 
									$entree['num_exo'], $entree['arrival_date'], $entree['crossing_date'], 
									$entree['wiski_arriv'], $entree['wiski_dep'], $entree['amicongo_arriv'], 
									$entree['insp_report'], $entree['ir'], $entree['ref_crf'], 
									$entree['date_crf'], $entree['ref_decl'], $entree['dgda_in'], 
									$entree['ref_liq'], $entree['date_liq'], $entree['dgda_out'], 
									$entree['ref_quit'], $entree['date_quit'], $entree['custom_deliv'], 
									$entree['dispatch_deliv'], $entree['remarque'], $entree['statut'], 
									$entree['id_mod_trac'], $entree['id_util'], $entree['bl'], 
									$entree['supplier'], $entree['credit_enlev_by'], $entree['bond_warehouse']));
			
			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierMMG($client, $ref_dos, $t1, $poids, 
										$ref_fact, $horse, $trailer_1, $trailer_2, 
										$num_lic, $num_exo, $klsa_arriv, $crossing_date, 
										$wiski_arriv, $wiski_dep, $insp_report, $ir, 
										$ref_crf, $date_crf, $ref_decl, $dgda_in, 
										$ref_liq, $date_liq, $ref_quit, $date_quit, 
										$dgda_out, $regul_ir, $cleared, $statut, $remarque, 
										$id_mod_lic, $id_util){
			include('connexion.php');

			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;
			$entree['t1'] = $t1;$entree['poids'] = $poids;
			$entree['ref_fact'] = $ref_fact;$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;$entree['trailer_2'] = $trailer_2;
			$entree['num_lic'] = $num_lic;$entree['num_exo'] = $num_exo;
			$entree['klsa_arriv'] = $klsa_arriv;$entree['crossing_date'] = $crossing_date;
			$entree['wiski_arriv'] = $wiski_arriv;$entree['wiski_dep'] = $wiski_dep;
			$entree['insp_report'] = $insp_report;$entree['ir'] = $ir;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;
			$entree['ref_decl'] = $ref_decl;$entree['dgda_in'] = $dgda_in;
			$entree['ref_liq'] = $ref_liq;$entree['date_liq'] = $date_liq;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;
			$entree['dgda_out'] = $dgda_out;$entree['regul_ir'] = $regul_ir;
			$entree['cleared'] = $cleared;$entree['statut'] = $statut;$entree['remarque'] = $remarque;
			$entree['id_mod_lic'] = $id_mod_lic;$entree['id_util'] = $id_util;

			/*echo '<br>----<br>client = '.$client;
			echo '<br>ref_dos = '.$ref_dos;
			echo '<br>t1 = '.$t1;
			echo '<br>poids = '.$poids;
			echo '<br>ref_fact = '.$ref_fact;
			echo '<br>horse = '.$horse;
			echo '<br>trailer_1 = '.$trailer_1;
			echo '<br>trailer_2 = '.$trailer_2;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>num_exo = '.$num_exo;
			echo '<br>klsa_arriv = '.$klsa_arriv;
			echo '<br>crossing_date = '.$crossing_date;
			echo '<br>wiski_arriv = '.$wiski_arriv;
			echo '<br>wiski_dep = '.$wiski_dep;
			echo '<br>insp_report = '.$insp_report;
			echo '<br>ir = '.$ir;
			echo '<br>ref_crf = '.$ref_crf;
			echo '<br>date_crf = '.$date_crf;
			echo '<br>ref_decl = '.$ref_decl;
			echo '<br>dgda_in = '.$dgda_in;
			echo '<br>ref_liq = '.$ref_liq;
			echo '<br>date_liq = '.$date_liq;
			echo '<br>ref_quit = '.$ref_quit;
			echo '<br>date_quit = '.$date_quit;
			echo '<br>dgda_out = '.$dgda_out;
			echo '<br>regul_ir = '.$regul_ir;
			echo '<br>cleared = '.$cleared;
			echo '<br>statut = '.$statut;
			echo '<br>remarque = '.$remarque;*/

			$requete = $connexion-> prepare('INSERT INTO dossier_upload_tracking(client, ref_dos, t1, poids, ref_fact, horse, trailer_1, trailer_2, num_lic, num_exo, klsa_arriv, crossing_date, wiski_arriv, wiski_dep, insp_report, ir, ref_crf, date_crf, ref_decl, dgda_in, ref_liq, date_liq, ref_quit, date_quit, dgda_out, regul_ir, cleared, statut, remarque, id_mod_lic, id_util) 
												VALUES(?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['t1'], $entree['poids'], $entree['ref_fact'], $entree['horse'], $entree['trailer_1'], $entree['trailer_2'], $entree['num_lic'], $entree['num_exo'], $entree['klsa_arriv'], $entree['crossing_date'], $entree['wiski_arriv'], $entree['wiski_dep'], $entree['insp_report'], $entree['ir'], $entree['ref_crf'], $entree['date_crf'], $entree['ref_decl'], $entree['dgda_in'], $entree['ref_liq'], $entree['date_liq'], $entree['ref_quit'], $entree['date_quit'], $entree['dgda_out'], $entree['regul_ir'], $entree['cleared'], $entree['statut'], $entree['remarque'], $entree['id_mod_lic'], $entree['id_util']));
			
			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierTrackingMMG($client, $ref_dos, $t1, $poids, 
										$ref_fact, $horse, $trailer_1, $trailer_2, 
										$num_lic, $num_exo, $klsa_arriv, $crossing_date, 
										$wiski_arriv, $wiski_dep, $insp_receiv, $ir, 
										$ref_crf, $date_crf, $ref_decl, $dgda_in, 
										$ref_liq, $date_liq, $ref_quit, $date_quit, 
										$dgda_out, $regul_ir, $cleared, $statut, $remarque, 
										$id_mod_lic, $id_util){
			include('connexion.php');

			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;
			$entree['t1'] = $t1;$entree['poids'] = $poids;
			$entree['ref_fact'] = $ref_fact;$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;$entree['trailer_2'] = $trailer_2;
			$entree['num_lic'] = $num_lic;$entree['num_exo'] = $num_exo;
			$entree['klsa_arriv'] = $klsa_arriv;$entree['crossing_date'] = $crossing_date;
			$entree['wiski_arriv'] = $wiski_arriv;$entree['wiski_dep'] = $wiski_dep;
			$entree['insp_receiv'] = $insp_receiv;$entree['ir'] = $ir;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;
			$entree['ref_decl'] = $ref_decl;$entree['dgda_in'] = $dgda_in;
			$entree['ref_liq'] = $ref_liq;$entree['date_liq'] = $date_liq;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;
			$entree['dgda_out'] = $dgda_out;$entree['regul_ir'] = $regul_ir;
			$entree['cleared'] = $cleared;$entree['statut'] = $statut;$entree['remarque'] = $remarque;
			$entree['id_mod_lic'] = $id_mod_lic;$entree['id_util'] = $id_util;

			if($entree['klsa_arriv'] == '' || (!isset($entree['klsa_arriv'])) || (strlen($entree['klsa_arriv']) != 10)){
				$entree['klsa_arriv'] = NULL;
			}
			if($entree['crossing_date'] == '' || (!isset($entree['crossing_date'])) || (strlen($entree['crossing_date']) != 10) ){
				$entree['crossing_date'] = NULL;
			}
			if($entree['wiski_arriv'] == '' || (!isset($entree['wiski_arriv'])) || (strlen($entree['wiski_arriv']) != 10) ){
				$entree['wiski_arriv'] = NULL;
			}
			if($entree['wiski_dep'] == '' || (!isset($entree['wiski_dep'])) || (strlen($entree['wiski_dep']) != 10) ){
				$entree['wiski_dep'] = NULL;
			}
			if($entree['insp_receiv'] == '' || (!isset($entree['insp_receiv'])) || (strlen($entree['insp_receiv']) != 10) ){
				$entree['insp_receiv'] = NULL;
			}
			if($entree['date_crf'] == '' || (!isset($entree['date_crf'])) || (strlen($entree['date_crf']) != 10) ){
				$entree['date_crf'] = NULL;
			}
			if($entree['dgda_in'] == '' || (!isset($entree['dgda_in'])) || (strlen($entree['dgda_in']) != 10) ){
				$entree['dgda_in'] = NULL;
			}
			if($entree['date_liq'] == '' || (!isset($entree['date_liq'])) || (strlen($entree['date_liq']) != 10) ){
				$entree['date_liq'] = NULL;
			}
			if($entree['date_quit'] == '' || (!isset($entree['date_quit'])) || (strlen($entree['date_quit']) != 10) ){
				$entree['date_quit'] = NULL;
			}
			if($entree['dgda_out'] == '' || (!isset($entree['dgda_out'])) || (strlen($entree['dgda_out']) != 10) ){
				$entree['dgda_out'] = NULL;
			}
			if($entree['regul_ir'] == '' || (!isset($entree['regul_ir'])) || (strlen($entree['regul_ir']) != 10) ){
				$entree['regul_ir'] = NULL;
			}

			/*echo '<br>----<br>client = '.$client;
			echo '<br>ref_dos = '.$ref_dos;
			echo '<br>t1 = '.$t1;
			echo '<br>poids = '.$poids;
			echo '<br>ref_fact = '.$ref_fact;
			echo '<br>horse = '.$horse;
			echo '<br>trailer_1 = '.$trailer_1;
			echo '<br>trailer_2 = '.$trailer_2;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>num_exo = '.$num_exo;
			echo '<br>klsa_arriv = '.$klsa_arriv;
			echo '<br>crossing_date = '.$crossing_date;
			echo '<br>wiski_arriv = '.$wiski_arriv;
			echo '<br>wiski_dep = '.$wiski_dep;
			echo '<br>insp_receiv = '.$insp_receiv;
			echo '<br>ir = '.$ir;
			echo '<br>ref_crf = '.$ref_crf;
			echo '<br>date_crf = '.$date_crf;
			echo '<br>ref_decl = '.$ref_decl;
			echo '<br>dgda_in = '.$dgda_in;
			echo '<br>ref_liq = '.$ref_liq;
			echo '<br>date_liq = '.$date_liq;
			echo '<br>ref_quit = '.$ref_quit;
			echo '<br>date_quit = '.$date_quit;
			echo '<br>dgda_out = '.$dgda_out;
			echo '<br>regul_ir = '.$regul_ir;
			echo '<br>cleared = '.$cleared;
			echo '<br>statut = '.$statut;
			echo '<br>remarque = '.$remarque;*/

			$requete = $connexion-> prepare('INSERT INTO dossier(id_cli, ref_dos, t1, poids, ref_fact, horse, trailer_1, trailer_2, num_lic, num_exo, klsa_arriv, crossing_date, wiski_arriv, wiski_dep, insp_receiv, ir, ref_crf, date_crf, ref_decl, dgda_in, ref_liq, date_liq, ref_quit, date_quit, dgda_out, regul_ir, cleared, statut, remarque, id_mod_lic, id_util) 
												VALUES(?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['t1'], $entree['poids'], $entree['ref_fact'], $entree['horse'], $entree['trailer_1'], $entree['trailer_2'], $entree['num_lic'], $entree['num_exo'], $entree['klsa_arriv'], $entree['crossing_date'], $entree['wiski_arriv'], $entree['wiski_dep'], $entree['insp_receiv'], $entree['ir'], $entree['ref_crf'], $entree['date_crf'], $entree['ref_decl'], $entree['dgda_in'], $entree['ref_liq'], $entree['date_liq'], $entree['ref_quit'], $entree['date_quit'], $entree['dgda_out'], $entree['regul_ir'], $entree['cleared'], $entree['statut'], $entree['remarque'], $entree['id_mod_lic'], $entree['id_util']));
			
			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerDossierTrackingIBUpload($client, $ref_dos, $mca_b_ref, $road_manif, $date_preal, $t1, 
										$poids, $fob, $fret, $assurance, 
										$autre_frais, $ref_fact, $fournisseur, $po, 
										$commodity, $horse, $trailer_1, $trailer_2, $id_mod_lic){
			include('connexion.php');
			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['mca_b_ref'] = $mca_b_ref;
			$entree['date_preal'] = $date_preal;$entree['t1'] = $t1;
			$entree['poids'] = $poids;$entree['fob'] = $fob;
			$entree['fret'] = $fret;$entree['assurance'] = $assurance;$entree['autre_frais'] = $autre_frais;
			$entree['ref_fact'] = $ref_fact;$entree['po'] = $po;
			$entree['commodity'] = $commodity;$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['road_manif'] = $road_manif;$entree['fournisseur'] = $fournisseur;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('INSERT INTO dossier_upload(client, ref_dos, mca_b_ref, date_preal, 
																t1, poids, fob, 
																fret, assurance, autre_frais, 
																ref_fact, fournisseur, po, 
																commodity, horse, trailer_1,
																trailer_2, road_manif, id_mod_lic) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['mca_b_ref'], $entree['date_preal'], 
									$entree['t1'], $entree['poids'], $entree['fob'], 
									$entree['fret'], $entree['assurance'], $entree['autre_frais'], 
									$entree['ref_fact'], $entree['fournisseur'], $entree['po'], 
									$entree['commodity'], $entree['horse'], $entree['trailer_1'], 
									$entree['trailer_2'], $entree['road_manif'], $entree['id_mod_lic']));
			
			//$this-> creerDateExpirationLicence($num_lic, $date_exp);
		}

		public function creerLicenceIBFromUploade($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT * 
												FROM licence_upload
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if ( $this-> getLicence($reponse['num_licence']) == null ){

                	$this-> creerLicenceIB(7, $reponse['num_licence'], $reponse['client'], 
                                          25, $reponse['monnaie'], $reponse['fob'], 
                                          $reponse['assurance'], $reponse['fret'], $reponse['autre_frais'], 
                                          $reponse['fsi'], $reponse['aur'], 
                                          25, $reponse['facture'], NULL, 
                                          $reponse['fournisseur'], $reponse['validation'], $reponse['extreme'], 
                                          NULL, $id_mod_lic, $id_util, 
                                          NULL, NULL, NULL, NULL, 
                                          1, NULL, NULL,
                                          NULL, $reponse['commodity']);

                }
			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE licence_upload
												SET etat = 1
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}
		
		public function creerDossierIBFromUploade($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT * 
												FROM dossier_upload
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];

				$this-> creerDossierIB2($reponse['ref_dos'], $reponse['client'], $reponse['ref_fact'], 
                                          $reponse['fob'], $reponse['fret'], $reponse['assurance'], 
                                          $reponse['autre_frais'], $reponse['num_lic'], $_GET['id_mod_trac'], 
                                          NULL, 1,
                                          NULL, $reponse['cod'], $reponse['fxi'], 
                                          $reponse['montant_av'], $reponse['date_fact'], 
                                          $reponse['ref_decl'], $reponse['montant_decl'], 
                                          $reponse['ref_liq'], $_SESSION['id_util'], 
                                          $reponse['ref_quit'], $reponse['date_quit']);

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload
												SET etat = 1
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}
		
		public function creerDossierIBFromUploadeTrackingKlsa($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT * 
												FROM dossier_upload_tracking
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];
				$this-> creerDossierIBTrackingKlsa($reponse['ref_dos'], $reponse['client'], $reponse['t1'], 
                                          $reponse['poids'], $reponse['ref_fact'], $reponse['horse'], 
                                          $reponse['trailer_1'], $reponse['trailer_2'], $reponse['transporteur'], 
                                          $reponse['destination'], $reponse['id_mod_trans'], 
                                          $reponse['arrival_date'], $reponse['crossing_date'], 
                                          $reponse['wiski_arriv'], $reponse['wiski_dep'], 
                                          $reponse['remarque'], $_SESSION['id_util'], 
                                          $_GET['id_mod_trac'], $reponse['num_lic']);

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload_tracking
												SET etat = '1'
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}
		
		public function creerDossierEBFromUploade($id_util){
			include('connexion.php');

			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT * 
												FROM dossier_upload_export
												WHERE id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];
				$this-> creerDossierEBUpload($reponse['ref_dos'], $reponse['num_lic'], $reponse['ship_num'], $reponse['barge'], $reponse['horse'], $reponse['trailer_1'], $reponse['trailer_2'], $reponse['num_lot'], $reponse['nbr_bags'], $reponse['poids'], $reponse['kapulo_load'], $reponse['dispatch_pweto'], $reponse['arrival_pweto'], $reponse['barge_load'], $reponse['barge_dispatch_date'], $reponse['doc_receiv'], $reponse['nbre_seal'], $reponse['dgda_seal'], $reponse['remarque'], $reponse['transporter'], $reponse['load_date'], $reponse['pv_mine'], $reponse['demande_attestation'], $reponse['assay_date'], $reponse['ceec_in'], $reponse['ceec_out'], $reponse['min_div_in'], $reponse['min_div_out'], $reponse['date_decl'], $reponse['dgda_in'], $reponse['date_liq'], $reponse['date_quit'], $reponse['dgda_out'], $reponse['gov_in'], $reponse['gov_out'], $reponse['dispatch_date'], $reponse['klsa_arriv'], $reponse['end_form'], $reponse['exit_drc'], $reponse['cleared'], $reponse['statut'], $reponse['site_load'], $reponse['destination'], $reponse['ref_decl'], $reponse['ref_liq'], $reponse['ref_quit'], $reponse['impala_sncc'], $reponse['docs_sncc'], $reponse['sncc_sakania'], $reponse['sakania_date'], $reponse['id_cli'], $reponse['id_util'], $reponse['id_mod_trans']);

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload_export
												SET etat = '1'
												WHERE id_util = ?");
			$requete-> execute(array($entree['id_util']));
		}
		
		public function creerDossierIBFromUploade2($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT * 
												FROM dossier_upload_tracking
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];

				if ($this-> verifierDossier($reponse['ref_dos']) == false) {
					//CrÃ©er des nouveaux dossiers
					$this-> creerDossierIB3($reponse['client'], $reponse['ref_dos'], $reponse['mca_b_ref'], $reponse['road_manif'], 
                                                $reponse['date_preal'], $reponse['t1'], $reponse['poids'], $reponse['ref_fact'], $reponse['supplier'], $reponse['fob'], $reponse['fret'], 
                                                $reponse['assurance'], $reponse['autre_frais'], $reponse['po'], 
                                                $reponse['commodity'], $reponse['horse'], $reponse['trailer_1'], $reponse['trailer_2'], $reponse['num_lic'], 
                                                $reponse['num_exo'], $reponse['arrival_date'], $reponse['crossing_date'], $reponse['wiski_arriv'], 
                                                $reponse['wiski_dep'], $reponse['amicongo_arriv'], $reponse['insp_report'], $reponse['ir'], 
                                                $reponse['ref_crf'], $reponse['date_crf'], $reponse['ref_decl'], $reponse['dgda_in'], $reponse['ref_liq'], 
                                                $reponse['date_liq'], $reponse['ref_quit'], $reponse['date_quit'], $reponse['dgda_out'], 
                                                $reponse['custom_deliv'], $reponse['dispatch_deliv'], $reponse['remarque'], $reponse['statut'], $reponse['bl'], 
                                                $_GET['id_mod_trac'], $_SESSION['id_util'], 1, 
                                                $reponse['credit_enlev_by'], $reponse['bond_warehouse']);
				}else{

					//Mettre Ã  jour les dossiers existants
					$id_dos = NULL;
					$id_dos = $this-> getIdDossierClientLicence($reponse['ref_dos'], $reponse['client'], $reponse['num_lic']);

					if (isset($reponse['mca_b_ref']) && ($reponse['mca_b_ref'] != '')) {
						$this-> MAJ_mca_b_ref($id_dos, $reponse['mca_b_ref']);				
					}

					if (isset($reponse['road_manif']) && ($reponse['road_manif'] != '')) {
						$this-> MAJ_road_manif($id_dos, $reponse['road_manif']);				
					}

					if (isset($reponse['date_preal']) && ($reponse['date_preal'] != '')) {
						$this-> MAJ_date_preal($id_dos, $reponse['date_preal']);				
					}

					if (isset($reponse['t1']) && ($reponse['t1'] != '')) {
						$this-> MAJ_t1($id_dos, $reponse['t1']);				
					}

					if (isset($reponse['poids']) && ($reponse['poids'] != '')) {
						$this-> MAJ_poids($id_dos, $reponse['poids']);				
					}

					if (isset($reponse['fob']) && ($reponse['fob'] != '')) {
						$this-> MAJ_fob($id_dos, $reponse['fob']);				
					}

					if (isset($reponse['fret']) && ($reponse['fret'] != '')) {
						$this-> MAJ_fret($id_dos, $reponse['fret']);				
					}

					if (isset($reponse['assurance']) && ($reponse['assurance'] != '')) {
						$this-> MAJ_assurance($id_dos, $reponse['assurance']);				
					}

					if (isset($reponse['autre_frais']) && ($reponse['autre_frais'] != '')) {
						$this-> MAJ_autre_frais($id_dos, $reponse['autre_frais']);				
					}

					if (isset($reponse['ref_fact']) && ($reponse['ref_fact'] != '')) {
						$this-> MAJ_ref_fact($id_dos, $reponse['ref_fact']);				
					}

					if (isset($reponse['fournisseur']) && ($reponse['fournisseur'] != '')) {
						$this-> MAJ_fournisseur($id_dos, $reponse['fournisseur']);				
					}

					if (isset($reponse['po']) && ($reponse['po'] != '')) {
						$this-> MAJ_po_ref($id_dos, $reponse['po']);				
					}

					if (isset($reponse['commodity']) && ($reponse['commodity'] != '')) {
						$this-> MAJ_commodity($id_dos, $reponse['commodity']);				
					}

					if (isset($reponse['horse']) && ($reponse['horse'] != '')) {
						$this-> MAJ_horse($id_dos, $reponse['horse']);				
					}

					if (isset($reponse['trailer_1']) && ($reponse['trailer_1'] != '')) {
						$this-> MAJ_trailer_1($id_dos, $reponse['trailer_1']);				
					}

					if (isset($reponse['trailer_2']) && ($reponse['trailer_2'] != '')) {
						$this-> MAJ_trailer_2($id_dos, $reponse['trailer_2']);				
					}

					if (isset($reponse['num_lic']) && ($reponse['num_lic'] != '')) {
						$this-> MAJ_num_lic($id_dos, $reponse['num_lic']);				
					}

					if (isset($reponse['num_exo']) && ($reponse['num_exo'] != '')) {
						$this-> MAJ_num_exo($id_dos, $reponse['num_exo']);				
					}

					if (isset($reponse['arrival_date']) && ($reponse['arrival_date'] != '')) {
						$this-> MAJ_arrival_date($id_dos, $reponse['arrival_date']);				
					}

					if (isset($reponse['crossing_date']) && ($reponse['crossing_date'] != '')) {
						$this-> MAJ_crossing_date($id_dos, $reponse['crossing_date']);				
					}

					if (isset($reponse['wiski_arriv']) && ($reponse['wiski_arriv'] != '')) {
						$this-> MAJ_wiski_arriv($id_dos, $reponse['wiski_arriv']);				
					}

					if (isset($reponse['wiski_dep']) && ($reponse['wiski_dep'] != '')) {
						$this-> MAJ_wiski_dep($id_dos, $reponse['wiski_dep']);				
					}

					if (isset($reponse['amicongo_arriv']) && ($reponse['amicongo_arriv'] != '')) {
						$this-> MAJ_amicongo_arriv($id_dos, $reponse['amicongo_arriv']);				
					}

					if (isset($reponse['insp_report']) && ($reponse['insp_report'] != '')) {
						$this-> MAJ_insp_report($id_dos, $reponse['insp_report']);				
					}

					if (isset($reponse['ir']) && ($reponse['ir'] != '')) {
						$this-> MAJ_ir($id_dos, $reponse['ir']);				
					}

					if (isset($reponse['ref_crf']) && ($reponse['ref_crf'] != '')) {
						$this-> MAJ_ref_crf($id_dos, $reponse['ref_crf']);				
					}

					if (isset($reponse['date_crf']) && ($reponse['date_crf'] != '')) {
						$this-> MAJ_date_crf($id_dos, $reponse['date_crf']);				
					}

					if (isset($reponse['ref_decl']) && ($reponse['ref_decl'] != '')) {
						$this-> MAJ_ref_decl($id_dos, $reponse['ref_decl']);				
					}

					if (isset($reponse['dgda_in']) && ($reponse['dgda_in'] != '')) {
						$this-> MAJ_dgda_in($id_dos, $reponse['dgda_in']);				
					}

					if (isset($reponse['ref_liq']) && ($reponse['ref_liq'] != '')) {
						$this-> MAJ_ref_liq($id_dos, $reponse['ref_liq']);				
					}

					if (isset($reponse['date_liq']) && ($reponse['date_liq'] != '')) {
						$this-> MAJ_date_liq($id_dos, $reponse['date_liq']);				
					}

					if (isset($reponse['ref_quit']) && ($reponse['ref_quit'] != '')) {
						$this-> MAJ_ref_quit($id_dos, $reponse['ref_quit']);				
					}

					if (isset($reponse['date_quit']) && ($reponse['date_quit'] != '')) {
						$this-> MAJ_date_quit($id_dos, $reponse['date_quit']);				
					}

					if (isset($reponse['dgda_out']) && ($reponse['dgda_out'] != '')) {
						$this-> MAJ_dgda_out($id_dos, $reponse['dgda_out']);				
					}

					if (isset($reponse['custom_deliv']) && ($reponse['custom_deliv'] != '')) {
						$this-> MAJ_custom_deliv($id_dos, $reponse['custom_deliv']);				
					}

					if (isset($reponse['dispatch_deliv']) && ($reponse['dispatch_deliv'] != '')) {
						$this-> MAJ_dispatch_deliv($id_dos, $reponse['dispatch_deliv']);				
					}

					if (isset($reponse['remarque']) && ($reponse['remarque'] != '')) {
						$this-> MAJ_remarque($id_dos, $reponse['remarque']);				
					}

					if (isset($reponse['statut']) && ($reponse['statut'] != '')) {
						$this-> MAJ_statut($id_dos, $reponse['statut']);				
					}

				}

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload_tracking
												SET etat = '1'
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}
		
		public function creerDossierIBFromUploadeMMG($id_util, $id_mod_lic){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT * 
												FROM dossier_upload_tracking
												WHERE id_util = ?
													AND id_mod_lic = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//echo '<br>'.$reponse['ref_dos'];

				if ($this-> verifierDossier($reponse['ref_dos']) == false) {
					//CrÃ©er des nouveaux dossiers
					$this-> creerDossierTrackingMMG($reponse['client'], $reponse['ref_dos'], $reponse['t1'], $reponse['poids'], 
                                      $reponse['ref_fact'], $reponse['horse'], $reponse['trailer_1'], $reponse['trailer_2'], 
                                      $reponse['num_lic'], $reponse['num_exo'], $reponse['klsa_arriv'], $reponse['crossing_date'], 
                                      $reponse['wiski_arriv'], $reponse['wiski_dep'], $reponse['insp_report'], $reponse['ir'], 
                                      $reponse['ref_crf'], $reponse['date_crf'], $reponse['ref_decl'], $reponse['dgda_in'], 
                                      $reponse['ref_liq'], $reponse['date_liq'], $reponse['ref_quit'], $reponse['date_quit'], 
                                      $reponse['dgda_out'], $reponse['regul_ir'], $reponse['cleared'], $reponse['statut'], $reponse['remarque'], 2, 1);
				}else{

					//Mettre Ã  jour les dossiers existants
					$id_dos = NULL;
					$id_dos = $this-> getIdDossierClientLicence($reponse['ref_dos'], $reponse['client'], $reponse['num_lic']);

					if (isset($reponse['t1']) && ($reponse['t1'] != '')) {
						$this-> MAJ_t1($id_dos, $reponse['t1']);				
					}
					if (isset($reponse['poids']) && ($reponse['poids'] != '')) {
						$this-> MAJ_poids($id_dos, $reponse['poids']);				
					}
					if (isset($reponse['horse']) && ($reponse['horse'] != '')) {
						$this-> MAJ_horse($id_dos, $reponse['horse']);				
					}
					if (isset($reponse['trailer_1']) && ($reponse['trailer_1'] != '')) {
						$this-> MAJ_trailer_1($id_dos, $reponse['trailer_1']);				
					}
					if (isset($reponse['trailer_2']) && ($reponse['trailer_2'] != '')) {
						$this-> MAJ_trailer_2($id_dos, $reponse['trailer_2']);				
					}
					if (isset($reponse['num_lic']) && ($reponse['num_lic'] != '')) {
						$this-> MAJ_num_lic($id_dos, $reponse['num_lic']);				
					}
					if (isset($reponse['num_exo']) && ($reponse['num_exo'] != '')) {
						$this-> MAJ_num_exo($id_dos, $reponse['num_exo']);				
					}
					if (isset($reponse['klsa_arriv']) && ($reponse['klsa_arriv'] != '')) {
						$this-> MAJ_klsa_arriv($id_dos, $reponse['klsa_arriv']);				
					}
					if (isset($reponse['crossing_date']) && ($reponse['crossing_date'] != '')) {
						$this-> MAJ_crossing_date($id_dos, $reponse['crossing_date']);				
					}

					if (isset($reponse['wiski_arriv']) && ($reponse['wiski_arriv'] != '')) {
						$this-> MAJ_wiski_arriv($id_dos, $reponse['wiski_arriv']);				
					}
					if (isset($reponse['wiski_dep']) && ($reponse['wiski_dep'] != '')) {
						$this-> MAJ_wiski_dep($id_dos, $reponse['wiski_dep']);				
					}
					if (isset($reponse['insp_report']) && ($reponse['insp_report'] != '')) {
						$this-> MAJ_insp_report($id_dos, $reponse['insp_report']);				
					}
					if (isset($reponse['ir']) && ($reponse['ir'] != '')) {
						$this-> MAJ_ir($id_dos, $reponse['ir']);				
					}
					if (isset($reponse['ref_crf']) && ($reponse['ref_crf'] != '')) {
						$this-> MAJ_ref_crf($id_dos, $reponse['ref_crf']);				
					}
					if (isset($reponse['date_crf']) && ($reponse['date_crf'] != '')) {
						$this-> MAJ_date_crf($id_dos, $reponse['date_crf']);				
					}
					if (isset($reponse['ref_decl']) && ($reponse['ref_decl'] != '')) {
						$this-> MAJ_ref_decl($id_dos, $reponse['ref_decl']);				
					}
					if (isset($reponse['dgda_in']) && ($reponse['dgda_in'] != '')) {
						$this-> MAJ_dgda_in($id_dos, $reponse['dgda_in']);				
					}
					if (isset($reponse['ref_liq']) && ($reponse['ref_liq'] != '')) {
						$this-> MAJ_ref_liq($id_dos, $reponse['ref_liq']);				
					}
					if (isset($reponse['ref_quit']) && ($reponse['ref_quit'] != '')) {
						$this-> MAJ_ref_quit($id_dos, $reponse['ref_quit']);				
					}
					if (isset($reponse['date_quit']) && ($reponse['date_quit'] != '')) {
						$this-> MAJ_date_quit($id_dos, $reponse['date_quit']);				
					}
					if (isset($reponse['dgda_out']) && ($reponse['dgda_out'] != '')) {
						$this-> MAJ_dgda_out($id_dos, $reponse['dgda_out']);				
					}

					if (isset($reponse['regul_ir']) && ($reponse['regul_ir'] != '')) {
						$this-> MAJ_regul_ir($id_dos, $reponse['regul_ir']);				
					}
					if (isset($reponse['cleared']) && ($reponse['cleared'] != '')) {
						$this-> MAJ_cleared($id_dos, $reponse['cleared']);				
					}
					if (isset($reponse['statut']) && ($reponse['statut'] != '')) {
						$this-> MAJ_statut($id_dos, $reponse['statut']);				
					}
					if (isset($reponse['remarque']) && ($reponse['remarque'] != '')) {
						$this-> MAJ_remarque($id_dos, $reponse['remarque']);				
					}

				}

			}$requete-> closeCursor();

			$requete = $connexion-> prepare("UPDATE dossier_upload_tracking
												SET etat = '1'
												WHERE id_util = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
		}
		
		public function creerDateExpirationLicence($num_lic, $date_exp){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['date_exp'] = $date_exp;

			$requete = $connexion-> prepare('INSERT INTO expiration_licence(num_lic, date_exp, id_etat)
												VALUES(?, ?, 1)');
			$requete-> execute(array($entree['num_lic'], $entree['date_exp']));
		}
		
		public function creerClasseCompte($nom_class, $id_cat_cmpte){
			include('connexion.php');

			$entree['nom_class'] = $nom_class;
			$entree['id_cat_cmpte'] = $id_cat_cmpte;

			$requete = $connexion-> prepare('INSERT INTO classe_compte(nom_class, id_cat_cmpte)
												VALUES(?, ?)');
			$requete-> execute(array($entree['nom_class'], $entree['id_cat_cmpte']));
		}
		
		public function creerJournal($nom_jour){
			include('connexion.php');

			$entree['nom_jour'] = $nom_jour;
			// $entree['id_cat_cmpte'] = $id_cat_cmpte;

			$requete = $connexion-> prepare('INSERT INTO journal(nom_jour)
												VALUES(?)');
			$requete-> execute(array($entree['nom_jour']));
		}
		
		public function creerCompte($nom_compte, $code_compte, $id_class){
			include('connexion.php');

			$entree['nom_compte'] = $nom_compte;
			$entree['code_compte'] = $code_compte;
			$entree['id_class'] = $id_class;

			$requete = $connexion-> prepare('INSERT INTO compte(nom_compte, code_compte, id_class)
												VALUES(?, ?, ?)');
			$requete-> execute(array($entree['nom_compte'], $entree['code_compte'], $entree['id_class']));
		}
		
		public function editClasseCompte($id_class, $nom_class, $id_cat_cmpte){
			include('connexion.php');

			$entree['id_class'] = $id_class;
			$entree['nom_class'] = $nom_class;
			$entree['id_cat_cmpte'] = $id_cat_cmpte;

			$requete = $connexion-> prepare('UPDATE classe_compte
												SET nom_class = ?, id_cat_cmpte=?
												WHERE id_class = ?');
			$requete-> execute(array($entree['nom_class'], $entree['id_cat_cmpte'], $entree['id_class']));
		}
		
		public function editJournal($id_jour, $nom_jour){
			include('connexion.php');

			$entree['id_jour'] = $id_jour;
			$entree['nom_jour'] = $nom_jour;

			$requete = $connexion-> prepare('UPDATE journal
												SET nom_jour = ?
												WHERE id_jour = ?');
			$requete-> execute(array($entree['nom_jour'], $entree['id_jour']));
		}
		
		public function creerAffectationModeleFacture($id_mod_fact, $id_cli, $id_march, $id_mod_trans){
			include('connexion.php');

			$entree['id_mod_fact'] = $id_mod_fact;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare('INSERT INTO affectation_modele_facture_client_marchandise(id_mod_fact, id_cli, id_march, id_mod_trans)
												VALUES(?, ?, ?, ?)');
			$requete-> execute(array($entree['id_mod_fact'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
		}
		
		public function creerDetailEcriture($id_e, $id_compte, $debit, $credit){
			include('connexion.php');

			$entree['id_e'] = $id_e;
			$entree['id_compte'] = $id_compte;
			$entree['debit'] = $debit;
			$entree['credit'] = $credit;

			// echo '<br> debit = '.$debit;

			$requete = $connexion-> prepare('INSERT INTO detail_ecriture(id_e, id_compte, debit, credit)
												VALUES(?, ?, ?, ?)');
			$requete-> execute(array($entree['id_e'], $entree['id_compte'], $entree['debit'], $entree['credit']));
		}
		
		public function creerEcritureAppro($date_e, $libelle_e, $id_jour, $id_taux, $id_util, $id_mon){
			include('connexion.php');

			$entree['date_e'] = $date_e;
			$entree['libelle_e'] = $libelle_e;
			$entree['id_jour'] = $id_jour;
			$entree['id_taux'] = $id_taux;
			$entree['id_util'] = $id_util;
			$entree['id_mon'] = $id_mon;

			$requete = $connexion-> prepare('INSERT INTO ecriture(date_e, libelle_e, id_jour, id_taux, id_util, id_mon)
												VALUES(?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['date_e'], $entree['libelle_e'], $entree['id_jour'], $entree['id_taux'], $entree['id_util'], $entree['id_mon']));
		}
		
		public function creerEcriture($date_e, $libelle_e, $id_jour, $id_taux, $id_util, $id_t_e, $reference, $id_mon=1){
			include('connexion.php');

			$entree['date_e'] = $date_e;
			$entree['libelle_e'] = $libelle_e;
			$entree['id_jour'] = $id_jour;
			$entree['id_taux'] = $id_taux;
			$entree['id_util'] = $id_util;
			$entree['id_t_e'] = $id_t_e;
			$entree['reference'] = $reference;
			$entree['id_mon'] = $id_mon;

			$requete = $connexion-> prepare('INSERT INTO ecriture(date_e, libelle_e, id_jour, id_taux, id_util, id_t_e, reference, id_mon)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['date_e'], $entree['libelle_e'], $entree['id_jour'], $entree['id_taux'], $entree['id_util'], $entree['id_t_e'], $entree['reference'], $entree['id_mon']));
		}
		
		public function supprimerAffectationModeleFacture($id_mod_fact, $id_cli, $id_march, $id_mod_trans){
			include('connexion.php');

			$entree['id_mod_fact'] = $id_mod_fact;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare('DELETE FROM affectation_modele_facture_client_marchandise
												WHERE id_mod_fact = ? AND id_cli = ? AND id_march = ? AND id_mod_trans= ?');
			$requete-> execute(array($entree['id_mod_fact'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
		}

		
		public function creerAffectationDebours($id_deb, $id_cli, $id_march, $id_mod_trans, $id_mod_lic, $montant, $usd, $tva){
			include('connexion.php');

			$entree['id_deb'] = $id_deb;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['montant'] = $montant;
			$entree['usd'] = $usd;
			$entree['tva'] = $tva;

			if (empty($montant) || $montant=='') {
				$entree['montant'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO affectation_debours_client_modele_licence(id_deb, id_cli, id_march, id_mod_trans, id_mod_lic, montant, usd, tva)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['id_deb'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans'], $entree['id_mod_lic'], $entree['montant'], $entree['usd'], $entree['tva']));
		}

		public function supprimerAffectationDebours($id_deb, $id_cli, $id_march, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_deb'] = $id_deb;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('DELETE FROM affectation_debours_client_modele_licence
												WHERE id_deb = ? and id_cli = ? and id_march = ? and id_mod_trans = ? and id_mod_lic = ?');
			$requete-> execute(array($entree['id_deb'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans'], $entree['id_mod_lic']));
		}
		
		public function creerLogDossier($colonne, $valeur, $id_dos, $id_util){
			include('connexion.php');

			$entree['colonne'] = $colonne;
			$entree['valeur'] = $valeur;
			$entree['id_dos'] = $id_dos;
			$entree['id_util'] = $id_util;
			
			$requete = $connexion-> prepare('INSERT INTO log_dossier(colonne, valeur, id_dos, id_util)
												VALUES(?, ?, ?, ?)');
			$requete-> execute(array($entree['colonne'], $entree['valeur'], $entree['id_dos'], $entree['id_util']));
		}

		public function editPartielle($id_part, $fob, $poids, $id_util){
			include('connexion.php');

			$entree['id_part'] = $id_part;
			$entree['fob'] = $fob;
			$entree['poids'] = $poids;
			$entree['id_util'] = $id_util;
			
			$requete = $connexion-> prepare('UPDATE partielle_av
												SET fob = ?, poids = ?, id_util = ?
												WHERE id_part = ?');
			$requete-> execute(array($entree['fob'], $entree['poids'], $entree['id_util'], $entree['id_part']));
		}

		public function editClient($id_cli, $nom_complet, $rccm_cli, $nif_cli, $id_nat, $nom_cli, $code_cli, $num_imp_exp, $adr_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['nom_complet'] = $nom_complet;
			$entree['rccm_cli'] = $rccm_cli;
			$entree['nif_cli'] = $nif_cli;
			$entree['id_nat'] = $id_nat;
			$entree['nom_cli'] = $nom_cli;
			$entree['code_cli'] = $code_cli;
			$entree['num_imp_exp'] = $num_imp_exp;
			$entree['adr_cli'] = $adr_cli;
			
			$requete = $connexion-> prepare('UPDATE client
												SET nom_complet = ?, rccm_cli = ?, nif_cli = ?, id_nat = ?, nom_cli = ?, code_cli = ?, num_imp_exp = ?, adr_cli = ?
												WHERE id_cli = ?');
			$requete-> execute(array($entree['nom_complet'], $entree['rccm_cli'], $entree['nif_cli'], $entree['id_nat'], $entree['nom_cli'], $entree['code_cli'], $entree['num_imp_exp'], $entree['adr_cli'], $entree['id_cli']));
		}

		public function creerPartielle($num_part, $fob, $poids, $cod){
			include('connexion.php');

			$entree['num_part'] = $num_part;
			$entree['fob'] = $fob;
			$entree['poids'] = $poids;
			$entree['cod'] = $cod;

			$requeteVerification = $connexion-> prepare('SELECT *
															FROM partielle_av
															WHERE num_part = ?
																AND cod = ?');
			$requeteVerification-> execute(array($entree['num_part'], $entree['cod']));
			$reponseVerification = $requeteVerification-> fetch();
			if ($reponseVerification) {
				echo '<script>alert("Impossible de creer la partielle '.$entree['num_part'].', il existe deja une avec ce numero!");</script>';
			}else{
				$requete = $connexion-> prepare('INSERT INTO partielle_av(num_part, fob, poids, cod, id_util)
												VALUES(?, ?, ?, ?, ?)');
				$requete-> execute(array($entree['num_part'], $entree['fob'], $entree['poids'], $entree['cod'], $_SESSION['id_util']));
				echo '<script>alert("Partielle '.$entree['num_part'].' cree avec succes!");</script>';
			}
			
		}
		
		public function creerLogUtilisateur($id_util, $ip, $hostname, $latitude, $longitude, $country_name, $region_name, $city){
			include('connexion.php');

			$entree['id_util'] = $id_util;
			$entree['ip'] = $ip;
			$entree['hostname'] = $hostname;
			$entree['latitude'] = $latitude;
			$entree['longitude'] = $longitude;
			$entree['country_name'] = $country_name;
			$entree['region_name'] = $region_name;
			$entree['city'] = $city;
			
			// echo '<br>id_util = '.$id_util;
			// echo '<br>ip = '.$ip;
			// echo '<br>hostname = '.$hostname;
			// echo '<br>latitude = '.$latitude;
			// echo '<br>longitude = '.$longitude;

			$requete = $connexion-> prepare('INSERT INTO log_utilisateur(id_util, ip, 
															hostname, latitude, longitude, 
															country_name, region_name, city)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['id_util'], $entree['ip'], $entree['hostname'], $entree['latitude'], $entree['longitude'], $entree['country_name'], $entree['region_name'], $entree['city']));
		}
		
		public function creerClient($nom_cli){
			include('connexion.php');

			$entree['nom_cli'] = $nom_cli;
			//$entree['date_exp'] = $date_exp;

			$requete = $connexion-> prepare('INSERT INTO client(nom_cli)
												VALUES(?)');
			$requete-> execute(array($entree['nom_cli']));
		}

		public function creerAffectationLicenceModeleLicence($id_cli, $id_mod_lic){

			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("INSERT INTO affectation_client_modele_licence(id_cli, id_mod_lic)
														VALUES(?, ?)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

		}

		public function creerMonnaie($sig_mon){
			include('connexion.php');

			$entree['sig_mon'] = $sig_mon;
			//$entree['date_exp'] = $date_exp;

			$requete = $connexion-> prepare('INSERT INTO monnaie(nom_mon, sig_mon)
												VALUES(?, ?)');
			$requete-> execute(array($entree['sig_mon'], $entree['sig_mon']));
		}
		
		public function creerDocumentAppurement($fichier_doc, $num_lic, $id_util, $tmp, $banque, $ref_apure, $date_apure){
			include('connexion.php');

			$entree['fichier_doc'] = $fichier_doc;
			$entree['num_lic'] = $num_lic;
			$entree['id_util'] = $id_util;
			$entree['banque'] = $banque;
			$entree['ref_apure'] = $ref_apure;
			$entree['date_apure'] = $date_apure;

			/*echo '<br>fichier_doc = '.$fichier_doc;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>id_util = '.$id_util;*/

			$requete = $connexion-> prepare('INSERT INTO document_appurement(fichier_doc, num_lic, id_util, banque, ref_apure, date_apure)
												VALUES(?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['fichier_doc'], $entree['num_lic'], $entree['id_util'], 
								$entree['banque'], $entree['ref_apure'], $entree['date_apure']));

			$dossier = '../dossiers/'.$num_lic;

			if (isset($tmp) && ($tmp!='')) {

				if(!is_dir($dossier)){
					mkdir("../dossiers/$num_lic", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_doc));

			}

		}

		public function creerTransmissionApurement($fichier_trans_ap, $ref_trans_ap, $id_util, $tmp, $banque, $date_trans_ap){
			include('connexion.php');

			$entree['fichier_trans_ap'] = $fichier_trans_ap;
			$entree['ref_trans_ap'] = $ref_trans_ap;
			$entree['id_util'] = $id_util;
			$entree['banque'] = $banque;
			$entree['date_trans_ap'] = $date_trans_ap;

			/*echo '<br>fichier_trans_ap = '.$fichier_trans_ap;
			echo '<br>ref_trans_ap = '.$ref_trans_ap;
			echo '<br>id_util = '.$id_util;*/

			$requete = $connexion-> prepare('INSERT INTO transmission_apurement(fichier_trans_ap, ref_trans_ap, id_util, banque, date_trans_ap)
												VALUES(?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['fichier_trans_ap'], $entree['ref_trans_ap'], $entree['id_util'], 
								$entree['banque'], $entree['date_trans_ap']));

			/*$dossier = '../dossiers/'.$ref_trans_ap;

			if (isset($tmp) && ($tmp!='')) {

				if(!is_dir($dossier)){
					mkdir("../dossiers/$ref_trans_ap", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$ref_trans_ap.'/' . basename($fichier_trans_ap));

			}*/

		}

		public function creerFacture($ref_fact, $date_fact, $date_fact_rec, 
										$fournisseur, $date_val, $fichier_fact, 
										$tmp_fact, $id_mod_lic, $id_cli, $commodity, 
										$montant_fact, $id_mon, $fret_fact, 
										$assurance_fact, $autre_frais_fact, $fsi=NULL, $aur=NULL){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['date_fact'] = $date_fact;
			$entree['date_fact_rec'] = $date_fact_rec;
			$entree['fournisseur'] = $fournisseur;
			$entree['date_val'] = $date_val;
			$entree['fichier_fact'] = $fichier_fact;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['commodity'] = $commodity;
			$entree['montant_fact'] = $montant_fact;
			$entree['id_mon'] = $id_mon;
			$entree['fret_fact'] = $fret_fact;
			$entree['assurance_fact'] = $assurance_fact;
			$entree['autre_frais_fact'] = $autre_frais_fact;
			$entree['fsi'] = $fsi;
			$entree['aur'] = $aur;

			/*echo '<br>ref_fact = '.$ref_fact;
			echo '<br>date_fact = '.$date_fact;
			echo '<br>date_fact_rec = '.$date_fact_rec;
			echo '<br>fournisseur= '.$fournisseur;
			echo '<br>date_val = '.$date_val;
			echo '<br>fichier_fact = '.$fichier_fact;
			echo '<br>id_mod_lic = '.$id_mod_lic;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>id_march = '.$id_march;*/

			$requete = $connexion-> prepare('INSERT INTO facture_licence(ref_fact, date_fact, date_fact_rec, 
																		fournisseur, date_val, fichier_fact, 
																		id_mod_lic, id_cli, commodity, 
																		montant_fact, id_mon, fret_fact, 
																		assurance_fact, autre_frais_fact, 
																		fsi, aur)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_fact'], $entree['date_fact'], $entree['date_fact_rec'], 
									$entree['fournisseur'], $entree['date_val'], $entree['fichier_fact'], 
									$entree['id_mod_lic'], $entree['id_cli'], $entree['commodity'], 
									$entree['montant_fact'], $entree['id_mon'], $entree['fret_fact'], 
									$entree['assurance_fact'], $entree['autre_frais_fact'], 
									$entree['fsi'], $entree['aur']));

			$facture = '../factures/'.$ref_fact;

			if(!is_dir($facture)){
				mkdir("../factures/$ref_fact", 0777);
			}

			move_uploaded_file($tmp_fact, '../factures/'.$ref_fact.'/' . basename($fichier_fact));
		}
		
		public function creerTransmisFactureDossier($fichier_trans_fact, $ref_trans_fact, $id_util, $tmp, $date_trans_fact){
			include('connexion.php');

			$entree['fichier_trans_fact'] = $fichier_trans_fact;
			$entree['ref_trans_fact'] = $ref_trans_fact;
			$entree['id_util'] = $id_util;
			$entree['date_trans_fact'] = $date_trans_fact;

			/*echo '<br>fichier_trans_fact = '.$fichier_trans_fact;
			echo '<br>ref_trans_fact = '.$ref_trans_fact;
			echo '<br>id_util = '.$id_util;*/

			$requete = $connexion-> prepare('INSERT INTO transmis_facture_dossier(fichier_trans_fact, ref_trans_fact, id_util, date_trans_fact)
												VALUES(?, ?, ?, ?)');
			$requete-> execute(array($entree['fichier_trans_fact'], $entree['ref_trans_fact'], $entree['id_util'], $entree['date_trans_fact']));

			/*$dossier = '../dossiers/'.$ref_trans_ap;

			if (isset($tmp) && ($tmp!='')) {

				if(!is_dir($dossier)){
					mkdir("../dossiers/$ref_trans_ap", 0777);
				}

				move_uploaded_file($tmp, '../dossiers/'.$ref_trans_ap.'/' . basename($fichier_trans_ap));

			}*/

		}

		public function creerAV($cod, $date_av, $montant_av, 
								$fxi, $num_lic, $fichier_av, 
								$tmp_av, $id_util, $id_mon){
			include('connexion.php');

			$entree['cod'] = $cod;
			$entree['date_av'] = $date_av;
			$entree['montant_av'] = $montant_av;
			$entree['fxi'] = $fxi;
			$entree['num_lic'] = $num_lic;
			$entree['fichier_av'] = $fichier_av;
			$entree['id_util'] = $id_util;
			$entree['id_mon'] = $id_mon;

			/*echo '<br>cod = '.$cod;
			echo '<br>date_av = '.$date_av;
			echo '<br>montant_av = '.$montant_av;
			echo '<br>fxi= '.$fxi;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>fichier_av = '.$fichier_av;
			echo '<br>id_util = '.$id_util;
			echo '<br>id_mon = '.$id_mon;
			echo '<br>id_march = '.$id_march;*/

			$requete = $connexion-> prepare('INSERT INTO av(cod, date_av, montant_av, 
															fxi, num_lic, fichier_av, 
															id_util, id_mon)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['cod'], $entree['date_av'], $entree['montant_av'], 
									$entree['fxi'], $entree['num_lic'], $entree['fichier_av'], 
									$entree['id_util'], $entree['id_mon']));

			/*$av = '../av/'.$fichier_av;

			if(!is_dir($av)){
				mkdir("../av/$fichier_av", 0777);
			}*/

			move_uploaded_file($tmp_av, '../av/' . basename($fichier_av));
		}
		
		public function creerAppurementLicence($id_dos, $id_doc, $id_util){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['id_doc'] = $id_doc;
			$entree['id_util'] = $id_util;

			/*echo '<br>id_dos = '.$id_dos;
			echo '<br>id_doc = '.$id_doc;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO appurement_licence(id_dos, id_doc, id_util)
												VALUES(?, ?, ?)');
			$requete-> execute(array($entree['id_dos'], $entree['id_doc'], $entree['id_util']));

		}
		
		public function creerDetailFactureDossier($ref_fact, $id_dos, $id_deb, $montant, $tva, $usd='1', $detail=NULL, $unite=NULL){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$entree['tva'] = $tva;
			$entree['usd'] = $usd;
			$entree['detail'] = $detail;
			$entree['unite'] = $unite;

			// echo '<br><br>id_dos = '.$id_dos;
			// echo '<br>ref_fact = '.$ref_fact;
			// echo '<br>id_deb = '.$id_deb;
			// echo '<br>montant = '.$montant;
			// echo '<br>------------------<br>';

			if ($montant>0) {
				$requete = $connexion-> prepare("INSERT INTO detail_facture_dossier(ref_fact, id_dos,
																	id_deb, montant, tva, usd, detail, 
																	unite)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?)");
				$requete-> execute(array($entree['ref_fact'], $entree['id_dos'],
									$entree['id_deb'], $entree['montant'], 
									$entree['tva'], $entree['usd'], $entree['detail'], 
									$entree['unite']));
			}

			
		}

		public function creerDetailNoteDebit($ref_note, $id_dep_dos, $montant, $tva, $usd='1'){
			include('connexion.php');

			$entree['id_dep_dos'] = $id_dep_dos;
			$entree['ref_note'] = $ref_note;
			$entree['montant'] = $montant;
			$entree['tva'] = $tva;
			$entree['usd'] = $usd;

			// echo '<br><br>id_dep_dos = '.$id_dep_dos;
			// echo '<br>ref_note = '.$ref_note;
			// echo '<br>tva = '.$tva;
			// echo '<br>montant = '.$montant;
			// echo '<br>------------------<br>';

				$requete = $connexion-> prepare("INSERT INTO detail_note_debit(ref_note, id_dep_dos, montant, tva, usd)
												VALUES(?, ?, ?, ?, ?)");
				$requete-> execute(array($entree['ref_note'], $entree['id_dep_dos'], $entree['montant'], 
									$entree['tva'], $entree['usd']));

			
		}

		public function creerDetailFactureDossier2($ref_fact, $id_dos, $id_deb, $montant, $tva, $usd='1', $detail=NULL, $unite=NULL, $pourcentage_qte, $montant_tva){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$entree['tva'] = $tva;
			$entree['usd'] = $usd;
			$entree['detail'] = $detail;
			$entree['unite'] = $unite;
			$entree['pourcentage_qte'] = $pourcentage_qte;
			$entree['montant_tva'] = $montant_tva;

			// echo '<br><br>id_dos = '.$id_dos;
			// echo '<br>ref_fact = '.$ref_fact;
			// echo '<br>id_deb = '.$id_deb;
			// echo '<br>montant = '.$montant;
			// echo '<br>tva = '.$tva;
			// echo '<br>usd = '.$usd;
			// echo '<br>detail = '.$detail;
			// echo '<br>unite = '.$unite;
			// echo '<br>pourcentage_qte = '.$pourcentage_qte;
			// echo '<br>------------------<br>';

			if ($montant>0) {
				$requete = $connexion-> prepare("INSERT INTO detail_facture_dossier(ref_fact, id_dos,
																	id_deb, montant, tva, usd, detail, 
																	unite, pourcentage_qte, montant_tva)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
				$requete-> execute(array($entree['ref_fact'], $entree['id_dos'],
									$entree['id_deb'], $entree['montant'], 
									$entree['tva'], $entree['usd'], $entree['detail'], 
									$entree['unite'], $entree['pourcentage_qte'], $entree['montant_tva']));
			}

			
		}

		public function creerDetailFactureDossier3($ref_fact, $id_dos, $id_deb, $montant, $tva, $usd='1', $detail=NULL, $unite=NULL, $pourcentage_qte){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$entree['tva'] = $tva;
			$entree['usd'] = $usd;
			$entree['detail'] = $detail;
			$entree['unite'] = $unite;
			$entree['pourcentage_qte'] = $pourcentage_qte;
			// $entree['montant_tva'] = $montant_tva;

			// echo '<br><br>id_dos = '.$id_dos;
			// echo '<br>ref_fact = '.$ref_fact;
			// echo '<br>id_deb = '.$id_deb;
			// echo '<br>montant = '.$montant;
			// echo '<br>tva = '.$tva;
			// echo '<br>usd = '.$usd;
			// echo '<br>detail = '.$detail;
			// echo '<br>unite = '.$unite;
			// echo '<br>pourcentage_qte = '.$pourcentage_qte;
			// echo '<br>------------------<br>';

			if ($montant>0) {
				$requete = $connexion-> prepare("INSERT INTO detail_facture_dossier(ref_fact, id_dos,
																	id_deb, montant, tva, usd, detail, 
																	unite, pourcentage_qte)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?)");
				$requete-> execute(array($entree['ref_fact'], $entree['id_dos'],
									$entree['id_deb'], $entree['montant'], 
									$entree['tva'], $entree['usd'], $entree['detail'], 
									$entree['unite'], $entree['pourcentage_qte']));
			}

			
		}

		public function creerDetailApurement($id_trans_ap, $id_dos){
			include('connexion.php');

			$entree['id_trans_ap'] = $id_trans_ap;
			$entree['id_dos'] = $id_dos;

			/*echo '<br>id_trans_ap = '.$id_trans_ap;
			echo '<br>id_dos = '.$id_dos;
			echo '<br>id_util = '.$id_util;
			echo '---------<br>';*/

			$requete = $connexion-> prepare('INSERT INTO detail_apurement(id_trans_ap, id_dos)
												VALUES(?, ?)');
			$requete-> execute(array($entree['id_trans_ap'], $entree['id_dos']));

		}
		
		public function creerAppurementLicence2($id_dos, $id_doc, $id_util, $type_paie, $ref_apure, $date_apure, $banque){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$entree['id_doc'] = $id_doc;
			$entree['id_util'] = $id_util;
			$entree['type_paie'] = $type_paie;
			$entree['ref_apure'] = $ref_apure;
			$entree['date_apure'] = $date_apure;
			$entree['banque'] = $banque;

			echo '<br>id_dos = '.$id_dos;
			echo '<br>id_doc = '.$id_doc;
			echo '<br>id_util = '.$id_util;
			echo '<br>type_paie = '.$type_paie;
			echo '<br>ref_apure = '.$ref_apure;
			echo '<br>date_apure = '.$date_apure;
			echo '<br>banque = '.$banque;
			echo '---------<br>';
			$requete = $connexion-> prepare('INSERT INTO appurement_licence(id_dos, id_doc, id_util, 
																type_paie, ref_apure, date_apure, banque)
												VALUES(?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['id_dos'], $entree['id_doc'], $entree['id_util'], $entree['type_paie'], 
									$entree['ref_apure'], $entree['date_apure'], $entree['banque']));

		}
		
		public function creerDossierEB($ref_dos, $id_cli, $num_lic, $id_march, $id_mod_lic, 
										$id_mod_trans, $id_util, $num_lot, $horse, $trailer_1, 
										$trailer_2, $site_load, $destination, $transporter, 
										$nbr_bags, $poids, $load_date, $dgda_seal, $container, 
										$pied_container){
			include('connexion.php');

			$entree['ref_dos'] = $ref_dos;
			$entree['id_cli'] = $id_cli;
			$entree['num_lic'] = $num_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_util'] = $id_util;
			$entree['num_lot'] = $num_lot;
			$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;
			$entree['site_load'] = $site_load;
			$entree['destination'] = $destination;
			$entree['transporter'] = $transporter;
			$entree['nbr_bags'] = $nbr_bags;
			$entree['poids'] = $poids;
			$entree['load_date'] = $load_date;
			$entree['dgda_seal'] = $dgda_seal;
			$entree['container'] = $container;
			$entree['pied_container'] = $pied_container;

			/*echo '<br>ref_dos = '.$ref_dos;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>id_march = '.$id_march;
			echo '<br>id_mod_lic = '.$id_mod_lic;
			echo '<br>id_mod_trans = '.$id_mod_trans;
			echo '<br>id_util = '.$id_util;
			echo '<br>num_lot = '.$num_lot;
			echo '<br>horse = '.$horse;
			echo '<br>trailer_1 = '.$trailer_1;
			echo '<br>trailer_2 = '.$trailer_2;
			echo '<br>site_load = '.$site_load;
			echo '<br>destination = '.$destination;
			echo '<br>transporter = '.$transporter;
			echo '<br>nbr_bags = '.$nbr_bags;
			echo '<br>poids = '.$poids;
			echo '<br>load_date = '.$load_date;
			echo '---------------<br>';*/

			if($entree['load_date'] == '' || (!isset($entree['load_date'])) ){
				$entree['load_date'] = NULL;
			}

			if($entree['poids'] == '' || (!isset($entree['poids'])) ){
				$entree['poids'] = NULL;
			}

			if($entree['nbr_bags'] == '' || (!isset($entree['nbr_bags'])) ){
				$entree['nbr_bags'] = NULL;
			}

			if (($this-> getDossierRefDos($ref_dos)==NULL)) {
				$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, num_lic, id_march, 
																		id_mod_lic, id_mod_trans, id_util, 
																		num_lot, horse, trailer_1, trailer_2, 
																		site_load, destination, transporter, 
																		nbr_bags, poids, load_date, dgda_seal,
																		container, pied_container)
													VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
				$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['num_lic'], 
										$entree['id_march'], $entree['id_mod_lic'], $entree['id_mod_trans'], 
										$entree['id_util'], $entree['num_lot'], $entree['horse'], 
										$entree['trailer_1'], $entree['trailer_2'], $entree['site_load'], 
										$entree['destination'], $entree['transporter'], $entree['nbr_bags'], 
										$entree['poids'], $entree['load_date'], $entree['dgda_seal'], $entree['container'], 
										$entree['pied_container']));
			}

		}
		
		public function creerDossierEBAMC($ref_dos, $id_cli, $num_lic, $id_march, $id_mod_lic, 
										$id_mod_trans, $id_util, $num_lot, $horse, $trailer_1, 
										$trailer_2, $site_load, $destination, $barge, 
										$nbr_bags, $poids, $kapulo_load, $ship_num){
			include('connexion.php');

			$entree['ref_dos'] = $ref_dos;
			$entree['id_cli'] = $id_cli;
			$entree['num_lic'] = $num_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_util'] = $id_util;
			$entree['num_lot'] = $num_lot;
			$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;
			$entree['site_load'] = $site_load;
			$entree['destination'] = $destination;
			$entree['barge'] = $barge;
			$entree['nbr_bags'] = $nbr_bags;
			$entree['poids'] = $poids;
			$entree['kapulo_load'] = $kapulo_load;
			$entree['ship_num'] = $ship_num;

			/*echo '<br>ref_dos = '.$ref_dos;
			echo '<br>id_cli = '.$id_cli;
			echo '<br>num_lic = '.$num_lic;
			echo '<br>id_march = '.$id_march;
			echo '<br>id_mod_lic = '.$id_mod_lic;
			echo '<br>id_mod_trans = '.$id_mod_trans;
			echo '<br>id_util = '.$id_util;
			echo '<br>num_lot = '.$num_lot;
			echo '<br>horse = '.$horse;
			echo '<br>trailer_1 = '.$trailer_1;
			echo '<br>trailer_2 = '.$trailer_2;
			echo '<br>site_load = '.$site_load;
			echo '<br>destination = '.$destination;
			echo '<br>barge = '.$barge;
			echo '<br>nbr_bags = '.$nbr_bags;
			echo '<br>poids = '.$poids;
			echo '<br>kapulo_load = '.$kapulo_load;
			echo '---------------<br>';*/

			if($entree['kapulo_load'] == '' || (!isset($entree['kapulo_load'])) ){
				$entree['kapulo_load'] = NULL;
			}

			if($entree['poids'] == '' || (!isset($entree['poids'])) ){
				$entree['poids'] = NULL;
			}

			if($entree['nbr_bags'] == '' || (!isset($entree['nbr_bags'])) ){
				$entree['nbr_bags'] = NULL;
			}

			if (($this-> getDossierRefDos($ref_dos)==NULL)) {

				$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, num_lic, id_march, 
																		id_mod_lic, id_mod_trans, id_util, 
																		num_lot, horse, trailer_1, trailer_2, 
																		site_load, destination, barge, 
																		nbr_bags, poids, kapulo_load, ship_num)
													VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
				$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['num_lic'], 
										$entree['id_march'], $entree['id_mod_lic'], $entree['id_mod_trans'], 
										$entree['id_util'], $entree['num_lot'], $entree['horse'], 
										$entree['trailer_1'], $entree['trailer_2'], $entree['site_load'], 
										$entree['destination'], $entree['barge'], $entree['nbr_bags'], 
										$entree['poids'], $entree['kapulo_load'], $entree['ship_num']));
			}

		}
		
		public function creerDossierIB($ref_dos, $id_cli, $ref_fact, $fob, 
										$fret, $assurance, $autre_frais, $num_lic, 
										$id_mod_lic, $id_march, $id_mod_trans,
										$ref_av, $cod, $id_util, $road_manif, $date_preal, 
										$t1, $poids,$po_ref, 
										$commodity, $horse, $trailer_1, $trailer_2, $ref_crf, 
										$date_crf, $bond_warehouse='KOLWEZI', $supplier, $temporelle='0', $frontiere='KASUMBALESA', $regime='EX1'){
			include('connexion.php');

			if ($id_cli != '845' && $id_cli != '856' && $id_cli != '857' && $id_cli != '863' && $id_cli != '864' && $id_cli != '884' && $id_cli != '885' && $id_cli != '901') {
				$bond_warehouse = 'LUBUMBASHI';
			}else{
				//if (isset($bond_warehouse) && ($bond_warehouse!=null)) {
					$bond_warehouse = 'KOLWEZI';
				//}
			}

			$entree['ref_dos'] = $ref_dos; $entree['id_cli'] = $id_cli; $entree['ref_fact'] = $ref_fact; 
			$entree['fob'] = $fob; $entree['fret'] = $fret; $entree['assurance'] = $assurance; 
			$entree['autre_frais'] = $autre_frais; $entree['num_lic'] = $num_lic;
			$entree['id_mod_lic'] = $id_mod_lic; $entree['id_march'] = $id_march; 
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_av'] = $ref_av;
			$entree['cod'] = $cod;
			$entree['id_util'] = $id_util;
			$entree['road_manif'] = $road_manif;$entree['date_preal'] = $date_preal;
			$entree['t1'] = $t1;$entree['poids'] = $poids;
			$entree['fret'] = $fret;$entree['po_ref'] = $po_ref;
			$entree['commodity'] = $commodity;$entree['horse'] = $horse;
			$entree['trailer_1'] = $trailer_1;$entree['trailer_2'] = $trailer_2;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;
			$entree['bond_warehouse'] = $bond_warehouse;
			$entree['supplier'] = $supplier;
			$entree['temporelle'] = $temporelle;
			$entree['frontiere'] = $frontiere;
			$entree['regime'] = $regime;

			if($entree['date_preal'] == '' || (!isset($entree['date_preal'])) ){
				$entree['date_preal'] = NULL;
			}

			if($entree['fob'] == '' || (!isset($entree['fob'])) ){
				$entree['fob'] = NULL;
			}

			if($entree['fret'] == '' || (!isset($entree['fret'])) ){
				$entree['fret'] = NULL;
			}

			if($entree['assurance'] == '' || (!isset($entree['assurance'])) ){
				$entree['assurance'] = NULL;
			}

			if($entree['autre_frais'] == '' || (!isset($entree['autre_frais'])) ){
				$entree['autre_frais'] = NULL;
			}

			if($entree['poids'] == '' || (!isset($entree['poids'])) ){
				$entree['poids'] = NULL;
			}

			if($entree['date_crf'] == '' || (!isset($entree['date_crf'])) ){
				$entree['date_crf'] = NULL;
			}

			if($entree['id_march'] == '' || (!isset($entree['id_march'])) ){
				$entree['id_march'] = NULL;
			}

			if($entree['ref_av'] == '' || (!isset($entree['ref_av'])) ){
				$entree['ref_av'] = NULL;
			}

			// echo '<br>--------------------------------------ref_dos = '.$entree['ref_dos'];
			// echo '<br>--------------------------------------id_cli = '.$entree['id_cli'];
			// echo '<br>--------------------------------------ref_fact = '.$entree['ref_fact'];
			// echo '<br>--------------------------------------fob = '.$entree['fob'];
			// echo '<br>--------------------------------------fret = '.$entree['fret'];
			// echo '<br>--------------------------------------assurance = '.$entree['assurance'];
			// echo '<br>--------------------------------------autre_frais = '.$entree['autre_frais'];
			// echo '<br>--------------------------------------num_lic = '.$entree['num_lic'];
			// echo '<br>--------------------------------------id_mod_lic = '.$entree['id_mod_lic'];
			// echo '<br>--------------------------------------id_march = '.$entree['id_march'];
			// echo '<br>--------------------------------------id_mod_trans = '.$entree['id_mod_trans'];
			// echo '<br>--------------------------------------ref_av = '.$entree['ref_av'];
			// echo '<br>--------------------------------------COD = '.$entree['cod'];
			// echo '<br>--------------------------------------id_util = '.$entree['id_util'];
			// echo '<br>--------------------------------------road_manif = '.$entree['road_manif'];
			// echo '<br>--------------------------------------date_preal = '.$entree['date_preal'];
			// echo '<br>--------------------------------------t1 = '.$entree['t1'];
			// echo '<br>--------------------------------------poids = '.$entree['poids'];
			// echo '<br>--------------------------------------po_ref = '.$entree['po_ref'];
			// echo '<br>--------------------------------------commodity = '.$entree['commodity'];
			// echo '<br>--------------------------------------horse = '.$entree['horse'];
			// echo '<br>--------------------------------------trailer_1 = '.$entree['trailer_1'];
			// echo '<br>--------------------------------------trailer_2 = '.$entree['trailer_2'];
			// echo '<br>--------------------------------------ref_crf = '.$entree['ref_crf'];
			// echo '<br>--------------------------------------date_crf = '.$entree['date_crf'];
			// echo '<br>--------------------------------------bond_warehouse = '.$entree['bond_warehouse'];
			// echo '<br>--------------------------------------supplier = '.$entree['supplier'];
			// echo '<br>--------------------------------------statut = '.$entree['statut'];
			// echo '<br>--------------------------------------temporelle = '.$entree['temporelle'];
			// echo '<br>--------------------------------------frontiere = '.$entree['frontiere'];
			// echo '<br>--------------------------------------regime = '.$entree['regime'];

			if (($this-> getDossierRefDos($ref_dos)==NULL)) {
			
				$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, ref_fact, fob, 
																	fret, assurance, autre_frais, num_lic, 
																	id_mod_lic, id_march, id_mod_trans, 
																	ref_av,cod, id_util, road_manif, 
																	date_preal, t1, poids, 
																	po_ref, commodity, horse, 
																	trailer_1, trailer_2, 
																	ref_crf, date_crf, bond_warehouse, 
																	supplier, statut, temporelle, 
																	frontiere, regime)
													VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 
															?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, "EXPECTED TO ARRIVE", ?, ?, ?)');
				$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['ref_fact'], 
										$entree['fob'], $entree['fret'], $entree['assurance'], 
										$entree['autre_frais'], $entree['num_lic'], $entree['id_mod_lic'], 
										$entree['id_march'], $entree['id_mod_trans'], 
										$entree['ref_av'], $entree['cod'], $entree['id_util'], 
										$entree['road_manif'], $entree['date_preal'], $entree['t1'], 
										$entree['poids'], $entree['po_ref'], $entree['commodity'], 
										$entree['horse'], $entree['trailer_1'], $entree['trailer_2'], 
										$entree['ref_crf'], $entree['date_crf'], $entree['bond_warehouse'], 
										$entree['supplier'], $entree['temporelle'], $entree['frontiere'], 
										$entree['regime']));

				$id_dos = $this-> getDossierRefDos($ref_dos)['id_dos'];

			    for ($i=1; $i <= $_POST['nbre_document']; $i++) { 
			      
			      if(isset($_FILES['fichier_'.$i]['name']) && $_FILES['fichier_'.$i]['name'] != ''){
			        $fichier=$_FILES['fichier_'.$i]['name'];
			        $tmp=$_FILES['fichier_'.$i]['tmp_name'];
			        //$num_dos = $maClasse-> getNumDossier($_POST['id_dos']);

			        $this-> archiver($id_dos, $_POST['id_doc_'.$i], $fichier, $tmp, $_POST['ref_dos']);
			      }

			    }
			}



		}
		
		//Methodes permettant d'archiver
		public function archiver($id_dos, $id_doc, $fichier, $tmp, $ref_dos){
			include('connexion.php');
			$entree['id_dos']=$id_dos;
			$entree['id_doc']=$id_doc;
			$entree['fichier']=$fichier;

			$requete = $connexion-> prepare('INSERT INTO dossier_document VALUES(?, ?, ?)');
			$requete-> execute(array($entree['id_dos'], $entree['id_doc'], $entree['fichier']));
	
			if(stristr($ref_dos, '/') == true) {
				$ref_dos = str_replace("/", "_", "$ref_dos");
			}
			
			$dossier = '../documents/'.$ref_dos;

			if(!is_dir($dossier)){
				mkdir("../documents/$ref_dos", 0777);
			}

			//Transfert du fichier
			move_uploaded_file($tmp, '../documents/'.$ref_dos.'/' . basename($fichier));

		}
		//FIN Methodes permettant d'archiver

		public function creerDossierIBAcid($ref_dos, $id_cli, $ref_fact, $t1, $poids, 
											$num_lic, $id_mod_lic, $id_march, $id_mod_trans, 
											$id_util, $horse, $trailer_1, $trailer_2, $klsa_arriv, 
											$crossing_date, $wiski_arriv, $wiski_dep, $ref_crf, 
											$date_crf, $fob){
			include('connexion.php');

			/*echo '<br> ref_dos = '.$ref_dos;echo '<br> id_cli = '.$id_cli;
			echo '<br> ref_fact = '.$ref_fact;echo '<br> t1 = '.$t1;
			echo '<br> poids = '.$poids;echo '<br> num_lic = '.$num_lic;
			echo '<br> id_mod_lic = '.$id_mod_lic;echo '<br> id_march = '.$id_march;
			echo '<br> id_mod_trans = '.$id_mod_trans;echo '<br> id_util = '.$id_util;
			echo '<br> horse = '.$horse;echo '<br> trailer_1 = '.$trailer_1;
			echo '<br> trailer_2 = '.$trailer_2;echo '<br> klsa_arriv = '.$klsa_arriv;
			echo '<br> crossing_date = '.$crossing_date;echo '<br> wiski_arriv = '.$wiski_arriv;
			echo '<br> wiski_dep = '.$wiski_dep;*/
			//echo '<br> id_mod_lic = '.$id_mod_lic;

			$entree['ref_dos'] = $ref_dos; $entree['id_cli'] = $id_cli; $entree['ref_fact'] = $ref_fact; 
			$entree['t1'] = $t1; $entree['poids'] = $poids; $entree['num_lic'] = $num_lic; 
			$entree['id_mod_lic'] = $id_mod_lic; $entree['id_march'] = $id_march; $entree['id_mod_trans'] = $id_mod_trans; 
			$entree['id_util'] = $id_util; $entree['horse'] = $horse; $entree['trailer_1'] = $trailer_1; 
			$entree['trailer_2'] = $trailer_2; $entree['klsa_arriv'] = $klsa_arriv; $entree['crossing_date'] = $crossing_date; 
			$entree['wiski_arriv'] = $wiski_arriv; $entree['wiski_dep'] = $wiski_dep; 
			$entree['ref_crf'] = $ref_crf; $entree['date_crf'] = $date_crf; ; $entree['fob'] = $fob; 

			if($entree['klsa_arriv'] == '' || (!isset($entree['klsa_arriv'])) ){
				$entree['klsa_arriv'] = NULL;
			}

			if($entree['crossing_date'] == '' || (!isset($entree['crossing_date'])) ){
				$entree['crossing_date'] = NULL;
			}

			if($entree['wiski_arriv'] == '' || (!isset($entree['wiski_arriv'])) ){
				$entree['wiski_arriv'] = NULL;
			}

			if($entree['wiski_dep'] == '' || (!isset($entree['wiski_dep'])) ){
				$entree['wiski_dep'] = NULL;
			}

			if($entree['poids'] == '' || (!isset($entree['poids'])) ){
				$entree['poids'] = NULL;
			}

			if($entree['date_crf'] == '' || (!isset($entree['date_crf'])) ){
				$entree['date_crf'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, ref_fact, t1, poids, 
														num_lic, id_mod_lic, id_march, id_mod_trans, 
														id_util, horse, trailer_1, trailer_2, klsa_arriv, 
														crossing_date, wiski_arriv, wiski_dep, ref_crf, date_crf, fob)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 
														?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['ref_fact'], 
									$entree['t1'], $entree['poids'], $entree['num_lic'], 
									$entree['id_mod_lic'], $entree['id_march'], $entree['id_mod_trans'], 
									$entree['id_util'], $entree['horse'], $entree['trailer_1'], 
									$entree['trailer_2'], $entree['klsa_arriv'], $entree['crossing_date'], 
									$entree['wiski_arriv'], $entree['wiski_dep'], 
									$entree['ref_crf'], $entree['date_crf'], $entree['fob']));
		}
			
		public function creerDossierIB2($ref_dos, $id_cli, $ref_fact, $fob, 
										$fret, $assurance, $autre_frais, $num_lic, 
										$id_mod_lic, $id_march, $id_mod_trans,
										$ref_av, $cod, $fxi, $montant_av, $date_fact, $ref_decl,
										$montant_decl, $ref_liq, $id_util, $ref_quit, $date_quit){
			include('connexion.php');

			$entree['ref_dos'] = $ref_dos; $entree['id_cli'] = $id_cli; $entree['ref_fact'] = $ref_fact; 
			$entree['fob'] = $fob; $entree['fret'] = $fret; $entree['assurance'] = $assurance; 
			$entree['autre_frais'] = $autre_frais; $entree['num_lic'] = $num_lic;
			$entree['id_mod_lic'] = $id_mod_lic; $entree['id_march'] = $id_march; 
			$entree['id_mod_trans'] = $id_mod_trans;$entree['ref_av'] = $ref_av;
			$entree['cod'] = $cod;$entree['fxi'] = $fxi;
			$entree['montant_av'] = $montant_av;$entree['date_fact'] = $date_fact;
			$entree['ref_decl'] = $ref_decl;$entree['montant_decl'] = $montant_decl;
			$entree['ref_liq'] = $ref_liq;$entree['id_util'] = $id_util;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;

			if($entree['date_fact'] == '' || (strlen($entree['date_fact']) != 10) ){
				$entree['date_fact'] = NULL;
			}

			if($entree['date_quit'] == '' || (strlen($entree['date_quit']) != 10) ){
				$entree['date_quit'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, ref_fact, fob, 
																fret, assurance, autre_frais, num_lic, 
																id_mod_lic, id_march, id_mod_trans, ref_av,cod, 
																fxi, montant_av, date_fact, ref_decl, montant_decl, ref_liq, id_util, ref_quit, date_quit)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 
														?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['ref_fact'], 
									$entree['fob'], $entree['fret'], $entree['assurance'], 
									$entree['autre_frais'], $entree['num_lic'], $entree['id_mod_lic'], 
									$entree['id_march'], $entree['id_mod_trans'], 
									$entree['ref_av'], $entree['cod'], $entree['fxi'], 
									$entree['montant_av'], $entree['date_fact'], $entree['ref_decl'], 
									$entree['montant_decl'], $entree['ref_liq'], $entree['id_util'], 
									$entree['ref_quit'], $entree['date_quit']));
		}

		public function creerDossierIBTrackingKlsa($ref_dos, $id_cli, $t1, $poids, 
										$ref_fact, $horse, $trailer_1, $trailer_2, 
										$transporteur, $destination, $id_mod_trans,
										$arrival_date, $crossing_date, $wiski_arriv, 
										$wiski_dep, $remarque, $id_util, $id_mod_lic, 
										$num_lic){
			include('connexion.php');

			$entree['ref_dos'] = $ref_dos; $entree['id_cli'] = $id_cli; $entree['t1'] = $t1; 
			$entree['poids'] = $poids; $entree['ref_fact'] = $ref_fact; $entree['horse'] = $horse; 
			$entree['trailer_1'] = $trailer_1; $entree['trailer_2'] = $trailer_2;
			$entree['transporteur'] = $transporteur; $entree['destination'] = $destination; 
			$entree['id_mod_trans'] = $id_mod_trans;$entree['arrival_date'] = $arrival_date;
			$entree['crossing_date'] = $crossing_date;$entree['wiski_arriv'] = $wiski_arriv;
			$entree['wiski_dep'] = $wiski_dep;$entree['remarque'] = $remarque;
			$entree['id_util'] = $id_util; $entree['id_mod_lic'] = $id_mod_lic; 
			$entree['num_lic'] = $num_lic;

			if($entree['arrival_date'] == '' || (strlen($entree['arrival_date']) != 10) ){
				$entree['arrival_date'] = NULL;
			}

			if($entree['crossing_date'] == '' || (strlen($entree['crossing_date']) != 10) ){
				$entree['crossing_date'] = NULL;
			}

			if($entree['wiski_arriv'] == '' || (strlen($entree['wiski_arriv']) != 10) ){
				$entree['wiski_arriv'] = NULL;
			}

			if($entree['wiski_dep'] == '' || (strlen($entree['wiski_dep']) != 10) ){
				$entree['wiski_dep'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, id_cli, t1, poids, 
																ref_fact, horse, trailer_1, trailer_2, 
																transporteur, destination, id_mod_trans, arrival_date,crossing_date, 
																wiski_arriv, wiski_dep, remarque, id_util, 
																id_mod_lic, num_lic)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 
														?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['t1'], 
									$entree['poids'], $entree['ref_fact'], $entree['horse'], 
									$entree['trailer_1'], $entree['trailer_2'], $entree['transporteur'], 
									$entree['destination'], $entree['id_mod_trans'], 
									$entree['arrival_date'], $entree['crossing_date'], $entree['wiski_arriv'], 
									$entree['wiski_dep'], $entree['remarque'], $entree['id_util'], 
									$entree['id_mod_lic'], $entree['num_lic']));
		}

		public function creerDossierEBUpload($ref_dos, $num_lic, $ship_num, $barge, $horse, $trailer_1, $trailer_2, $num_lot, $nbr_bags, $poids, $kapulo_load, $dispatch_pweto, $arrival_pweto, $barge_load, $barge_dispatch_date, $doc_receiv, $nbre_seal, $dgda_seal, $remarque, $transporter, $load_date, $pv_mine, $demande_attestation, $assay_date, $ceec_in, $ceec_out, $min_div_in, $min_div_out, $date_decl, $dgda_in, $date_liq, $date_quit, $dgda_out, $gov_in, $gov_out, $dispatch_date, $klsa_arriv, $end_form, $exit_drc, $cleared, $statut, $site_load, $destination, $ref_decl, $ref_liq, $ref_quit, $impala_sncc, $docs_sncc, $sncc_sakania, $sakania_date, $id_cli, $id_util, $id_mod_trans){
			include('connexion.php');

			if (strpos(strtoupper($cleared), 'CLEARED') !== false) {
			    $cleared = '1';
			}else if (strpos(strtoupper($cleared), 'TRANSIT') !== false) {
			    $cleared = '0';
			}else if (strpos(strtoupper($cleared), 'PROCESS') !== false) {
			    $cleared = '0';
			}else if (strpos(strtoupper($cleared), 'CANCEL') !== false) {
			    $cleared = '2';
			}else{
				$cleared = '0';
			}
			
			$entree['ref_dos'] = $ref_dos;$entree['num_lic'] = $num_lic;
			$entree['ship_num'] = $ship_num;$entree['barge'] = $barge;
			$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['num_lot'] = $num_lot;
			$entree['nbr_bags'] = $nbr_bags;$entree['poids'] = $poids;
			$entree['kapulo_load'] = $kapulo_load;$entree['dispatch_pweto'] = $dispatch_pweto;
			$entree['arrival_pweto'] = $arrival_pweto;$entree['barge_load'] = $barge_load;
			$entree['barge_dispatch_date'] = $barge_dispatch_date;$entree['doc_receiv'] = $doc_receiv;
			$entree['nbre_seal'] = $nbre_seal;$entree['dgda_seal'] = $dgda_seal;
			$entree['remarque'] = $remarque;$entree['transporter'] = $transporter;
			$entree['load_date'] = $load_date;$entree['pv_mine'] = $pv_mine;
			$entree['demande_attestation'] = $demande_attestation;$entree['assay_date'] = $assay_date;
			$entree['ceec_in'] = $ceec_in;$entree['ceec_out'] = $ceec_out;
			$entree['min_div_in'] = $min_div_in;$entree['min_div_out'] = $min_div_out;
			$entree['date_decl'] = $date_decl;$entree['dgda_in'] = $dgda_in;
			$entree['date_liq'] = $date_liq;$entree['date_quit'] = $date_quit;
			$entree['dgda_out'] = $dgda_out;$entree['gov_in'] = $gov_in;
			$entree['gov_out'] = $gov_out;$entree['dispatch_date'] = $dispatch_date;
			$entree['klsa_arriv'] = $klsa_arriv;$entree['end_form'] = $end_form;
			$entree['exit_drc'] = $exit_drc;$entree['cleared'] = $cleared;
			$entree['statut'] = $statut;$entree['site_load'] = $site_load;
			$entree['destination'] = $destination;$entree['ref_decl'] = $ref_decl;
			$entree['ref_liq'] = $ref_liq;$entree['impala_sncc'] = $impala_sncc;
			$entree['ref_quit'] = $ref_quit;$entree['docs_sncc'] = $docs_sncc;
			$entree['sncc_sakania'] = $sncc_sakania;$entree['sakania_date'] = $sakania_date;
			$entree['id_cli'] = $id_cli; $entree['id_util'] = $id_util; 
			$entree['id_mod_trans'] = $id_mod_trans; //$entree['id_mod_lic'] = $id_mod_lic;


			if($entree['kapulo_load'] == '' || (strlen($entree['kapulo_load']) != 10) ){
				$entree['kapulo_load'] = NULL;
			}

			if($entree['dispatch_pweto'] == '' || (strlen($entree['dispatch_pweto']) != 10) ){
				$entree['dispatch_pweto'] = NULL;
			}

			if($entree['arrival_pweto'] == '' || (strlen($entree['arrival_pweto']) != 10) ){
				$entree['arrival_pweto'] = NULL;
			}

			if($entree['barge_load'] == '' || (strlen($entree['barge_load']) != 10) ){
				$entree['barge_load'] = NULL;
			}

			if($entree['barge_dispatch_date'] == '' || (strlen($entree['barge_dispatch_date']) != 10) ){
				$entree['barge_dispatch_date'] = NULL;
			}

			if($entree['load_date'] == '' || (strlen($entree['load_date']) != 10) ){
				$entree['load_date'] = NULL;
			}

			if($entree['pv_mine'] == '' || (strlen($entree['pv_mine']) != 10) ){
				$entree['pv_mine'] = NULL;
			}

			if($entree['demande_attestation'] == '' || (strlen($entree['demande_attestation']) != 10) ){
				$entree['demande_attestation'] = NULL;
			}

			if($entree['assay_date'] == '' || (strlen($entree['assay_date']) != 10) ){
				$entree['assay_date'] = NULL;
			}

			if($entree['ceec_in'] == '' || (strlen($entree['ceec_in']) != 10) ){
				$entree['ceec_in'] = NULL;
			}

			if($entree['ceec_out'] == '' || (strlen($entree['ceec_out']) != 10) ){
				$entree['ceec_out'] = NULL;
			}

			if($entree['min_div_in'] == '' || (strlen($entree['min_div_in']) != 10) ){
				$entree['min_div_in'] = NULL;
			}

			if($entree['min_div_out'] == '' || (strlen($entree['min_div_out']) != 10) ){
				$entree['min_div_out'] = NULL;
			}

			if($entree['date_decl'] == '' || (strlen($entree['date_decl']) != 10) ){
				$entree['date_decl'] = NULL;
			}

			if($entree['dgda_in'] == '' || (strlen($entree['dgda_in']) != 10) ){
				$entree['dgda_in'] = NULL;
			}

			if($entree['date_liq'] == '' || (strlen($entree['date_liq']) != 10) ){
				$entree['date_liq'] = NULL;
			}

			if($entree['date_quit'] == '' || (strlen($entree['date_quit']) != 10) ){
				$entree['date_quit'] = NULL;
			}

			if($entree['dgda_out'] == '' || (strlen($entree['dgda_out']) != 10) ){
				$entree['dgda_out'] = NULL;
			}

			if($entree['gov_in'] == '' || (strlen($entree['gov_in']) != 10) ){
				$entree['gov_in'] = NULL;
			}

			if($entree['gov_out'] == '' || (strlen($entree['gov_out']) != 10) ){
				$entree['gov_out'] = NULL;
			}

			if($entree['dispatch_date'] == '' || (strlen($entree['dispatch_date']) != 10) ){
				$entree['dispatch_date'] = NULL;
			}

			if($entree['klsa_arriv'] == '' || (strlen($entree['klsa_arriv']) != 10) ){
				$entree['klsa_arriv'] = NULL;
			}

			if($entree['exit_drc'] == '' || (strlen($entree['exit_drc']) != 10) ){
				$entree['exit_drc'] = NULL;
			}

			if($entree['end_form'] == '' || (strlen($entree['end_form']) != 10) ){
				$entree['end_form'] = NULL;
			}

			if($entree['impala_sncc'] == '' || (strlen($entree['impala_sncc']) != 10) ){
				$entree['impala_sncc'] = NULL;
			}

			if($entree['docs_sncc'] == '' || (strlen($entree['docs_sncc']) != 10) ){
				$entree['docs_sncc'] = NULL;
			}

			if($entree['sncc_sakania'] == '' || (strlen($entree['sncc_sakania']) != 10) ){
				$entree['sncc_sakania'] = NULL;
			}

			if($entree['sakania_date'] == '' || (strlen($entree['sakania_date']) != 10) ){
				$entree['sakania_date'] = NULL;
			}

			if($entree['doc_receiv'] == '' || (strlen($entree['doc_receiv']) != 10) ){
				$entree['doc_receiv'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(ref_dos, num_lic, ship_num, barge, horse, trailer_1, trailer_2, num_lot, nbr_bags, poids, kapulo_load, dispatch_pweto, arrival_pweto, barge_load, barge_dispatch_date, doc_receiv, nbre_seal, dgda_seal, remarque, transporter, load_date, pv_mine, demande_attestation, assay_date, ceec_in, ceec_out, min_div_in, min_div_out, date_decl, dgda_in, date_liq, date_quit, dgda_out, gov_in, gov_out, dispatch_date, klsa_arriv, end_form, exit_drc, cleared, statut, site_load, destination, ref_decl, ref_liq, ref_quit, impala_sncc, docs_sncc, sncc_sakania, sakania_date, id_cli, id_util, id_mod_trans, id_mod_lic) 
												VALUES(?, ?, ?, 
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?,  
													?, ?, ?, 
													?, ?, 1)');
			$requete-> execute(array($entree['ref_dos'], $entree['num_lic'], $entree['ship_num'], $entree['barge'], $entree['horse'], $entree['trailer_1'], $entree['trailer_2'], $entree['num_lot'], $entree['nbr_bags'], $entree['poids'], $entree['kapulo_load'], $entree['dispatch_pweto'], $entree['arrival_pweto'], $entree['barge_load'], $entree['barge_dispatch_date'], $entree['doc_receiv'], $entree['nbre_seal'], $entree['dgda_seal'], $entree['remarque'], $entree['transporter'], $entree['load_date'], $entree['pv_mine'], $entree['demande_attestation'], $entree['assay_date'], $entree['ceec_in'], $entree['ceec_out'], $entree['min_div_in'], $entree['min_div_out'], $entree['date_decl'], $entree['dgda_in'], $entree['date_liq'], $entree['date_quit'], $entree['dgda_out'], $entree['gov_in'], $entree['gov_out'], $entree['dispatch_date'], $entree['klsa_arriv'], $entree['end_form'], $entree['exit_drc'], $entree['cleared'], $entree['statut'], $entree['site_load'], $entree['destination'], $entree['ref_decl'], $entree['ref_liq'], $entree['ref_quit'], $entree['impala_sncc'], $entree['docs_sncc'], $entree['sncc_sakania'], $entree['sakania_date'], $entree['id_cli'], $entree['id_util'], $entree['id_mod_trans']));
			
		}

		public function creerDossierIB3($client, $ref_dos, $mca_b_ref, $road_manif, $date_preal, $t1, 
										$poids, $ref_fact, $supplier, $fob, $fret, 
										$assurance, $autre_frais, $po_ref, 
										$commodity, $horse, $trailer_1, $trailer_2, $num_lic, $num_exo,
										$arrival_date, $crossing_date, $wiski_arriv, $wiski_dep, $amicongo_arriv,
										$insp_report, $ir, $ref_crf, $date_crf, $ref_decl, $dgda_in, $ref_liq, 
										$date_liq, $ref_quit, $date_quit, $dgda_out, $custom_deliv, $dispatch_deliv,
										$remarque, $statut, $bl, $id_mod_trac, $id_util, $id_mod_trans, $credit_enlev_by, $bond_warehouse){
			include('connexion.php');

			$entree['client'] = $client;$entree['ref_dos'] = $ref_dos;$entree['mca_b_ref'] = $mca_b_ref;
			$entree['date_preal'] = $date_preal;$entree['t1'] = $t1;
			$entree['poids'] = $poids;$entree['ref_fact'] = $ref_fact;
			$entree['fob'] = $fob;$entree['fret'] = $fret;$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;$entree['po_ref'] = $po_ref;
			$entree['commodity'] = $commodity;$entree['horse'] = $horse;$entree['trailer_1'] = $trailer_1;
			$entree['trailer_2'] = $trailer_2;$entree['road_manif'] = $road_manif;
			$entree['num_lic'] = $num_lic;$entree['num_exo'] = $num_exo;$entree['arrival_date'] = $arrival_date;
			$entree['crossing_date'] = $crossing_date;$entree['wiski_arriv'] = $wiski_arriv;$entree['wiski_dep'] = $wiski_dep;
			$entree['amicongo_arriv'] = $amicongo_arriv;$entree['insp_report'] = $insp_report;$entree['ir'] = $ir;
			$entree['ref_crf'] = $ref_crf;$entree['date_crf'] = $date_crf;$entree['ref_decl'] = $ref_decl;
			$entree['dgda_in'] = $dgda_in;$entree['ref_liq'] = $ref_liq;$entree['date_liq'] = $date_liq;
			$entree['ref_quit'] = $ref_quit;$entree['date_quit'] = $date_quit;$entree['dgda_out'] = $dgda_out;
			$entree['custom_deliv'] = $custom_deliv;$entree['dispatch_deliv'] = $dispatch_deliv;$entree['remarque'] = $remarque;
			$entree['statut'] = $statut;$entree['id_mod_trac'] = $id_mod_trac;$entree['id_util'] = $id_util;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['bl'] = $bl;
			$entree['supplier'] = $supplier;
			$entree['credit_enlev_by'] = $credit_enlev_by;
			$entree['bond_warehouse'] = $bond_warehouse;

			if($entree['date_quit'] == '' || (strlen($entree['date_quit']) != 10) ){
				$entree['date_quit'] = NULL;
			}

			if($entree['date_liq'] == '' || (strlen($entree['date_liq']) != 10) ){
				$entree['date_liq'] = NULL;
			}

			if($entree['poids'] == ''){
				$entree['poids'] = NULL;
			}

			if($entree['fob'] == ''){
				$entree['fob'] = NULL;
			}

			if($entree['fret'] == ''){
				$entree['fret'] = NULL;
			}

			if($entree['assurance'] == ''){
				$entree['assurance'] = NULL;
			}

			if($entree['autre_frais'] == '' ){
				$entree['autre_frais'] = NULL;
			}

			if($entree['ir'] == '' ){
				$entree['ir'] = 'NO';
			}

			if($entree['date_preal'] == '' || (strlen($entree['date_preal']) != 10) ){
				$entree['date_preal'] = NULL;
			}

			if($entree['arrival_date'] == '' || (strlen($entree['arrival_date']) != 10) ){
				$entree['arrival_date'] = NULL;
			}

			if($entree['crossing_date'] == '' || (strlen($entree['crossing_date']) != 10) ){
				$entree['crossing_date'] = NULL;
			}

			if($entree['wiski_arriv'] == '' || (strlen($entree['wiski_arriv']) != 10) ){
				$entree['wiski_arriv'] = NULL;
			}

			if($entree['wiski_dep'] == '' || (strlen($entree['wiski_dep']) != 10) ){
				$entree['wiski_dep'] = NULL;
			}

			if($entree['amicongo_arriv'] == '' || (strlen($entree['amicongo_arriv']) != 10) ){
				$entree['amicongo_arriv'] = NULL;
			}

			if($entree['insp_report'] == '' || (strlen($entree['insp_report']) != 10) ){
				$entree['insp_report'] = NULL;
			}

			if($entree['date_crf'] == '' || (strlen($entree['date_crf']) != 10) ){
				$entree['date_crf'] = NULL;
			}

			if($entree['dgda_in'] == '' || (strlen($entree['dgda_in']) != 10) ){
				$entree['dgda_in'] = NULL;
			}

			if($entree['dgda_out'] == '' || (strlen($entree['dgda_out']) != 10) ){
				$entree['dgda_out'] = NULL;
			}

			if($entree['custom_deliv'] == '' || (strlen($entree['custom_deliv']) != 10) ){
				$entree['custom_deliv'] = NULL;
			}

			if($entree['dispatch_deliv'] == '' || (strlen($entree['dispatch_deliv']) != 10) ){
				$entree['dispatch_deliv'] = NULL;
			}

			if($entree['bl'] == '' || (strlen($entree['bl']) != 10) ){
				$entree['bl'] = NULL;
			}

			$requete = $connexion-> prepare('INSERT INTO dossier(id_cli, ref_dos, mca_b_ref, date_preal, 
																id_mod_lic, id_util, id_mod_trans, num_lic, t1, poids, ref_fact, fob, fret, assurance,
																autre_frais, po_ref, commodity, horse, trailer_1, 
																trailer_2, road_manif, num_exo, arrival_date, 
																crossing_date, wiski_arriv, wiski_dep, 
																amicongo_arriv, insp_receiv, ir, ref_crf, 
																date_crf, ref_decl, dgda_in, ref_liq, 
																date_liq, ref_quit, date_quit, dgda_out, 
																custom_deliv, dispatch_deliv, remarque, statut, 
																bl, supplier, credit_enlev_by, bond_warehouse) 
												VALUES(?, ?, ?, 
													?, ?, ?, 
													?, ?, ?, ?, ?, 
													?, ?, ?, ?, ?, 
													?, ?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, 
													?, ?, ?, ?, ?, 
													?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['client'], $entree['ref_dos'], $entree['mca_b_ref'], 
									$entree['date_preal'], $entree['id_mod_trac'], $entree['id_util'], 
									$entree['id_mod_trans'], $entree['num_lic'], $entree['t1'], 
									$entree['poids'], $entree['ref_fact'], $entree['fob'], 
									$entree['fret'], $entree['assurance'], $entree['autre_frais'], 
									$entree['po_ref'], $entree['commodity'], $entree['horse'], 
									$entree['trailer_1'], $entree['trailer_2'], $entree['road_manif'], 
									$entree['num_exo'], $entree['arrival_date'], $entree['crossing_date'], 
									$entree['wiski_arriv'], $entree['wiski_dep'], $entree['amicongo_arriv'], 
									$entree['insp_report'], $entree['ir'], $entree['ref_crf'], 
									$entree['date_crf'], $entree['ref_decl'], $entree['dgda_in'], 
									$entree['ref_liq'], $entree['date_liq'], $entree['ref_quit'], 
									$entree['date_quit'], $entree['dgda_out'], $entree['custom_deliv'], 
									$entree['dispatch_deliv'], $entree['remarque'], $entree['statut'], 
									$entree['bl'], $entree['supplier'], $entree['credit_enlev_by'], 
									$entree['bond_warehouse']));
		}
		//FIN Methodes permettant de crÃ©er
	
		//Methodes permettant d'afficher
		public function afficherMenuLicence($id_type_lic){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_cli = '';
			$active = '';
			$open = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '5' || $_SESSION['id_role'] == '11'){
				$sql = "SELECT id_mod_lic, 
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
							AND id_mod_lic < 3
						ORDER BY rang_lic ASC";
			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if($reponse['id_mod_lic'] == $_GET['id_mod_lic']){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <li class="nav-item">
		                <a href="dashboard.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>&amp;id_type_lic=<?php echo $id_type_lic;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-tachometer-alt"></i>
		                  <p>Dashboard</p>
		                </a>
		              </li>
		              <?php
		              if($reponse['id_mod_lic']=='2'){
		              	?>
		              <li class="nav-item">
		                <a href="dashboardAv.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>&amp;id_type_lic=<?php echo $id_type_lic;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-tachometer-alt"></i>
		                  <p>Dashboard AV / Partielle</p>
		                </a>
		              </li>
		              	<?php
		              }
		              ?>
		              <li class="nav-item">
		                <a href="licence.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>&amp;id_type_lic=<?php echo $id_type_lic;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
		                  <p>SynthÃ¨se <?php echo $reponse['sigle_mod_lic'];?></p>
		                </a>
		              </li>
		              <li class="nav-item">
		                <a href="facture.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>&etat=" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-file nav-icon"></i>
		                  <p>Facture</p>
		                </a>
		              </li>
		              <?php
		              	if ($reponse['id_mod_lic'] == 2) {
		              	?>
		              <!--<li class="nav-item">
		                <a href="manipulation.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-edit nav-icon"></i>
		                  <p>Manipulations</p>
		                </a>
		              </li>-->

		              <!-- <li class="nav-item has-treeview">
			        	<a href="#" class="nav-link" class="nav-link ">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-certificate nav-icon"></i>
		                  <p>AV</p>
		                </a>
		            	<ul class="nav nav-treeview">
		              		<?php $this-> afficherMenuAvClientModeleLicence($reponse['id_mod_lic']);?>
		            	</ul>
		              </li> -->
		              <li class="nav-item">
		                <a href="apurementLicence.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-check nav-icon"></i>
		                  <p>Tansmis Apurement</p>
		                </a>
		              </li>
		              <?php
		              	/*if ($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '2') {
		              	?>
					  <li class="nav-item">
		                <a href="licence_upload.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
		                  <p>Uploade Fichier</p>
		                </a>
		              </li>
					  <li class="nav-item">
		                <a href="apurement_upload.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
		                  <p>Uploade Apurement</p>
		                </a>
		              </li>
		              	<?php
		              	}*/
		              ?>
		              
		              	<?php
		              	}
		              ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}

		}

		public function afficherMenuLicenceAjax(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_cli = '';
			$active = '';
			$open = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '5' || $_SESSION['id_role'] == '11'){
				$sql = "SELECT id_mod_lic, 
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
							AND id_mod_lic < 3
						ORDER BY rang_lic ASC";
			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				?>
				<li id="mainMenuLicence_<?php echo $reponse['id_mod_lic'];?>" class="nav-item has-treeview" >
			        <a href="#" class="nav-link"onclick="deroulerMenuLicence(<?php echo $reponse['id_mod_lic'];?>);">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
			        <ul class="nav nav-treeview" id="menuLicence_<?php echo $reponse['id_mod_lic'];?>">
			        	<span></span>
			        </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}

		}

		public function deroulerMenuLicence($id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$menu = '';
			
			$requete = $connexion-> prepare("SELECT cl.nom_cli AS nom_cli, 
													cl.id_cli AS id_cli
												FROM client cl, affectation_client_modele_licence aff
												WHERE cl.id_cli = aff.id_cli
													AND aff.id_mod_lic = ?
												ORDER BY cl.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$menu .= '<li class=\'nav-item has-treeview\'>
			                <a class=\'nav-link\' href=\'#\'>
			                  &nbsp;&nbsp;&nbsp;&nbsp;<img src=\'../images/logo.jpeg\' class=\'img-circle\' width=\'20px\'>
			                  <p>'.$reponse['nom_cli'].'</p>
			                </a>
			                <ul class=\'nav nav-treeview\'>
			                	<li class=\'nav-item\'>
					                <a href=\'licenceAjax.php?id_mod_lic='.$id_mod_lic.'&amp;id_cli='.$reponse['id_cli'].'\' class=\'nav-link\'>
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class=\'nav-icon fas fa-minus\'></i>
					                  <p>Licence</p>
					                </a>
				              	</li>
			                	<li class=\'nav-item\'>
					                <a href=\'factureAjax.php?id_mod_lic='.$id_mod_lic.'&amp;id_cli='.$reponse['id_cli'].'\' class=\'nav-link\'>
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class=\'nav-icon fas fa-minus\'></i>
					                  <p>Facture</p>
					                </a>
				              	</li>
			                </ul>
			              </li>';
			}$requete-> closeCursor();

			return $menu;

		}

		public function factureLicenceDisponible($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$option = '<select id=\'ref_fact\' name=\'ref_fact\' onchange=\'getDataFacture(this.value);\' class=\'form-control form-control-sm cc-exp\'><option></option>';
			
			$requete = $connexion-> prepare("SELECT *
												FROM facture_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND  NOT EXISTS (
															SELECT licence.ref_fact
																FROM licence 
																WHERE licence.id_cli = ?
																	AND licence.id_mod_lic = ?
																	AND licence.ref_fact = facture_licence.ref_fact
														)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$option .= '<option value=\''.$reponse['ref_fact'].'\'>'.$reponse['ref_fact'].'</option>';
			}$requete-> closeCursor();

			$option .='</select>';

			return $option;

		}

		public function afficherMenuFacturationBackup(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_cli = '';
			$active = '';
			$open = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '7'){
				$sql = "SELECT id_mod_lic, 
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";
			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if($reponse['id_mod_lic'] == $_GET['id_mod_lic']){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php //echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <li class="nav-item">
		                <a href="facturation.php?id_mod_lic=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-calculator"></i>
		                  <p>Facturation <?php echo $reponse['sigle_mod_lic'];?></p>
		                </a>
		              </li>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}

		}

		public function afficherMenuFacturation(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == 12){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_lic_fact'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_lic_fact']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
						<li class="nav-item">
			                <a href="dashboardFactureDossier.php?id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-tachometer-alt nav-icon"></i>
			                  <p>Dashboard
			                  </p>
			                </a>
			            </li>
			            <?php
			            	$this-> afficherMenuTrackingClientModeleLicenceFacturation($reponse['id_mod_lic']);
			            ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();
			}
		}

		public function afficherMenuFacturationDebitNote(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == 12){
				$sql = "SELECT id_mod_lic,
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_lic_fact'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_lic_fact']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
						<li class="nav-item">
			                <a href="dashboardNoteDebit.php?id_mod_lic_fact=<?php echo $reponse['id_mod_lic'];?>&id_cli=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-tachometer-alt nav-icon"></i>
			                  <p>Dashboard
			                  </p>
			                </a>
			            </li>
						<li class="nav-item">
			                <a href="client_note_debit.php?id_mod_lic_nd=<?php echo $reponse['id_mod_lic'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-retweet nav-icon"></i>
			                  <p>Transactions
			                  </p>
			                </a>
			            </li>
			            <?php
			            	// $this-> afficherMenuTrackingClientModeleLicenceFacturationDebitNote($reponse['id_mod_lic']);
			            ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();
			}
		}

		public function afficherMenuTrackingClientModeleLicenceFacturation($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli,
													c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m, affectation_modele_facture_client_marchandise amfcm, modele_facture mf
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND c.id_cli = amfcm.id_cli
													AND amfcm.id_mod_fact = mf.id_mod_fact
													AND mf.id_mod_lic = m.id_mod_lic
												GROUP BY c.id_cli
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-user"></i>
			          <p>
			            <?php echo $reponse['nom_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              	<li class="nav-item">
			                <a href="dossierEnAttenteFacture.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
			                  <p>Pending files <sup><b><span style="color: red;"><?php echo $this-> getNbreDossierEnAttenteFacture($id_mod_lic, $reponse['id_cli']);?></span></b></sup></p>
			                </a>
			            </li>
			            <li class="nav-item">
					        <a href="#" class="nav-link" onclick="modal_facture(<?php echo $reponse['id_cli'];?>, <?php echo $id_mod_lic;?>);">
					          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-plus"></i>
					          <p>
					            Create New Invoice
					            <!-- <i class="right fas fa-angle-left"></i> -->
					          </p>
					        </a>
					    </li>
		              	<li class="nav-item">
			                <a href="listerFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-copy nav-icon"></i>
			                  <p>View Invoices</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <!-- <a href="statutDossierFacturation.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link"> -->
			                <a  onclick="window.open('statutDossierFacturation.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>','pop1','width=1000,height=800');" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-list nav-icon"></i>
			                  <p>View Files</p>
			                </a>
			            </li>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuTrackingClientModeleLicenceFacturationDebitNote($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli,
													c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m, affectation_modele_facture_client_marchandise amfcm, modele_facture mf
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND c.id_cli = amfcm.id_cli
													AND amfcm.id_mod_fact = mf.id_mod_fact
													AND mf.id_mod_lic = m.id_mod_lic
												GROUP BY c.id_cli
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-user"></i>
			          <p>
			            <?php echo $reponse['nom_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              	<li class="nav-item">
			                <a href="dossierEnAttenteFacture.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
			                  <p>Pending files <sup><b><span style="color: red;"><?php echo $this-> getNbreDossierEnAttenteFacture($id_mod_lic, $reponse['id_cli']);?></span></b></sup></p>
			                </a>
			            </li>
			            <li class="nav-item">
					        <a href="#" class="nav-link" onclick="modal_facture(<?php echo $reponse['id_cli'];?>, <?php echo $id_mod_lic;?>);">
					          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-plus"></i>
					          <p>
					            Create New Invoice
					            <!-- <i class="right fas fa-angle-left"></i> -->
					          </p>
					        </a>
					    </li>
		              	<li class="nav-item">
			                <a href="listerFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-copy nav-icon"></i>
			                  <p>View Invoices</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <!-- <a href="statutDossierFacturation.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link"> -->
			                <a  onclick="window.open('statutDossierFacturation.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>','pop1','width=1000,height=800');" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-list nav-icon"></i>
			                  <p>View Files</p>
			                </a>
			            </li>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuTrackingClientModeleLicenceFacturationBackUp10112023($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli,
													c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m, affectation_modele_facture_client_marchandise amfcm, modele_facture mf
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													AND c.id_cli = amfcm.id_cli
													AND amfcm.id_mod_fact = mf.id_mod_fact
													AND mf.id_mod_lic = m.id_mod_lic
												GROUP BY c.id_cli
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-user"></i>
			          <p>
			            <?php echo $reponse['nom_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              	<li class="nav-item">
			                <a href="dossierEnAttenteFacture.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
			                  <p>Pending files <sup><b><span style="color: red;"><?php echo $this-> getNbreDossierEnAttenteFacture($id_mod_lic, $reponse['id_cli']);?></span></b></sup></p>
			                </a>
			            </li>
			            <li class="nav-item has-treeview">
					        <a href="#" class="nav-link">
					          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-plus"></i>
					          <p>
					            Create New Invoice
					            <i class="right fas fa-angle-left"></i>
					          </p>
					        </a>
				            <ul class="nav nav-treeview">
								<li class="nav-item">
					                <a href="#" onclick="modal_facture(<?php echo $reponse['id_cli'];?>, <?php echo $id_mod_lic;?>);" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-circle nav-icon"></i>
					                  <p>Clearing
					                  </p>
					                </a>
					            </li>
								<li class="nav-item">
					                <a href="factureTransport.php?note_debit=3&type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" onclick="" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-circle nav-icon"></i>
					                  <p>Transport
					                  </p>
					                </a>
					            </li>
								<li class="nav-item">
					                <a href="factureNote.php?note_debit=1&type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" onclick="" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-circle nav-icon"></i>
					                  <p>Debit Note
					                  </p>
					                </a>
					            </li>
								<li class="nav-item">
					                <a href="factureNote.php?note_debit=2&type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" onclick="" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-circle nav-icon"></i>
					                  <p>Credit Note
					                  </p>
					                </a>
					            </li>
								<li class="nav-item">
					                <a href="factureService.php?note_debit=4&type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" onclick="" class="nav-link">
					                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-circle nav-icon"></i>
					                  <p>Services
					                  </p>
					                </a>
					            </li>
				            </ul>
					    </li>
					   <!--  <li class="nav-item">
			                <a href="transmisFactureDossier.php?type_fact=partielle&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
			                  <p>Transmis Factures</p>
			                </a>
					    </li> -->
		              	<li class="nav-item">
			                <a href="listerFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-copy nav-icon"></i>
			                  <p>View Invoices</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <!-- <a href="statutDossierFacturation.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link"> -->
			                <a  onclick="window.open('statutDossierFacturation.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>','pop1','width=1000,height=800');" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-list nav-icon"></i>
			                  <p>View Files</p>
			                </a>
			            </li>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherStatutDossierFactureAjax($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT 1 AS compteur,
													CONCAT(dossier.ref_dos,' <button class=\'btn btn-warning btn-xs\' onclick=\'modal_edit_statut_dossier_facturation(',dossier.id_dos,')\'><i class=\'fa fa-edit\'></i></button>') AS ref_dos,
													IF(dossier.not_fact='1',
														'<span class=\'badge badge-danger font-weight-bold\'>Disabled</span>',
															IF(facture_dossier.ref_fact IS NOT NULL AND facture_dossier.note_debit='0',
																'<span class=\'badge badge-success font-weight-bold\'>Invoiced</span>',
																IF(dossier.ref_decl IS NULL OR dossier.date_decl IS NULL OR dossier.ref_liq IS NULL OR dossier.date_liq IS NULL OR dossier.ref_quit IS NULL OR dossier.date_quit IS NULL,
																	'<span class=\'badge badge-warning font-weight-bold\'>Missing E, L or Q</span>',
																	'<span class=\'badge badge-warning font-weight-bold\'>Waiting to be invoiced</span>'
																)

															)
														)
													AS statut,
													IF(facture_dossier.note_debit='0', facture_dossier.ref_fact, NULL) AS ref_fact,
													IF(marchandise.nom_march IS NOT NULL,
														marchandise.nom_march,
														dossier.commodity
													) AS commodity,
													dossier.num_lic AS num_lic,
													DATE_FORMAT(facture_dossier.date_fact, '%d/%m/%Y') AS date_fact,
													IF(dossier.id_mod_lic='2',
														dossier.ref_fact,
														dossier.num_lot
														)
													 AS ref_fact_dos,
													dossier.ref_decl AS ref_decl,
													DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
													dossier.ref_liq AS ref_liq,
													DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
													dossier.ref_quit AS ref_quit,
													DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier
													LEFT JOIN detail_facture_dossier
														ON detail_facture_dossier.id_dos = dossier.id_dos
													LEFT JOIN facture_dossier
														ON facture_dossier.ref_fact = detail_facture_dossier.ref_fact 
													LEFT JOIN marchandise
														ON marchandise.id_march = dossier.id_march
												WHERE dossier.id_mod_lic = ?
													AND dossier.id_cli = ?
													AND dossier.ref_dos NOT LIKE 'EXPDEC%'
													AND dossier.ref_dos NOT LIKE '21EXP%'
													AND dossier.ref_dos NOT LIKE '21DEC%'
												GROUP BY dossier.id_dos
												ORDER BY dossier.id_dos ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherAllCompteAjax(){
			include("connexion.php");

			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> query("SELECT compte.id_compte AS id_compte,
													compte.code_compte AS code_compte,
													compte.nom_compte AS nom_compte,
													classe_compte.nom_class AS nom_class,
													SUM(IF(det.debit IS NULL, 0, det.debit)) AS debit,
													SUM(IF(det.credit IS NULL, 0, det.credit)) AS credit,
													IF(SUM(IF(det.debit IS NULL, 0, det.debit))>SUM(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit))-SUM(IF(det.credit IS NULL, 0, det.credit)),2),
														NULL
													) AS solde_debit,
													IF(SUM(IF(det.debit IS NULL, 0, det.debit))<SUM(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit))-SUM(IF(det.debit IS NULL, 0, det.debit)),2),
														NULL
													) AS solde_credit,
													CONCAT('<span class=\"btn btn-xs btn-primary\"\" onclick=\"afficherEcritureCompte(',compte.id_compte,', \'',compte.nom_compte,'\', \'',IF(FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit)),2) IS NULL, 0, FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit)),2)),'\', \'',IF(FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit)),2) IS NULL, 0, FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit)),2)),'\')\">
																<i class=\"fa fa-eye\"></i>
															</span>') AS btn_action,
													monnaie.sig_mon AS sig_mon
												-- FROM compte, classe_compte, detail_ecriture det
												-- WHERE compte.id_class = classe_compte.id_class
												-- 	AND compte.id_compte = det.id_compte
												FROM compte
													LEFT JOIN detail_ecriture det
														ON compte.id_compte = det.id_compte
													LEFT JOIN sub_classe_compte
														ON compte.id_sub_class = sub_classe_compte.id_sub_class
													LEFT JOIN classe_compte
														ON sub_classe_compte.id_class = classe_compte.id_class
													LEFT JOIN monnaie
														ON monnaie.id_mon = compte.id_mon
												GROUP BY compte.id_compte
												ORDER BY classe_compte.id_class, compte.nom_compte");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherTialBalanceAjax(){
			include("connexion.php");

			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> query("SELECT compte.id_compte AS id_compte,
													compte.code_compte AS code_compte,
													compte.nom_compte AS nom_compte,
													classe_compte.nom_class AS nom_class,
													-- sub_classe_compte.nom_sub_class AS nom_sub_class,
													CONCAT('<a href=\"#\" onclick=\"window.open(\'detail_sub_class_trial_balance.php?id_sub_class=',sub_classe_compte.id_sub_class,'\',\'pop8\',\'width=1100,height=700\');\"><i class=\"fa fa-eye text-primary\"></i></a> ',sub_classe_compte.nom_sub_class) AS nom_sub_class,
													SUM(IF(det.debit IS NULL, 0, det.debit)) AS debit,
													SUM(IF(det.credit IS NULL, 0, det.credit)) AS credit,
													IF(SUM(IF(det.debit IS NULL, 0, det.debit))>SUM(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit))-SUM(IF(det.credit IS NULL, 0, det.credit)),2),
														NULL
													) AS solde_debit,
													IF(SUM(IF(det.debit IS NULL, 0, det.debit))<SUM(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit))-SUM(IF(det.debit IS NULL, 0, det.debit)),2),
														NULL
													) AS solde_credit,
													CONCAT('<span class=\"\"\" onclick=\"afficherEcritureCompte(',compte.id_compte,', \'',compte.nom_compte,'\', \'',IF(FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit)),2) IS NULL, 0, FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit)),2)),'\', \'',IF(FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit)),2) IS NULL, 0, FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit)),2)),'\')\">
																<i class=\"text-primary fa fa-eye\"></i>
															</span>') AS btn_action,
													monnaie.sig_mon AS sig_mon,

													IF((SUM(det.debit) IS NOT NULL) OR (SUM(det.credit) IS NOT NULL),
														IF((SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon='1', det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))-SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant)))))>0,
															(SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon='1', det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))-SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))),
															''
														),
														''
													) AS solde_debit,

													IF((SUM(det.debit) IS NOT NULL) OR (SUM(det.credit) IS NOT NULL),
														IF((SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon='1', det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))-SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon='1', det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant)))))>0,
															(SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon='1', det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))-SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon='1', det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))),
															''
														),
														''
													) AS solde_credit

												FROM compte, detail_ecriture det, sub_classe_compte, classe_compte, monnaie, ecriture ec, taux_echange te
												WHERE compte.id_compte = det.id_compte
													AND compte.id_sub_class = sub_classe_compte.id_sub_class
													AND sub_classe_compte.id_class = classe_compte.id_class
													AND monnaie.id_mon = compte.id_mon
													AND ec.id_e = det.id_e
													AND te.id_taux = ec.id_taux

												-- FROM compte
												-- 	LEFT JOIN detail_ecriture det
												-- 		ON compte.id_compte = det.id_compte
												-- 	LEFT JOIN sub_classe_compte
												-- 		ON compte.id_sub_class = sub_classe_compte.id_sub_class
												-- 	LEFT JOIN classe_compte
												-- 		ON sub_classe_compte.id_class = classe_compte.id_class
												-- 	LEFT JOIN monnaie
												-- 		ON monnaie.id_mon = compte.id_mon
												-- 	LEFT JOIN ecriture ec
												-- 		ON ec.id_e = det.id_e
												-- 	LEFT JOIN taux_echange te
												-- 		ON te.id_taux = ec.id_taux
												-- GROUP BY compte.id_compte
												GROUP BY sub_classe_compte.id_sub_class
												-- ORDER BY classe_compte.id_class, compte.nom_compte
												ORDER BY classe_compte.id_class, sub_classe_compte.nom_sub_class");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function detail_sub_class_trial_balance($id_sub_class){
			include("connexion.php");

			$entree['id_sub_class'] = $id_sub_class;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT compte.id_compte AS id_compte,
													compte.code_compte AS code_compte,
													compte.nom_compte AS nom_compte,
													classe_compte.nom_class AS nom_class,
													-- sub_classe_compte.nom_sub_class AS nom_sub_class,
													CONCAT('<span class=\"btn btn-xs btn-primary\"\" onclick=\"window.open(\'detail_sub_class_trial_balance.php?id_sub_class=',sub_classe_compte.id_sub_class,'\',\'pop8\',\'width=1100,height=700\');\"><i class=\"fa fa-eye\"></i></span> ',sub_classe_compte.nom_sub_class) AS nom_sub_class,
													SUM(IF(det.debit IS NULL, 0, det.debit)) AS debit,
													SUM(IF(det.credit IS NULL, 0, det.credit)) AS credit,
													IF(SUM(IF(det.debit IS NULL, 0, det.debit))>SUM(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit))-SUM(IF(det.credit IS NULL, 0, det.credit)),2),
														NULL
													) AS solde_debit,
													IF(SUM(IF(det.debit IS NULL, 0, det.debit))<SUM(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit))-SUM(IF(det.debit IS NULL, 0, det.debit)),2),
														NULL
													) AS solde_credit,
													CONCAT('<span class=\"btn btn-xs btn-primary\"\" onclick=\"afficherEcritureCompte(',compte.id_compte,', \'',compte.nom_compte,'\', \'',IF(FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit)),2) IS NULL, 0, FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit)),2)),'\', \'',IF(FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit)),2) IS NULL, 0, FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit)),2)),'\')\">
																<i class=\"fa fa-eye\"></i>
															</span>') AS btn_action,
													monnaie.sig_mon AS sig_mon,


													IF((SUM(det.debit) IS NOT NULL) OR (SUM(det.credit) IS NOT NULL),
														IF((SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))-SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant)))))>0,
															(SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))-SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))),
															''
														),
														''
													) AS solde_debit,

													IF((SUM(det.debit) IS NOT NULL) OR (SUM(det.credit) IS NOT NULL),
														IF((SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))-SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant)))))>0,
															(SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))-SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))),
															''
														),
														''
													) AS solde_credit

												FROM compte, detail_ecriture det, sub_classe_compte, classe_compte, monnaie, ecriture ec, taux_echange te
												WHERE compte.id_compte = det.id_compte
													AND compte.id_sub_class = sub_classe_compte.id_sub_class
													AND sub_classe_compte.id_sub_class = ?
													AND sub_classe_compte.id_class = classe_compte.id_class
													AND monnaie.id_mon = compte.id_mon
													AND ec.id_e = det.id_e
													AND te.id_taux = ec.id_taux

												-- FROM compte
												-- 	LEFT JOIN detail_ecriture det
												-- 		ON compte.id_compte = det.id_compte
												-- 	LEFT JOIN sub_classe_compte
												-- 		ON compte.id_sub_class = sub_classe_compte.id_sub_class
												-- 	LEFT JOIN classe_compte
												-- 		ON sub_classe_compte.id_class = classe_compte.id_class
												-- 	LEFT JOIN monnaie
												-- 		ON monnaie.id_mon = compte.id_mon
												-- 	LEFT JOIN ecriture ec
												-- 		ON ec.id_e = det.id_e
												-- 	LEFT JOIN taux_echange te
												-- 		ON te.id_taux = ec.id_taux
												-- GROUP BY compte.id_compte
												GROUP BY compte.id_compte
												-- ORDER BY classe_compte.id_class, compte.nom_compte
												ORDER BY compte.nom_compte");
			$requete-> execute(array($entree['id_sub_class']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur.'<a title="View more details" href="#" style="color: black;" onclick="window.open(\'pop_detail_compte.php?id_compte='.$reponse['id_compte'].'\',\'pop11\',\'width=1000,height=500\');">
						<span class="fa fa-eye text-primary"></>
					</a>';
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function detail_compte($id_compte){
			include("connexion.php");

			$entree['id_compte'] = $id_compte;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT compte.id_compte AS id_compte,
													compte.code_compte AS code_compte,
													compte.nom_compte AS nom_compte,
													classe_compte.nom_class AS nom_class,
													ec.date_e AS date_e,
													ec.id_e AS id_e,
													ec.libelle_e AS libelle_e,
													det.debit AS debit,
													det.credit AS credit,
													monnaie.sig_mon AS sig_mon,
													IF(ec.id_mon=1,
														'1',
														te.montant
													) AS montant_taux,
													IF(ec.id_mon=1,
														det.debit,
														det.debit/te.montant
													) AS debit_acc,
													IF(ec.id_mon=1,
														det.credit,
														det.credit/te.montant
													) AS credit_acc,
													-- sub_classe_compte.nom_sub_class AS nom_sub_class,
													CONCAT('<span class=\"btn btn-xs btn-primary\"\" onclick=\"detail_ecriture(\'',compte.id_compte,'\');\"><i class=\"fa fa-eye\"></i></span> ',sub_classe_compte.nom_sub_class) AS nom_sub_class,
													(IF(det.debit IS NULL, 0, det.debit)) AS debit,
													(IF(det.credit IS NULL, 0, det.credit)) AS credit,
													IF((IF(det.debit IS NULL, 0, det.debit))>(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT((IF(det.debit IS NULL, 0, det.debit))-(IF(det.credit IS NULL, 0, det.credit)),2),
														NULL
													) AS solde_debit,
													IF((IF(det.debit IS NULL, 0, det.debit))<(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT((IF(det.credit IS NULL, 0, det.credit))-(IF(det.debit IS NULL, 0, det.debit)),2),
														NULL
													) AS solde_credit,
													CONCAT('<span class=\"btn btn-xs btn-primary\"\" onclick=\"afficherEcritureCompte(',compte.id_compte,', \'',compte.nom_compte,'\', \'',IF(FORMAT((IF(det.debit IS NULL, 0, det.debit)),2) IS NULL, 0, FORMAT((IF(det.debit IS NULL, 0, det.debit)),2)),'\', \'',IF(FORMAT((IF(det.credit IS NULL, 0, det.credit)),2) IS NULL, 0, FORMAT((IF(det.credit IS NULL, 0, det.credit)),2)),'\')\">
																<i class=\"fa fa-eye\"></i>
															</span>') AS btn_action,
													monnaie.sig_mon AS sig_mon,


													IF(((det.debit) IS NOT NULL) OR ((det.credit) IS NOT NULL),
														IF(((IF(det.debit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))-(IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant)))))>0,
															((IF(det.debit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))-(IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))),
															''
														),
														''
													) AS solde_debit,

													IF(((det.debit) IS NOT NULL) OR ((det.credit) IS NOT NULL),
														IF(((IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))-(IF(det.debit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant)))))>0,
															((IF(det.credit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))-(IF(det.debit IS NULL, 0, IF(ec.id_mon=compte.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))),
															''
														),
														''
													) AS solde_credit

												FROM compte, detail_ecriture det, sub_classe_compte, classe_compte, monnaie, ecriture ec, taux_echange te
												WHERE compte.id_compte = det.id_compte
													AND compte.id_compte = ?
													AND compte.id_sub_class = sub_classe_compte.id_sub_class
													AND sub_classe_compte.id_class = classe_compte.id_class
													AND monnaie.id_mon = ec.id_mon
													AND ec.id_e = det.id_e
													AND te.id_taux = ec.id_taux

												-- FROM compte
												-- 	LEFT JOIN detail_ecriture det
												-- 		ON compte.id_compte = det.id_compte
												-- 	LEFT JOIN sub_classe_compte
												-- 		ON compte.id_sub_class = sub_classe_compte.id_sub_class
												-- 	LEFT JOIN classe_compte
												-- 		ON sub_classe_compte.id_class = classe_compte.id_class
												-- 	LEFT JOIN monnaie
												-- 		ON monnaie.id_mon = compte.id_mon
												-- 	LEFT JOIN ecriture ec
												-- 		ON ec.id_e = det.id_e
												-- 	LEFT JOIN taux_echange te
												-- 		ON te.id_taux = ec.id_taux
												-- GROUP BY compte.id_compte
												-- ORDER BY classe_compte.id_class, compte.nom_compte
												ORDER BY compte.nom_compte");
			$requete-> execute(array($entree['id_compte']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur.'<a title="View more details" href="#" style="color: black;" onclick="detail_ecriture(\''.$reponse['id_e'].'\');">
						<span class="fa fa-eye text-primary"></>
					</a>';
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function facturation_suivi_licence($id_cli, $id_mod_lic){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
													COUNT(dos.id_dos) AS nbre_dos,
													l.fact_suiv_lic AS fact_suiv_lic
												FROM licence l, dossier dos
												WHERE l.num_lic = dos.num_lic
													AND l.id_cli = ?
													AND l.id_mod_lic = ?
												GROUP BY l.num_lic
												ORDER BY l.date_val DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				if($this-> checkFileInvoicedLicense($reponse['num_lic'])!=false){
					$reponse['statut'] = '<span class="text-xs badge badge-success">Invoiced ('.$this-> checkFileInvoicedLicense($reponse['num_lic'])['ref_fact'].')</span>';
				}else if($reponse['fact_suiv_lic']=='1'){
					$reponse['statut'] = '<span class="text-xs badge badge-warning">To be invoiced</span>';
				}else{
					$reponse['statut'] = '<span class="text-xs badge badge-danger">Disabled</span>';
				}

				$reponse['nbre_dos'].='<a title="Dossiers affectÃ©s" href="#" style="color: black;" onclick="window.open(\'popUpDossierLicence.php?num_lic='.$reponse['num_lic'].'&couleur=\',\'pop1\',\'width=1300,height=900\');">
							<i class="fa fa-folder-open"></i>
						</a>';
				
				$reponse['btn_action'] = '<a title="Edit" href="#" style="color: black;" class="" onclick="modal_edit_suivi_licence(\''.$reponse['num_lic'].'\', \''.$reponse['fact_suiv_lic'].'\');">
						<i class="fa fa-edit"></i>
					</a>';
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function get_facturation_suivi_licence($id_cli, $id_mod_lic){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT *
												FROM facturation_suivi_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if ($reponse) {
				return $reponse;
			}else{
				return false;
			}

		}

		public function checkFileInvoicedLicense($num_lic){
			include("connexion.php");

			$entree['num_lic'] = $num_lic;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													det.ref_fact AS ref_fact
											FROM dossier dos, detail_facture_dossier det
											WHERE dos.num_lic = ?
												AND dos.id_dos = det.id_dos
												AND (det.id_deb = 102
													OR det.id_deb = 106)
												");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse;
			}else{
				return false;
			}

		}

		public function client_finance(){
			include("connexion.php");

			// $entree['id_tres'] = $id_tres;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> query("SELECT *,
												CONCAT(' <button class=\"btn btn-xs btn-info\" title=\"Details\" onclick=\"window.open(\'detail_client_finance.php?id_cli=',id_cli,'\',\'pop8\',\'width=1100,height=700\');\">
														<i class=\"fa fa-eye\"></i>
													</button>') AS btn_action
											FROM client
											WHERE id_cli IN (SELECT DISTINCT(id_cli) FROM dossier WHERE YEAR(date_creat_dos)>=2023)
											ORDER BY nom_cli ASC");
			// $requete-> execute(array($entree['id_tres']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['montant_facture'] = $this-> getMontantClientFinanceClient($reponse['id_cli'])['montant_facture'];
				$reponse['montant_paie'] = $this-> getMontantClientFinanceClient($reponse['id_cli'])['montant_paie'];
				$reponse['solde'] = $reponse['montant_facture']-$reponse['montant_paie'];
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function fournisseur_finance(){
			include("connexion.php");

			// $entree['id_tres'] = $id_tres;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> query("SELECT *,
												CONCAT(' <button class=\"btn btn-xs btn-info\" title=\"Details\" onclick=\"window.open(\'detail_fournisseur_finance.php?id_four=',id_four,'\',\'pop8\',\'width=1100,height=700\');\">
														<i class=\"fa fa-eye\"></i>
													</button>') AS btn_action
											FROM fournisseur
											ORDER BY nom_four ASC");
			// $requete-> execute(array($entree['id_tres']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['montant_facture'] = $this-> getMontantFactureFournisseurFinance($reponse['id_four'])['montant_facture'];
				$reponse['montant_paie'] = $this-> getMontantFactureFournisseurFinance($reponse['id_four'])['montant_paie'];
				$reponse['solde'] = $reponse['montant_paie']-$reponse['montant_facture'];
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function getMontantFactureFournisseurFinance($id_four){
			include('connexion.php');
			$entree['id_four'] = $id_four;

			$rows = array();

			$requete = $connexion-> prepare("SELECT SUM(
														montant
													) AS montant
												FROM facture_fournisseur
													WHERE id_four = ?");
			$requete-> execute(array($entree['id_four']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				$rows['montant_facture'] = $reponse['montant'];
			}else{
				$rows['montant_facture'] = 0;
			}


			$requete = $connexion-> prepare("SELECT SUM(det.montant) AS montant
												FROM paiement_facture_fournisseur det, facture_fournisseur fact
												WHERE det.id_fact = fact.id_fact
													AND fact.id_four = ?");
			$requete-> execute(array($entree['id_four']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				$rows['montant_paie'] = $reponse['montant'];
			}else{
				$rows['montant_paie'] = 0;
			}


			return $rows;
		}

		public function getMontantClientFinanceClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$rows = array();

			$requete = $connexion-> prepare("SELECT SUM(
														IF(facture.tax_duty_part='Include',
															IF(detail_facture_dossier.tva = '1',
																IF(detail_facture_dossier.usd='0',
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16,
																	detail_facture_dossier.montant*1.16
																),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant/dossier.roe_decl,
																	detail_facture_dossier.montant
																)
															),
															IF(debours.id_t_deb<>1,
																IF(detail_facture_dossier.tva = '1',
																	IF(detail_facture_dossier.usd='0',
																		(detail_facture_dossier.montant/dossier.roe_decl)*1.16,
																		detail_facture_dossier.montant*1.16
																	),
																	IF(detail_facture_dossier.usd='0',
																		detail_facture_dossier.montant/dossier.roe_decl,
																		detail_facture_dossier.montant
																	)
																),
																0
															)
														)
													) AS montant
												FROM detail_facture_dossier, dossier, facture_dossier facture, debours
													WHERE facture.id_cli = ?
														AND facture.ref_fact = detail_facture_dossier.ref_fact
														AND detail_facture_dossier.id_deb = debours.id_deb
														AND dossier.id_dos = detail_facture_dossier.id_dos");
			$requete-> execute(array($entree['id_cli']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				$rows['montant_facture'] = $reponse['montant'];
			}else{
				$rows['montant_facture'] = 0;
			}


			$requete = $connexion-> prepare("SELECT SUM(paiement_facture.montant_paie) AS montant_paie
												FROM paiement_facture, facture_dossier
												WHERE paiement_facture.ref_fact = facture_dossier.ref_fact
													AND facture_dossier.id_cli = ?");
			$requete-> execute(array($entree['id_cli']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				$rows['montant_paie'] = $reponse['montant_paie'];
			}else{
				$rows['montant_paie'] = 0;
			}


			return $rows;
		}

		public function getMontantClientFinance(){
			include('connexion.php');

			$rows = array();

			$requete = $connexion-> query("SELECT SUM(
														IF(facture.tax_duty_part='Include',
															IF(detail_facture_dossier.tva = '1',
																IF(detail_facture_dossier.usd='0',
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16,
																	detail_facture_dossier.montant*1.16
																),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant/dossier.roe_decl,
																	detail_facture_dossier.montant
																)
															),
															IF(debours.id_t_deb<>1,
																IF(detail_facture_dossier.tva = '1',
																	IF(detail_facture_dossier.usd='0',
																		(detail_facture_dossier.montant/dossier.roe_decl)*1.16,
																		detail_facture_dossier.montant*1.16
																	),
																	IF(detail_facture_dossier.usd='0',
																		detail_facture_dossier.montant/dossier.roe_decl,
																		detail_facture_dossier.montant
																	)
																),
																0
															)
														)
													) AS montant
												FROM detail_facture_dossier, dossier, facture_dossier facture, debours
													WHERE facture.ref_fact = detail_facture_dossier.ref_fact
														AND detail_facture_dossier.id_deb = debours.id_deb
														AND dossier.id_dos = detail_facture_dossier.id_dos");
			// $requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				$rows['montant_facture'] = $reponse['montant'];
			}else{
				$rows['montant_facture'] = 0;
			}


			$requete = $connexion-> query("SELECT SUM(montant_paie) AS montant_paie
												FROM paiement_facture");
			// $requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				$rows['montant_paie'] = $reponse['montant_paie'];
			}else{
				$rows['montant_paie'] = 0;
			}

			$rows['balance'] = $rows['montant_facture']-$rows['montant_paie'];

			return $rows;
		}

		public function getMontantFournisseurFinance(){
			include('connexion.php');

			$rows = array();

			$requete = $connexion-> query("SELECT SUM(ff.montant) AS montant_facture,
													IF(SUM(paie.montant)>0, SUM(paie.montant), 0)  AS montant_paie,
													(IF(SUM(paie.montant)>0, SUM(paie.montant), 0)-SUM(ff.montant)) AS balance
											FROM facture_fournisseur ff
												LEFT JOIN paiement_facture_fournisseur paie
													ON paie.id_fact = ff.id_fact");
			// $requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			$reponse=$requete-> fetch();
			return $reponse;

		}

		public function tresorerie_mois($id_tres){
			include("connexion.php");

			$entree['id_tres'] = $id_tres;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT mvt.*,
													CONCAT('<a href=\"#\"  onclick=\"modal_edit_mouvement(',mvt.id_mvt,')\">
																<img src=\"../images/crayon (1).png\" width=\"15px\">
															</a>
															<a href=\"#\"  onclick=\"supprimer_mouvement_tresorerie(',mvt.id_mvt,')\">
																<img src=\"../images/bouton-supprimer.png\" width=\"15px\">
															</a>') AS btn_action
											FROM mouvement_tresorerie mvt
											WHERE mvt.id_tres = ?
												AND MONTH(mvt.date_mvt) = MONTH(NOW())
												AND YEAR(mvt.date_mvt) = YEAR(NOW())
											ORDER BY mvt.date_mvt, mvt.id_mvt");
			$requete-> execute(array($entree['id_tres']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function detail_client_finance($id_cli){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT client.*,
													facture.ref_fact AS ref_fact,
													SUM(
														IF(facture.tax_duty_part='Include',
															IF(detail_facture_dossier.tva = '1',
																IF(detail_facture_dossier.usd='0',
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16,
																	detail_facture_dossier.montant*1.16
																),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant/dossier.roe_decl,
																	detail_facture_dossier.montant
																)
															),
															IF(debours.id_t_deb<>1,
																IF(detail_facture_dossier.tva = '1',
																	IF(detail_facture_dossier.usd='0',
																		(detail_facture_dossier.montant/dossier.roe_decl)*1.16,
																		detail_facture_dossier.montant*1.16
																	),
																	IF(detail_facture_dossier.usd='0',
																		detail_facture_dossier.montant/dossier.roe_decl,
																		detail_facture_dossier.montant
																	)
																),
																0
															)
														)
													) AS montant_facture,
													CONCAT('<a href=\"#\" title=\"View/Make the Payments\"  onclick=\"modal_paiement_facture(\'',facture.ref_fact,'\')\" class=\"text-light\">
																<img src=\"../images/terminal-de-point-de-vente.png\" width=\"20px\"> Payments
															</a>  |  
															<a href=\"#\" title=\"View The Invoice\" class=\"text-light\"  onclick=\"window.open(\'',mf.view_page,'?ref_fact=',facture.ref_fact,'\',\'pop5\',\'width=1000,height=800\');\">
																<img src=\"../images/calculator.png\" width=\"20px\"> Invoice
															</a>') AS btn_action
											FROM facture_dossier facture, modele_facture mf, detail_facture_dossier, debours, dossier, client
											WHERE detail_facture_dossier.ref_fact = facture.ref_fact
												AND debours.id_deb = detail_facture_dossier.id_deb
												AND detail_facture_dossier.id_dos = dossier.id_dos
												AND client.id_cli = facture.id_cli
												AND facture.id_mod_fact = mf.id_mod_fact
												AND facture.id_cli = ?
											GROUP BY facture.ref_fact
											ORDER BY facture.date_fact");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['montant_paie'] = $this-> getMontantFactureFinance($reponse['ref_fact'])['montant_paie'];
				$reponse['solde'] = $reponse['montant_facture']-$reponse['montant_paie'];
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function detail_fournisseur_finance($id_four){
			include("connexion.php");

			$entree['id_four'] = $id_four;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT ff.*,
													ff.montant AS montant_facture,
													IF(SUM(paie.montant)>0, SUM(paie.montant), 0)  AS montant_paie,
													(IF(SUM(paie.montant)>0, SUM(paie.montant), 0)-ff.montant) AS solde,
													CONCAT('<a href=\"#\" title=\"Make / View Payments\" class=\"text-light\" onclick=\"modal_paiement_facture_fournisseur(\'',ff.id_fact,'\',\'',ff.ref_fact,'\')\">
																<img src=\"../images/terminal-de-point-de-vente.png\" width=\"20px\"> Payments
															</a>') AS btn_action
											FROM facture_fournisseur ff
												LEFT JOIN paiement_facture_fournisseur paie
													ON paie.id_fact = ff.id_fact
											WHERE ff.id_four = ?
											GROUP BY ff.id_fact
											ORDER BY ff.date_fact");
			$requete-> execute(array($entree['id_four']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function popUpPresentation($statut){
			include("connexion.php");

			$compteur=0;

			$rows = array();

			if($statut=='En attente presentation'){

				$requete = $connexion-> query("SELECT *,
														pres.remarque AS remarque,
														DATE_FORMAT(pres.date_prevu, '%d/%m/%Y') AS date_prevu,
														DATE_FORMAT(pres.date_pres, '%d/%m/%Y') AS date_pres,
														DATE_FORMAT(doc.date_recept, '%d/%m/%Y') AS date_recept
													FROM presentation_risque_douane pres, dossier_risque_douane doc, etape_risque_douane etap, senario_pv sen
													WHERE pres.date_prevu IS NOT NULL
														AND pres.date_pres IS NULL
														AND pres.id = doc.id
														AND doc.id_etap = etap.id_etap
														AND sen.id_sen = doc.id_sen
														AND sen.id_sen <> 13");
				while ($reponse = $requete-> fetch()) {
					$compteur++;

					$reponse['compteur'] = $compteur;
					$rows[] = $reponse;

				}$requete-> closeCursor();

			}else if($statut=='Presentation -10 jrs'){

				$requete = $connexion-> query("SELECT *,
														pres.remarque AS remarque,
														DATE_FORMAT(pres.date_prevu, '%d/%m/%Y') AS date_prevu,
														DATE_FORMAT(pres.date_pres, '%d/%m/%Y') AS date_pres,
														DATE_FORMAT(doc.date_recept, '%d/%m/%Y') AS date_recept
													FROM presentation_risque_douane pres, dossier_risque_douane doc, etape_risque_douane etap, senario_pv sen
													WHERE pres.date_prevu IS NOT NULL
														AND pres.date_pres IS NULL
														AND DATEDIFF(pres.date_prevu, CURRENT_DATE()) <= 10
														AND pres.id = doc.id
														AND doc.id_etap = etap.id_etap
														AND sen.id_sen = doc.id_sen
														AND sen.id_sen <> 13");
				while ($reponse = $requete-> fetch()) {
					$compteur++;

					$reponse['compteur'] = $compteur;
					$rows[] = $reponse;

				}$requete-> closeCursor();

			}
			
			return $rows;

		}

		public function getMontantFactureFinance($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$rows = array();

			$requete = $connexion-> prepare("SELECT SUM(
														IF(facture.tax_duty_part='Include',
															IF(detail_facture_dossier.tva = '1',
																IF(detail_facture_dossier.usd='0',
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16,
																	detail_facture_dossier.montant*1.16
																),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant/dossier.roe_decl,
																	detail_facture_dossier.montant
																)
															),
															IF(debours.id_t_deb<>1,
																IF(detail_facture_dossier.tva = '1',
																	IF(detail_facture_dossier.usd='0',
																		(detail_facture_dossier.montant/dossier.roe_decl)*1.16,
																		detail_facture_dossier.montant*1.16
																	),
																	IF(detail_facture_dossier.usd='0',
																		detail_facture_dossier.montant/dossier.roe_decl,
																		detail_facture_dossier.montant
																	)
																),
																0
															)
														)
													) AS montant
												FROM detail_facture_dossier, dossier, facture_dossier facture, debours
													WHERE facture.ref_fact = ?
														AND facture.ref_fact = detail_facture_dossier.ref_fact
														AND detail_facture_dossier.id_deb = debours.id_deb
														AND dossier.id_dos = detail_facture_dossier.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				$rows['montant_facture'] = $reponse['montant'];
			}else{
				$rows['montant_facture'] = 0;
			}


			$requete = $connexion-> prepare("SELECT SUM(paiement_facture.montant_paie) AS montant_paie
												FROM paiement_facture, facture_dossier
												WHERE paiement_facture.ref_fact = facture_dossier.ref_fact
													AND facture_dossier.ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				$rows['montant_paie'] = $reponse['montant_paie'];
			}else{
				$rows['montant_paie'] = 0;
			}


			return $rows;
		}

		public function modal_paiement_facture($ref_fact){
			include("connexion.php");

			$entree['ref_fact'] = $ref_fact;
			$compteur=0;

			$rows = array();

			$tableau = '';

			$requete = $connexion-> prepare("SELECT *
												FROM paiement_facture, tresorerie
													WHERE paiement_facture.ref_fact = ?
														AND paiement_facture.id_tres = tresorerie.id_tres");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='
					<tr>
						<td>'.$compteur.'</td>
						<td>'.$reponse['date_paie'].'</td>
						<td>'.$reponse['ref_paie'].'</td>
						<td>'.$reponse['nom_tres'].'</td>
						<td>'.$reponse['montant_paie'].'</td>
					</tr>
				';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function modal_paiement_facture_fournisseur($id_fact){
			include("connexion.php");

			$entree['id_fact'] = $id_fact;
			$compteur=0;

			$rows = array();

			$tableau = '';

			$requete = $connexion-> prepare("SELECT *, paiement_facture_fournisseur.montant AS montant
												FROM paiement_facture_fournisseur, facture_fournisseur, tresorerie
													WHERE paiement_facture_fournisseur.id_fact = ?
														AND paiement_facture_fournisseur.id_fact = facture_fournisseur.id_fact
														AND paiement_facture_fournisseur.id_tres = tresorerie.id_tres");
			$requete-> execute(array($entree['id_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='
					<tr>
						<td>'.$compteur.'</td>
						<td>'.$reponse['date_paie'].'</td>
						<td>'.$reponse['ref_paie'].'</td>
						<td>'.$reponse['nom_tres'].'</td>
						<td>'.$reponse['montant'].'</td>
					</tr>
				';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function get_facture_fournisseur($id_fact){
			include("connexion.php");

			$entree['id_fact'] = $id_fact;
			$compteur=0;

			$rows = array();

			$tableau = '';

			$requete = $connexion-> prepare("SELECT *
												FROM facture_fournisseur
													WHERE facture_fournisseur.id_fact = ?");
			$requete-> execute(array($entree['id_fact']));
			$reponse = $requete-> fetch();
			return $reponse;

		}

		public function getLastEncodingDateDataInLog($id_dos, $colonne){
			include("connexion.php");

			$entree['id_dos'] = $id_dos;
			$entree['colonne'] = "%$colonne%";
			$compteur=0;


			$requete = $connexion-> prepare("SELECT *, DATE_ADD(date_log, INTERVAL 2 HOUR) AS date_log
												FROM log_dossier
												WHERE id_dos = ?
													AND colonne LIKE ?
												ORDER BY id_log DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_dos'], $entree['colonne']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse;
			}else{
				$reponse['date_log'] = NULL;
				$reponse['colonne'] = NULL;
				$reponse['valeur'] = NULL;
				return $reponse;
			}
			

		}

		public function getMontantTresorerie($id_tres){
			include("connexion.php");

			$entree['id_tres'] = $id_tres;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT SUM(IF(mvt.entree IS NULL, 0, mvt.entree)) AS entree, 
													SUM(IF(mvt.sortie IS NULL, 0, mvt.sortie)) AS sortie,
													(SUM(IF(mvt.entree IS NULL, 0, mvt.entree))-SUM(IF(mvt.sortie IS NULL, 0, mvt.sortie))) AS balance
											FROM mouvement_tresorerie mvt
											WHERE mvt.id_tres = ?
											GROUP BY mvt.id_tres");
			$requete-> execute(array($entree['id_tres']));
			$reponse = $requete-> fetch();

			return $reponse;

		}

		public function tresorerie_all($id_tres){
			include("connexion.php");

			$entree['id_tres'] = $id_tres;
			$compteur=0;

			$rows = array();

			$requete = $connexion-> prepare("SELECT mvt.*,
													DATE_FORMAT(mvt.date_mvt, '%m/%Y') AS mois
											FROM mouvement_tresorerie mvt
											WHERE mvt.id_tres = ?
											ORDER BY mvt.date_mvt, mvt.id_mvt");
			$requete-> execute(array($entree['id_tres']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherBalanceSheetAjax(){
			include("connexion.php");

			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> query("SELECT compte.id_compte AS id_compte,
													compte.code_compte AS code_compte,
													compte.nom_compte AS nom_compte,
													classe_compte.nom_class AS nom_class,
													SUM(IF(det.debit IS NULL, 0, det.debit)) AS debit,
													SUM(IF(det.credit IS NULL, 0, det.credit)) AS credit,
													IF(SUM(IF(det.debit IS NULL, 0, det.debit))>SUM(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit))-SUM(IF(det.credit IS NULL, 0, det.credit)),2),
														NULL
													) AS solde_debit,
													IF(SUM(IF(det.debit IS NULL, 0, det.debit))<SUM(IF(det.credit IS NULL, 0, det.credit)),
														FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit))-SUM(IF(det.debit IS NULL, 0, det.debit)),2),
														NULL
													) AS solde_credit,
													CONCAT('<span class=\"btn btn-xs btn-primary\"\" onclick=\"afficherEcritureCompte(',compte.id_compte,', \'',compte.nom_compte,'\', \'',IF(FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit)),2) IS NULL, 0, FORMAT(SUM(IF(det.debit IS NULL, 0, det.debit)),2)),'\', \'',IF(FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit)),2) IS NULL, 0, FORMAT(SUM(IF(det.credit IS NULL, 0, det.credit)),2)),'\')\">
																<i class=\"fa fa-eye\"></i>
															</span>') AS btn_action,
													monnaie.sig_mon AS sig_mon
												-- FROM compte, classe_compte, detail_ecriture det
												-- WHERE compte.id_class = classe_compte.id_class
												-- 	AND compte.id_compte = det.id_compte
												FROM compte
													LEFT JOIN detail_ecriture det
														ON compte.id_compte = det.id_compte
													LEFT JOIN classe_compte
														ON compte.id_class = classe_compte.id_class
													LEFT JOIN monnaie
														ON monnaie.id_mon = compte.id_mon
												GROUP BY compte.id_compte
												ORDER BY classe_compte.id_class, compte.nom_compte");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherEcritureCompte($id_compte){
			include("connexion.php");

			$entree['id_compte'] = $id_compte;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;
			$rows = array();

			$requete = $connexion-> prepare("SELECT ecriture.libelle_e AS libelle_e,
													DATE_FORMAT(ecriture.date_e, '%d/%m/%Y') AS date_e,
													FORMAT(detail_ecriture.debit, 2) AS debit,
													FORMAT(detail_ecriture.credit, 2) AS credit,
													compte.id_compte AS id_compte,
													compte.code_compte AS code_compte,
													compte.nom_compte AS nom_compte
												FROM compte, ecriture, detail_ecriture
												WHERE compte.id_compte = ?
													AND compte.id_compte = detail_ecriture.id_compte
													AND detail_ecriture.id_e = ecriture.id_e
												ORDER BY ecriture.id_e");
			$requete-> execute(array($entree['id_compte']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function detailRapportEmailAjax($statut){
			include("connexion.php");

			$compteur=0;

			$debut = $compteur;
			$rows = array();

			// echo $statut;

			if ($statut=='TRUCK OVERSTAY MORE THAN 2 DAYS AT KASUMBALESA') {
				
				$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
														DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
														DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
														DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
														cli.nom_cli AS nom_cli,
														d.id_dos AS id_dos,
														d.ref_dos AS ref_dos,
														d.commodity AS commodity,
														DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree,
														d.horse AS horse,
														d.trailer_1 AS trailer_1,
														d.trailer_2 AS trailer_2
													FROM dossier d, client cli
													WHERE d.id_cli = cli.id_cli
														AND d.id_mod_trans = 1
														AND d.dispatch_klsa IS NULL
														AND d.wiski_dep IS NULL
														AND d.klsa_arriv IS NOT NULL
														AND DATEDIFF(CURRENT_DATE() , d.klsa_arriv)>2
														AND d.ref_dos NOT LIKE '%20-%'
													ORDER BY d.date_creat_dos ASC");

			}else if ($statut=='K\'LSA DATES ERROR') {
				
				$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_trans = 1
													AND ( (d.klsa_arriv IS NULL 
															AND (d.wiski_arriv IS NOT NULL OR d.dispatch_klsa IS NOT NULL)
															)
														OR (d.wiski_arriv IS NULL AND d.dispatch_klsa IS NOT NULL)

														OR (d.klsa_arriv > d.wiski_arriv)
														OR (d.wiski_arriv > d.wiski_dep)
														OR (d.wiski_dep > d.dispatch_klsa)
														OR (d.klsa_arriv > d.wiski_dep)
														OR (d.klsa_arriv > d.dispatch_klsa)
														OR (d.wiski_arriv > d.dispatch_klsa)
														)
													AND d.ref_dos NOT LIKE '%20-%'
											ORDER BY d.id_dos DESC");
				
			}else if ($statut=='FILES WITHOUT LIQUIDATION BEYOND 2 DAYS') {
				
				$requete = $connexion-> query("SELECT DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl, 
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.date_decl) AS duree,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree_preal
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND (d.ref_decl IS NOT NULL AND TRIM(d.ref_decl)<>'')
													AND d.date_decl IS NOT NULL
													AND (d.ref_liq IS NULL OR TRIM(d.ref_liq)='')
													AND d.date_liq IS NULL
													AND d.cleared <> '2'
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.id_cli <> 874
													AND DATEDIFF(CURRENT_DATE(), d.date_decl) > 2
												ORDER BY d.date_creat_dos ASC");
				
			}else if ($statut=='FILES WITHOUT QUITTANCE BEYOND 2 DAYS') {
				
				$requete = $connexion-> query("SELECT DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATEDIFF(CURRENT_DATE(), d.date_liq) AS duree_liq,
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													d.ref_quit AS ref_quit,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree_preal
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND (d.ref_liq IS NOT NULL AND TRIM(d.ref_liq)<>'')
													AND d.date_liq IS NOT NULL
													AND d.date_quit IS NULL
													AND (d.ref_quit IS NULL OR TRIM(d.ref_quit)='')
													AND DATEDIFF(CURRENT_DATE(), d.date_liq) > 2
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.id_cli <> 874
												ORDER BY d.date_creat_dos ASC");
				
			}else if ($statut=='TRUCK OVERSTAY MORE THAN 2 DAYS AT WISKI') {
				
				$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_trans = 1
													AND d.dispatch_klsa IS NULL
													AND d.wiski_dep IS NULL
													AND d.klsa_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , d.wiski_arriv)>2
													AND d.ref_dos NOT LIKE '%20-%'
												ORDER BY d.date_creat_dos ASC");
				
			}else if ($statut=='FILES UNDER PREPARATION OVER 15 DAYS') {
				
				$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_trans = 1
													AND d.klsa_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , d.klsa_arriv)>14
													AND d.date_crf IS NOT NULL
													AND d.date_ad IS NOT NULL
													AND d.date_assurance IS NOT NULL
													AND d.date_decl IS NULL 
													AND d.ref_decl IS NULL
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.cleared <> '2'
												ORDER BY d.date_creat_dos ASC");
				
			}else if ($statut=='KASUMBALESA TRUCK ARRIVAL') {
				
				$requete = $connexion-> query("SELECT DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_trans = '1'
													AND DATEDIFF(CURRENT_DATE() , d.klsa_arriv)<3
													AND d.ref_dos NOT LIKE '%20-%'
												ORDER BY d.date_creat_dos ASC");
				
			}

			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['statut'] = $statut;
				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;

		}

		public function getAffectationUtilisateurModule($id_util, $id_mod){
			include('connexion.php');
			$entree['id_util'] = $id_util;
			$entree['id_mod'] = $id_mod;

			$requete = $connexion-> prepare("SELECT *
												FROM affectation_utilisateur_module
												WHERE id_util = ?
													AND id_mod = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod']));
			$reponse = $requete-> fetch();
			
			return $reponse;
			
		}

		public function getNombreDossierStatus($statut, $id_cli=NULL, $id_mod_lic=NULL){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$sqlStatus= '';

			if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/AV/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL AND d.id_cli <> 883 
								AND YEAR(d.date_creat_dos) > 2021';

			}/*else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/AV')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NOT NULL';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NULL AND d.date_av IS NOT NULL AND d.date_assurance IS NULL';

			}*/
			else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AD')) {

				$sqlStatus = ' AND d.ad_date IS NULL 
								AND YEAR(d.date_creat_dos) > 2021';

			}/*else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AV/INSURANCE')) {

				$sqlStatus = ' AND d.ad_date IS NOT NULL AND d.date_av IS NULL AND d.id_cli <> 888 AND d.date_assurance IS NULL';

			}*/else if (isset($statut) && ($statut != '') && ($statut=='AWAITING AV')) {

				$sqlStatus = ' AND d.date_av IS NULL AND d.id_cli <> 888 
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING INSURANCE')) {

				$sqlStatus = ' AND d.date_assurance IS NULL  AND d.id_cli <> 883 
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING BAE')) {

				$sqlStatus = ' AND d.bae_date IS NULL 
								AND d.date_quit IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}else if (isset($statut) && ($statut != '') && ($statut=='AWAITING BS')) {

				$sqlStatus = ' AND d.bs_date IS NULL 
								AND d.date_quit IS NOT NULL
								AND YEAR(d.date_creat_dos) > 2021';

			}

			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier d
												WHERE d.id_mod_lic = ?
													$sqlClient
													$sqlStatus");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
			//return $statut;

		}

		public function getDossierPourFacturationClientModeleLicence($id_cli, $id_mod_lic, $id_mod_trans, $id_march){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;
			$compteur = '0';
			$active = '';
			$dossiers_a_facturer = '<select onchange="getDataDossier(this.value); total()" id="id_dos" class="form-control float-right"><option></option>';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, ref_decl, 
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, horse, commodity, id_mod_lic,
													principal, roe_decl, id_march
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND ref_dos NOT IN(
														SELECT d.ref_dos AS ref_dos
															FROM detail_facture_dossier det, dossier d
															WHERE d.id_dos = det.id_dos
													)
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND id_mod_trans = ?
													AND id_march = ?
													AND not_fact = '0'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_march']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$dossiers_a_facturer .= '<option value="'.$reponse['id_dos'].'">'.$reponse['ref_dos'].'</option>';
			}$requete-> closeCursor();

			$dossiers_a_facturer .='</select>
									<div class="input-group-append">
		                              <span onclick="creerDetailFactureDossier(ref_fact.value, id_dos.value);" class="btn btn-info">Add</span>
		                            </div>';

			return $dossiers_a_facturer;

		}

		public function getDossiersFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$compteur = '0';
			$tableau = '';
			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													CONCAT(
														IF(d.horse IS NOT NULL AND REPLACE(d.horse, ' ', '') NOT LIKE '',
															d.horse,
															''),
														IF(d.trailer_1 IS NOT NULL AND REPLACE(d.trailer_1, ' ', '') NOT LIKE '',
															CONCAT(' / ', d.trailer_1),
															''),
														IF(d.trailer_2 IS NOT NULL AND REPLACE(d.trailer_2, ' ', '') NOT LIKE '',
															CONCAT(' / ', d.trailer_2),
															'')
													) AS truck
												FROM dossier d, detail_facture_dossier det
												WHERE d.id_dos = det.id_dos
													AND det.ref_fact = ?
												GROUP BY d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$tableau .= '<tr>
		                        <td style="border: 1px solid black; border-collapse: collapse;">'.$compteur.'</td>
		                        <td style="border: 1px solid black; border-collapse: collapse;">'.$reponse['ref_dos'].'</td>
		                        <td style="border: 1px solid black; border-collapse: collapse;">'.$reponse['truck'].'</td>
		                    </tr>';
			}$requete-> closeCursor();


			return $tableau;

		}

		public function getModeleFacturationBackUp($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$tableau = '';

			$requeteMarchandise = $connexion-> prepare("SELECT marchandise.id_march AS id_march,
    															marchandise.nom_march AS nom_march,
    															modele_facture.id_mod_fact AS id_mod_fact,
    															modele_facture.create_page AS create_page,
    															mode_transport.id_mod_trans AS id_mod_trans,
    															mode_transport.nom_mod_trans AS nom_mod_trans
    														FROM affectation_modele_facture_client_marchandise aff, 
    															marchandise, modele_facture, mode_transport
    														WHERE aff.id_cli = ?
    															AND aff.id_march = marchandise.id_march
    															AND aff.id_mod_trans = mode_transport.id_mod_trans
    															AND aff.id_mod_fact = modele_facture.id_mod_fact
    															AND modele_facture.id_mod_lic = ?");
    		$requeteMarchandise-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
    		while ($reponseMarchandise = $requeteMarchandise-> fetch()) {
    			$tableau .= '
    						<tr>
    							<td>'.$reponseMarchandise['nom_march'].'</td>
    							<td>'.$reponseMarchandise['nom_mod_trans'].'</td>
    							<td>'.$this-> getNbreDossierEnAttenteFactureModeTransportMarchandise($id_mod_lic, $id_cli, $reponseMarchandise['id_mod_trans'], $reponseMarchandise['id_march']).'</td>
    							<td style="text-align: center;">
    								<a class="btn btn-xs btn-primary" href="'.$reponseMarchandise['create_page'].'?id_mod_lic_fact='.$id_mod_lic.'&id_cli='.$id_cli.'&amp;id_mod_lic_fact='.$id_mod_lic.'&amp;id_mod_fact='.$reponseMarchandise['id_mod_fact'].'&amp;id_march='.$reponseMarchandise['id_march'].'&amp;id_mod_trans='.$reponseMarchandise['id_mod_trans'].'">
    									<i class="fa fa-calculator"></i>
    								</a>
    							</td>
    						</tr>
    			';
    		 }$requeteMarchandise-> closeCursor();

    		 return $tableau;
		}

		public function getModeleFacturation($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;

			$tableau = '';

			$requeteMarchandise = $connexion-> prepare("SELECT COUNT(dossier.id_dos) AS nbre, 
																dossier.num_lic aS num_lic, 
																marchandise.id_march AS id_march,
    															marchandise.nom_march AS nom_march,
    															modele_facture.id_mod_fact AS id_mod_fact,
    															modele_facture.create_page AS create_page,
    															mode_transport.id_mod_trans AS id_mod_trans,
    															mode_transport.nom_mod_trans AS nom_mod_trans
    														FROM affectation_modele_facture_client_marchandise aff, 
    															marchandise, modele_facture, mode_transport, dossier
    														WHERE aff.id_cli = ?
    															AND aff.id_march = marchandise.id_march
    															AND aff.id_mod_trans = mode_transport.id_mod_trans
    															AND aff.id_mod_fact = modele_facture.id_mod_fact
    															AND modele_facture.id_mod_lic = ?
                                                                AND dossier.id_cli = aff.id_cli
    															AND dossier.id_march = marchandise.id_march
    															AND dossier.id_mod_lic = modele_facture.id_mod_lic
    															AND dossier.id_mod_trans = mode_transport.id_mod_trans
																AND dossier.ref_quit IS NOT NULL
																AND dossier.ref_quit <> ''
																AND dossier.ref_decl IS NOT NULL
																AND dossier.ref_decl <> ''
																AND dossier.ref_liq IS NOT NULL
																AND dossier.ref_liq <> ''
																AND dossier.not_fact = '0'
																AND dossier.id_dos NOT IN (
																	SELECT det.id_dos 
																		FROM detail_facture_dossier det, facture_dossier fact
																		WHERE det.ref_fact = fact.ref_fact
																			AND fact.note_debit = '0'
																			GROUP BY det.id_dos
																	)
														GROUP BY dossier.num_lic, dossier.id_mod_trans
														ORDER BY dossier.num_lic");
    		$requeteMarchandise-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
    		while ($reponseMarchandise = $requeteMarchandise-> fetch()) {
    			$compteur++;
    			$tableau .= '
    						<tr>
    							<td>'.$compteur.'</td>
    							<td>'.$reponseMarchandise['nom_march'].'</td>
    							<td>'.$reponseMarchandise['nom_mod_trans'].'</td>
    							<td>'.$reponseMarchandise['num_lic'].'</td>
    							<td>'.$reponseMarchandise['nbre'].'</td>
    							<td style="text-align: center;">
    								<a class="btn btn-xs btn-primary" href="'.$reponseMarchandise['create_page'].'?id_mod_lic_fact='.$id_mod_lic.'&id_cli='.$id_cli.'&amp;id_mod_lic_fact='.$id_mod_lic.'&amp;id_mod_fact='.$reponseMarchandise['id_mod_fact'].'&amp;id_march='.$reponseMarchandise['id_march'].'&amp;id_mod_trans='.$reponseMarchandise['id_mod_trans'].'&amp;num_lic='.$reponseMarchandise['num_lic'].'">
    									<i class="fa fa-calculator"></i>
    								</a>
    							</td>
    						</tr>
    			';
    		 }$requeteMarchandise-> closeCursor();

    		 return $tableau;
		}

		public function getModeleFacturationClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$tableau = '';
			$compteur=0;

			$requete = $connexion-> prepare("SELECT marchandise.id_march AS id_march,
    															marchandise.nom_march AS nom_march,
    															modele_facture.nom_mod_fact AS nom_mod_fact,
    															modele_facture.id_mod_fact AS id_mod_fact,
    															modele_facture.create_page AS create_page,
    															mode_transport.id_mod_trans AS id_mod_trans,
    															mode_transport.nom_mod_trans AS nom_mod_trans,
    															ml.nom_mod_lic AS nom_mod_lic,
    															ml.id_mod_lic AS id_mod_lic
    														FROM affectation_modele_facture_client_marchandise aff, 
    															marchandise, modele_facture, mode_transport, modele_licence ml
    														WHERE aff.id_cli = ?
    															AND aff.id_march = marchandise.id_march
    															AND aff.id_mod_trans = mode_transport.id_mod_trans
    															AND aff.id_mod_fact = modele_facture.id_mod_fact
    															AND modele_facture.id_mod_lic = ml.id_mod_lic");
    		$requete-> execute(array($entree['id_cli']));
    		while ($reponse = $requete-> fetch()) {
    			$compteur++;
    			$tableau .= '
    						<tr>
    							<td>'.$compteur.'</td>
    							<td>'.$reponse['nom_mod_fact'].'</td>
    							<td>'.$reponse['nom_march'].'</td>
    							<td>'.$reponse['nom_mod_trans'].'</td>
    							<td>'.$reponse['nom_mod_lic'].'</td>
    							<td style="text-align: center;">
    								<a class="btn btn-xs btn-primary" onclick="viewDebours('.$id_cli.', '.$reponse['id_mod_lic'].', '.$reponse['id_march'].', '.$reponse['id_mod_trans'].')">
    									<i class="fa fa-list"></i>
    								<a class="btn btn-xs btn-danger" onclick="supprimerAffectationModeleFacture('.$reponse['id_mod_fact'].', '.$id_cli.', '.$reponse['id_march'].', '.$reponse['id_mod_trans'].')">
    									<i class="fa fa-times"></i>
    								</a>
    							</td>
    						</tr>
    			';
    		 }$requete-> closeCursor();

    		 return $tableau;
		}

		public function getDeboursClientModeleLicence($id_cli, $id_mod_lic, $id_march, $id_mod_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			$tableau = '';
			$compteur=0;

			$requete = $connexion-> prepare("SELECT deb.nom_deb AS nom_deb,
													deb.id_deb AS id_deb,
													aff.montant AS montant,
													IF(aff.usd='1',
														'USD',
														'CDF'
														) AS usd,
													IF(aff.tva='1',
														'Yes',
														'No') AS tva,
													aff.id_cli AS id_cli,
													aff.id_march AS id_march,
													aff.id_mod_trans AS id_mod_trans,
													aff.id_mod_lic AS id_mod_lic
												FROM affectation_debours_client_modele_licence aff, debours deb, type_debours td
												WHERE aff.id_cli = ?
													AND aff.id_mod_lic = ?
													AND aff.id_march = ?
													AND aff.id_mod_trans = ?
													AND aff.id_deb = deb.id_deb
													AND deb.id_t_deb = td.id_t_deb
												ORDER BY td.id_t_deb, deb.nom_deb ASC");
    		$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march'], $entree['id_mod_trans']));
    		while ($reponse = $requete-> fetch()) {
    			$compteur++;
    			$tableau .= '
    						<tr>
    							<td>'.$compteur.'</td>
    							<td>'.$reponse['nom_deb'].'</td>
    							<td style="text-align: center;">'.$reponse['montant'].'</td>
    							<td style="text-align: center;">'.$reponse['usd'].'</td>
    							<td style="text-align: center;">'.$reponse['tva'].'</td>
    							<td style="text-align: center;">
    								<a class="btn btn-xs btn-danger" onclick="supprimerAffectationDebours('.$reponse['id_deb'].', '.$reponse['id_cli'].', '.$reponse['id_march'].', '.$reponse['id_mod_trans'].', '.$reponse['id_mod_lic'].')">
    									<i class="fa fa-times"></i>
    								</a>
    							</td>
    						</tr>
    			';
    		 }$requete-> closeCursor();

    		 return $tableau;
		}

		public function getAdresseMailFacturation($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tableau = '';
			$compteur = 0;

			$requeteMarchandise = $connexion-> prepare("SELECT ad.adr_mail AS adr_mail,
																ad.id_adr AS id_adr
															FROM adresse_mail ad, affectation_adresse_mail_client aff, client cl, facture_dossier fd
															WHERE fd.ref_fact = ?
																AND fd.id_cli = cl.id_cli
																AND cl.id_cli = aff.id_cli
																AND aff.id_adr = ad.id_adr");
    		$requeteMarchandise-> execute(array($entree['ref_fact']));
    		while ($reponseMarchandise = $requeteMarchandise-> fetch()) {
    			$compteur++;
    			$tableau .= '<input type="hidden" id="adr_mail_'.$compteur.'" name="adr_mail_'.$compteur.'" value="'.$reponseMarchandise['adr_mail'].'">
    						<tr>
    							<td>'.$compteur.'</td>
    							<td>'.$reponseMarchandise['adr_mail'].'</td>
    							<td style="text-align: center;"><input class="" type="checkbox" id="check_'.$compteur.'" name="check_'.$compteur.'" checked></td>
    						</tr>
    			';
    		 }$requeteMarchandise-> closeCursor();

    		 $tableau .= '<input type="hidden" id="nbre_adresse" name="nbre_adresse" value="'.$compteur.'">';

    		 return $tableau;
		}

		public function afficherMenuTrackingClientModeleLicenceFacturationBackUp($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli,
													c.code_cli AS code_cli
												FROM client c, affectation_client_modele_licence cm, modele_licence m
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-user"></i>
			          <p>
			            <?php echo $reponse['code_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              	<li class="nav-item">
			                <a href="dossierEnAttenteFacture.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-exclamation-triangle nav-icon"></i>
			                  <p>Non facturÃ©(s)<sup><?php echo $this-> getNbreDossierEnAttenteFacture($id_mod_lic, $reponse['id_cli']);?></sup></p>
			                </a>
			            </li>
			              <?php
			              	if ($reponse['id_cli'] == '883' && $entree['id_mod_lic']=='1') {
			              	?>
		              	<li class="nav-item">
					    	<a href="nouvelleFactureMasterData.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>
			                  	Editer Facture Globale
			                  	<i class="right fas fa-angle-left"></i>
			                  </p>
			                </a>
				            <ul class="nav nav-treeview">
				              <?php
				              	$this-> afficherMenuMarchandiseClientModeleLicenceFacturation($reponse['id_cli'], $id_mod_lic);
				              ?>
				            </ul>
			             </li>
						    <li class="nav-item">
						    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}else if ($reponse['id_cli'] == '883' && $entree['id_mod_lic']=='2') {
			              	?>
		              	<li class="nav-item">
					    	<a href="nouvelleFactureMasterData.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer Normale</p>
			                </a>
					    	<a href="nouvelleFactureMasterDataTR8.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer TR8</p>
			                </a>
					    	<a href="nouvelleFactureMasterDataSEGUCE.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
			                  <p>Editer SEGUCE</p>
			                </a>
			             </li>
						    <li class="nav-item">
						    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}else if ($reponse['id_cli'] == '888') {
			              	?>
			              	<li class="nav-item has-treeview">
						    	<a  class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
				                  <p>
				                  	Editer
						            <i class="right fas fa-angle-left"></i>
				              	  </p>
				                </a>
					            <ul class="nav nav-treeview">
					              	<li class="nav-item">
					              		<li class="nav-item has-treeview">
									    	<a  class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-truck nav-icon"></i>
							                  <p>
							                  	Route
									            <i class="right fas fa-angle-left"></i>
							              	  </p>
							                </a>
								            <ul class="nav nav-treeview">
								              	<li class="nav-item">
											    	<a href="factureSicomineEnAttente.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-spinner nav-icon"></i>
									                  <p>En cours</p>
									                </a>
									            </li>
								              	<li class="nav-item">
											    	<a href="nouvelleFactureSicomine.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plus nav-icon"></i>
									                  <p>Nouvelle</p>
									                </a>
									            </li>
									        </ul>
									    </li>
					              		<li class="nav-item has-treeview">
									    	<a  class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plane nav-icon"></i>
							                  <p>
							                  	Aerien
									            <i class="right fas fa-angle-left"></i>
							              	  </p>
							                </a>
								            <ul class="nav nav-treeview">
								              	<li class="nav-item">
											    	<a href="factureSicomineEnAttente.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=3" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-spinner nav-icon"></i>
									                  <p>En cours</p>
									                </a>
									            </li>
								              	<li class="nav-item">
											    	<a href="nouvelleFactureSicomine.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=3" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plus nav-icon"></i>
									                  <p>Nouvelle</p>
									                </a>
									            </li>
									        </ul>
									    </li>
									</li>
						        </ul>
						    </li>
						    <li class="nav-item">
						    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}else if ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885') {
			              	?>
			              	<li class="nav-item has-treeview">
						    	<a  class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
				                  <p>
				                  	Editer
						            <i class="right fas fa-angle-left"></i>
				              	  </p>
				                </a>
					            <ul class="nav nav-treeview">
					              	<li class="nav-item">
					              		<li class="nav-item has-treeview">
									    	<a  class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-truck nav-icon"></i>
							                  <p>
							                  	Route
									            <i class="right fas fa-angle-left"></i>
							              	  </p>
							                </a>
								            <ul class="nav nav-treeview">
								              	<li class="nav-item">
											    	<a href="factureRCDEnAttente.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-spinner nav-icon"></i>
									                  <p>En cours</p>
									                </a>
									            </li>
								              	<li class="nav-item">
											    	<a href="nouvelleFactureRCD.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=1" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plus nav-icon"></i>
									                  <p>Nouvelle</p>
									                </a>
									            </li>
									        </ul>
									    </li>
					              		<li class="nav-item has-treeview">
									    	<a  class="nav-link">
							                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plane nav-icon"></i>
							                  <p>
							                  	Aerien
									            <i class="right fas fa-angle-left"></i>
							              	  </p>
							                </a>
								            <ul class="nav nav-treeview">
								              	<li class="nav-item">
											    	<a href="factureSicomineEnAttente.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=3" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-spinner nav-icon"></i>
									                  <p>En cours</p>
									                </a>
									            </li>
								              	<li class="nav-item">
											    	<a href="nouvelleFactureSicomine.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_mod_trans=3" class="nav-link">
									                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-plus nav-icon"></i>
									                  <p>Nouvelle</p>
									                </a>
									            </li>
									        </ul>
									    </li>
									</li>
						        </ul>
						    </li>
						    <li class="nav-item">
						    	<a href="transmisFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}else {
			              	?>
						    <li class="nav-item">
						    	<a href="nouvelleFacturePartielle1.php?id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit nav-icon"></i>
				                  <p>Editer</p>
				                </a>
			            	</li>
						    <li class="nav-item">
				                <a href="transmisFactureDossier.php?type_fact=partielle&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>" class="nav-link">
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
				                  <p>Transmis Factures</p>
				                </a>
						    </li>
			              	<?php
			              	}
			              ?>
			            
		              	<li class="nav-item">
			                <a href="listerFactureDossier.php?type_fact=globale&id_mod_lic_fact=<?php echo $id_mod_lic;?>&id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-copy nav-icon"></i>
			                  <p>View Invoices</p>
			                </a>
			            </li>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function getDocumentDossierFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$compteur=0;

			$requeteDossier = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos, dos.id_dos AS id_dos
														FROM dossier dos, detail_facture_dossier det
														WHERE det.id_dos = dos.id_dos
															AND det.ref_fact = ?
															GROUP BY dos.id_dos
															ORDER BY dos.ref_dos");
			$requeteDossier-> execute(array($entree['ref_fact']));
			while($reponseDossier=$requeteDossier-> fetch()){
				$compteur++;
				?>
				<tr>
					<td><?php echo $compteur;?></td>
					<td><?php echo $reponseDossier['ref_dos'];?></td>
					<td>
					<?php

						$requete = $connexion-> prepare("SELECT doc.nom_doc AS nom_doc,
																dd.piece AS piece,
																dos.ref_dos AS ref_dos
															FROM document doc, dossier_document dd,
																dossier dos
															WHERE doc.id_doc = dd.id_doc
																AND dd.id_dos = dos.id_dos
																AND dos.id_dos = ?");
						$requete-> execute(array($reponseDossier['id_dos']));


						while($reponse = $requete-> fetch()){
							$compteur++;
							if(stristr($reponse['ref_dos'], '/') == true) {
								$reponse['ref_dos'] = str_replace("/", "_", $reponse['ref_dos']);
							}
							?>
			                    &nbsp&nbsp<button class="btn btn-xs btn-dark" onclick="window.open('../documents/<?php echo $reponse['ref_dos'];?>/<?php echo $reponse['piece'];?>','pop1','width=1000,height=800');">
			                      <i class="fas fa-file"></i> <?php echo $reponse['nom_doc'];?>
			                    </button>
							<?php
						}$requete-> closeCursor();

					?>
					</td>
				</tr>
				<?php
			}$requeteDossier-> closeCursor();

		}

		public function getFactureGlobale($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_fact, '%d-%b-%y') AS date_fact
												FROM facture_dossier
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getNote($ref_note){
			include('connexion.php');
			$entree['ref_note'] = $ref_note;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_create, '%d-%b-%y') AS date_note
												FROM note_debit
												WHERE ref_note = ?");
			$requete-> execute(array($entree['ref_note']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getFactureModeleFacture($id_mod_fact){
			include('connexion.php');
			$entree['id_mod_fact'] = $id_mod_fact;

			$requete = $connexion-> prepare("SELECT *
												FROM modele_facture
												WHERE id_mod_fact = ?");
			$requete-> execute(array($entree['id_mod_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getIp(){
		    if(!empty($_SERVER['HTTP_CLIENT_IP'])){
		      $ip = $_SERVER['HTTP_CLIENT_IP'];
		    }elseif(!empty($_SERVER['HTTP_X_FORWARDED_FOR'])){
		      $ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
		    }else{
		      $ip = $_SERVER['REMOTE_ADDR'];
		    }
		    $reponse['ip'] = $ip;
		    $reponse['hostname'] = gethostbyaddr($ip);

		    //$geoIP  = json_decode(file_get_contents("http://freegeoip.net/json/$ip"), true);
			//$reponse['longitude'] = $geoIP['longitude'];

			$reponse['latitude'] = NULL;//$this-> getGeoLocalisation($ip)['latitude'];
			$reponse['longitude'] = NULL;//$this-> getGeoLocalisation($ip)['longitude'];
			$reponse['country_name'] = NULL;//$this-> getGeoLocalisation($ip)['country_name'];
			$reponse['region_name'] = NULL;//$this-> getGeoLocalisation($ip)['region_name'];
			$reponse['city'] = NULL;//$this-> getGeoLocalisation($ip)['city'];


		    //$hostname = gethostbyaddr($ip);
		    return $reponse;
		}

		public function getGeoLocalisation($userIP){

			// IP address 
			//$userIP = '162.222.198.75'; 
			 
			// API end URL 
			$apiURL = 'https://freegeoip.app/json/'.$userIP; 
			 
			// Create a new cURL resource with URL 
			$ch = curl_init($apiURL); 
			 
			// Return response instead of outputting 
			curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); 
			 
			// Execute API request 
			$apiResponse = curl_exec($ch); 
			 
			// Close cURL resource 
			curl_close($ch); 
			 
			// Retrieve IP data from API response 
			$ipData = json_decode($apiResponse, true); 
			 
			if(!empty($ipData)){ 
			    $country_code = $ipData['country_code']; 
			    $country_name = $ipData['country_name']; 
			    $region_code = $ipData['region_code']; 
			    $region_name = $ipData['region_name']; 
			    $city = $ipData['city']; 
			    $zip_code = $ipData['zip_code']; 
			    $latitude = $ipData['latitude']; 
			    $longitude = $ipData['longitude']; 
			    $time_zone = $ipData['time_zone']; 
			     
			    // echo 'Country Name: '.$country_name.'<br/>'; 
			    // echo 'Country Code: '.$country_code.'<br/>'; 
			    // echo 'Region Code: '.$region_code.'<br/>'; 
			    // echo 'Region Name: '.$region_name.'<br/>'; 
			    // echo 'City: '.$city.'<br/>'; 
			    // echo 'Zipcode: '.$zip_code.'<br/>'; 
			    // echo 'Latitude: '.$latitude.'<br/>'; 
			    // echo 'Longitude: '.$longitude.'<br/>'; 
			    // echo 'Time Zone: '.$time_zone; 
			    return $ipData;
			}else{ 
			    // echo 'IP data is not found!';
			    return null; 
			} 
			 
		}

		public function getNbreDossierTransmisFacture($id_trans_fact){
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(dos.id_dos)) AS nbre
												FROM transmis_facture_dossier tr, detail_transmis_facture_dossier dtfd, facture_dossier fd, detail_facture_dossier det, dossier dos
												WHERE tr.id_trans_fact = ?
													AND tr.id_trans_fact = dtfd.id_trans_fact
													AND dtfd.ref_fact = fd.ref_fact
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos");
			$requete-> execute(array($entree['id_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getFactureDossierTransmis($id_trans_fact){
			
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact, fd.id_cli AS id_cli, 
													fd.type_fact AS type_fact
											FROM facture_dossier fd, transmis_facture_dossier trans, 
												detail_transmis_facture_dossier det
											WHERE trans.id_trans_fact = ?
												AND trans.id_trans_fact = det.id_trans_fact
												AND det.ref_fact = fd.ref_fact
											ORDER BY fd.ref_fact");
			$requete-> execute(array($entree['id_trans_fact']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				
					if ($reponse['id_cli'] == 883 || $reponse['id_cli'] == 898) {
				?>
					<a class="dropdown-item" onclick="window.open('generateurFactureGlobale.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="GÃ©nÃ©rer la facture">
					<i class="fa fa-file"></i> <?php echo $reponse['ref_fact'];?>
				</a>
				<?php
					}else if ($reponse['id_cli'] == 888) {
				?>
					<a class="dropdown-item" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="GÃ©nÃ©rer la facture">
					<i class="fa fa-file"></i> <?php echo $reponse['ref_fact'];?>
				</a>
				<?php
					}else if ($reponse['type_fact'] == 'globale' && ($reponse['id_cli'] == '887' || $reponse['id_cli'] == '885')) {
				?>
					<a class="dropdown-item" onclick="window.open('generateurFactureSicomine.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="GÃ©nÃ©rer la facture">
					<i class="fa fa-file"></i> <?php echo $reponse['ref_fact'];?>
				</a>
				<?php
					}else{
				?>
					<a class="dropdown-item" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="GÃ©nÃ©rer la facture">
					<i class="fa fa-file"></i> <?php echo $reponse['ref_fact'];?>
				</a>
				<?php
					}

			}$requete-> closeCursor();

		}

		public function getNbreFactureransmisFacture($id_trans_fact){
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(fd.ref_fact)) AS nbre
												FROM transmis_facture_dossier tr, detail_transmis_facture_dossier dtfd, facture_dossier fd
												WHERE tr.id_trans_fact = ?
													AND tr.id_trans_fact = dtfd.id_trans_fact
													AND dtfd.ref_fact = fd.ref_fact");
			$requete-> execute(array($entree['id_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getDataFactureGlobale($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT *, fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													UPPER(cl.nom_cli) AS nom_cli,
													cl.code_cli AS code_cli,
													march.nom_march AS nom_march,
													cl.adr_cli AS adr_cli,
													fd.validation AS validation,
													fd.taux_commission AS taux_commission
												FROM client cl, facture_dossier fd, detail_facture_dossier det, marchandise march, 
													dossier dos, banque b, compte_bancaire cb
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos 
													AND dos.id_march = march.id_march
													AND fd.id_cli = cl.id_cli
													AND fd.num_cmpt = cb.num_cmpt
													AND cb.id_banq = b.id_banq
												GROUP BY dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataFactureDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT fd.*
												FROM facture_dossier fd, detail_facture_dossier det
												WHERE fd.ref_fact = det.ref_fact
													AND det.id_dos = ?
												GROUP BY det.id_dos");
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataModeleFacture($id_mod_fact){
			include('connexion.php');
			$entree['id_mod_fact'] = $id_mod_fact;

			$requete = $connexion-> prepare("SELECT *
												FROM modele_facture
												WHERE id_mod_fact = ?");
			$requete-> execute(array($entree['id_mod_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataClasse($id_class){
			include('connexion.php');
			$entree['id_class'] = $id_class;

			$requete = $connexion-> prepare("SELECT *
												FROM classe_compte, categorie_compte
												WHERE classe_compte.id_class = ?
													AND classe_compte.id_cat_cmpte = categorie_compte.id_cat_cmpte");
			$requete-> execute(array($entree['id_class']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getClientFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT cl.*
												FROM facture_dossier f, client cl
												WHERE f.ref_fact = ?
													AND f.id_cli =  cl.id_cli");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getMarchandiseFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT IF(COUNT(DISTINCT(march.id_march))>1, 
														'DIVERSES MARCHANDISES', 
														UPPER(march.nom_march)
													) AS nom_march,
													march.id_march AS id_march
												FROM facture_dossier f, detail_facture_dossier df, dossier dos, marchandise march
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos
													AND dos.id_march = march.id_march
                                                GROUP BY march.id_march");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse;
			}else{
				$requete = $connexion-> prepare("SELECT dos.commodity AS nom_march, NULL AS id_march
													FROM facture_dossier f, detail_facture_dossier df, dossier dos
													WHERE f.ref_fact = ?
														AND f.ref_fact = df.ref_fact
														AND df.id_dos = dos.id_dos");
				$requete-> execute(array($entree['ref_fact']));
				$reponse = $requete-> fetch();
				if ($reponse) {
					return $reponse;
				}else{
					$reponse['nom_march']=NULL;
					$reponse['id_march']=NULL;
					return $reponse;
				}
			}
			
		}

		public function getDossierFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT DISTINCT(id_dos) AS id_dos
												FROM detail_facture_dossier
													WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse=$requete-> fetch();
			return $reponse['id_dos'];
		}

		public function getDossierFacture($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT *
												FROM detail_facture_dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				return $reponse['id_dos'];
			}else{
				return false;
			}
			
		}

		public function getDossierFacture2($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT *
												FROM detail_facture_dossier det, facture_dossier fact
													WHERE det.id_dos = ?
														AND det.ref_fact = fact.ref_fact
														AND fact.note_debit = '0'");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				return $reponse['id_dos'];
			}else{
				return false;
			}
			
		}

		public function getFournisseurFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT IF(COUNT(DISTINCT(dos.supplier))>1 OR dos.supplier IS NULL, 
														'FOURNISSEURS MULTIPLES', 
														UPPER(dos.supplier)
													) AS supplier
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getCommodityFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT IF(COUNT(DISTINCT(dos.commodity))>1 OR dos.commodity IS NULL, 
														'DIVERS MARCHANDISES', 
														UPPER(dos.commodity)
													) AS commodity
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getTauxFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT ROUND(AVG(dos.roe_decl) ,4) AS roe_decl,
													ROUND(AVG(dos.roe_inv) ,4) AS roe_inv,
													ROUND(AVG(dos.roe_liq) ,4) AS roe_liq
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getInfoFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(dos.id_dos)) AS nbre
												FROM facture_dossier f, detail_facture_dossier df, dossier dos
												WHERE f.ref_fact = ?
													AND f.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDeboursFacturePartielle($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="45%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="5%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="4%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="25%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="10%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if($id_t_deb == '1' && ($reponse['detail']=='')){

					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: 6px; font-weight: bold;" colspan="2" width="45%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6px; font-weight: bold; font-weight: bold;" width="5%">'
								.$reponse['unite'].
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6px; font-weight: bold;" width="4%">'
								.$reponse['qte'].
							'
							</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6px; font-weight: bold;" width="12%">'
								.number_format($reponse['ht_cdf'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6px; font-weight: bold;" width="13%">'
								.number_format($reponse['ht_usd'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6px; font-weight: bold;" width="10%">'
								.number_format($tva, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: 6px; font-weight: bold;" width="11%">'
								.number_format($ttc, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';

				}else if($reponse['detail']!='' && isset($reponse['detail'])){

					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 8px;" colspan="2" width="45%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].$reponse['detail'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6px; font-weight: bold;" width="1%">'
								.$reponse['unite'].
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 8px;" width="4%">'
								.$reponse['qte'].
							'
							</td>
							<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 8px;" width="25%">'
								.number_format($reponse['ht_usd'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-size: 8px;" width="10%">'
								.number_format($tva, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-size: 7px;" width="11%">'
								.number_format($ttc, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';

				}else{

					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black;  font-size: 6px; font-weight: bold;" colspan="2" width="45%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6px; font-weight: bold;" width="5%">'
								.$reponse['unite'].
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6px; font-weight: bold;" width="4%">'
								.$reponse['qte'].
							'
							</td>
							<td style="text-align: right; border-left: 0.5px solid black; font-size: 6px; font-weight: bold;" width="25%">'
								.number_format($reponse['ht_usd'], 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-left: 0.5px solid black; font-size: 6px; font-weight: bold;" width="10%">'
								.number_format($tva, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; border-left: 0.5px solid black; font-size: 6px; font-weight: bold;" width="11%">'
								.number_format($ttc, 2, ',', ' ').
							'&nbsp;&nbsp;</td>
						</tr>
					';

				}

			}
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="45%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; font-size: 8px;" width="4%">
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="25%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="10%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11%"></td>
					</tr>
					';

			return $tbl;
		}

		public function getDetailFactureExportSingle($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
					$unite = number_format($reponse['poids'], 2, ',', ' ');

				}else if($reponse['id_deb']=='11' && $reponse['poids']<30){
					$unite = 1;
				}else if($reponse['id_deb']=='12' && $reponse['poids']>=30){
					$unite = 1;
				}else{
					$unite = 1;
				}

				$cost = $reponse['ht_usd']/$unite;

				$total_cost += $cost;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


				$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: 6.5px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="5%">'
								.$unite.
							'
							</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($cost, 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
						</tr>
					';

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192); font-size: 8px;" width="49%">SUB-TOTAL   / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192); font-size: 8px;" width="5%">
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192);" width="11.5%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192);" width="11.5%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(192,192,192);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function getDossierFactureExportSingle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur=0;
			$liquidation_usd=0;
			$liquidation_cdf=0;
			$total_poids = 0;
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos,
													dos.destination AS destination,
													dos.transporter AS transporter,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													dos.num_lot AS num_lot,
													dos.poids AS poids,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.roe_decl AS roe_decl,
													dos.montant_liq AS montant_liq,
													DATE_FORMAT(dos.load_date, "%d/%m/%Y") AS load_date,
													DATE_FORMAT(dos.date_liq, "%d/%m/%Y") AS date_liq,
													DATE_FORMAT(dos.date_quit, "%d/%m/%Y") AS exit_drc,
													-- IF(dos.cleared="1",
													-- 	"CLEARED",
													-- 	"TRANSIT") AS cleared
													"CLEARED" AS cleared,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant),
																	(det.montant*0.16)
																),
																det.montant
															), 
															0
														)
													) AS liquidation_cdf,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																),
																det.montant/dos.roe_decl
															), 
															0
														)
													) AS liquidation_usd,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl)/dos.poids,
																	(det.montant*0.16)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)/dos.poids
															), 
															0
														)
													) AS liquidation_usd_per_ton
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$total_poids+=$reponse['poids'];
				$liquidation_usd+=$reponse['liquidation_usd'];
				$liquidation_cdf+=$reponse['liquidation_cdf'];

				$tbl .= '
						<tr>
							<td width="2%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$compteur.'</td>
							<td width="9%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['ref_dos'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['destination'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['transporter'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['horse'].'</td>
							<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['trailer_1'].'</td>
							<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['trailer_2'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['num_lot'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($reponse['poids'], 3, ',', '.').'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['load_date'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['ref_liq'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['date_liq'].'</td>
							<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($reponse['liquidation_cdf'], 0, ',', '.').'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['ref_quit'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['exit_drc'].'</td>
							<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($reponse['roe_decl'], 4, ',', '.').'</td>
							<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($reponse['liquidation_usd'], 2, ',', '.').'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['exit_drc'].'</td>
							<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['cleared'].'</td>
						</tr>
					';

			}$requete-> closeCursor();

			$tbl .= '
					<tr>				
						<td width="48%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
						<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($total_poids, 3, ',', '.').'</td>
						<td width="12%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
						<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($liquidation_cdf, 0, ',', '.').'</td>
						<td width="13%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
						<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($liquidation_usd, 2, ',', '.').'</td>
						<td width="12%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
					</tr>
				';

			return $tbl;
		}

		public function getDossierFactureExportSingle3($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur=0;
			$liquidation_usd=0;
			$liquidation_cdf=0;
			$total_poids = 0;
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos,
													dos.destination AS destination,
													dos.transporter AS transporter,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													dos.num_lot AS num_lot,
													dos.poids AS poids,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.roe_decl AS roe_decl,
													dos.montant_liq AS montant_liq,
													DATE_FORMAT(dos.load_date, "%d/%m/%Y") AS load_date,
													DATE_FORMAT(dos.date_liq, "%d/%m/%Y") AS date_liq,
													DATE_FORMAT(dos.date_quit, "%d/%m/%Y") AS exit_drc,
													-- IF(dos.cleared="1",
													-- 	"CLEARED",
													-- 	"TRANSIT") AS cleared
													"CLEARED" AS cleared,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant),
																	(det.montant*0.16)
																),
																det.montant
															), 
															0
														)
													) AS liquidation_cdf,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																),
																det.montant/dos.roe_decl
															), 
															0
														)
													) AS liquidation_usd,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl)/dos.poids,
																	(det.montant*0.16)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)/dos.poids
															), 
															0
														)
													) AS liquidation_usd_per_ton
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$total_poids+=$reponse['poids'];
				$liquidation_usd+=$reponse['liquidation_usd'];
				$liquidation_cdf+=$reponse['liquidation_cdf'];

				$tbl .= '
						<tr>
							<td width="3%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$compteur.'</td>
							<td width="11%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_dos'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['destination'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['transporter'].'</td>
							<td width="9%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['horse'].'</td>
							<td width="8%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['trailer_1'].'</td>
							<td width="8%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['trailer_2'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['num_lot'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['poids'], 3, ',', '.').'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['load_date'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['exit_drc'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['cleared'].'</td>
						</tr>
					';

			}$requete-> closeCursor();

			$tbl .= '
					<tr>				
						<td width="69%" style="text-align: center; border: 1 solid black; font-size: 7px;"></td>
						<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($total_poids, 3, ',', '.').'</td>
						<td width="24%" style="text-align: center; border: 1 solid black; font-size: 7px;"></td>
					</tr>
				';

			return $tbl;
		}

		public function getDossierFactureExportSingle5($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur=0;
			$liquidation_usd=0;
			$liquidation_cdf=0;
			$total_poids = 0;
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos,
													dos.destination AS destination,
													dos.transporter AS transporter,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													dos.container AS container,
													dos.pied_container AS pied_container,
													dos.num_lot AS num_lot,
													dos.poids AS poids,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.roe_decl AS roe_decl,
													dos.montant_liq AS montant_liq,
													DATE_FORMAT(dos.load_date, "%d/%m/%Y") AS load_date,
													DATE_FORMAT(dos.date_liq, "%d/%m/%Y") AS date_liq,
													DATE_FORMAT(dos.date_quit, "%d/%m/%Y") AS exit_drc,
													-- IF(dos.cleared="1",
													-- 	"CLEARED",
													-- 	"TRANSIT") AS cleared
													"CLEARED" AS cleared,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant),
																	(det.montant*0.16)
																),
																det.montant
															), 
															0
														)
													) AS liquidation_cdf,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																),
																det.montant/dos.roe_decl
															), 
															0
														)
													) AS liquidation_usd,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl)/dos.poids,
																	(det.montant*0.16)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)/dos.poids
															), 
															0
														)
													) AS liquidation_usd_per_ton
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$total_poids+=$reponse['poids'];
				$liquidation_usd+=$reponse['liquidation_usd'];
				$liquidation_cdf+=$reponse['liquidation_cdf'];

				$tbl .= '
						<tr>
							<td width="2%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$compteur.'</td>
							<td width="10%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_dos'].'</td>
							<td width="9%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['destination'].'</td>
							<td width="9%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['transporter'].'</td>
							<td width="8%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['horse'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['trailer_1'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['trailer_2'].'</td>
							<td width="8%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['container'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['pied_container'].'</td>
							<td width="9%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['num_lot'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['poids'], 3, ',', '.').'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['load_date'].'</td>
							<td width="9%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['exit_drc'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['cleared'].'</td>
						</tr>
					';

			}$requete-> closeCursor();

			$tbl .= '
					<tr>				
						<td width="73%" style="text-align: center; border: 1 solid black; font-size: 7px;"></td>
						<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($total_poids, 3, ',', '.').'</td>
						<td width="21%" style="text-align: center; border: 1 solid black; font-size: 7px;"></td>
					</tr>
				';

			return $tbl;
		}

		public function getDossierFactureExportSingle2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur=0;
			$liquidation_usd=0;
			$liquidation_cdf=0;
			$total_poids = 0;
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos,
													dos.destination AS destination,
													dos.transporter AS transporter,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													dos.num_lot AS num_lot,
													dos.poids AS poids,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.roe_decl AS roe_decl,
													dos.roe_liq AS roe_liq,
													dos.id_bank_liq AS id_bank_liq,
													dos.montant_liq AS montant_liq,
													DATE_FORMAT(dos.date_decl, "%d/%m/%Y") AS date_decl,
													dos.ref_decl AS ref_decl,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.date_decl AS date_decl2,
													DATE_FORMAT(dos.load_date, "%d/%m/%Y") AS load_date,
													DATE_FORMAT(dos.date_liq, "%d/%m/%Y") AS date_liq,
													DATE_FORMAT(dos.date_quit, "%d/%m/%Y") AS date_quit,
													-- IF(dos.cleared="1",
													-- 	"CLEARED",
													-- 	"TRANSIT") AS cleared
													"CLEARED" AS cleared,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant),
																	(det.montant*0.16)
																),
																det.montant
															), 
															0
														)
													) AS liquidation_cdf,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																),
																det.montant/dos.roe_decl
															), 
															0
														)
													) AS liquidation_usd,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl)/dos.poids,
																	(det.montant*0.16)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)/dos.poids
															), 
															0
														)
													) AS liquidation_usd_per_ton
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$compteur++;

				$total_poids+=$reponse['poids'];
				$liquidation_usd+=$reponse['liquidation_usd'];
				$liquidation_cdf+=$reponse['liquidation_cdf'];

				if ($reponse['roe_liq']<0 || empty($reponse['roe_liq'])) {
					$reponse['roe_liq'] = $this-> getDataDeclaration($reponse['date_decl2'])['roe_liq'];
				}

				$tbl .= '
						<tr>
							<td width="2%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$compteur.'</td>
							<td width="9%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['ref_dos'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['destination'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['transporter'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['horse'].'</td>
							<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['trailer_1'].'</td>
							<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['trailer_2'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['num_lot'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($reponse['poids'], 3, ',', '.').'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['load_date'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['ref_decl'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['date_decl'].'</td>
							<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($reponse['roe_liq'], 3, ',', '.').'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['ref_liq'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['date_liq'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['ref_quit'].'</td>
							<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$reponse['date_quit'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.$this-> getDataBancaire($reponse['id_bank_liq'])['nom_banq'].'</td>
						</tr>
					';

			}$requete-> closeCursor();

			// $tbl .= '
			// 		<tr>				
			// 			<td width="48%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 			<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($total_poids, 3, ',', '.').'</td>
			// 			<td width="12%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 			<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($liquidation_cdf, 0, ',', '.').'</td>
			// 			<td width="13%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 			<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($liquidation_usd, 2, ',', '.').'</td>
			// 			<td width="12%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 		</tr>
			// 	';

			return $tbl;
		}

		public function getDossierFactureExportSingle4($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur=0;
			$liquidation_usd=0;
			$liquidation_cdf=0;
			$total_poids = 0;
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos,
													dos.destination AS destination,
													dos.transporter AS transporter,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													dos.num_lot AS num_lot,
													dos.poids AS poids,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.roe_decl AS roe_decl,
													dos.roe_liq AS roe_liq,
													dos.id_bank_liq AS id_bank_liq,
													dos.montant_liq AS montant_liq,
													DATE_FORMAT(dos.date_decl, "%d/%m/%Y") AS date_decl,
													dos.ref_decl AS ref_decl,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.date_decl AS date_decl2,
													DATE_FORMAT(dos.load_date, "%d/%m/%Y") AS load_date,
													DATE_FORMAT(dos.date_liq, "%d/%m/%Y") AS date_liq,
													DATE_FORMAT(dos.date_quit, "%d/%m/%Y") AS date_quit,
													-- IF(dos.cleared="1",
													-- 	"CLEARED",
													-- 	"TRANSIT") AS cleared
													"CLEARED" AS cleared,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant),
																	(det.montant*0.16)
																),
																det.montant
															), 
															0
														)
													) AS liquidation_cdf,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																),
																det.montant/dos.roe_decl
															), 
															0
														)
													) AS liquidation_usd,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl)/dos.poids,
																	(det.montant*0.16)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)/dos.poids
															), 
															0
														)
													) AS liquidation_usd_per_ton
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$compteur++;

				$total_poids+=$reponse['poids'];
				$liquidation_usd+=$reponse['liquidation_usd'];
				$liquidation_cdf+=$reponse['liquidation_cdf'];

				if ($reponse['roe_liq']<0 || empty($reponse['roe_liq'])) {
					$reponse['roe_liq'] = $this-> getDataDeclaration($reponse['date_decl2'])['roe_liq'];
				}

				$tbl .= '
						<tr>
							<td width="3%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$compteur.'</td>
							<td width="9%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_dos'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['poids'], 3, ',', '.').'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['load_date'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_decl'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['date_decl'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['roe_decl'], 4, ',', '.').'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_liq'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['date_liq'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['liquidation_cdf'], 0, ',', '.').'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_quit'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['date_quit'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['liquidation_usd'], 2, ',', '.').'</td>
						</tr>
					';

			}$requete-> closeCursor();

			// $tbl .= '
			// 		<tr>				
			// 			<td width="48%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 			<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($total_poids, 3, ',', '.').'</td>
			// 			<td width="12%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 			<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($liquidation_cdf, 0, ',', '.').'</td>
			// 			<td width="13%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 			<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($liquidation_usd, 2, ',', '.').'</td>
			// 			<td width="12%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 		</tr>
			// 	';

			return $tbl;
		}

		public function getDossierFactureExportSingle4Backup_28_10_23($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur=0;
			$liquidation_usd=0;
			$liquidation_cdf=0;
			$total_poids = 0;
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos,
													dos.destination AS destination,
													dos.transporter AS transporter,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													dos.num_lot AS num_lot,
													dos.poids AS poids,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.roe_decl AS roe_decl,
													dos.roe_liq AS roe_liq,
													dos.id_bank_liq AS id_bank_liq,
													dos.montant_liq AS montant_liq,
													DATE_FORMAT(dos.date_decl, "%d/%m/%Y") AS date_decl,
													dos.ref_decl AS ref_decl,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.date_decl AS date_decl2,
													DATE_FORMAT(dos.load_date, "%d/%m/%Y") AS load_date,
													DATE_FORMAT(dos.date_liq, "%d/%m/%Y") AS date_liq,
													DATE_FORMAT(dos.date_quit, "%d/%m/%Y") AS date_quit,
													-- IF(dos.cleared="1",
													-- 	"CLEARED",
													-- 	"TRANSIT") AS cleared
													"CLEARED" AS cleared,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant),
																	(det.montant*0.16)
																),
																det.montant
															), 
															0
														)
													) AS liquidation_cdf,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																),
																det.montant/dos.roe_decl
															), 
															0
														)
													) AS liquidation_usd,
													SUM(
														IF(det.usd="0" AND d.id_t_deb="1", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl)/dos.poids,
																	(det.montant*0.16)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)/dos.poids
															), 
															0
														)
													) AS liquidation_usd_per_ton
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$compteur++;

				$total_poids+=$reponse['poids'];
				$liquidation_usd+=$reponse['liquidation_usd'];
				$liquidation_cdf+=$reponse['liquidation_cdf'];

				if ($reponse['roe_liq']<0 || empty($reponse['roe_liq'])) {
					$reponse['roe_liq'] = $this-> getDataDeclaration($reponse['date_decl2'])['roe_liq'];
				}

				$tbl .= '
						<tr>
							<td width="3%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$compteur.'</td>
							<td width="9%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_dos'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['poids'], 3, ',', '.').'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['load_date'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_decl'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['date_decl'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['roe_liq'], 3, ',', '.').'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_liq'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['date_liq'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['liquidation_cdf'], 0, ',', '.').'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['ref_quit'].'</td>
							<td width="6%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$reponse['date_quit'].'</td>
							<td width="12%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.$this-> getDataBancaire($reponse['id_bank_liq'])['nom_banq'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['roe_decl'], 4, ',', '.').'</td>
							<td width="7%" style="text-align: center; border: 1 solid black; font-size: 7px;">'.number_format($reponse['liquidation_usd'], 2, ',', '.').'</td>
						</tr>
					';

			}$requete-> closeCursor();

			// $tbl .= '
			// 		<tr>				
			// 			<td width="48%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 			<td width="4%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($total_poids, 3, ',', '.').'</td>
			// 			<td width="12%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 			<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($liquidation_cdf, 0, ',', '.').'</td>
			// 			<td width="13%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 			<td width="5%" style="text-align: center; border: 1 solid black; font-size: 6px;">'.number_format($liquidation_usd, 2, ',', '.').'</td>
			// 			<td width="12%" style="text-align: center; border: 1 solid black; font-size: 6px;"></td>
			// 		</tr>
			// 	';

			return $tbl;
		}

		public function getDossierFactureImportAcidMMG($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur=0;
			$total_poids = 0;
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos,
													dos.destination AS destination,
													dos.transporter AS transporter,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													dos.ref_fact AS ref_fact,
													dos.t1 AS t1,
													dos.poids AS poids,
													DATE_FORMAT(dos.klsa_arriv, "%d/%m/%Y") AS klsa_arriv,
													DATE_FORMAT(dos.wiski_arriv, "%d/%m/%Y") AS wiski_arriv,
													DATE_FORMAT(dos.date_crf, "%d/%m/%Y") AS date_crf,
													-- IF(dos.cleared="1",
													-- 	"CLEARED",
													-- 	"TRANSIT") AS cleared
													"CLEARED" AS cleared
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$total_poids+=$reponse['poids'];

				$tbl .= '
						<tr>				
							<td width="5%" style=""></td>
							<td width="3%" style="text-align: center; border: 1 solid black;">'.$compteur.'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['ref_dos'].'</td>
							<td width="9%" style="text-align: center; border: 1 solid black;">KINSEVERE</td>
							<td width="9%" style="text-align: center; border: 1 solid black;">'.$reponse['t1'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black;">'.$reponse['horse'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black;">'.$reponse['trailer_1'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black;">'.$reponse['trailer_2'].'</td>
							<td width="9%" style="text-align: center; border: 1 solid black;">'.$reponse['ref_fact'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black;">'.$reponse['poids'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black;">'.$reponse['klsa_arriv'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['wiski_arriv'].'</td>
							<td width="7%" style="text-align: center; border: 1 solid black;">'.$reponse['date_crf'].'</td>
							<td width="5%" style=""></td>
						</tr>
					';

			}$requete-> closeCursor();

			$tbl .= '
					<tr>				
						<td width="5%" style=""></td>
						<td width="61%" style="text-align: center; border: 1 solid black;"></td>
						<td width="7%" style="text-align: center; border: 1 solid black;">'.$total_poids.'</td>
						<td width="7%" style="text-align: center; border: 1 solid black;"></td>
						<td width="10%" style="text-align: center; border: 1 solid black;"></td>
						<td width="7%" style="text-align: center; border: 1 solid black;"></td>
						<td width="5%" style=""></td>
					</tr>
				';

			return $tbl;
		}

		public function getDossierFactureImportShalina($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$tbl = '';
			$compteur=0;
			$total_poids = 0;
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos,
													dos.destination AS destination,
													dos.transporter AS transporter,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													dos.container AS container,
													dos.ref_fact AS ref_fact,
													dos.t1 AS t1,
													dos.po_ref AS po_ref,
													dos.poids AS poids,
													DATE_FORMAT(dos.klsa_arriv, "%d/%m/%Y") AS klsa_arriv,
													DATE_FORMAT(dos.wiski_arriv, "%d/%m/%Y") AS wiski_arriv,
													DATE_FORMAT(dos.date_crf, "%d/%m/%Y") AS date_crf,
													DATE_FORMAT(dos.dispatch_deliv, "%d/%m/%Y") AS dispatch_deliv,
													-- IF(dos.cleared="1",
													-- 	"CLEARED",
													-- 	"TRANSIT") AS cleared
													"CLEARED" AS cleared
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$total_poids+=$reponse['poids'];

				$tbl .= '
						<tr>				
							<td width="5%" style=""></td>
							<td width="3%" style="text-align: center; border: 1 solid black;">'.$compteur.'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['ref_dos'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['horse'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['trailer_1'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['trailer_2'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['container'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['po_ref'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['ref_fact'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['poids'].'</td>
							<td width="10%" style="text-align: center; border: 1 solid black;">'.$reponse['dispatch_deliv'].'</td>
							<td width="5%" style=""></td>
						</tr>
					';

			}$requete-> closeCursor();

			$tbl .= '
					<tr>				
						<td width="5%" style="text-align: right;"></td>
						<td width="73%" style="text-align: center; border: 1 solid black;">Total</td>
						<td width="10%" style="text-align: center; border: 1 solid black;">'.$total_poids.'</td>
						<td width="5%" style=""></td>
					</tr>
				';

			return $tbl;
		}

		public function getDetailFactureExportMultiple($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT SUM(dos.poids) AS nbre_poids,
													(SUM(dos.poids)*50) AS gov_tax_50,
													(SUM(dos.poids)*3) AS fere_3,
													(SUM(dos.poids)*5) AS lmc_5,
													(COUNT(dos.id_dos)*250) AS occ_250,
													(COUNT(dos.id_dos)*80) AS cgea_80,
													(COUNT(dos.id_dos)*40) AS dgda_seal_40,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(
														IF(dos.poids<30,
															1,
															0)
													) AS nbre_ceec_30,
													(SUM(
														IF(dos.poids<30,
															1,
															0)
													)*125) AS ceec_30,
													SUM(
														IF(dos.poids>30,
															1,
															0)
													) AS nbre_ceec_60,
													(SUM(
														IF(dos.poids>30,
															1,
															0)
													)*250) AS ceec_60,
													d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
					$unite = number_format($reponse['nbre_poids'], 3, ',', ' ');
					$unite_2 = $reponse['nbre_poids'];

				}else if($reponse['id_deb']=='11'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else if($reponse['id_deb']=='12'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else{
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}

				if ($reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 0, ',', '.');
				}else{
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 2, ',', '.');
				}
				
				if($reponse['id_deb']=='54'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1,50%';
					$cost_2 = $cost;
				}elseif($reponse['id_deb']=='101'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1%';
					$cost_2 = $cost;
				}

				$total_cost += $cost;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


				$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: 6.5px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="6%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.$cost_2.
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						</tr>
					';

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">SUB-TOTAL   / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="6%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function detail_facture_note($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 1;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos, 
													det.montant AS ht,
													IF(det.usd="1", 
														0,
														det.montant
													) AS ht_cdf,
													 
													IF(det.usd="1", 
														det.montant,
														(det.montant/dos.roe_decl)
													) AS ht_usd,
													
													IF(det.usd="1", 
														IF(det.tva="1",
															det.montant*1.16,
															det.montant
														), 
														IF(det.tva="1",
															(det.montant/dos.roe_decl)*1.16,
															(det.montant/dos.roe_decl)
														)
													) AS ttc_usd,
													
													IF(det.usd="1", 
														IF(det.tva="1",
															det.montant*0.16,
															0
														), 
														IF(det.tva="1",
															(det.montant/dos.roe_decl)*0.16,
															0
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													dos.poids AS poids
												FROM detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				
				$total_cost += $cost;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


				$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: 6.5px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['ref_dos'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="6%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.number_format($reponse['ht_usd']*$unite, 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						</tr>
					';

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">SUB-TOTAL   / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="6%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function detail_facture_service($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 1;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos, 
													det.montant AS ht,
													IF(det.usd="1", 
														0,
														det.montant
													) AS ht_cdf,
													 
													IF(det.usd="1", 
														det.montant,
														(det.montant/dos.roe_decl)
													) AS ht_usd,
													
													IF(det.usd="1", 
														IF(det.tva="1",
															det.montant*1.16*det.unite,
															det.montant*det.unite
														), 
														IF(det.tva="1",
															(det.montant/dos.roe_decl)*1.16*det.unite,
															(det.montant/dos.roe_decl)*det.unite
														)
													) AS ttc_usd,
													
													IF(det.usd="1", 
														IF(det.tva="1",
															det.montant*0.16,
															0
														), 
														IF(det.tva="1",
															(det.montant/dos.roe_decl)*0.16,
															0
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													dos.poids AS poids, 
													det.detail AS detail
												FROM detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				
				$total_cost += $cost;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


				$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: 6.5px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['detail'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="6%">
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.$reponse['unite'].
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						</tr>
					';

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">SUB-TOTAL   / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="6%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function detail_facture_transport($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 1;
			$cost = 0;

			$tbl = '
					<tr>
						<td style=" border-left: 0.5px solid black;" width="10%"></td>
						<td style="" width="10%"></td>
						<td style="" width="10%"></td>
						<td style="" width="10%"></td>
						<td style=" border-right: 0.5px solid black;" width="9%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					<tr>
						<td style=" border: 1px solid black; background-color: rgb(220,220,220); text-align: center;" width="10%">MCA Ref.</td>
						<td style=" border: 1px solid black; background-color: rgb(220,220,220); text-align: center;" width="10%">Invoice</td>
						<td style=" border: 1px solid black; background-color: rgb(220,220,220); text-align: center;" width="10%">AWB Num</td>
						<td style=" border: 1px solid black; background-color: rgb(220,220,220); text-align: center;" width="10%">PO Ref.</td>
						<td style=" border: 1px solid black; background-color: rgb(220,220,220); text-align: center;" width="9%">Weight</td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT dos.ref_dos AS ref_dos, 
													dos.ref_fact AS ref_fact,
													dos.horse AS horse,
													dos.po_ref AS po_ref,
													dos.poids AS poids,
													det.montant AS ht,
													IF(det.usd="1", 
														0,
														det.montant
													) AS ht_cdf,
													 
													IF(det.usd="1", 
														det.montant,
														(det.montant/dos.roe_decl)
													) AS ht_usd,
													
													IF(det.usd="1", 
														IF(det.tva="1",
															det.montant*1.16,
															det.montant
														), 
														IF(det.tva="1",
															(det.montant/dos.roe_decl)*1.16,
															(det.montant/dos.roe_decl)
														)
													) AS ttc_usd,
													
													IF(det.usd="1", 
														IF(det.tva="1",
															det.montant*0.16,
															0
														), 
														IF(det.tva="1",
															(det.montant/dos.roe_decl)*0.16,
															0
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													dos.poids AS poids
												FROM detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				
				$total_cost += $reponse['ht_usd']*$unite;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


				$tbl .= '
						<tr>
							<td style="text-align: center; border: 0.5px dotted grey; border-left: 1px solid black; font-size: 6.5px;" width="10%">'.$reponse['ref_dos'].
							'</td>
							<td style="text-align: center; border: 0.5px dotted grey; font-size: 6.5px;" width="10%">&nbsp;&nbsp;'
								.$reponse['ref_fact'].
							'</td>
							<td style="text-align: center; border: 0.5px dotted grey; font-size: 6.5px;" width="10%">&nbsp;&nbsp;'
								.$reponse['horse'].
							'</td>
							<td style="text-align: center; border: 0.5px dotted grey; font-size: 6.5px;" width="10%">&nbsp;&nbsp;'
								.$reponse['po_ref'].
							'</td>
							<td style="text-align: center; border: 0.5px dotted grey; border-right: 0.5px solid black; font-size: 6.5px;" width="9%">&nbsp;&nbsp;'
								.number_format($reponse['poids'], 2, ',', '.').
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="6%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.number_format($reponse['ht_usd']*$unite, 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						</tr>
					';

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">SUB-TOTAL   / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="6%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function getTotalFactureMMGExport_1($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					';
			$requete = $connexion-> prepare('SELECT SUM(dos.poids) AS nbre_poids,
													(SUM(dos.poids)*50) AS gov_tax_50,
													(SUM(dos.poids)*3) AS fere_3,
													(SUM(dos.poids)*5) AS lmc_5,
													(COUNT(dos.id_dos)*250) AS occ_250,
													(COUNT(dos.id_dos)*80) AS cgea_80,
													(COUNT(dos.id_dos)*40) AS dgda_seal_40,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(
														IF(dos.poids<30,
															1,
															0)
													) AS nbre_ceec_30,
													(SUM(
														IF(dos.poids<30,
															1,
															0)
													)*125) AS ceec_30,
													SUM(
														IF(dos.poids>30,
															1,
															0)
													) AS nbre_ceec_60,
													(SUM(
														IF(dos.poids>30,
															1,
															0)
													)*250) AS ceec_60,
													d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND (d.id_deb = 2 OR d.id_deb = 7 OR d.id_deb = 5 OR d.id_deb = 6 OR d.id_deb = 9 OR d.id_deb = 10 OR d.id_deb = 11 OR d.id_deb = 12 OR d.id_deb = 13 OR d.id_deb = 196 OR d.id_deb = 197 OR d.id_deb = 198)
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
					$unite = number_format($reponse['nbre_poids'], 3, ',', ' ');
					$unite_2 = $reponse['nbre_poids'];

				}else if($reponse['id_deb']=='11'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else if($reponse['id_deb']=='12'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else{
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}

				if ($reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 0, ',', '.');
				}else{
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 2, ',', '.');
				}
				
				if($reponse['id_deb']=='54'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1,50%';
					$cost_2 = $cost;
				}elseif($reponse['id_deb']=='101'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1%';
					$cost_2 = $cost;
				}

				$total_cost += $cost;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">SUB-TOTAL   / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="6%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function getTotalFactureMMGExport_2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					';
			$requete = $connexion-> prepare('SELECT SUM(dos.poids) AS nbre_poids,
													(SUM(dos.poids)*50) AS gov_tax_50,
													(SUM(dos.poids)*3) AS fere_3,
													(SUM(dos.poids)*5) AS lmc_5,
													(COUNT(dos.id_dos)*250) AS occ_250,
													(COUNT(dos.id_dos)*80) AS cgea_80,
													(COUNT(dos.id_dos)*40) AS dgda_seal_40,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(
														IF(dos.poids<30,
															1,
															0)
													) AS nbre_ceec_30,
													(SUM(
														IF(dos.poids<30,
															1,
															0)
													)*125) AS ceec_30,
													SUM(
														IF(dos.poids>30,
															1,
															0)
													) AS nbre_ceec_60,
													(SUM(
														IF(dos.poids>30,
															1,
															0)
													)*250) AS ceec_60,
													d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND (d.id_deb = 15 OR d.id_deb = 18 OR d.id_deb = 24 OR d.id_deb = 17 OR d.id_deb = 25 OR d.id_deb = 22 OR d.id_deb = 23 OR d.id_deb = 16 OR d.id_deb = 26 OR d.id_deb = 27 OR d.id_deb = 28 OR d.id_deb = 29 OR d.id_deb = 30 OR d.id_deb = 31)
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
					$unite = number_format($reponse['nbre_poids'], 3, ',', ' ');
					$unite_2 = $reponse['nbre_poids'];

				}else if($reponse['id_deb']=='11'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else if($reponse['id_deb']=='12'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else{
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}

				if ($reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 0, ',', '.');
				}else{
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 2, ',', '.');
				}
				
				if($reponse['id_deb']=='54'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1,50%';
					$cost_2 = $cost;
				}elseif($reponse['id_deb']=='101'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1%';
					$cost_2 = $cost;
				}

				$total_cost += $cost;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">SUB-TOTAL   / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="6%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function getTotalFactureMMGExport_3($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					';
			$requete = $connexion-> prepare('SELECT SUM(dos.poids) AS nbre_poids,
													(SUM(dos.poids)*50) AS gov_tax_50,
													(SUM(dos.poids)*3) AS fere_3,
													(SUM(dos.poids)*5) AS lmc_5,
													(COUNT(dos.id_dos)*250) AS occ_250,
													(COUNT(dos.id_dos)*80) AS cgea_80,
													(COUNT(dos.id_dos)*40) AS dgda_seal_40,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(
														IF(dos.poids<30,
															1,
															0)
													) AS nbre_ceec_30,
													(SUM(
														IF(dos.poids<30,
															1,
															0)
													)*125) AS ceec_30,
													SUM(
														IF(dos.poids>30,
															1,
															0)
													) AS nbre_ceec_60,
													(SUM(
														IF(dos.poids>30,
															1,
															0)
													)*250) AS ceec_60,
													d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_deb = 21
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
					$unite = number_format($reponse['nbre_poids'], 3, ',', ' ');
					$unite_2 = $reponse['nbre_poids'];

				}else if($reponse['id_deb']=='11'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else if($reponse['id_deb']=='12'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else{
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}

				if ($reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 0, ',', '.');
				}else{
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 2, ',', '.');
				}
				
				if($reponse['id_deb']=='54'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1,50%';
					$cost_2 = $cost;
				}elseif($reponse['id_deb']=='101'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1%';
					$cost_2 = $cost;
				}

				$total_cost += $cost;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">SUB-TOTAL   / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="6%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function getDetailFactureAcidImport($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT SUM(dos.poids) AS nbre_poids,
													(SUM(dos.poids)*50) AS gov_tax_50,
													(SUM(dos.poids)*3) AS fere_3,
													(SUM(dos.poids)*5) AS lmc_5,
													(COUNT(dos.id_dos)*250) AS occ_250,
													(COUNT(dos.id_dos)*80) AS cgea_80,
													(COUNT(dos.id_dos)*40) AS dgda_seal_40,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(
														IF(dos.poids<30,
															1,
															0)
													) AS nbre_ceec_30,
													(SUM(
														IF(dos.poids<30,
															1,
															0)
													)*125) AS ceec_30,
													SUM(
														IF(dos.poids>30,
															1,
															0)
													) AS nbre_ceec_60,
													(SUM(
														IF(dos.poids>30,
															1,
															0)
													)*250) AS ceec_60,
													d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids,
													det.usd AS usd_2
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if ($reponse['usd_2']=='0') {
					
					$unite = number_format($reponse['nbre_poids'], 0, ',', ' ');
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
					$unite = number_format($reponse['nbre_poids'], 3, ',', ' ');
					$unite_2 = $reponse['nbre_poids'];

				}else if($reponse['id_deb']=='11'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else if($reponse['id_deb']=='12'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else{
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}

				if ($reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 0, ',', '.');
				}else{
					$cost = $reponse['ht_usd']/$unite_2;
					$cost_2 = number_format($cost, 2, ',', '.');
				}
				
				if($reponse['id_deb']=='54'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1,50%';
					$cost_2 = $cost;
				}elseif($reponse['id_deb']=='101'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1%';
					$cost_2 = $cost;
				}

				$total_cost += $cost;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


				$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: 6.5px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="6%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.$cost_2.
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 0.5px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						</tr>
					';

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="6%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">SUB-TOTAL   / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="6%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function getDetailFactureImportSingleMMG($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;
			$sub_total_cdf = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="9%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="8%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT SUM(dos.poids) AS nbre_poids,
													(SUM(dos.poids)*50) AS gov_tax_50,
													(SUM(dos.poids)*3) AS fere_3,
													(SUM(dos.poids)*5) AS lmc_5,
													(COUNT(dos.id_dos)*250) AS occ_250,
													(COUNT(dos.id_dos)*80) AS cgea_80,
													(COUNT(dos.id_dos)*40) AS dgda_seal_40,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(
														IF(dos.poids<30,
															1,
															0)
													) AS nbre_ceec_30,
													(SUM(
														IF(dos.poids<30,
															1,
															0)
													)*125) AS ceec_30,
													SUM(
														IF(dos.poids>30,
															1,
															0)
													) AS nbre_ceec_60,
													(SUM(
														IF(dos.poids>30,
															1,
															0)
													)*250) AS ceec_60,
													IF(d.id_deb=3,
														"Redevance Logistique Terrestre SNCC (RLS)",
															IF(d.id_deb=21,
																"Frais d`Agence",
																d.nom_deb
																)
														) AS nom_deb,
													-- d.nom_deb AS nom_deb, 
													-- CONCAT(UPPER(SUBSTRING(d.nom_deb,1,1)),LOWER(SUBSTRING(d.nom_deb,2))) AS nom_deb,
													d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													-- SUM(
													-- 	IF(det.usd="1", 
													-- 		IF(det.tva="1",
													-- 			det.montant*1.16,
													-- 			det.montant
													-- 		), 
													-- 		IF(det.tva="1",
													-- 			(det.montant/dos.roe_decl)*1.16,
													-- 			(det.montant/dos.roe_decl)
													-- 		)
													-- 	)
													-- ) AS ttc_usd,
													SUM(
														IF(det.usd="0", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																	),
																det.montant/dos.roe_decl
															), 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="0", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant),
																	(det.montant*0.16)
																	),
																det.montant
															), 
															IF(det.tva="1",
																(det.montant*1.16)*dos.roe_decl,
																(det.montant)*dos.roe_decl
															)
														)
													) AS ttc_cdf,
													-- SUM(
													-- 	IF(det.usd="1", 
													-- 		IF(det.tva="1",
													-- 			det.montant*0.16,
													-- 			0
													-- 		), 
													-- 		IF(det.tva="1",
													-- 			(det.montant/dos.roe_decl)*0.16,
													-- 			0
													-- 		)
													-- 	)
													-- ) AS tva_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																IF(det.montant_tva/dos.roe_decl > 0,
																	det.montant_tva/dos.roe_decl,
																	(det.montant/dos.roe_decl)*0.016
																	),
																0
															)
														)
													) AS tva_usd,
													SUM(
														IF(d.id_t_deb=1,
															IF(det.usd="0", 
																IF(det.tva="1",
																	IF(det.montant_tva > 0,
																		det.montant_tva,
																		det.montant_tva*0.16
																		),
																	0
																), 
																IF(det.tva="1",
																	(det.montant*dos.roe_decl)*0.16,
																	0
																)
															),
															IF(det.tva="1",
																(det.montant*dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_cdf,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids,
													IF(d.id_deb=3,
														round(det.montant/(dos.roe_decl*85)),
														0
														) AS rls,
													dos.id_dos AS id_dos,
													det.pourcentage_qte AS pourcentage_qte,
													(det.montant/dos.roe_decl) AS montant_tax_usd,
													fact.font_size AS font_size
												FROM debours d, detail_facture_dossier det, dossier dos, facture_dossier fact
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
													AND det.ref_fact = fact.ref_fact
												GROUP BY d.id_deb
												ORDER BY d.rang, d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){
				$cost_2 = '';
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if (isset($reponse['pourcentage_qte'])) {
					$cost_2 = number_format($reponse['pourcentage_qte'], 2, ',', '.').'%';
					$unite = 'CIF';
				}else if ($reponse['id_deb']=='32') {
					
					$unite = 'CIF';

					if (isset($reponse['pourcentage_qte'])) {
						$cost_2 = number_format($reponse['pourcentage_qte'], 2, ',', '.').'%';
					}else{
						$cost_2 = number_format(($reponse['ht_cdf']/$this-> getDataDossiersMultipleInvoice($ref_fact)['cif_cdf'])*100, 2, ',', '.').'%';
					}

					// $cost_2 = $this-> getDataDossiersMultipleInvoice($ref_fact)['cif_cdf'];
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='96') { // DCI
					
					$unite = 'CIF+Duty';
					// $cost_2 = number_format(floor($reponse['ht_cdf']/(($this-> getDataDossiersMultipleInvoice($ref_fact)['cif_cdf'])+$this-> getMontantFactureDossierDebours2($ref_fact, 32))*100), 2, ',', '.').'%';
					$cost_2 = '10,00%';
					// $cost_2 = $this-> getDataDossiersMultipleInvoice($ref_fact)['cif_cdf'];
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='95') {
					
					$unite = 'CIF+Duty';
					$cost_2 = '1,84%';
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='38') {
					
					$unite = 'CIF';
					$cost_2 = '2,25%';
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='35') {
					
					$unite = 'CIF';
					$cost_2 = '0,457%';
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='3') {
					
					$unite = 'CIF+Duty';
					$cost_2 = $reponse['rls'];
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='29') {
					$data_dossier = $this-> getDossier($reponse['id_dos']);
					
					$unite = 'par declaration';
					// $cost_2 = $this-> getMontantTotalTypeDeboursFacture($ref_fact, 1)['montant_usd'];
					if (($reponse['ht_usd']*100)/$this-> getMontantTotalTypeDeboursFacture($ref_fact, 1)['montant_usd']>1) {
						$cost_2 = number_format(($this-> getDataAffectationDeboursClientModeleLicence($reponse['id_deb'], $data_dossier['id_cli'], $data_dossier['id_mod_lic'], $data_dossier['id_march'], $data_dossier['id_mod_trans'])['montant']), 2, ',', '.').'%';
					}else{
						$cost_2 = number_format(($reponse['ht_usd']*100)/$this-> getMontantTotalTypeDeboursFacture($ref_fact, 1)['montant_usd'], 2, ',', '.').'%';
					}
					
					$unite_2 = $reponse['nbre_poids'];

				}else if($reponse['id_deb']=='97'){
					$unite = '';
					$unite_2 = $reponse['nbre_dos'];
				}else if($id_t_deb=='1'){
					$unite = 'CIF';
					$unite_2 = $reponse['nbre_dos'];
				}else if ($reponse['id_deb']=='45') {
					
					$unite = 'Par declaration';
					$data_dossier = $this-> getDossier($reponse['id_dos']);
					$cost_2 = $reponse['ht_usd']/$this-> getDataAffectationDeboursClientModeleLicence($reponse['id_deb'], $data_dossier['id_cli'], $data_dossier['id_mod_lic'], $data_dossier['id_march'], $data_dossier['id_mod_trans'])['montant'];
					$unite_2 = $reponse['nbre_poids'];

				}else{
					$unite = 'par declaration';
					$cost_2 = '1';
					$unite_2 = $reponse['nbre_dos'];
				}

				$cost = $reponse['ht_usd']/$unite_2;
				
				$total_cost += $cost;
				// $sub_total_cdf += $reponse['ht_cdf'];
				$sub_total_cdf += $reponse['ttc_cdf'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];

				if($entree['id_t_deb']=='1'){
				$sub_total += $reponse['ht_usd'];
					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="9%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="8%">'
								.$cost_2.
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}else if($reponse['id_deb']==45){//Scelle Electronique
					$sub_total += $this-> getDataAffectationDeboursClientModeleLicence($reponse['id_deb'], $data_dossier['id_cli'], $data_dossier['id_mod_lic'], $data_dossier['id_march'], $data_dossier['id_mod_trans'])['montant'];
					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="9%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="8%">'
								.$cost_2.
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11%">'
								.number_format($this-> getDataAffectationDeboursClientModeleLicence($reponse['id_deb'], $data_dossier['id_cli'], $data_dossier['id_mod_lic'], $data_dossier['id_march'], $data_dossier['id_mod_trans'])['montant'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}else{
					$sub_total += $reponse['ht_usd'];
					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="9%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="8%">'
								.$cost_2.
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: '.$reponse['font_size'].'px; border-right: 0.5px solid black;" colspan="2" width="9%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="8%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%"></td>
					</tr>
					';
			if($entree['id_t_deb']=='1'){
				$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">Sub-total In USD &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="9%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="8%">&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-size: 8px;" width="49%">Sub total In CDF&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="9%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="8%">&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="11%">&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="11.5%">&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold; " width="11.5%">'
							.number_format($sub_total_cdf, 0, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>';
			}else{
				$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: '.$reponse['font_size'].'px;" width="49%">SUB-TOTAL / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="9%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="8%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>';
			}

			return $tbl;
		}

		public function getDetailFactureImportSingle2023($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_tva_cdf = 0;
			$total_gen = 0;
			$sub_total_cdf = 0;
			$sub_total_cdf_2 = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="9%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="8%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT SUM(dos.poids) AS nbre_poids,
													(SUM(dos.poids)*50) AS gov_tax_50,
													(SUM(dos.poids)*3) AS fere_3,
													(SUM(dos.poids)*5) AS lmc_5,
													(COUNT(dos.id_dos)*250) AS occ_250,
													(COUNT(dos.id_dos)*80) AS cgea_80,
													(COUNT(dos.id_dos)*40) AS dgda_seal_40,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(
														IF(dos.poids<30,
															1,
															0)
													) AS nbre_ceec_30,
													(SUM(
														IF(dos.poids<30,
															1,
															0)
													)*125) AS ceec_30,
													SUM(
														IF(dos.poids>30,
															1,
															0)
													) AS nbre_ceec_60,
													(SUM(
														IF(dos.poids>30,
															1,
															0)
													)*250) AS ceec_60,
													IF(d.id_deb=3,
														"Redevance Logistique Terrestre SNCC (RLS)",
															IF(d.id_deb=21,
																"Frais d`Agence",
																d.nom_deb
																)
														) AS nom_deb,
													-- d.nom_deb AS nom_deb, 
													-- CONCAT(UPPER(SUBSTRING(d.nom_deb,1,1)),LOWER(SUBSTRING(d.nom_deb,2))) AS nom_deb,
													d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													-- SUM(
													-- 	IF(det.usd="1", 
													-- 		IF(det.tva="1",
													-- 			det.montant*1.16,
													-- 			det.montant
													-- 		), 
													-- 		IF(det.tva="1",
													-- 			IF(det.montant_tva>0,
													-- 				(det.montant_tva/dos.roe_decl)*1.16,
													-- 				(det.montant/dos.roe_decl)*1.16
													-- 			),
													-- 			(det.montant/dos.roe_decl)
													-- 		)
													-- 	)
													-- ) AS ttc_usd,
													SUM(
														IF(det.usd="0", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																	),
																det.montant/dos.roe_decl
															), 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="0", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	det.montant_tva+det.montant,
																	det.montant*0.16
																	),
																det.montant
															), 
															IF(det.tva="1",
																(det.montant*dos.roe_decl)*1.16,
																(det.montant*dos.roe_decl)
															)
														)
													) AS ttc_cdf,
													-- SUM(
													-- 	IF(det.usd="1", 
													-- 		IF(det.tva="1",
													-- 			det.montant*0.16,
													-- 			0
													-- 		), 
													-- 		IF(det.tva="1",
													-- 			ROUND(((((det.montant/dos.roe_decl)*100)+((det.montant/dos.roe_decl)*det.pourcentage_qte))/det.pourcentage_qte)*0.16),
													-- 			0
													-- 		)
													-- 	)
													-- ) AS tva_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																IF(det.montant_tva/dos.roe_decl > 0,
																	det.montant_tva/dos.roe_decl,
																	(det.montant/dos.roe_decl)*0.016
																	),
																0
															)
														)
													) AS tva_usd,
													-- SUM(
													-- 	IF(d.id_t_deb=1,
													-- 		IF(det.usd="0", 
													-- 			IF(det.tva="1",
													-- 				ROUND((((det.montant*100)+(det.montant*det.pourcentage_qte))/det.pourcentage_qte)*0.16),
													-- 				0
													-- 			), 
													-- 			IF(det.tva="1",
													-- 				(det.montant*dos.roe_decl)*0.16,
													-- 				0
													-- 			)
													-- 		),
													-- 		IF(det.tva="1",
													-- 			(det.montant*dos.roe_decl)*0.16,
													-- 			0
													-- 		)
													-- 	)
													-- ) AS tva_cdf,
													SUM(
														IF(d.id_t_deb=1,
															IF(det.usd="0", 
																IF(det.tva="1",
																	IF(det.montant_tva > 0,
																		det.montant_tva,
																		det.montant_tva*0.16
																		),
																	0
																), 
																IF(det.tva="1",
																	(det.montant*dos.roe_decl)*0.16,
																	0
																)
															),
															IF(det.tva="1",
																(det.montant*dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_cdf,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids,
													IF(d.id_deb=3,
														round(det.montant/(dos.roe_decl*85)),
														0
														) AS rls,
													dos.id_dos AS id_dos,
													det.pourcentage_qte AS pourcentage_qte,
													fact.font_size AS font_size
												FROM debours d, detail_facture_dossier det, dossier dos, facture_dossier fact
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
													AND det.ref_fact = fact.ref_fact
												GROUP BY d.id_deb
												ORDER BY d.rang, d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){
				$cost_2 = '';
				$cif_split = '';
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if (isset($reponse['pourcentage_qte'])) {
					$cost_2 = number_format($reponse['pourcentage_qte'], 2, ',', '.').'%';
					$unite = 'CIF';
					$cif_split = number_format(($reponse['ht_cdf']*100)/$reponse['pourcentage_qte'], 0, ',', '.');
				}else if ($reponse['id_deb']=='32') {
					
					$unite = 'CIF';

					if (isset($reponse['pourcentage_qte'])) {
						$cost_2 = number_format($reponse['pourcentage_qte'], 2, ',', '.').'%';
					}else{
						$cost_2 = number_format(($reponse['ht_cdf']/$this-> getDataDossiersMultipleInvoice($ref_fact)['cif_cdf'])*100, 2, ',', '.').'%';
					}

					// $cost_2 = $this-> getDataDossiersMultipleInvoice($ref_fact)['cif_cdf'];
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='96') { // DCI
					
					$unite = 'CIF+Duty';
					// $cost_2 = number_format(floor($reponse['ht_cdf']/(($this-> getDataDossiersMultipleInvoice($ref_fact)['cif_cdf'])+$this-> getMontantFactureDossierDebours2($ref_fact, 32))*100), 2, ',', '.').'%';
					$cost_2 = '10,00%';
					// $cost_2 = $this-> getDataDossiersMultipleInvoice($ref_fact)['cif_cdf'];
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='95') {
					
					$unite = 'CIF+Duty';
					$cost_2 = '1,84%';
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='38') {
					
					$unite = 'CIF';
					$cost_2 = '2,25%';
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='35') {
					
					$unite = 'CIF';
					$cost_2 = '0,457%';
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='3') {
					
					$unite = 'CIF+Duty';
					$cost_2 = $reponse['rls'];
					$unite_2 = $reponse['nbre_poids'];

				}else if ($reponse['id_deb']=='29') {
					$data_dossier = $this-> getDossier($reponse['id_dos']);
					
					$unite = 'par declaration';
					// $cost_2 = $this-> getMontantTotalTypeDeboursFacture($ref_fact, 1)['montant_usd'];
					if ($data_dossier['id_cli']=='938'||$data_dossier['id_cli']=='945') {
						$cost_2 = number_format(($this-> getDataAffectationDeboursClientModeleLicence($reponse['id_deb'], $data_dossier['id_cli'], $data_dossier['id_mod_lic'], $data_dossier['id_march'], $data_dossier['id_mod_trans'])['montant']), 2, ',', '.').'%';
					}else if (($reponse['ht_usd']*100)/$this-> getMontantTotalTypeDeboursFacture($ref_fact, 1)['montant_usd']>1) {
						$cost_2 = number_format(($this-> getDataAffectationDeboursClientModeleLicence($reponse['id_deb'], $data_dossier['id_cli'], $data_dossier['id_mod_lic'], $data_dossier['id_march'], $data_dossier['id_mod_trans'])['montant']), 2, ',', '.').'%';
					}else{
						$cost_2 = number_format(($reponse['ht_usd']*100)/$this-> getMontantTotalTypeDeboursFacture($ref_fact, 1)['montant_usd'], 2, ',', '.').'%';
					}
					
					$unite_2 = $reponse['nbre_poids'];

				}else if($reponse['id_deb']=='97'){
					$unite = '';
					$unite_2 = $reponse['nbre_dos'];
				}else if($id_t_deb=='1'){
					$unite = 'CIF';
					$unite_2 = $reponse['nbre_dos'];
				}else if ($reponse['id_deb']=='45') {
					
					$unite = 'Par declaration';
					$data_dossier = $this-> getDossier($reponse['id_dos']);
					$cost_2 = $reponse['ht_usd']/$this-> getDataAffectationDeboursClientModeleLicence($reponse['id_deb'], $data_dossier['id_cli'], $data_dossier['id_mod_lic'], $data_dossier['id_march'], $data_dossier['id_mod_trans'])['montant'];
					$unite_2 = $reponse['nbre_poids'];

				}else{
					$unite = 'par declaration';
					$cost_2 = '1';
					$unite_2 = $reponse['nbre_dos'];
				}

				$cost = $reponse['ht_usd']/$unite_2;
				
				$total_cost += $cost;
				$sub_total_cdf += $reponse['ht_cdf'];
				$sub_total_cdf_2 += $reponse['ttc_cdf'];
				$total_tva += $reponse['tva_usd'];
				$total_tva_cdf += $reponse['tva_cdf'];
				$total_gen += $reponse['ttc_usd'];

				if($entree['id_t_deb']=='1'){
				$sub_total += $reponse['ht_usd'];
					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" colspan="2" width="40%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="9%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="9%">'
								.$cif_split.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="8%">'
								.$cost_2.
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11%">'
								.number_format($reponse['ht_cdf'], 0, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['tva_cdf'], 0, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['ttc_cdf'], 0, ',', '.').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}else if($reponse['id_deb']==45){//Scelle Electronique
					$sub_total += $this-> getDataAffectationDeboursClientModeleLicence($reponse['id_deb'], $data_dossier['id_cli'], $data_dossier['id_mod_lic'], $data_dossier['id_march'], $data_dossier['id_mod_trans'])['montant'];
					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="9%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="8%">'
								.$cost_2.
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11%">'
								.number_format($this-> getDataAffectationDeboursClientModeleLicence($reponse['id_deb'], $data_dossier['id_cli'], $data_dossier['id_mod_lic'], $data_dossier['id_march'], $data_dossier['id_mod_trans'])['montant'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}else{
					$sub_total += $reponse['ht_usd'];
					$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" colspan="2" width="49%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="9%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="8%">'
								.$cost_2.
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
						</tr>
					';
				}

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: '.$reponse['font_size'].'px; border-right: 0.5px solid black;" colspan="2" width="9%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="8%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: '.$reponse['font_size'].'px;" width="11.5%"></td>
					</tr>
					';
			if($entree['id_t_deb']=='1'){
				$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-size: 8px;" width="49%">Sub total In CDF&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="9%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="8%">&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="11%">'
							.number_format($sub_total_cdf, 0, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_tva_cdf, 0, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold; " width="11.5%">'
							.number_format($sub_total_cdf_2, 0, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">Sub-total In USD &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="9%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="8%">&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>';
			}else{
				$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: '.$reponse['font_size'].'px;" width="49%">SUB-TOTAL / SOUS-TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="9%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="8%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>';
			}

			return $tbl;
		}

		public function getDetailFactureExportMultipleBloc($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="47%"></td>
						<td style="text-align: center; border-right: 0.5px solid black;" colspan="2" width="8%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="11.5%"></td>
					</tr>
					';
			$requete = $connexion-> prepare('SELECT SUM(dos.poids) AS nbre_poids,
													(SUM(dos.poids)*50) AS gov_tax_50,
													(SUM(dos.poids)*3) AS fere_3,
													(SUM(dos.poids)*5) AS lmc_5,
													(COUNT(dos.id_dos)*250) AS occ_250,
													(COUNT(dos.id_dos)*80) AS cgea_80,
													(COUNT(dos.id_dos)*40) AS dgda_seal_40,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(
														IF(dos.poids<30,
															1,
															0)
													) AS nbre_ceec_30,
													(SUM(
														IF(dos.poids<30,
															1,
															0)
													)*125) AS ceec_30,
													SUM(
														IF(dos.poids>30,
															1,
															0)
													) AS nbre_ceec_60,
													(SUM(
														IF(dos.poids>30,
															1,
															0)
													)*250) AS ceec_60,
													d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){
				if($reponse['tva'] == '0'){
					$tva = '0';
					$ttc = $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
				}

				if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
					$unite = number_format($reponse['nbre_poids'], 2, ',', ' ');
					$unite_2 = $reponse['nbre_poids'];

				}else if($reponse['id_deb']=='11'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else if($reponse['id_deb']=='12'){
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}else{
					$unite = $reponse['nbre_dos'];
					$unite_2 = $reponse['nbre_dos'];
				}

				$cost = round($reponse['ht_usd']/$unite_2, 2);
				$cost_2 = number_format($cost, 2, ',', '.');
				
				// if($reponse['id_deb']=='54'){
				// 	$unite = number_format($this-> getMontantFactureTypeDebours($ref_fact, '1'), 2, ',', '.');
				// 	$cost = '1,50%';
				// 	$cost_2 = $cost;
				// }
				if($reponse['id_deb']=='54'){
					$unite = number_format($this-> getMontantFactureTypeDeboursSansFinancialCost($ref_fact, '1'), 2, ',', '.');
					$cost = '1,50%';
					$cost_2 = $cost;
				}

				$total_cost += $cost;
				$sub_total += $reponse['ht_usd'];
				$total_tva += $reponse['tva_usd'];
				$total_gen += $reponse['ttc_usd'];


				$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: 6.5px;" colspan="2" width="47%">&nbsp;&nbsp;'
								.$reponse['nom_deb'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="8%">'
								.$unite.
							'
							</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.$cost_2.
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="11%">'
								.number_format($reponse['ht_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['tva_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: 6.5px;" width="11.5%">'
								.number_format($reponse['ttc_usd'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
						</tr>
					';

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="47%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="8%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: center; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: center; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192); font-size: 8px;" width="47%">TOTAL CLEARING COST IN USD  / COUT TOTAL EN USD &nbsp;&nbsp;
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="8%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold; " width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: center; 8px;" width="47%"></td>
						<td style="text-align: center; 8px;" width="8%">
						</td>
						<td style="" width="11%"></td>
						<td style="" width="11%"></td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; " width="23%">CDF &nbsp;&nbsp;'
							.number_format($total_gen*$this-> getTauxFacture($ref_fact)['roe_decl'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function getDetailNoteDebitKAMOAImport($ref_note){
			include('connexion.php');
			$entree['ref_note'] = $ref_note;

			$total_cost = 0;
			$montant_ht = 0;
			$tva = 0;
			$montant_ttc = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="50%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="10%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="15%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="10%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="15%"></td>
					</tr>
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="50%">&nbsp;&nbsp;'.$this-> getNote($entree['ref_note'])['libelle'].'</td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="10%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="15%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="10%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="15%"></td>
					</tr>
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black;" colspan="2" width="50%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="10%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="15%"></td>
						<td style="text-align: right; border-right: 0.5px solid black;" width="10%"></td>
						<td style="text-align: right; border-right: 1px solid black;" width="15%"></td>
					</tr>
					';
			$requete = $connexion-> prepare("SELECT CONCAT(dos.ref_dos, '(PO : ',dos.po_ref,')') AS ref_dos,
													det.montant AS montant_ht,
													IF(det.tva='1',
														det.montant*0.16,
														0
													) AS tva,
													IF(det.tva='1',
														det.montant*1.16,
														det.montant
													) AS montant_ttc
												FROM dossier dos, detail_note_debit det, depense_dossier depdos
												WHERE dos.id_dos = depdos.id_dos
													AND depdos.id_dep_dos = det.id_dep_dos
													AND det.ref_note = ?");
			$requete-> execute(array($entree['ref_note']));
			while($reponse = $requete-> fetch()){
				
				$montant_ht += $reponse['montant_ht'];
				$tva += $reponse['tva'];
				$montant_ttc += $reponse['montant_ttc'];


				$tbl .= '
						<tr>
							<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; font-size: 6.5px;" colspan="2" width="50%">&nbsp;&nbsp;'
								.$reponse['ref_dos'].
							'</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="10%">1</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="15%">'
								.number_format($reponse['montant_ht'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: center; border-right: 0.5px solid black; font-size: 6.5px;" width="10%">'
								.number_format($reponse['tva'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
							<td style="text-align: right; border-right: 1px solid black; font-size: 6.5px;" width="15%">'
								.number_format($reponse['montant_ttc'], 2, ',', '.').
							'&nbsp;&nbsp;</td>
						</tr>
					';

			}$requete-> closeCursor();
			$tbl .='
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="50%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="10%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="15%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="10%"></td>
						<td style="text-align: center; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="15%"></td>
					</tr>
					';
			$tbl .= '
					<tr>
						<td style="text-align: center; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192); font-size: 8px;" width="50%">TOTAL &nbsp;&nbsp;
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="10%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="15%">'
							.number_format($montant_ht, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold;" width="10%">'
							.number_format($tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold; " width="15%">'
							.number_format($montant_ttc, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr><td width="100%"></td></tr>
					<tr>
						<td width="60%"></td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="25%">Total excl. TVA&nbsp;&nbsp;</td>
						<td style="text-align: right; border: 1px solid black; font-weight: bold; " width="15%">'
							.number_format($montant_ht, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td width="60%"></td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="25%">TVA 16%&nbsp;&nbsp;</td>
						<td style="text-align: right; border: 1px solid black; font-weight: bold; " width="15%">'
							.number_format($tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td width="60%"></td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="25%">Grand Total&nbsp;&nbsp;</td>
						<td style="text-align: right; border: 1px solid black; font-weight: bold; " width="15%">'
							.number_format($montant_ttc, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>';

			return $tbl;
		}

		public function getTotalFactureExportSingle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					
					';

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													dos.roe_decl AS roe_decl,
													SUM(
														IF(d.id_deb=1 OR d.id_deb=2 OR d.id_deb=3 OR d.id_deb=4 OR d.id_deb=5 OR d.id_deb=6 OR d.id_deb=7 OR d.id_deb=8,
																IF(det.usd=1,
																	det.montant/dos.poids,
																	(det.montant/dos.roe_decl)/dos.poids
																),
															IF(d.id_deb=11 AND dos.poids<30,
																IF(det.usd=1,
																	det.montant/1,
																	(det.montant/dos.roe_decl)/1
																),
																IF(d.id_deb=12 AND dos.poids>=30,
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	),
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	)
																	)
																)
														)
													) AS total_cost,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													SUM(
														IF(det.usd="1" AND det.tva="1",
															det.montant*0.012,
															0
														)
													) AS arsp,
													SUM(
														IF(det.usd="1" AND det.tva="1",
															det.montant,
															0
														)
													) AS base_arsp,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids,
													fact.id_cli AS id_cli
												FROM debours d, detail_facture_dossier det, dossier dos, facture_dossier fact
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND det.ref_fact = fact.ref_fact
												GROUP BY det.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			// while($reponse = $requete-> fetch()){
			// 	if($reponse['tva'] == '0'){
			// 		$tva = '0';
			// 		$ttc = $reponse['ht_usd'];
			// 	}else{
			// 		$tva = round(($reponse['ht_usd'] * 0.16), 2);
			// 		$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
			// 	}

			// 	if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
			// 		$unite = number_format($reponse['poids'], 2, ',', ' ');

			// 	}else if($reponse['id_deb']=='11' && $reponse['poids']<30){
			// 		$unite = 1;
			// 	}else if($reponse['id_deb']=='12' && $reponse['poids']>30){
			// 		$unite = 1;
			// 	}else{
			// 		$unite = 1;
			// 	}

			// 	$cost = $reponse['ht_usd']/$unite;

			// 	$total_cost += $cost;
			// 	$sub_total += $reponse['ht_usd'];
			// 	$total_tva += $reponse['tva_usd'];
			// 	$total_gen += $reponse['ttc_usd'];

				$total_cost = '';//$reponse['total_cost'];
				$sub_total = $reponse['ht_usd'];
				$total_tva = $reponse['tva_usd'];
				$total_gen = $reponse['ttc_usd'];

			if($reponse['id_cli']!='946' && $reponse['id_cli']!='904'){
				$tbl .= '<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black; border-top: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-top: 0.5px solid black;" colspan="2" width="5.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-top: 0.5px solid black;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
					</tr>
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border-left: 0.5px solid black; font-weight: bold; font-size: 8px;" width="49%">TOTAL CLEARING COST IN USD / COUT TOTAL EN USD &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-left: 0.5px solid black; font-weight: bold; font-size: 8px;" width="5.5%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; font-weight: bold;" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; font-weight: bold; " width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="5.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					<tr>
						<td style="text-align: left; font-size: 8px;" width="49%"></td>
						<td style="text-align: center;" colspan="2" width="5.5%"></td>
						<td style="text-align: right; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border: 1px solid black; font-size: 8px; font-weight: bold;" width="23%">CDF &nbsp;&nbsp;'
							// .number_format($total_gen*$reponse['roe_decl'], 2, ',', '.').
							.number_format($total_gen*$this-> getTauxFacture($entree['ref_fact'])['roe_decl'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					';

			}else {
				$tbl .= '
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="49%">TOTAL CLEARING COST IN USD / COUT TOTAL EN USD&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="6%">
						</td>
						<td style="text-align: center; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td width="100%"></td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-size: 8px;" width="66%">ARSP Tax (1.2%  on the Agency Fees without TVA )&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black;" width="11%">'
							.number_format($reponse['base_arsp'], 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border: 0.5px solid black;" width="11.5%">1.2% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td style="text-align: right; border: 0.5px solid black; " width="11.5%">'
							.number_format($reponse['arsp'], 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td width="100%"></td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; background-color: rgb(220,220,220); font-size: 8px;" width="88.5%">NET PAYABLE AMOUNT EN USD&nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;  background-color: rgb(220,220,220);" width="11.5%">'
							.number_format($total_gen-$reponse['arsp'], 2, ',', '.').
						'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td width="100%"></td>
					</tr>
					<tr>
						<td style="text-align: left; font-size: 8px;" width="49%"></td>
						<td style="text-align: center;" colspan="2" width="5.5%"></td>
						<td style="text-align: right; font-size: 8px;" width="11%"></td>
						<td style="text-align: right; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border: 1px solid black; font-size: 8px; font-weight: bold;" width="23%">CDF &nbsp;&nbsp;'
							// .number_format($total_gen*$reponse['roe_decl'], 2, ',', '.').
							// .number_format(($total_gen-$reponse['arsp'])*$this-> getTauxFacture($entree['ref_fact'])['roe_decl'], 2, ',', '.').
							.number_format(($total_gen-$reponse['arsp'])*$this-> getTauxFacture($entree['ref_fact'])['roe_decl'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					';

			}

			
			return $tbl;
		}

		public function getTotalFactureMMGExport($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black; border-top: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-top: 0.5px solid black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
					</tr>
					';

			$requete = $connexion-> prepare('SELECT SUM(
														IF(det.usd="1", 
															det.montant, 
															(det.montant/dos.roe_decl)
														)
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																ROUND(((((det.montant/dos.roe_decl)*100)+((det.montant/dos.roe_decl)*det.pourcentage_qte))/det.pourcentage_qte)*0.16)+(det.montant/dos.roe_decl),
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																ROUND(((((det.montant/dos.roe_decl)*100)+((det.montant/dos.roe_decl)*det.pourcentage_qte))/det.pourcentage_qte)*0.16)+(det.montant/dos.roe_decl),
																0
															)
														)
													) AS tva_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY det.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
				$total_cost = '';//$reponse['total_cost'];
				$sub_total = $reponse['ht_usd'];
				$total_tva = $reponse['tva_usd'];
				$total_gen = $reponse['ttc_usd'];

			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border-left: 0.5px solid black; font-weight: bold; font-size: 8px;" width="49%">TOTAL CLEARING COST IN USD / COUT TOTAL EN USD &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-left: 0.5px solid black; font-weight: bold; font-size: 8px;" width="5%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; font-weight: bold; " width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					<tr>
						<td style="text-align: left; font-size: 8px;" width="49%"></td>
						<td style="text-align: center;" colspan="2" width="5%"></td>
						<td style="text-align: right; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border: 1px solid black; font-size: 8px; font-weight: bold;" width="23%">CDF &nbsp;&nbsp;'
							// .number_format($total_gen*$reponse['roe_decl'], 2, ',', '.').
							.number_format($total_gen*$this-> getTauxFacture($entree['ref_fact'])['roe_decl'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					';

			return $tbl;
		}

		public function getTotalFactureImportSingle2023($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '';

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													dos.roe_decl AS roe_decl,
													SUM(
														IF(d.id_deb=1 OR d.id_deb=2 OR d.id_deb=3 OR d.id_deb=4 OR d.id_deb=5 OR d.id_deb=6 OR d.id_deb=7 OR d.id_deb=8,
																IF(det.usd=1,
																	det.montant/dos.poids,
																	(det.montant/dos.roe_decl)/dos.poids
																),
															IF(d.id_deb=11 AND dos.poids<30,
																IF(det.usd=1,
																	det.montant/1,
																	(det.montant/dos.roe_decl)/1
																),
																IF(d.id_deb=12 AND dos.poids>=30,
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	),
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	)
																	)
																)
														)
													) AS total_cost,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant, 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)
															)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl),
																	(det.montant/dos.roe_decl)*1.16
																),
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															0
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY det.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			// while($reponse = $requete-> fetch()){
			// 	if($reponse['tva'] == '0'){
			// 		$tva = '0';
			// 		$ttc = $reponse['ht_usd'];
			// 	}else{
			// 		$tva = round(($reponse['ht_usd'] * 0.16), 2);
			// 		$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
			// 	}

			// 	if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
			// 		$unite = number_format($reponse['poids'], 2, ',', ' ');

			// 	}else if($reponse['id_deb']=='11' && $reponse['poids']<30){
			// 		$unite = 1;
			// 	}else if($reponse['id_deb']=='12' && $reponse['poids']>30){
			// 		$unite = 1;
			// 	}else{
			// 		$unite = 1;
			// 	}

			// 	$cost = $reponse['ht_usd']/$unite;

			// 	$total_cost += $cost;
			// 	$sub_total += $reponse['ht_usd'];
			// 	$total_tva += $reponse['tva_usd'];
			// 	$total_gen += $reponse['ttc_usd'];

				$total_cost = '';//$reponse['total_cost'];
				$sub_total = $reponse['ht_usd'];
				$total_tva = $reponse['tva_usd'];
				$total_gen = $reponse['ttc_usd'];

			$tbl .= '
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%">Total excl. TVA &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> TVA 16% &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; font-weight: bold; background-color: rgb(220,220,220);" width="23%">Grand Total &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; background-color: rgb(220,220,220);" width="11.5%">$ '
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> Equivalent en CDF &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_gen*$reponse['roe_decl'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					';

			return $tbl;
		}

		public function getTotalFactureGroup($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '';

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													dos.roe_decl AS roe_decl,
													SUM(
														IF(d.id_deb=1 OR d.id_deb=2 OR d.id_deb=3 OR d.id_deb=4 OR d.id_deb=5 OR d.id_deb=6 OR d.id_deb=7 OR d.id_deb=8,
																IF(det.usd=1,
																	det.montant/dos.poids,
																	(det.montant/dos.roe_decl)/dos.poids
																),
															IF(d.id_deb=11 AND dos.poids<30,
																IF(det.usd=1,
																	det.montant/1,
																	(det.montant/dos.roe_decl)/1
																),
																IF(d.id_deb=12 AND dos.poids>=30,
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	),
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	)
																	)
																)
														)
													) AS total_cost,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant, 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)
															)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl),
																	(det.montant/dos.roe_decl)*1.16
																),
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															0
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY det.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			// while($reponse = $requete-> fetch()){
			// 	if($reponse['tva'] == '0'){
			// 		$tva = '0';
			// 		$ttc = $reponse['ht_usd'];
			// 	}else{
			// 		$tva = round(($reponse['ht_usd'] * 0.16), 2);
			// 		$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
			// 	}

			// 	if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
			// 		$unite = number_format($reponse['poids'], 2, ',', ' ');

			// 	}else if($reponse['id_deb']=='11' && $reponse['poids']<30){
			// 		$unite = 1;
			// 	}else if($reponse['id_deb']=='12' && $reponse['poids']>30){
			// 		$unite = 1;
			// 	}else{
			// 		$unite = 1;
			// 	}

			// 	$cost = $reponse['ht_usd']/$unite;

			// 	$total_cost += $cost;
			// 	$sub_total += $reponse['ht_usd'];
			// 	$total_tva += $reponse['tva_usd'];
			// 	$total_gen += $reponse['ttc_usd'];

				$total_cost = '';//$reponse['total_cost'];
				$sub_total = $reponse['ht_usd'];
				$total_tva = $reponse['tva_usd'];
				$total_gen = $reponse['ttc_usd'];

			$tbl .= '
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%">Total excl. TVA &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> TVA 16% &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; font-weight: bold; background-color: rgb(220,220,220);" width="23%">Grand Total &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; background-color: rgb(220,220,220);" width="11.5%">$ '
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> Equivalent en CDF &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_gen*$this-> getFactureGlobale($ref_fact)['taux'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					';

			return $tbl;
		}

		public function getTotalFactureService($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '';

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													dos.roe_decl AS roe_decl,
													SUM(
														IF(d.id_deb=1 OR d.id_deb=2 OR d.id_deb=3 OR d.id_deb=4 OR d.id_deb=5 OR d.id_deb=6 OR d.id_deb=7 OR d.id_deb=8,
																IF(det.usd=1,
																	det.montant/dos.poids,
																	(det.montant/dos.roe_decl)/dos.poids
																),
															IF(d.id_deb=11 AND dos.poids<30,
																IF(det.usd=1,
																	det.montant/1,
																	(det.montant/dos.roe_decl)/1
																),
																IF(d.id_deb=12 AND dos.poids>=30,
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	),
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	)
																	)
																)
														)
													) AS total_cost,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant, 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)
															)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16*det.unite,
																det.montant*det.unite
															), 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl)*det.unite,
																	(det.montant/dos.roe_decl)*1.16*det.unite
																),
																(det.montant/dos.roe_decl)*det.unite
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															0
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY det.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			// while($reponse = $requete-> fetch()){
			// 	if($reponse['tva'] == '0'){
			// 		$tva = '0';
			// 		$ttc = $reponse['ht_usd'];
			// 	}else{
			// 		$tva = round(($reponse['ht_usd'] * 0.16), 2);
			// 		$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
			// 	}

			// 	if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
			// 		$unite = number_format($reponse['poids'], 2, ',', ' ');

			// 	}else if($reponse['id_deb']=='11' && $reponse['poids']<30){
			// 		$unite = 1;
			// 	}else if($reponse['id_deb']=='12' && $reponse['poids']>30){
			// 		$unite = 1;
			// 	}else{
			// 		$unite = 1;
			// 	}

			// 	$cost = $reponse['ht_usd']/$unite;

			// 	$total_cost += $cost;
			// 	$sub_total += $reponse['ht_usd'];
			// 	$total_tva += $reponse['tva_usd'];
			// 	$total_gen += $reponse['ttc_usd'];

				$total_cost = '';//$reponse['total_cost'];
				$sub_total = $reponse['ht_usd'];
				$total_tva = $reponse['tva_usd'];
				$total_gen = $reponse['ttc_usd'];

			$tbl .= '
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%">Total excl. TVA &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> TVA 16% &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; font-weight: bold; background-color: rgb(220,220,220);" width="23%">Grand Total &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; background-color: rgb(220,220,220);" width="11.5%">$ '
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> Equivalent en CDF &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_gen*$this-> getFactureGlobale($ref_fact)['taux'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					';

			return $tbl;
		}

		public function getTotalFactureImportSingleExcluDuty1($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '';

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													dos.roe_decl AS roe_decl,
													SUM(
														IF(d.id_deb=1 OR d.id_deb=2 OR d.id_deb=3 OR d.id_deb=4 OR d.id_deb=5 OR d.id_deb=6 OR d.id_deb=7 OR d.id_deb=8,
																IF(det.usd=1,
																	det.montant/dos.poids,
																	(det.montant/dos.roe_decl)/dos.poids
																),
															IF(d.id_deb=11 AND dos.poids<30,
																IF(det.usd=1,
																	det.montant/1,
																	(det.montant/dos.roe_decl)/1
																),
																IF(d.id_deb=12 AND dos.poids>=30,
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	),
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	)
																	)
																)
														)
													) AS total_cost,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = 1
													AND det.id_dos = dos.id_dos
												GROUP BY det.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			// while($reponse = $requete-> fetch()){
			// 	if($reponse['tva'] == '0'){
			// 		$tva = '0';
			// 		$ttc = $reponse['ht_usd'];
			// 	}else{
			// 		$tva = round(($reponse['ht_usd'] * 0.16), 2);
			// 		$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
			// 	}

			// 	if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
			// 		$unite = number_format($reponse['poids'], 2, ',', ' ');

			// 	}else if($reponse['id_deb']=='11' && $reponse['poids']<30){
			// 		$unite = 1;
			// 	}else if($reponse['id_deb']=='12' && $reponse['poids']>30){
			// 		$unite = 1;
			// 	}else{
			// 		$unite = 1;
			// 	}

			// 	$cost = $reponse['ht_usd']/$unite;

			// 	$total_cost += $cost;
			// 	$sub_total += $reponse['ht_usd'];
			// 	$total_tva += $reponse['tva_usd'];
			// 	$total_gen += $reponse['ttc_usd'];

				$total_cost = '';//$reponse['total_cost'];
				$sub_total = $reponse['ht_usd'];
				$total_tva = $reponse['tva_usd'];
				$total_gen = $reponse['ttc_usd'];

			$tbl .= '
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%">Total excl. TVA &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> TVA 16% &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; font-weight: bold; background-color: rgb(220,220,220);" width="23%">Grand Total &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; background-color: rgb(220,220,220);" width="11.5%">$ '
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> Equivalent en CDF &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_gen*$reponse['roe_decl'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					';

			return $tbl;
		}

		public function getTotalFactureImportSingleExcluDuty2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '';

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													dos.roe_decl AS roe_decl,
													SUM(
														IF(d.id_deb=1 OR d.id_deb=2 OR d.id_deb=3 OR d.id_deb=4 OR d.id_deb=5 OR d.id_deb=6 OR d.id_deb=7 OR d.id_deb=8,
																IF(det.usd=1,
																	det.montant/dos.poids,
																	(det.montant/dos.roe_decl)/dos.poids
																),
															IF(d.id_deb=11 AND dos.poids<30,
																IF(det.usd=1,
																	det.montant/1,
																	(det.montant/dos.roe_decl)/1
																),
																IF(d.id_deb=12 AND dos.poids>=30,
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	),
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	)
																	)
																)
														)
													) AS total_cost,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb <> 1
													AND det.id_dos = dos.id_dos
												GROUP BY det.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			// while($reponse = $requete-> fetch()){
			// 	if($reponse['tva'] == '0'){
			// 		$tva = '0';
			// 		$ttc = $reponse['ht_usd'];
			// 	}else{
			// 		$tva = round(($reponse['ht_usd'] * 0.16), 2);
			// 		$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
			// 	}

			// 	if ($reponse['id_deb']=='1' || $reponse['id_deb']=='2' || $reponse['id_deb']=='3' || $reponse['id_deb']=='4' || $reponse['id_deb']=='5' || $reponse['id_deb']=='6' || $reponse['id_deb']=='7' || $reponse['id_deb']=='8') {
					
			// 		$unite = number_format($reponse['poids'], 2, ',', ' ');

			// 	}else if($reponse['id_deb']=='11' && $reponse['poids']<30){
			// 		$unite = 1;
			// 	}else if($reponse['id_deb']=='12' && $reponse['poids']>30){
			// 		$unite = 1;
			// 	}else{
			// 		$unite = 1;
			// 	}

			// 	$cost = $reponse['ht_usd']/$unite;

			// 	$total_cost += $cost;
			// 	$sub_total += $reponse['ht_usd'];
			// 	$total_tva += $reponse['tva_usd'];
			// 	$total_gen += $reponse['ttc_usd'];

				$total_cost = '';//$reponse['total_cost'];
				$sub_total = $reponse['ht_usd'];
				$total_tva = $reponse['tva_usd'];
				$total_gen = $reponse['ttc_usd'];

			$tbl .= '
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%">Total excl. TVA &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> TVA 16% &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">$ '
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; font-weight: bold; background-color: rgb(220,220,220);" width="23%">Grand Total &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 10px; background-color: rgb(220,220,220);" width="11.5%">$ '
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold; font-size: 8px;" width="23%"> Equivalent en CDF &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_gen*$reponse['roe_decl'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					';

			return $tbl;
		}

		public function getTotalFactureExportBlock($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$total_cost = 0;
			$sub_total = 0;
			$total_tva = 0;
			$total_gen = 0;

			$unite = 0;
			$cost = 0;

			$tbl = '
					<tr>
						<td style="text-align: left; font-weight: bold; border-left: 1px solid black; border-right: 0.5px solid black; border-top: 0.5px solid black;" colspan="2" width="49%"></td>
						<td style="text-align: center; border-right: 0.5px solid black; border-top: 0.5px solid black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-top: 0.5px solid black;" width="11.5%"></td>
					</tr>
					';

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb, d.id_deb AS id_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													dos.roe_decl AS roe_decl,
													SUM(
														IF(d.id_deb=1 OR d.id_deb=2 OR d.id_deb=3 OR d.id_deb=4 OR d.id_deb=5 OR d.id_deb=6 OR d.id_deb=7 OR d.id_deb=8,
																IF(det.usd=1,
																	det.montant/dos.poids,
																	(det.montant/dos.roe_decl)/dos.poids
																),
															IF(d.id_deb=11 AND dos.poids<30,
																IF(det.usd=1,
																	det.montant/1,
																	(det.montant/dos.roe_decl)/1
																),
																IF(d.id_deb=12 AND dos.poids>=30,
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	),
																	IF(det.usd=1,
																		det.montant/1,
																		(det.montant/dos.roe_decl)/1
																	)
																	)
																)
														)
													) AS total_cost,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*1.16,
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,
													SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*0.16,
																0
															), 
															IF(det.tva="1",
																(det.montant/dos.roe_decl)*0.16,
																0
															)
														)
													) AS tva_usd,
													IF(det.detail IS NOT NULL, 
														CONCAT(": ", det.detail),
														""
													) AS detail,
													det.unite AS unite,
													COUNT(DISTINCT(dos.ref_decl)) AS qte,
													dos.poids AS poids
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb <> 1
													AND det.id_dos = dos.id_dos
												GROUP BY det.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
				$total_cost = '';//$reponse['total_cost'];
				$sub_total = $reponse['ht_usd'];
				$total_tva = $reponse['tva_usd'];
				$total_gen = $reponse['ttc_usd'];

			$tbl .= '
					<tr>
						<td style="text-align: right; border-right: 0.5px solid black; border-left: 0.5px solid black; font-weight: bold; font-size: 8px;" width="49%">TOTAL CLEARING COST IN USD / COUT TOTAL EN USD &nbsp;&nbsp;
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-left: 0.5px solid black; font-weight: bold; font-size: 8px;" width="5%">
						</td>
						<td style="text-align: center; border-right: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_cost, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($sub_total, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: center; border-right: 0.5px solid black; font-weight: bold;" width="11.5%">'
							.number_format($total_tva, 2, ',', '.').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; font-weight: bold; " width="11.5%">'
							.number_format($total_gen, 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: left; border-left: 1px solid black; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="49%"></td>
						<td style="text-align: center; border-bottom: 0.5px solid black; font-size: 7px; border-right: 0.5px solid black;" colspan="2" width="5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-size: 7px;" width="11.5%"></td>
					</tr>
					<tr>
						<td style="text-align: left; font-size: 8px;" width="49%"></td>
						<td style="text-align: center;" colspan="2" width="5%"></td>
						<td style="text-align: center; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; font-size: 8px;" width="11.5%"></td>
						<td style="text-align: right; border: 1px solid black; font-size: 8px; font-weight: bold;" width="23%">CDF &nbsp;&nbsp;'
							.number_format($total_gen*$reponse['roe_decl'], 2, ',', '.').
						'&nbsp;&nbsp;</td>
					</tr>
					';

			return $tbl;
		}

		public function getTotalDeboursFacturePartielle($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

			}

				$tbl .= '
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192); font-size: 8px;" width="10%">
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192); font-size: 8px;" width="4%">
						</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192);" width="25%">'
							.number_format($sommeHT, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px solid black; border-bottom: 0.5px solid black; font-weight: bold; background-color: rgb(192,192,192);" width="10%">'
							.number_format($sommeTVA, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px solid black; font-weight: bold;  background-color: rgb(192,192,192);" width="11%">'
							.number_format($sommeTTC, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
					
						';
			return $tbl;
		}

		public function getTotalAllDeboursFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			//$entree['id_t_deb'] = $id_t_deb;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										det.tva AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb');

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

			}

				$tbl .= '
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; font-size: 7px;" width="25%">'
							.number_format($sommeHT, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 0.5px dotted black; border-bottom: 0.5px dotted black; font-weight: bold; font-size: 7px;" width="15%">'
							.number_format($sommeTVA, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						<td style="text-align: right; border-right: 1px solid black; border-bottom: 0.5px dotted black; font-weight: bold; font-size: 7px;" width="20%">'
							.number_format($sommeTTC, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
					
						';
			return $tbl;
		}

		public function getNombreFactureDossierEnAttenteValidation($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '0'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureDossierEnAttenteEnvoie($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.date_mail IS NULL
													AND fd.validation = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureDossierEnvoyee($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.date_mail IS NOT NULL
													AND fd.ref_paie IS NULL
													AND fd.date_paie IS NULL
													AND fd.validation = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreFactureDossierPayees($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.date_mail IS NOT NULL
													AND fd.ref_paie IS NOT NULL
													AND fd.date_paie IS NOT NULL
													AND fd.validation = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function afficherFactureDossierEnAttenteValidation($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_pag,
													mf.view_page AS view_page,
													mf.excel AS excel
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.validation = '0'
													$sqlClient
												ORDER BY fd.date_fact ASC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>
			                ';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn btn-xs bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							ValidÃ©e En attente d\'Ãªtre Transmis
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validÃ©e et Transmise
							</span>';
					$btn ='';
				}

				$btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';


			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
					<button class="btn btn-xs bg-primary square-btn-adjust" onclick="window.open('<?php echo $reponse['view_page'];?>?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="View invoice">
	                    <i class="fas fa-eye"></i> 
	                </button>
					<button class="btn btn-xs bg-success square-btn-adjust" onclick="window.location.replace('<?php echo $reponse['excel'];?>?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="Export Excel File">
	                    <i class="fas fa-file-excel"></i> 
	                </button>
					<!-- <button class="btn btn-xs bg-warning square-btn-adjust" onclick="window.location.replace('editFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact']; ?>&id_mod_lic_fact=<?php echo $reponse['id_mod_lic']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>','pop1','width=80,height=80');" title="Modifier la facture">
	                    <i class="fa fa-edit"></i> 
	                </button> -->
					<button class="btn btn-xs bg-purple square-btn-adjust" onclick="modal_send_invoice('<?php echo $reponse['ref_fact'];?>');" title="Send Email">
	                    <i class="fas fa-envelope"></i> 
	                </button>
					<?php 
						echo 
						$btn;
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function getInvoicePendingValidation($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_page,
													mf.view_page AS view_page,
													mf.excel AS excel
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.validation = '0'
													AND fd.id_cli = ?
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr style="">
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$compteur.'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['ref_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['date_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'].'
								</td>
								<td class="" style="text-align: right;" class="bg bg-dark">
									'.number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ').'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['nom_util'].'
								</td>
								<td style="text-align: center;">
									<button class="btn btn-xs bg-info square-btn-adjust" onclick="window.open(\''.$reponse['view_page'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="View invoice">
					                    <i class="fas fa-eye"></i> 
					                </button>
									<button class="btn btn-xs bg-success square-btn-adjust" onclick="window.location.replace(\''.$reponse['excel'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Export Excel File">
					                    <i class="fas fa-file-excel"></i> 
					                </button>
									<button class="btn btn-xs bg-warning square-btn-adjust" onclick="editerFacture(\''.$reponse['ref_fact'].'\', \''.$reponse['edit_page'].'\');" title="Edit">
					                    <i class="fas fa-edit"></i> 
					                </button>
									<button class="btn btn-xs bg-primary square-btn-adjust" onclick="validerFacture(\''.$reponse['ref_fact'].'\');" title="Validate">
					                    <i class="fas fa-check"></i> 
					                </button>
									<button class="btn btn-xs bg-danger square-btn-adjust" onclick="supprimerFacture(\''.$reponse['ref_fact'].'\');" title="Delete">
					                    <i class="fas fa-times"></i> 
					                </button>
								</td>
							</tr>';
			}$requete-> closeCursor();
			return $tableau;

		}

		public function client_note_debit($id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;

			$tableau = '';

			$row = array();

			$requete = $connexion-> prepare("SELECT cl.id_cli AS id_cli,
													cl.nom_cli AS nom_cli,
													cl.code_cli AS code_cli,
													CONCAT('<a href=\"listerNoteDebit.php?id_cli=',cl.id_cli,'&id_mod_lic=',aff.id_mod_lic,'\"><i class=\"fa fa-list\"></i> View Debit Notes</a> | <a href=\"#\" onclick=\"',mnd.fonction_nd,'(',aff.id_mod_lic,', ', aff.id_cli,')\"><i class=\"fa fa-plus\"></i> Create Debit Note</a>') AS btn_action
												FROM client cl, affectation_modele_note_debit_client aff, modele_note_debit mnd
												WHERE cl.id_cli = aff.id_cli
													AND aff.id_mod_lic = ?
													AND aff.id_model_nd = mnd.id_model_nd");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {

				$compteur++;
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;

			}$requete-> closeCursor();
			return $row;

		}

		public function kamoa_nd($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$compteur=0;

			$tableau = '';


			$requete = $connexion-> prepare("SELECT dep.nom_dep AS nom_dep,
													dos.po_ref AS po_ref,
													COUNT(dos.id_dos) AS nbre_dos,
													CONCAT('<a href=\"create_note_debit_kamoa.php?id_cli=',dos.id_cli,'&id_mod_lic=',dos.id_mod_lic,'&po_ref=',dos.po_ref,'&po_ref_2=',SUBSTRING(dos.po_ref, 1, 3),'&id_dep=',dep.id_dep,'&nom_dep=',dep.nom_dep,'&id_mod_trans=',dos.id_mod_trans,'&id_march=NULL\"><i class=\"fa fa-list\"></i></a>') AS btn_action
												FROM dossier dos, depense_dossier depdos, depense dep
												WHERE dos.id_dos = depdos.id_dos
													AND depdos.id_dep = dep.id_dep
													AND dos.id_mod_lic = ?
													AND dos.id_cli = ?
													AND depdos.id_dep_dos NOT IN (
															SELECT id_dep_dos 
															 FROM detail_note_debit 
														)
												GROUP BY dep.id_dep, SUBSTRING(dos.po_ref, 1, 3)");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {

				$compteur++;

				$tableau .= '<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['nom_dep'].'</td>
								<td>'.$reponse['po_ref'].'</td>
								<td>'.$reponse['nbre_dos'].'</td>
								<td>'.$reponse['btn_action'].'</td>
							</tr>';

			}$requete-> closeCursor();
			return $tableau;

		}

		public function afficherDossierNewNoteDeDebitKamoa($id_cli, $id_mod_lic, $id_dep, $po_ref_2){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_dep'] = $id_dep;
			$entree['po_ref_2'] = $po_ref_2;

			$compteur=0;

			$tableau = '';


			$requete = $connexion-> prepare("SELECT dep.nom_dep AS nom_dep,
													dos.po_ref AS po_ref,
													dos.ref_dos AS ref_dos,
													dep.nom_dep AS nom_dep,
													depdos.id_dep_dos AS id_dep_dos,
													ROUND(depdos.montant, 2) AS montant
												FROM dossier dos, depense_dossier depdos, depense dep
												WHERE dos.id_dos = depdos.id_dos
													AND depdos.id_dep = dep.id_dep
													AND dep.id_dep = ?
													AND dos.id_mod_lic = ?
													AND dos.id_cli = ?
													AND SUBSTRING(dos.po_ref, 1, 3) = ?
													AND depdos.id_dep_dos NOT IN (
															SELECT id_dep_dos 
															 FROM detail_note_debit 
														)
												ORDER BY dos.id_dos");
			$requete-> execute(array($entree['id_dep'], $entree['id_mod_lic'], $entree['id_cli'], $entree['po_ref_2']));
			while ($reponse = $requete-> fetch()) {

				$compteur++;
				?>
				<tr>
					<input type="hidden" name="id_dep_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dep_dos'];?>">
					<td><?php echo $compteur;?></td>
					<td><?php echo $reponse['ref_dos'];?></td>
					<td><?php echo $reponse['po_ref'];?></td>
					<td><?php echo $reponse['nom_dep'];?></td>
					<td class="text-center"><input type="number" step="0.001" class="text-right " name="montant_<?php echo $compteur;?>" value="<?php echo $reponse['montant'];?>"></td>
					<td class="text-center">
						<select  name="tva_<?php echo $compteur;?>"  id="tva_<?php echo $compteur;?>" class="">
							<option value="0">NO</option>
							<option value="1">YES</option>
						</select>
					</td>
				</tr>
				<?php

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php

		}

		public function getEcritureJournal($id_jour){
			include("connexion.php");
			$entree['id_jour'] = $id_jour;

			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';
			$tableauDetail = '';

			$credit = 0;
			$debit = 0;

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT ecriture.*, 
													monnaie.sig_mon AS sig_mon
 												FROM ecriture, monnaie
												WHERE ecriture.id_jour = ?
													AND ecriture.id_mon = monnaie.id_mon");
			$requete-> execute(array($entree['id_jour']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr style="">
								<td style="text-align: center;" class="bg bg-secondary">
									'.$compteur.'
								</td>
								<td style="text-align: center;" class="bg bg-secondary">
									'.$reponse['date_e'].'
								</td>
								<td style="text-align: center;" class="bg bg-secondary">
									
								</td>
								<td style="text-align: left;" class="bg bg-secondary">
									'.$reponse['libelle_e'].'
								</td>
								<td style="text-align: center;" class="bg bg-secondary">
									'.$reponse['sig_mon'].'
								</td>
								<td style="text-align: center;" class="bg bg-secondary">
									
								</td>
								<td style="text-align: center;" class="bg bg-secondary">
									
								</td>
							</tr>';
							$requeteDetail = $connexion-> prepare("SELECT compte.code_compte AS code_compte, 
																			compte.nom_compte AS nom_compte,
																			detail_ecriture.debit AS debit,
																			detail_ecriture.credit AS credit
				 												FROM detail_ecriture, compte
																WHERE detail_ecriture.id_e = ?
																	AND detail_ecriture.id_compte = compte.id_compte
																	ORDER BY detail_ecriture.credit");
							$requeteDetail-> execute(array($reponse['id_e']));
							while ($reponseDetail = $requeteDetail-> fetch()) {
								$debit+=$reponseDetail['debit'];
								$credit+=$reponseDetail['credit'];

								$tableau .='<tr style="">
												<td class="" style="text-align: center;" class="">
												</td>
												<td class="" style="text-align: center;" class="">
													'.$reponseDetail['code_compte'].'
												</td>
												<td class="" style="text-align: left;" class="">
													'.$reponseDetail['nom_compte'].'
												</td>
												<td class="" style="text-align: center;" class="">
												</td>
												<td class="" style="text-align: center;" class="">
												</td>
												<td class="" style="text-align: right;" class="">
													'.$reponseDetail['debit'].'
												</td>
												<td class="" style="text-align: right;" class="">
													'.$reponseDetail['credit'].'
												</td>
											</tr>';
							}$requeteDetail-> closeCursor();

							$tableau .='<tr style="">
											<td colspan="5" style="text-align: center;" class="">
											</td>
											<td style="text-align: right;" class="font-weight-bold bg bg-info">
												'.number_format($debit, 2, ',', ' ').'
											</td>
											<td style="text-align: right;" class="font-weight-bold bg bg-info">
												'.number_format($credit, 2, ',', ' ').'
											</td>
										</tr>';
			}$requete-> closeCursor();

			return $tableau;

		}

		public function table_invoices_check_multiple($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_page,
													mf.view_page AS view_page,
													mf.excel AS excel
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.validation = '0'
													AND fd.id_cli = ?
												ORDER BY fd.ref_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<input type="hidden" id="ref_fact_'.$compteur.'" name="ref_fact_'.$compteur.'" value="'.$reponse['ref_fact'].'">
    						<tr>
    							<td>'.$compteur.'</td>
    							<td>'.$reponse['ref_fact'].'</td>
    							<td style="text-align: center;"><input class="" type="checkbox" id="check_'.$compteur.'" name="check_'.$compteur.'" ></td>
    						</tr>';
			}$requete-> closeCursor();

    		 $tableau .= '<input type="hidden" id="nbre_invoice" name="nbre_invoice" value="'.$compteur.'">';

			return $tableau;

		}

		public function getInvoicePendingValidationCDN($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$rows = array();

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
												DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
												fd.validation AS validation,
												fd.id_march AS id_march,
												fd.type_fact AS type_fact,
												cl.nom_cli AS nom_cli,
												cl.id_cli AS id_cli,
												u.nom_util AS nom_util,
												u.validation_facture AS validation_facture,
												fd.transmission AS transmission,
												fd.type_fact AS type_fact,
												fd.id_mod_lic AS id_mod_lic,
												mf.edit_page AS edit_page,
												mf.view_page AS view_page,
												mf.excel AS excel,
												CONCAT(CONCAT('<button class=\"btn btn-xs bg-info square-btn-adjust\" onclick=\"window.open(\'',mf.view_page,'?ref_fact=',fd.ref_fact,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View invoice\">
								                    <i class=\"fas fa-eye\"></i> 
								                </button>'),' ',
								                CONCAT('<button class=\"btn btn-xs bg-success square-btn-adjust\" onclick=\"window.location.replace(\'',mf.excel,'?ref_fact=',fd.ref_fact,'\',\'pop4\',\'width=1000,height=800\');\" title=\"Export Annex\">
								                    <i class=\"fas fa-file-excel\"></i> 
								                </button>'),' ',
								                CONCAT('<button class=\"btn btn-xs bg-warning square-btn-adjust\" onclick=\"editerFacture(\'',fd.ref_fact,'\', \'',mf.edit_page,'\');\" title=\"Edit\">
								                    <i class=\"fas fa-edit\"></i> 
								                </button>'),' ',
								                CONCAT('<button class=\"btn btn-xs bg-primary square-btn-adjust\" onclick=\"validerFacture(\'',fd.ref_fact,'\');\" title=\"Validate\">
								                    <i class=\"fas fa-check\"></i> 
								                </button>'),' ',
								                CONCAT('<button class=\"btn btn-xs bg-danger square-btn-adjust\" onclick=\"supprimerFacture(\'',fd.ref_fact,'\');\" title=\"Delete\">
								                    <i class=\"fas fa-times\"></i> 
								                </button>')) AS action
												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
											WHERE fd.id_mod_lic = ?
												AND fd.id_util = u.id_util
												AND fd.id_cli = cl.id_cli
												AND fd.id_mod_fact = mf.id_mod_fact
												AND fd.validation = '0'
												AND fd.id_cli = ?
											ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['montant'] = number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
				$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
				$rows[] = $reponse;
			}$requete-> closeCursor();
			return $rows;

		}

		public function getInvoiceAjax($id_cli, $id_mod_lic, $statut){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$rows = array();

			if ($statut=='invoice_pending_validation') {
				$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_page,
													mf.view_page AS view_page,
													mf.excel AS excel,
													CONCAT(CONCAT('<button class=\"btn btn-xs bg-info square-btn-adjust\" onclick=\"window.open(\'',mf.view_page,'?ref_fact=',fd.ref_fact,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View invoice\">
									                    <i class=\"fas fa-eye\"></i> 
									                </button>'),' ',
									                IF(mf.excel IS NOT NULL, CONCAT('<button class=\"btn btn-xs bg-success square-btn-adjust\" onclick=\"window.location.replace(\'',mf.excel,'?ref_fact=',fd.ref_fact,'\',\'pop4\',\'width=1000,height=800\');\" title=\"Export Annex\">
									                    <i class=\"fas fa-file-excel\"></i> 
									                </button>'), ''),' ',
									                IF(mf.edit_page IS NOT NULL, CONCAT('<button class=\"btn btn-xs bg-warning square-btn-adjust\" onclick=\"editerFacture(\'',fd.ref_fact,'\', \'',mf.edit_page,'\');\" title=\"Edit\">
									                    <i class=\"fas fa-edit\"></i> 
									                </button>'), ''),' ',
									                CONCAT('<button class=\"btn btn-xs bg-primary square-btn-adjust\" onclick=\"validerFacture(\'',fd.ref_fact,'\');\" title=\"Validate\">
									                    <i class=\"fas fa-check\"></i> 
									                </button>'),' ',
									                CONCAT('<button class=\"btn btn-xs bg-secondary square-btn-adjust\" onclick=\"modal_dossiers_facture(\'',fd.ref_fact,'\');\" title=\"Files in invoice\">
									                    <i class=\"fas fa-cogs\"></i> 
									                </button> <button class=\"btn btn-xs bg-danger square-btn-adjust\" onclick=\"supprimerFacture(\'',fd.ref_fact,'\');\" title=\"Delete\">
									                    <i class=\"fas fa-times\"></i> 
									                </button>')) AS action
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.validation = '0'
													AND fd.id_cli = ?
												ORDER BY fd.date_fact ASC");
			}else if ($statut=='invoice_waiting_to_send') {
				$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_page,
													mf.view_page AS view_page,
													mf.excel AS excel,
													CONCAT(CONCAT('<button class=\"btn btn-xs bg-info square-btn-adjust\" onclick=\"window.open(\'',mf.view_page,'?ref_fact=',fd.ref_fact,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View invoice\">
									                    <i class=\"fas fa-eye\"></i> 
									                </button>'),' ',
									                IF(mf.excel IS NOT NULL, CONCAT('<button class=\"btn btn-xs bg-success square-btn-adjust\" onclick=\"window.location.replace(\'',mf.excel,'?ref_fact=',fd.ref_fact,'\',\'pop4\',\'width=1000,height=800\');\" title=\"Export Annex\">
									                    <i class=\"fas fa-file-excel\"></i> 
									                </button>'), ''),' ',
									                IF(mf.edit_page IS NOT NULL, CONCAT('<button class=\"btn btn-xs bg-warning square-btn-adjust\" onclick=\"editerFacture(\'',fd.ref_fact,'\', \'',mf.edit_page,'\');\" title=\"Edit\">
									                    <i class=\"fas fa-edit\"></i> 
									                </button>'), ''),' ',
									                CONCAT('<button class=\"btn btn-xs bg-purple square-btn-adjust\" onclick=\"modal_send_invoice(\'',fd.ref_fact,'\');\" title=\"Validate\">
									                    <i class=\"fas fa-envelope\"></i> 
									                </button>'),' ',
									                CONCAT('<button class=\"btn btn-xs bg-secondary square-btn-adjust\" onclick=\"modal_dossiers_facture(\'',fd.ref_fact,'\');\" title=\"Files in invoice\">
									                    <i class=\"fas fa-cogs\"></i> 
									                </button> <button class=\"btn btn-xs bg-danger square-btn-adjust\" onclick=\"supprimerFacture(\'',fd.ref_fact,'\');\" title=\"Delete\">
									                    <i class=\"fas fa-times\"></i> 
									                </button>')) AS action
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.validation = '1'
													AND fd.date_mail IS NULL
													AND fd.id_cli = ?
												ORDER BY fd.date_fact DESC");
			}else if ($statut=='invoice_send') {
				$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_page,
													mf.view_page AS view_page,
													mf.excel AS excel,
													CONCAT(CONCAT('<button class=\"btn btn-xs bg-info square-btn-adjust\" onclick=\"window.open(\'',mf.view_page,'?ref_fact=',fd.ref_fact,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View invoice\">
									                    <i class=\"fas fa-eye\"></i> 
									                </button>'),' ',
									                IF(mf.excel IS NOT NULL, CONCAT('<button class=\"btn btn-xs bg-success square-btn-adjust\" onclick=\"window.location.replace(\'',mf.excel,'?ref_fact=',fd.ref_fact,'\',\'pop4\',\'width=1000,height=800\');\" title=\"Export Annex\">
									                    <i class=\"fas fa-file-excel\"></i> 
									                </button>'), ''),' ',
									                IF(mf.edit_page IS NOT NULL, CONCAT('<button class=\"btn btn-xs bg-warning square-btn-adjust\" onclick=\"editerFacture(\'',fd.ref_fact,'\', \'',mf.edit_page,'\');\" title=\"Edit\">
									                    <i class=\"fas fa-edit\"></i> 
									                </button>'), ''),' ',
									                CONCAT('<button class=\"btn btn-xs bg-purple square-btn-adjust\" onclick=\"modal_send_invoice(\'',fd.ref_fact,'\');\" title=\"Validate\">
									                    <i class=\"fas fa-envelope\"></i> 
									                </button>'),' ',
									                CONCAT('<button class=\"btn btn-xs bg-secondary square-btn-adjust\" onclick=\"modal_dossiers_facture(\'',fd.ref_fact,'\');\" title=\"Files in invoice\">
									                    <i class=\"fas fa-cogs\"></i> 
									                </button> <button class=\"btn btn-xs bg-danger square-btn-adjust\" onclick=\"supprimerFacture(\'',fd.ref_fact,'\');\" title=\"Delete\">
									                    <i class=\"fas fa-times\"></i> 
									                </button>')) AS action
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.validation = '1'
													AND fd.date_mail IS NOT NULL
													AND fd.id_cli = ?
												ORDER BY fd.date_fact ASC");
			}
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['montant'] = $this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27)));
				$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];

				$rows[] = $reponse;
			}$requete-> closeCursor();
			return $rows;

		}

		public function getInvoiceSearched($id_cli, $id_mod_lic, $ref_fact){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			if (!empty($ref_fact) && ($ref_fact=='') ) {
				$entree['ref_fact'] = '%'.$ref_fact.'%';
			}else{
				$entree['ref_fact'] = $ref_fact;
			}
			
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_pag,
													mf.view_page AS view_page,
													mf.excel AS excel,
													IF(fd.validation='0',
														'PENDING VALIDATION',
														IF(fd.date_mail IS NULL,
															'AWAITING TO SEND',
															IF(fd.ref_paie IS NULL,
																'Pending Payment',
																'Payed'
																)
															)
														) AS statut
 												FROM facture_dossier fd, detail_facture_dossier det, dossier dos, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.id_cli = ?
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													AND (
															fd.ref_fact LIKE ?
															OR dos.num_lot = ?
															OR dos.ref_dos = ?
														)
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['ref_fact'], $entree['ref_fact'], $entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr style="">
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$compteur.'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['ref_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['date_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'].'
								</td>
								<td class="" style="text-align: right;" class="bg bg-dark">
									'.number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ').'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['nom_util'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['statut'].'
								</td>
								<td style="text-align: center;">
									<button class="btn btn-xs bg-info square-btn-adjust" onclick="window.open(\''.$reponse['view_page'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="View invoice">
					                    <i class="fas fa-eye"></i> 
					                </button>
									<button class="btn btn-xs bg-success square-btn-adjust" onclick="window.location.replace(\''.$reponse['excel'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Export Excel File">
					                    <i class="fas fa-file-excel"></i> 
					                </button>
								</td>
							</tr>';
			}$requete-> closeCursor();
			return $tableau;

		}

		public function getNbreInvoiceSearched($id_cli, $id_mod_lic, $ref_fact){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			if (!empty($ref_fact) && ($ref_fact=='') ) {
				$entree['ref_fact'] = '%'.$ref_fact.'%';
			}else{
				$entree['ref_fact'] = $ref_fact;
			}
			
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(fd.ref_fact)) AS nbre
 												FROM facture_dossier fd, detail_facture_dossier det, dossier dos, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.id_cli = ?
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													AND (
															fd.ref_fact LIKE ?
															OR dos.num_lot = ?
															OR dos.ref_dos = ?
														)
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['ref_fact'], $entree['ref_fact'], $entree['ref_fact']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['nbre'];
			}else{
				return 0;
			}
			

		}

		public function getInvoiceAwaitingToSend($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_page,
													mf.view_page AS view_page,
													mf.excel AS excel
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.validation = '1'
													AND fd.date_mail IS NULL
													AND fd.id_cli = ?
												ORDER BY fd.date_fact, fd.ref_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$btn_delete = '';
				IF($this-> getUtilisateur($_SESSION['id_util'])['suppression_facture']=='1'){
					$btn_delete = '
									<button class="btn btn-xs bg-danger square-btn-adjust" onclick="supprimerFacture(\''.$reponse['ref_fact'].'\');" title="Delete">
					                    <i class="fas fa-times"></i> 
					                </button>';
				}

				$tableau .='<tr style="">
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$compteur.'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['ref_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['date_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'].'
								</td>
								<td class="" style="text-align: right;" class="bg bg-dark">
									'.number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ').'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['nom_util'].'
								</td>
								<td style="text-align: center;">
									<button class="btn btn-xs bg-warning square-btn-adjust" onclick="editerFacture(\''.$reponse['ref_fact'].'\', \''.$reponse['edit_page'].'\');" title="Edit">
					                    <i class="fas fa-edit"></i> 
					                </button>
									<button class="btn btn-xs bg-info square-btn-adjust" onclick="window.open(\''.$reponse['view_page'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="View invoice">
					                    <i class="fas fa-eye"></i> 
					                </button>
									<button class="btn btn-xs bg-success square-btn-adjust" onclick="window.location.replace(\''.$reponse['excel'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Export Excel File">
					                    <i class="fas fa-file-excel"></i> 
					                </button>
									<button class="btn btn-xs bg-purple square-btn-adjust" onclick="modal_send_invoice(\''.$reponse['ref_fact'].'\');" title="Send Email">
					                    <i class="fas fa-envelope"></i> 
					                </button>
					                '.$btn_delete.'
								</td>
							</tr>';
			}$requete-> closeCursor();
			return $tableau;

		}

		// public function getInvoiceSended($id_cli, $id_mod_lic){
		// 	include("connexion.php");
		// 	$entree['id_cli'] = $id_cli;
		// 	$entree['id_mod_lic'] = $id_mod_lic;
		// 	//$entree['type_fact'] = $type_fact;
		// 	$compteur=0;

		// 	$bg = "";
		// 	$badge = '';
		// 	$btn = '';
		// 	$etat ='';
		// 	$tableau = '';

		// 	$debut = $compteur;

		// 	$requete = $connexion-> prepare("SELECT DISTINCT(pf.id_paie), fd.ref_fact AS ref_fact,
		// 											DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
		// 											DATE_FORMAT(fd.date_mail, '%d/%m/%Y') AS date_mail,
		// 											fd.validation AS validation,
		// 											fd.id_march AS id_march,
		// 											fd.type_fact AS type_fact,
		// 											cl.nom_cli AS nom_cli,
		// 											cl.id_cli AS id_cli,
		// 											u.nom_util AS nom_util,
		// 											u.validation_facture AS validation_facture,
		// 											fd.transmission AS transmission,
		// 											fd.type_fact AS type_fact,
		// 											fd.id_mod_lic AS id_mod_lic,
		// 											mf.edit_page AS edit_pag,
		// 											mf.view_page AS view_page,
		// 											mf.excel AS excel,
		// 											SUM(pf.montant_paie) AS montant_paie,
		// 											SUM( 
		// 												IF(det.usd='1', 
		// 													IF(det.tva='1',
		// 														det.montant*1.16,
		// 														det.montant
		// 													),
		// 													IF(det.tva='1',
		// 														(det.montant/dos.roe_decl)*1.16,
		// 														(det.montant/dos.roe_decl)
		// 													)
		// 												) 
		// 											) AS montant_fact
		// 										FROM facture_dossier fd
		// 										LEFT JOIN utilisateur u
		// 											ON fd.id_util = u.id_util
		// 										LEFT JOIN client cl
		// 											ON fd.id_cli = cl.id_cli
		// 										LEFT JOIN  modele_facture mf
		// 											ON fd.id_mod_fact = mf.id_mod_fact
		// 										LEFT JOIN paiement_facture pf
		// 											ON fd.ref_fact = pf.ref_fact
		// 										LEFT JOIN detail_facture_dossier det
		// 											ON det.ref_fact = fd.ref_fact
		// 										LEFT JOIN dossier dos
		// 											ON dos.id_dos = det.id_dos
		// 										WHERE fd.id_mod_lic = ?
		// 											AND fd.validation = '1'
		// 											AND fd.date_mail IS NOT NULL
		// 											AND fd.id_cli = ?
		// 										GROUP BY fd.ref_fact, pf.id_paie
		// 										ORDER BY fd.date_fact ASC");
		// 	$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
		// 	while ($reponse = $requete-> fetch()) {
		// 		$compteur++;

		// 		$tableau .='<tr style="">
		// 						<td class="" style="text-align: center;" class="bg bg-dark">
		// 							'.$compteur.'
		// 						</td>
		// 						<td class="" style="text-align: center;" class="bg bg-dark">
		// 							'.$reponse['ref_fact'].'
		// 						</td>
		// 						<td class="" style="text-align: center;" class="bg bg-dark">
		// 							'.$reponse['date_fact'].'
		// 						</td>
		// 						<td class="" style="text-align: center;" class="bg bg-dark">
		// 							'.$this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'].'
		// 						</td>
		// 						<td class="" style="text-align: center;" class="bg bg-dark">
		// 							'.$reponse['nom_util'].'
		// 						</td>
		// 						<td class="" style="text-align: center;" class="bg bg-dark">
		// 							'.$reponse['date_mail'].'
		// 						</td>
		// 						<td class="" style="text-align: center;" class="bg bg-dark">
		// 							'.number_format($reponse['montant_fact'], 2, ',', ' ').'
		// 						</td>
		// 						<td class="" style="text-align: center;" class="bg bg-dark">
		// 							'.number_format($reponse['montant_paie'], 2, ',', ' ').'
		// 						</td>
		// 						<td style="text-align: center;">
		// 							<button class="btn btn-xs bg-info square-btn-adjust" onclick="window.open(\''.$reponse['view_page'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="View invoice">
		// 			                    <i class="fas fa-eye"></i> 
		// 			                </button>
		// 							<button class="btn btn-xs bg-success square-btn-adjust" onclick="window.location.replace(\''.$reponse['excel'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Export Excel File">
		// 			                    <i class="fas fa-file-excel"></i> 
		// 			                </button>
		// 							<button class="btn btn-xs bg-purple square-btn-adjust" onclick="modal_send_invoice(\''.$reponse['ref_fact'].'\');" title="Send Email">
		// 			                    <i class="fas fa-envelope"></i> 
		// 			                </button>
		// 							<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="modal_paiement(\''.$reponse['ref_fact'].'\');" title="Make Payment">
		// 			                    <i class="fas fa-calculator"></i> 
		// 			                </button>
		// 						</td>
		// 					</tr>';
		// 	}$requete-> closeCursor();
		// 	return $tableau;

		// }

		public function getInvoiceSended($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													DATE_FORMAT(fd.date_mail, '%d/%m/%Y') AS date_mail,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_pag,
													mf.view_page AS view_page,
													mf.excel AS excel
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.validation = '1'
													AND fd.date_mail IS NOT NULL
													AND fd.ref_paie IS NULL
													AND fd.date_paie IS NULL
													AND fd.id_cli = ?
												ORDER BY fd.ref_fact DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr style="">
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$compteur.'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['ref_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['date_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'].'
								</td>
								<td class="" style="text-align: right;" class="bg bg-dark">
									'.number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ').'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['nom_util'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['date_mail'].'
								</td>
								<td style="text-align: center;">
									<button class="btn btn-xs bg-info square-btn-adjust" onclick="window.open(\''.$reponse['view_page'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="View invoice">
					                    <i class="fas fa-eye"></i> 
					                </button>
									<button class="btn btn-xs bg-success square-btn-adjust" onclick="window.location.replace(\''.$reponse['excel'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Export Excel File">
					                    <i class="fas fa-file-excel"></i> 
					                </button>
									<button class="btn btn-xs bg-purple square-btn-adjust" onclick="modal_send_invoice(\''.$reponse['ref_fact'].'\');" title="Send Email">
					                    <i class="fas fa-envelope"></i> 
					                </button>
									<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="modal_paiement(\''.$reponse['ref_fact'].'\');" title="Make Payment">
					                    <i class="fas fa-calculator"></i> 
					                </button>
								</td>
							</tr>';
			}$requete-> closeCursor();
			return $tableau;

		}

		public function getInvoicePayed($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													DATE_FORMAT(fd.date_mail, '%d/%m/%Y') AS date_mail,
													DATE_FORMAT(fd.date_paie, '%d/%m/%Y') AS date_paie,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.edit_page AS edit_pag,
													mf.view_page AS view_page,
													mf.excel AS excel
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.validation = '1'
													AND fd.date_mail IS NOT NULL
													AND fd.ref_paie IS NOT NULL
													AND fd.date_paie IS NOT NULL
													AND fd.id_cli = ?
												ORDER BY fd.ref_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr style="">
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$compteur.'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['ref_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['date_fact'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'].'
								</td>
								<td class="" style="text-align: center;" class="bg bg-dark">
									'.$reponse['date_paie'].'
								</td>
								<td class="" style="text-align: right;" class="bg bg-dark">
									'.number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ').'
								</td>
								<td style="text-align: center;">
									<button class="btn btn-xs bg-info square-btn-adjust" onclick="window.open(\''.$reponse['view_page'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="View invoice">
					                    <i class="fas fa-eye"></i> 
					                </button>
									<button class="btn btn-xs bg-success square-btn-adjust" onclick="window.location.replace(\''.$reponse['excel'].'?ref_fact='.$reponse['ref_fact'].'\',\'pop1\',\'width=1000,height=800\');" title="Export Excel File">
					                    <i class="fas fa-file-excel"></i> 
					                </button>
									<button class="btn btn-xs bg-purple square-btn-adjust" onclick="modal_send_invoice(\''.$reponse['ref_fact'].'\');" title="Send Email">
					                    <i class="fas fa-envelope"></i> 
					                </button>
								</td>
							</tr>';
			}$requete-> closeCursor();
			return $tableau;

		}

		public function getMontantFactureGlobale($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT SUM(
														IF(det.usd="1", 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant+det.montant_tva)/dos.roe_decl,
																	(det.montant/dos.roe_decl)*1.16
																	),
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY det.ref_fact');
			$requete-> execute(array($entree['ref_fact']));
			// while($reponse = $requete-> fetch()){

			// 	$sommeHT += $reponse['ht_usd'];

			// 	if($reponse['tva'] == '0'){
			// 		$sommeTVA += 0;
			// 		$sommeTTC += $reponse['ht_usd'];
			// 	}else{
			// 		$tva = round(($reponse['ht_usd'] * 0.16), 2);
			// 		$sommeTVA += $tva;
			// 		$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
			// 		$sommeTTC += $ttc;
			// 	}

			// 	// $sommeHT += $reponse['ht'];

			// 	// if($reponse['tva'] == '0'){
			// 	// 	$sommeTVA += 0;
			// 	// 	$sommeTTC += $reponse['ht'];
			// 	// }else{
			// 	// 	$tva = round(($reponse['ht'] * 0.16), 2);
			// 	// 	$sommeTVA += $tva;
			// 	// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
			// 	// 	$sommeTTC += $ttc;
			// 	// }

			// }
			$reponse = $requete-> fetch();

			return $reponse['ttc_usd'];
		}

		public function getNombreFactureDossierValideesEnAttenteTransmission($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.transmission = '0'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function afficherFactureDossierValiseesEnAttenteTransmission($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													mf.edit_page AS edit_pag,
													mf.view_page AS view_page
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.validation = '1'
													AND fd.transmission = '0'
													AND fd.id_mod_fact = mf.id_mod_fact
													$sqlClient
												ORDER BY fd.ref_fact ASC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}/*else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							ValidÃ©e En attente d\'Ãªtre Transmis
							</span>';
				}*/else{
					$etat = '<span class="badge badge-success">
							Facture validÃ©e et Transmise
							</span>';
					$btn ='';
				}

				$btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';
			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$btn = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$btn;
				}

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
					<button class="btn bg-primary btn-xs square-btn-adjust" onclick="window.open('<?php echo $reponse['view_page'];?>?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="GÃ©nÃ©rer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
					<?php 
						echo $btn;
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherFactureDossierRecherche($id_cli, $id_mod_lic, $ref_fact, $validation){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_fact'] = $ref_fact;
			$entree['validation'] = $validation;
			$compteur = 0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact,
													fd.id_mod_lic AS id_mod_lic,
													mf.view_page AS view_page
 												FROM facture_dossier fd, client cl, utilisateur u, modele_facture mf
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													AND fd.validation = ?
													AND fd.ref_fact = ?
													AND fd.id_mod_fact = mf.id_mod_fact
												ORDER BY fd.date_fact ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['validation'], $entree['ref_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>
			                ';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}/*else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							ValidÃ©e En attente d\'Ãªtre Transmis
							</span>';
				}*/else{
					$etat = '<span class="badge badge-success">
							Facture validÃ©e et Transmise
							</span>';
					$btn ='';
				}

				$btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';

			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$btn = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$btn;
				}

			?>
			<tr class="bg bg-teal">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
					<button class="btn bg-primary square-btn-adjust btn-xs" onclick="window.open('<?php echo $reponse['view_page'];?>?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="GÃ©nÃ©rer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>
					<?php 
						echo $btn;
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function getNombreFactureAttenteTransmis($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['type_fact'] = $type_fact;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}


			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre
												FROM facture_dossier
												WHERE id_mod_lic = ?
													AND type_fact = ?
													$sqlClient
													AND ref_fact NOT IN(SELECT ref_fact FROM detail_transmis_facture_dossier)
													AND validation = '1'
													AND not_transmis = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmisFacture2($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['type_fact'] = $type_fact;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'" ';
			}


			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(tr.id_trans_fact)) AS nbre
												FROM facture_dossier fd, transmis_facture_dossier tr, detail_transmis_facture_dossier det
												WHERE fd.id_mod_lic = ?
													AND fd.type_fact = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_trans_fact = tr.id_trans_fact");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmisFactureSansFichier($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['type_fact'] = $type_fact;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'" ';
			}


			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(tr.id_trans_fact)) AS nbre
												FROM facture_dossier fd, transmis_facture_dossier tr, detail_transmis_facture_dossier det
												WHERE fd.id_mod_lic = ?
													AND fd.type_fact = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_trans_fact = tr.id_trans_fact
													AND (tr.fichier_trans_fact IS NULL OR tr.fichier_trans_fact = '')");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreFactureTransmis($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['type_fact'] = $type_fact;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}


			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre
												FROM facture_dossier
												WHERE id_mod_lic = ?
													AND type_fact = ?
													$sqlClient
													AND ref_fact IN(SELECT ref_fact FROM detail_transmis_facture_dossier)");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmisFacture($id_cli, $id_mod_lic, $type_fact){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;


			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(tr.id_trans_fact)) AS nbre
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = ?
													AND cl.id_cli = fact.id_cli
													AND fact.id_mod_lic = ?
													AND fact.type_fact = ?
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['type_fact']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function afficherTransmisFacture($id_cli, $id_mod_lic, $type_fact, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fact.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_fact) AS id_trans_fact, UPPER(cl.nom_cli) AS nom_cli,
													tr.id_trans_fact AS id_trans_fact,
													tr.ref_trans_fact AS ref_trans_fact,
													DATE_FORMAT(tr.date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													tr.fichier_trans_fact AS fichier_trans_fact,
													cl.id_cli AS id_cli
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													$sqlClient
													AND fact.id_mod_lic = ?
													AND fact.type_fact = ?
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
												ORDER BY tr.id_trans_fact DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalTransmisFacture.php');

				if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreDossierTransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les dÃ©tails" href="#" style="color: black;" onclick="window.open('popUpDetailTransmisFacture.php?id_trans_fact=<?php echo $reponse['id_trans_fact'];?>&id_cli=<?php echo $entree['id_cli'];?>&id_mod_lic_fact=<?php echo $id_mod_lic; ?>&type_fact=<?php echo $_GET['type_fact']; ?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning btn-xs">DÃ©tails</button>
					</a>
					<button type="button" class="btn btn-dark btn-xs dropdown-toggle dropdown-icon" data-toggle="dropdown">
                        <i class="fa fa-copy"></i>  Factures<!-- <sup><span class="badge badge-info"><?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?></span></sup> -->
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getFactureDossierTransmis($reponse['id_trans_fact']);
                          ?>
                        </div>
                      </button>
					<?php
						if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust btn-xs" data-toggle="modal" data-target=".uploadTransmisFacture_<?php echo $reponse['id_trans_fact'];?>">
		                    <i class="fa fa-upload"></i> Loger AccusÃ©e de rÃ©ception
		                </button>
						<?php
						}else{
						?>
						<button class="btn bg bg-info btn-xs square-btn-adjust" onclick="window.open('../transmis_factures/<?php echo $reponse['id_trans_fact'];?>/<?php echo $reponse['fichier_trans_fact'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-file"></i> AccusÃ©e de rÃ©ception
		                </button>
						<?php
						}
					?>
                    <button class="btn btn-success btn-xs square-btn-adjust" onclick="window.location.replace('exportTramisFacture.php?id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_lic=<?php echo $id_mod_lic; ?>&id_trans_fact=<?php echo $reponse['id_trans_fact']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i> Exporter en Excel
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDetailFacturesTransmis($id_trans_fact){
			include("connexion.php");
			$entree['id_trans_fact'] = $id_trans_fact;

			$compteur=0;
			$montant = 0;
			$bfu = 0;
			$nac = 0;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													UPPER(cl.nom_cli) AS nom_cli,
													SUM(IF(det.usd='1',
														IF(det.tva='1', (det.montant*1.16),det.montant) 
														,
														IF(det.tva='1', ((det.montant/dos.roe_decl)*1.16), (det.montant/dos.roe_decl))
													)) AS montant,
													dos.id_dos AS id_dos,
													dos.ref_dos AS ref_dos,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit
												FROM facture_dossier fd, transmis_facture_dossier tr, detail_transmis_facture_dossier dtfd, client cl, detail_facture_dossier det, dossier dos
												WHERE dos.id_cli = cl.id_cli
													AND dos.id_dos = det.id_dos
													AND det.ref_fact = fd.ref_fact
													AND fd.ref_fact = dtfd.ref_fact
													AND dtfd.id_trans_fact = tr.id_trans_fact
													AND tr.id_trans_fact = ?
												GROUP BY dos.id_dos
												ORDER BY dos.id_dos");
			$requete-> execute(array($entree['id_trans_fact']));
			while ($reponse = $requete-> fetch()) {
				
				$compteur++;
				$montant += $reponse['montant'];
				$bfu += $this-> getMontantFactureDossierDebours($reponse['ref_fact'], $reponse['id_dos'], 10);
				$nac += $this-> getMontantFactureDossierDebours($reponse['ref_fact'], $reponse['id_dos'], 11);
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php 
						echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
					?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['montant'], 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $this-> getMontantFactureDossierDebours($reponse['ref_fact'], $reponse['id_dos'], 10), 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $this-> getMontantFactureDossierDebours($reponse['ref_fact'], $reponse['id_dos'], 11), 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td style="text-align: right;" colspan="6">
					TOTAL
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $montant, 2, ',', ' ');?>
				</td>
				<td></td>
				<td></td>
				<td style="text-align: right;">
					<?php echo number_format( $bfu, 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $nac, 2, ',', ' ');?>
				</td>
			</tr>
			<?php
		}

		public function afficherTransmisFacturePopUp($id_cli, $id_mod_lic, $type_fact){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fact.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_fact) AS id_trans_fact, UPPER(cl.nom_cli) AS nom_cli,
													tr.id_trans_fact AS id_trans_fact,
													tr.ref_trans_fact AS ref_trans_fact,
													DATE_FORMAT(tr.date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													tr.fichier_trans_fact AS fichier_trans_fact,
													cl.id_cli AS id_cli
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													$sqlClient
													AND fact.id_mod_lic = ?
													AND fact.type_fact = ?
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
												ORDER BY tr.id_trans_fact DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalTransmisFacture.php');

				if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreDossierTransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les dÃ©tails" href="#" style="color: black;" onclick="window.open('popUpDetailTransmisFacture.php?id_trans_fact=<?php echo $reponse['id_trans_fact'];?>&id_cli=<?php echo $entree['id_cli'];?>&id_mod_lic_fact=<?php echo $id_mod_lic; ?>&type_fact=<?php echo $_GET['type_fact']; ?>','pop1','width=1900,height=900');">
						<button class="btn btn-xs bg bg-warning">DÃ©tails</button>
					</a>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherFacturesTransmis($id_mod_lic, $id_cli, $type_fact){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$compteur=0;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													UPPER(cl.nom_cli) AS nom_cli,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													SUM( 
														IF(det.usd='1',
															IF(det.tva='1', (det.montant*1.16),det.montant) 
															,
															IF(det.tva='1', ((det.montant/dos.roe_decl)*1.16), (det.montant/dos.roe_decl))
														) 
													) AS montant
												FROM facture_dossier fd, client cl, detail_facture_dossier det, dossier dos
												WHERE fd.id_mod_lic = ?
													AND fd.id_cli = cl.id_cli
													AND fd.ref_fact IN(
															SELECT ref_fact FROM detail_transmis_facture_dossier
														)
													AND fd.type_fact = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			while ($reponse = $requete-> fetch()) {
				
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['montant'], 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherTransmisFacturePopUpSansFichier($id_cli, $id_mod_lic, $type_fact){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND fact.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_fact) AS id_trans_fact, UPPER(cl.nom_cli) AS nom_cli,
													tr.id_trans_fact AS id_trans_fact,
													tr.ref_trans_fact AS ref_trans_fact,
													DATE_FORMAT(tr.date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													tr.fichier_trans_fact AS fichier_trans_fact,
													cl.id_cli AS id_cli
												FROM client cl, transmis_facture_dossier tr, detail_transmis_facture_dossier dt, facture_dossier fact
												WHERE cl.id_cli = fact.id_cli
													$sqlClient
													AND fact.id_mod_lic = ?
													AND fact.type_fact = ?
													AND fact.ref_fact = dt.ref_fact
													AND dt.id_trans_fact = tr.id_trans_fact
												ORDER BY tr.id_trans_fact DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalTransmisFacture.php');

				if (!($reponse['fichier_trans_fact']) || ($reponse['fichier_trans_fact']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreFactureransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNbreDossierTransmisFacture($reponse['id_trans_fact']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les dÃ©tails" href="#" style="color: black;" onclick="window.open('popUpDetailTransmisFacture.php?id_trans_fact=<?php echo $reponse['id_trans_fact'];?>&id_cli=<?php echo $entree['id_cli'];?>&id_mod_lic_fact=<?php echo $id_mod_lic; ?>&type_fact=<?php echo $_GET['type_fact']; ?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">DÃ©tails</button>
					</a>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function getTransmisFactureDossier($id_trans_fact){
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;

			$requete = $connexion-> prepare("SELECT ref_trans_fact, DATE_FORMAT(date_trans_fact, '%d/%m/%Y') AS date_trans_fact,
													DATE_FORMAT(date_trans_fact, '%d-%m-%Y') AS date_trans_fact2
												FROM transmis_facture_dossier
												WHERE id_trans_fact = ?");
			$requete-> execute(array($entree['id_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getNombreDossierFacture2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(d.id_dos)) AS nbre
												FROM dossier d, detail_facture_dossier det, facture_dossier fd
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = d.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getMontantFactureDossierDebours($ref_fact, $id_dos, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;
			$entree['id_deb'] = $id_deb;

			$requete = $connexion-> prepare("SELECT montant
												FROM detail_facture_dossier
													WHERE ref_fact = ?
														AND id_dos = ?
														AND id_deb = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
			$reponse=$requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantFactureDossierDebours2($ref_fact, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;

			$requete = $connexion-> prepare("SELECT SUM(montant) AS montant
												FROM detail_facture_dossier
													WHERE ref_fact = ?
														AND id_deb = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			$reponse=$requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantFactureDossierDebours3($ref_fact, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;

			$requete = $connexion-> prepare("SELECT SUM(
														IF(detail_facture_dossier.usd='0',
															detail_facture_dossier.montant/dossier.roe_decl,
															detail_facture_dossier.montant)
													) AS montant
												FROM detail_facture_dossier, dossier
													WHERE detail_facture_dossier.ref_fact = ?
														AND detail_facture_dossier.id_deb = ?
														AND dossier.id_dos = detail_facture_dossier.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			$reponse=$requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantFactureDossierDeboursWithTVA($ref_fact, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;

			$requete = $connexion-> prepare("SELECT SUM(
														IF(detail_facture_dossier.tva = '1',
															IF(detail_facture_dossier.usd='0',
															(detail_facture_dossier.montant/dossier.roe_decl)*1.16,
															detail_facture_dossier.montant*1.16),
															IF(detail_facture_dossier.usd='0',
															detail_facture_dossier.montant/dossier.roe_decl,
															detail_facture_dossier.montant)
														)
													) AS montant
												FROM detail_facture_dossier, dossier
													WHERE detail_facture_dossier.ref_fact = ?
														AND detail_facture_dossier.id_deb = ?
														AND dossier.id_dos = detail_facture_dossier.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			$reponse=$requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantDataDetailFacture($ref_fact, $id_dos, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;
			$entree['id_deb'] = $id_deb;

			$requete = $connexion-> prepare("SELECT *,
													IF(usd='0',
														ROUND(montant),
														ROUND(montant, 3)
														) AS montant
												FROM detail_facture_dossier
													WHERE ref_fact = ?
														AND id_dos = ?
														AND id_deb = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
			$reponse=$requete-> fetch();
			if ($reponse) {
				return $reponse;
			}else{
				$reponse['montant'] = NULL;
				$reponse['tva'] = '0';
				return $reponse;
			}
		}

		public function getDataTransmisFacture($id_trans_fact){
			include('connexion.php');
			$entree['id_trans_fact'] = $id_trans_fact;

			$requete = $connexion-> prepare("SELECT *,
													DATE_FORMAT(date_trans_fact, '%d/%m/%Y') AS date_trans_fact
												FROM transmis_facture_dossier
												WHERE id_trans_fact = ?");
			$requete-> execute(array($entree['id_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getModeTransport($id_mod_trans){
			include('connexion.php');
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT *
												FROM mode_transport
												WHERE id_mod_trans = ?");
			$requete-> execute(array($entree['id_mod_trans']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getClientModeleLicenceModeTransport($id_cli, $id_mod_lic, $id_mod_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_mod_trans = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse;
			}else{
				return false;
			}
			//return $reponse;
		}

		public function getNombreFactureDossierValideesTransmise($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT COUNT(fd.ref_fact) AS nbre
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.transmission = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function afficherFactureDossierValideesTransmises($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT fd.ref_fact AS ref_fact,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													fd.validation AS validation,
													fd.id_march AS id_march,
													fd.type_fact AS type_fact,
													cl.nom_cli AS nom_cli,
													cl.id_cli AS id_cli,
													u.nom_util AS nom_util,
													u.validation_facture AS validation_facture,
													fd.transmission AS transmission,
													fd.master_data AS master_data,
													fd.type_fact AS type_fact
 												FROM facture_dossier fd, client cl, utilisateur u
												WHERE fd.id_mod_lic = ?
													AND fd.id_util = u.id_util
													AND fd.id_cli = cl.id_cli
													
													AND fd.validation = '1'
													AND fd.transmission = '1'
													$sqlClient
												ORDER BY DATE(fd.date_fact) DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');
				include('modalTransmisFactureDossier.php');
				include('modalDeleteFactureDossier.php');

				if ($reponse['validation']=='0') {
					$bg = 'color: #CCCC00;';
					if($this-> getDataUtilisateur($_SESSION['id_util'])['validation_facture'] == '1'){
						$btn = '<button class="btn btn-xs bg-info square-btn-adjust" data-toggle="modal" data-target=".validerFacture_'.$reponse['ref_fact'].'" title="Valider la facture">
			                    <i class="fas fa-check"></i> 
			                </button>';
			            }else{
			            	$btn = '';
			            }
					
					$etat = '<span class="badge badge-warning">
							En attente de validation
							</span>';
				}else if ($reponse['transmission']=='0') {
					$bg = 'color: rgb(0, 255, 128);';
					$btn = '<button class="btn bg-primary square-btn-adjust" data-toggle="modal" data-target=".transmissionFacture_'.$reponse['ref_fact'].'">
			                    <i class="fas fa-upload"></i> <?php echo $etat;?>Transmission
			                </button>';
					$etat = '<span class="badge badge-primary">
							ValidÃ©e En attente d\'Ãªtre Transmis
							</span>';
				}else{
					$etat = '<span class="badge badge-success">
							Facture validÃ©e et Transmise
							</span>';
					$btn ='';
				}

				$btn .='<button class="btn btn-xs bg-danger square-btn-adjust" data-toggle="modal" data-target=".supprimerFacture_'.$reponse['ref_fact'].'" title="Supprimer la facture">
			                    <i class="fas fa-times"></i> 
			                </button>';
			                
			    if ($reponse['master_data']!='' && $reponse['master_data']!=null) {
					
					$btn = '<button class="btn btn-xs bg-secondary square-btn-adjust" onclick="window.open(\'../FACTURES DOSSIERS/'.$reponse['ref_fact'].'/'.$reponse['master_data'].'\',\'pop1\',\'width=1000,height=800\');"title="Master Data">
			                    <i class="fas fa-copy"></i> 
			                </button>
			                '.$btn;
				}

			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_fact'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['nom_util'];?>
				</td>
				<td style="text-align: center;">
					<button class="btn bg-primary btn-xs square-btn-adjust" onclick="window.open('generateurFacturePartielle.php?ref_fact=<?php echo $reponse['ref_fact'];?>','pop1','width=1000,height=800');" title="GÃ©nÃ©rer la facture">
	                    <i class="fas fa-eye"></i> 
	                </button>

					<?php 
						echo 
						$btn;
					?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function getTotalForFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			// $requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
			// 										det.tva AS tva,
			// 										(det.montant) AS ht
			// 									FROM debours d, detail_facture_dossier det
			// 									WHERE det.ref_fact = ?
			// 										AND det.id_deb = d.id_deb');

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

				$tbl .= '
						<td style="text-align: right; font-size: 12px; border: 1px solid black;font-weight: bold; color: rgb(30,144,255);" width="20%">'
							.number_format($sommeTTC, 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						';
			return $tbl;
		}

		public function getTotalHTFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT SUM(
														IF(det.usd="1",
															det.montant,
															det.montant/dos.roe_decl)
													) AS montant
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();

			return $reponse['montant'];
		}

		public function getTotalTVAFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT SUM(
														IF(det.usd="1",
															IF(det.tva="1",
																(det.montant*0.16),
																0),
															IF(det.tva="1",
																((det.montant/dos.roe_decl)*0.16),
																0)
															)
													) AS montant
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();

			return $reponse['montant'];
		}

		public function getARSPForFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													(det.montant) AS ht
												FROM debours d, detail_facture_dossier det
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND d.id_deb = 12');
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht'];

				$sommeTVA += 0;
				$sommeTTC += $reponse['ht'];

			}

				$tbl .= '
						<td style="text-align: right; border: 1px solid black;font-weight: bold;" width="20%">'
							.number_format(($sommeTTC*0.012), 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						';
			return $tbl;
		}

		public function getMontantARSPForFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			if ($this-> getFactureGlobale($ref_fact)['id_mod_lic']=='1') {
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND d.id_deb = 25');
			}else{
				$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
														det.tva AS tva,
														(det.montant) AS ht
													FROM debours d, detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = d.id_deb
														AND d.id_t_deb = 3');
			}

			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht'];

				$sommeTVA += 0;
				$sommeTTC += $reponse['ht'];

			}

				$tbl .= '
						<td style="text-align: right; border: 1px solid black;font-weight: bold;" width="20%">'
							.number_format(($sommeTTC*0.012), 2, ',', ' ').
						'&nbsp;&nbsp;</td>
						';
			return ($sommeTTC*0.012);
		}

		public function getMontantDeboursClientModeleLicence($id_deb, $id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare("SELECT af.montant AS montant
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
													ORDER BY deb.nom_deb ASC");
			$requete-> execute(array($entree['id_deb'], $entree['id_deb'], $entree['id_deb']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantDeboursClientModeleLicenceMarchandiseModeTransport($id_deb, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $id_dos=NULL){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			if ($id_deb == 7 && $id_march!=17) {
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*50;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 5 && empty($this-> getDossier($id_dos)['pied_container'])) { // FERE
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*3;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 5 && !empty($this-> getDossier($id_dos)['pied_container'])) { // FERE
				$reponse['montant'] = 0;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 196 && $this-> getDossier($id_dos)['pied_container']=='10') { // Container 10'
				$reponse['montant'] = 25;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 197 && $this-> getDossier($id_dos)['pied_container']=='20') { // Container 20'
				$reponse['montant'] = 50;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 198 && $this-> getDossier($id_dos)['pied_container']=='40') { // Container 40'
				$reponse['montant'] = 100;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 6 && $id_march == 13) {
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*8;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 8 && $id_march == 13) {
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*100;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 6) {
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*5;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 11) {
				if ($this-> getDossier($id_dos)['poids']<=30) {
					// $reponse['montant'] = 125;
					$reponse['montant'] = 300;
				}else{
					$reponse['montant'] = 0;
				}
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 12) {
				if ($this-> getDossier($id_dos)['poids']>30) {
					// $reponse['montant'] = 250;
					$reponse['montant'] = 450;
				}else{
					$reponse['montant'] = 0;
				}
				$reponse['tva'] = '0';
				return $reponse;
			}else{
				$requete = $connexion-> prepare("SELECT *
													FROM affectation_debours_client_modele_licence
													WHERE id_deb = ?
														AND id_mod_lic = ?
														AND id_cli = ?
														AND id_march = ?
														AND id_mod_trans = ?");
				$requete-> execute(array($entree['id_deb'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
				$reponse = $requete-> fetch();
				
				if ($reponse) {
					return $reponse;
				}else{
					$reponse['montant'] = NULL;
					$reponse['tva'] = '0';
					$reponse['id_deb'] = '0';
					return $reponse;
				}
			}

		}

		public function getMontantDeboursClientModeleLicenceMarchandiseModeTransport2($id_deb, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $id_dos=NULL){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			if ($id_deb == 7 && $id_march!=17) {
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*50;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 5) {
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*3;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 6 && $id_march == 13) {
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*8;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 8 && $id_march == 13) {
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*100;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 6) {
				$reponse['montant'] = $this-> getDossier($id_dos)['poids']*5;
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 11) {
				if ($this-> getDossier($id_dos)['poids']<=30) {
					// $reponse['montant'] = 125;
					$reponse['montant'] = 300;
				}else{
					$reponse['montant'] = 0;
				}
				$reponse['tva'] = '0';
				return $reponse;
			}else if ($id_deb == 12) {
				if ($this-> getDossier($id_dos)['poids']>30) {
					// $reponse['montant'] = 250;
					$reponse['montant'] = 450;
				}else{
					$reponse['montant'] = 0;
				}
				$reponse['tva'] = '0';
				return $reponse;
			}else{
				$requete = $connexion-> prepare("SELECT *
													FROM affectation_debours_client_modele_licence
													WHERE id_deb = ?
														AND id_mod_lic = ?
														AND id_cli = ?
														AND id_march = ?
														AND id_mod_trans = ?");
				$requete-> execute(array($entree['id_deb'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
				$reponse = $requete-> fetch();
				
				if ($reponse) {
					return $reponse;
				}else{
					$reponse['montant'] = 1;
					$reponse['tva'] = '0';
					$reponse['id_deb'] = '0';
					return $reponse;
				}
			}

		}

		public function getDataAffectationDeboursClientModeleLicence($id_deb, $id_cli, $id_mod_lic, $id_march, $id_mod_trans){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$tbl = '';

			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;

			$requete = $connexion-> prepare("SELECT af.montant AS montant
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
														AND af.id_march = ?
														AND af.id_mod_trans = ?");
			$requete-> execute(array($entree['id_deb'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse;
			}else{
				return 0;
			}
		}

		public function getMontantDeboursFactureDossierExcluDebours($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(det.montant) AS montant
													FROM debours deb, detail_facture_dossier det
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb <> ?
														AND det.id_dos = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantDeboursDetailFacture($ref_fact, $id_deb){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT det.montant AS montant
													FROM detail_facture_dossier det
													WHERE det.ref_fact = ?
														AND det.id_deb = ?
													ORDER BY det.id_dos DESC
													LIMIT 0, 1");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantTVADeboursFactureDossierExcluDebours($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(det.montant*0.16) AS montant
													FROM debours deb, detail_facture_dossier det
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb <> ?
														AND det.id_dos = ?
														AND det.tva = '1'");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantDeboursFactureDossier($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT SUM(IF(det.usd='1', det.montant, det.montant/dos.roe_decl)) AS montant
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			return $reponse['montant'];
		}

		public function getMontantDeboursFactureDossier2($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT ROUND(det.montant, 3) AS montant
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['montant'];
			}else{
				return NULL;
			}
			
		}

		public function getMontantTVADeboursFactureDossier($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT ROUND(det.montant_tva, 3) AS montant_tva
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['montant_tva'];
			}else{
				return NULL;
			}
			
		}

		public function getTVADeboursFactureDossier($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT det.tva AS tva
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['tva'];
			}else{
				return '0';
			}
			
		}

		public function getMontantDeboursUnderValue($id_cli, $id_deb, $id_mod_lic, $id_mod_trans, $id_march){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("SELECT montant
												FROM debours_under_value
												WHERE id_cli = ?
													AND id_deb = ?
													ANd id_mod_lic = ?
													AND id_mod_trans = ?
													AND id_march = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_deb'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_march']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['montant'];
			}else{
				return NULL;
			}
			
		}

		public function getPourcentageDeboursFactureDossier2($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['id_deb'] = $id_deb;
			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT det.pourcentage_qte AS pourcentage_qte
													FROM debours deb, detail_facture_dossier det, dossier dos
													WHERE deb.id_deb = det.id_deb
														AND det.ref_fact = ?
														AND det.id_deb = ?
														AND det.id_dos = ?
														AND dos.id_dos = det.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb'], $entree['id_dos']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['pourcentage_qte'];
			}else{
				return NULL;
			}
			
		}

		public function getBureauDouane($id_bur_douane){
			include('connexion.php');
			$entree['id_bur_douane'] = $id_bur_douane;

			$requete = $connexion-> prepare("SELECT *
												FROM bureau_douane
												WHERE id_bur_douane = ?");
			$requete-> execute(array($entree['id_bur_douane']));
			$reponse = $requete-> fetch();

			if ($reponse) {
				return $reponse;
			}else{
				return null;
			}
			
		}

		public function getDataDossierFacturePartielle($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT dos.*,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(dos.load_date, '%d/%m/%Y') AS load_date,
													DATE_FORMAT(dos.exit_drc, '%d/%m/%Y') AS exit_drc,
													(IF(dos.fob IS NULL, 0, dos.fob) +IF(dos.fret IS NULL, 0, dos.fret)+IF(dos.assurance IS NULL, 0, dos.assurance)+IF(dos.autre_frais IS NULL, 0, dos.autre_frais)) AS cif,
													IF(dos.id_mod_lic='1', cl.nom_cli, dos.supplier) AS supplier
												FROM facture_dossier fd, detail_facture_dossier df, dossier dos, client cl
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos
													AND dos.id_cli = cl.id_cli");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataDossiersMultipleInvoice($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT MIN(dos.num_lot) AS num_lot_min,
													MAX(dos.num_lot) AS num_lot_max,
													MIN(dos.ref_dos) AS ref_dos_min,
													MAX(dos.ref_dos) AS ref_dos_max,
													COUNT(DISTINCT(dos.id_dos)) AS nbre_dos,
													dos.*,
													UPPER(CONCAT(
														IF(dos.horse IS NOT NULL,
															dos.horse,
															NULL),
														IF(dos.trailer_1 IS NOT NULL,
															CONCAT('/',dos.trailer_1),
															NULL),
														IF(dos.trailer_1 IS NOT NULL,
															CONCAT('/',dos.trailer_2),
															NULL)
														)) AS truck,
													fd.num_cmpt AS num_cmpt,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(dos.load_date, '%d/%m/%Y') AS load_date,
													DATE_FORMAT(dos.exit_drc, '%d/%m/%Y') AS exit_drc,
													dos.date_quit AS date_quit2,
													-- IF(dos.date_quit<='2023-08-19',
													IF(DATEDIFF(dos.date_quit,'2023-08-21')<=0,
														'BCC',
														'Bank'
													) AS text_banq,
													(IF(dos.fob IS NULL, 0, dos.fob) +IF(dos.fret IS NULL, 0, dos.fret)+IF(dos.assurance IS NULL, 0, dos.assurance)+IF(dos.autre_frais IS NULL, 0, dos.autre_frais)) AS cif,
													(IF(dos.fob_usd IS NULL, 0, dos.fob_usd) +IF(dos.fret_usd IS NULL, 0, dos.fret_usd)+IF(dos.assurance_usd IS NULL, 0, dos.assurance_usd)+IF(dos.autre_frais_usd IS NULL, 0, dos.autre_frais_usd)) AS cif_usd,
													((IF(dos.fob_usd IS NULL, 0, dos.fob_usd) +IF(dos.fret_usd IS NULL, 0, dos.fret_usd)+IF(dos.assurance_usd IS NULL, 0, dos.assurance_usd)+IF(dos.autre_frais_usd IS NULL, 0, dos.autre_frais_usd)))*dos.roe_inv AS cif_cdf,
													IF(dos.id_mod_lic='1', cl.nom_cli, dos.supplier) AS supplier,
													mt.nom_mod_trans AS nom_mod_trans,
													dos.supplier AS supplier
												FROM facture_dossier fd, detail_facture_dossier df, dossier dos, client cl, mode_transport mt
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos
													AND dos.id_cli = cl.id_cli
													AND dos.id_mod_trans = mt.id_mod_trans
												GROUP BY fd.ref_fact");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataDossiersFactureDebours($ref_fact, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(df.id_dos)) AS nbre_dos
												FROM detail_facture_dossier df
												WHERE df.ref_fact = ?
													AND df.id_deb = ?
													AND df.montant > 0
												GROUP BY df.ref_fact");
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataCompteBancaire($num_cmpt){
			include('connexion.php');
			$entree['num_cmpt'] = $num_cmpt;

			$requete = $connexion-> prepare("SELECT *
												FROM banque, compte_bancaire
												WHERE compte_bancaire.id_banq = banque.id_banq
													AND compte_bancaire.num_cmpt = ?");
			$requete-> execute(array($entree['num_cmpt']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getDataBancaire($id_banq){
			include('connexion.php');
			$entree['id_banq'] = $id_banq;

			$requete = $connexion-> prepare("SELECT *
												FROM banque
												WHERE id_banq = ?");
			$requete-> execute(array($entree['id_banq']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse;
			}else{
				$reponse['id_banq'] = null;
				$reponse['nom_banq'] = '-';
				return $reponse;
			}
			
		}

		public function getRangDossierFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$liste = '';
			$liste_tmp = '';
			$last = '';
			$tmp_last = '';
			$tmp_last_next = '';
			$next_last = '';
			$next_last_2 = '';
			$dossier_suivant = '';

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos, dos.id_dos AS id_dos
												FROM facture_dossier fd, detail_facture_dossier df, dossier dos
												WHERE fd.ref_fact = ?
													AND fd.ref_fact = df.ref_fact
													AND df.id_dos = dos.id_dos
												GROUP BY dos.id_dos
												ORDER BY dos.id_dos");
			$requete-> execute(array($entree['ref_fact']));
			while($reponse = $requete-> fetch()){

				// $next_last = substr($reponse['ref_dos'], strrpos($reponse['ref_dos'],'-')+1);


				if($liste==''){
					// $liste = '&nbsp;'.$reponse['ref_dos'];
					$liste = $reponse['ref_dos'];
					$last = substr($reponse['ref_dos'], strrpos($reponse['ref_dos'],'-')+1);
				}else{

					$tmp_last = $last;
					// $tmp_last++;
					$tmp_last_next = $tmp_last;
					$tmp_last_next++;

					$last = substr($reponse['ref_dos'], strrpos($reponse['ref_dos'],'-')+1);
					$next_last = $last;
					$next_last++;

					$dossier_suivant = $reponse['ref_dos'];
					$dossier_suivant++;

					if($last!=$tmp_last_next){
						// $liste .= '<br>&nbsp;'.$reponse['ref_dos'];
						$liste .= ', '.$reponse['ref_dos'];
					}elseif (empty($this-> verifierDossierFacture($dossier_suivant, $ref_fact))) {
						$liste .= ' a '.$last;
					}else if($last==$tmp_last_next){
						// $liste .= ' a '.$last;
					}else{
						// $liste .= '<br>&nbsp;'.$reponse['ref_dos'];
						$liste .= ', '.$reponse['ref_dos'];
					}
					

				}

			}$requete-> closeCursor();
			return $liste;
			// return $last;
		}


		public function verifierDossierFacture($ref_dos, $ref_fact){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT dossier.id_dos
												FROM dossier, detail_facture_dossier
												WHERE dossier.ref_dos = ?
													AND dossier.id_dos = detail_facture_dossier.id_dos
													AND detail_facture_dossier.ref_fact = ?");
			$requete-> execute(array($entree['ref_dos'], $entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_dos'];
			}
		}


		public function verifierLastDossierFacture($id_dos, $ref_fact){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT MAX(dossier.ref_dos) AS ref_dos
												FROM dossier, detail_facture_dossier
												WHERE dossier.id_dos = ?
													AND dossier.id_dos = detail_facture_dossier.id_dos
													AND detail_facture_dossier.ref_fact = ?");
			$requete-> execute(array($entree['id_dos'], $entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['ref_dos'];
			}
		}


		// public function getRangDossierFacture($ref_fact){  
		// w334, 435, 4354
		// 	include('connexion.php');
		// 	$entree['ref_fact'] = $ref_fact;

		// 	$liste = '';
		// 	$liste_tmp = '';
		// 	$last = '';
		// 	$tmp_last = '';
		// 	$next_last = '';

		// 	$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos
		// 										FROM facture_dossier fd, detail_facture_dossier df, dossier dos
		// 										WHERE fd.ref_fact = ?
		// 											AND fd.ref_fact = df.ref_fact
		// 											AND df.id_dos = dos.id_dos
		// 										GROUP BY dos.id_dos
		// 										ORDER BY dos.id_dos");
		// 	$requete-> execute(array($entree['ref_fact']));
		// 	while($reponse = $requete-> fetch()){

		// 		// $next_last = substr($reponse['ref_dos'], strrpos($reponse['ref_dos'],'-')+1);


		// 		if($liste==''){
		// 			$liste = '&nbsp;'.$reponse['ref_dos'];
		// 			$last = substr($reponse['ref_dos'], strrpos($reponse['ref_dos'],'-')+1);
		// 		}else{

		// 			$tmp_last = $last;
		// 			$last = substr($reponse['ref_dos'], strrpos($reponse['ref_dos'],'-')+1);
		// 			$next_last = $tmp_last;
		// 			$next_last++;

		// 			if ($next_last==$last) {
		// 				if($tmp_last!=$last){
		// 					$liste = $liste.', '.$last;
		// 				}elseif($tmp_last==$last){
		// 					$liste = $liste.' a '.$last;
		// 				}
		// 			}else{
		// 				$liste .= '<br>&nbsp;'.$reponse['ref_dos'];
		// 			}

		// 		}

		// 	}$requete-> closeCursor();
		// 	return $liste;
		// 	// return $last;
		// }

		public function getNbreDossierEnAttenteFacture($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;


			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND ref_decl IS NOT NULL
													AND date_decl IS NOT NULL
													AND ref_liq IS NOT NULL
													AND date_liq IS NOT NULL
													AND ref_quit IS NOT NULL
													AND date_quit IS NOT NULL
													AND not_fact = '0'
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getNbreDossier($statut, $id_mod_lic=NULL, $id_cli=NULL){
			include('connexion.php');

			if ($statut=='Dossiers En Cours') {
				$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE cleared = '0'
													AND ref_dos NOT LIKE '%20-%'
													AND (id_mod_lic = '1' OR id_mod_lic = '2')");
				$reponse=$requete-> fetch();
				if($reponse){
					return $reponse['nbre'];
				}else{
					return false;
				}
			}else if ($statut=='Dossiers non declarÃ©s') {
				$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE cleared = '0'
													AND ref_dos NOT LIKE '%20-%'
													AND (id_mod_lic = '1' OR id_mod_lic = '2')
													AND ref_decl IS NULL
													AND date_decl IS NULL");
				$reponse=$requete-> fetch();
				if($reponse){
					return $reponse['nbre'];
				}else{
					return false;
				}
			}else if ($statut=='Dossiers DeclarÃ©s Non LiquidÃ©s') {
				$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE cleared = '0'
													AND ref_dos NOT LIKE '%20-%'
													AND (id_mod_lic = '1' OR id_mod_lic = '2')
													AND ref_decl IS NOT NULL
													AND date_decl IS NOT NULL
													AND ref_liq IS NULL
													AND date_liq IS NULL");
				$reponse=$requete-> fetch();
				if($reponse){
					return $reponse['nbre'];
				}else{
					return false;
				}
			}else if ($statut=='Dossiers En Attente Quittance') {
				$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE cleared = '0'
													AND ref_dos NOT LIKE '%20-%'
													AND (id_mod_lic = '1' OR id_mod_lic = '2')
													AND ref_liq IS NOT NULL
													AND date_liq IS NOT NULL
													AND ref_quit IS NULL
													AND date_quit IS NULL");
				$reponse=$requete-> fetch();
				if($reponse){
					return $reponse['nbre'];
				}else{
					return false;
				}
			}

		}

		public function getNbreDossierEnAttenteFactureModeTransportMarchandise($id_mod_lic, $id_cli, $id_mod_trans, $id_march){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;

			if($id_mod_lic==1){
				$sqlIdMarch = ' AND id_march = '.$id_march;
			}else if($id_march==16 || $id_march=6){
				$sqlIdMarch = ' AND id_march = '.$id_march;
			}else{
				$sqlIdMarch = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
													$sqlIdMarch
													AND ref_quit IS NOT NULL
													AND ref_quit <> ''
													AND ref_decl IS NOT NULL
													AND ref_decl <> ''
													AND ref_liq IS NOT NULL
													AND ref_liq <> ''
													AND not_fact = '0'
													AND id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function buildReferenceTransmissionFactureClient($id_cli){
			include('connexion.php');

			$code = '';

			$i = 1;

			$a = $this-> getTailleCompteur2($i);

			$code = $a.$this-> getClient($id_cli)['code_cli'].date('y');

			while($this-> verifierReferenceTransmissionFacture($code) == true){
				$i++;

				$a = $this-> getTailleCompteur2($i);

				$code = $a.$this-> getClient($id_cli)['code_cli'].date('y');
			}

			return $code;
		}

		public function verifierTransmisFactureDossier($ref_trans_fact, $date_trans_fact){
			include('connexion.php');
			$entree['ref_trans_fact'] = $ref_trans_fact;
			$entree['date_trans_fact'] = $date_trans_fact;

			$requete = $connexion-> prepare("SELECT id_trans_fact
												FROM transmis_facture_dossier
												WHERE ref_trans_fact = ?
													AND date_trans_fact = ?");
			$requete-> execute(array($entree['ref_trans_fact'], $entree['date_trans_fact']));
			$reponse = $requete-> fetch();
			return $reponse['id_trans_fact'];
		}

		public function verifierReferenceTransmissionFacture($ref_trans_fact){
			include('connexion.php');
			$entree['ref_trans_fact'] = $ref_trans_fact;

			$requete = $connexion-> prepare("SELECT id_trans_fact
												FROM transmis_facture_dossier
													WHERE ref_trans_fact = ?");
			$requete-> execute(array($entree['ref_trans_fact']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function getUtilisateurClientModeleLicence($id_util, $id_mod_lic){
			include('connexion.php');
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT cl.*
												FROM client cl, utilisateur u, affectation_utilisateur_client af, affectation_client_modele_licence aff
												WHERE u.id_util = ?
													AND u.id_util = af.id_util
													AND af.id_cli = cl.id_cli
													AND cl.id_cli = aff.id_cli
													AND aff.id_mod_lic = ?");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}else{
				return false;
			}
		}

		public function getDataMarchandise($id_march){
			include('connexion.php');
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare('SELECT *, CONCAT("-", code_march) AS code_march_2
												FROM marchandise
												WHERE id_march = ?');
			$requete-> execute(array($entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function buildRefFactureGlobale($id_cli, $id_mod_lic=NULL, $id_mod_trans=NULL, $id_march=NULL){
			include('connexion.php');

			if(isset($_POST['id_march'])){
				$_GET['id_march'] = $_POST['id_march'];
			}

			if (isset($id_cli) && ($id_cli!=null)) {

				$entree['id_cli'] = $id_cli;
				$code = '';

				if (isset($_GET['id_mod_lic_fact']) &&  $_GET['id_mod_lic_fact']=='1') {
					
					$code = $this-> getLastFactureDossier($id_cli, $_GET['id_mod_lic_fact'], $_GET['id_mod_trans'], $_GET['id_march']);
					
					
					// $i = 1;

					// if (!empty($this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic_fact'], date('Y'), $_GET['id_march'])) && ($this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic_fact'], date('Y'), $_GET['id_march'])!='')) {
					// 	$i = $this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic_fact'], date('Y'), $_GET['id_march'])['compteur_fact'];
					// }

					// $a = $this-> getTailleCompteur2($i);
					// // 2022-MTS-EXP-HC-037

					// if ($_GET['id_cli']=='845') {
					// 	$a = $this-> getTailleCompteur($i);
					// 	$code_march = '';
					// }else{
					// 	$code_march = '-'.$this-> getDataMarchandise($_GET['id_march'])['code_march'];
					// }

					// $code = date('Y').'-'.$this-> codePourClient($id_cli).'-EXP'.$code_march.'-'.$a;

					// while($this-> verifierExistanceRefFactureDossier($code) == true){
					// 	$i++;

					// 	$a = $this-> getTailleCompteur2($i);

					// 	if ($_GET['id_cli']=='845') {
					// 		$a = $this-> getTailleCompteur($i);
					// 	}

					// 	$code = date('Y').'-'.$this-> codePourClient($id_cli).'-EXP'.$code_march.'-'.$a;
					// }

				}else if (isset($_POST['id_mod_lic']) && ($_POST['id_mod_lic']=='1')) {
					
					
					$i = 1;

					if (!empty(($this-> getCompteurFactureClientModeleLic($id_cli, $_POST['id_mod_lic'], date('Y'), $_GET['id_march']))) && ($this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic'], date('Y'), $_GET['id_march'])!='')) {
						$i = $this-> getCompteurFactureClientModeleLic($id_cli, $_POST['id_mod_lic'], date('Y'), $_GET['id_march'])['compteur_fact'];
					}

					$a = $this-> getTailleCompteur2($i);
					// 2022-MTS-EXP-HC-037

					if ($_GET['id_cli']=='845') {
						$a = $this-> getTailleCompteur($i);
						$code_march = '';
					}else{
						$code_march = '-'.$this-> getDataMarchandise($_GET['id_march'])['code_march'];
					}

					$code = date('Y').'-'.$this-> codePourClient($id_cli).'-EXP'.$code_march.'-'.$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true){
						$i++;

						if ($_GET['id_cli']=='845') {
							$a = $this-> getTailleCompteur($i);
						}

						$a = $this-> getTailleCompteur2($i);

						$code = date('Y').'-'.$this-> codePourClient($id_cli).'-EXP'.$code_march.'-'.$a;
					}

				}else if (isset($_POST['id_mod_lic']) &&  $_POST['id_mod_lic']=='2' && $id_march==NULL) {

					
					$i = 1;

					if (!empty($this-> getCompteurFactureClientModeleLic($id_cli, $_POST['id_mod_lic'], date('Y'), $_POST['id_march'])) && ($this-> getCompteurFactureClientModeleLic($id_cli, $_POST['id_mod_lic'], date('Y'), $_POST['id_march'])!='')) {
						$i = $this-> getCompteurFactureClientModeleLic($id_cli, $_POST['id_mod_lic'], date('Y'), $_POST['id_march'])['compteur_fact'];
					}

					$a = $this-> getTailleCompteur($i);
					// 2022-MTS-EXP-HC-037

					$code_march = $this-> getDataMarchandise($_POST['id_march'])['code_march_2'];
					

					$code = date('Y').'-'.$this-> codePourClient($id_cli).$code_march.'-'.$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true){
						$i++;

						$a = $this-> getTailleCompteur($i);

						$code = date('Y').'-'.$this-> codePourClient($id_cli).$code_march.'-'.$a;
					}

				}else if (isset($_GET['id_mod_lic_fact']) &&  $_GET['id_mod_lic_fact']=='2') {

					$code = $this-> getLastFactureDossier($id_cli, $_GET['id_mod_lic_fact'], $_GET['id_mod_trans'], $_GET['id_march']);
					
					// $i = 1;

					// if (!empty($this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic_fact'], date('Y'), $_GET['id_march'])) && ($this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic_fact'], date('Y'), $_GET['id_march'])!='')) {
					// 	$i = $this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic_fact'], date('Y'), $_GET['id_march'])['compteur_fact'];
					// }

					// $a = $this-> getTailleCompteur($i);

					// $code_march = $this-> getDataMarchandise($_GET['id_march'])['code_march_2'];
					

					// $code = date('Y').'-'.$this-> codePourClient($id_cli).$code_march.'-'.$a;

					// while($this-> verifierExistanceRefFactureDossier($code) == true){
					// 	$i++;

					// 	$a = $this-> getTailleCompteur($i);

					// 	$code = date('Y').'-'.$this-> codePourClient($id_cli).$code_march.'-'.$a;
					// }

				}else if (isset($id_mod_lic) &&  $id_mod_lic=='2') {
					// echo '<br>id_mod_lic = '.$id_mod_lic;
					// echo '<br>id_mod_trans = '.$id_mod_trans;
					// echo '<br>id_march = '.$id_march;
					$code = $this-> getLastFactureDossier($id_cli, $id_mod_lic, $id_mod_trans, $id_march);
					
				}else{

					
					$i = 1;

					if (!empty($this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic_fact'], date('Y'), $_GET['id_march'])) && ($this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic_fact'], date('Y'), $_GET['id_march'])!='')) {
						$i = $this-> getCompteurFactureClientModeleLic($id_cli, $_GET['id_mod_lic_fact'], date('Y'), $_GET['id_march'])['compteur_fact'];
					}

					$a = $this-> getTailleCompteur($i);
					// 2022-MTS-EXP-HC-037

					$code_march = $this-> getDataMarchandise($_GET['id_march'])['code_march_2'];
					

					$code = date('Y').'-'.$this-> codePourClient($id_cli).$code_march.'-'.$a;

					while($this-> verifierExistanceRefFactureDossier($code) == true){
						$i++;

						$a = $this-> getTailleCompteur($i);

						$code = date('Y').'-'.$this-> codePourClient($id_cli).'-'.$code_march.'-'.$a;
					}

				}

				return $code;

			}else{

				return null;

			}

		}

		public function buildRefFactureNoteDebitCredit($id_cli, $type_note){
			include('connexion.php');

			if ($type_note=='1') {
				$masque_note = '-ND-';
			}else if($type_note=='2') {
				$masque_note = '-NC-';
			}else {
				$masque_note = '-';
			}

			$i = 1;

			$a = $this-> getTailleCompteur($i);
			//'2023-ND-PIPC-004
			$code = date('Y').$masque_note.$this-> codePourClient($id_cli).'-'.$a;

			while($this-> verifierExistanceRefFactureDossier($code) == true){
				$i++;

				$a = $this-> getTailleCompteur($i);

				$code = date('Y').$masque_note.$this-> codePourClient($id_cli).'-'.$a;
			}

			return $code;

		}

		public function verifierExistanceRefFactureDossier($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM facture_dossier
													WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function getAllDataDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT d.*, cl.*, UPPER(ml.nom_mod_lic) AS nom_mod_lic,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_ouvert,
													DATE_FORMAT(DATE_ADD(d.date_creat_dos, INTERVAL 2 hour), '%d/%m/%Y %H:%i:%s') AS date_ouvert_2,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos,
													UPPER(mt.nom_mod_trans) AS nom_mod_trans,
													(IF(d.fob IS NULL, 0, d.fob)+IF(d.fret IS NULL, 0, d.fret)+IF(d.assurance IS NULL, 0, d.assurance)+IF(d.autre_frais IS NULL, 0, d.autre_frais)) AS cif,
													d.fob AS fob,
													DATE(d.date_creat_dos) AS date_creat_dos_2,
													d.reg_dgda AS reg_dgda
												FROM dossier d, client cl, modele_licence ml, mode_transport mt
													WHERE d.id_dos = ?
														AND d.id_cli = cl.id_cli
														AND d.id_mod_lic = ml.id_mod_lic
														AND d.id_mod_trans = mt.id_mod_trans");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function afficherBoutonFormulaireFacturePartielle($id_dos){
			include('connexion.php');
			// $entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$entree['id_dos'] = $id_dos;
			echo '<td></td>';
			$compteur = '0';
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos
												FROM dossier
												WHERE id_dos = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;
			?>
				<li class="nav-item">
					<a class="nav-link <?php echo $active;?>" href="#tab_<?php echo $reponse['id_dos'];?>" data-toggle="tab">
						Dossier <?php echo $reponse['ref_dos'];?>
					</a>
				</li>
			<?php
			}$requete-> closeCursor();

		}

		public function creerDetailTransmisFactureDossier($id_trans_fact, $ref_fact){
			include('connexion.php');

			$entree['id_trans_fact'] = $id_trans_fact;
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare('INSERT INTO detail_transmis_facture_dossier(id_trans_fact, ref_fact)
												VALUES(?, ?)');
			$requete-> execute(array($entree['id_trans_fact'], $entree['ref_fact']));

		}

		public function creerPaiementFacture($ref_fact, $ref_paie, $date_paie, $num_cmpt_paie, $id_util_paie){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['ref_paie'] = $ref_paie;
			$entree['date_paie'] = $date_paie;
			$entree['num_cmpt_paie'] = $num_cmpt_paie;
			$entree['id_util_paie'] = $id_util_paie;

			$requete = $connexion-> prepare('UPDATE facture_dossier 
												SET ref_paie = ?, date_paie = ?, num_cmpt_paie = ?, id_util_paie = ?, date_create_paie = NOW()
												WHERE ref_fact = ?');
			$requete-> execute(array($entree['ref_paie'], $entree['date_paie'], $entree['num_cmpt_paie'], $entree['id_util_paie'], $entree['ref_fact']));

		}

		public function creerPaiementFactureBackUp($ref_fact, $ref_paie, $date_paie, $montant_paie, $libelle_paie){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['ref_paie'] = $ref_paie;
			$entree['date_paie'] = $date_paie;
			$entree['montant_paie'] = $montant_paie;
			$entree['libelle_paie'] = $libelle_paie;

			$requete = $connexion-> prepare('INSERT INTO paiement_facture(ref_fact, ref_paie, date_paie, montant_paie, libelle_paie)
												VALUES(?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_fact'], $entree['ref_paie'], $entree['date_paie'], $entree['montant_paie'], $entree['libelle_paie']));

		}

		public function paiement_facture($ref_paie, $date_paie, $montant_paie, $ref_fact, $id_tres){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['ref_paie'] = $ref_paie;
			$entree['date_paie'] = $date_paie;
			$entree['montant_paie'] = $montant_paie;
			$entree['id_tres'] = $id_tres;

			// echo '<br>ref_fact = '.$ref_fact;
			// echo '<br>ref_paie = '.$ref_paie;
			// echo '<br>date_paie = '.$date_paie;
			// echo '<br>montant_paie = '.$montant_paie;
			// echo '<br>id_tres = '.$id_tres;

			$requete = $connexion-> prepare('INSERT INTO paiement_facture(ref_fact, ref_paie, date_paie, montant_paie, id_tres, id_util)
												VALUES(?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_fact'], $entree['ref_paie'], $entree['date_paie'], $entree['montant_paie'], $entree['id_tres'], $_SESSION['id_util']));

		}

		public function paiement_facture_fournisseur($ref_paie, $date_paie, $montant, $id_fact, $id_tres){
			include('connexion.php');

			$entree['id_fact'] = $id_fact;
			$entree['ref_paie'] = $ref_paie;
			$entree['date_paie'] = $date_paie;
			$entree['montant'] = $montant;
			$entree['id_tres'] = $id_tres;

			// echo '<br>id_fact = '.$id_fact;
			// echo '<br>ref_paie = '.$ref_paie;
			// echo '<br>date_paie = '.$date_paie;
			// echo '<br>montant = '.$montant;
			// echo '<br>id_tres = '.$id_tres;

			$requete = $connexion-> prepare('INSERT INTO paiement_facture_fournisseur(id_fact, ref_paie, date_paie, montant, id_tres, id_util)
												VALUES(?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['id_fact'], $entree['ref_paie'], $entree['date_paie'], $entree['montant'], $entree['id_tres'], $_SESSION['id_util']));

		}

		public function new_vendor($nom_four, $nif_four, $rccm_four, $adr_four, $tel_four){
			include('connexion.php');

			$entree['nom_four'] = $nom_four;
			$entree['nif_four'] = $nif_four;
			$entree['rccm_four'] = $rccm_four;
			$entree['tel_four'] = $tel_four;
			$entree['adr_four'] = $adr_four;

			// echo '<br>adr_four = '.$adr_four;
			// echo '<br>nom_four = '.$nom_four;
			// echo '<br>nif_four = '.$nif_four;
			// echo '<br>rccm_four = '.$rccm_four;
			// echo '<br>tel_four = '.$tel_four;

			$requete = $connexion-> prepare('INSERT INTO fournisseur(nom_four, nif_four, rccm_four, tel_four, adr_four)
												VALUES(?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['nom_four'], $entree['nif_four'], $entree['rccm_four'], $entree['tel_four'], $entree['adr_four']));

		}

		public function new_invoice($ref_fact, $date_fact, $montant, $remarque, $id_four){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['date_fact'] = $date_fact;
			$entree['montant'] = $montant;
			$entree['id_four'] = $id_four;
			$entree['remarque'] = $remarque;

			// echo '<br>remarque = '.$remarque;
			// echo '<br>ref_fact = '.$ref_fact;
			// echo '<br>date_fact = '.$date_fact;
			// echo '<br>montant = '.$montant;
			// echo '<br>id_four = '.$id_four;

			$requete = $connexion-> prepare('INSERT INTO facture_fournisseur(ref_fact, date_fact, montant, id_four, remarque, id_util)
												VALUES(?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_fact'], $entree['date_fact'], $entree['montant'], $entree['id_four'], $entree['remarque'], $_SESSION['id_util']));

		}

		public function new_mouvement($date_mvt, $entree, $sortie, $libelle, $reference, $id_tres){
			include('connexion.php');

			if ($entree=='') {
				$entree=null;
			}

			if ($sortie=='') {
				$sortie=null;
			}

			// echo '<br>date_mvt = '.$date_mvt;
			// echo '<br>entree = '.$entree;
			// echo '<br>sortie = '.$sortie;
			// echo '<br>libelle = '.$libelle;
			// echo '<br>reference = '.$reference;
			// echo '<br>id_tres = '.$id_tres;

			$tab['date_mvt'] = $date_mvt;
			$tab['entree'] = $entree;
			$tab['sortie'] = $sortie;
			$tab['libelle'] = $libelle;
			$tab['reference'] = $reference;
			$tab['id_tres'] = $id_tres;

			// $tab['date_mvt'] = $date_mvt;

			$requete = $connexion-> prepare('INSERT INTO mouvement_tresorerie(date_mvt, entree, sortie, libelle, reference, id_tres, id_util)
												VALUES(?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($tab['date_mvt'], $tab['entree'], $tab['sortie'], $tab['libelle'], $tab['reference'], $tab['id_tres'], $_SESSION['id_util']));

		}

		public function edit_mouvement($date_mvt, $entree, $sortie, $libelle, $reference, $id_mvt){
			include('connexion.php');

			if ($entree=='') {
				$entree=null;
			}

			if ($sortie=='') {
				$sortie=null;
			}

			// echo '<br>date_mvt = '.$date_mvt;
			// echo '<br>entree = '.$entree;
			// echo '<br>sortie = '.$sortie;
			// echo '<br>libelle = '.$libelle;
			// echo '<br>reference = '.$reference;
			// echo '<br>id_mvt = '.$id_mvt;

			$tab['date_mvt'] = $date_mvt;
			$tab['entree'] = $entree;
			$tab['sortie'] = $sortie;
			$tab['libelle'] = $libelle;
			$tab['reference'] = $reference;
			$tab['id_mvt'] = $id_mvt;

			// $tab['date_mvt'] = $date_mvt;

			$requete = $connexion-> prepare('UPDATE mouvement_tresorerie 
												SET date_mvt = ?, entree = ?, sortie = ?, libelle = ?, reference = ?
												WHERE id_mvt = ?');
			$requete-> execute(array($tab['date_mvt'], $tab['entree'], $tab['sortie'], $tab['libelle'], $tab['reference'], $tab['id_mvt']));

		}

		public function creerFactureDossier($ref_fact, $id_mod_fact, $id_cli, $id_util, $id_mod_lic, $type_fact, $information, $note_debit='0', $type_case=NULL, $taux=NULL){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['id_mod_fact'] = $id_mod_fact;
			$entree['id_cli'] = $id_cli;
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$entree['information'] = $information;
			$entree['note_debit'] = $note_debit;
			$entree['type_case'] = $type_case;
			$entree['taux'] = $taux;

			// echo "<br>ref_fact = $ref_fact";
			// echo "<br>id_mod_fact = $id_mod_fact";
			// echo "<br>id_cli = $id_cli";
			// echo "<br>id_util = $id_util";
			// echo "<br>id_mod_lic = $id_mod_lic";
			// echo "<br>type_fact = $type_fact";
			// echo "<br>information = $information";
			// echo "<br>note_debit = $note_debit";

			$requete = $connexion-> prepare('INSERT INTO facture_dossier(ref_fact, id_mod_fact, id_cli, id_util, 
																			id_mod_lic, type_fact, information, 
																			note_debit, type_case, taux)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_fact'], $entree['id_mod_fact'], $entree['id_cli'], $entree['id_util'], 
									$entree['id_mod_lic'], $entree['type_fact'], $entree['information'], 
									$entree['note_debit'], $entree['type_case'], $entree['taux']));

		}
		
		public function creerNoteDebit($ref_note, $id_model_nd, $id_cli, $id_util, $id_mod_lic, $libelle){
			include('connexion.php');

			$entree['ref_note'] = $ref_note;
			$entree['id_model_nd'] = $id_model_nd;
			$entree['id_cli'] = $id_cli;
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['libelle'] = $libelle;

			// echo "<br>ref_note = $ref_note";
			// echo "<br>id_model_nd = $id_model_nd";
			// echo "<br>id_cli = $id_cli";
			// echo "<br>id_util = $id_util";
			// echo "<br>id_mod_lic = $id_mod_lic";
			// echo "<br>type_fact = $type_fact";
			// echo "<br>information = $information";
			// echo "<br>note_debit = $note_debit";

			$requete = $connexion-> prepare('INSERT INTO note_debit(ref_note, id_model_nd, id_cli, id_util, 
																			id_mod_lic, libelle)
												VALUES(?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_note'], $entree['id_model_nd'], $entree['id_cli'], $entree['id_util'], 
									$entree['id_mod_lic'], 
									$entree['libelle']));

		}
		
		public function creerFactureDossierWithDuty($ref_fact, $id_mod_fact, $id_cli, $id_util, $id_mod_lic, $type_fact, $information, $note_debit='0', $with_duty){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['id_mod_fact'] = $id_mod_fact;
			$entree['id_cli'] = $id_cli;
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;
			$entree['information'] = $information;
			$entree['note_debit'] = $note_debit;
			$entree['with_duty'] = $with_duty;

			$requete = $connexion-> prepare('INSERT INTO facture_dossier(ref_fact, id_mod_fact, id_cli, id_util, 
																			id_mod_lic, type_fact, information, 
																			note_debit, with_duty)
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_fact'], $entree['id_mod_fact'], $entree['id_cli'], $entree['id_util'], 
									$entree['id_mod_lic'], $entree['type_fact'], $entree['information'], 
									$entree['note_debit'], $entree['with_duty']));

		}
		
		public function getMontantFactureDeboursDossier3($ref_fact, $id_deb, $id_dos){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht_usd,
													det.detail AS detail
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND dos.id_dos = ?
													AND det.id_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return round($sommeHT,3);
		}

		public function getMontantFacturePourDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT SUM(
														IF(det.usd="0", 
															IF(det.tva="1",
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																	),
																det.montant/dos.roe_decl
															), 
															IF(det.tva="1",
																det.montant*1.16,
																det.montant
															)
														)
													) AS montant_usd,
													det.ref_fact AS ref_fact,
													fact.date_fact AS date_fact,
													"Invoiced" AS statut_invoice

												FROM debours d, detail_facture_dossier det, dossier dos, facture_dossier fact
												WHERE det.id_deb = d.id_deb
													AND det.ref_fact = fact.ref_fact
													AND det.id_dos = dos.id_dos
													AND dos.id_dos = ?
												GROUP BY dos.id_dos');
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();

			if ($reponse['statut_invoice']!='Invoiced') {
				$reponse['statut_invoice'] = 'Pending';
			}

			if ($reponse) {
				return $reponse;
			}else{
				$reponse['statut_invoice'] = 'Pending';
				$reponse['montant_usd'] = null;
				$reponse['ref_fact'] = null;
				return $reponse;
			}
		}

		public function getMontantFactureDebours($ref_fact, $id_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_deb'] = $id_deb;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
													AND det.id_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function getMontantFactureTypeDeboursDossier($ref_fact, $id_t_deb, $id_dos){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;
			$entree['id_dos'] = $id_dos;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos, type_debours t
												WHERE det.ref_fact = ?
													AND det.id_deb = d.id_deb
													AND t.id_t_deb = d.id_t_deb
													AND t.id_t_deb = ?
													AND det.id_dos = dos.id_dos
													AND det.id_dos = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb'], $entree['id_dos']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function getMontantFactureTypeDebours($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos, type_debours t
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND t.id_t_deb = d.id_t_deb
													AND t.id_t_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function getMontantFactureTypeDeboursSansFinancialCost($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_t_deb'] = $id_t_deb;


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare('SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd="1", 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd="1", 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos, type_debours t
												WHERE det.ref_fact = ?
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND d.id_deb NOT LIKE 54
													AND d.id_deb NOT LIKE 101
													AND t.id_t_deb = d.id_t_deb
													AND t.id_t_deb = ?
												GROUP BY d.id_deb');
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function afficherFormulaireFacturePartielle($id_dos){
			include('connexion.php');
			// $entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$entree['id_dos'] = $id_dos;
			echo '<td></td>';
			$compteur = '0';
			$sous_compteur = 0;
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, principal, roe_decl, fob, 
													fret, assurance, autre_frais, poids
												FROM dossier
												WHERE id_dos = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;

				if ($reponse['roe_decl']>0) {
					// code...
				}else{
					$reponse['roe_decl'] = 2000;
				}
			?>
			<div class="tab-pane <?php echo $active;?> small" id="tab_<?php echo $reponse['id_dos']?>">
				<div class="row">
						<div class="col-md-8">
						  <table class="table table-sm table-bordered table-hover table-dark table-head-fixed">
						    <thead>
						        <tr>
						            <th colspan="2">DEBOURS</th>
						            <th>UNITE</th>
						            <th>MONTANT</th>
						            <th>DEVISE</th>
						            <th>TVA</th>
						        </tr>
						    </thead>
						    <tbody>
						    	<?php
						    		$this-> getDeboursPourFactureClientModeleLicence($this-> getDossier($id_dos)['id_cli'], $_GET['id_mod_lic_fact'], $compteur, $sous_compteur, $reponse['principal'], $id_dos);
						    	?>
						    </tbody>
						</table>
					</div>
					<div class="col-md-4">
			    		<input type="hidden" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $ref_fact?>">
			    		<input type="hidden" name="id_dos_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos']?>">
			    			<div class="row">
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Taux</label>
						            <input type="number" step="0.0001" min="0" name="roe_decl_<?php echo $compteur;?>" id="roe_decl" onblur="getTotal()" value="<?php echo $reponse['roe_decl'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">FOB</label>
						            <input type="number" step="0.0001" min="0" name="fob_<?php echo $compteur;?>" value="<?php echo $reponse['fob'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Fret</label>
						            <input type="number" step="0.0001" min="0" name="fret_<?php echo $compteur;?>" value="<?php echo $reponse['fret'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Assurance</label>
						            <input type="number" step="0.0001" min="0" name="assurance_<?php echo $compteur;?>" value="<?php echo $reponse['assurance'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Autres Charges</label>
						            <input type="number" step="0.0001" min="0" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Poids (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_<?php echo $compteur;?>" value="<?php echo $reponse['poids'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">Autres informations / Autres DÃ©tails sur la Facture:</label>
						            <input type="text" name="info" value="" class="form-control form-control-sm cc-exp bg bg-dark">
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL ($):</label>
						            <input type="text" name="total" id="totalUSD" class="form-control text-danger form-control-lg cc-exp" style="text-align: center; font-weight: bold;background-color: black;" disabled>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL (CDF):</label>
						            <input type="text" name="" id="totalCDF" class="form-control text-primary form-control-lg cc-exp bg" style="text-align: center; font-weight: bold;background-color: black;" disabled>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL GÃ©nÃ©ral ($):</label>
						            <input type="text" name="" id="total" class="form-control form-control-lg cc-exp bg text-success " style="text-align: center; font-weight: bold; background-color: black;" disabled>
						        </div>
			    			</div>
						</div>
				</div>
			</div>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherFormulaireFacturePartielleEdit($id_dos){
			include('connexion.php');
			// $entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$entree['id_dos'] = $id_dos;
			echo '<td></td>';
			$compteur = '0';
			$sous_compteur = 0;
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, principal, roe_decl, fob, 
													fret, assurance, autre_frais, poids
												FROM dossier
												WHERE id_dos = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;

				if ($reponse['roe_decl']>0) {
					// code...
				}else{
					$reponse['roe_decl'] = 2000;
				}
			?>
			<div class="tab-pane <?php echo $active;?> small" id="tab_<?php echo $reponse['id_dos']?>">
				<div class="row">
						<div class="col-md-8">
						  <table class="table table-sm table-bordered table-hover table-dark table-head-fixed">
						    <thead>
						        <tr>
						            <th colspan="2">DEBOURS</th>
						            <th>UNITE</th>
						            <th>MONTANT</th>
						            <th>DEVISE</th>
						            <th>TVA</th>
						        </tr>
						    </thead>
						    <tbody>
						    	<?php
						    		$this-> getDeboursPourFactureClientModeleLicenceEdit($this-> getDossier($id_dos)['id_cli'], $_GET['id_mod_lic_fact'], $compteur, $sous_compteur, $reponse['principal'], $id_dos);
						    	?>
						    </tbody>
						</table>
					</div>
					<div class="col-md-4">
			    		<input type="hidden" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $ref_fact?>">
			    		<input type="hidden" name="id_dos_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos']?>">
			    			<div class="row">
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Taux</label>
						            <input type="number" step="0.0001" min="0" name="roe_decl_<?php echo $compteur;?>" id="roe_decl" onblur="getTotal()" value="<?php echo $reponse['roe_decl'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">FOB</label>
						            <input type="number" step="0.0001" min="0" name="fob_<?php echo $compteur;?>" value="<?php echo $reponse['fob'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Fret</label>
						            <input type="number" step="0.0001" min="0" name="fret_<?php echo $compteur;?>" value="<?php echo $reponse['fret'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Assurance</label>
						            <input type="number" step="0.0001" min="0" name="assurance_<?php echo $compteur;?>" value="<?php echo $reponse['assurance'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Autres Charges</label>
						            <input type="number" step="0.0001" min="0" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-6">
						            <label for="x_card_code" class="control-label mb-1">Poids (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_<?php echo $compteur;?>" value="<?php echo $reponse['poids'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">Autres informations / Autres DÃ©tails sur la Facture:</label>
						            <input type="text" name="info" value="" class="form-control form-control-sm cc-exp bg bg-dark">
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL ($):</label>
						            <input type="text" name="total" id="totalUSD" class="form-control text-danger form-control-lg cc-exp" style="text-align: center; font-weight: bold;background-color: black;" disabled>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL (CDF):</label>
						            <input type="text" name="" id="totalCDF" class="form-control text-primary form-control-lg cc-exp" style="text-align: center; font-weight: bold;background-color: black;" disabled>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">TOTAL GÃ©nÃ©ral ($):</label>
						            <input type="text" name="" id="total" class="form-control form-control-lg cc-exp bg text-success " style="text-align: center; font-weight: bold;background-color: black;" disabled>
						        </div>
			    			</div>
						</div>
				</div>
			</div>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherFormulaireFacturePartielleEdit2($id_dos){
			include('connexion.php');
			// $entree['ref_dos'] = $this-> getDossier($id_dos)['ref_dos'];
			$entree['id_dos'] = $id_dos;
			echo '<td></td>';
			$compteur = '0';
			$sous_compteur = 0;
			$active = '';
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, principal, roe_decl, fob, 
													fret, assurance, autre_frais, poids
												FROM dossier
												WHERE id_dos = ?
												ORDER BY id_dos");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				if ($compteur == '0') {
					$active = ' active';
					$ref_fact = $_GET['ref_fact'];
				}else{
					$active = '';
					$ref_fact = $compteur.'-'.$_GET['ref_fact'];
				}
				$compteur++;
			?>
			<div class="tab-pane <?php echo $active;?> small" id="tab_<?php echo $reponse['id_dos']?>">
			  <table class="table table-sm table-bordered table-hover table-dark table-head-fixed">
			    <thead>
			    	<tr>
			    		<input type="hidden" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $ref_fact?>">
			    		<input type="hidden" name="id_dos_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos']?>">
			    		<th colspan="5">
			    			<div class="row">
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Taux</label>
						            <input type="number" step="0.0001" min="0" id="roe_decl" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">FOB</label>
						            <input type="number" step="0.0001" min="0" name="fob_<?php echo $compteur;?>" value="<?php echo $reponse['fob'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Fret</label>
						            <input type="number" step="0.0001" min="0" name="fret_<?php echo $compteur;?>" value="<?php echo $reponse['fret'];?>" class="form-control cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Assurance</label>
						            <input type="number" step="0.0001" min="0" name="assurance_<?php echo $compteur;?>" value="<?php echo $reponse['assurance'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Autres Charges</label>
						            <input type="number" step="0.0001" min="0" name="autre_frais_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-2">
						            <label for="x_card_code" class="control-label mb-1">Poids (Kg)</label>
						            <input type="number" step="0.0001" min="0" name="poids_<?php echo $compteur;?>" value="<?php echo $reponse['poids'];?>" class="form-control form-control-sm cc-exp bg bg-dark" required>
						        </div>
			    				<div class="col-md-12">
						            <label for="x_card_code" class="control-label mb-1">Autres informations / Autres DÃ©tails sur la Facture:</label>
						            <input type="text" name="info" value="" class="form-control cc-exp bg bg-dark">
						        </div>
			    			</div>
			    		</th>
			    	</tr>
			        <tr>
			            <th colspan="2">DEBOURS</th>
			            <th>MONTANT</th>
			            <th>DEVISE</th>
			            <th>TVA</th>
			        </tr>
			    </thead>
			    <tbody>
			    	<?php
			    		$this-> getDeboursPourFactureClientModeleLicenceEdit($this-> getDossier($id_dos)['id_cli'], $_GET['id_mod_lic_fact'], $compteur, $sous_compteur, $reponse['principal'], $id_dos);
			    	?>
			    </tbody>
			</table>
			</div>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function nbreFactureModeleLicence($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($type_fact) && ($type_fact != '')) {
				$sqlTypeFact = ' AND type_fact = "'.$type_fact.'"';
			}else{
				$sqlTypeFact = '';
			}


			$requete = $connexion-> prepare("SELECT COUNT(ref_fact) AS nbre
											FROM facture_dossier
											WHERE id_mod_lic = ?
												AND note_debit = '0'
											$sql
											$sqlTypeFact");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function getMontantTotalTypeFacture($id_mod_lic, $id_cli, $type_fact){
			include('connexion.php');
			$entree['type_fact'] = $type_fact;
			$entree['id_mod_lic'] = $id_mod_lic;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'" ';
			}


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare("SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													SUM( 
														IF(det.usd='1', 
															0,
															det.montant
														) 
													) AS ht_cdf,
													SUM( 
														IF(det.usd='1', 
															det.montant,
															(det.montant/dos.roe_decl)
														) 
													) AS ht_usd
												FROM debours d, detail_facture_dossier det, dossier dos, facture_dossier fd
												WHERE fd.type_fact = ?
													AND fd.id_mod_lic = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_deb = d.id_deb
													AND det.id_dos = dos.id_dos
												GROUP BY det.id_deb");
			$requete-> execute(array($entree['type_fact'], $entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){

				$sommeHT += $reponse['ht_usd'];

				if($reponse['tva'] == '0'){
					$sommeTVA += 0;
					$sommeTTC += $reponse['ht_usd'];
				}else{
					$tva = round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTVA += $tva;
					$ttc = $reponse['ht_usd'] + round(($reponse['ht_usd'] * 0.16), 2);
					$sommeTTC += $ttc;
				}

				// $sommeHT += $reponse['ht'];

				// if($reponse['tva'] == '0'){
				// 	$sommeTVA += 0;
				// 	$sommeTTC += $reponse['ht'];
				// }else{
				// 	$tva = round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTVA += $tva;
				// 	$ttc = $reponse['ht'] + round(($reponse['ht'] * 0.16), 2);
				// 	$sommeTTC += $ttc;
				// }

			}

			return $sommeTTC;
		}

		public function getMontantTotalTypeDeboursFacture($ref_fact, $id_t_deb){
			include('connexion.php');
			$entree['id_t_deb'] = $id_t_deb;
			$entree['ref_fact'] = $ref_fact;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'" ';
			}


			$sommeTVA = 0;
			$sommeHT = 0;
			$sommeTTC = 0;


			$requete = $connexion-> prepare("SELECT d.nom_deb AS nom_deb,
													det.tva AS tva,
													d.abr_deb AS abr_deb,
													SUM(det.montant) AS ht,
													-- SUM( 
													-- 	IF(det.usd='1', 
													-- 		det.montant*dos.roe_decl,
													-- 		det.montant
													-- 	) 
													-- ) AS montant_cdf,
													-- SUM( 
													-- 	IF(det.usd='1', 
													-- 		det.montant,
													-- 		(det.montant/dos.roe_decl)
													-- 	) 
													-- ) AS montant_usd,
													SUM(
														IF(det.usd='0', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																	),
																det.montant/dos.roe_decl
															), 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															)
														)
													) AS montant_usd,
													SUM(
														IF(det.usd='0', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	det.montant_tva+det.montant,
																	det.montant*0.16
																	),
																det.montant
															), 
															IF(det.tva='1',
																(det.montant*dos.roe_decl)*1.16,
																(det.montant*dos.roe_decl)
															)
														)
													) AS montant_cdf
												FROM debours d, detail_facture_dossier det, dossier dos, facture_dossier fd
												WHERE fd.ref_fact = ?
													$sqlClient
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													AND det.id_deb = d.id_deb
													AND d.id_t_deb = ?
												GROUP BY d.id_t_deb");
			$requete-> execute(array($entree['ref_fact'], $entree['id_t_deb']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function nbreStatutDossierAir($id_mod_lic, $id_cli, $statut){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['statut'] = $statut;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($statut) && ($statut == 'EXPECTED ARRIVAL')) {
				$sqlStatut = ' AND klsa_arriv IS NULL ';
			}else if (isset($statut) && ($statut == 'AWAITING ENTRY TO WAREHOUSE')) {
				$sqlStatut = ' AND wiski_arriv IS NULL  AND klsa_arriv IS NOT NULL ';
			}else if (isset($statut) && ($statut == 'AWAITING TO LEAVE THE WAREHOUSE')) {
				$sqlStatut = ' AND wiski_dep IS NULL  AND wiski_arriv IS NOT NULL';
			}else if (isset($statut) && ($statut == 'AWAITING DISPATCH FROM THE BORDER')) {
				$sqlStatut = ' AND dispatch_klsa IS NULL AND wiski_dep IS NOT NULL ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE id_mod_lic = ?
												AND id_mod_trans = 3
												AND ref_dos <> 'test'
												-- AND cleared = '0'
												$sql
												$sqlStatut");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function statut_dossier_air($id_cli, $id_mod_lic, $statut){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['statut'] = $statut;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			$compteur = 0;
			$rows = array();

			$sqlStatut = '';

			if (isset($statut) && ($statut == 'EXPECTED ARRIVAL')) {
				$sqlStatut = ' AND klsa_arriv IS NULL ';
			}else if (isset($statut) && ($statut == 'AWAITING ENTRY TO WAREHOUSE')) {
				$sqlStatut = ' AND wiski_arriv IS NULL  AND klsa_arriv IS NOT NULL ';
			}else if (isset($statut) && ($statut == 'AWAITING TO LEAVE THE WAREHOUSE')) {
				$sqlStatut = ' AND wiski_dep IS NULL  AND wiski_arriv IS NOT NULL';
			}else if (isset($statut) && ($statut == 'AWAITING DISPATCH FROM THE BORDER')) {
				$sqlStatut = ' AND dispatch_klsa IS NULL AND wiski_dep IS NOT NULL ';
			}

			$requete = $connexion-> prepare("SELECT *,
													CONCAT('<button class=\"btn btn-xs bg-warning square-btn-adjust\" onclick=\"modal_edit_statut_dossier_air(\'',id_dos,'\');\">
									                    <i class=\"fas fa-edit\"></i> 
									                </button>') AS btn_action 
											FROM dossier
											WHERE id_mod_lic = ?
												AND id_mod_trans = 3
												AND ref_dos <> 'test'
												-- AND cleared = '0'
												$sql
												$sqlStatut");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				// $reponse['btn_action'] .= '<a href="file:///'.$this-> getPathArchive($reponse['id_dos']).'/'.$reponse['ref_dos'].'">Find Support Documents</a>';

				$reponse['compteur'] = $compteur;

				$rows[] = $reponse;
			}$requete-> closeCursor();


			return $rows;

		}

		public function transmis_apurement($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND dos.id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			$compteur = 0;
			$rows = array();

			$requete = $connexion-> prepare("SELECT trans.ref_trans_ap AS ref_trans_ap,
													DATE_FORMAT(trans.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													DATE_FORMAT(trans.date_depot, '%d/%m/%Y') AS date_depot,
													-- trans.date_depot AS date_depot,
													trans.banque AS banque,
													COUNT(det.id_dos) AS nbre_dos,
													COUNT(DISTINCT(dos.num_lic)) AS nbre_lic,
													cl.nom_cli AS nom_cli,
													trans.id_trans_ap AS id_trans_ap,
													trans.fichier_trans_ap AS fichier_trans_ap,
													IF(trans.date_depot IS NOT NULL,
														'1',
														'0'
													) AS status
											-- FROM transmission_apurement trans
											-- 	LEFT JOIN detail_apurement det
											-- 		ON det.id_trans_ap = trans.id_trans_ap
											-- 	LEFT JOIN dossier dos
											-- 		ON dos.id_dos = det.id_dos
											-- 	LEFT JOIN client cl
											-- 		ON dos.id_cli = cl.id_cli
											-- WHERE trans.id_mod_lic = ?
											FROM transmission_apurement trans, detail_apurement det,  dossier dos, client cl
											WHERE  det.id_trans_ap = trans.id_trans_ap
												AND dos.id_dos = det.id_dos
												AND dos.id_cli = cl.id_cli
												$sql
												AND trans.id_mod_lic = ?
											GROUP BY trans.id_trans_ap
											ORDER BY trans.id_trans_ap DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				// $reponse['btn_action'] .= '<a href="file:///'.$this-> getPathArchive($reponse['id_dos']).'/'.$reponse['ref_dos'].'">Find Support Documents</a>';

				$reponse['compteur'] = $compteur;
				$reponse['btn_action'] = $this-> checkArchivedFile($reponse['id_trans_ap'], $reponse['fichier_trans_ap'], $reponse['ref_trans_ap']);
				$reponse['btn_action'] .= ' <button class="btn btn-xs bg bg-warning square-btn-adjust" onclick="modal_modifier_transmis('.$reponse['id_trans_ap'].');">
							                    <i class="fas fa-edit"></i> 
							                </button>';

				$rows[] = $reponse;
			}$requete-> closeCursor();


			return $rows;

		}

		public function checkArchivedFile($id_trans_ap, $fichier_trans_ap, $ref_trans_ap){
			if(isset($fichier_trans_ap) && ($fichier_trans_ap!="") && file_exists('../transmision_apurements/'.$id_trans_ap.'/'.$fichier_trans_ap)){
				return '<button class="btn btn-xs bg bg-info square-btn-adjust" title="AccusÃ©e de rÃ©ception" onclick="window.open(\'../transmision_apurements/'.$id_trans_ap.'/'.$fichier_trans_ap.'\',\'pop1\',\'width=900,height=700\');">
		                    <i class="fas fa-file"></i>
		                </button>';
			}else{
				return '<button class="btn btn-xs btn-dark square-btn-adjust" title="Loger AccusÃ©e de rÃ©ception" onclick="modal_archive_transmis_apurement('.$id_trans_ap.',\''.$ref_trans_ap.'\');">
		                    <i class="fa fa-upload"></i>
		                </button>';
			}
		}

		public function nbreDossierFacturesModeleLicence($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND fd.id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(det.id_dos)) AS nbre
											FROM facture_dossier fd, detail_facture_dossier det
											WHERE fd.id_mod_lic = ?
												AND fd.note_debit = '0'
												AND fd.ref_fact = det.ref_fact
											$sql");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierNonFacturesModeleLicence($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND d.id_cli = '.$id_cli;
			}else{
				$sqlClient = '';
			}


			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client c
												WHERE d.id_mod_lic = ?
													AND d.id_dos NOT IN(
														SELECT dos.id_dos AS id_dos
			 												FROM facture_dossier fd, client cl, utilisateur u, detail_facture_dossier det, dossier dos
															WHERE fd.id_util = u.id_util
																AND fd.id_cli = cl.id_cli
																AND fd.note_debit = '0'
																AND fd.ref_fact = det.ref_fact
																AND det.id_dos = dos.id_dos
															GROUP BY dos.id_dos
													)
													$sqlClient
													AND d.cleared='1'
													AND d.id_cli = c.id_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function getDeboursPourFactureClientModeleLicence($id_cli, $id_mod_lic, $id_march, $id_mod_trans, $id_dos=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$active = '';
			$sqlTypeDebours = '';

			$debours = '';

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				?>
				<tr id="headingOne_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
					<th colspan="6" class="bg bg-secondary">
						<u><?php echo $reponseTypeDebours['nom_t_deb']; ?></u>
					</th>
				</tr>
				<div>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant,
														af.detail AS detail,
														af.unite AS unite
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
													ORDER BY deb.id_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$compteur++;
					

					if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids']/1000)>=30)) {

						$reponseDebours['montant'] = 250;
						
					}

					?>
					<tr>
						<td width="10%">
							<input type="hidden" id="id_deb_<?php echo $compteur;?>" name="id_deb_<?php echo $compteur;?>" value="<?php echo $reponseDebours['id_deb']; ?>">
							<?php echo $reponseDebours['abr_deb']; ?>
						</td>
						<td width="50%">
							<?php 
								echo $reponseDebours['nom_deb']; 
								if ($reponseDebours['detail']=='1') {
								?>
								: <input type="text" style="width: 20em;" name="detail_<?php echo $compteur;?>">
								<?php
								}
							?>
						</td>
						<td style="text-align: center;">
							<span id="unite_<?php echo $compteur;?>"></span>
						</td>
						<td style="text-align: center;">
							<input type="number" step="0.001" name="montant_<?php echo $compteur;?>" id="montant_<?php echo $compteur;?>" value="<?php echo $reponseDebours['montant']; ?>" onblur="getTotal()">

						</td>
						<td style="text-align: center;">
							<select name="usd_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="usd_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['usd'] == '0') {
								?>
								<option value="0">CDF</option>
								<option value="1">USD</option>
								<?php
								}else{
								?>
								<option value="1">USD</option>
								<option value="0">CDF</option>
								<?php
								}
								?>
							</select>
						</td>
						<td style="text-align: center;">
							<select name="tva_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="tva_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['tva'] == '0') {
								?>
								<option value="0">NO</option>
								<option value="1">YES</option>
								<?php
								}else{
								?>
								<option value="1">YES</option>
								<option value="0">NO</option>
								<?php
								}
								?>
							</select>
						</td>
					</tr>
					<?php
				}$requeteDebours-> closeCursor();
				?>
				</div>
				<?php
			}$requeteTypeDebours-> closeCursor();
			?>
			<input type="hidden" name="compteur" value="<?php echo $compteur;?>">
			<?php
		}

		public function getDeboursPourFactureClientModeleLicenceAjax($id_cli, $id_mod_lic, $id_march, $id_mod_trans, $id_dos=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$compteur = 0;
			$active = '';
			$sqlTypeDebours = '';
			$detail_input = '';
			$usd_input = '';
			$tva_input = '';
			$montant_input = '';
			$montant_tva_input = '';
			$unite_input = '';

			$debours = '';

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				$debours .= '
							<tr id="">
								<th colspan="7" class="bg bg-secondary">
									<u>'.$reponseTypeDebours['nom_t_deb'].'</u>
								</th>
							</tr>
							<div>';
				?>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, 
														-- UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														IF(af.montant_min > 0,
															CONCAT(UPPER(REPLACE(deb.nom_deb, '\'', '')), ' (',af.montant_min,'$ min)'),
															UPPER(REPLACE(deb.nom_deb, '\'', ''))
														) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant,
														af.detail AS detail,
														af.unite AS unite,
														af.montant_min AS montant_min
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
														AND af.id_march = ?
														AND af.id_mod_trans = ?
													ORDER BY deb.rang, deb.id_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$compteur++;
					$montant_tva_input = '';

					if ($this-> getDossier($id_dos)['num_lic'] == 'UNDER VALUE' && !empty($this-> getMontantDeboursUnderValue($this-> getDossier($id_dos)['id_cli'], $reponseDebours['id_deb'], $this-> getDossier($id_dos)['id_mod_lic'], $this-> getDossier($id_dos)['id_mod_trans'], $this-> getDossier($id_dos)['id_march']))) {

						$reponseDebours['montant'] = $this-> getMontantDeboursUnderValue($this-> getDossier($id_dos)['id_cli'], $reponseDebours['id_deb'], $this-> getDossier($id_dos)['id_mod_lic'], $this-> getDossier($id_dos)['id_mod_trans'], $this-> getDossier($id_dos)['id_march']);

					}

					$mask_tva = '';
					

					if ($reponseDebours['id_deb']=='32') { // DDI

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" id="montant_tva_ddi" onblur="calculDroit2();">';
						$mask_tva = 'ddi';
						
					}else if ($reponseDebours['id_deb']=='118') { // DDI_2

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi_2" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi_2" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" id="montant_tva_ddi_2" onblur="calculDroit2();">';
						$mask_tva = 'ddi_2';
						
					}else if ($reponseDebours['id_deb']=='119') { // DDI_3

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi_3" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi_3" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'ddi_3';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" id="montant_tva_ddi_3" onblur="calculDroit2();">';
						
					}else if ($reponseDebours['id_deb']=='120') { // DDI_4

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi_4" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi_4" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" id="montant_tva_ddi_4" onblur="calculDroit2();">';
						$mask_tva = 'ddi_4';
						
					}else if ($reponseDebours['id_deb']=='109') {

						$unite_input = '<span></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="tva" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='95') {

						$unite_input = '<span id="unite_fpi"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="fpi" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'fpi';
						
					}else if ($reponseDebours['id_deb']=='38') {

						$unite_input = '<span id="unite_rri"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="rri" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'rri';
						
					}else if ($reponseDebours['id_deb']=='35') {

						$unite_input = '<span id="unite_cog"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="cog" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'cog';
						
					}else if ($reponseDebours['id_deb']=='3') {

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="" id="unite_rls" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="rls" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'rls';
						
					}else if ($reponseDebours['id_deb']=='96') {

						$unite_input = '<span id="unite_dci"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="dci" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" id="montant_tva_dci" onblur="calculDroit2();">';
						$mask_tva = 'dci';
						
					}else if ($reponseDebours['id_deb']=='97') {

						$unite_input = '<span id="unite_autres_taxes"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="autres_taxes" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'autre_taxe';
						
					}else if ($reponseDebours['id_deb']=='29') {

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="" id="unite_frais_bancaire" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="frais_bancaire" value=""><input type="hidden" id="montant_min" name="montant_min" value="'.$reponseDebours['montant_min'].'">';
						
					}else if ($reponseDebours['id_deb']=='94') {

						$unite_input = '';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="tresco" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='45') {

						$trailer_1 = $this-> getDossier($id_dos)['trailer_1'];
						$trailer_2 = $this-> getDossier($id_dos)['trailer_2'];

						if (!empty($trailer_1) && strlen($trailer_1)>5 && !empty($trailer_2) && strlen($trailer_2)>5 ) {
							$reponseDebours['montant']=($reponseDebours['montant']*2);
							$unite_input = '2';
							$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="scelle" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						}else{
							
							$unite_input = '1';
							$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="scelle" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						}

						
					}else if ( $this-> get_facturation_suivi_licence($this-> getDossier($id_dos)['id_cli'], $this-> getDossier($id_dos)['id_mod_lic'])!=false && $this-> checkFileInvoicedLicense($this-> getDossier($id_dos)['num_lic'])!=false && ($reponseDebours['id_deb']=='102' || $reponseDebours['id_deb']=='102')){

						$unite_input = '<span id="unite_'.$compteur.'"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="montant_'.$reponseDebours['id_deb'].'" value="" onblur="getTotal()">';
						$montant_tva_input = '';
						
					}else if ( $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fact_suiv_lic']=='0' && ($reponseDebours['id_deb']=='102' || $reponseDebours['id_deb']=='102')){

						$unite_input = '<span id="unite_'.$compteur.'"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="montant_'.$reponseDebours['id_deb'].'" value="" onblur="getTotal()">';
						$montant_tva_input = '';
						
					}else{

						$unite_input = '<span id="unite_'.$compteur.'"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="montant_'.$reponseDebours['id_deb'].'" value="'.$reponseDebours['montant'].'" onblur="getTotal()">';
						$montant_tva_input = '';
						
					}

					if ($reponseDebours['detail']=='1') {
						$detail_input = ' : <input type="text" style="width: 20em;" name="detail_'.$compteur.'">';
					}else{
						$detail_input = '';
					}

					if ($reponseDebours['usd'] == '0') {
						$usd_input = '<option value="0">CDF</option><option value="1">USD</option>';
					}else{
						$usd_input = '<option value="1">USD</option><option value="0">CDF</option>';
					}

					if ($reponseDebours['tva'] == '0') {
						$tva_input = '<option value="0">NO</option><option value="1">YES</option>';
					}else{
						$tva_input = '<option value="1">YES</option><option value="0">NO</option>';
					}
				
					$debours .= '<tr>
									<td width="10%">
										<input type="hidden" id="id_deb_'.$compteur.'" name="id_deb_'.$compteur.'" value="'.$reponseDebours['id_deb'].'">
										'.$reponseDebours['abr_deb'].'
									</td>
									<td width="50%">
										'.$reponseDebours['nom_deb'].$detail_input.'
									</td>
									<td style="text-align: center;">
										'.$unite_input.'
									</td>
									<td style="text-align: center;">
										'.$montant_input.'

									</td>
									<td style="text-align: center;">
										<select name="usd_'.$compteur.'" id="usd_'.$compteur.'" onchange="getTotal()">
											'.$usd_input.'
										</select>
									</td>
									<td style="text-align: center;">
										<select name="tva_'.$compteur.'" id="tva_'.$mask_tva.'" onchange="getTotal();calculDroit();">
											'.$tva_input.'
										</select>
									</td>
									<td style="text-align: center;">
										'.$montant_tva_input.'

									</td>
								</tr>';

					?>
					
					<?php
				}$requeteDebours-> closeCursor();
				$debours .= '</div>';

			}$requeteTypeDebours-> closeCursor();
			$debours .= '<input type="hidden" name="compteur" value="'.$compteur.'">';

			return $debours;
		}

		public function getDeboursPourFactureClientModeleLicenceAjaxEdit($id_cli, $id_mod_lic, $id_march, $id_mod_trans, $id_dos, $ref_fact){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$compteur = 0;
			$active = '';
			$sqlTypeDebours = '';
			$detail_input = '';
			$usd_input = '';
			$tva_input = '';
			$montant_input = '';
			$unite_input = '';

			$debours = '';

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				$debours .= '
							<tr id="">
								<th colspan="6" class="bg bg-secondary">
									<u>'.$reponseTypeDebours['nom_t_deb'].'</u>
								</th>
							</tr>
							<div>';
				?>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, 
														IF(af.montant_min > 0,
															CONCAT(UPPER(REPLACE(deb.nom_deb, '\'', '')), ' (',af.montant_min,'$ min)'),
															UPPER(REPLACE(deb.nom_deb, '\'', ''))
														) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant_deb,
														af.detail AS detail,
														af.unite AS unite,
														af.montant_min AS montant_min
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
														AND af.id_march = ?
														AND af.id_mod_trans = ?
													ORDER BY deb.rang, deb.id_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$compteur++;

					$mask_tva='';
					$montant_tva_input = '';

					$reponseDebours['montant'] = $this-> getMontantDeboursFactureDossier2($ref_fact, $reponseDebours['id_deb'], $id_dos);
					$montant_tva = $this-> getMontantTVADeboursFactureDossier($ref_fact, $reponseDebours['id_deb'], $id_dos);
					$reponseDebours['pourcentage_qte'] = $this-> getPourcentageDeboursFactureDossier2($ref_fact, $reponseDebours['id_deb'], $id_dos);
					$reponseDebours['tva'] = $this-> getTVADeboursFactureDossier($ref_fact, $reponseDebours['id_deb'], $id_dos);
					

					if ($reponseDebours['id_deb']=='32') { // DDI

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class=""  value="'.$reponseDebours['pourcentage_qte'].'" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" value="'.$montant_tva.'" id="montant_tva_ddi" onblur="calculDroit2();">';
						$mask_tva = 'ddi';
						
					}else if ($reponseDebours['id_deb']=='118') { // DDI_2

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class=""  value="'.$reponseDebours['pourcentage_qte'].'" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi_2" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi_2" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" value="'.$montant_tva.'" id="montant_tva_ddi_2" onblur="calculDroit2();">';
						$mask_tva = 'ddi_2';
						
					}else if ($reponseDebours['id_deb']=='119') { // DDI_3

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class=""  value="'.$reponseDebours['pourcentage_qte'].'" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi_3" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi_3" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" value="'.$montant_tva.'" id="montant_tva_ddi_3" onblur="calculDroit2();">';
						$mask_tva = 'ddi_3';
						
					}else if ($reponseDebours['id_deb']=='120') { // DDI_4

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class=""  value="'.$reponseDebours['pourcentage_qte'].'" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi_4" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi_4" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" value="'.$montant_tva.'" id="montant_tva_ddi_4" onblur="calculDroit2();">';
						$mask_tva = 'ddi_4';
						
					}else if ($reponseDebours['id_deb']=='109') {

						$unite_input = '<span id=""></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="tva" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='95') {

						$unite_input = '<span id="unite_fpi"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="fpi" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'fpi';
						
					}else if ($reponseDebours['id_deb']=='38') {

						$unite_input = '<span id="unite_rri"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="rri" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'rri';
						
					}else if ($reponseDebours['id_deb']=='35') {

						$unite_input = '<span id="unite_cog"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="cog" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'cog';
						
					}else if ($reponseDebours['id_deb']=='3') {

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="" id="unite_rls" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="rls" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'rls';
						
					}else if ($reponseDebours['id_deb']=='96') {

						$unite_input = '<span id="unite_dci"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="dci" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$montant_tva_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_tva_'.$compteur.'" value="'.$montant_tva.'" id="montant_tva_dci" onblur="calculDroit2();">';
						$mask_tva = 'dci';
						
					}else if ($reponseDebours['id_deb']=='97') {

						$unite_input = '<span id="unite_autres_taxes"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="autres_taxes" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						$mask_tva = 'autre_taxe';
						
					}else if ($reponseDebours['id_deb']=='29') {

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="" id="unite_frais_bancaire"  value="'.$reponseDebours['montant_deb'].'" onblur="calculDroit2();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="frais_bancaire" value="'.$reponseDebours['montant'].'"><input type="hidden" id="montant_min" name="montant_min" value="'.$reponseDebours['montant_min'].'">';
						
					}else{

						$unite_input = '<span id="unite_'.$compteur.'"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="montant_'.$reponseDebours['id_deb'].'" value="'.$reponseDebours['montant'].'" onblur="getTotal()">';
						
					}

					if ($reponseDebours['detail']=='1') {
						$detail_input = ' : <input type="text" style="width: 20em;" name="detail_'.$compteur.'">';
					}else{
						$detail_input = '';
					}

					if ($reponseDebours['usd'] == '0') {
						$usd_input = '<option value="0">CDF</option><option value="1">USD</option>';
					}else{
						$usd_input = '<option value="1">USD</option><option value="0">CDF</option>';
					}

					if ($reponseDebours['tva'] == '0') {
						$tva_input = '<option value="0">NO</option><option value="1">YES</option>';
					}else{
						$tva_input = '<option value="1">YES</option><option value="0">NO</option>';
					}
				
					$debours .= '<tr>
									<td width="10%">
										<input type="hidden" id="id_deb_'.$compteur.'" name="id_deb_'.$compteur.'" value="'.$reponseDebours['id_deb'].'">
										'.$reponseDebours['abr_deb'].'
									</td>
									<td width="50%">
										'.$reponseDebours['nom_deb'].$detail_input.'
									</td>
									<td style="text-align: center;">
										'.$unite_input.'
									</td>
									<td style="text-align: center;">
										'.$montant_input.'

									</td>
									<td style="text-align: center;">
										<select name="usd_'.$compteur.'" id="usd_'.$compteur.'" onchange="getTotal()">
											'.$usd_input.'
										</select>
									</td>
									<td style="text-align: center;">
										<select name="tva_'.$compteur.'" id="tva_'.$mask_tva.'" onchange="calculDroit()">
											'.$tva_input.'
										</select>
									</td>
									<td style="text-align: center;">
										'.$montant_tva_input.'

									</td>
								</tr>';

					?>
					
					<?php
				}$requeteDebours-> closeCursor();
				$debours .= '</div>';

			}$requeteTypeDebours-> closeCursor();
			$debours .= '<input type="hidden" name="compteur" value="'.$compteur.'">';

			return $debours;
		}

		public function detail_facture_dossier($id_cli, $id_mod_lic, $id_march, $id_mod_trans, $id_dos, $ref_fact){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$compteur = 0;
			$active = '';
			$sqlTypeDebours = '';
			$detail_input = '';
			$usd_input = '';
			$tva_input = '';
			$montant_input = '';
			$unite_input = '';

			$debours = '';

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				$debours .= '
							<tr id="">
								<th colspan="6" class="bg bg-secondary">
									<u>'.$reponseTypeDebours['nom_t_deb'].'</u>
								</th>
							</tr>
							<div>';
				?>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant,
														af.detail AS detail,
														af.unite AS unite
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
														AND af.id_march = ?
														AND af.id_mod_trans = ?
													ORDER BY deb.rang, deb.id_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$compteur++;

					$reponseDebours['montant'] = $this-> getMontantDeboursFactureDossier2($ref_fact, $reponseDebours['id_deb'], $id_dos);
					$reponseDebours['pourcentage_qte'] = $this-> getPourcentageDeboursFactureDossier2($ref_fact, $reponseDebours['id_deb'], $id_dos);
					

					if ($reponseDebours['id_deb']=='32') { // DDI

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class=""  value="'.$reponseDebours['pourcentage_qte'].'" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='118') { // DDI_2

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class=""  value="'.$reponseDebours['pourcentage_qte'].'" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi_2" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi_2" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='119') { // DDI_3

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class=""  value="'.$reponseDebours['pourcentage_qte'].'" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi_3" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi_3" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='120') { // DDI_4

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class=""  value="'.$reponseDebours['pourcentage_qte'].'" name="pourcentage_qte_ddi_'.$compteur.'" id="pourcentage_qte_ddi_4" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" name="montant_'.$compteur.'" id="ddi_4" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='109') {

						$unite_input = '<span id=""></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="tva" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='95') {

						$unite_input = '<span id="unite_fpi"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="fpi" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='38') {

						$unite_input = '<span id="unite_rri"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="rri" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='35') {

						$unite_input = '<span id="unite_cog"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="cog" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='3') {

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="" id="unite_rls" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="rls" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='96') {

						$unite_input = '<span id="unite_dci"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="dci" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='97') {

						$unite_input = '<span id="unite_autres_taxes"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="autres_taxes" value="'.$reponseDebours['montant'].'" onblur="calculDroit();">';
						
					}else if ($reponseDebours['id_deb']=='29') {

						$unite_input = '<input type="number" step="0.001" style="text-align: center; width: 5em;" class="" name="" id="unite_frais_bancaire" value="" onblur="calculDroit();">';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="frais_bancaire" value="'.$reponseDebours['montant'].'">';
						
					}else{

						$unite_input = '<span id="unite_'.$compteur.'"></span>';
						$montant_input = '<input type="number" step="0.001" style="text-align: center;" class="bg-dark" name="montant_'.$compteur.'" id="montant_'.$reponseDebours['id_deb'].'" value="'.$reponseDebours['montant'].'" onblur="getTotal()">';
						
					}

					if ($reponseDebours['detail']=='1') {
						$detail_input = ' : <input type="text" style="width: 20em;" name="detail_'.$compteur.'">';
					}else{
						$detail_input = '';
					}

					if ($reponseDebours['usd'] == '0') {
						$usd_input = '<option value="0">CDF</option><option value="1">USD</option>';
					}else{
						$usd_input = '<option value="1">USD</option><option value="0">CDF</option>';
					}

					if ($reponseDebours['tva'] == '0') {
						$tva_input = '<option value="0">NO</option><option value="1">YES</option>';
					}else{
						$tva_input = '<option value="1">YES</option><option value="0">NO</option>';
					}
				
					$debours .= '<tr>
									<td width="10%">
										<input type="hidden" id="id_deb_'.$compteur.'" name="id_deb_'.$compteur.'" value="'.$reponseDebours['id_deb'].'">
										'.$reponseDebours['abr_deb'].'
									</td>
									<td width="50%">
										'.$reponseDebours['nom_deb'].$detail_input.'
									</td>
									<td style="text-align: center;">
										'.$unite_input.'
									</td>
									<td style="text-align: center;">
										'.$montant_input.'

									</td>
									<td style="text-align: center;">
										<select name="usd_'.$compteur.'" id="usd_'.$compteur.'" onchange="getTotal()">
											'.$usd_input.'
										</select>
									</td>
									<td style="text-align: center;">
										<select name="tva_'.$compteur.'" id="tva_'.$compteur.'" onchange="getTotal()">
											'.$tva_input.'
										</select>
									</td>
								</tr>';

					?>
					
					<?php
				}$requeteDebours-> closeCursor();
				$debours .= '</div>';

			}$requeteTypeDebours-> closeCursor();
			$debours .= '<input type="hidden" name="compteur" value="'.$compteur.'">';

			return $debours;
		}

		public function getDeboursPourFactureClientModeleLicenceBackUp($id_cli, $id_mod_lic, $compteur_dossier, $sous_compteur, $principal='1', $id_dos){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $sous_compteur;
			$compteur_dossier = $compteur_dossier;
			$active = '';
			$sqlTypeDebours = '';

			if ($principal == '0') {
				$sqlTypeDebours = ' WHERE id_t_deb <> 3';
			}
			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				?>
				<tr id="headingOne_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
					<th colspan="6">
						<a class="btn btn-primary btn-sm" data-toggle="collapse" href="#multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>" role="button" aria-expanded="false" aria-controls="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
							<i class="fa fa-plus"></i>
						</a>
						<?php echo $reponseTypeDebours['nom_t_deb']; ?>
					</th>
				</tr>
				<div>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant,
														af.detail AS detail,
														af.unite AS unite
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
													ORDER BY deb.nom_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$sous_compteur++;
					if($this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos)>0){
						$reponseDebours['montant'] = $this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos);
					}

					if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '59' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = '60.000';

					}else if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '60' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
						
						$reponseDebours['montant'] = '200.000';

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='39') {

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='40') {

						$reponseDebours['montant'] =( 50*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='43') {

						$reponseDebours['montant'] = (3*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44') {

						$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids']/1000)<30)) {

						$reponseDebours['montant'] = 125;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids']/1000)>=30)) {

						$reponseDebours['montant'] = 250;
						
					}

					?>
					<tr class="collapse multi-collapse" id="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
						<td width="10%">
							<input type="hidden" name="id_deb_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $reponseDebours['id_deb']; ?>">
							<?php echo $reponseDebours['abr_deb']; ?>
						</td>
						<td width="50%">
							<?php 
								echo $reponseDebours['nom_deb']; 
								if ($reponseDebours['detail']=='1') {
								?>
								: <input type="text" style="width: 20em;" name="detail_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<?php
								}
							?>
						</td>
						<td style="text-align: center;">
							<select name="unite_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<option  value="<?php echo $reponseDebours['unite']; ?>">
									<?php echo $reponseDebours['unite']; ?>
								</option>
								<option></option>
								<option value="CIF">CIF</option>
								<option value="par declaration">par declaration</option>
							</select>
						</td>
						<td style="text-align: center;">
							<input type="number" step="0.001" name="montant_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="montant_<?php echo $sous_compteur;?>" value="<?php echo $reponseDebours['montant']; ?>" onblur="getTotal()">

						</td>
						<td style="text-align: center;">
							<select name="usd_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="usd_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['usd'] == '0') {
								?>
								<option value="0">CDF</option>
								<option value="1">USD</option>
								<?php
								}else{
								?>
								<option value="1">USD</option>
								<option value="0">CDF</option>
								<?php
								}
								?>
							</select>
						</td>
						<td style="text-align: center;">
							<select name="tva_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="tva_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['tva'] == '0') {
								?>
								<option value="0">NON</option>
								<option value="1">OUI</option>
								<?php
								}else{
								?>
								<option value="1">OUI</option>
								<option value="0">NON</option>
								<?php
								}
								?>
							</select>
						</td>
					</tr>
					<?php
				}$requeteDebours-> closeCursor();
				?>
				</div>
				<?php
			}$requeteTypeDebours-> closeCursor();
			?>
			<input type="hidden" name="sous_compteur_<?php echo $compteur_dossier;?>" id="sous_compteur" value="<?php echo $sous_compteur;?>">
			<?php
		}

		public function getDeboursModeleFacture($id_mod_fact){
			include('connexion.php');
			$entree['id_mod_fact'] = $id_mod_fact;
			$compteur = 0;

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				?>
				<tr id="headingOne_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
					<th colspan="6">
						<a class="btn btn-primary btn-sm" data-toggle="collapse" href="#multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>" role="button" aria-expanded="false" aria-controls="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
							<i class="fa fa-plus"></i>
						</a>
						<?php echo $reponseTypeDebours['nom_t_deb']; ?>
					</th>
				</tr>
				<div>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb
													FROM debours deb, affectation_debours_modele_facture af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_fact = ?");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_fact']));
				while($reponseDebours = $requeteDebours-> fetch()){
					
					$compteur++;
					if ($this-> getDataAffectationDeboursClientModeleLicence($reponseDebours['id_deb'], $_GET['id_cli'], $_GET['id_mod_lic_fact'], $_GET['id_march'], $_GET['id_mod_trans'])) {

						$montant = $this-> getDataAffectationDeboursClientModeleLicence($reponseDebours['id_deb'], $_GET['id_cli'], $_GET['id_mod_lic_fact'], $_GET['id_march'], $_GET['id_mod_trans'])['montant'];

					}
					

					?>
					<tr class="collapse multi-collapse" id="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
						<td width="10%">
							<input type="hidden" name="id_deb_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $reponseDebours['id_deb']; ?>">
							<?php echo $reponseDebours['abr_deb']; ?>
						</td>
						<td width="50%">
							<?php 
								echo $reponseDebours['nom_deb']; 
							?>
						</td>
						<td style="text-align: center;">
							<input type="text" style="text-align: center; width: 8em;" name="unite_<?php echo $reponse['id_deb'];?>" value="1">
						</td>
						<td style="text-align: center;">
							<input type="number" step="0.001" name="montant_<?php echo $compteur;?>" id="montant" value="<?php echo $montant;?>" onblur="getTotal()">

						</td>
						<td style="text-align: center;">
							<select name="usd" id="usd" onchange="getTotal()">
								<option value="0">CDF</option>
								<option value="1">USD</option>
							</select>
						</td>
						<td style="text-align: center;">
							<select name="usd" id="usd" onchange="getTotal()">
								<option value="0">NON</option>
								<option value="1">OUI</option>
							</select>
						</td>
					</tr>
					<?php
				}$requeteDebours-> closeCursor();
				?>
				</div>
				<?php
			}$requeteTypeDebours-> closeCursor();
			?>
			<input type="hidden" name="sous_compteur" id="sous_compteur" value="">
			<?php
		}

		public function getDeboursPourFactureClientModeleLicenceEdit($id_cli, $id_mod_lic, $compteur_dossier, $sous_compteur, $principal='1', $id_dos){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $sous_compteur;
			$compteur_dossier = $compteur_dossier;
			$active = '';
			$sqlTypeDebours = '';

			if ($principal == '0') {
				$sqlTypeDebours = ' WHERE id_t_deb <> 3';
			}

			$requeteTypeDebours = $connexion-> query("SELECT UPPER(nom_t_deb) AS nom_t_deb, id_t_deb
														FROM type_debours
														$sqlTypeDebours");
			while($reponseTypeDebours = $requeteTypeDebours-> fetch()){
				?>
				<tr id="headingOne_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
					<th colspan="6">
						<a class="btn btn-primary btn-sm" data-toggle="collapse" href="#multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>" role="button" aria-expanded="false" aria-controls="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
							<i class="fa fa-plus"></i>
						</a>
						<?php echo $reponseTypeDebours['nom_t_deb']; ?>
					</th>
				</tr>
				<div>
				<?php 
				$requeteDebours = $connexion-> prepare("SELECT deb.abr_deb AS abr_deb, UPPER(REPLACE(deb.nom_deb, '\'', '')) AS nom_deb, 
														deb.id_deb AS id_deb,
														af.tva AS tva, af.usd AS usd, af.montant AS montant,
														af.detail AS detail,
														af.unite AS unite
													FROM debours deb, affectation_debours_client_modele_licence af
													WHERE deb.id_t_deb = ?
														AND deb.id_deb = af.id_deb
														AND af.id_mod_lic = ?
														AND af.id_cli = ?
													ORDER BY deb.nom_deb ASC");
				$requeteDebours-> execute(array($reponseTypeDebours['id_t_deb'], $entree['id_mod_lic'], $entree['id_cli']));
				while($reponseDebours = $requeteDebours-> fetch()){
					$sous_compteur++;
					// if($this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos)>0){
					// 	$reponseDebours['montant'] = $this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos);
					// }

					// if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '59' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
					// 	$reponseDebours['montant'] = '60.000';
					// }else if ($id_cli == 906 && $id_mod_lic == 2 && $reponseDebours['id_deb'] == '60' && isset($_GET['id_dos']) && $this-> getDossier($_GET['id_dos'])['id_mod_trans']==3 ) {
					// 	$reponseDebours['montant'] = '200.000';
					// }

					$reponseDebours['montant'] = $this-> getMontantFactureDeboursDossier3($_GET['ref_fact'], $reponseDebours['id_deb'], $id_dos);
					
					if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='39') {

						$reponseDebours['montant'] = (100*$this-> getDossier($id_dos)['poids'])/1000;

					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='40') {

						$reponseDebours['montant'] =( 50*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='43') {

						$reponseDebours['montant'] = (3*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='44') {

						$reponseDebours['montant'] = (8*$this-> getDossier($id_dos)['poids'])/1000;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids']/1000)<30)) {

						$reponseDebours['montant'] = 125;
						
					}else if ($id_mod_lic == '1' && $reponseDebours['id_deb']=='37' && (($this-> getDossier($id_dos)['poids']/1000)>=30)) {

						$reponseDebours['montant'] = 250;
						
					}
					?>
					<tr class="collapse multi-collapse" id="multiCollapseExample1_<?php echo $reponseTypeDebours['id_t_deb']; ?>">
						<td width="10%">
							<input type="hidden" name="id_deb_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" value="<?php echo $reponseDebours['id_deb']; ?>">
							<?php echo $reponseDebours['abr_deb']; ?>
						</td>
						<td width="50%">
							<?php 
								echo $reponseDebours['nom_deb']; 
								if ($reponseDebours['detail']=='1') {
								?>
								: <input type="text" style="width: 20em;" name="detail_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<?php
								}
							?>
						</td>
						<td style="text-align: center;">
							<select name="unite_<?php echo $sous_compteur.'_'.$compteur_dossier;?>">
								<option  value="<?php echo $reponseDebours['unite']; ?>">
									<?php echo $reponseDebours['unite']; ?>
								</option>
								<option></option>
								<option value="CIF">CIF</option>
								<option value="par declaration">par declaration</option>
							</select>
						</td>
						<td style="text-align: center;">
							<input type="number" step="0.001" name="montant_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="montant_<?php echo $sous_compteur;?>" value="<?php echo $reponseDebours['montant']; ?>" onblur="getTotal()">

						</td>
						<td style="text-align: center;">
							<select name="usd_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="usd_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['usd'] == '0') {
								?>
								<option value="0">CDF</option>
								<option value="1">USD</option>
								<?php
								}else{
								?>
								<option value="1">USD</option>
								<option value="0">CDF</option>
								<?php
								}
								?>
							</select>
						</td>
						<td style="text-align: center;">
							<select name="tva_<?php echo $sous_compteur.'_'.$compteur_dossier;?>" id="tva_<?php echo $sous_compteur;?>" onchange="getTotal()">
								<?php
								if ($reponseDebours['tva'] == '0') {
								?>
								<option value="0">NON</option>
								<option value="1">OUI</option>
								<?php
								}else{
								?>
								<option value="1">OUI</option>
								<option value="0">NON</option>
								<?php
								}
								?>
							</select>
						</td>
					</tr>
					<?php
				}$requeteDebours-> closeCursor();

				?>
				</div>
				<?php
			}$requeteTypeDebours-> closeCursor();
			?>
			<input type="hidden" name="sous_compteur_<?php echo $compteur_dossier;?>" id="sous_compteur" value="<?php echo $sous_compteur;?>">
			<?php
		}

		public function afficherDossierEnAttenteFacture($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT dossier.ref_dos AS ref_dos,
													dossier.id_dos,
													IF(marchandise.nom_march IS NOT NULL,
														marchandise.nom_march,
														dossier.commodity
														)
													 AS commodity,
													dossier.ref_decl AS ref_decl,
													DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
													dossier.ref_liq AS ref_liq,
													DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
													dossier.ref_quit AS ref_quit,
													DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit,
													dossier.fob AS fob, 
													dossier.poids AS poids
												FROM dossier
												LEFT JOIN marchandise
													ON marchandise.id_march = dossier.id_march
												WHERE dossier.id_mod_lic = ?
													AND dossier.id_cli = ?
													AND dossier.ref_decl IS NOT NULL
													AND dossier.date_decl IS NOT NULL
													AND dossier.ref_liq IS NOT NULL
													AND dossier.date_liq IS NOT NULL
													AND dossier.ref_quit IS NOT NULL
													AND dossier.date_quit IS NOT NULL
													AND dossier.id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND dossier.not_fact = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				// include("modalFactureDossier.php");
				
			?>
			<tr style="<?php echo $bg;?>">
				<!-- <input type="hidden" name="id_dos_<?php //echo $compteur;?>" value="<?php //echo $reponse['id_dos'];?>"> -->
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
					&nbsp;&nbsp;
					
					<!-- <button data-toggle="modal" data-target=".facture_<?php echo $reponse['id_dos'];?>" class="btn-xs btn btn-secondary">
						<i class="fa fa-calculator"></i>
					</button> -->

				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['commodity'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
				</td>
				<td class="" style="text-align: right;" class="bg bg-dark">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDossierEnAttenteFactureAjax($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$tbl = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT dossier.ref_dos AS ref_dos,
													dossier.id_dos,
													IF(marchandise.nom_march IS NOT NULL,
														marchandise.nom_march,
														dossier.commodity
														)
													 AS commodity,
													dossier.ref_decl AS ref_decl,
													DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
													dossier.ref_liq AS ref_liq,
													DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
													dossier.ref_quit AS ref_quit,
													DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit,
													dossier.fob AS fob, 
													dossier.poids AS poids
												FROM dossier
												LEFT JOIN marchandise
													ON marchandise.id_march = dossier.id_march
												WHERE dossier.id_mod_lic = ?
													AND dossier.id_cli = ?
													AND dossier.ref_decl IS NOT NULL
													AND dossier.date_decl IS NOT NULL
													AND dossier.ref_liq IS NOT NULL
													AND dossier.date_liq IS NOT NULL
													AND dossier.ref_quit IS NOT NULL
													AND dossier.date_quit IS NOT NULL
													AND dossier.id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND dossier.not_fact = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tbl .= '<tr>
							<td class="" style="text-align: center;" class="bg bg-dark">
								'.$compteur.'
							</td>
							<td class="" style="text-align: center;" class="bg bg-dark">
								'.$reponse['ref_dos'].'
								&nbsp;&nbsp;
								<button class="btn-xs btn-danger" onclick="MAJ_not_fact('.$reponse['id_dos'].', \''.$reponse['ref_dos'].'\', '.$id_cli.', '.$id_mod_lic.');"><i class="fa fa-times"></i> Disable</button>
							</td>
							<td class="" style="text-align: center;" class="bg bg-dark">
								'.$reponse['commodity'].'
							</td>
							<td class="" style="text-align: center;" class="bg bg-dark">
								'.$reponse['ref_decl'].'
							</td>
							<td class="" style="text-align: center;" class="bg bg-dark">
								'.$reponse['date_decl'].'
							</td>
							<td class="" style="text-align: center;" class="bg bg-dark">
								'.$reponse['ref_liq'].'
							</td>
							<td class="" style="text-align: center;" class="bg bg-dark">
								'.$reponse['date_liq'].'
							</td>
							<td class="" style="text-align: center;" class="bg bg-dark">
								'.$reponse['ref_quit'].'
							</td>
							<td class="" style="text-align: center;" class="bg bg-dark">
								'.$reponse['date_quit'].'
							</td>
							<td class="" style="text-align: right;" class="bg bg-dark">
								'.number_format($reponse['fob'], 2, ',', ' ').'
							</td>
							<td class="" style="text-align: right;" class="bg bg-dark">
								'.number_format($reponse['poids'], 2, ',', ' ').'
							</td>
						</tr>';
			}$requete-> closeCursor();

			return $tbl;

		}

		public function afficherDossierEnAttenteFactureAjax2($id_cli, $id_mod_lic, $support_doc){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['support_doc'] = $support_doc;
			$compteur=0;
			$rows = array();

			$requete = $connexion-> prepare("SELECT dossier.ref_dos AS ref_dos,
													dossier.id_dos,
													IF(marchandise.nom_march IS NOT NULL,
														marchandise.nom_march,
														dossier.commodity
														)
													 AS commodity,
													dossier.ref_decl AS ref_decl,
													dossier.date_decl AS date_decl,
													-- DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
													dossier.ref_liq AS ref_liq,
													dossier.date_liq AS date_liq,
													-- DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
													dossier.ref_quit AS ref_quit,
													dossier.date_quit AS date_quit,
													-- DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit,
													dossier.fob AS fob, 
													dossier.poids AS poids,
													IF(dossier.support_doc='1',
														CONCAT('<div class=\"dropdown\">
														  <button class=\"btn btn-secondary btn-xs dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">
														    Action
														  </button>
														  <div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">
														    <a class=\"dropdown-item text-sm text-warning\" href=\"#\" onclick=\"MAJ_support_doc(',dossier.id_dos,',\'',dossier.ref_dos,'\',0)\"><i class=\"fa fa-times\"></i> Unconfirm support documents</a>
														    <a class=\"dropdown-item text-sm text-danger\" href=\"#\" onclick=\"MAJ_not_fact(',dossier.id_dos,',\'',dossier.ref_dos,'\',',dossier.id_cli,',',dossier.id_mod_lic,')\"><i class=\"fa fa-times\"></i> Disable invoicing</a>
														  </div>
														</div>'),
														CONCAT('<div class=\"dropdown\">
														  <button class=\"btn btn-secondary btn-xs dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">
														    Action
														  </button>
														  <div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">
														    <a class=\"dropdown-item text-sm text-primary\" href=\"#\" onclick=\"MAJ_support_doc(',dossier.id_dos,',\'',dossier.ref_dos,'\',1)\"><i class=\"fa fa-check\"></i> Confirm support documents</a>
														    <a class=\"dropdown-item text-sm text-danger\" href=\"#\" onclick=\"MAJ_not_fact(',dossier.id_dos,',\'',dossier.ref_dos,'\',',dossier.id_cli,',',dossier.id_mod_lic,')\"><i class=\"fa fa-times\"></i> Disable invoicing</a>
														  </div>
														</div>')
													) AS btn_action
												FROM dossier
												LEFT JOIN marchandise
													ON marchandise.id_march = dossier.id_march
												LEFT JOIN archive_path_folder arch
													ON dossier.id_cli = arch.id_cli
														AND dossier.id_mod_lic = arch.id_mod_lic
														AND dossier.id_mod_trans = arch.id_mod_trans
												WHERE dossier.id_mod_lic = ?
													AND dossier.id_cli = ?
													AND dossier.support_doc = ?
													AND dossier.ref_decl IS NOT NULL
													AND dossier.date_decl IS NOT NULL
													AND dossier.ref_liq IS NOT NULL
													AND dossier.date_liq IS NOT NULL
													AND dossier.ref_quit IS NOT NULL
													AND dossier.date_quit IS NOT NULL
													AND dossier.id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier)
													AND dossier.not_fact = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['support_doc']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				// $reponse['btn_action'] .= '<a href="file:///'.$this-> getPathArchive($reponse['id_dos']).'/'.$reponse['ref_dos'].'">Find Support Documents</a>';

				$reponse['compteur'] = $compteur;

				$rows[] = $reponse;
			}$requete-> closeCursor();

			return $rows;

		}

		public function getPathArchive($id_dos){
			include('connexion.php');

			// $entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare('SELECT lien
												FROM archive_path_folder
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_mod_trans = ?');
			$requete-> execute(array($this-> getDossier($id_dos)['id_cli'], $this-> getDossier($id_dos)['id_mod_lic'], $this-> getDossier($id_dos)['id_mod_trans']));

			$reponse = $requete-> fetch();

			return $reponse['lien'];
		}

		public function afficherMenuRegistreAJAX(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			// $entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$tbl = '<ul class="nav nav-treeview">';

			$debut = $compteur;

			$requete = $connexion-> query("SELECT *
												FROM journal
												ORDER BY nom_jour");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tbl .= '<li class="nav-item">
		                    <a href="journal.php?id_jour='.$reponse['id_jour'].'" class="nav-link">
		                      &nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
		                      <p>'.$reponse['nom_jour'].'</p>
		                    </a>
		                </li>';
			}$requete-> closeCursor();

			$tbl .='</ul>';

			return $tbl;

		}

		public function afficherMenuTresorerieAJAX(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			// $entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$tbl = '<ul class="nav nav-treeview">';

			$debut = $compteur;

			$requete = $connexion-> query("SELECT *
												FROM tresorerie
												ORDER BY nom_tres");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tbl .= '<li class="nav-item">
		                    <a href="tresorerie.php?id_tres='.$reponse['id_tres'].'" class="nav-link">
		                      &nbsp;&nbsp;&nbsp;<i class="fa fa-folder-open nav-icon"></i>
		                      <p>'.$reponse['nom_tres'].'</p>
		                    </a>
		                </li>';
			}$requete-> closeCursor();

			$tbl .='</ul>';

			return $tbl;

		}

		public function getDataJournal($id_jour){
			include('connexion.php');

			$entree['id_jour'] = $id_jour;

			$requete = $connexion-> prepare('SELECT *
												FROM journal
												WHERE id_jour = ?');
			$requete-> execute(array($entree['id_jour']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function getDataTresorerie($id_tres){
			include('connexion.php');

			$entree['id_tres'] = $id_tres;

			$requete = $connexion-> prepare('SELECT t.*, m.sig_mon AS sig_mon
												FROM tresorerie t, monnaie m
												WHERE t.id_tres = ?
													AND t.id_mon = m.id_mon');
			$requete-> execute(array($entree['id_tres']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function afficherMonitoringFacturation($id_mod_lic, $debut=null, $fin=null){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$tbl = "";

			$requete = $connexion-> query("SELECT *
												FROM utilisateur
												WHERE id_role = 12
												ORDER BY nom_util");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tbl .= '<tr>
							<td class="" style="text-align: center;" class="">
								'.$compteur.'
							</td>
							<td class="" style="text-align: ;" class="">
								'.$reponse['nom_util'].'
							</td>
							<td class="" style="text-align: center;" class="">
								'.$this-> getNbreFacture($id_mod_lic, $reponse['id_util'], $debut, $fin).'
							</td>
							<td class="" style="text-align: center;" class="">
								<a href="#" class="btn btn-xs btn-info" onclick="window.open(\'popUpDashboardFacturation.php?statut=Factures&amp;id_mod_lic='.$id_mod_lic.'&amp;id_util='.$reponse['id_util'].'&amp;debut='.$debut.'&amp;fin='.$fin.'\',\'pop1\',\'width=1200,height=700\');">
				                	Details <i class="fas fa-arrow-circle-right"></i>
				            	</a>
							</td>
							<td class="" style="text-align: center;" class="">
								'.$this-> getNbreDossierFacture($id_mod_lic, $reponse['id_util'], $debut, $fin).'
							</td>
							<td class="" style="text-align: center;" class="">
								<a href="#" class="btn btn-xs btn-info" onclick="window.open(\'popUpDashboardFacturation.php?statut=Dossiers FacturÃ©s&amp;id_mod_lic='.$id_mod_lic.'&amp;id_util='.$reponse['id_util'].'&amp;debut='.$debut.'&amp;fin='.$fin.'\',\'pop1\',\'width=1200,height=700\');">
				                	Details <i class="fas fa-arrow-circle-right"></i>
				            	</a>
							</td>
						</tr>';
			}$requete-> closeCursor();

			return $tbl;

		}

		public function getMontantTauxBanque($id_banq, $id_taux_bcc){
			include('connexion.php');
			$entree['id_banq'] = $id_banq;
			$entree['id_taux_bcc'] = $id_taux_bcc;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT *
											FROM taux_banque
											WHERE id_banq = ?
												AND id_taux_bcc = ?");
			$requete-> execute(array($entree['id_banq'], $entree['id_taux_bcc']));
			$reponse = $requete-> fetch();

			if ($reponse) {
				return $reponse['montant'];
			}else{
				return '0';
			}
			
			
		}

		public function getMontantTauxBanqueDate($id_banq, $date_taux){
			include('connexion.php');
			$entree['id_banq'] = $id_banq;
			$entree['date_taux'] = $date_taux;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT *
											FROM taux_banque
											WHERE id_banq = ?
												AND date_taux = ?");
			$requete-> execute(array($entree['id_banq'], $entree['date_taux']));
			$reponse = $requete-> fetch();

			if ($reponse) {
				return $reponse['montant'];
			}else{
				return '0';
			}
			
			
		}

		public function creerTauxBCC($date_taux, $montant){
			include('connexion.php');
			$entree['date_taux'] = $date_taux;
			$entree['montant'] = $montant;

			$compteur = 0;

			$requete = $connexion-> prepare("INSERT INTO taux_bcc(date_taux, montant, id_util)
											VALUES(?, ?, ?)");
			$requete-> execute(array($entree['date_taux'], $entree['montant'], $_SESSION['id_util']));
			
		}

		public function getTauxBCCDate($date_taux){
			include('connexion.php');
			$entree['date_taux'] = $date_taux;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * 
											FROM taux_bcc 
											WHERE date_taux = ?");
			$requete-> execute(array($entree['date_taux']));
			$reponse = $requete-> fetch();

			return $reponse;
			
		}

		public function creerTauxBanque($id_taux_bcc, $id_banq, $date_taux, $montant){
			include('connexion.php');
			$entree['id_taux_bcc'] = $id_taux_bcc;
			$entree['id_banq'] = $id_banq;
			$entree['date_taux'] = $date_taux;
			$entree['montant'] = $montant;

			$compteur = 0;

			$requete = $connexion-> prepare("INSERT INTO taux_banque(id_taux_bcc, id_banq, date_taux, montant, id_util)
											VALUES(?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['id_taux_bcc'], $entree['id_banq'], $entree['date_taux'], $entree['montant'], $_SESSION['id_util']));
			
		}

		public function afficherMonitoringTaux(){
			include("connexion.php");

			$compteur=0;

			$tbl = "";

			$ecobank_preced = 0;
			$rawbank_preced = 0;
			$equity_preced = 0;
			$access_preced = 0;

			$requete = $connexion-> query("SELECT * FROM (
												SELECT * FROM taux_bcc ORDER BY date_taux DESC LIMIT 0, 20
											) Var1
											ORDER BY date_taux ASC");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reste_ecobank = $this-> getMontantTauxBanque(5, $reponse['id'])-$reponse['montant'];
				$reste_rawbank = $this-> getMontantTauxBanque(2, $reponse['id'])-$reponse['montant'];
				$reste_equity = $this-> getMontantTauxBanque(3, $reponse['id'])-$reponse['montant'];
				$reste_access = $this-> getMontantTauxBanque(10, $reponse['id'])-$reponse['montant'];

				if ($ecobank_preced > $reste_ecobank) {
					$arrow_ecobank = '<i class="fa fa-arrow-down text-danger"></i>';
				}else if ($ecobank_preced < $reste_ecobank) {
					$arrow_ecobank = '<i class="fa fa-arrow-up text-success"></i>';
				}else{
					$arrow_ecobank = '<i class="fa fa-minus text-info"></i>';
				}

				if ($rawbank_preced > $reste_rawbank) {
					$arrow_rawbank = '<i class="fa fa-arrow-down text-danger"></i>';
				}else if ($rawbank_preced < $reste_rawbank) {
					$arrow_rawbank = '<i class="fa fa-arrow-up text-success"></i>';
				}else{
					$arrow_rawbank = '<i class="fa fa-minus text-info"></i>';
				}

				if ($equity_preced > $reste_equity) {
					$arrow_equity = '<i class="fa fa-arrow-down text-danger"></i>';
				}else if ($equity_preced < $reste_equity) {
					$arrow_equity = '<i class="fa fa-arrow-up text-success"></i>';
				}else{
					$arrow_equity = '<i class="fa fa-minus text-info"></i>';
				}

				if ($access_preced > $reste_access) {
					$arrow_access = '<i class="fa fa-arrow-down text-danger"></i>';
				}else if ($access_preced < $reste_access) {
					$arrow_access = '<i class="fa fa-arrow-up text-success"></i>';
				}else{
					$arrow_access = '<i class="fa fa-minus text-info"></i>';
				}

				$tbl .= '<tr>
							<td class="" style="text-align: center;" class="">
								'.$compteur.'
							</td>
							<td class="" style="text-align: right;" class="">
								'.$reponse['date_taux'].'
							</td>
							<td class="" style="text-align: right;" class="">'.number_format($reponse['montant'], 3, ',', '.').'</td>
							<td class="" style="text-align: right;" class="">'.number_format($this-> getMontantTauxBanque(2, $reponse['id']), 3, ',', '.').'</td>
							<td class="" style="text-align: right;" class="">'.$arrow_rawbank.number_format($reste_rawbank, 3, ',', '.').'</td>
							<td class="" style="text-align: right;" class="">'.number_format($this-> getMontantTauxBanque(3, $reponse['id']), 3, ',', '.').'</td>
							<td class="" style="text-align: right;" class="">'.$arrow_equity.number_format($reste_equity, 3, ',', '.').'</td>
							<td class="" style="text-align: right;" class="">'.number_format($this-> getMontantTauxBanque(5, $reponse['id']), 3, ',', '.').'</td>
							<td class="" style="text-align: right;" class="">'.$arrow_ecobank.number_format($reste_ecobank, 3, ',', '.').'</td>
							<td class="" style="text-align: right;" class="">'.number_format($this-> getMontantTauxBanque(10, $reponse['id']), 3, ',', '.').'</td>
							<td class="" style="text-align: right;" class="">'.$arrow_access.number_format($reste_access, 3, ',', '.').'</td>
							<td>
								<a href="#" onclick="delete_taux_banque('.$reponse['id'].')"><i class="fa fa-times text-danger"></i></a>
								<a href="#" onclick="appliquer_taux('.$reponse['id'].')"><i class="fa fa-check text-sucess"></i></a>
							</td>
						</tr>';

			$ecobank_preced = $reste_ecobank;
			$rawbank_preced = $reste_rawbank;
			$equity_preced = $reste_equity;

			}$requete-> closeCursor();

			return $tbl;

		}

		public function files_awaiting_rate($id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$compteur=0;

			$tbl = "";

			$ecobank_preced = 0;
			$rawbank_preced = 0;
			$equity_preced = 0;

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													CONCAT(dos.ref_decl, ' ', dos.date_decl) AS declaration,
													CONCAT(dos.ref_liq, ' ', dos.date_liq) AS liquidation,
													CONCAT(dos.ref_quit, ' ', dos.date_quit) AS quittance,
													dos.id_dos AS id_dos,
													dos.roe_decl AS roe_decl,
													dos.ref_decl AS ref_decl,
													factdos.ref_fact AS ref_fact,
													banque.nom_banq AS nom_banq,
													taux_banque.montant AS montant_taux,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(factdos.date_fact, '%d/%m/%Y') AS date_fact,
													dos.ref_decl AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_decl AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier dos
												LEFT JOIN banque
													ON banque.id_banq = dos.id_bank_liq
												LEFT JOIN taux_banque
													ON banque.id_banq = taux_banque.id_banq
														AND taux_banque.date_taux = dos.date_quit
												LEFT JOIN detail_facture_dossier dfd
													ON dfd.id_dos = dos.id_dos
												LEFT JOIN facture_dossier factdos
													ON factdos.ref_fact = dfd.ref_fact
												WHERE dos.id_dos IN (
														SELECT DISTINCT(id_dos)
															FROM detail_facture_dossier det, facture_dossier fact
															WHERE det.ref_fact = fact.ref_fact
																
													)
													AND (
														dos.id_bank_liq IS NULL
														OR
														dos.roe_decl != (
																SELECT tb.montant
																	FROM taux_banque tb
																	WHERE tb.id_banq = dos.id_bank_liq
																		AND tb.date_taux = dos.date_quit
															)
														)
													AND dos.id_mod_lic = ?
													AND DATE(dos.date_quit) >= '2023-08-22'
												GROUP BY dos.id_dos");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tbl .= '<tr>
							<td class="" style="text-align: center;" class="">
								'.$compteur.'
							</td>
							<td class="" style="text-align:;" class="">
								'.$reponse['ref_dos'].'
							</td>
							<td class="" style="text-align:;" class="">
								'.$reponse['ref_fact'].'
							</td>
							<td class="" style="text-align:;" class="">
								'.$reponse['date_fact'].'
							</td>
							<td class="" style="text-align:;" class="">
								'.$reponse['ref_decl'].'
							</td>
							<td class="" style="text-align:;" class="">
								'.$reponse['date_decl'].'
							</td>
							<td class="" style="text-align:;" class="">
								'.$reponse['ref_liq'].'
							</td>
							<td class="" style="text-align:;" class="">
								'.$reponse['date_liq'].'
							</td>
							<td class="" style="text-align:;" class="">
								'.$reponse['ref_quit'].'
							</td>
							<td class="" style="text-align:;" class="">
								'.$reponse['date_quit'].'
							</td>
							<td class="" style="text-align:right;" class="">
								'.number_format($reponse['roe_decl'], 4, ',', '.').'
							</td>
							<td class="" style="text-align:center;" class="">
								<select id="id_bank_liq_'.$compteur.'" class="form-control form-control-sm" onchange="MAJ_id_bank_liq('.$reponse['id_dos'].', this.value, '.$id_mod_lic.')"><option></option>'.$this-> selectionnerBanqueLiquidationAjax().'</select>
							</td>
						</tr>';

			}$requete-> closeCursor();

			return $tbl;

		}

		public function getDossiersExportAFactures($id_cli, $id_mod_lic, $id_march, $id_mod_trans, $num_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['num_lic'] = $num_lic;
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT ref_dos, id_dos, num_lot, 
													horse, trailer_1, trailer_2, 
													poids, roe_decl, id_bank_liq,
													roe_liq,
													CONCAT(ref_decl, ' ', DATE_FORMAT(date_decl, '%d/%m/%Y')) AS declaration,
													CONCAT(ref_liq, ' ', DATE_FORMAT(date_liq, '%d/%m/%Y')) AS liquidation,
													CONCAT(ref_quit, ' ', DATE_FORMAT(date_quit, '%d/%m/%Y')) AS quittance,
													horse, trailer_1, trailer_2
											FROM dossier
											WHERE id_cli = ?
												AND id_mod_lic = ?
												AND id_march = ?
												AND id_mod_trans = ?
												AND num_lic = ?
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												AND ref_liq IS NOT NULL
												AND ref_liq <> ''
												AND id_dos NOT IN (
														SELECT id_dos FROM detail_facture_dossier
													)
												AND not_fact = '0'
											ORDER BY id_dos  ASC");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march'], $entree['id_mod_trans'], $entree['num_lic']));

			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
			<tr>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['declaration'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['liquidation'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids'], 3, ',', '.');?>
				</td>
				<td style="text-align: center;">
					<input type="checkbox" id="check_<?php echo $compteur;?>" name="check_<?php echo $compteur;?>" class="bg bg-dark">
				</td>
				<td>
					<input type="number" min="0" step="0.000001" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="roe_decl_<?php echo $compteur;?>" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" class="bg bg-dark">
				</td>
				<td>
					<input type="number" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="dde_<?php echo $compteur;?>" name="dde_<?php echo $compteur;?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dde_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="0" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="rie_<?php echo $compteur;?>" name="rie_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(1, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="rie_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(1, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="rls_<?php echo $compteur;?>" name="rls_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(3, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="rls_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(3, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="cso_<?php echo $compteur;?>" name="cso_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(37, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="cso_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(37, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="fsr_<?php echo $compteur;?>" name="fsr_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(4, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="fsr_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(4, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center; font-weight: bold; font-size: 20px;">
					<span id="total_duty_<?php echo $compteur;?>"></span>
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="gov_tax_<?php echo $compteur;?>" name="gov_tax_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(7, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="gov_tax_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(7, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="concentrate_tax_<?php echo $compteur;?>" name="concentrate_tax_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(8, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="concentrate_tax_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(8, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="fere_<?php echo $compteur;?>" name="fere_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(5, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="fere_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(5, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ogefrem_10_<?php echo $compteur;?>" name="ogefrem_10_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(196, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ogefrem_10_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(196, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ogefrem_20_<?php echo $compteur;?>" name="ogefrem_20_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(197, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ogefrem_20_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(197, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ogefrem_40_<?php echo $compteur;?>" name="ogefrem_40_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(198, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ogefrem_40_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(198, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="lmc_<?php echo $compteur;?>" name="lmc_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(6, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="lmc_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(6, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="occ_samp_<?php echo $compteur;?>" name="occ_samp_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(9, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="occ_samp_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(9, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="occ_cgea_<?php echo $compteur;?>" name="occ_cgea_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(10, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="occ_cgea_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(10, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ceec_30_<?php echo $compteur;?>" name="ceec_30_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(11, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ceec_30_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(11, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ceec_60_<?php echo $compteur;?>" name="ceec_60_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(12, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ceec_60_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(12, $id_mod_lic, $id_cli, $id_march, $id_mod_trans, $reponse['id_dos'])['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="dgda_seal_<?php echo $compteur;?>" name="dgda_seal_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(13, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dgda_seal_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(13, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="dmc_ce_<?php echo $compteur;?>" name="dmc_ce_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(172, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dmc_ce_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(172, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="dilolo_<?php echo $compteur;?>" name="dilolo_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(173, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dilolo_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(173, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="assay_<?php echo $compteur;?>" name="assay_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(15, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="assay_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(15, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="occ_fees_<?php echo $compteur;?>" name="occ_fees_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(18, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="occ_fees_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(18, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ceec_fees_<?php echo $compteur;?>" name="ceec_fees_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(53, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ceec_fees_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(53, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="com_ext_<?php echo $compteur;?>" name="com_ext_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(17, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="com_ext_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(17, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="nac_<?php echo $compteur;?>" name="nac_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(14, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="nac_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(14, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="klsa_border_<?php echo $compteur;?>" name="klsa_border_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(22, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="klsa_border_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(22, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="klsa_border_<?php echo $compteur;?>" name="occ_ops_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(23, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="occ_ops_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(23, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="sncc_lshi_<?php echo $compteur;?>" name="sncc_lshi_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(57, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="sncc_lshi_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(57, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="sakania_border_<?php echo $compteur;?>" name="sakania_border_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(56, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="sakania_border_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(56, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="mine_div_<?php echo $compteur;?>" name="mine_div_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(16, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="mine_div_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(16, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="mine_police_<?php echo $compteur;?>" name="mine_police_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(25, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="mine_police_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(25, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="anr_<?php echo $compteur;?>" name="anr_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(26, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="anr_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(26, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="dgda_ops_<?php echo $compteur;?>" name="dgda_ops_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(27, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dgda_ops_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(27, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="print_<?php echo $compteur;?>" name="print_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(28, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="print_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(28, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="bank_<?php echo $compteur;?>" name="bank_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(29, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="bank_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(29, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="kisanga_<?php echo $compteur;?>" name="kisanga_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(30, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="kisanga_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(30, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="transfert_<?php echo $compteur;?>" name="transfert_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(31, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="transfert_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(31, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="preclarence_<?php echo $compteur;?>" name="preclarence_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(19, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="preclarence_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(19, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="cost_intern_<?php echo $compteur;?>" name="cost_intern_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(20, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="cost_intern_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(20, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="other_service_<?php echo $compteur;?>" name="other_service_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(58, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="other_service_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(58, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" name="frais_agence_<?php echo $compteur;?>"  id="frais_agence_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(21, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="frais_agence_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(21, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" name="seguce_<?php echo $compteur;?>"  id="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(176, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="seguce_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(176, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input name="nbre" type="hidden" value="<?php echo $compteur;?>">
			<?php
		}

		public function getDossiersImportAcidAFactures($id_cli, $id_mod_lic, $id_march, $id_mod_trans, $num_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['num_lic'] = $num_lic;
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT ref_dos, id_dos, num_lot, 
													horse, trailer_1, trailer_2, 
													poids, roe_decl,
													CONCAT(ref_decl, ' ', DATE_FORMAT(date_decl, '%d/%m/%Y')) AS declaration,
													CONCAT(ref_liq, ' ', DATE_FORMAT(date_liq, '%d/%m/%Y')) AS liquidation,
													CONCAT(ref_quit, ' ', DATE_FORMAT(date_quit, '%d/%m/%Y')) AS quittance,
													horse, trailer_1, trailer_2
											FROM dossier
											WHERE id_cli = ?
												AND id_mod_lic = ?
												AND id_march = ?
												AND id_mod_trans = ?
												AND num_lic = ?
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												AND ref_liq IS NOT NULL
												AND ref_liq <> ''
												AND id_dos NOT IN (
														SELECT id_dos FROM detail_facture_dossier
													)
												AND not_fact = '0'
											ORDER BY id_dos  ASC");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march'], $entree['id_mod_trans'], $entree['num_lic']));

			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
			<tr>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['declaration'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['liquidation'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids'], 2, ',', '.');?>
				</td>
				<td style="text-align: center;">
					<input type="checkbox" id="check_<?php echo $compteur;?>" name="check_<?php echo $compteur;?>" class="bg bg-dark">
				</td>
				<td>
					<input type="number" min="0" step="0.000001" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="roe_decl_<?php echo $compteur;?>" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="ddi_<?php echo $compteur;?>" name="ddi_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(32, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ddi_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(32, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="fpi_<?php echo $compteur;?>" name="fpi_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(95, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="fpi_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(95, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="rii_<?php echo $compteur;?>" name="rii_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(38, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="rii_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(38, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="cog_<?php echo $compteur;?>" name="cog_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(35, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="cog_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(35, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="dci_<?php echo $compteur;?>" name="dci_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(96, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dci_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(96, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="rls_<?php echo $compteur;?>" name="rls_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(3, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="rls_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(3, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="autre_taxe_<?php echo $compteur;?>" name="autre_taxe_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(97, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="autre_taxe_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(97, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center; font-weight: bold; font-size: 20px;">
					<span id="total_duty_<?php echo $compteur;?>"></span>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input name="nbre" type="hidden" value="<?php echo $compteur;?>">
			<?php
		}
		
		public function dossiers_facture_ajax($ref_fact){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$rows = array();
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT CONCAT(dos.ref_dos,'   <a href=\"#\" onclick=\"remove_file_invoice(\'',dos.id_dos,'\');\" title=\"Remove this file\">
									                    <i class=\"fas fa-times text-danger\"></i> 
									                </a>') AS ref_dos, dos.id_dos, dos.num_lot, 
													dos.horse, dos.trailer_1, dos.trailer_2, 
													dos.poids, dos.roe_decl,
													CONCAT(dos.ref_decl, ' ', DATE_FORMAT(dos.date_decl, '%d/%m/%Y')) AS declaration,
													CONCAT(dos.ref_liq, ' ', DATE_FORMAT(dos.date_liq, '%d/%m/%Y')) AS liquidation,
													CONCAT(dos.ref_quit, ' ', DATE_FORMAT(dos.date_quit, '%d/%m/%Y')) AS quittance,
													dos.horse, dos.trailer_1, dos.trailer_2,
													CONCAT(
														IF(dos.horse IS NOT NULL AND REPLACE(dos.horse, ' ', '') NOT LIKE '',
															dos.horse,
															''),
														IF(dos.trailer_1 IS NOT NULL AND REPLACE(dos.trailer_1, ' ', '') NOT LIKE '',
															CONCAT(' / ', dos.trailer_1),
															''),
														IF(dos.trailer_2 IS NOT NULL AND REPLACE(dos.trailer_2, ' ', '') NOT LIKE '',
															CONCAT(' / ', dos.trailer_2),
															'')
													) AS truck,

													SUM(
														IF(det.usd='1', 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl),
																	(det.montant/dos.roe_decl)*1.16
																),
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd

											FROM dossier dos, detail_facture_dossier det
											WHERE det.ref_fact = ?
												AND det.id_dos = dos.id_dos
											GROUP BY dos.id_dos
											ORDER BY dos.id_dos  ASC");

			$requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$reponse['compteur'] = $compteur;

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}
		
		public function pending_report(){
			include('connexion.php');

			// $entree['ref_fact'] = $ref_fact;
			$rows = array();
			$compteur = 0;

			$requete = $connexion-> query("SELECT u.nom_util AS nom_util,
												cl.nom_cli AS nom_cli,
												COUNT(
													IF(dos.id_mod_lic=1,
														dos.id_dos,
														NULL
													)
												) AS nbre_export,
												COUNT(
													IF(dos.id_mod_lic=2,
														dos.id_dos,
														NULL
													)
												) AS nbre_import,
												COUNT(dos.id_dos) AS nbre_total,
												cl.id_cli AS id_cli,
												dos.id_mod_lic AS id_mod_lic,
												u.id_util AS id_util
											FROM dossier dos
												LEFT JOIN client cl
													ON cl.id_cli = dos.id_cli
												LEFT JOIN affectation_utilisateur_client_facturation aff
													ON aff.id_cli = cl.id_cli
														AND aff.id_mod_lic = dos.id_mod_lic
												LEFT JOIN utilisateur u
													ON u.id_util = aff.id_util
												WHERE dos.id_dos NOT IN(
														SELECT id_dos FROM detail_facture_dossier
													)
													AND dos.ref_quit IS NOT NULL
													AND dos.date_quit IS NOT NULL
													AND dos.not_fact = '0'
											GROUP BY cl.id_cli, dos.id_mod_lic
											ORDER BY u.nom_util
											");

			// $requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$reponse['compteur'] = $compteur;

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}
		
		public function detail_invoice_pending_report($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$rows = array();
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos,
													IF(dos.num_lot IS NOT NULL,
														dos.num_lot,
														dos.ref_fact
													) AS num_lot,
													dos.po_ref AS po_ref,
													march.nom_march AS nom_march,
													UPPER(CONCAT(
														IF(dos.horse IS NOT NULL,
															dos.horse,
															NULL),
														IF(dos.trailer_1 IS NOT NULL,
															CONCAT('/',dos.trailer_1),
															NULL),
														IF(dos.trailer_1 IS NOT NULL,
															CONCAT('/',dos.trailer_2),
															NULL)
														)
													) AS truck,
													dos.ref_decl AS ref_decl,
													dos.date_decl AS date_decl,
													dos.ref_liq AS ref_liq,
													dos.date_liq AS date_liq,
													DATEDIFF(CURRENT_DATE(), dos.date_liq) AS delay_liq,
													dos.ref_quit AS ref_quit,
													dos.date_quit AS date_quit,
													dos.montant_liq AS montant_liq,
													ml.nom_mod_lic AS nom_mod_lic,
													u.nom_util AS nom_util,
													YEAR(dos.date_creat_dos) AS annee
												FROM dossier dos
													LEFT JOIN client cl
														ON cl.id_cli = dos.id_cli
													LEFT JOIN marchandise march
														ON march.id_march = dos.id_march
													LEFT JOIN modele_licence ml
														ON ml.id_mod_lic = dos.id_mod_lic
													LEFT JOIN affectation_utilisateur_client_facturation aff
														ON aff.id_cli = cl.id_cli
															AND aff.id_mod_lic = dos.id_mod_lic
													LEFT JOIN utilisateur u
														ON u.id_util = aff.id_util
												WHERE dos.id_dos NOT IN(
														SELECT id_dos FROM detail_facture_dossier
													)
													AND dos.ref_quit IS NOT NULL
													AND dos.date_quit IS NOT NULL
													AND dos.not_fact = '0'
													AND dos.id_cli = ?
													AND dos.id_mod_lic = ?
											");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$reponse['compteur'] = $compteur;

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}
		
		public function invoice_assigned(){
			include('connexion.php');

			// $entree['id_cli'] = $id_cli;
			// $entree['id_mod_lic'] = $id_mod_lic;
			$rows = array();
			$compteur = 0;

			$requete = $connexion-> query("SELECT u.nom_util AS nom_util,
													cl.nom_cli AS nom_cli,
													-- ml.nom_mod_lic AS nom_mod_lic,
													CONCAT(ml.nom_mod_lic,'   <a href=\"#\" onclick=\"remove_assignement(',u.id_util,',',ml.id_mod_lic,',',cl.id_cli,');\" title=\"Remove this assignement\">
									                    <i class=\"fas fa-times text-danger\"></i> 
									                </a>')  AS nom_mod_lic
												FROM utilisateur u, client cl, modele_licence ml, affectation_utilisateur_client_facturation aff
												WHERE u.id_util = aff.id_util
													AND aff.id_cli = cl.id_cli
													AND aff.id_mod_lic = ml.id_mod_lic
												ORDER BY u.nom_util, cl.nom_cli
												");

			// $requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$reponse['compteur'] = $compteur;

				$rows[] = $reponse;

			}$requete-> closeCursor();

			return $rows;
		}
		
		public function create_assignement($id_util, $id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("INSERT INTO affectation_utilisateur_client_facturation(id_util, id_mod_lic, id_cli)
												VALUES(?, ?, ?)");
			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic'], $entree['id_cli']));
			

		}

		public function remove_assignement($id_util, $id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_util'] = $id_util;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("DELETE FROM affectation_utilisateur_client_facturation
												WHERE id_util = ? 
													AND id_mod_lic = ? 
													AND id_cli = ?");

			$requete-> execute(array($entree['id_util'], $entree['id_mod_lic'], $entree['id_cli']));
			

		}

		public function delete_taux_banque($id){
			include("connexion.php");
			$entree['id'] = $id;

			$requete = $connexion-> prepare("DELETE FROM taux_bcc
												WHERE id = ? ");

			$requete-> execute(array($entree['id']));
			

		}

		public function getDossiersImportAcidEditFactures($ref_fact){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			// $entree['id_mod_lic'] = $id_mod_lic;
			// $entree['id_march'] = $id_march;
			// $entree['id_mod_trans'] = $id_mod_trans;
			// $entree['num_lic'] = $num_lic;
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos, 
													dos.id_dos AS id_dos, 
													dos.num_lot AS num_lot, 
													dos.horse AS horse, 
													dos.trailer_1 AS trailer_1, 
													dos.trailer_2 AS trailer_2, 
													dos.poids AS poids, 
													ROUND(dos.roe_decl, 4) AS roe_decl,
													CONCAT(dos.ref_decl, ' ', DATE_FORMAT(dos.date_decl, '%d/%m/%Y')) AS declaration,
													CONCAT(dos.ref_liq, ' ', DATE_FORMAT(dos.date_liq, '%d/%m/%Y')) AS liquidation,
													CONCAT(dos.ref_quit, ' ', DATE_FORMAT(dos.date_quit, '%d/%m/%Y')) AS quittance
											FROM dossier dos, detail_facture_dossier det
											WHERE det.ref_fact = ?
												AND det.id_dos = dos.id_dos
											GROUP BY dos.id_dos
											ORDER BY dos.id_dos");

			$requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$total_duty = 0;
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 32)['montant'];
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 95)['montant'];
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 38)['montant'];
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 35)['montant'];
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 96)['montant'];
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 3)['montant'];
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 97)['montant'];
			?>
			<tr>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['declaration'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['liquidation'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids'], 2, ',', '.');?>
				</td>
				<td style="text-align: center;">
					<input type="checkbox" id="check_<?php echo $compteur;?>" name="check_<?php echo $compteur;?>" checked class="bg bg-dark">
				</td>
				<td>
					<input type="number" min="0" step="0.000001" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="roe_decl_<?php echo $compteur;?>" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="ddi_<?php echo $compteur;?>" name="ddi_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 32)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ddi_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(32, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="fpi_<?php echo $compteur;?>" name="fpi_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 95)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="fpi_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(95, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="rii_<?php echo $compteur;?>" name="rii_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 38)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="rii_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(38, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="cog_<?php echo $compteur;?>" name="cog_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 35)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="cog_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(35, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="dci_<?php echo $compteur;?>" name="dci_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 96)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dci_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(96, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="rls_<?php echo $compteur;?>" name="rls_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 3)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="rls_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(3, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDuty(<?php echo $compteur;?>);" id="autre_taxe_<?php echo $compteur;?>" name="autre_taxe_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 97)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="autre_taxe_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport(97, $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center; font-weight: bold; font-size: 20px;">
					<span id="total_duty_<?php echo $compteur;?>"><span class="badge badge-danger"><?php echo number_format($total_duty, 0, ',', '.');?></span></span>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input name="nbre" type="hidden" value="<?php echo $compteur;?>">
			<?php
		}
		
		public function creerDetailFactureWithoutTaxe($ref_fact, $id_dos, $id_cli, $id_mod_lic, $id_march, $id_mod_trans){
			
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_cli= '.$id_cli;*/

			$requeteDebours = $connexion-> prepare("SELECT *
												FROM affectation_debours_client_modele_licence aff, debours deb
												WHERE aff.id_cli = ?
													AND aff.id_mod_lic = ?
													AND aff.id_march = ?
													AND aff.id_mod_trans = ?
													AND aff.id_deb = deb.id_deb
													AND aff.usd = '1'");
			$requeteDebours-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march'], $entree['id_mod_trans']));
			while ($reponseDebours = $requeteDebours-> fetch()) {
				
				$montant = $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport($reponseDebours['id_deb'], $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['montant'];
				$tva = $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport($reponseDebours['id_deb'], $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['tva'];
				$usd = $this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport($reponseDebours['id_deb'], $id_mod_lic, $id_cli, $id_march, $id_mod_trans)['usd'];

				// echo '<br>ref_fact = '.$ref_fact;
				// echo '<br>id_dos = '.$id_dos;
				// echo '<br>id_deb = '.$reponseDebours['id_deb'];
				// echo '<br>montant = '.$montant;
				// echo '<br>tva = '.$tva;
				// echo '<br>usd = '.$usd;

				$this-> creerDetailFactureDossier($ref_fact, $id_dos, $reponseDebours['id_deb'], $montant, $tva, $usd);

			}$requeteDebours-> closeCursor();

		} 

		public function getDossiersExportEditFactures($ref_fact){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$compteur = 0;
			$total_duty = 0;

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos, 
													dos.id_dos AS id_dos, 
													dos.num_lot AS num_lot, 
													dos.horse AS horse, 
													dos.trailer_1 AS trailer_1, 
													dos.trailer_2 AS trailer_2, 
													dos.poids AS poids, 
													ROUND(dos.roe_decl, 4) AS roe_decl,
													CONCAT(dos.ref_decl, ' ', DATE_FORMAT(dos.date_decl, '%d/%m/%Y')) AS declaration,
													CONCAT(dos.ref_liq, ' ', DATE_FORMAT(dos.date_liq, '%d/%m/%Y')) AS liquidation,
													CONCAT(dos.ref_quit, ' ', DATE_FORMAT(dos.date_quit, '%d/%m/%Y')) AS quittance
											FROM dossier dos, detail_facture_dossier det
											WHERE det.ref_fact = ?
												AND det.id_dos = dos.id_dos
											GROUP BY dos.id_dos
											ORDER BY dos.id_dos");

			$requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$compteur++;

				$total_duty = 0;

				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 1)['montant'];
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 3)['montant'];
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 37)['montant'];
				$total_duty += $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 4)['montant'];
			?>
			<tr>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lot'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['declaration'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['liquidation'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['quittance'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids'], 3, ',', '.');?>
				</td>
				<td style="text-align: center;">
					<input type="checkbox" id="check_<?php echo $compteur;?>" name="check_<?php echo $compteur;?>" checked class="bg bg-dark">
				</td>
				<td>
					<input type="number" min="0" step="0.000001" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="roe_decl_<?php echo $compteur;?>" name="roe_decl_<?php echo $compteur;?>" value="<?php echo $reponse['roe_decl'];?>" class="bg bg-dark">
				</td>
				<td>
					<input type="number" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="dde_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 2)['montant'];?>" name="dde_<?php echo $compteur;?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dde_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="0" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="rie_<?php echo $compteur;?>" name="rie_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 1)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="rie_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="0" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="rls_<?php echo $compteur;?>" name="rls_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 3)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="rls_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="0" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="cso_<?php echo $compteur;?>" name="cso_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 37)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="cso_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="0" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" onblur="calculDDE(<?php echo $compteur;?>);" id="fsr_<?php echo $compteur;?>" name="fsr_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 4)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="fsr_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="0" class="bg bg-dark">
				</td>
				<td style="text-align: center; font-weight: bold; font-size: 20px;">
					<span id="total_duty_<?php echo $compteur;?>"><span class="badge badge-danger"><?php echo number_format($total_duty, 0, ',', '.');?></span></span>
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="gov_tax_<?php echo $compteur;?>" name="gov_tax_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 7)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="gov_tax_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 7)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="concentrate_tax_<?php echo $compteur;?>" name="concentrate_tax_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 8)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="concentrate_tax_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 8)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="fere_<?php echo $compteur;?>" name="fere_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 5)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="fere_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 5)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ogefrem_10_<?php echo $compteur;?>" name="ogefrem_10_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 196)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ogefrem_10_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 196)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ogefrem_20_<?php echo $compteur;?>" name="ogefrem_20_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 197)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ogefrem_20_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 197)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ogefrem_40_<?php echo $compteur;?>" name="ogefrem_40_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 198)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ogefrem_40_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 198)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="lmc_<?php echo $compteur;?>" name="lmc_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 6)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="lmc_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 6)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="occ_samp_<?php echo $compteur;?>" name="occ_samp_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 9)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="occ_samp_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 9)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="occ_cgea_<?php echo $compteur;?>" name="occ_cgea_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 10)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="occ_cgea_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 10)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ceec_30_<?php echo $compteur;?>" name="ceec_30_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 11)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ceec_30_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 11)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ceec_60_<?php echo $compteur;?>" name="ceec_60_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 12)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ceec_60_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 12)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="dgda_seal_<?php echo $compteur;?>" name="dgda_seal_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 13)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dgda_seal_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 13)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="dmc_ce_<?php echo $compteur;?>" name="dmc_ce_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 172)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dmc_ce_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 172)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="dilolo_<?php echo $compteur;?>" name="dilolo_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 173)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dilolo_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 173)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="assay_<?php echo $compteur;?>" name="assay_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 15)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="assay_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 15)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="occ_fees_<?php echo $compteur;?>" name="occ_fees_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 18)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="occ_fees_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 18)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="ceec_fees_<?php echo $compteur;?>" name="ceec_fees_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 53)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="ceec_fees_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 53)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="com_ext_<?php echo $compteur;?>" name="com_ext_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 17)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="com_ext_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 17)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="nac_<?php echo $compteur;?>" name="nac_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 14)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="nac_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 14)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="klsa_border_<?php echo $compteur;?>" name="klsa_border_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 22)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="klsa_border_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 22)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="occ_ops_<?php echo $compteur;?>" name="occ_ops_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 23)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="occ_ops_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 23)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="sncc_lshi_<?php echo $compteur;?>" name="sncc_lshi_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 57)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="sncc_lshi_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 57)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="sakania_border_<?php echo $compteur;?>" name="sakania_border_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 56)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="sakania_border_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 56)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="mine_div_<?php echo $compteur;?>" name="mine_div_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 16)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="mine_div_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 16)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="mine_police_<?php echo $compteur;?>" name="mine_police_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 25)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="mine_police_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 25)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="anr_<?php echo $compteur;?>" name="anr_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 26)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="anr_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 26)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="dgda_ops_<?php echo $compteur;?>" name="dgda_ops_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 27)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="dgda_ops_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 27)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="print_<?php echo $compteur;?>" name="print_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 28)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="print_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 28)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="bank_<?php echo $compteur;?>" name="bank_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 29)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="bank_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 29)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="kisanga_<?php echo $compteur;?>" name="kisanga_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 30)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="kisanga_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 30)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="transfert_<?php echo $compteur;?>" name="transfert_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 31)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="transfert_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 31)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="preclarence_<?php echo $compteur;?>" name="preclarence_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 19)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="preclarence_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 19)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="cost_intern_<?php echo $compteur;?>" name="cost_intern_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 20)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="cost_intern_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 20)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" id="other_service_<?php echo $compteur;?>" name="other_service_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 58)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="other_service_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 58)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" name="frais_agence_<?php echo $compteur;?>"  id="frais_agence_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 21)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="frais_agence_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 21)['tva'];?>" class="bg bg-dark">
				</td>
				<td style="text-align: center;">
					<input type="number" step="0.001" min="0" style="text-align: center; width: 8em;" name="seguce_<?php echo $compteur;?>"  id="seguce_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 176)['montant'];?>" class="bg bg-dark">
					<input type="hidden" style="text-align: center; width: 8em;" name="seguce_tva_<?php echo $compteur;?>" id="tva_<?php echo $compteur;?>" value="<?php echo $this-> getMontantDataDetailFacture($ref_fact, $reponse['id_dos'], 176)['tva'];?>" class="bg bg-dark">
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input name="nbre" type="hidden" value="<?php echo $compteur;?>">
			<?php
		}

		public function getParametreDossiersExportAFactures($id_cli, $id_mod_lic, $id_march){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT SUM(poids) AS nbre_poids,
													(SUM(poids)*50) AS gov_tax_50,
													(SUM(poids)*3) AS fere_3,
													(SUM(poids)*5) AS lmc_5,
													(COUNT(id_dos)*250) AS occ_250,
													(COUNT(id_dos)*80) AS cgea_80,
													(COUNT(id_dos)*40) AS dgda_seal_40,
													COUNT(id_dos) AS nbre_dos,
													SUM(
														IF(poids<30,
															1,
															0)
													) AS nbre_ceec_30,
													(SUM(
														IF(poids<30,
															1,
															0)
													)*125) AS ceec_30,
													SUM(
														IF(poids>30,
															1,
															0)
													) AS nbre_ceec_60,
													(SUM(
														IF(poids>30,
															1,
															0)
													)*250) AS ceec_60,
													ref_dos, id_dos, num_lot, 
													horse, trailer_1, trailer_2, 
													poids, roe_decl,
													CONCAT(ref_decl, ' ', DATE_FORMAT(date_decl, '%d/%m/%Y')) AS declaration,
													CONCAT(ref_liq, ' ', DATE_FORMAT(date_liq, '%d/%m/%Y')) AS liquidation,
													CONCAT(ref_quit, ' ', DATE_FORMAT(date_quit, '%d/%m/%Y')) AS quittance
											FROM dossier
											WHERE id_cli = ?
												AND id_mod_lic = ?
												AND id_march = ?
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												AND ref_liq IS NOT NULL
												AND ref_liq <> ''
												AND id_dos NOT IN (
														SELECT id_dos FROM detail_facture_dossier
													)
												AND not_fact = '0'
											ORDER BY id_dos  ASC");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march']));
			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function afficherMenuMarchandiseClientModeleLicenceFacturation($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			//On recupere Les marchandises
			$requeteMarchandise = $connexion-> prepare("SELECT m.id_march AS id_march,
																UPPER(m.nom_march) AS nom_march
															FROM marchandise m, affectation_marchandise_client_modele_licence a
															WHERE m.id_march = a.id_march
																AND a.id_cli = ?
																AND a.id_mod_lic = ?
																AND a.menu_tracking = '1'
															ORDER BY m.nom_march ASC");
			$requeteMarchandise-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseMarchandise = $requeteMarchandise-> fetch()) {

				if (isset($_GET['id_march']) && ($_GET['id_march']==$reponseMarchandise['id_march']) && isset($_GET['id_cli']) && ($_GET['id_cli']==$id_cli)) {
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				

				?>
				<li class="nav-item <?php echo $open;?>  <?php echo $active;?>">
	                <a href="nouvelleFactureGlobaleExport.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_lic_fact=<?php echo $id_mod_lic;?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponseMarchandise['nom_march'];?></p>
	                </a>
	            </li>
				<?php
			}$requeteMarchandise-> closeCursor();
		}

		public function afficherMenuTracking(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '6' || $_SESSION['id_role'] == '7' || $_SESSION['id_role'] == '8' || $_SESSION['id_role'] == '9' || $_SESSION['id_role'] == '10' || $_SESSION['id_role'] == '11' || $_SESSION['id_role'] == '14'){
				$sql = "SELECT id_mod_lic, 
							nom_mod_lic,
							sigle_mod_lic
						FROM modele_licence
						WHERE id_etat = 1
							AND id_mod_lic < 3
						ORDER BY rang_lic ASC";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_mod_trac'])) && ($reponse['id_mod_lic'] == $_GET['id_mod_trac']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_mod_lic'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		            <?php
		            	//if ($_SESSION['id_role']!='7') {
		            		?>
						<li class="nav-item has-treeview">
					        <a href="dashboardDossier.php?id_cli=&amp;id_mod_trac=<?php echo $id_mod_lic;?>" class="nav-link" class="nav-link">
		                  	&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-tachometer-alt"></i>
		                  	<p>Dashboard <?php echo $reponse['sigle_mod_lic'];?></p>
					        </a>
				            <ul class="nav nav-treeview">
				              <?php
				              	$this-> afficherMenuModeTransportDashboard($id_cli, $reponse['id_mod_lic']);
				              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
				              ?>
				            </ul>
					    </li><?php
		            	//}
		            ?>
		              <?php
		              	//$this-> afficherMenuMarchandiseModeleLicence($reponse['id_mod_lic']);
		              if ($reponse['id_mod_lic'] == '1') {
		              	// code...
		              	$this-> afficherMenuClientModeleLicenceExport($reponse['id_mod_lic']);
		              }else if ($reponse['id_mod_lic'] == '2') {
		              	# code...
		              	$this-> afficherMenuClientModeleLicence($reponse['id_mod_lic']);
		              }
		              	
		              ?>
		              <li class="nav-item">
		                <a href="sydonia_upload.php?id_mod_trac=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
		                  <p>SYDONIA</p>
		                </a>
		              </li>
		              <!--<li class="nav-item">
		                <a href="dossier_upload2.php?id_mod_trac=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
		                  <p>Upload MMG</p>
		                </a>
		              </li>-->
		              <?php
		              	if( $reponse['id_mod_lic'] == '1'){
		              		/*
		              	?>
		              	<li class="nav-item">
			                <a href="uploadExport.php?id_mod_trac=<?php echo $reponse['id_mod_lic'];?>&commodity=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
			                  <p>UPLOAD </p>
			                </a>
			            </li>
		              	<?php
		              	*/
		              	}else if( $reponse['id_mod_lic'] == '2'){
		              	?>
		              <!--<li class="nav-item">
		                <a href="dossier_upload2.php?id_mod_trac=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
		                  <p>Upload Fichier Tracking</p>
		                </a>
		              </li>
		              <li class="nav-item">
		                <a href="upload_fob.php?id_mod_trac=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
		                  <p>Upload FOB</p>
		                </a>
		              </li>
		              <li class="nav-item">
		                <a href="upload_apurement.php?id_mod_trac=<?php echo $reponse['id_mod_lic'];?>&amp;id_cli=<?php echo $id_cli;?>" class="nav-link">
		                  &nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-upload nav-icon"></i>
		                  <p>Upload APUREMENT</p>
		                </a>
		              </li>-->
		              	<?php
		              	}
		              ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherMenuTrackingLogistique(){
			include("connexion.php");
			if(!isset($_GET['id_mod_lic'])){
				$_GET['id_mod_lic'] = '';
			}
			$id_mod_lic = $_GET['id_mod_lic'];
			$id_cli = '';
			$active = '';
			$open = '';
			$reponse['id_cli'] = '';
			if($_SESSION['id_role'] == '1' || $_SESSION['id_role'] == '6' || $_SESSION['id_role'] == '7' || $_SESSION['id_role'] == '8' || $_SESSION['id_role'] == '9' || $_SESSION['id_role'] == '10' || $_SESSION['id_role'] == '11'){
				$sql = "SELECT id_trans, 
							nom_trans
						FROM transit
						ORDER BY nom_trans";

			$requete = $connexion-> query($sql);
			while($reponse = $requete-> fetch()){
				if( (isset($_GET['id_trans'])) && ($reponse['id_trans'] == $_GET['id_trans']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				/*if(!isset($reponse['id_cli'])){
					$reponse['id_cli'] = '';
				}*/
				?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link  <?php echo $active;?>">
			          <i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_trans'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	$this-> afficherMenuClientDossierLogistique($reponse['id_trans']);
		              ?>
		            </ul>
			    </li>
				<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherMenuMarchandiseModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(nom_march) AS nom_march, id_march AS id_march 
												FROM marchandise 
												WHERE id_mod_lic = ?
												ORDER BY nom_march");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_march'])) && ($reponse['id_march'] == $_GET['id_march']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="dossier.php?id_march=<?php echo $reponse['id_march'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fas fa-file"></i>
			          <p>
			            <?php echo $reponse['nom_march'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	$this-> afficherMenuModeTransport($reponse['id_march'], $id_mod_lic);
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherLicencePourActivation($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg='';
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT *
												FROM licence 
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				if( $reponse['affichier_tracking'] == '1' ){
					$bg = 'bg bg-primary';
				}else{
					$bg = 'bg bg-danger';
				}
				$compteur++;
			?>
				<input type="hidden" name="num_lic_<?php echo $compteur;?>" value="<?php echo $reponse['num_lic'];?>">
				<tr class="<?php echo $bg;?>">
					<td style="text-align: center;">
						<?php echo $compteur;?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td style="text-align: center;">
						<select name="affichier_tracking_<?php echo $compteur;?>" class="form-control cc-exp">
						<?php
						if( $reponse['affichier_tracking'] == '1' ){
							?>
							<option value="1">
								ACTIVE
							</option>
							<option value="0">
								NON-ACTIVE
							</option>
							<?php
						}else{
							?>
							<option value="0">
								NON-ACTIVE
							</option>
							<option value="1">
								ACTIVE
							</option>
							<?php
						}
						?>
						</select>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherMenuClientModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';
			$style = '';

			if ($_SESSION['id_role'] == '10') {
				$sqlWarehouse = ' AND c.id_cli IN (
										SELECT DISTINCT(id_cli) 
										FROM dossier
										WHERE bond_warehouse = "LUBUMBASHI"
											AND id_mod_lic = '.$id_mod_lic.'
									)';
			}else{
				$sqlWarehouse = '';
			}

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli 
												FROM client c, affectation_client_modele_licence cm, modele_licence m 
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
													$sqlWarehouse
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) && (isset($reponse['id_cli'])) && (isset($_GET['id_march'])) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fa fa-user"></i>
			          <p>
			            <?php echo $reponse['nom_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
		              ?>
		              <?php
		              	if( $reponse['id_cli'] == '869'){
		              	?>
		              	<li class="nav-item">
			                <a href="dossier.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=1&commodity=&id_march=6" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p>ACID</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="dossier.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=1&commodity=&id_march=16" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p>DILUENT</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="dossier.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=1&commodity=&id_march=11" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p>DIVERS ROUTE</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="dossier.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=3&commodity=&id_march=11" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p>DIVERS AIR</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="dossier.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=1&commodity=&id_march=20" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p>LIME ROUTE</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="dossier.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=1&commodity=&id_march=7" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p>SODIUM ROUTE</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="dossier.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=1&commodity=&id_march=23" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
			                  <p>MAGNESIUM OXIDE ROUTE</p>
			                </a>
			            </li>
		              	<?php

		              		// $this-> afficherMenuModeTransportClient($reponse['id_cli'], $id_mod_lic);
		              	/*
		              	?>
		              	<li class="nav-item">
			                <a href="uploadTrackingKlsa.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&commodity=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-upload nav-icon"></i>
			                  <p>UPLOAD FICHIER</p>
			                </a>
			            </li>
		              	<?php
		              	*/
		              	}else{
		              		$this-> afficherMenuModeTransportClient($reponse['id_cli'], $id_mod_lic);
		              	}
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuClientDossierLogistique($id_trans){
			include('connexion.php');
			$entree['id_trans'] = $id_trans;
			$active = '';
			$open = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT DISTINCT(c.id_cli) AS id_cli , UPPER(c.nom_cli) AS nom_cli
												FROM client c, dossier_logistique dl
												WHERE dl.id_trans = ?
													AND dl.id_cli = c.id_cli
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_trans']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) && (isset($reponse['id_cli'])) && (isset($_GET['id_march'])) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fa fa-user"></i>
			          <p>
			            <?php echo $reponse['nom_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
		              ?>
		              <?php
		              	$this-> afficherMenuModeTransportClientLogistique($reponse['id_cli'], $id_trans);
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuAvClientModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli 
												FROM client c, affectation_client_modele_licence cm, modele_licence m 
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
													AND cm.id_etat = '1'
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) && (isset($reponse['id_cli'])) && (isset($_GET['id_march'])) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fa fa-user"></i>
			          <p>
			            <?php echo $reponse['nom_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              	<li class="nav-item">
			                <a href="dashboardAv.php?id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-tachometer-alt nav-icon"></i>
			                  <p>Dashboard AV</p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="irSansAv.php?id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-bell nav-icon"></i>
			                  <p>IR Sans AV <sup class="badge badge-danger"><?php echo $this-> getNombreIrSansAVClient($reponse['id_cli']);?></sup></p>
			                </a>
			            </li>
		              	<li class="nav-item">
			                <a href="av.php?id_cli=<?php echo $reponse['id_cli'];?>" class="nav-link" <?php echo $style;?>>
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-list nav-icon"></i>
			                  <p>Situation AV</p>
			                </a>
			            </li>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuClientModeleLicenceExport($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$active = '';
			$open = '';

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli, c.id_cli AS id_cli 
												FROM client c, affectation_client_modele_licence cm, modele_licence m 
												WHERE m.id_mod_lic = ?
													AND m.id_mod_lic = cm.id_mod_lic
													AND cm.id_cli = c.id_cli
												ORDER BY c.nom_cli");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($reponse['id_cli'] == $_GET['id_cli']) ){
					$active = 'active';
					$open = ' menu-open';
				}else{
					$active = '';
					$open = '';
				}
			?>
				<li class="nav-item has-treeview <?php echo $open;?>">
			        <a href="#" class="nav-link <?php echo $active;?>" class="nav-link  <?php echo $active;?>">
			          &nbsp;&nbsp;&nbsp;&nbsp;<i class="nav-icon fa fa-user"></i>
			          <p>
			            <?php echo $reponse['nom_cli'];?>
			            <i class="right fas fa-angle-left"></i>
			          </p>
			        </a>
		            <ul class="nav nav-treeview">
		              <?php
		              	$this-> afficherMenuModeTransportClientExport($reponse['id_cli'], $id_mod_lic);
		              	//$this-> afficherMenuLicenceClient($reponse['id_cli'], $id_mod_lic);
		              ?>
		              <?php
		              	/*if( $reponse['id_cli'] == '869'){
		              	?>
		              	<li class="nav-item">
			                <a href="uploadTrackingKlsa.php?id_cli=<?php echo $reponse['id_cli'];?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&commodity=" class="nav-link">
			                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-upload nav-icon"></i>
			                  <p>UPLOAD FICHIER</p>
			                </a>
			            </li>
		              	<?php
		              	}*/
		              ?>
		            </ul>
			    </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuModeTransport($id_march, $id_mod_lic){
			include('connexion.php');
			//$entree['id_mod_lic'] = $id_mod_lic;
			$style = '';

			$requete = $connexion-> query("SELECT UPPER(nom_mod_trans) AS nom_mod_trans, id_mod_trans AS id_mod_trans 
												FROM mode_transport ");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_march'])) && ($id_march == $_GET['id_march']) && (isset($id_march)) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="dossier.php?id_march=<?php echo $id_march;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['nom_mod_trans'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuModeTransportClient($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			$requete = $connexion-> prepare("SELECT UPPER(nom_mod_trans) AS nom_mod_trans, id_mod_trans AS id_mod_trans 
												FROM mode_transport
												WHERE id_mod_trans IN(
													SELECT DISTINCT(id_mod_trans) 
													FROM dossier
													WHERE id_cli = ?
														AND id_mod_lic = ? 		
											)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="dossier.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&commodity=" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['nom_mod_trans'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuModeTransportClientLogistique($id_cli, $id_trans){
			include('connexion.php');
			$entree['id_trans'] = $id_trans;
			$entree['id_cli'] = $id_cli;
			$style = '';

			$requete = $connexion-> prepare("SELECT UPPER(nom_mod_trans) AS nom_mod_trans, id_mod_trans AS id_mod_trans 
												FROM mode_transport
												WHERE id_mod_trans IN(
													SELECT DISTINCT(id_mod_trans) 
													FROM dossier_logistique
													WHERE id_cli = ?
														AND id_trans = ? 		
											)");
			$requete-> execute(array($entree['id_cli'], $entree['id_trans']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="dossierLogistique.php?id_cli=<?php echo $id_cli;?>&amp;id_trans=<?php echo $id_trans;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&commodity=" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['nom_mod_trans'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuModeTransportClientExport($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			//On recupere Les marchandises
			$requeteMarchandise = $connexion-> prepare('SELECT m.id_march AS id_march, 
																UPPER(m.nom_march) AS nom_march
															FROM marchandise m, affectation_marchandise_client_modele_licence a
															WHERE m.id_march = a.id_march
																AND a.id_cli = ?
																AND a.id_mod_lic = ?');
			$requeteMarchandise-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponseMarchandise = $requeteMarchandise-> fetch()) {
				?>
				<li class="nav-item has-treeview">
	                <a href="#" class="nav-link">
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-minus nav-icon"></i>
	                  <p><?php echo $reponseMarchandise['nom_march'];?></p>
	                </a>
	                <ul class="nav nav-treeview">
	                <?php

						$requete = $connexion-> prepare("SELECT DISTINCT(id_mod_trans) AS id_mod_trans , 
															UPPER(nom_mod_trans) AS nom_mod_trans
														FROM mode_transport 
														WHERE id_mod_trans IN(
																	SELECT id_mod_trans FROM dossier
																		WHERE id_cli = ?
																)");
						$requete-> execute(array($entree['id_cli']));
						while ($reponse = $requete-> fetch()) {
							if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
								$style = 'style="font-weight: bold; color: white;"';
							}else{
								$style = '';
							}
						?>
							<li class="nav-item">
				                <a href="dossier.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&amp;id_march=<?php echo $reponseMarchandise['id_march'];?>&commodity=" class="nav-link" <?php echo $style;?>>
				                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
				                  <p><?php echo $reponse['nom_mod_trans'];?></p>
				                </a>
				            </li>
						<?php
						}$requete-> closeCursor();
	                ?>
	                </ul>
	            </li>
				<?php
			}$requeteMarchandise-> closeCursor();
		}

		public function afficherMenuModeTransportDashboard($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$style = '';

			$requete = $connexion-> prepare("SELECT DISTINCT(id_mod_trans) AS id_mod_trans, 
													UPPER(nom_mod_trans) AS nom_mod_trans
												FROM mode_transport 
												WHERE id_mod_trans IN (
													SELECT DISTINCT(id_mod_trans) AS id_mod_trans 
														FROM dossier 
														WHERE id_mod_lic = ?
												)
											");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && (isset($_GET['id_mod_trans'])) && ($reponse['id_mod_trans'] == $_GET['id_mod_trans']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="dashboardDossier.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;id_mod_trans=<?php echo $reponse['id_mod_trans'];?>&commodity=" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['nom_mod_trans'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherMenuLicenceClient($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$style = '';

			$requete = $connexion-> prepare("SELECT num_lic
												FROM licence
												WHERE id_mod_lic = ? 
													AND id_cli = ?
												ORDER BY date_creat_lic DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				if( (isset($_GET['id_cli'])) && ($id_cli == $_GET['id_cli']) && (isset($id_cli)) && ($reponse['num_lic'] == $_GET['num_lic']) ){
					$style = 'style="font-weight: bold; color: white;"';
				}else{
					$style = '';
				}
			?>
				<li class="nav-item">
	                <a href="dossier.php?id_cli=<?php echo $id_cli;?>&amp;id_mod_trac=<?php echo $id_mod_lic;?>&amp;num_lic=<?php echo $reponse['num_lic'];?>" class="nav-link" <?php echo $style;?>>
	                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-circle nav-icon"></i>
	                  <p><?php echo $reponse['num_lic'];?></p>
	                </a>
	            </li>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherEnTeteTableau($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			if ($id_cli == 869 && $_GET['id_march'] == 11) {
				$id_cli = 883;
			}
			
			$entree['id_mod_trans'] = $id_mod_trans;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

            if ($_GET['id_mod_lic'] == '1') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 869';
				}

            }else if ($_GET['id_mod_lic'] == '2') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 857';
				}

            }

			if ($_SESSION['id_role'] != '7' && $_SESSION['id_role'] != '8' && $_SESSION['id_role'] != '9' && $_SESSION['id_role'] != '10' && $_SESSION['id_role'] != '14') {
				
			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col, c.id_col AS id_col
												FROM colonne c, client cl, affectation_colonne_client_modele_licence af
												WHERE c.id_col = af.id_col
													AND af.id_cli = cl.id_cli
												    $sqlClient
												    AND af.id_mod_lic = ?
												    AND af.id_mod_trans = ?
												ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));

			}else{
				$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col, c.id_col AS id_col
												FROM colonne c, client cl, affectation_colonne_client_modele_licence af, affectation_colonne_role_modele_licence rolic
												WHERE c.id_col = af.id_col
													AND af.id_cli = cl.id_cli
												    $sqlClient
												    AND af.id_mod_lic = ?
												    AND af.id_mod_trans = ?
												    AND c.id_col = rolic.id_col
												    AND rolic.id_role = ?
												    AND rolic.id_mod_lic = ?
												ORDER BY rolic.rang ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans'], $_SESSION['id_role'], $entree['id_mod_lic']));
			}
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">#</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">MCA File REF</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class=""></th>
			<?php
			while ($reponse = $requete-> fetch()) {
				if ($reponse['id_col']=='42' && $id_mod_lic=='2' && $_SESSION['id_role'] == '10') {

				?>
				<th style="border: 1px solid white;">
					AMICONGO STATUS
				</th>
				<?php

				}else if ($reponse['id_col']=='42' && $id_mod_lic=='2' && $id_mod_trans=='1') {

				?>
				<th style="border: 1px solid white;">
					GENERAL STATUS
				</th>
				<th style="border: 1px solid white;">
					KLSA STATUS
				</th>
				<th style="border: 1px solid white;">
					AMICONGO STATUS
				</th>
				<th style="border: 1px solid white;">
					KZI STATUS
				</th>
				<?php

				}else{

				?>
				<th style="border: 1px solid white;"><?php echo $reponse['titre_col'];?></th>
				<?php
				
				}

			}$requete-> closeCursor();
			?>
			</tr>
			<?php
		}

		public function afficherEnTeteTableauPopUp($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

            if ($_GET['id_mod_lic'] == '1') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 869';
				}

            }else if ($_GET['id_mod_lic'] == '2') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 857';
				}

            }

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    $sqlClient
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">#</th>
		      <th style="border: 1px solid white; background-color: #222530; color: white;" class="">MCA File REF</th>
			<?php
			while ($reponse = $requete-> fetch()) {
				
			?>
			<th style="border: 1px solid white;"><?php echo $reponse['titre_col'];?></th>
			<?php

			}$requete-> closeCursor();
			?>
			</tr>
			<?php
		}

		public function afficherDocumentDossierCreate($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;

				?>

	            <div class="col-md-4">
	            	<input type="hidden" name="id_doc_<?php echo $compteur;?>" value="<?php echo $reponse['id_doc'];?>">
	              <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['nom_doc'];?></label>
	              <input type="file" name="fichier_<?php echo $compteur;?>" class="form-control cc-exp">
	            </div>

				<?php
			

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre_document" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherCelluleTableauNewExport($id_mod_lic, $id_cli, $id_mod_trans, $id_march){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$i = 1;

			if ($id_mod_trans == '1') {
				$maxPoids = 'max=40';
			}else{
				$maxPoids = 'max=50';
			}

			?>
			<tr style="border: 1px solid white;">
				<td style="" class="col_1"><?php echo $i;?></td>
				<td style="border: 0.5px solid black;" class="col_6">
					<input type="text" class="form-control cc-exp" name="ref_dos_<?php echo $i;?>" value="<?php echo $this-> getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $i);?>">
				</td>
				<?php
				if (isset($_GET['num_lic']) && ($_GET['num_lic']!='')) {
					?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 14em;" class="form-control cc-exp" value="<?php echo $_GET['num_lic'];?>" disabled>
					<input type="hidden"name="num_lic_<?php echo $i;?>"name="num_lic_<?php echo $i;?>" value="<?php echo $_GET['num_lic'];?>" >
				</td>
					<?php
				}else{
					?>
				<td style="border: 0.5px solid black;">
					<select name="num_lic_<?php echo $i;?>" style="width: 14em;" onchange="" class="form-control cc-exp">
		              <option value="<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>">
		              	<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>
		              </option>
						<option></option>
		                <?php
		                  $this->selectionnerLicenceModeleClientActive($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_march']);
		                ?>
		            </select>
				</td>
					<?php
				}
				?>
				<td style="border: 0.5px solid black;">
					<input type="date" style="width: 10em;" class="form-control cc-exp" name="load_date_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" value="<?php echo $this-> getClient($id_cli)['site'];?>" style="width: 10em;" class="form-control cc-exp" name="site_load_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="destination_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="horse_<?php echo $i;?>">
				</td>
				<?php
				if ($id_mod_trans != '4') {
				?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
				</td>
				<?php 
				} else {
				?>
				<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
				<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
				<?php 
				} 
				?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="nbr_bags_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="number" step="0.001" style="width: 10em;" <?php echo $maxPoids;?> class="form-control cc-exp" name="poids_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="num_lot_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="dgda_seal_<?php echo $i;?>">
				</td>
				<?php
				if ($id_mod_trans != '4') {
				?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="transporter_<?php echo $i;?>">
				</td>
				<?php 
				} else {
				?>
				<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="transporter_<?php echo $i;?>">
				<?php 
				} 
				?>
			</tr>
			<?php
			for ($i=2; $i <=10 ; $i++) { 
				?>
				<tr style="border: 1px solid white;">
					<td style="" class="col_1"><?php echo $i;?></td>
					<td style="border: 0.5px solid black;" class="col_6">
						<input type="text" class="form-control cc-exp" name="ref_dos_<?php echo $i;?>" value="<?php echo $this-> getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, ($i-1), ($i-1));?>">
					</td>
					<?php
					if (isset($_GET['num_lic']) && ($_GET['num_lic']!='')) {
						?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 14em;" class="form-control cc-exp" value="<?php echo $_GET['num_lic'];?>" disabled>
						<input type="hidden"name="num_lic_<?php echo $i;?>"name="num_lic_<?php echo $i;?>" value="<?php echo $_GET['num_lic'];?>" >
					</td>
						<?php
					}else{
						?>
					<td style="border: 0.5px solid black;">
						<select name="num_lic_<?php echo $i;?>" style="width: 14em;" onchange="" class="form-control cc-exp">
			              <option value="<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>">
			              	<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>
			              </option>
							<option></option>
			                <?php
			                  $this->selectionnerLicenceModeleClientActive($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_march']);
			                ?>
			            </select>
					</td>
						<?php
					}
					?>
					<td style="border: 0.5px solid black;">
						<input type="date" style="width: 10em;" class="form-control cc-exp" name="load_date_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" value="<?php echo $this-> getClient($id_cli)['site'];?>" style="width: 10em;" class="form-control cc-exp" name="site_load_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="destination_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="horse_<?php echo $i;?>">
					</td>
					<?php
					if ($id_mod_trans != '4') {
					?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
					</td>
					<?php 
					} else {
					?>
					<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
					<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
					<?php 
					} 
					?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="nbr_bags_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="number" step="0.001" style="width: 10em;" <?php echo $maxPoids;?> class="form-control cc-exp" name="poids_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="num_lot_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="dgda_seal_<?php echo $i;?>">
					</td>
					<?php
					if ($id_mod_trans != '4') {
					?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="transporter_<?php echo $i;?>">
					</td>
					<?php 
					} else {
					?>
					<input type="hidden" style="width: 10em;" class="form-control cc-exp" name="transporter_<?php echo $i;?>">
					<?php 
					} 
					?>
				</tr>
				<?php
				?>
				<input type="hidden" name="nbre" value="<?php echo $i;?>">
				<?php
			}
		}

		public function afficherCelluleTableauNewExportAMC($id_mod_lic, $id_cli, $id_mod_trans, $id_march){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;

			if ($id_mod_trans == '1') {
				$maxPoids = 'max=40';
			}else{
				$maxPoids = 'max=50';
			}

			$i = 1;
			?>
			<tr style="border: 1px solid white;">
				<td style="" class="col_1"><?php echo $i;?></td>
				<td style="border: 0.5px solid black;" class="col_6">
					<input type="text" class="form-control cc-exp" name="ref_dos_<?php echo $i;?>" value="<?php echo $this-> getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $i);?>">
				</td>
				<?php
				if (isset($_GET['num_lic']) && ($_GET['num_lic']!='')) {
					?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 14em;" class="form-control cc-exp" value="<?php echo $_GET['num_lic'];?>" disabled>
					<input type="hidden"name="num_lic_<?php echo $i;?>"name="num_lic_<?php echo $i;?>" value="<?php echo $_GET['num_lic'];?>" >
				</td>
					<?php
				}else{
					?>
				<td style="border: 0.5px solid black;">
					<select name="num_lic_<?php echo $i;?>" style="width: 14em;" onchange="" class="form-control cc-exp">
		              <option value="<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>">
		              	<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>
		              </option>
						<option></option>
		                <?php
		                  $this->selectionnerLicenceModeleClientActive($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_march']);
		                ?>
		            </select>
				</td>
					<?php
				}
				?>
				<td style="border: 0.5px solid black;">
					<input type="date" style="width: 10em;" class="form-control cc-exp" name="kapulo_load_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" value="<?php echo $this-> getClient($id_cli)['site'];?>" style="width: 10em;" class="form-control cc-exp" name="site_load_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" value="ZAMBIE" class="form-control cc-exp" name="destination_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="horse_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="nbr_bags_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="number" step="0.001" style="width: 10em;" <?php echo $maxPoids;?> class="form-control cc-exp" name="poids_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="num_lot_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="ship_num_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="barge_<?php echo $i;?>">
				</td>
			</tr>
			<?php
			for ($i=2; $i <=10 ; $i++) { 
				?>
				<tr style="border: 1px solid white;">
					<td style="" class="col_1"><?php echo $i;?></td>
					<td style="border: 0.5px solid black;" class="col_6">
						<input type="text" class="form-control cc-exp" name="ref_dos_<?php echo $i;?>" value="<?php echo $this-> getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $i, ($i-1));?>">
					</td>
					<?php
					if (isset($_GET['num_lic']) && ($_GET['num_lic']!='')) {
						?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 14em;" class="form-control cc-exp" value="<?php echo $_GET['num_lic'];?>" disabled>
						<input type="hidden"name="num_lic_<?php echo $i;?>"name="num_lic_<?php echo $i;?>" value="<?php echo $_GET['num_lic'];?>" >
					</td>
						<?php
					}else{
						?>
					<td style="border: 0.5px solid black;">
						<select name="num_lic_<?php echo $i;?>" style="width: 14em;" onchange="" class="form-control cc-exp">
			              <option value="<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>">
			              	<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>
			              </option>
							<option></option>
			                <?php
			                  $this->selectionnerLicenceModeleClientActive($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_march']);
			                ?>
			            </select>
					</td>
						<?php
					}
					?>
					<td style="border: 0.5px solid black;">
						<input type="date" style="width: 10em;" class="form-control cc-exp" name="kapulo_load_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" value="<?php echo $this-> getClient($id_cli)['site'];?>" style="width: 10em;" class="form-control cc-exp" name="site_load_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" value="ZAMBIE" class="form-control cc-exp" name="destination_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="horse_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="nbr_bags_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="number" step="0.001" <?php echo $maxPoids;?> style="width: 10em;" class="form-control cc-exp" name="poids_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="num_lot_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="ship_num_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="barge_<?php echo $i;?>">
					</td>
				</tr>
				<?php
				?>
				<input type="hidden" name="nbre" value="<?php echo $i;?>">
				<?php
			}
		}

		public function afficherCelluleTableauNewImportAcid($id_mod_lic, $id_cli, $id_mod_trans, $id_march){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$i = 1;
			?>
			<tr style="border: 1px solid white;">
				<td style="" class="col_1"><?php echo $i;?></td>
				<td style="border: 0.5px solid black;" class="col_6">
					<input type="text" class="form-control cc-exp" name="ref_dos_<?php echo $i;?>" value="<?php echo $this-> getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $i);?>">
				</td>
				<?php
				if (isset($_GET['num_lic']) && ($_GET['num_lic']!='')) {
					?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 14em;" class="form-control cc-exp" value="<?php echo $_GET['num_lic'];?>" disabled>
					<input type="hidden"name="num_lic_<?php echo $i;?>"name="num_lic_<?php echo $i;?>" value="<?php echo $_GET['num_lic'];?>" >
				</td>
					<?php
				}else{
					?>
				<td style="border: 0.5px solid black;">
					<select name="num_lic_<?php echo $i;?>" style="width: 14em;" onchange="" class="form-control cc-exp">
		              <option value="<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>">
		              	<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>
		              </option>
						<option></option>
		                <?php
		                  $this->selectionnerLicenceModeleClientActive($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_march']);
		                ?>
		            </select>
				</td>
					<?php
				}
				?>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="t1_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="number" step="0.0001" min="0" style="width: 10em;" class="form-control cc-exp" name="poids_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 20em;" class="form-control cc-exp" name="ref_fact_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="horse_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="date" style="width: 10em;" class="form-control cc-exp" name="klsa_arriv_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="date" style="width: 10em;" class="form-control cc-exp" name="crossing_date_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="date" style="width: 10em;" class="form-control cc-exp" name="wiski_arriv_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="date" style="width: 10em;" class="form-control cc-exp" name="wiski_dep_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="text" style="width: 10em;" class="form-control cc-exp" name="ref_crf_<?php echo $i;?>">
				</td>
				<td style="border: 0.5px solid black;">
					<input type="date" style="width: 10em;" class="form-control cc-exp" name="date_crf_<?php echo $i;?>">
				</td>
			</tr>
			<?php
			for ($i=2; $i <=10 ; $i++) { 
				?>
				<tr style="border: 1px solid white;">
					<td style="" class="col_1"><?php echo $i;?></td>
					<td style="border: 0.5px solid black;" class="col_6">
						<input type="text" class="form-control cc-exp" name="ref_dos_<?php echo $i;?>" value="<?php echo $this-> getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $i, ($i-1));?>">
					</td>
					<?php
					if (isset($_GET['num_lic']) && ($_GET['num_lic']!='')) {
						?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 14em;" class="form-control cc-exp" value="<?php echo $_GET['num_lic'];?>" disabled>
						<input type="hidden"name="num_lic_<?php echo $i;?>"name="num_lic_<?php echo $i;?>" value="<?php echo $_GET['num_lic'];?>" >
					</td>
						<?php
					}else{
						?>
					<td style="border: 0.5px solid black;">
						<select name="num_lic_<?php echo $i;?>" style="width: 14em;" onchange="" class="form-control cc-exp">
			              <option value="<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>">
			              	<?php echo $this-> getLastLicenceClientActive($_GET['id_cli'], $_GET['id_mod_trac'], $_GET['id_mod_trans'], $_GET['id_march'])['num_lic'];?>
			              </option>
						<option></option>
			                <?php
			                  $this->selectionnerLicenceModeleClientActive($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_march']);
			                ?>
			            </select>
					</td>
						<?php
					}
					?>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="t1_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="number" step="0.0001" min="0" style="width: 10em;" class="form-control cc-exp" name="poids_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 20em;" class="form-control cc-exp" name="ref_fact_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="horse_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_1_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="trailer_2_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="date" style="width: 10em;" class="form-control cc-exp" name="klsa_arriv_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="date" style="width: 10em;" class="form-control cc-exp" name="crossing_date_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="date" style="width: 10em;" class="form-control cc-exp" name="wiski_arriv_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="date" style="width: 10em;" class="form-control cc-exp" name="wiski_dep_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="text" style="width: 10em;" class="form-control cc-exp" name="ref_crf_<?php echo $i;?>">
					</td>
					<td style="border: 0.5px solid black;">
						<input type="date" style="width: 10em;" class="form-control cc-exp" name="date_crf_<?php echo $i;?>">
					</td>
				</tr>
				<?php
				?>
				<input type="hidden" name="nbre" value="<?php echo $i;?>">
				<?php
			}
		}


		public function afficherEnTeteTableauExcel($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col, c.id_col AS id_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 0.2px solid white; background-color: #696969; color: white;">#</th>
		      <th style="border: 0.2px solid white; background-color: #696969; color: white;">MCA File REF</th>
			<?php
			while ($reponse = $requete-> fetch()) {
				if ($reponse['id_col'] == '44') {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 50em; padding-right: 50em;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '43') {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 60em; padding-right: 60em;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '11') {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 300px; padding-right: 300px;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '13') {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 300px; padding-right: 300px;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white;">
					<?php echo $reponse['titre_col'];?>
				</th>
				<?php

				}
			}$requete-> closeCursor();
			?>
			</tr>
			<?php
		}

		public function afficherEnTeteTableauExcel2($id_mod_lic, $id_cli, $id_mod_trans, $excel){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$row = 4;
			$col = 'C';
			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col, c.id_col AS id_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_lic = ?
											    AND af.id_mod_trans = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans']));
			$excel-> getActiveSheet()
				-> setCellValue('A1', $reponse['titre_col'])
				-> setCellValue('A1', $reponse['titre_col']);
			
				/*
			?>
		    <tr class="bg bg-dark">
		      <th style="border: 0.2px solid white; background-color: #696969; color: white;">#</th>
		      <th style="border: 0.2px solid white; background-color: #696969; color: white;">MCA File REF</th>
			<?php
			while ($reponse = $requete-> fetch()) {
				if ($reponse['id_col'] == '44') {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 50em; padding-right: 50em;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '43') {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 60em; padding-right: 60em;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '11') {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 300px; padding-right: 300px;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else if ($reponse['id_col'] == '13') {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white; padding-left: 300px; padding-right: 300px;"><?php echo $reponse['titre_col'];?></th>
				<?php

				}else {	
				?>
				<th style="border: 0.2px solid white; background-color: #696969; color: white;">
					<?php echo $reponse['titre_col'];?>
				</th>
				<?php

				}
			}$requete-> closeCursor();
			?>
			</tr>
			<?php */
		}

		public function verifierDoublonFacture($ref_fact){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE ref_fact = ?');
			$requete-> execute(array($entree['ref_fact']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function verifierRegimeSuspensionSansDateExtreme($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requeteVerifier = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.temporelle = '1'
													AND (
															(d.klsa_arriv IS NOT NULL AND d.id_mod_trans = '1')
															OR
															(d.arrival_date IS NOT NULL AND d.id_mod_trans = '3')
														) 
													AND d.date_ext_temporelle IS NULL");
			$requeteVerifier-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponseVerifier = $requeteVerifier-> fetch();
			return $reponseVerifier['nbre'];
		}

		public function verifierRegimeSuspensionDateExtremeExpire($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requeteVerifier = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.temporelle = '1'
													AND d.klsa_arriv IS NOT NULL
													AND (DATEDIFF(d.date_ext_temporelle, CURRENT_DATE()) <= 0)");
			$requeteVerifier-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponseVerifier = $requeteVerifier-> fetch();
			return $reponseVerifier['nbre'];
		}

		public function verifierSouscriptionLicence($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT id_cli
												FROM souscription_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?');
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			$reponse = $requete-> fetch();

			if ($reponse) {
				return true;
			}else{
				return false;
			}
		}

		public function verifierErreurDateKlsa($id_dos){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare('SELECT id_dos
												FROM dossier
												WHERE id_dos = ?
													AND id_mod_lic = 2
													AND id_mod_trans = 1
													AND ( (klsa_arriv IS NULL 
															AND (wiski_arriv IS NOT NULL OR dispatch_klsa IS NOT NULL)
															)
														OR (wiski_arriv IS NULL AND dispatch_klsa IS NOT NULL)

														OR (klsa_arriv > wiski_arriv)
														OR (wiski_arriv > wiski_dep)
														OR (wiski_dep > dispatch_klsa)
														OR (klsa_arriv > wiski_dep)
														OR (klsa_arriv > dispatch_klsa)
														OR (wiski_arriv > dispatch_klsa)
														)
													AND ref_dos NOT LIKE "%20-%"
											');
			$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			if ($reponse) {
				return true;
			}else{
				return false;
			}
		}

		public function nbreErreurDateKlsa(){
			include('connexion.php');

			//$entree['id_dos'] = $id_dos;

			$requete = $connexion-> query('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = 2
													AND id_mod_trans = 1
													AND ( (klsa_arriv IS NULL 
															AND (wiski_arriv IS NOT NULL OR dispatch_klsa IS NOT NULL)
															)
														OR (wiski_arriv IS NULL AND dispatch_klsa IS NOT NULL)

														OR (klsa_arriv > wiski_arriv)
														OR (wiski_arriv > wiski_dep)
														OR (wiski_dep > dispatch_klsa)
														OR (klsa_arriv > wiski_dep)
														OR (klsa_arriv > dispatch_klsa)
														OR (wiski_arriv > dispatch_klsa)
														)
													AND ref_dos NOT LIKE "%20-%"
											');
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreErreurDateKzi(){
			include('connexion.php');

			//$entree['id_dos'] = $id_dos;

			$requete = $connexion-> query('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = 2
													AND id_mod_trans = 1
													AND dispatch_deliv IS NOT NULL
													AND (dispatch_deliv < klsa_arriv
															OR dispatch_deliv < wiski_arriv
															OR dispatch_deliv < wiski_dep
															OR dispatch_deliv < dispatch_klsa)
													AND ref_dos NOT LIKE "%20-%"
											');
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreDossierSansLiquidationApresCotation($id_cli=NULL, $id_mod_lic=NULL){
			include("connexion.php");

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			//$entree['num_lic'] = $num_lic;

			$requete = $connexion-> query("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = '2'
													AND (d.ref_decl IS NOT NULL AND TRIM(d.ref_decl)<>'')
													AND d.date_decl IS NOT NULL
													AND (d.ref_liq IS NULL OR TRIM(d.ref_liq)='')
													AND d.date_liq IS NULL
													AND d.cleared <> '2'
													AND d.ref_dos NOT LIKE '%20-%'
													AND DATEDIFF(CURRENT_DATE(), d.date_decl) > 2
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.id_cli <> 874 
												ORDER BY d.date_creat_dos ASC
													$sqlClient");
			//$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function afficherErreurDateKlsa(){
			include('connexion.php');
			$ligne = '';
			$compteur = 0;
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_trans = 1
													AND ( (d.klsa_arriv IS NULL 
															AND (d.wiski_arriv IS NOT NULL OR d.dispatch_klsa IS NOT NULL)
															)
														OR (d.wiski_arriv IS NULL AND d.dispatch_klsa IS NOT NULL)

														OR (d.klsa_arriv > d.wiski_arriv)
														OR (d.wiski_arriv > d.wiski_dep)
														OR (d.wiski_dep > d.dispatch_klsa)
														OR (d.klsa_arriv > d.wiski_dep)
														OR (d.klsa_arriv > d.dispatch_klsa)
														OR (d.wiski_arriv > d.dispatch_klsa)
														)
													AND d.ref_dos NOT LIKE '%20-%'
											");
			//$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['horse'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_1'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_2'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_dep'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_klsa'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;
		}

		public function getNombreDossierSansQuittanceApresIM4($id_cli=NULL, $id_mod_lic=NULL){
			include("connexion.php");

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			//$entree['num_lic'] = $num_lic;

			$requete = $connexion-> query("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier d
												WHERE (d.ref_liq IS NOT NULL AND TRIM(d.ref_liq)<>'')
													AND d.date_liq IS NOT NULL
													AND d.date_quit IS NULL
													AND (d.ref_quit IS NULL OR TRIM(d.ref_quit)='')
													AND DATEDIFF(CURRENT_DATE(), d.date_liq) > 2
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.id_cli <> 874
													$sqlClient");
			//$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function afficherNotificationMailDossierSansQuittanceApresIM4(){
			include("connexion.php");

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATEDIFF(CURRENT_DATE(), d.date_liq) AS duree_liq,
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree_preal
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND (d.ref_liq IS NOT NULL AND TRIM(d.ref_liq)<>'')
													AND d.date_liq IS NOT NULL
													AND d.date_quit IS NULL
													AND (d.ref_quit IS NULL OR TRIM(d.ref_quit)='')
													AND DATEDIFF(CURRENT_DATE(), d.date_liq) > 2
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.id_cli <> 874
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; text-align: center;" style="" class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black;" class="border: 1px solid black;">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="text-align: center;border: 1px solid black; " class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="text-align: center;border: 1px solid black; " class="">
					'.$reponse['duree_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['ref_decl'].'
				</td>
				<td class="" style="text-align: center;border: 1px solid black; " class="">
					'.$reponse['date_decl'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['ref_liq'].'
				</td>
				<td class="" style="text-align: center;border: 1px solid black; " class="">
					'.$reponse['date_liq'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['duree_liq'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherNotificationMailDossierSansLiquidation(){
			include("connexion.php");

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.date_creat_dos, '%d/%m/%Y') AS date_creat_dos, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													d.ref_decl AS ref_decl,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl, 
													d.ref_liq AS ref_liq,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.date_decl) AS duree,
													DATEDIFF(CURRENT_DATE(), d.date_preal) AS duree_preal
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = '2'
													AND (d.ref_decl IS NOT NULL AND TRIM(d.ref_decl)<>'')
													AND d.date_decl IS NOT NULL
													AND (d.ref_liq IS NULL OR TRIM(d.ref_liq)='')
													AND d.date_liq IS NULL
													AND d.cleared <> '2'
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.id_cli <> 874
													AND DATEDIFF(CURRENT_DATE(), d.date_decl) > 2
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black;" class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black;" class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black;" class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="text-align: center;border: 1px solid black;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="text-align: center;border: 1px solid black;" class="">
					'.$reponse['duree_preal'].'
				</td>
				<td class="" style="border: 1px solid black;" class="">
					'.$reponse['ref_decl'].'
				</td>
				<td class="" style="text-align: center;border: 1px solid black;" class="">
					'.$reponse['date_decl'].'
				</td>
				<td class="" style="text-align: center;border: 1px solid black;" class="">
					'.$reponse['duree'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function verifierDelaiDateKlsa($id_dos){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare('SELECT id_dos
												FROM dossier
												WHERE id_dos = ?
													AND id_mod_lic = 2
													AND id_mod_trans = 1
													AND dispatch_klsa IS NULL
													AND wiski_dep IS NULL
													AND klsa_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , klsa_arriv)>2
													AND ref_dos NOT LIKE "%20-%"
											');
			$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			if ($reponse) {
				return true;
			}else{
				return false;
			}
		}

		public function afficherDelaiDateKlsa(){
			include("connexion.php");

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = 1
													AND d.dispatch_klsa IS NULL
													AND d.wiski_dep IS NULL
													AND d.klsa_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , d.klsa_arriv)>2
													AND d.ref_dos NOT LIKE '%20-%'
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['horse'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_1'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_2'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_dep'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_klsa'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherDepartedWiski(){
			include("connexion.php");

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													DATE_FORMAT(d.dispatch_deliv, '%d/%m/%Y') AS dispatch_deliv, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.wiski_dep) AS duree,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = 1
													AND d.wiski_dep IS NOT NULL
													AND d.klsa_arriv IS NOT NULL
													AND d.dispatch_deliv IS NULL
													AND d.ref_dos NOT LIKE '%20-%'
													AND ( cli.id_cli <> 869 )
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['horse'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_1'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_2'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_dep'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_klsa'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_deliv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherDelaiDateWiski(){
			include("connexion.php");

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = 1
													AND d.dispatch_klsa IS NULL
													AND d.wiski_dep IS NULL
													AND d.klsa_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , d.wiski_arriv)>2
													AND d.ref_dos NOT LIKE '%20-%'
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['horse'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_1'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_2'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_dep'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_klsa'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherDateErrorKzi(){
			include("connexion.php");

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													DATE_FORMAT(d.dispatch_deliv, '%d/%m/%Y') AS dispatch_deliv, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = 1
													AND d.dispatch_deliv IS NOT NULL
													AND (d.dispatch_deliv < d.klsa_arriv
															OR d.dispatch_deliv < d.wiski_arriv
															OR d.dispatch_deliv < d.wiski_dep
															OR d.dispatch_deliv < d.dispatch_klsa)
													AND d.ref_dos NOT LIKE '%20-%'
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['horse'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_1'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_2'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_dep'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_klsa'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_deliv'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherClotureSansDeliver(){
			include("connexion.php");
			//$entree['statut'] = $statut;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = 1
													AND d.dispatch_deliv IS NULL
													AND d.cleared = '1'
													AND d.ref_dos NOT LIKE '%20-%'
													AND (d.ref_dos NOT LIKE '%21-%' AND d.cleared='1')
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['statut']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_dep'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_klsa'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherArriveKlsa2Jour(){
			include("connexion.php");
			//$entree['statut'] = $statut;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = '1'
													AND DATEDIFF(CURRENT_DATE() , d.klsa_arriv)<3
													AND d.ref_dos NOT LIKE '%20-%'
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['statut']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['horse'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_1'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_2'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function buildNotificationMailExport(){
			include("connexion.php");
			//$entree['statut'] = $statut;

			$compteur = 0;
			$ligne = '';

			$requeteStatus = $connexion-> query("SELECT *
												FROM status_dashboard
												WHERE id_mod_lic = 1");
			while ($reponseStatus = $requeteStatus-> fetch()) {
				
				$this-> nbreSummary($reponseStatus['nom_stat'], 1, NULL, NULL, NULL);
				$compteur = 0;
			$ligne .='
			<b><font color="red">'.$this-> nbreSummary($reponseStatus['nom_stat'], 1, NULL, NULL, NULL).'</font></b> file(s) '.$reponseStatus['nom_stat'].': <br>
			<table width="100%" style="  border: 1px solid black; border-radius: 5px; border-collapse:collapse;">
	             <tr style="font-weight: bold; background-color: black; color: white;">
	                  <td style="border: 1px solid black;">N.</td>
	                  <td style="border: 1px solid black;">MCA REF. FILE</td>
	                  <td style="border: 1px solid black;">Client</td>
	                  <td style="border: 1px solid black;">Horse</td>
	                  <td style="border: 1px solid black;">Trailer 1</td>
	                  <td style="border: 1px solid black;">Trailer 2</td>
	                  <td style="border: 1px solid black;">LOADING DATE</td>
	                  <td style="border: 1px solid black;">REF.DECL.</td>
	                  <td style="border: 1px solid black;">DATE DECL.</td>
	                  <td style="border: 1px solid black;">REF.LIQ.</td>
	                  <td style="border: 1px solid black;">DATE LIQ.</td>
	                  <td style="border: 1px solid black;">REF.QUIT.</td>
	                  <td style="border: 1px solid black;">DATE QUIT.</td>
	                  <td style="border: 1px solid black;">DELAY</td>
	             </tr>
	            ';
	             $requeteDossier = $connexion-> prepare("SELECT client.nom_cli AS nom_cli,
	             												dossier.ref_dos AS ref_dos,
	             												dossier.horse AS horse,
	             												dossier.trailer_1 AS trailer_1,
	             												dossier.trailer_2 AS trailer_2,
	             												dossier.ref_decl AS ref_decl,
	             												DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
	             												dossier.ref_liq AS ref_liq,
	             												DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
	             												dossier.ref_quit AS ref_quit,
	             												DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit,
	             												DATE_FORMAT(dossier.load_date, '%d/%m/%Y') AS load_date,
	             												DATEDIFF(CURRENT_DATE(), dossier.load_date) AS delay
	             											FROM dossier, client
	             											WHERE dossier.cleared = '0'
	             												AND dossier.statut = ?
	             												AND dossier.id_mod_lic = 1
	             												AND dossier.id_cli = client.id_cli");

	             $requeteDossier-> execute(array($reponseStatus['nom_stat']));

	             while ($reponseDossier = $requeteDossier-> fetch()) {
	             	$compteur++;
					$ligne .= '
						<tr style="<?php echo $bg;?>">
							<td class="" style="border: 1px solid black; " class="">
								'.$compteur.'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['ref_dos'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['nom_cli'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['horse'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['trailer_1'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['trailer_2'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['load_date'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['ref_decl'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['date_decl'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['ref_liq'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['date_liq'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['ref_quit'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['date_quit'].'
							</td>
							<td class="" style="border: 1px solid black; " class="">
								'.$reponseDossier['delay'].'
							</td>
						</tr>';
	             }$requeteDossier-> closeCursor();
	             $ligne .='
				         </table>
				         <br>
				         <br>';

			}$requeteStatus-> closeCursor();

			return $ligne;

		}

		public function afficherDispatchDeliveryKzi(){
			include("connexion.php");
			//$entree['statut'] = $statut;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.dispatch_deliv, '%d/%m/%Y') AS dispatch_deliv, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = '1'
													AND DATEDIFF(CURRENT_DATE() , d.dispatch_deliv)<3
													AND d.ref_dos NOT LIKE '%20-%'
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['statut']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['horse'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_1'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_2'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_deliv'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherDossierDashboardEtat($etat, $id_cli, $id_mod_lic, $id_mod_trans, $commodity){
			include("connexion.php");
			//$entree['statut'] = $statut;

			$compteur = 0;
			$ligne = '';
			
			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = " AND d.id_cli = $id_cli"; 
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_lic) && ($id_mod_lic!='')) {
				$sqlModeLic = " AND d.id_mod_lic = $id_mod_lic"; 
			}else{
				$sqlModeLic = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlTrans = " AND d.id_mod_trans = $id_mod_trans"; 
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity!='')) {
				$sqlCommodity = " AND d.commodity = $commodity"; 
			}else{
				$sqlCommodity = '';
			}

			if ($etat == 'TOTAL FILES') {
				$requete = $connexion-> query("SELECT d.ref_dos AS ref_dos, cl.nom_cli AS nom_cli,
														d.commodity AS commodity,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
													FROM dossier d, client cl
													WHERE d.ref_dos IS NOT NULL
														AND d.id_cli = cl.id_cli
														$sqlClient
														$sqlModeLic
														$sqlTrans
														$sqlCommodity
												");
			}else if ($etat == 'CLEARING COMPLETED') {
				$requete = $connexion-> query("SELECT d.ref_dos AS ref_dos, cl.nom_cli AS nom_cli,
														d.commodity AS commodity,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
													FROM dossier d, client cl
													WHERE d.ref_dos IS NOT NULL
														AND d.id_cli = cl.id_cli
														AND d.cleared = '1'
														$sqlClient
														$sqlModeLic
														$sqlTrans
														$sqlCommodity
												");
			}else if ($etat == 'FILES IN PROCESS') {
				$requete = $connexion-> query("SELECT d.ref_dos AS ref_dos, cl.nom_cli AS nom_cli,
														d.commodity AS commodity,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
													FROM dossier d, client cl
													WHERE d.ref_dos IS NOT NULL
														AND d.id_cli = cl.id_cli
														AND d.cleared = '0'
														$sqlClient
														$sqlModeLic
														$sqlTrans
														$sqlCommodity
												");
			}else if ($etat == 'CANCELLED') {
				$requete = $connexion-> query("SELECT d.ref_dos AS ref_dos, cl.nom_cli AS nom_cli,
														d.commodity AS commodity,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
													FROM dossier d, client cl
													WHERE d.ref_dos IS NOT NULL
														AND d.id_cli = cl.id_cli
														AND cleared = '2'
														$sqlClient
														$sqlModeLic
														$sqlTrans
														$sqlCommodity
												");
			}

			//$requete-> execute(array($entree['statut']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['commodity'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_decl'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['date_decl'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_liq'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_liq'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['ref_quit'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_quit'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherSearchFile($mot_cle, $id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity,
														$id_march=NULL, $statut=NULL, $num_lic=NULL, 
														$cleared=NULL){
			include("connexion.php");
			$entree['mot_cle'] = $mot_cle;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,

													
													IF(d.id_mod_lic='2' AND d.id_mod_trans='1',
														IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													      'AWAITING CRF/AD/INSURANCE',
													      IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													        'AWAITING CRF/AD',
													          IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													            'AWAITING CRF/INSURANCE',
													            IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NOT NULL,
													              'AWAITING CRF', 
													              IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													                'AWAITING AD/INSURANCE',
													                IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													                  'AWAITING AD',
													                    IF(d.date_crf IS NOT NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													                      'AWAITING INSURANCE',

													                      IF(d.date_decl IS NULL AND d.ref_decl IS NULL, 'UNDER PREPARATION',
													                        IF(d.date_liq IS NULL AND d.ref_liq IS NULL, 'AWAITING LIQUIDATION',
													                          IF(d.date_quit IS NULL AND d.ref_quit IS NULL, 'AWAITING QUITTANCE',
													                            IF(d.date_quit IS NOT NULL AND d.ref_quit IS NOT NULL AND d.dgda_out IS NULL, 'AWAITING BAE/BS', 
													                              IF(d.dgda_out IS NOT NULL AND d.dispatch_deliv IS NOT NULL, 'CLEARING COMPLETED', '')
													                              )
													                            )
													                          )
													                        )
													                      
													                      )
													                  )
													                )
													              )
													            )
													          )
													      )
														,
														d.statut) AS statut,

													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.klsa_arriv IS NOT NULL AND d.wiski_arriv IS NULL,'ARRIVED AT K\'LSA', 
															IF(d.wiski_arriv IS NOT NULL AND d.dispatch_klsa IS NULL, 'AT WISKI',
																IF(d.dispatch_klsa IS NOT NULL, 'DISPATCHED FROM K\'LSA', 'EXCEPTED TO ARRIVE')
																)
															)
														, '') AS klsa_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='LUBUMBASHI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM AMICONGO', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT AMICONGO', '')
																)
															,'')
														,'') AS amicongo_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='KOLWEZI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM WAREHOUSE', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT WAREHOUSE', '')
																)
															,'')
														,'') AS kzi_status,

													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli = cl.id_cli
													AND d.id_mod_lic = ?
													AND (d.ref_dos = ? OR d.ref_fact = ? 
															OR d.ref_crf = ? OR d.horse = ? 
															OR d.trailer_1 = ? OR d.trailer_2 = ?
															OR d.num_lot = ?)
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.date_creat_dos ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "";
					$class = "";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDeleteDossier.php');
				

			?>
				<input type="hidden" name="ref_dos" value="<?php echo $ref_dos;?>">
				<input type="hidden" name="rech" value="true">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><span class="" style="<?php ?>"><?php echo $reponse['ref_dos'];?></span>
					 <?php 
					  if(!isset($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'])){
					  

						if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_log'] == '1') {
						?>
					  	<span title="Historique du dossier" onclick="window.open('popUpLogFile.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=900,height=950');">
					  		<i class="fa fa-history bg bg-dark"  style="padding: 3px; border-radius: 5px;" aria-hidden="true"></i>
	                	</span>
		                <?php
						}
					
					  }
					  ?>
					</td>
					<td style="text-align: center;">
						<span class="btn-xs bg-purple dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </span>
					</td>
					<?php
					$this-> afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $reponse['statut'], $reponse['klsa_status'], $reponse['amicongo_status'], $reponse['kzi_status']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherSearchFileKBP($debut, $fin, $id_mod_trans, 
														$id_mod_lic, $commodity,
														$id_march=NULL, $statut=NULL, $num_lic=NULL, 
														$cleared=NULL){
			include("connexion.php");
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			
			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													cl.id_cli AS id_cli,
													cl.code_cli AS code_cli,

													
													IF(d.id_mod_lic='2' AND d.id_mod_trans='1',
														IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													      'AWAITING CRF/AD/INSURANCE',
													      IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													        'AWAITING CRF/AD',
													          IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													            'AWAITING CRF/INSURANCE',
													            IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NOT NULL,
													              'AWAITING CRF', 
													              IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													                'AWAITING AD/INSURANCE',
													                IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													                  'AWAITING AD',
													                    IF(d.date_crf IS NOT NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													                      'AWAITING INSURANCE',

													                      IF(d.date_decl IS NULL AND d.ref_decl IS NULL, 'UNDER PREPARATION',
													                        IF(d.date_liq IS NULL AND d.ref_liq IS NULL, 'AWAITING LIQUIDATION',
													                          IF(d.date_quit IS NULL AND d.ref_quit IS NULL, 'AWAITING QUITTANCE',
													                            IF(d.date_quit IS NOT NULL AND d.ref_quit IS NOT NULL AND d.dgda_out IS NULL, 'AWAITING BAE/BS', 
													                              IF(d.dgda_out IS NOT NULL AND d.dispatch_deliv IS NOT NULL, 'CLEARING COMPLETED', '')
													                              )
													                            )
													                          )
													                        )
													                      
													                      )
													                  )
													                )
													              )
													            )
													          )
													      )
														,
														d.statut) AS statut,

													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.klsa_arriv IS NOT NULL AND d.wiski_arriv IS NULL,'ARRIVED AT K\'LSA', 
															IF(d.wiski_arriv IS NOT NULL AND d.dispatch_klsa IS NULL, 'AT WISKI',
																IF(d.dispatch_klsa IS NOT NULL, 'DISPATCHED FROM K\'LSA', 'EXCEPTED TO ARRIVE')
																)
															)
														, '') AS klsa_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='LUBUMBASHI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM AMICONGO', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT AMICONGO', '')
																)
															,'')
														,'') AS amicongo_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='KOLWEZI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM WAREHOUSE', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT WAREHOUSE', '')
																)
															,'')
														,'') AS kzi_status,

													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli = cl.id_cli
													AND d.id_mod_lic = ?
													AND (d.date_preal BETWEEN ? AND ?)
													AND d.klsa_arriv IS NOT NULL
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
												ORDER BY d.date_creat_dos ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin'], $entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "";
					$class = "";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDeleteDossier.php');
				

			?>
				<input type="hidden" name="ref_dos" value="<?php echo $ref_dos;?>">
				<input type="hidden" name="rech" value="true">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" vertical-align: middle; text-align: left; padding: 0.6rem;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" vertical-align: middle; text-align: left; padding: 0.6rem;" <?php echo $style;?>><?php echo $reponse['ref_dos'];?></td>
					
					<td style="text-align: center;">
						<?php echo $reponse['code_cli'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['date_preal'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['ref_fact'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['commodity'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['supplier'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['po_ref'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['poids'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['road_manif'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['horse'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['trailer_1'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['trailer_2'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['klsa_arriv'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['wiski_arriv'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['dispatch_klsa'];?>
					</td>
					<td style="text-align: center;">
						<?php echo $reponse['remarque'];?>
					</td>
					<?php
					//$this-> afficherRowTableau($id_mod_lic, $reponse['id_cli'], $id_mod_trans, $reponse['id_dos'], $compteur, $reponse['statut'], $reponse['klsa_status'], $reponse['amicongo_status'], $reponse['kzi_status']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherKpiFile($id_cli, $id_mod_lic, $id_mod_trans, $debut, $fin){
			include('connexion.php');

			//$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_mod_trans'] = $id_mod_trans;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			$sqlClient = '';
			$sqlCommodity = '';
			$ligne = '';
			$compteur = 0;
			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlModeTransport = ' AND d.id_mod_trans = "'.$id_mod_trans.'"';
			}else{
				$sqlModeTransport = '';
			}

			if ($id_mod_lic == '2' && $id_mod_trans == '1') {
				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.nom_cli AS nom_cli,
														d.commodity AS commodity, 
														d.horse AS horse, d.trailer_1 AS trailer_1, 
														d.trailer_2 AS trailer_2,
														DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv,
														d.wiski_arriv AS wiski_arriv_2,
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
														DATE_FORMAT(d.dispatch_deliv, '%d/%m/%Y') AS dispatch_deliv,
														d.dispatch_deliv AS dispatch_deliv_2,
														d.statut AS statut, d.remarque AS remarque 
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli 
														AND d.id_mod_lic = ?
														AND d.wiski_arriv BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");

			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			while ($reponse = $requete-> fetch()) {
				$compteur++;
			
				$ligne .= '
				<tr style="<?php echo $bg;?>">
					<td class="" style="border: 1px solid black; " class="">
						'.$compteur.'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['ref_dos'].'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['nom_cli'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['commodity'].'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['horse'].'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['trailer_1'].'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['trailer_2'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_preal'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['wiski_arriv'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['ref_decl'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_decl'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['ref_liq'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_liq'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['ref_quit'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_quit'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['dispatch_deliv'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.($this-> getDifferenceDate($reponse['dispatch_deliv_2'], $reponse['wiski_arriv_2'])-$this-> getWeekendsAndHolidays($reponse['wiski_arriv_2'], $reponse['dispatch_deliv_2'])).'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['statut'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['remarque'].'
					</td>
				</tr>
				';
			}$requete-> closeCursor();

			}else if ($id_mod_lic == '2' && ($id_mod_trans == '3' || $id_mod_trans == '4') ) {
				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.nom_cli AS nom_cli,
														d.commodity AS commodity, 
														d.horse AS horse, d.trailer_1 AS trailer_1, 
														d.trailer_2 AS trailer_2,
														DATE_FORMAT(d.arrival_date, '%d/%m/%Y') AS arrival_date,
														d.arrival_date AS arrival_date_2,
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
														DATE_FORMAT(d.dispatch_deliv, '%d/%m/%Y') AS dispatch_deliv,
														d.dispatch_deliv AS dispatch_deliv_2,
														d.statut AS statut, d.remarque AS remarque 
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli 
														AND d.id_mod_lic = ?
														AND d.arrival_date BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");

			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			while ($reponse = $requete-> fetch()) {
				$compteur++;
			
				$ligne .= '
				<tr style="<?php echo $bg;?>">
					<td class="" style="border: 1px solid black; " class="">
						'.$compteur.'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['ref_dos'].'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['nom_cli'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['commodity'].'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['horse'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_preal'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['arrival_date'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['ref_decl'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_decl'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['ref_liq'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_liq'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['ref_quit'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_quit'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['dispatch_deliv'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.($this-> getDifferenceDate($reponse['dispatch_deliv_2'], $reponse['arrival_date_2'])-$this-> getWeekendsAndHolidays($reponse['arrival_date_2'], $reponse['dispatch_deliv_2'])).'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['statut'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['remarque'].'
					</td>
				</tr>
				';
			}$requete-> closeCursor();

			}elseif ($id_mod_lic == '2') {
				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.nom_cli AS nom_cli,
														d.commodity AS commodity, 
														d.horse AS horse, d.trailer_1 AS trailer_1, 
														d.trailer_2 AS trailer_2,
														IF(d.id_mod_trans='1', DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, DATE_FORMAT(d.arrival_date, '%d/%m/%Y') AS wiski_arriv),
														IF(d.id_mod_trans='1', d.wiski_arriv AS wiski_arriv_2, d.arrival_date AS wiski_arriv_2),
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
														DATE_FORMAT(d.dispatch_deliv, '%d/%m/%Y') AS dispatch_deliv,
														d.dispatch_deliv AS dispatch_deliv_2,
														d.statut AS statut, d.remarque AS remarque 
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli 
														AND d.id_mod_lic = ?
														AND d.wiski_arriv BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");

			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			while ($reponse = $requete-> fetch()) {
				$compteur++;
			
				$ligne .= '
				<tr style="<?php echo $bg;?>">
					<td class="" style="border: 1px solid black; " class="">
						'.$compteur.'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['ref_dos'].'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['nom_cli'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['commodity'].'
					</td>
					<td class="" style="border: 1px solid black; " class="">
						'.$reponse['horse'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_preal'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['wiski_arriv'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['ref_decl'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_decl'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['ref_liq'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_liq'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['ref_quit'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['date_quit'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['dispatch_deliv'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.($this-> getDifferenceDate($reponse['dispatch_deliv_2'], $reponse['wiski_arriv_2'])-$this-> getWeekendsAndHolidays($reponse['wiski_arriv_2'], $reponse['dispatch_deliv_2'])).'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['statut'].'
					</td>
					<td class="" style="border: 1px solid black; text-align: center;" class="">
						'.$reponse['remarque'].'
					</td>
				</tr>
				';
			}$requete-> closeCursor();

			}else if ($id_mod_lic == '1' && ($id_mod_trans=='4' || $id_mod_trans=='3')) {
				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.nom_cli AS nom_cli,
														d.commodity AS commodity, 
														d.horse AS horse, d.trailer_1 AS trailer_1, 
														d.trailer_2 AS trailer_2,
														DATE_FORMAT(d.load_date, '%d/%m/%Y') AS load_date,
														d.load_date AS load_date_2,
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
														DATE_FORMAT(d.exit_drc, '%d/%m/%Y') AS exit_drc,
														d.exit_drc AS exit_drc_2,
														d.statut AS statut, d.remarque AS remarque 
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli 
														AND d.id_mod_lic = ?
														AND d.load_date BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");
			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			while ($reponse = $requete-> fetch()) {
				$compteur++;
			
				$ligne .= '
					<tr style="<?php echo $bg;?>">
						<td class="" style="border: 1px solid black; " class="">
							'.$compteur.'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['ref_dos'].'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['nom_cli'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['commodity'].'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['horse'].'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['trailer_1'].'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['trailer_2'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['date_preal'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['load_date'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['ref_decl'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['date_decl'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['ref_liq'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['date_liq'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['ref_quit'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['date_quit'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['exit_drc'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.($this-> getDifferenceDate($reponse['exit_drc_2'], $reponse['load_date_2'])-$this-> getWeekendsAndHolidays($reponse['exit_drc_2'], $reponse['load_date_2'])).'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['statut'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['remarque'].'
						</td>
					</tr>
					';
				}
			}else if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, cl.nom_cli AS nom_cli,
														d.commodity AS commodity, 
														d.horse AS horse, d.trailer_1 AS trailer_1, 
														d.trailer_2 AS trailer_2,
														DATE_FORMAT(d.load_date, '%d/%m/%Y') AS load_date,
														d.load_date AS load_date_2,
														DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
														d.ref_decl AS ref_decl,
														DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
														d.ref_liq AS ref_liq,
														DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
														d.ref_quit AS ref_quit,
														DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
														DATE_FORMAT(d.exit_drc, '%d/%m/%Y') AS exit_drc,
														d.exit_drc AS exit_drc_2,
														d.statut AS statut, d.remarque AS remarque 
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli 
														AND d.id_mod_lic = ?
														AND d.load_date BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");
			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			while ($reponse = $requete-> fetch()) {
				$compteur++;
			
				$ligne .= '
					<tr style="<?php echo $bg;?>">
						<td class="" style="border: 1px solid black; " class="">
							'.$compteur.'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['ref_dos'].'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['nom_cli'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['commodity'].'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['horse'].'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['trailer_1'].'
						</td>
						<td class="" style="border: 1px solid black; " class="">
							'.$reponse['trailer_2'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['date_preal'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['load_date'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['ref_decl'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['date_decl'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['ref_liq'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['date_liq'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['ref_quit'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['date_quit'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['exit_drc'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.($this-> getDifferenceDate($reponse['exit_drc_2'], $reponse['load_date_2'])-$this-> getWeekendsAndHolidays($reponse['exit_drc_2'], $reponse['load_date_2'])).'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['statut'].'
						</td>
						<td class="" style="border: 1px solid black; text-align: center;" class="">
							'.$reponse['remarque'].'
						</td>
					</tr>
					';
				}
			}
			return $ligne;

		}

		public function getAvgKpiFile($id_cli, $id_mod_lic, $id_mod_trans, $debut, $fin){
			include('connexion.php');

			//$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_mod_trans'] = $id_mod_trans;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			$sqlClient = '';
			$sqlCommodity = '';
			$ligne = 0;
			$compteur = 0;
			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlModeTransport = ' AND d.id_mod_trans = "'.$id_mod_trans.'"';
			}else{
				$sqlModeTransport = '';
			}

			if ($id_mod_lic == '2' && $id_mod_trans == '1') {
				$requete = $connexion-> prepare("SELECT d.wiski_arriv AS wiski_arriv_2,
														d.dispatch_deliv AS dispatch_deliv_2
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli 
														AND d.id_mod_lic = ?
														AND d.wiski_arriv BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");

			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne += ($this-> getDifferenceDate($reponse['dispatch_deliv_2'], $reponse['wiski_arriv_2'])-$this-> getWeekendsAndHolidays($reponse['dispatch_deliv_2'], $reponse['wiski_arriv_2']));

			}$requete-> closeCursor();

			}else if ($id_mod_lic == '2' && ($id_mod_trans == '3' || $id_mod_trans == '4') ) {
				$requete = $connexion-> prepare("SELECT d.arrival_date AS arrival_date_2,
														d.dispatch_deliv AS dispatch_deliv_2
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli 
														AND d.id_mod_lic = ?
														AND d.arrival_date BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");

			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne += ($this-> getDifferenceDate($reponse['dispatch_deliv_2'], $reponse['arrival_date_2'])-$this-> getWeekendsAndHolidays($reponse['dispatch_deliv_2'], $reponse['arrival_date_2']));

			}$requete-> closeCursor();

			}elseif ($id_mod_lic == '2') {
				$requete = $connexion-> prepare("SELECT IF(d.id_mod_trans='1', d.wiski_arriv AS wiski_arriv_2, 
															d.arrival_date AS wiski_arriv_2),
														d.dispatch_deliv AS dispatch_deliv_2
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli 
														AND d.id_mod_lic = ?
														AND d.wiski_arriv BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");

			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			while ($reponse = $requete-> fetch()) {
				$compteur++;
			
				$ligne += ($this-> getDifferenceDate($reponse['dispatch_deliv_2'], $reponse['wiski_arriv_2'])-$this-> getWeekendsAndHolidays($reponse['dispatch_deliv_2'], $reponse['wiski_arriv_2']));

			}$requete-> closeCursor();

			}else if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT d.load_date AS load_date_2,
														d.exit_drc AS exit_drc_2
													FROM dossier d, client cl
													WHERE d.id_cli = cl.id_cli 
														AND d.id_mod_lic = ?
														AND d.load_date BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");
			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			while ($reponse = $requete-> fetch()) {
				$compteur++;
			
				$ligne += ($this-> getDifferenceDate($reponse['exit_drc_2'], $reponse['load_date_2'])-$this-> getWeekendsAndHolidays($reponse['load_date_2'], $reponse['exit_drc_2']));

				}
			}
			
			if ($compteur == 0) {
				$compteur = 1;
			}

			return $ligne;

		}

		public function afficherArriveWiski2Jour(){
			include("connexion.php");
			//$entree['statut'] = $statut;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal,
													DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = '1'
													AND DATEDIFF(CURRENT_DATE() , d.wiski_arriv)<3
													AND d.ref_dos NOT LIKE '%20-%'
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['statut']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['horse'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_1'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_2'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_arriv'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherDelaiDateStatut($statut){
			include("connexion.php");
			$entree['statut'] = $statut;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> prepare("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = 1
													AND d.klsa_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , d.klsa_arriv)>14
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.statut = ?
												ORDER BY d.date_creat_dos ASC");
			$requete-> execute(array($entree['statut']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_dep'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_klsa'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function afficherDossierUnderPreparation(){
			include("connexion.php");
			//$entree['statut'] = $statut;

			$compteur = 0;
			$ligne = '';
			$requete = $connexion-> query("SELECT DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv, 
													DATE_FORMAT(d.wiski_arriv, '%d/%m/%Y') AS wiski_arriv, 
													DATE_FORMAT(d.date_preal, '%d/%m/%Y') AS date_preal, 
													DATE_FORMAT(d.wiski_dep, '%d/%m/%Y') AS wiski_dep, 
													DATE_FORMAT(d.dispatch_klsa, '%d/%m/%Y') AS dispatch_klsa, 
													cli.nom_cli AS nom_cli,
													d.id_dos AS id_dos,
													d.ref_dos AS ref_dos,
													d.commodity AS commodity,
													d.horse AS horse,
													d.trailer_1 AS trailer_1,
													d.trailer_2 AS trailer_2,
													DATEDIFF(CURRENT_DATE(), d.klsa_arriv) AS duree
												FROM dossier d, client cli
												WHERE d.id_cli = cli.id_cli
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = 1
													AND d.klsa_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , d.klsa_arriv)>14
													AND d.date_crf IS NOT NULL
													AND d.date_ad IS NOT NULL
													AND d.date_assurance IS NOT NULL
													AND d.date_decl IS NULL 
													AND d.ref_decl IS NULL
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.cleared <> '2'
												ORDER BY d.date_creat_dos ASC");
			//$requete-> execute(array($entree['statut']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$ligne .= '
			<tr style="<?php echo $bg;?>">
				<td class="" style="border: 1px solid black; " class="">
					'.$compteur.'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['ref_dos'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['nom_cli'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['horse'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_1'].'
				</td>
				<td class="" style="border: 1px solid black; " class="">
					'.$reponse['trailer_2'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['date_preal'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['klsa_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_arriv'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['wiski_dep'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['dispatch_klsa'].'
				</td>
				<td class="" style="border: 1px solid black; text-align: center;" class="">
					'.$reponse['duree'].'
				</td>
			</tr>
			';
			}$requete-> closeCursor();

			return $ligne;

		}

		public function nbreDelaiDateKlsa(){
			include('connexion.php');

			//$entree['id_dos'] = $id_dos;

			$requete = $connexion-> query('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = 2
													AND id_mod_trans = 1
													AND dispatch_klsa IS NULL
													AND wiski_dep IS NULL
													AND klsa_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , klsa_arriv)>2
													AND ref_dos NOT LIKE "%20-%"
											');
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreDelaiDateWiski(){
			include('connexion.php');

			//$entree['id_dos'] = $id_dos;

			$requete = $connexion-> query('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = 2
													AND id_mod_trans = 1
													AND dispatch_klsa IS NULL
													AND wiski_dep IS NULL
													AND klsa_arriv IS NOT NULL
													AND wiski_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , wiski_arriv)>2
													AND ref_dos NOT LIKE "%20-%"
											');
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreDossierDashboardEtat($etat, $id_cli, $id_mod_lic, $id_mod_trans, $commodity){
			include('connexion.php');

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = " AND id_cli = $id_cli"; 
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_lic) && ($id_mod_lic!='')) {
				$sqlModeLic = " AND id_mod_lic = $id_mod_lic"; 
			}else{
				$sqlModeLic = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlTrans = " AND id_mod_trans = $id_mod_trans"; 
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity!='')) {
				$sqlCommodity = " AND commodity = $commodity"; 
			}else{
				$sqlCommodity = '';
			}

			if ($etat == 'TOTAL FILES') {
				$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE ref_dos IS NOT NULL
														$sqlClient
														$sqlModeLic
														$sqlTrans
														$sqlCommodity
												");
			}else if ($etat == 'CLEARING COMPLETED') {
				$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE ref_dos IS NOT NULL
														AND cleared = '1'
														$sqlClient
														$sqlModeLic
														$sqlTrans
														$sqlCommodity
												");
			}else if ($etat == 'FILES IN PROCESS') {
				$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE ref_dos IS NOT NULL
														AND cleared = '0'
														$sqlClient
														$sqlModeLic
														$sqlTrans
														$sqlCommodity
												");
			}else if ($etat == 'CANCELLED') {
				$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE ref_dos IS NOT NULL
														AND cleared = '2'
														$sqlClient
														$sqlModeLic
														$sqlTrans
														$sqlCommodity
												");
			}

			
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreArriveKlsa2Jour(){
			include('connexion.php');

			//$entree['id_dos'] = $id_dos;

			$requete = $connexion-> query('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = 2
													AND id_mod_trans = 1
													AND klsa_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , klsa_arriv)<3
													AND ref_dos NOT LIKE "%20-%"
											');
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreDepartedFromWiski(){
			include('connexion.php');

			//$entree['id_dos'] = $id_dos;

			$requete = $connexion-> query('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = 2
													AND id_mod_trans = 1
													AND klsa_arriv IS NOT NULL
													AND wiski_dep IS NOT NULL
													AND dispatch_deliv IS NULL
													AND ref_dos NOT LIKE "%20-%"
													AND ( id_cli <> 869 )
											');
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreDispacthDeliverKzi(){
			include('connexion.php');

			//$entree['id_dos'] = $id_dos;

			$requete = $connexion-> query('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = 2
													AND dispatch_deliv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , dispatch_deliv)<3
													AND ref_dos NOT LIKE "%20-%"
											');
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreSearchFile($mot_cle, $id_mod_lic){
			include('connexion.php');

			$entree['mot_cle'] = $mot_cle;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (ref_dos = ? OR ref_fact = ? 
															OR ref_crf = ? OR horse = ? 
															OR trailer_1 = ? OR trailer_2 = ?
															OR num_lot = ?)
											');
			$requete-> execute(array($entree['id_mod_lic'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreSearchFileKPB($debut, $fin, $id_mod_lic){
			include('connexion.php');

			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (date_preal BETWEEN ? AND ?) 
													AND klsa_arriv IS NOT NULL');
			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getDataDossierMotCle($mot_cle, $id_mod_lic){
			include('connexion.php');

			$entree['mot_cle'] = $mot_cle;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT *
												FROM dossier
												WHERE id_mod_lic = ?
													AND (ref_dos = ? OR ref_fact = ? 
															OR ref_crf = ? OR horse = ? 
															OR trailer_1 = ? OR trailer_2 = ?
															OR num_lot = ?)
											');
			$requete-> execute(array($entree['id_mod_lic'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle'], $entree['mot_cle']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function getDataDossierPrealertKBP($date_preal, $id_mod_lic){
			include('connexion.php');

			$entree['date_preal'] = $date_preal;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT *
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_preal = ?
													AND klsa_arriv IS NOT NULL
											');
			$requete-> execute(array($entree['id_mod_lic'], $entree['date_preal']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function getCompteurFactureClientModeleLic($id_cli, $id_mod_lic, $annee, $id_march){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['annee'] = $annee;
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare('SELECT compteur_fact
												FROM affectation_marchandise_client_modele_licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND annee_fact = ?
													AND id_march = ?
											');
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['annee'], $entree['id_march']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function nbreKpiFile($id_cli, $id_mod_lic, $id_mod_trans, $debut, $fin){
			include('connexion.php');

			//$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_mod_trans'] = $id_mod_trans;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			$sqlClient = '';
			$sqlCommodity = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlModeTransport = ' AND id_mod_trans = "'.$id_mod_trans.'"';
			}else{
				$sqlModeTransport = '';
			}

			if ($id_mod_lic == '2' && $id_mod_trans == '1') {
				$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE id_mod_lic = ?
														AND wiski_arriv BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");
			}else if ($id_mod_lic == '2' && ($id_mod_trans == '3' || $id_mod_trans == '4') ) {
				$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE id_mod_lic = ?
														AND arrival_date BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");
			}elseif ($id_mod_lic == '2') {
				$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE id_mod_lic = ?
														AND wiski_arriv BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");
			}else if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
													FROM dossier
													WHERE id_mod_lic = ?
														AND load_date BETWEEN ? AND ?
														$sqlClient
														$sqlModeTransport
												");
			}

			
			$requete-> execute(array($entree['id_mod_lic'], $entree['debut'], $entree['fin']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreArriveWiski2Jour(){
			include('connexion.php');

			//$entree['id_dos'] = $id_dos;

			$requete = $connexion-> query('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = 2
													AND id_mod_trans = 1
													AND wiski_arriv IS NOT NULL
													AND DATEDIFF(CURRENT_DATE() , wiski_arriv)<3
													AND ref_dos NOT LIKE "%20-%"
											');
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreDelaiDateClotureSansDeliver(){
			include('connexion.php');

			//$entree['id_dos'] = $id_dos;

			$requete = $connexion-> query('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = 2
													AND dispatch_deliv IS NULL
													AND id_mod_trans = 1
													AND cleared = "1"
													AND ref_dos NOT LIKE "%20-%"
													AND (ref_dos NOT LIKE "%21-%" AND cleared="1")
											');
			//$requete-> execute(array($entree['id_dos']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreDelaiStatut($statut){
			include('connexion.php');

			$entree['statut'] = $statut;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE statut = ?
													AND id_mod_lic = 2
													AND id_mod_trans = 1
													AND DATEDIFF(CURRENT_DATE() , klsa_arriv)>14
													AND ref_dos NOT LIKE "%20-%"
											');
			$requete-> execute(array($entree['statut']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function nbreUnderPreparation(){
			include('connexion.php');

			//$entree['statut'] = $statut;

			$requete = $connexion-> query('SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d
												WHERE d.date_crf IS NOT NULL
													AND d.date_ad IS NOT NULL
													AND d.date_assurance IS NOT NULL
													AND d.date_decl IS NULL 
													AND d.ref_decl IS NULL
													AND d.ref_dos NOT LIKE "%20-%"
													AND DATEDIFF(CURRENT_DATE() , d.klsa_arriv)>14
													AND d.cleared <> "2"
													AND d.id_mod_lic = 2
													AND d.id_mod_trans = 1
											');
			//$requete-> execute(array($entree['statut']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function verifierDoublonHorse($horse){
			include('connexion.php');

			$entree['horse'] = $horse;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE horse = ?');
			$requete-> execute(array($entree['horse']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function verifierDoublonCRF($ref_crf){
			include('connexion.php');

			$entree['ref_crf'] = $ref_crf;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE ref_crf = ?');
			$requete-> execute(array($entree['ref_crf']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getDossiersDoublonFacture($ref_fact){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;

			$liste = '';

			$requete = $connexion-> prepare('SELECT ref_dos
												FROM dossier
												WHERE ref_fact = ?');
			$requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$liste .= ' | '.$reponse['ref_dos'];
			}$requete-> closeCursor();

			return $liste;
		}

		public function getDossiersDoublonCRF($ref_crf){
			include('connexion.php');

			$entree['ref_crf'] = $ref_crf;

			$liste = '';

			$requete = $connexion-> prepare('SELECT ref_dos
												FROM dossier
												WHERE ref_crf = ?');
			$requete-> execute(array($entree['ref_crf']));

			while($reponse = $requete-> fetch()){
				$liste .= ' | '.$reponse['ref_dos'];
			}$requete-> closeCursor();

			return $liste;
		}

		public function getDossiersDoublonHorse($horse){
			include('connexion.php');

			$entree['horse'] = $horse;

			$liste = '';

			$requete = $connexion-> prepare('SELECT ref_dos
												FROM dossier
												WHERE horse = ?');
			$requete-> execute(array($entree['horse']));

			while($reponse = $requete-> fetch()){
				$liste .= ' | '.$reponse['ref_dos'];
			}$requete-> closeCursor();

			return $liste;
		}

		public function afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur, $statut=NULL, $klsa_status=NULL, $amicongo_status=NULL, $kzi_status=NULL, $clignoteDos=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			if ($id_cli == 869 && $_GET['id_march'] == 11) {
				$entree['id_cli'] = 883;
			}else{
				$entree['id_cli'] = $id_cli;
			}
			
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			if ($_SESSION['id_role'] != '7' && $_SESSION['id_role'] != '8' && $_SESSION['id_role'] != '9' && $_SESSION['id_role'] != '10' && $_SESSION['id_role'] != '14') {
				
			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, 
													c.type_col AS type_col, 
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col 
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));

			}else{
				$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, 
													c.type_col AS type_col, 
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col 
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af, affectation_colonne_role_modele_licence rolic
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											    AND c.id_col = rolic.id_col
											    AND rolic.id_role = ?
											    AND rolic.id_mod_lic = ?
											ORDER BY rolic.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], $_SESSION['id_role'], $entree['id_mod_lic']));
			}
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
					$clignoteCleared = false;

				if($this-> getDossierFacture($id_dos)!=false && ($reponse['champ_col']=='poids' || $reponse['champ_col']=='horse' || $reponse['champ_col']=='trailer_1' || $reponse['champ_col']=='trailer_2')){
					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<input  <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>  type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>" disabled>
				</td>
				<?php

				}else if ($reponse['id_col'] == '40' && $id_mod_lic == '2') {
					$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					if ( ($getDataRowCalculNetDays >= 0) && ($getDataRowCalculNetDays <= 3) ) {
						$bg = "badge badge-success";
					}else if ( ($getDataRowCalculNetDays > 3) && ($getDataRowCalculNetDays <= 5) ) {
						$bg = "badge badge-warning";
					}else if ( ($getDataRowCalculNetDays > 5) ) {
						$bg = "badge badge-danger";
					}
				?>
				<td style="border: 1px solid black; text-align: center;">
					<span class=" <?php echo $bg;?>">
					<?php
						echo $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					?>
					</span>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php
					$bg = '';

				}else if ($reponse['id_col'] == '40' && $id_mod_lic == '1') {

					if ($id_mod_trans == '4') {
						# code...
					}else{

						if ($id_mod_lic == '1') {
							// code...
							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('load_date', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('load_date', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('load_date', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('load_date', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "badge badge-success";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('load_date', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('load_date', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('load_date', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('load_date', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 7) ) {
								$bg = "badge badge-warning";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('load_date', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('load_date', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 7) ) {
								$bg = "badge badge-danger";
							}
							?>
							<td style="border: 1px solid black; text-align: center;">
								<span class=" <?php echo $bg;?>">
								<?php
									echo ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('load_date', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('load_date', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)));
								?>
								</span>
							</td>
							<?php
						
							$bg = '';

						}else{

							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "badge badge-success";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 7) ) {
								$bg = "badge badge-warning";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 7) ) {
								$bg = "badge badge-danger";
							}
						?>
						<td style="border: 1px solid black; text-align: center;">
							<span class=" <?php echo $bg;?>">
							<?php
								echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos));
							?>
							</span>
						</td>
						<?php
						
							$bg = '';
						}



					}

				}
				else if ($reponse['id_col'] == '38') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						$clignoteCleared = true;
						?>
							<option value="0">TRANSIT</option>
							<option value="1">CLEARED</option>
							<?php
							if ($_SESSION['id_role'] == '1') {
							?>
								<option value="2">CANCELLED</option>
							<?php
							}
							?>
							
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
							<option value="1">CLEARED</option>
							<option value="0">TRANSIT</option>
							<?php
							if ($_SESSION['id_role'] == '1') {
							?>
								<option value="2">CANCELLED</option>
							<?php
							}
							?>
						<?php
					}else if ( ($getDataRow == '2') ) {
						?>
							<option value="2">CANCELLED</option>
							<?php
							if ($_SESSION['id_role'] == '1') {
							?>
							<option value="0">TRANSIT</option>
							<option value="1">CLEARED</option>
							<?php
							}
							?>
							
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}
				else if ($reponse['id_col'] == '26') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select style="width: 7em;" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == 'YES') ) {
						$clignoteCleared = true;
						?>
							<option>YES</option>
							<option value="NO">NO</option>
						<?php
					}else if ( ($getDataRow == 'NO') ) {
						?>
							<option>NO</option>
							<option value="YES">YES</option>
						<?php
					}else{
						?>
							<option></option>
							<option value="YES">YES</option>
							<option value="NO">NO</option>
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}else if ($reponse['champ_col'] == 'ir_crf') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select style="width: 7em;" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == 'IR') ) {
						$clignoteCleared = true;
						?>
							<option>IR</option>
							<option value="CRF">CRF</option>
							<option value="ARA">ARA</option>
						<?php
					}else if ( ($getDataRow == 'CRF') ) {
						?>
							<option>CRF</option>
							<option value="IR">IR</option>
							<option value="ARA">ARA</option>
						<?php
					}else if ( ($getDataRow == 'ARA') ) {
						?>
							<option>ARA</option>
							<option value="IR">IR</option>
							<option value="CRF">CRF</option>
						<?php
					}else{
						?>
							<option></option>
							<option value="IR">IR</option>
							<option value="CRF">CRF</option>
							<option value="ARA">ARA</option>
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '49') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option><?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?></option>
						<option></option>
						<option value="LUBUMBASHI">LUBUMBASHI</option>
						<option value="KOLWEZI">KOLWEZI</option>
						<option value="KINSEVERE">KINSEVERE</option>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '113') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option><?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?></option>
						<option></option>
						<?php
							$this-> selectionnerFrontiere2();
						?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '115') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option><?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?></option>
						<option></option>
						<?php
							$this-> selectionnerEntrepot2();
						?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '118') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option><?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?></option>
						<option></option>
						<?php
							$this-> selectionnerRegime2($id_mod_lic);
						?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '17') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<span class="<?php echo $clignoteDos;?>" style="<?php echo $couleurDos;?>"><?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?></span>
				</td>
				<?php
				}else if ($reponse['id_col'] == '18') {
					//Date Expiration Licence
					if ( ($this-> getDifferenceDate($this-> getDateExpirationLicence2($this-> getDossier($id_dos)['num_lic']), date('Y-m-d')) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteLic = ' clignoteb';
						$couleurLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteLic = '';
						$couleurLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurLic;?>">
					<?php echo $this-> getDateExpirationLicence($this-> getDossier($id_dos)['num_lic'])?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '50') {
					// Poids Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'];?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '54') {
					// Balance Tons Licence
					if ( ((($this-> getBalanceLicenceDossier($id_dos)*100)/($this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'])) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteBalanceLic = ' clignoteb';
						$couleurBalanceLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteBalanceLic = '';
						$couleurBalanceLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteBalanceLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurBalanceLic;?>">
					<?php echo number_format( $this-> getBalanceLicenceDossier($id_dos), 2, ',', ' ');?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '71') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('ceec_out', $id_dos), $this-> getDataRow('ceec_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '74') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('min_div_out', $id_dos), $this-> getDataRow('min_div_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '36') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('dgda_out', $id_dos), $this-> getDataRow('dgda_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '88') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '80') {
					// DA To Exit
					if ($this-> getDossier($id_dos)['id_mod_trans'] == '4') {
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('docs_sncc', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}else{
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}
				
				}
				else if ($reponse['calcul'] == '1') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php
						if (isset($this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']])) {
							echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];
						}
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php

				}else if ($reponse['id_col'] == '44') {
					if (!isset($this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'])) {
						
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?> type="<?php echo $reponse['type_col'];?>" style="width: 25em;" name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow('supplier', $id_dos);?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						</td>
						<?php

					}else{

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?> type="text" style="width: 25em;" name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'];?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						</td>
						<?php

					}
				}else if ($reponse['id_col'] == '42' && $id_mod_lic=='2' && $id_mod_trans=='1' && $_SESSION['id_role'] == '10') {
					// Status
					$bgStatuts = '';
					if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
						$bgStatuts = 'bg bg-primary';
					}
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<span class="badge bg-teal">
					<?php
					echo $amicongo_status;
					?>
					</span>
				</td>
				<?php
				}else if ($reponse['id_col'] == '42' && $id_mod_lic=='2' && $id_mod_trans=='1') {
					// Status
					$bgStatuts = '';
					if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
						$bgStatuts = 'bg bg-primary';
					}
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;"><span class="badge badge-dark">
					<?php
					echo $statut;
					/*
					?>
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php 
					*/
					//echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					</span>
				</td>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<span class="badge bg-purple">
					<?php
					echo $klsa_status;
					?>
					</span>
				</td>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<span class="badge bg-teal">
					<?php
					echo $amicongo_status;
					?>
					</span>
				</td>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<span class="badge bg-info">
					<?php
					echo $kzi_status;
					?>
					</span>
				</td>
				<?php
				}else if ($reponse['id_col'] == '42' && $id_mod_lic=='1') {
					// Status
					$bgStatuts = '';
					if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
						$bgStatuts = 'bg bg-primary';
					}
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;"><span class="badge badge-dark">
					<?php
					echo $statut;
					/*
					?>
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php 
					*/
					//echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					</span>
				</td>
				<?php
				}else if ($reponse['id_col'] == '42') {
					// Status
					$bgStatuts = '';
					if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
						$bgStatuts = 'bg bg-primary';
					}
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">
					<?php
					//echo $statut;
					
					?>
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php 
					
					//echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
					
				</td>
				<?php
				}
				//Doublon facture
				else if ($reponse['id_col'] == '11' && ($this-> verifierDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: black; background-color: #FF4500;';
					

					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					</td>
					<?php

				}//Doublon Horse
				else if ($reponse['id_col'] == '14' && ($this-> verifierDoublonHorse($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: black; background-color: #CCCC00;';
					

					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonHorse($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					</td>
					<?php

				}//Doublon COD
				else if ($reponse['champ_col'] == 'ref_crf' && ($this-> verifierDoublonCRF($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: black; background-color: #CC99FF;';
					

					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonCRF($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					</td>
					<?php

				}//Date Dimanche
				else if ($this-> verifierDimancheDate($this-> getDataRow($reponse['champ_col'], $id_dos))!=false ) {

					$textColor = 'color: black; background-color: #FF4500;';
					

					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					</td>
					<?php

				}
				else{
					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<input  <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>  type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherRowTableau2($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

            if ($_GET['id_mod_lic'] == '1') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 869';
				}

            }else if ($_GET['id_mod_lic'] == '2') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 857';
				}

            }

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, 
													c.type_col AS type_col, 
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col 
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    $sqlClient
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] == '40' && $id_mod_lic == '2') {
					$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					if ( ($getDataRowCalculNetDays >= 0) && ($getDataRowCalculNetDays <= 3) ) {
						$bg = "badge badge-success";
					}else if ( ($getDataRowCalculNetDays > 3) && ($getDataRowCalculNetDays <= 5) ) {
						$bg = "badge badge-warning";
					}else if ( ($getDataRowCalculNetDays > 5) ) {
						$bg = "badge badge-danger";
					}
				?>
				<td style="border: 1px solid black; text-align: center;">
					<span class=" <?php echo $bg;?>">
					<?php
						echo $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					?>
					</span>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php
					$bg = '';

				}else if ($reponse['id_col'] == '40' && $id_mod_lic == '1') {

					if ($id_mod_trans == '4') {
						# code...
					}else{

						

							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "badge badge-success";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 7) ) {
								$bg = "badge badge-warning";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 7) ) {
								$bg = "badge badge-danger";
							}
						?>
						<td style="border: 1px solid black; text-align: center;">
							<span class=" <?php echo $bg;?>">
							<?php
								echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos));
							?>
							</span>
						</td>
						<?php
						
							$bg = '';




					}

				}
				else if ($reponse['id_col'] == '38') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						?>
						TRANSIT
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
						CLEARED
						<?php
					}else if ( ($getDataRow == '2') ) {
						?>
						CANCELLED
						<?php
					}
					?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '49') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '17') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '18') {
					//Date Expiration Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDateExpirationLicence($this-> getDossier($id_dos)['num_lic']);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '50') {
					// Poids Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'];?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '54') {
					// Balance Tons Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo number_format( $this-> getBalanceLicenceDossier($id_dos), 2, ',', ' ');?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '71') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('ceec_out', $id_dos), $this-> getDataRow('ceec_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '74') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('min_div_out', $id_dos), $this-> getDataRow('min_div_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '36') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('dgda_out', $id_dos), $this-> getDataRow('dgda_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '88') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '80') {
					// DA To Exit
					if ($this-> getDossier($id_dos)['id_mod_trans'] == '4') {
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('docs_sncc', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}else{
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}
				
				}
				else if ($reponse['calcul'] == '1') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php
						if (isset($this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']])) {
							echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];
						}
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php

				}else if ($reponse['id_col'] == '44') {
					if (!isset($this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'])) {
						
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<?php echo $this-> getDataRow('supplier', $id_dos);?>
						</td>
						<?php

					}else{

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<?php echo $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'];?>
						</td>
						<?php

					}
				}else if ($reponse['id_col'] == '42') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}
				//Doublon facture
				else if ($reponse['id_col'] == '11' && ($this-> verifierDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: black; background-color: #FF4500;';
					

					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
					</td>
					<?php

				}
				else{
					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherRowTableau3($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur, $statut=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

            if ($_GET['id_mod_lic'] == '1') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 869';
				}

            }else if ($_GET['id_mod_lic'] == '2') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = ' AND cl.id_cli = 857';
				}

            }

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, 
													c.type_col AS type_col, 
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.attribut_col AS attribut_col 
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    $sqlClient
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
					$clignoteCleared = false;

				if ($reponse['id_col'] == '40' && $id_mod_lic == '2') {
					$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					if ( ($getDataRowCalculNetDays >= 0) && ($getDataRowCalculNetDays <= 3) ) {
						$bg = "badge badge-success";
					}else if ( ($getDataRowCalculNetDays > 3) && ($getDataRowCalculNetDays <= 5) ) {
						$bg = "badge badge-warning";
					}else if ( ($getDataRowCalculNetDays > 5) ) {
						$bg = "badge badge-danger";
					}
				?>
				<td style="border: 1px solid black; text-align: center;">
					<span class=" <?php echo $bg;?>">
					<?php
						echo $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					?>
					</span>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php
					$bg = '';

				}else if ($reponse['id_col'] == '40' && $id_mod_lic == '1') {

					if ($id_mod_trans == '4') {
						# code...
					}else{

						

							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "badge badge-success";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 7) ) {
								$bg = "badge badge-warning";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 7) ) {
								$bg = "badge badge-danger";
							}
						?>
						<td style="border: 1px solid black; text-align: center;">
							<span class=" <?php echo $bg;?>">
							<?php
								echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos));
							?>
							</span>
						</td>
						<?php
						
							$bg = '';




					}

				}
				else if ($reponse['id_col'] == '38') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						$clignoteCleared = true;
						?>
							<option value="0">TRANSIT</option>
							<option value="1">CLEARED</option>
							<?php
							if ($_SESSION['id_role'] == '1') {
							?>
								<option value="2">CANCELLED</option>
							<?php
							}
							?>
							
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
							<option value="1">CLEARED</option>
							<option value="0">TRANSIT</option>
							<?php
							if ($_SESSION['id_role'] == '1') {
							?>
								<option value="2">CANCELLED</option>
							<?php
							}
							?>
						<?php
					}else if ( ($getDataRow == '2') ) {
						?>
							<option value="2">CANCELLED</option>
							<?php
							if ($_SESSION['id_role'] == '1') {
							?>
							<option value="0">TRANSIT</option>
							<option value="1">CLEARED</option>
							<?php
							}
							?>
							
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}
				else if ($reponse['id_col'] == '26') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select style="width: 7em;" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == 'YES') ) {
						$clignoteCleared = true;
						?>
							<option>YES</option>
							<option value="NO">NO</option>
						<?php
					}else if ( ($getDataRow == 'NO') ) {
						?>
							<option>NO</option>
							<option value="YES">YES</option>
						<?php
					}else{
						?>
							<option></option>
							<option value="YES">YES</option>
							<option value="NO">NO</option>
						<?php
					}
					?>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '49') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option><?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?></option>
						<option></option>
						<option value="LUBUMBASHI">LUBUMBASHI</option>
						<option value="KOLWEZI">KOLWEZI</option>
						<option value="KINSEVERE">KINSEVERE</option>
					</select>
				</td>
				<?php
				}else if ($reponse['id_col'] == '17') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '18') {
					//Date Expiration Licence
					if ( ($this-> getDifferenceDate($this-> getDateExpirationLicence2($this-> getDossier($id_dos)['num_lic']), date('Y-m-d')) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteLic = ' clignoteb';
						$couleurLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteLic = '';
						$couleurLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurLic;?>">
					<?php echo $this-> getDateExpirationLicence($this-> getDossier($id_dos)['num_lic'])?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '50') {
					// Poids Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'];?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '54') {
					// Balance Tons Licence
					if ( ((($this-> getBalanceLicenceDossier($id_dos)*100)/($this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'])) <= 30) && ($this-> getDossier($id_dos)['cleared'] == '0') ) {
						$clignoteBalanceLic = ' clignoteb';
						$couleurBalanceLic = ' color: rgb(255,69,0);';
					}else{
						$clignoteBalanceLic = '';
						$couleurBalanceLic = '';
					}
				?>
				<td class=" <?php echo $bg.$clignoteBalanceLic;?>" style="border: 1px solid black; text-align: center; <?php echo $couleurBalanceLic;?>">
					<?php echo number_format( $this-> getBalanceLicenceDossier($id_dos), 2, ',', ' ');?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '71') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('ceec_out', $id_dos), $this-> getDataRow('ceec_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '74') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('min_div_out', $id_dos), $this-> getDataRow('min_div_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '36') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('dgda_out', $id_dos), $this-> getDataRow('dgda_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '88') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '80') {
					// DA To Exit
					if ($this-> getDossier($id_dos)['id_mod_trans'] == '4') {
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('docs_sncc', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}else{
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}
				
				}
				else if ($reponse['calcul'] == '1') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php
						if (isset($this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']])) {
							echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];
						}
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php

				}else if ($reponse['id_col'] == '44') {
					if (!isset($this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'])) {
						
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?> type="<?php echo $reponse['type_col'];?>" style="width: 25em;" name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow('supplier', $id_dos);?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						</td>
						<?php

					}else{

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<input <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?> type="text" style="width: 25em;" name="supplier_<?php echo $compteur;?>" value="<?php echo $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'];?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						</td>
						<?php

					}
				}else if ($reponse['id_col'] == '42' && $id_mod_lic=='2') {
					// Status
					$bgStatuts = '';
					if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
						$bgStatuts = 'bg bg-primary';
					}
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">

					<?php
					echo $statut;
					/*
					?>
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php 
					*/
					//echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '42' && $id_mod_lic=='1') {
					// Status
					$bgStatuts = '';
					if ( ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'CLEARING COMPLETED') || ($this-> getDataRow($reponse['champ_col'], $id_dos) == 'EXIT DRC') ) {
						$bgStatuts = 'bg bg-primary';
					}
				?>
				<td class=" <?php echo $bg.$bgStatuts;?>" style="border: 1px solid black; text-align: center;">

					<?php
					//echo $statut;
					
					?>
					<select name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
						<option value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
							<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
						</option>
						<option></option>
						<?php
							$this-> selectionnerStatusModeleLicence($id_mod_lic);
						?>
					</select>
					<?php 
					
					//echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}
				//Doublon facture
				else if ($reponse['id_col'] == '11' && ($this-> verifierDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos)) > 1) ) {

					$textColor = 'color: black; background-color: #FF4500;';
					

					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					</td>
					<?php

				}//Date Dimanche
				else if ($this-> verifierDimancheDate($this-> getDataRow($reponse['champ_col'], $id_dos))!=false ) {

					$textColor = 'color: black; background-color: #FF4500;';
					

					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;" title="<?php echo $this-> getDossiersDoublonFacture($this-> getDataRow($reponse['champ_col'], $id_dos));?>">
						<input type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>" <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>>
					</td>
					<?php

				}
				else{
					if ( $this-> getDataRow($reponse['champ_col'], $id_dos)!=null) {
						$textColor = '';
					}else{
						$textColor = 'color: rgb(255,215,0); background-color: grey;';
					}

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<input  <?php echo $this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'];?>  type="<?php echo $reponse['type_col'];?>" <?php echo $reponse['attribut_col'];?> style="text-transform:uppercase; <?php echo $textColor;?>" name="<?php echo $reponse['champ_col'];?>_<?php echo $compteur;?>" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherRowUpdate($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, 
													c.type_col AS type_col, 
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col 
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] != '17' && $reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80') {
					?>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['titre_col'];?></label>
			            <input type="<?php echo $reponse['type_col'];?>" name="<?php echo $reponse['champ_col'];?>" class="form-control cc-exp">
			          </div>
			        <?php
				}
				

			}$requete-> closeCursor();
		}

		public function afficherRowDossierUpdate($id_mod_lic, $id_cli, $id_mod_trans, $id_dos){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, 
													c.type_col AS type_col, 
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col, 
													c.attribut_col AS attribut_col 
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if (($reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80' && $reponse['id_col'] != '38' && $reponse['id_col'] != '42' && $reponse['id_col'] != '40') && ($this-> getDossierFacture2($id_dos)!=false && ($reponse['champ_col']=='poids' || $reponse['champ_col']=='horse' || $reponse['champ_col']=='trailer_1' || $reponse['champ_col']=='trailer_2'))) {
					?>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['titre_col'];?></label>
			            <input type="<?php echo $reponse['type_col'];?>" name="<?php echo $reponse['champ_col'];?>" <?php echo $reponse['attribut_col'];?> class="form-control cc-exp" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>" disabled>
			          </div>
			        <?php
				}else if ($reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80' && $reponse['id_col'] != '38' && $reponse['id_col'] != '42' && $reponse['id_col'] != '40') {
					?>

			          <div class="col-md-3">
			            <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['titre_col'];?></label>
			            <input type="<?php echo $reponse['type_col'];?>" name="<?php echo $reponse['champ_col'];?>" <?php echo $reponse['attribut_col'];?> class="form-control cc-exp" value="<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>">
			          </div>
			        <?php
				}
				

			}$requete-> closeCursor();
		}

		public function getRowUpdate($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$a = '';
			$champ_col = array();

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, 
													c.type_col AS type_col, 
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col 
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] != '17' && $reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80') {
					//$a = $reponse['champ_col'];
					$champ_col1 = $reponse['champ_col'];
					$post = "$_POST[$champ_col1]";
					$champ_col[] = $post;


					/*$champ_col = $reponse['champ_col'];
					$post .= ",$_POST[$champ_col]";

					$champ_col[] = $reponse['champ_col'];*/

				}
				

			}$requete-> closeCursor();
			return $champ_col;
		}

		public function getRowUpdate2($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$a = '';
			$champ_col = array();

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, 
													c.type_col AS type_col, 
													c.calcul AS calcul,
													c.id_col AS id_col,
													c.titre_col AS titre_col 
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80' && $reponse['id_col'] != '38' && $reponse['id_col'] != '40' && $reponse['id_col'] != '42') {
					//$a = $reponse['champ_col'];
					$champ_col1 = $reponse['champ_col'];
					//$index = '_'.$i
					$post = "$_POST[$champ_col1]";
					$champ_col[] = $post;


					/*$champ_col = $reponse['champ_col'];
					$post .= ",$_POST[$champ_col]";

					$champ_col[] = $reponse['champ_col'];*/

				}
				

			}$requete-> closeCursor();
			return $champ_col;
		}

		public function getNameRowUpdate($id_mod_lic, $id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			$post = '';
			$name_champ_col = array();

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, c.id_col AS id_col
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] != '18' && $reponse['id_col'] != '50' && $reponse['id_col'] != '54' && $reponse['id_col'] != '71' && $reponse['id_col'] != '74' && $reponse['id_col'] != '36' && $reponse['id_col'] != '88' && $reponse['id_col'] != '80' && $reponse['id_col'] != '38' && $reponse['id_col'] != '40' && $reponse['id_col'] != '42') {

					$name_champ_col[] = $reponse['champ_col'];
					

				}
				

			}$requete-> closeCursor();
			return $name_champ_col;
		}

		public function afficherRowTableauExcel($id_mod_lic, $id_cli, $id_mod_trans, $id_dos, $compteur, $statut=NULL, $klsa_status=NULL, $amicongo_status=NULL, $kzi_status=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$bg = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT c.champ_col AS champ_col, 
													c.type_col AS type_col, 
													c.calcul AS calcul,
													c.id_col AS id_col 
											FROM colonne c, client cl, affectation_colonne_client_modele_licence af
											WHERE c.id_col = af.id_col
												AND af.id_cli = cl.id_cli
											    AND cl.id_cli = ?
											    AND af.id_mod_trans = ?
											    AND af.id_mod_lic = ?
											ORDER BY af.rang ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				//getDataRow($champ_col, $id_dos)
				if ($reponse['id_col'] == '40' && $id_mod_lic == '2') {
					$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					if ( ($getDataRowCalculNetDays >= 0) && ($getDataRowCalculNetDays <= 3) ) {
						$bg = "background-color: green; color: white;";
					}else if ( ($getDataRowCalculNetDays > 3) && ($getDataRowCalculNetDays <= 5) ) {
						$bg = "background-color: orange; color: white;";
					}else if ( ($getDataRowCalculNetDays > 5) ) {
						$bg = "background-color: red; color: white;";
					}
				?>
				<td style="border: 0.5px solid black; text-align: center; <?php echo $bg;?>">
					<?php
						echo $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php
					$bg = '';
				}
				else if ($reponse['id_col'] == '40' && $id_mod_lic == '1') {

					if ($id_mod_trans == '4') {
						# code...
					}else{

						

							//$getDataRowCalculNetDays = $this-> getDataRowCalculNetDays($reponse['champ_col'], $id_dos);
							if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) >= 0) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 2) ) {
								$bg = "background-color: green; color: white;";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 2) && ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) <= 5) ) {
								$bg = "background-color: orange; color: white;";
							}else if ( ($this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos)) > 5) ) {
							$bg = "background-color: red; color: white;";
							}
						?>
						<td style="border: 1px solid black; text-align: center; <?php echo $bg;?>">
							<span class="">
							<?php
								echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos)) - $this-> getWeekendsAndHolidays($this-> getDataRow('demande_attestation', $id_dos), $this-> getDataRow('dispatch_date', $id_dos));
							?>
							</span>
						</td>
						<?php
						
							$bg = '';




					}

				}
				else if ($reponse['id_col'] == '38') {
					
				?>
				<td style="border: 0.5px solid black; text-align: center;">
					<?php
					$getDataRow = $this-> getDataRow($reponse['champ_col'], $id_dos);
					if ( ($getDataRow == '0') ) {
						?>
						TRANSIT
						<?php
					}else if ( ($getDataRow == '1') ) {
						?>
						CLEARED
						<?php
					}else if ( ($getDataRow == '2') ) {
						?>
						CANCELLED
						<?php
					}
					?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '17') {
					
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '18') {
					//Date Expiration Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDateExpirationLicence($this-> getDossier($id_dos)['num_lic']);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '50') {
					// Poids Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids'];?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '54') {
					// Balance Tons Licence
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getBalanceLicenceDossier($id_dos);?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '71') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('ceec_out', $id_dos), $this-> getDataRow('ceec_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '74') {
					// CEEC Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('min_div_out', $id_dos), $this-> getDataRow('min_div_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '36') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('dgda_out', $id_dos), $this-> getDataRow('dgda_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '88') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '80') {
					// DA To Exit
					if ($this-> getDossier($id_dos)['id_mod_trans'] == '4') {
						?>
						<td class=" " style="border: 1px solid black; text-align: center; <?php echo $bg;?>">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('docs_sncc', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}else{
						?>
						<td class="" style="border: 1px solid black; text-align: center; <?php echo $bg;?>">
							<?php echo $this-> getDifferenceDate($this-> getDataRow('dispatch_date', $id_dos), $this-> getDataRow('demande_attestation', $id_dos));?>
						</td>
						<?php
					}
				
				}
				else if ($reponse['calcul'] == '1') {
					
				?>
				<td class="" style="border: 1px solid black; text-align: center; <?php echo $bg;?>">
					<?php
						if (isset($this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']])) {
							echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];
						}
					?>
					<?php //echo $this-> getDataRowCalcul($reponse['champ_col'], $id_dos)[$reponse['champ_col']];?>
				</td>
				<?php

				}else if ($reponse['id_col'] == '44') {
					if (!isset($this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'])) {
						
						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<?php echo $this-> getDataRow('supplier', $id_dos);?>
						</td>
						<?php

					}else{

						?>
						<td class=" <?php echo $bg;?>" style="border: 1px solid black; ">
							<?php echo $this-> getLicence($this-> getDossier($id_dos)['num_lic'])['fournisseur'];?>
						</td>
						<?php

					}
				}else if ($reponse['id_col'] == '42') {
					// DGDA Delai
				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
					<?php //echo $this-> getDifferenceDate($this-> getDataRow('gov_out', $id_dos), $this-> getDataRow('gov_in', $id_dos));?>
				</td>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $klsa_status;?>
				</td>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $amicongo_status;?>
				</td>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $kzi_status;?>
				</td>
				<?php
				}else if ($reponse['id_col'] == '44'){

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php

				}else{

				?>
				<td class=" <?php echo $bg;?>" style="border: 1px solid black; text-align: center;">
					<?php echo $this-> getDataRow($reponse['champ_col'], $id_dos);?>
				</td>
				<?php

				}

			}$requete-> closeCursor();
		}

		public function afficherApurement($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_ap) AS id_trans_ap, UPPER(cl.nom_cli) AS nom_cli,
													tr.ref_trans_ap AS ref_trans_ap,
													tr.id_trans_ap AS id_trans_ap,
													DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													UPPER(tr.banque) AS banque,
													tr.fichier_trans_ap AS fichier_trans_ap
												FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
												WHERE cl.id_cli = d.id_cli
													$sqlClient
													AND d.id_mod_lic = ?
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = tr.id_trans_ap
												ORDER BY tr.id_trans_ap DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditTransmissionApurement.php');

				if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['banque'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreLicenceTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreDossierTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les dÃ©tails" href="#" style="color: black;" onclick="window.open('popUpDossiersApures.php?id_trans_ap=<?php echo $reponse['id_trans_ap'];?>&id_cli=<?php echo $entree['id_cli'];?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">DÃ©tails</button>
					</a>
					<?php 
						if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust" data-toggle="modal" data-target=".editTransmission_<?php echo $reponse['id_trans_ap'];?>">
		                    <i class="fa fa-upload"></i> Loger AccusÃ©e de rÃ©ception
		                </button>
						<?php
						}else{
						?>
						<button class="btn bg bg-info square-btn-adjust" onclick="window.open('../transmision_apurements/<?php echo $reponse['id_trans_ap'];?>/<?php echo $reponse['fichier_trans_ap'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-file"></i> AccusÃ©e de rÃ©ception
		                </button>
						<?php
						}
					?>
                    <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportTransmissionApurement.php?id_cli=<?php echo $id_cli; ?>&id_trans_ap=<?php echo $reponse['id_trans_ap']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i> Export
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherApurementAjax($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$row = array();

			$requete = $connexion-> prepare("SELECT tr.id_trans_ap AS id_trans_ap, 
													cl.nom_cli AS nom_cli,
													tr.ref_trans_ap AS ref_trans_ap,
													tr.id_trans_ap AS id_trans_ap,
													DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													DATE_FORMAT(tr.date_depot, '%d/%m/%Y') AS date_depot,
													tr.banque AS banque,
													tr.fichier_trans_ap AS fichier_trans_ap,
													IF(tr.fichier_trans_ap IS NULL,
														'0',
														'1'
													) AS statut_fichier,
													COUNT(d.id_dos) AS nbre_dos,
													COUNT(DISTINCT(d.num_lic)) AS nbre_lic,
													CONCAT(
														IF(tr.fichier_trans_ap IS NOT NULL,
															CONCAT('<button class=\"btn btn-xs btn-dark\" title=\"Edit Transmit\" onclick=\"window.open(\'../transmision_apurements/',tr.id_trans_ap,'/',tr.fichier_trans_ap,'\',\'pop1\',\'width=1900,height=900\')\">
																<i class=\"fa fa-file\"></i> AccusÃ©e de rÃ©ception
															</button>'),
															''
														),

														' <button class=\"btn btn-xs btn-success\" title=\"Edit Transmit\" onclick=\"window.location.replace(\'exportTransmissionApurement.php?id_cli=',cl.id_cli,'&id_trans_ap=',tr.id_trans_ap,'\',\'pop1\',\'width=80,height=80\');\">
																<i class=\"fa fa-file-excel\"></i>
															</button>
															<button class=\"btn btn-xs bg-purple\" title=\"Upload accusÃ©e de rÃ©ception\" onclick=\"modal_upload_ar_transmit(\'',tr.id_trans_ap,'\');\">
																<i class=\"fa fa-upload\"></i>
															</button>
															<button class=\"btn btn-xs btn-warning\" title=\"Edit Transmit\" onclick=\"modal_edit_transmit(\'',tr.id_trans_ap,'\');\">
																<i class=\"fa fa-edit\"></i>
															</button>'
													) AS btn_action
												FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
												WHERE cl.id_cli = d.id_cli
													$sqlClient
													AND d.id_mod_lic = ?
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = tr.id_trans_ap
												GROUP BY tr.id_trans_ap
												ORDER BY tr.id_trans_ap DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {

				$compteur++;
				// include('modalEditTransmissionApurement.php');
				$reponse['compteur'] = $compteur;
				$row[] = $reponse;

			}$requete-> closeCursor();

			return $row;
		}

		public function afficherIrSansAv($id_cli, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$compteur=$premiere_entree;

			$requete = $connexion-> prepare("SELECT DISTINCT(ref_crf) AS ref_crf,
													DATE_FORMAT(date_crf, '%d/%m/%Y') AS date_crf,
													REPLACE(REPLACE(ref_crf, ' ', '_'), '-', '_') AS ref_crf_2
												FROM dossier
												WHERE id_cli = ?
													AND cod NOT IN(
															SELECT cod FROM av
														)
													AND ref_crf IS NOT NULL
													AND ref_crf <> ''
													AND ref_crf <> 'N/A'
													AND ref_crf <> 'TBC'
													AND ref_crf <> '-'
													AND ref_crf NOT LIKE '%UNDER%'
												GROUP BY ref_crf
												ORDER BY ref_crf");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditAvIr.php');

			?>
			<tr style="">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_crf'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_crf'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreDossierIr($id_cli, $reponse['ref_crf']);?>
				</td>
				<td style="text-align: center;">
					<button class="btn btn-sm btn-info" onclick="window.open('popUpDossiersIr.php?ref_crf=<?php echo $reponse['ref_crf'];?>&id_cli=<?php echo $id_cli;?>','pop1','width=1000,height=800');"><i class="fa fa-eye"></i></button>
				</td>
				<td style="text-align: center;">
					<button class="btn btn-sm btn-success" data-toggle="modal" data-target=".editAvIr_<?php echo $reponse['ref_crf_2'];?>"><i class="fa fa-plus"></i></button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherComplementDataDossier($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
												WHERE (
														ref_av IS NULL OR ref_av = ''
														OR montant_av IS NULL OR montant_av = ''
														OR road_manif IS NULL OR road_manif = ''
														OR ref_decl IS NULL OR ref_decl = ''
														OR montant_decl IS NULL OR montant_decl = ''
														OR ref_quit IS NULL OR ref_quit = ''
														OR ref_fact IS NULL OR ref_fact = ''
													)
													AND (
															(fob = '' OR fob IS NULL OR fob = '0') 
															OR (fob IS NOT NULL AND fob >= '2500')
														)
													AND (cleared = '1' OR cleared = '0')
													AND id_cli <> 869
													AND id_mod_lic = ?
													$sqlClient
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				/*include('modalEditTransmissionApurement.php');

				if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="col_1" style="background-color: white; color: black; border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="col_6" style="background-color: white; color: black; border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td>
					<?php
					if (isset($reponse['fob']) && ($reponse['fob']!='') && ($reponse['fob']>0)) {
							$disabled = 'disabled';
						?>
						<input type="text" name="fob_<?php echo $compteur;?>" value="<?php echo $reponse['fob'];?>" <?php echo $disabled;?> >
						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
						<input type="number" step="0.001" name="fob_<?php echo $compteur;?>" value="<?php echo $reponse['fob'];?>" <?php echo $disabled;?> >
						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['ref_fact']) && ($reponse['ref_fact']!='')) {
						$disabled = 'disabled';
						?>
					<input type="text" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $reponse['ref_fact'];?>" <?php echo $disabled;?> >

						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
					<input type="text" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $reponse['ref_fact'];?>" <?php echo $disabled;?> >

						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['ref_av']) && ($reponse['ref_av']!='')) {
						$disabled = 'disabled';
						?>
					<input type="text" name="ref_av_<?php echo $compteur;?>" value="<?php echo $reponse['ref_av'];?>" <?php echo $disabled;?> >

						<?php

					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
					<input type="text" name="ref_av_<?php echo $compteur;?>" value="<?php echo $reponse['ref_av'];?>" <?php echo $disabled;?> >

						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['montant_av']) && ($reponse['montant_av']!='')) {
						$disabled = 'disabled';
						?>
					<input type="text" step="0.001" name="montant_av_<?php echo $compteur;?>" value="<?php echo $reponse['montant_av'];?>" <?php echo $disabled;?> >

						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
					<input type="number" name="montant_av_<?php echo $compteur;?>" value="<?php echo $reponse['montant_av'];?>" <?php echo $disabled;?> >

						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['road_manif']) && ($reponse['road_manif']!='')) {
						$disabled = 'disabled';
						?>
					<input type="text" name="road_manif_<?php echo $compteur;?>" value="<?php echo $reponse['road_manif'];?>" <?php echo $disabled;?> >

						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
					<input type="text" name="road_manif_<?php echo $compteur;?>" value="<?php echo $reponse['road_manif'];?>" <?php echo $disabled;?> >

						<?php
					}
					?>
				</td>
				<td>
					<?php
					if (isset($reponse['ref_decl']) && ($reponse['ref_decl']!='')) {
						$disabled = 'disabled';
						?>
						<input type="text" name="ref_decl_<?php echo $compteur;?>" value="<?php echo $reponse['ref_decl'];?>" <?php echo $disabled;?> >
						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
							<input type="text" name="ref_decl_<?php echo $compteur;?>" value="<?php echo $reponse['ref_decl'];?>" <?php echo $disabled;?> >
						<?php
					}
					?>
					
				</td>
				<td>
					<?php
					if (isset($reponse['montant_decl']) && ($reponse['montant_decl']!='')) {
						$disabled = 'disabled';
						?>
						<input type="text" step="0.001" name="montant_decl_<?php echo $compteur;?>" value="<?php echo $reponse['montant_decl'];?>" <?php echo $disabled;?> >
						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
						<input type="number" name="montant_decl_<?php echo $compteur;?>" value="<?php echo $reponse['montant_decl'];?>" <?php echo $disabled;?> >
						<?php
					}
					?>
					
				</td>
				<td>
					<?php
					if (isset($reponse['ref_quit']) && ($reponse['ref_quit']!='')) {
						$disabled = 'disabled';
						?>
						<input type="text" name="ref_quit_<?php echo $compteur;?>" value="<?php echo $reponse['ref_quit'];?>" <?php echo $disabled;?> >
						<?php
					}else{
						$disabled = 'style="background-color: black; color: yellow;"';
						?>
						<input type="text" name="ref_quit_<?php echo $compteur;?>" value="<?php echo $reponse['ref_quit'];?>" <?php echo $disabled;?> >
						<?php
					}
					?>
					
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			$fin = $compteur;
			?>
			<input type="hidden" name="debut" value="<?php echo $debut;?>">
			<input type="hidden" name="fin" value="<?php echo $fin;?>">
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherDossierAttenteFacture($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, 
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq, 
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
 												FROM dossier
												WHERE facture = '0'
													AND cleared = '1'
													AND id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: center;">
					<button class="btn bg-info square-btn-adjust" data-toggle="modal" data-target=".facture_<?php echo $reponse['id_dos'];?>">
	                    <i class="fa fa-calculator"></i> Facturer
	                </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDossierFacture($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, 
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq, 
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
 												FROM dossier
												WHERE facture = '1'
													AND cleared = '1'
													AND id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDossierAttenteFactureRecherche($id_cli, $id_mod_lic, $ref_dos){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, 
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq, 
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
 												FROM dossier
												WHERE facture = '0'
													AND cleared = '1'
													AND id_mod_lic = ?
													AND ref_dos = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic'], $entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: center;">
					<button class="btn bg-info square-btn-adjust" data-toggle="modal" data-target=".facture_<?php echo $reponse['id_dos'];?>">
	                    <i class="fa fa-calculator"></i> Facturer
	                </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td>
					<hr>
				</td>
			</tr>
			<?php

		}

		public function afficherDossierFactureRecherche($id_cli, $id_mod_lic, $ref_dos){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$debut = $compteur;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl, 
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq, 
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit
 												FROM dossier
												WHERE facture = '1'
													AND cleared = '1'
													AND id_mod_lic = ?
													AND ref_dos = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic'], $entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalFacturationDossier.php');

				/*if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}*/

			?>
			<tr style="<?php echo $bg;?>">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $compteur;?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td class="" style="text-align: center; color: yellow;" class="bg bg-dark">
					<?php echo $reponse['date_quit'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td>
					<hr>
				</td>
			</tr>
			<?php

		}

		public function afficherApurementLicenceDossier($id_cli, $id_mod_lic, $motCle){
			include("connexion.php");

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			// $entree['motCle'] = '%'.$motCle.'%';
			// $entree['motCle'] = "'%$motCle%'";
			$entree['motCle'] = $motCle;

			// echo '--------------------------------'.$entree['motCle'];

			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_ap) AS id_trans_ap, UPPER(cl.nom_cli) AS nom_cli,
													tr.ref_trans_ap AS ref_trans_ap,
													tr.id_trans_ap AS id_trans_ap,
													DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													UPPER(tr.banque) AS banque,
													tr.fichier_trans_ap AS fichier_trans_ap
												FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
												WHERE cl.id_cli = d.id_cli
													$sqlClient
													AND d.id_mod_lic = ?
													AND (d.ref_dos LIKE ? OR d.num_lic LIKE ?)
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = tr.id_trans_ap
												ORDER BY tr.id_trans_ap DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['motCle'], $entree['motCle']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditTransmissionApurement.php');

				if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
				}else{
					$bg = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['banque'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreLicenceTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreDossierTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les dÃ©tails" href="#" style="color: black;" onclick="window.open('popUpDossiersApures.php?id_trans_ap=<?php echo $reponse['id_trans_ap'];?>&id_cli=<?php echo $entree['id_cli'];?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">DÃ©tails</button>
					</a>
					<?php 
						if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
						?>
						<button class="btn btn-dark square-btn-adjust" data-toggle="modal" data-target=".editTransmission_<?php echo $reponse['id_trans_ap'];?>">
		                    <i class="fa fa-upload"></i> Loger AccusÃ©e de rÃ©ception
		                </button>
						<?php
						}else{
						?>
						<button class="btn bg bg-info square-btn-adjust" onclick="window.open('../transmision_apurements/<?php echo $reponse['id_trans_ap'];?>/<?php echo $reponse['fichier_trans_ap'];?>','pop1','width=1900,height=900');">
		                    <i class="fas fa-file"></i> AccusÃ©e de rÃ©ception
		                </button>
						<?php
						}
					?>
                    <button class="btn btn-success square-btn-adjust" onclick="window.location.replace('exportTransmissionApurement.php?id_cli=<?php echo $id_cli; ?>&id_trans_ap=<?php echo $reponse['id_trans_ap']; ?>','pop1','width=80,height=80');">
                      <i class="fas fa-file-excel"></i> Export
                    </button>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td style="background-color: black;">
					<hr>
				</td>
				<td style="background-color: black;">
					<hr>
				</td>
				<td style="background-color: black;">
					<hr>
				</td>
			</tr>
			<?php
		}

		public function afficherApurementSansFichier($id_cli, $id_mod_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=$premiere_entree;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$bg = "";

			$requete = $connexion-> prepare("SELECT DISTINCT(tr.id_trans_ap) AS id_trans_ap, UPPER(cl.nom_cli) AS nom_cli,
													tr.ref_trans_ap AS ref_trans_ap,
													tr.id_trans_ap AS id_trans_ap,
													DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													UPPER(tr.banque) AS banque,
													tr.fichier_trans_ap AS fichier_trans_ap
												FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
												WHERE cl.id_cli = d.id_cli
													$sqlClient
													AND d.id_mod_lic = ?
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = tr.id_trans_ap
													AND (tr.fichier_trans_ap = ''
														OR tr.fichier_trans_ap IS NULL)
												ORDER BY tr.id_trans_ap DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				if (!($reponse['fichier_trans_ap']) || ($reponse['fichier_trans_ap']=='')) {
					$bg = 'background-color: #FA8072;';
					$button = '';
				}

			?>
			<tr style="<?php echo $bg;?>">
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['nom_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['banque'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreLicenceTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getNombreDossierTransmissionApurement($reponse['id_trans_ap']);?>
				</td>
				<td style="text-align: center;">
					<a title="Visualiser les dÃ©tails" href="#" style="color: black;" onclick="window.open('popUpDossiersApures.php?id_trans_ap=<?php echo $reponse['id_trans_ap'];?>&id_cli=<?php echo $entree['id_cli'];?>','pop1','width=1900,height=900');">
						<button class="btn bg bg-warning">DÃ©tails</button>
					</a>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersApuresTransmission($id_trans_ap){
			include("connexion.php");
			$entree['id_trans_ap'] = $id_trans_ap;
			$compteur=0;

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic, 
													d.ref_fact,
													d.fob AS fob, d.ref_av AS ref_av, d.montant_av AS montant_av,
													d.ref_fact AS ref_fact, d.ref_decl AS ref_decl,
													d.road_manif AS road_manif
												FROM dossier d, detail_apurement dt
												WHERE d.id_dos = dt.id_dos
													AND dt.id_trans_ap = ?
												ORDER BY d.num_lic");
			$requete-> execute(array($entree['id_trans_ap']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getDateExpirationLicence($reponse['num_lic']);
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['date_val'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $date_exp;?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['montant_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['road_manif'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersSansFOB($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT ref_dos, fob
												FROM dossier
												WHERE id_mod_lic = ?
													AND (fob = '' OR fob IS NULL OR fob <= 0)
												$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersIr($ref_crf, $id_cli){
			include("connexion.php");
			$entree['ref_crf'] = $ref_crf;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT ref_dos, fob
												FROM dossier
												WHERE ref_crf = ?
												$sqlClient");
			$requete-> execute(array($entree['ref_crf']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherPartielleCOD($cod){
			include("connexion.php");
			$entree['cod'] = $cod;
			$compteur=0;

			$requete = $connexion-> prepare("SELECT p.num_part AS num_part,
													p.fob AS fob_part,
													p.cod AS cod,
													REPLACE(CONCAT(p.cod, p.num_part), ' ', '') AS cod_dos,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(dos.fob) AS fob_dos,
													(p.fob-IF(SUM(dos.fob)>0, SUM(dos.fob), 0)) AS solde_fob,
													IF((p.fob-IF(SUM(dos.fob)>0, SUM(dos.fob), 0)) < 0, 'text-danger', '') AS color_fob,
													p.poids AS poids_part,
													SUM(dos.poids) AS poids_dos,
													(p.poids-IF(SUM(dos.poids)>0, SUM(dos.poids), 0)) AS solde_poids,
													IF((p.poids-IF(SUM(dos.poids)>0, SUM(dos.poids), 0)) < 0, 'text-danger', '') AS color_poids,
													p.id_part AS id_part
												FROM partielle_av p
													LEFT JOIN dossier dos
														ON REPLACE(CONCAT(p.cod,p.num_part), ' ', '') = REPLACE(dos.cod, ' ', '')
												WHERE p.cod = ?
												GROUP BY REPLACE(CONCAT(p.cod,p.num_part), ' ', '') ASC");
			$requete-> execute(array($entree['cod']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditPartielle.php');
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['cod'];?>
					<a class=" btn-xs btn-warning text-dark" title="Modifier la partielle" data-toggle="modal" data-target=".editPartielle_<?php echo $reponse['id_part'];?>">
						<i class="fa fa-edit"></i>
					</a>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_part'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids_part'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fob_part'], 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<?php echo number_format($reponse['nbre_dos'], 0, ',', '');?>
				</td>
				<td style="text-align: center;">
					<a class=" btn-xs bg-purple" title="Partielle" href="#" style="color: black;" onclick="window.open('popUpDossierPartielle.php?cod_dos=<?php echo $reponse['cod_dos'];?>','pop2','width=1000,height=700');">
						<i class="fa fa-eye"></i>
					</a>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids_dos'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fob_dos'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;" class="<?php echo $reponse['color_poids'];?>">
					<?php echo number_format($reponse['solde_poids'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;" class="<?php echo $reponse['color_fob'];?>">
					<?php echo number_format($reponse['solde_fob'], 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherPartielleEtat($id_cli, $etat, $consommable){
			include("connexion.php");

			$compteur=0;

			$entree['id_cli'] = $id_cli;
			$entree['consommable'] = $consommable;
			$sqlClient = '';
			$sqlEtat = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = '.$id_cli;
			}

			if ($etat == 'Partial Without FOB') {

				$sqlEtat = " WHERE  (p.fob IS NULL OR p.fob = 0)";

			}else if ($etat == 'Partial Without Weight') {

				$sqlEtat = " WHERE  (p.poids IS NULL OR p.poids = 0)";

			}else if ($etat == 'Partial Having Negative FOB Balance') {

				$sqlEtat = " WHERE p.fob < (
									SELECT SUM(fob)
										FROM dossier 
										WHERE REPLACE(ref_crf, ' ', '') = REPLACE(CONCAT(p.cod,p.num_part), ' ', '')
								)
							";

			}else if ($etat == 'Partial Having Negative Weight Balance') {

				$sqlEtat = " WHERE p.poids < (
									SELECT SUM(poids)
										FROM dossier 
										WHERE REPLACE(ref_crf, ' ', '') = REPLACE(CONCAT(p.cod,p.num_part), ' ', '')
								)
							";

			}

			$requete = $connexion-> prepare("SELECT p.num_part AS num_part,
													p.fob AS fob_part,
													p.cod AS cod,
													REPLACE(CONCAT(p.cod, p.num_part), ' ', '') AS cod_dos,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(dos.fob) AS fob_dos,
													(p.fob-IF(SUM(dos.fob)>0, SUM(dos.fob), 0)) AS solde_fob,
													IF((p.fob-IF(SUM(dos.fob)>0, SUM(dos.fob), 0)) < 0, 'text-danger', '') AS color_fob,
													p.poids AS poids_part,
													SUM(dos.poids) AS poids_dos,
													(p.poids-IF(SUM(dos.poids)>0, SUM(dos.poids), 0)) AS solde_poids,
													IF((p.poids-IF(SUM(dos.poids)>0, SUM(dos.poids), 0)) < 0, 'text-danger', '') AS color_poids,
													p.id_part AS id_part,
													l.num_lic AS num_lic,
													IF(l.consommable='1', 'Consommable', 'Divers') AS label_consommable,
													cl.code_cli AS code_cli
												FROM partielle_av p
													LEFT JOIN dossier dos
														ON REPLACE(CONCAT(p.cod,p.num_part), ' ', '') = REPLACE(dos.ref_crf, ' ', '')
													LEFT JOIN licence l
														ON l.cod = p.cod
													LEFT JOIN client cl
														ON l.id_cli = cl.id_cli
												$sqlEtat
												AND p.cod IN (
													SELECT cod 
														FROM licence
														WHERE consommable = ?
															$sqlClient
												)
												GROUP BY REPLACE(CONCAT(p.cod,p.num_part), ' ', '') ASC");
			$requete-> execute(array($entree['consommable']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditPartielle.php');
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['cod'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_part'];?>
				</td>
				<td style="text-align: center;">
					<a class=" btn-xs btn-warning text-dark" title="Modifier la partielle" data-toggle="modal" data-target=".editPartielle_<?php echo $reponse['id_part'];?>">
						<i class="fa fa-edit"></i>
					</a>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['code_cli'];?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['label_consommable'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids_part'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fob_part'], 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<?php echo number_format($reponse['nbre_dos'], 0, ',', '');?>
				</td>
				<td style="text-align: center;">
					<a class=" btn-xs bg-purple" title="Partielle" href="#" style="color: black;" onclick="window.open('popUpDossierPartielle.php?cod_dos=<?php echo $reponse['cod_dos'];?>','pop2','width=1000,height=700');">
						<i class="fa fa-eye"></i>
					</a>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids_dos'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fob_dos'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;" class="<?php echo $reponse['color_poids'];?>">
					<?php echo number_format($reponse['solde_poids'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;" class="<?php echo $reponse['color_fob'];?>">
					<?php echo number_format($reponse['solde_fob'], 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherCRFSansPartielle($id_cli, $consommable){
			include("connexion.php");

			$compteur=0;

			$entree['id_cli'] = $id_cli;
			$entree['consommable'] = $consommable;
			$sqlClient = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND dos.id_cli = '.$id_cli;
			}

			$requete = $connexion-> prepare("SELECT dos.ref_crf AS ref_crf,
													COUNT(dos.id_dos) AS nbre_dos,
													l.num_lic AS num_lic,
													l.cod AS cod,
													IF(l.consommable='1', 'Consommable', 'Divers') AS label_consommable,
													cl.nom_cli AS nom_cli,
													cl.code_cli AS code_cli,
													IF( LENGTH(REPLACE(l.cod, ' ', '')) < 5, 
														CONCAT('<a class=\" btn-xs btn-info\" title=\"Ajouter la partielle\" onclick=\"alert(\'Erreur: Veuillez renseigner correctement le COD de la licence ',l.num_lic,' !\')\">
															<i class=\"fa fa-plus\"></i>
														</a>'),
														CONCAT('<a class=\" btn-xs btn-info\" title=\"Ajouter la partielle\" data-toggle=\"modal\" data-target=\".creerPartielle_',REPLACE(dos.ref_crf, ' ', ''),'\">
															<i class=\"fa fa-plus\"></i>
														</a>')
													) AS bouton_ajout,
													REPLACE(dos.ref_crf, ' ', '') AS ref_crf_dos
												FROM dossier dos, licence l, client cl
												WHERE REPLACE(dos.ref_crf, ' ', '') NOT IN (
														SELECT REPLACE(CONCAT(cod,num_part), ' ', '')
															FROM partielle_av
													)
													AND REPLACE(dos.ref_crf, ' ', '') <> ''
													AND REPLACE(dos.ref_crf, ' ', '') <> 'N/A'
													AND dos.id_cli = cl.id_cli
													$sqlClient
													AND dos.num_lic = l.num_lic
													AND l.consommable = ?
													AND DATE(l.date_val) >= '2022-08-01'
												GROUP BY dos.ref_crf
											");
			$requete-> execute(array($entree['consommable']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalAjoutPartielle.php');
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['ref_crf'];?>

					<?php echo $reponse['bouton_ajout'];?>

					<!-- <a class=" btn-xs btn-info text-dark" title="Modifier la partielle" data-toggle="modal" data-target=".editPartielle_<?php echo $reponse['id_part'];?>">
						<i class="fa fa-plus"></i>
					</a> -->
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['code_cli'];?>
				</td>
				<td style="text-align: center;">
					<?php echo number_format($reponse['nbre_dos'], 0, ',', '');?>
				</td>
				<td style="text-align: center;">
					<a class=" btn-xs bg-purple" title="Partielle" href="#" style="color: black;" onclick="window.open('popUpDossierCRF.php?ref_crf_dos=<?php echo $reponse['ref_crf_dos'];?>','pop2','width=1000,height=700');">
						<i class="fa fa-eye"></i>
					</a>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['label_consommable'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['cod'];?>
				</td>
				<td style="text-align: left;">
					<?php echo $reponse['nom_cli'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherPartielleSansFOB($id_cli){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$compteur=0;

			$requete = $connexion-> prepare("SELECT p.num_part AS num_part,
													p.fob AS fob_part,
													p.cod AS cod,
													REPLACE(CONCAT(p.cod, p.num_part), ' ', '') AS cod_dos,
													COUNT(dos.id_dos) AS nbre_dos,
													SUM(dos.fob) AS fob_dos,
													(p.fob-IF(SUM(dos.fob)>0, SUM(dos.fob), 0)) AS solde_fob,
													p.poids AS poids_part,
													SUM(dos.poids) AS poids_dos,
													(p.poids-IF(SUM(dos.poids)>0, SUM(dos.poids), 0)) AS solde_poids,
													p.id_part AS id_part,
													l.num_lic AS num_lic
												FROM partielle_av p
													LEFT JOIN dossier dos
														ON REPLACE(CONCAT(p.cod,p.num_part), ' ', '') = REPLACE(dos.cod, ' ', '')
													LEFT JOIN licence l
														ON l.cod = p.cod
														AND l.id_cli = ?
												WHERE (p.fob IS NULL OR p.fob = 0)
												GROUP BY p.id_part ASC");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				include('modalEditPartielle.php');
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['cod'];?>
					<a class=" btn-xs btn-warning text-dark" title="Modifier la partielle" data-toggle="modal" data-target=".editPartielle_<?php echo $reponse['id_part'];?>">
						<i class="fa fa-edit"></i>
					</a>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_part'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids_part'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fob_part'], 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<?php echo number_format($reponse['nbre_dos'], 0, ',', '');?>
				</td>
				<td style="text-align: center;">
					<a class=" btn-xs bg-purple" title="Partielle" href="#" style="color: black;" onclick="window.open('popUpDossierPartielle.php?cod_dos=<?php echo $reponse['cod_dos'];?>','pop2','width=1000,height=700');">
						<i class="fa fa-eye"></i>
					</a>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids_dos'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fob_dos'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['solde_poids'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['solde_fob'], 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierCOD($cod_dos){
			include("connexion.php");
			$entree['cod_dos'] = $cod_dos;
			$compteur=0;

			$fob = 0;
			$poids = 0;

			$requete = $connexion-> prepare("SELECT ref_dos,
													ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, poids, ref_crf
												FROM dossier
												WHERE REPLACE(ref_crf, ' ', '') = ?");
			$requete-> execute(array($entree['cod_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$poids += $reponse['poids'];
				$fob += $reponse['fob'];
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_crf'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td colspan="9" style="text-align: right;">
					Total
				</td>
				<td style="text-align: right;">
					<?php echo number_format($poids, 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($fob, 2, ',', ' ');?>
				</td>
			</tr>
			<?php
		}

		public function afficherDossierCRF($ref_crf){
			include("connexion.php");
			$entree['ref_crf'] = $ref_crf;
			$compteur=0;

			$fob = 0;
			$poids = 0;

			$requete = $connexion-> prepare("SELECT ref_dos,
													ref_decl,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl,
													ref_liq,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq,
													ref_quit,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit,
													fob, poids, ref_crf
												FROM dossier
												WHERE REPLACE(ref_crf, ' ', '') = ?");
			$requete-> execute(array($entree['ref_crf']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$poids += $reponse['poids'];
				$fob += $reponse['fob'];
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_crf'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td colspan="9" style="text-align: right;">
					Total
				</td>
				<td style="text-align: right;">
					<?php echo number_format($poids, 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format($fob, 2, ',', ' ');?>
				</td>
			</tr>
			<?php
		}

		public function afficherDossiersAv($ref_crf, $id_cli){
			include("connexion.php");
			$entree['ref_crf'] = $ref_crf;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT ref_dos, fob
												FROM dossier
												WHERE cod = ?
												$sqlClient");
			$requete-> execute(array($entree['ref_crf']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersApuresTransmissionNotification($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic, 
													d.ref_fact,
													d.fob AS fob, d.ref_av AS ref_av, d.montant_av AS montant_av,
													d.ref_fact AS ref_fact, d.ref_decl AS ref_decl,
													d.road_manif AS road_manif,
													ta.ref_trans_ap AS ref_trans_ap,
													DATE_FORMAT(ta.date_trans_ap, '%d/%m/%Y') AS date_trans_ap,
													UPPER(ta.banque) AS banque
												FROM dossier d, detail_apurement dt, transmission_apurement ta
												WHERE d.id_mod_lic = ?
													$sqlClient
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = ta.id_trans_ap
												ORDER BY ta.id_trans_ap ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getDateExpirationLicence($reponse['num_lic']);
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_trans_ap'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['banque'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['date_val'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $date_exp;?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['fob'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['montant_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['road_manif'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersPretAEtreApures($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$compteur=0;

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic, 
													d.ref_fact,
													d.fob AS fob, d.ref_av AS ref_av, d.montant_av AS montant_av,
													d.ref_fact AS ref_fact, d.ref_decl AS ref_decl,
													d.road_manif AS road_manif,
													d.fob AS fob,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													(d.fob+d.assurance+d.autre_frais+d.fret) AS cif,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													d.ref_quit AS ref_quit
												FROM dossier d
												WHERE d.id_mod_lic = ?
													$sqlClient
													AND d.ref_quit IS NOT NULL
													AND d.ref_decl IS NOT NULL
													AND d.ref_decl <> ''
													AND d.ref_quit <> ''
													AND d.num_lic <> 'N/A'
													AND d.num_lic <> 'UNDER VALUE'
													AND d.num_lic <> 'UNDERVALUE'
													AND d.num_lic NOT LIKE '%UNDER%'
													AND d.id_dos NOT IN (
														SELECT id_dos 
															FROM dossier 
															WHERE ref_dos LIKE '%RF20-%' OR ref_dos LIKE '%AW20-%' OR ref_dos LIKE '%-ACID-%' OR ref_dos LIKE '%-SUL%'
														)
													AND d.id_dos NOT IN(
														SELECT id_dos FROM detail_apurement
													)
													AND (d.id_cli <> 869 AND d.id_cli <> 929 AND d.id_cli <> 927 AND d.id_cli <> 870 AND d.id_cli <> 902 AND d.id_cli <> 873 AND d.id_cli <> 871 AND d.id_cli <> 872)

											ORDER BY d.ref_dos DESC;");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getDateExpirationLicence($reponse['num_lic']);
				$compteur++;
			?>
			<tr>
				<td style="text-align: center;">
					<?php echo $compteur;?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_dos'];?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['fret'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['assurance'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['autre_frais'], 2, ',', ' ');?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_decl'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_liq'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_quit'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['date_quit'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['num_lic'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['sig_mon'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $this-> getDataLicence($reponse['num_lic'])['date_val'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $date_exp;?>
				</td>
				<td style="text-align: right;">
					<?php echo number_format( ($this-> getDataLicence($reponse['num_lic'])['fob']+$this-> getDataLicence($reponse['num_lic'])['fret']+$this-> getDataLicence($reponse['num_lic'])['assurance']+$this-> getDataLicence($reponse['num_lic'])['autre_frais']), 2, ',', ' ');?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['montant_av'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['ref_fact'];?>
				</td>
				<td style="text-align: center;">
					<?php echo $reponse['road_manif'];?>
				</td>
			</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossiersPretAEtreApuresAjax($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			$compteur=0;
			$row = array();

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic, 
													d.ref_fact,
													d.fob AS fob, d.ref_av AS ref_av, d.montant_av AS montant_av,
													d.ref_fact AS ref_fact, d.ref_decl AS ref_decl,
													d.road_manif AS road_manif,
													d.fob AS fob,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													(
														IF(d.fob > 0, d.fob, 0)+
														IF(d.fret > 0, d.fret, 0)+
														IF(d.autre_frais > 0, d.autre_frais, 0)+
														IF(d.assurance > 0, d.assurance, 0)
													) AS cif,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													d.ref_quit AS ref_quit,
													l.fob AS fob_lic,
													(
														IF(l.fob > 0, l.fob, 0)+
														IF(l.fret > 0, l.fret, 0)+
														IF(l.autre_frais > 0, l.autre_frais, 0)+
														IF(l.assurance > 0, l.assurance, 0)
													) AS cif_lic,
													mon.sig_mon AS sig_mon,
													d.ref_crf AS ref_crf,
													d.fob AS fob,
													d.ref_fact AS ref_fact,
													IF(d.road_manif IS NOT NULL AND d.road_manif <> 'N/A',
														d.road_manif,
														d.horse
													) AS road_manif,
													d.ref_assurance AS ref_assurance,
													d.remarque_apurement AS remarque_apurement,
													d.type_apurement AS type_apurement,
													CONCAT('<button class=\"btn btn-xs btn-warning\" title=\"Edit File\" onclick=\"modal_edit_dossier(\'',d.id_dos,'\');\">
																<i class=\"fa fa-edit\"></i>
															</button>') AS btn_action,
													part.fob AS fob_part
												FROM dossier d
													LEFT JOIN licence l
														ON l.num_lic = d.num_lic
													LEFT JOIN monnaie mon
														ON mon.id_mon = l.id_mon
													LEFT JOIN partielle_av part
														ON REPLACE(CONCAT(part.cod,part.num_part), ' ', '') = REPLACE(d.ref_crf, ' ', '')
												WHERE d.id_mod_lic = ?
													$sqlClient
													AND d.ref_quit IS NOT NULL
													AND d.ref_decl IS NOT NULL
													AND d.ref_decl <> ''
													AND d.ref_quit <> ''
													AND d.num_lic <> 'N/A'
													AND d.num_lic <> 'UNDER VALUE'
													AND d.num_lic <> 'UNDERVALUE'
													AND d.num_lic NOT LIKE '%UNDER%'
													AND d.id_dos NOT IN (
														SELECT id_dos 
															FROM dossier 
															WHERE ref_dos LIKE '%RF20-%' OR ref_dos LIKE '%AW20-%' OR ref_dos LIKE '%-ACID-%' OR ref_dos LIKE '%-SUL%'
														)
													AND d.id_dos NOT IN(
														SELECT id_dos FROM detail_apurement
													)
													AND (d.id_cli <> 869 AND d.id_cli <> 929 AND d.id_cli <> 927 AND d.id_cli <> 870 AND d.id_cli <> 902 AND d.id_cli <> 873 AND d.id_cli <> 871 AND d.id_cli <> 872)

											ORDER BY d.num_lic, d.ref_dos ASC;");
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {

				$compteur++;
				$reponse['compteur'] = $compteur;
				$reponse['date_exp'] = $this-> getDateExpirationLicence($reponse['num_lic']);
				$row[] = $reponse;

			}$requete-> closeCursor();

			return $row;
		}

		public function afficherLicence($id_mod_lic, $id_cli, $id_type_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = $premiere_entree;
			
			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5 || $_SESSION['id_role'] == '11'){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							IF(l.id_mod_lic = '1', l.poids, l.fob) AS fob,
							l.date_val AS date_val2,
							IF(l.id_mod_lic = '1', l.unit_mes, m.sig_mon) AS sig_mon,
							m.id_mon AS id_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.cod AS cod,
							l.consommable AS consommable,
							IF(l.consommable='1', 'Consommable', 'Divers') AS label_consommable,
							l.fret AS fret,
							l.autre_frais AS autre_frais,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							b.id_banq AS id_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							t.id_type_lic AS id_type_lic,
							UPPER(t.nom_type_lic) AS nom_type_lic,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							l.poids AS poids_lic,
							l.id_mod_trans AS id_mod_trans							
						FROM licence l, monnaie m, client cl, banque b, type_licence t
						WHERE l.id_mod_lic = ?
							AND l.id_type_lic = t.id_type_lic
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
						ORDER BY l.date_val DESC
						LIMIT $premiere_entree, $nombre_dossier_par_page";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				$bg = "bg-light";
				$couleur = "";
				$clignoteLic = '';
				
				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] <= $this-> getSommeFobAppureLicence($reponse['num_lic'])) || (($reponse['fob']-$this-> getSommeFobAppureLicence($reponse['num_lic']))<1) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if( ($reponse['fob'] < $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-red";
					$style = " style='color: rgb(255,69,0);'";
					$couleur = "red";
					$clignoteLic = ' clignoteb';
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}
				include('modalManipulation.php');
				include('modalEditLicence.php');
			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6_licence <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;"><span class="<?php echo $clignoteLic;?>"><?php echo $reponse['num_lic'];?></span></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;">
						<?php echo $reponse['cod'];?>
						<a class="btn btn-xs btn-secondary" title="Partielle" href="#" style="color: black;" onclick="window.open('popUpPartielleLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&cod=<?php echo $reponse['cod'];?>','pop1','width=1300,height=900');">
							<i class="fa fa-eye"></i>
						</a>
					</td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['commodity'];?></td>
					<?php
				}
				?>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: right;border: 1px solid black;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){/*
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<?php*/
					}
				?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_banq'];?></td>
				<?php
				if($id_mod_lic == '1'){
					/*
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl']-$this-> getSommeQteLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<?php
					*/
				}
				/*if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
				}*/
				?>
				<td style="text-align: center; border: 1px solid black;">
					<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
				</td>
				<td style="text-align: center; border: 1px solid black;">
					<span class="<?php echo $clignoteLic;?>">
						<?php 
						echo ($reponse['fob'] - $this-> getSommeFobLicence($reponse['num_lic']));
						?>
					</span>
				</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<?php
				}
				?>
					<td style="text-align: center; border: 1px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Dossiers affectÃ©s" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1300,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<!--<form method="POST" action="">
							<input type="hidden" value="<?php echo $reponse['num_lic'];?>" name="num_lic">
							<button class="btn btn-sm btn-warning" name="edit">
								<i class="fa fa-edit"></i>
							</button>
						</form>-->
						<button class="btn btn-sm btn-warning" data-toggle="modal" data-target=".editLicence_<?php echo str_replace(' ', '_', $reponse['num_lic']);?>">
							<i class=" fas fa-edit" style="color: black;"></i>
						</button>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm bg bg-teal" data-toggle="modal" data-target=".manipulation_<?php echo $reponse['num_lic'];?>">
							<i class=" fas fa-indent" style="color: black;"></i>
						</button>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm btn-success" onclick="window.open('appurement.php?num_lic=<?php echo $reponse['num_lic'];?>','pop1','width=800,height=800');">
							<i class=" fas fa-check"></i>
						</button>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherLicenceAjax($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$compteur = 0;
			$rows = array();

			
			$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
												DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
												l.date_val AS date_val_2,
												(
													IF(l.fob IS NOT NULL, l.fob, 0)+
													IF(l.fret IS NOT NULL, l.fret, 0)+
													IF(l.assurance IS NOT NULL, l.assurance, 0)+
													IF(l.autre_frais IS NOT NULL, l.autre_frais, 0)
												) AS cif,
												IF(l.id_mod_lic = '1', l.poids, l.fob) AS fob,
												l.date_val AS date_val2,
												IF(l.id_mod_lic = '1', l.unit_mes, m.sig_mon) AS sig_mon,
												m.id_mon AS id_mon,
												l.qte_decl AS qte_decl,
												l.fichier_lic AS fichier_lic,
												CONCAT(l.cod,' <button class=\"btn btn-xs btn-info\" title=\"Dossiers affectÃ©s\" onclick=\"window.open(\'popUpPartielleLicence.php?num_lic=',l.num_lic,'&cod=',l.cod,'\',\'pop1\',\'width=1100,height=900\');\">
														<i class=\"fa fa-folder-open\"></i>
													</button>') AS cod,
												l.consommable AS consommable,
												IF(l.consommable='1', 'Consommable', 'Divers') AS label_consommable,
												l.fret AS fret,
												l.autre_frais AS autre_frais,
												l.acheteur AS acheteur,
												l.assurance AS assurance,
												UPPER(cl.nom_cli) AS nom_cli,
												UPPER(l.commodity) AS commodity,
												l.fournisseur AS fournisseur,
												DATE(CURRENT_DATE()) AS aujourdhui,
												UPPER(b.nom_banq) AS nom_banq,
												b.id_banq AS id_banq,
												l.ref_fact AS ref_fact,
												l.remarque AS remarque,
												t.id_type_lic AS id_type_lic,
												UPPER(t.nom_type_lic) AS nom_type_lic,
												-- COUNT(dos.id_dos) AS nbre_dos,
												SUM(IF(dos.fob IS NOT NULL, dos.fob, 0)) AS fob_dos,
												SUM(IF(dos.poids IS NOT NULL, dos.poids, 0)) AS poids_dos,
												(IF(l.fob IS NOT NULL, l.fob, 0)-SUM(IF(dos.fob IS NOT NULL, dos.fob, 0))) AS solde_fob,
												IF((IF(l.fob IS NOT NULL, l.fob, 0)-SUM(IF(dos.fob IS NOT NULL, dos.fob, 0)))<0,
													'bg bg-danger', 
													''
												) AS class_solde_fob,
												(IF(l.poids IS NOT NULL, l.poids, 0)-SUM(IF(dos.poids IS NOT NULL, dos.poids, 0))) AS solde_poids,
												IF((IF(l.poids IS NOT NULL, l.poids, 0)-SUM(IF(dos.poids IS NOT NULL, dos.poids, 0)))<0,
													'bg bg-danger', 
													''
												) AS class_solde_poids,
												DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
												l.poids AS poids_lic,
												l.id_mod_trans AS id_mod_trans,
												CONCAT(COUNT(dos.id_dos),' <button class=\"btn btn-xs btn-info\" title=\"Dossiers affectÃ©s\" onclick=\"window.open(\'popUpDossierLicence.php?num_lic=',l.num_lic,'\',\'pop1\',\'width=1100,height=900\');\">
														<i class=\"fa fa-folder-open\"></i>
													</button>') AS nbre_dos,
												CONCAT(' <button class=\"btn btn-xs btn-warning\" title=\"Edit Licence\" onclick=\"modal_edit_licence(\'',l.num_lic,'\');\">
														<i class=\"fa fa-edit\"></i>
													</button><button class=\"btn btn-xs btn-info\" title=\"Fichier Licence\" onclick=\"window.open(\'../dossiers/',l.num_lic,'/',l.fichier_lic,'\',\'pop1\',\'width=1100,height=900\');\">
														<i class=\"fa fa-file\"></i> Fichier Licence
													</button>') AS fichier,
												IF(l.consommable='1', 'Consommable', 'Autres/Divers') AS type_lic,
												march.nom_march AS nom_march				
											-- FROM licence l, monnaie m, client cl, banque b, type_licence t
											-- WHERE l.id_mod_lic = ?
											-- 	AND l.id_type_lic = t.id_type_lic
											-- 	AND l.id_cli = cl.id_cli
											-- 	AND l.id_mon = m.id_mon
											-- 	AND l.id_banq = b.id_banq
											-- 	-- AND YEAR(l.date_val) >= YEAR(CURRENT_DATE())-1
											-- ORDER BY l.date_val DESC			
											FROM licence l
												LEFT JOIN monnaie m
													ON l.id_mon = m.id_mon 
												LEFT JOIN client cl
													ON l.id_cli = cl.id_cli 
												LEFT JOIN banque b
													ON l.id_banq = b.id_banq 
												LEFT JOIN type_licence t
													ON l.id_type_lic = t.id_type_lic
												LEFT JOIN dossier dos
													ON l.num_lic = dos.num_lic
														AND dos.cleared <> '2'
												LEFT JOIN marchandise march
													ON l.id_march = march.id_march
												
												-- AND YEAR(l.date_val) >= YEAR(CURRENT_DATE())-1
											WHERE l.id_mod_lic = ?
												AND l.id_cli = ?
											GROUP BY l.num_lic
											ORDER BY l.date_val DESC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$reponse['compteur'] = $compteur;
				// $reponse['nbre_dos'] = $this-> getNbreDossierLicence($reponse['num_lic']);
				// $reponse['nbre_dos'] .= $reponse['btn_dossier'];
				// $reponse['fob_dos'] = $this-> getSommeFobLicence($reponse['num_lic']);
				// $reponse['solde_fob'] = $reponse['fob']-$reponse['fob_dos'];

				// if (!empty($this-> getLastEpirationLicence2($reponse['num_lic']))&&($this-> getLastEpirationLicence2($reponse['num_lic']))!=NULL) {
				// 	$reponse['date_exp'] = $this-> getLastEpirationLicence2($reponse['num_lic']);
				// }else{
				// 	$reponse['date_exp'] = NULL;
				// }

				$reponse['statut'] = '<span class="text-xs badge badge-light">unused</span>';
				$reponse['statut_1'] = '0';
				$reponse['date_exp'] = $this-> getLastEpirationLicence2($reponse['num_lic']);

				if( ($reponse['fob'] <= $this-> getSommeFobAppureLicence($reponse['num_lic'])) || (($reponse['fob']-$this-> getSommeFobAppureLicence($reponse['num_lic']))<1) ){

					$reponse['statut'] = 'Totalement ApurÃ©e';

				}else if( ($reponse['fob'] < $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){

					$reponse['statut'] = '<span class="text-xs badge badge-danger clignoteb">FOB negatif</span>';

				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){

					$reponse['statut'] = '<span class="text-xs badge badge-dark">CloturÃ©e en attente transmission Banque</span>';

				}else if($reponse['date_exp'] < $reponse['aujourdhui']){

					$reponse['statut'] = '<span class="text-xs badge badge-danger clignoteb">ExpirÃ©e</span>';
					$reponse['statut_1'] = '2';

				}else if( ($this-> getDifferenceDate($reponse['date_exp'], $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($reponse['date_exp'], $reponse['aujourdhui']) >= 0) ){

					$reponse['statut'] = '<span class="text-xs badge badge-warning">Expiration -40 Jours</span>';

				}else if( ($this-> getDifferenceDate($reponse['date_exp'], $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($reponse['date_exp'], $reponse['aujourdhui']) < 0) ){

					$reponse['statut'] = '<span class="text-xs badge badge-danger clignoteb">ExpirÃ©e</span>';

				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){

					$reponse['statut'] = '<span class="text-xs badge badge-info">Partiellement ApurÃ©e</span>';

				}
				$rows[] = $reponse;
				
			}$requete-> closeCursor();

			return $rows;

		}

		public function afficherLicenceExport($id_mod_lic, $id_cli, $id_type_lic, $premiere_entree, $nombre_dossier_par_page){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = $premiere_entree;
			
			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5 || $_SESSION['id_role'] == '11'){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							IF(l.id_mod_lic = '1', l.poids, l.fob) AS fob,
							l.date_val AS date_val2,
							IF(l.id_mod_lic = '1', l.unit_mes, m.sig_mon) AS sig_mon,
							m.id_mon AS id_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.unit_mes AS unit_mes,
							l.autre_frais AS autre_frais,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(mse.nom_march) AS nom_march,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							b.id_banq AS id_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							t.id_type_lic AS id_type_lic,
							UPPER(t.nom_type_lic) AS nom_type_lic,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							l.poids AS poids,
							l.id_mod_trans AS id_mod_trans							
						FROM licence l, monnaie m, client cl, banque b, type_licence t, marchandise mse
						WHERE l.id_mod_lic = ?
							AND l.id_type_lic = t.id_type_lic
							AND l.id_cli = cl.id_cli
							AND l.id_march = mse.id_march
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
						ORDER BY l.date_creat_lic DESC
						LIMIT $premiere_entree, $nombre_dossier_par_page";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				$bg = "bg-light";
				$couleur = "";
				
				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}
				include('modalManipulation.php');
				include('modalEditLicence.php');
			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6_licence <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['nom_march'];?></td>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['unit_mes'];?></td>
					<td style="text-align: center;border: 1px solid black;">
						<?php echo number_format( $reponse['poids'], 2, ',', ' ');?>
					</td>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['nom_banq'];?></td>
					<td style="text-align: center; border: 1px solid black;">
						<?php 
							echo number_format( ($this-> getSommeFobLicence($reponse['num_lic'])), 2, ',', ' ');
						?>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<?php 
							echo number_format( ($reponse['poids']-$this-> getSommeFobLicence($reponse['num_lic'])), 2, ',', ' ');
						?>
					</td>
					<td style="text-align: center; border: 1px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Dossiers affectÃ©s" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1000,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<!--<form method="POST" action="">
							<input type="hidden" value="<?php echo $reponse['num_lic'];?>" name="num_lic">
							<button class="btn btn-sm btn-warning" name="edit">
								<i class="fa fa-edit"></i>
							</button>
						</form>-->
						<button class="btn btn-sm btn-warning" data-toggle="modal" data-target=".editLicence_<?php echo str_replace(' ', '_', $reponse['num_lic']);?>">
							<i class=" fas fa-edit" style="color: black;"></i>
						</button>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm bg bg-teal" data-toggle="modal" data-target=".manipulation_<?php echo $reponse['num_lic'];?>">
							<i class=" fas fa-indent" style="color: black;"></i>
						</button>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm btn-success" onclick="window.open('appurement.php?num_lic=<?php echo $reponse['num_lic'];?>','pop1','width=800,height=800');">
							<i class=" fas fa-check"></i>
						</button>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherLicenceRecherche($id_mod_lic, $id_cli, $id_type_lic, $num_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = '%'.$num_lic.'%';

			$sql = "";
			$sql2 = "";
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = 0;
			
			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5 || $_SESSION['id_role'] == '11'){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							l.date_val AS date_val2,
							m.sig_mon AS sig_mon,
							m.id_mon AS id_mon,
							l.qte_decl AS qte_decl,
							l.cod AS cod,
							l.consommable AS consommable,
							IF(l.consommable='1', 'Consommable', 'Divers') AS label_consommable,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							l.autre_frais AS autre_frais,
							l.poids AS poids_lic,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							b.id_banq AS id_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact							
						FROM licence l, monnaie m, client cl, banque b
						WHERE l.id_mod_lic = ?
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
							AND l.num_lic LIKE ?
						ORDER BY l.date_creat_lic DESC";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic'], $entree['num_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				$bg = "bg-light";
				$couleur = "";
				
				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}
				include('modalManipulation.php');
				include('modalEditLicence.php');
			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6_licence <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;">
						<?php echo $reponse['cod'];?>
						<a class="btn btn-xs btn-secondary" title="Partielle" href="#" style="color: black;" onclick="window.open('popUpPartielleLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&cod=<?php echo $reponse['cod'];?>','pop1','width=1300,height=900');">
							<i class="fa fa-eye"></i>
						</a>
					</td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['commodity'];?></td>
					<?php
				}
				?>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: right;border: 1px solid black;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<?php
					}
				?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_banq'];?></td>
				<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl']-$this-> getSommeQteLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<?php
				}
				/*if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
				}*/
				?>
				<td style="text-align: center; border: 1px solid black;">
					<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
				</td>
				<td style="text-align: center; border: 1px solid black;">
					<?php 
						echo ($reponse['fob'] - $this-> getSommeFobLicence($reponse['num_lic']));
					?>
				</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<?php
				}
				?>
					<td style="text-align: center; border: 1px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Dossiers affectÃ©s" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1000,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<!--<form method="POST" action="">
							<input type="hidden" value="<?php echo $reponse['num_lic'];?>" name="num_lic">
							<button class="btn btn-sm btn-warning" name="edit">
								<i class="fa fa-edit"></i>
							</button>
						</form>-->
						<button class="btn btn-sm btn-warning" data-toggle="modal" data-target=".editLicence_<?php echo str_replace(' ', '_', $reponse['num_lic']);?>">
							<i class=" fas fa-edit" style="color: black;"></i>
						</button>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm bg bg-teal" data-toggle="modal" data-target=".manipulation_<?php echo $reponse['num_lic'];?>">
							<i class=" fas fa-indent" style="color: black;"></i>
						</button>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-sm btn-success" onclick="window.open('appurement.php?num_lic=<?php echo $reponse['num_lic'];?>','pop1','width=800,height=800');">
							<i class=" fas fa-check"></i>
						</button>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function editLicence($id_mod_lic, $id_cli, $id_type_lic, $num_lic){
			include("connexion.php");
			$entree['num_lic'] = $num_lic;

			$compteur = 0;
			
			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							l.date_val AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							b.id_banq AS id_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							cl.id_cli AS id_cli,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact							
						FROM licence l, monnaie m, client cl, banque b
						WHERE l.num_lic = ?
							AND l.id_cli = cl.id_cli
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
						ORDER BY l.date_val DESC";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['num_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				$bg = "bg-light";
				$couleur = "";
				
				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}
				
			?>
				<form method="POST" action="">
					<input type="hidden" value="<?php echo $reponse['num_lic'];?>" name="num_lic_old">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" padding: 0.8rem; text-align: left; border: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6_licence <?php echo $bg;?>" style=" text-align: left; border: 1px solid black;">
						<input type="text" name="num_lic" value="<?php echo $reponse['num_lic'];?>" class="form-control cc-exp" required>
					</td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 1px solid black;">
						<input type="date" name="date_val" value="<?php echo $reponse['date_val'];?>" class="form-control cc-exp" required>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<input type="date" name="date_exp" value="<?php echo $this-> getLastEpirationLicence2($reponse['num_lic']);?>" class="form-control cc-exp" required>
					</td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><input type="text" name="acheteur" value="<?php echo $reponse['acheteur'];?>" class="form-control cc-exp" required></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><input type="text" name="fournisseur" value="<?php echo $reponse['fournisseur'];?>" class="form-control cc-exp" required></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><input type="text" name="commodity" value="<?php echo $reponse['commodity'];?>" class="form-control cc-exp" required></td>
					<?php
				}
				?>
					<td style="text-align: center;border: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: right;border: 1px solid black;">
						<input type="number" name="fob" value="<?php echo $reponse['fob'];?>" class="form-control cc-exp" required>
					</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<?php
					}
				?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_banq'];?></td>
				<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl']-$this-> getSommeQteLicence($reponse['num_lic']), 2, ',', ' ');?></td>
					<?php
				}
				/*if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
				}*/
				?>
				<td style="text-align: center; border: 1px solid black;">
					<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
				</td>
				<td style="text-align: center; border: 1px solid black;">
					<?php 
						echo ($reponse['fob'] - $this-> getSommeFobLicence($reponse['num_lic']));
					?>
				</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<?php
				}
				?>
					<td style="text-align: center; border: 1px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Fichier Licence" href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a title="Dossiers affectÃ©s" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1000,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<button class="btn btn-success" name="modifierLicence">
							<i class="fa fa-check"></i>
						</button>
					</td>
				</tr>
				</form>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherLicenceExcel($id_mod_lic, $id_cli, $id_type_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$status = "";

			$compteur = 0;
			
			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							UPPER(cl.nom_cli) AS nom_cli,
							UPPER(l.commodity) AS commodity,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							b.id_banq AS id_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact							
						FROM licence l, monnaie m, client cl, banque b
						WHERE l.id_mod_lic = ?
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
						ORDER BY l.date_val DESC";

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				$bg = "bg-light";
				$couleur = "";
				
				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style='color: grey;'";
					$couleur = "dark";
					$status = 'CloturÃ©e avec dossier';
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style='color: green;'";
					$couleur = "success";
					$status = 'ApurÃ©e Banque';
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style='color: red;'";
					$couleur = "danger";
					$status = 'ExpirÃ©e';
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style='color: orange;'";
					$couleur = "warning";
					$status = 'Expiration -40 jours';
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style='color: red;'";
					$couleur = "danger";
					$status = 'ExpirÃ©e';
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style='color: blue;'";
					$couleur = "info";
					$status = 'Partielle';
				}
				
			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" text-align: left; border: 0.5px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: center; border: 0.5px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 0.5px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['commodity'];?></td>
					<?php
				}
				?>
					<td style="text-align: right;border: 0.5px solid black;"><?php echo $reponse['fob'].' '.$reponse['sig_mon'];?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['assurance'];?></td>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['fret'];?></td>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo ($reponse['fob']+$reponse['assurance']+$reponse['fret']);?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['qte_decl'];?></td>
					<?php
					}
				?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['nom_banq'];?></td>
				<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']);?></td>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo $reponse['qte_decl']-$this-> getSommeQteLicence($reponse['num_lic']);?></td>
					<?php
				}
				/*if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 0.5px solid black;"><?php echo number_format( $reponse['fob']-$this-> getSommeFobLicence($reponse['num_lic']), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
				}*/
				?>
				<td style="text-align: center; border: 0.5px solid black;">
					<?php echo $this-> getNbreDossierLicence($reponse['num_lic']);?>
				</td>
				<td style="text-align: center; border: 0.5px solid black;">
					<?php 
						echo ($reponse['fob'] - $this-> getSommeFobLicence($reponse['num_lic']));
					?>
				</td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: left; border: 0.5px solid black;"><?php echo $reponse['date_fact'];?></td>
					<?php
				}
				?>
					<td style="text-align: center; border: 0.5px solid black; color: black; background-color: white;">
						<?php echo $reponse['remarque'];?>
						</a>
					</td>
					<td style="text-align: center; border: 0.5px solid black; color: black; background-color: white;">
						<?php echo $status;?>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();

			}
		}

		public function afficherLicenceUpload($id_mod_lic, $id_util){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM licence_upload
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['fournisseur'];?>	
					</td>
					<td>
						<?php echo $reponse['commodity'];?>	
					</td>
					<td>
						<?php echo $reponse['po'];?>	
					</td>
					<td>
						<?php echo $reponse['facture'];?>	
					</td>
					<td>
						<?php echo $reponse['num_licence'];?>	
					</td>
					<td>
						<?php echo $reponse['monnaie'];?>	
					</td>
					<td>
						<?php echo $reponse['fob'];?>	
					</td>
					<td>
						<?php echo $reponse['fret'];?>	
					</td>
					<td>
						<?php echo $reponse['assurance'];?>	
					</td>
					<td>
						<?php echo $reponse['autre_frais'];?>	
					</td>
					<td>
						<?php echo $reponse['fsi'];?>	
					</td>
					<td>
						<?php echo $reponse['aur'];?>	
					</td>
					<td>
						<?php echo $reponse['validation'];?>	
					</td>
					<td>
						<?php echo $reponse['extreme'];?>	
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteLicence">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierUpload($id_mod_lic, $id_util){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM dossier_upload
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['ref_dos'];?>	
					</td>
					<td>
						<?php echo $reponse['num_lic'];?>	
					</td>
					<td>
						<?php echo $reponse['cod'];?>	
					</td>
					<td>
						<?php echo $reponse['fxi'];?>	
					</td>
					<td>
						<?php echo $reponse['montant_av'];?>	
					</td>
					<td>
						<?php echo $reponse['date_fact'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_fact'];?>	
					</td>
					<td>
						<?php echo $reponse['fob'];?>	
					</td>
					<td>
						<?php echo $reponse['fret'];?>	
					</td>
					<td>
						<?php echo $reponse['assurance'];?>	
					</td>
					<td>
						<?php echo $reponse['autre_frais'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_decl'];?>	
					</td>
					<td>
						<?php echo $reponse['montant_decl'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_liq'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_quit'];?>	
					</td>
					<td>
						<?php echo $reponse['date_quit'];?>	
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteDossierUpload">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierUploadTrackingKlsa($id_mod_lic, $id_util){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM dossier_upload_tracking
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['ref_dos'];?>	
					</td>
					<td>
						<?php echo $reponse['num_lic'];?>	
					</td>
					<td>
						<?php echo $reponse['t1'];?>	
					</td>
					<td>
						<?php echo $reponse['poids'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_fact'];?>	
					</td>
					<td>
						<?php echo $reponse['horse'];?>	
					</td>
					<td>
						<?php echo $reponse['trailer_1'];?>	
					</td>
					<td>
						<?php echo $reponse['trailer_2'];?>	
					</td>
					<td>
						<?php echo $reponse['transporteur'];?>	
					</td>
					<td>
						<?php echo $reponse['destination'];?>	
					</td>
					<td>
						<?php echo $reponse['arrival_date'];?>	
					</td>
					<td>
						<?php echo $reponse['crossing_date'];?>	
					</td>
					<td>
						<?php echo $reponse['wiski_arriv'];?>	
					</td>
					<td>
						<?php echo $reponse['wiski_dep'];?>	
					</td>
					<td>
						<?php echo $reponse['remarque'];?>	
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteDossierUpload">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierUploadExport($id_util){
			include("connexion.php");
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM dossier_upload_export
												WHERE id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++; 
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['ref_dos'];?>	
					</td>
					<td>
						<?php echo $reponse['num_lic'];?>	
					</td>
					<td>
						<?php echo $reponse['date_exp'];?>	
					</td>
					<td>
						<?php echo $reponse['tonnage'];?>	
					</td>
					<td>
						<?php echo $reponse['ship_num'];?>	
					</td>
					<td>
						<?php echo $reponse['barge'];?>	
					</td>
					<td>
						<?php echo $reponse['horse'];?>	
					</td>
					<td>
						<?php echo $reponse['trailer_1'];?>	
					</td>
					<td>
						<?php echo $reponse['trailer_2'];?>	
					</td>
					<td>
						<?php echo $reponse['num_lot'];?>	
					</td>
					<td>
						<?php echo $reponse['nbr_bags'];?>	
					</td>
					<td>
						<?php echo $reponse['poids'];?>	
					</td>
					<td>
						<?php echo $reponse['kapulo_load'];?>	
					</td>
					<td>
						<?php echo $reponse['dispatch_pweto'];?>	
					</td>
					<td>
						<?php echo $reponse['arrival_pweto'];?>	
					</td>
					<td>
						<?php echo $reponse['barge_load'];?>	
					</td>
					<td>
						<?php echo $reponse['barge_dispatch_date'];?>	
					</td>
					<td>
						<?php echo $reponse['doc_receiv'];?>	
					</td>
					<td>
						<?php echo $reponse['nbre_seal'];?>	
					</td>
					<td>
						<?php echo $reponse['dgda_seal'];?>	
					</td>
					<td>
						<?php echo $reponse['remarque'];?>	
					</td>
					<td>
						<?php echo $reponse['transporter'];?>	
					</td>
					<td>
						<?php echo $reponse['load_date'];?>	
					</td>
					<td>
						<?php echo $reponse['pv_mine'];?>	
					</td>
					<td>
						<?php echo $reponse['demande_attestation'];?>	
					</td>
					<td>
						<?php echo $reponse['assay_date'];?>	
					</td>
					<td>
						<?php echo $reponse['ceec_in'];?>	
					</td>
					<td>
						<?php echo $reponse['ceec_out'];?>	
					</td>
					<td>
						<?php echo $reponse['min_div_in'];?>	
					</td>
					<td>
						<?php echo $reponse['min_div_out'];?>	
					</td>
					<td>
						<?php echo $reponse['date_decl'];?>	
					</td>
					<td>
						<?php echo $reponse['dgda_in'];?>	
					</td>
					<td>
						<?php echo $reponse['date_liq'];?>	
					</td>
					<td>
						<?php echo $reponse['date_quit'];?>	
					</td>
					<td>
						<?php echo $reponse['dgda_out'];?>	
					</td>
					<td>
						<?php echo $reponse['gov_in'];?>	
					</td>
					<td>
						<?php echo $reponse['gov_out'];?>	
					</td>
					<td>
						<?php echo $reponse['dispatch_date'];?>	
					</td>
					<td>
						<?php echo $reponse['klsa_arriv'];?>	
					</td>
					<td>
						<?php echo $reponse['end_form'];?>	
					</td>
					<td>
						<?php echo $reponse['exit_drc'];?>	
					</td>
					<td>
						<?php echo $reponse['cleared'];?>	
					</td>
					<td>
						<?php echo $reponse['statut'];?>	
					</td>
					<td>
						<?php echo $reponse['site_load'];?>	
					</td>
					<td>
						<?php echo $reponse['destination'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_decl'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_liq'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_quit'];?>	
					</td>
					<td>
						<?php echo $reponse['impala_sncc'];?>	
					</td>
					<td>
						<?php echo $reponse['docs_sncc'];?>	
					</td>
					<td>
						<?php echo $reponse['sncc_sakania'];?>	
					</td>
					<td>
						<?php echo $reponse['sakania_date'];?>	
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteDossierUpload">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierUpload2($id_mod_lic, $id_util){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT * FROM dossier_upload_tracking
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));
			while($reponse = $requete-> fetch()){
				$compteur++;
			?>
				<form method="POST" action="">
					<input type="hidden" name="id" value="<?php echo $reponse['id'];?>">
				<tr class="">
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['ref_dos'];?>	
					</td>
					<td>
						<?php echo $reponse['mca_b_ref'];?>	
					</td>
					<td>
						<?php echo $reponse['road_manif'];?>	
					</td>
					<td>
						<?php echo $reponse['date_preal'];?>	
					</td>
					<td>
						<?php echo $reponse['t1'];?>	
					</td>
					<td>
						<?php echo $reponse['poids'];?>	
					</td>
					<td>
						<?php echo $reponse['fob'];?>	
					</td>
					<td>
						<?php echo $reponse['fret'];?>	
					</td>
					<td>
						<?php echo $reponse['assurance'];?>	
					</td>
					<td>
						<?php echo $reponse['autre_frais'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_fact'];?>	
					</td>
					<td>
						<?php echo $reponse['fournisseur'];?>	
					</td>
					<td>
						<?php echo $reponse['po'];?>	
					</td>
					<td>
						<?php echo $reponse['commodity'];?>	
					</td>
					<td>
						<?php echo $reponse['horse'];?>	
					</td>
					<td>
						<?php echo $reponse['trailer_1'];?>	
					</td>
					<td>
						<?php echo $reponse['trailer_2'];?>	
					</td>
					<td>
						<?php echo $reponse['num_lic'];?>	
					</td>
					<td>
						<?php echo $reponse['num_exo'];?>	
					</td>
					<td>
						<?php echo $reponse['crossing_date'];?>	
					</td>
					<td>
						<?php echo $reponse['arrival_date'];?>	
					</td>
					<td>
						<?php echo $reponse['wiski_arriv'];?>	
					</td>
					<td>
						<?php echo $reponse['wiski_dep'];?>	
					</td>
					<td>
						<?php echo $reponse['amicongo_arriv'];?>	
					</td>
					<td>
						<?php echo $reponse['insp_report'];?>	
					</td>
					<td>
						<?php echo $reponse['ir'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_crf'];?>	
					</td>
					<td>
						<?php echo $reponse['date_crf'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_decl'];?>	
					</td>
					<td>
						<?php echo $reponse['dgda_in'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_liq'];?>	
					</td>
					<td>
						<?php echo $reponse['date_liq'];?>	
					</td>
					<td>
						<?php echo $reponse['ref_quit'];?>	
					</td>
					<td>
						<?php echo $reponse['date_quit'];?>	
					</td>
					<td>
						<?php echo $reponse['dgda_out'];?>	
					</td>
					<td>
						<?php echo $reponse['custom_deliv'];?>	
					</td>
					<td>
						<?php echo $reponse['dispatch_deliv'];?>	
					</td>
					<td>
						<?php echo $reponse['statut'];?>	
					</td>
					<td>
						<?php echo $reponse['remarque'];?>	
					</td>
					<td style="text-align: center;">
						<button class="btn btn-danger" type="submit" name="deleteDossierUpload">
							<i class="fa fa-times"></i>
						</button>
					</td>
				</tr>
			</form>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherManipulationLicence($id_mod_lic, $id_cli, $id_type_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";

			$nbre_dossier = 0;
			$num_lic = '';
			$active_rowspan = 1;
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = 0;
			
			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							l.autre_frais AS autre_frais,
							l.fsi AS fsi,
							l.aur AS aur,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							b.id_banq AS id_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							d.ref_dos AS ref_dos,
							d.id_dos AS id_dos,
							d.fob AS fob_dos,
							d.fret AS fret_dos,
							d.assurance AS assurance_dos,
							d.autre_frais AS autre_frais_dos,
							d.ref_fact AS ref_fact_dos,
							d.date_fact AS date_fact_dos,
							d.ref_decl AS ref_decl,
							d.ref_liq AS ref_liq,
							d.ref_quit AS ref_quit,
							d.montant_decl AS montant_decl,
							d.cod AS cod_dos,
							d.fxi AS fxi,
							l.commodity AS commodityLic,
							d.montant_av AS montant_av,
							d.remarque_lic AS remarque_lic,
							DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit					
						FROM licence l, monnaie m, client cl, banque b, dossier d
						WHERE l.id_mod_lic = ?
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
							AND l.num_lic = d.num_lic
						ORDER BY l.date_val, l.num_lic DESC";
			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$nbre_dossier = $this-> getNbreDossierLicence($reponse['num_lic']);
				if ($num_lic != $reponse['num_lic']) {
					$num_lic = $reponse['num_lic'];
					$active_rowspan = 1;
				}
				$num_lic = $reponse['num_lic'];
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				$bg = "bg-light";
				$couleur = "";
				
				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style=''";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style=''";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style=''";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style=''";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style=''";
					$couleur = "info";
				}
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style=" border-right: 1px solid black;vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<?php

					if ( ($nbre_dossier > 1) && ($num_lic == $reponse['num_lic']) && ($active_rowspan == 1) ) {
						$active_rowspan = 0;
					?>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: left; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['commodityLic'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fret'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['assurance'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob']+$reponse['fret']+$reponse['assurance']+$reponse['autre_frais'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fsi'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['aur'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
					}elseif ( ($nbre_dossier <= 1) && ($num_lic == $reponse['num_lic']) && ($active_rowspan == 1) ){
					?>
					<td style="text-align: left; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $marchandise;?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob']+$reponse['fret']+$reponse['assurance']+$reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fsi'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['aur'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php

					}

					?>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 12em;" type="text" name="cod_<?php echo $compteur;?>" value="<?php echo $reponse['cod_dos'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 10em;" type="text" name="fxi_<?php echo $compteur;?>" value="<?php echo $reponse['fxi'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 8em;" type="number" step="0.01" min="0" name="montant_av_<?php echo $compteur;?>" value="<?php echo $reponse['montant_av'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_fact_dos'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact_dos'];?></td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob_dos'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 8em; text-align: right;" type="number" step="0.01" min="0" name="fret_dos_<?php echo $compteur;?>" value="<?php echo $reponse['fret_dos'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 8em; text-align: right;" type="number" step="0.01" min="0" name="assurance_dos_<?php echo $compteur;?>" value="<?php echo $reponse['assurance_dos'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input style="width: 8em; text-align: right;" type="number" step="0.01" min="0" name="autre_frais_dos_<?php echo $compteur;?>" value="<?php echo $reponse['autre_frais_dos'];?>">
					</td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob_dos']+$reponse['fret_dos']+$reponse['assurance_dos']+$reponse['autre_frais_dos'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_decl'];?></td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['montant_decl'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_liq'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_quit'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_quit'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<input type="text" name="remarque_lic_<?php echo $compteur;?>" value="<?php echo $reponse['remarque_lic'];?>">
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<a title="Dossiers affectÃ©s" href="#" style="color: black;" onclick="window.open('popUpDossierLicence.php?num_lic=<?php echo $reponse['num_lic'];?>&couleur=<?php echo $couleur;?>','pop1','width=1000,height=900');">
							<i class="fa fa-folder-open"></i>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php

			}

		}

		public function manipulationLicence($num_lic, $i){
			include("connexion.php");
			$entree['num_lic'] = $num_lic;

			$compteur = 0;

				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							l.autre_frais AS autre_frais,
							l.fsi AS fsi,
							l.aur AS aur,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							b.id_banq AS id_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							d.ref_dos AS ref_dos,
							d.id_dos AS id_dos,
							d.fob AS fob_dos,
							d.fret AS fret_dos,
							d.assurance AS assurance_dos,
							d.autre_frais AS autre_frais_dos,
							d.ref_fact AS ref_fact_dos,
							d.date_fact AS date_fact_dos,
							d.ref_decl AS ref_decl,
							d.ref_liq AS ref_liq,
							d.ref_quit AS ref_quit,
							d.montant_decl AS montant_decl,
							d.cod AS cod_dos,
							d.fxi AS fxi,
							l.commodity AS commodityLic,
							d.montant_av AS montant_av,
							d.remarque_lic AS remarque_lic,
							DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit					
						FROM licence l, monnaie m, client cl, banque b, dossier d
						WHERE l.num_lic = ?
							AND l.id_cli = cl.id_cli
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
							AND l.num_lic = d.num_lic
						ORDER BY d.ref_dos ASC";
			$requete2 = $connexion-> prepare($sql);
			$requete2-> execute(array($entree['num_lic']));
			while($reponse2 = $requete2-> fetch()){
				$compteur++;
				if ($this-> verifierApurementDossier($reponse2['id_dos']) == true) {
					$apurement = 'APPURE';
				}else{
					$apurement = 'NON-APPURE';
				}
			?>
				<input type="hidden" name="id_dos_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['id_dos'];?>">
				<div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">MCA FILE REF</label>
		            <input type="text" value="<?php echo $reponse2['ref_dos'];?>" disabled="disabled" style="text-align: center; color: white; background-color: grey;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">N.COD</label>
		            <input type="text" name="cod_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['cod_dos'];?>" style="text-align: left; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">FXI</label>
		            <input type="text" name="fxi_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['fxi'];?>" style="text-align: left; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">MONTANT AV</label>
		            <input type="number" step='0.001' name="montant_av_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['montant_av'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">FOB FACTURE</label>
		            <input type="number" step='0.001' name="fob_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['fob_dos'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">FRET FACTURE</label>
		            <input type="number" step='0.001' name="fret_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['fret_dos'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">ASSURANCE</label>
		            <input type="number" step='0.001' name="assurance_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['assurance_dos'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">AUTRE FRAIS</label>
		            <input type="number" step='0.001' name="autre_frais_<?php echo $reponse2['num_lic'];?>_<?php echo $compteur;?>" value="<?php echo $reponse2['autre_frais_dos'];?>" style="text-align: right; color: white; background-color: black;" class="form-control cc-exp">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">DECLARATION</label>
		            <input type="text" style="text-align: center; color: white; background-color: black;" class="form-control cc-exp"value="<?php echo $reponse2['ref_decl'];?>" disabled="disabled">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">LIQUIDATION</label>
		            <input type="text" style="text-align: center; color: white; background-color: black;" class="form-control cc-exp"value="<?php echo $reponse2['ref_liq'];?>" disabled="disabled">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">QUITTANCE</label>
		            <input type="text" style="text-align: center; color: white; background-color: black;" class="form-control cc-exp"value="<?php echo $reponse2['ref_quit'];?>" disabled="disabled">
		          </div>

		          <div class="col-md-2">
            		<label for="x_card_code" class="control-label mb-1">ETAT</label>
		            <input disabled="" value="<?php echo $apurement;?>" style="text-align: center; color: white; background-color: black;" class="form-control cc-exp">
		          </div>
          			<div class="col-md-12"><hr></div>
			<?php
			}$requete2-> closeCursor();
			?>
	          <input type="hidden" name="nbre" value="<?php echo $compteur;?>">
	        <?php

		}

		public function afficherManipulationLicenceExcel($id_mod_lic, $id_cli, $id_type_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = "";
			$sql2 = "";

			$nbre_dossier = 0;
			$num_lic = '';
			$active_rowspan = 1;
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			$compteur = 0;
			
			if($_SESSION['id_role'] == 1 || $_SESSION['id_role'] == 5){
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							l.fret AS fret,
							l.acheteur AS acheteur,
							l.assurance AS assurance,
							l.autre_frais AS autre_frais,
							l.fsi AS fsi,
							l.aur AS aur,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							DATE(CURRENT_DATE()) AS aujourdhui,
							UPPER(b.nom_banq) AS nom_banq,
							b.id_banq AS id_banq,
							l.ref_fact AS ref_fact,
							l.remarque AS remarque,
							DATE_FORMAT(l.date_fact, '%d/%m/%Y') AS date_fact,
							d.ref_dos AS ref_dos,
							d.id_dos AS id_dos,
							d.fob AS fob_dos,
							d.fret AS fret_dos,
							d.assurance AS assurance_dos,
							d.autre_frais AS autre_frais_dos,
							d.ref_fact AS ref_fact_dos,
							d.date_fact AS date_fact_dos,
							d.ref_decl AS ref_decl,
							d.ref_liq AS ref_liq,
							d.ref_quit AS ref_quit,
							d.montant_decl AS montant_decl,
							d.cod AS cod_dos,
							d.fxi AS fxi,
							l.commodity AS commodityLic,
							d.montant_av AS montant_av,
							d.remarque_lic AS remarque_lic,
							DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit					
						FROM licence l, monnaie m, client cl, banque b, dossier d
						WHERE l.id_mod_lic = ?
							AND l.id_cli = cl.id_cli
							$sql
							$sql2
							AND l.id_mon = m.id_mon
							AND l.id_banq = b.id_banq
							AND l.num_lic = d.num_lic
						ORDER BY l.date_val, l.num_lic DESC";
			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$nbre_dossier = $this-> getNbreDossierLicence($reponse['num_lic']);
				if ($num_lic != $reponse['num_lic']) {
					$num_lic = $reponse['num_lic'];
					$active_rowspan = 1;
				}
				$num_lic = $reponse['num_lic'];
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				$bg = "bg-light";
				$couleur = "";
				
				$style = '';//" style='color: black; background-color: orange;'";
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) ){
					$bg = "bg-dark";
					$style = " style='color: grey;'";
					$couleur = "dark";
				}else if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
					$bg = "bg-success";
					$style = " style='color: green;'";
					$couleur = "success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
					$style = " style='color: red;'";
					$couleur = "danger";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
					$bg = "bg-warning";
					$style = " style='color: orange;'";
					$couleur = "warning";
				}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
					$bg = "bg-danger";
					$style = " style='color: red;'";
					$couleur = "danger";
				} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
					$bg = "bg-info";
					$style = " style='color: blue;'";
					$couleur = "info";
				}
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style=" border-right: 1px solid black;vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<?php

					if ( ($nbre_dossier > 1) && ($num_lic == $reponse['num_lic']) && ($active_rowspan == 1) ) {
						$active_rowspan = 0;
					?>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: left; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['commodityLic'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fret'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['assurance'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob']+$reponse['fret']+$reponse['assurance']+$reponse['autre_frais'], 2, ',', ' ');?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fsi'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['aur'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td rowspan="<?php echo $nbre_dossier;?>" style="vertical-align: middle; text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
					}elseif ( ($nbre_dossier <= 1) && ($num_lic == $reponse['num_lic']) && ($active_rowspan == 1) ){
					?>
					<td style="text-align: left; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $marchandise;?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['sig_mon'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob']+$reponse['fret']+$reponse['assurance']+$reponse['autre_frais'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['fsi'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['aur'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php

					}

					?>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['cod_dos'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['fxi'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['montant_av'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_fact_dos'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_fact_dos'];?></td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob_dos'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['fret_dos'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['assurance_dos'];?>
					</td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['autre_frais_dos'];?>
					</td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['fob_dos']+$reponse['fret_dos']+$reponse['assurance_dos']+$reponse['autre_frais_dos'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_decl'];?></td>
					<td style="text-align: right; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo number_format($reponse['montant_decl'], 2, ',', ' ');?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_liq'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['ref_quit'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;"><?php echo $reponse['date_quit'];?></td>
					<td style="text-align: center; border-left: 1px solid black; border-bottom: 1px solid black;">
						<?php echo $reponse['remarque_lic'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();

			}

		}

		public function afficherLicenceApresRecherche($num_lic, $id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = '%'.$num_lic.'%';

			if($_SESSION['id_role'] == '4'){
				$client = $this-> getClientUtilisateur($_SESSION['id_util']);
				$id_cli = $client['id_cli'];
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							l.assurance AS assurance,
							l.fret AS fret,
							l.acheteur AS acheteur,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							DATE(CURRENT_DATE()) AS aujourdhui
						FROM licence l, monnaie m, client cl
						WHERE l.num_lic LIKE ?
							AND l.id_mod_lic = ?
							AND l.id_mon = m.id_mon
							AND l.id_cli = cl.id_cli
							AND cl.id_cli = $id_cli";
			}else{
				$sql = "SELECT l.num_lic AS num_lic,
							DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
							l.fob AS fob,
							UPPER(cl.nom_cli) AS nom_cli,
							l.fournisseur AS fournisseur,
							l.assurance AS assurance,
							l.fret AS fret,
							l.acheteur AS acheteur,
							m.sig_mon AS sig_mon,
							l.qte_decl AS qte_decl,
							l.fichier_lic AS fichier_lic,
							DATE(CURRENT_DATE()) AS aujourdhui
						FROM licence l, monnaie m, client cl
						WHERE l.num_lic LIKE ?
							AND l.id_mod_lic = ?
							AND l.id_mon = m.id_mon
							AND l.id_cli = cl.id_cli";
			}

			$compteur = 0;

			$requete = $connexion-> prepare($sql);
			$requete-> execute(array($entree['num_lic'], $entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				$bg = "bg-info";
				if( ($date_exp >= $reponse['aujourdhui']) ){
					$bg = "bg-success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
				} 
				
			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="col_1 <?php echo $bg;?>" style=" text-align: left; border: 1px solid black;"><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style="text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $marchandise;?></td>
					<?php
				}
				?>
					<td style="text-align: right;border: 1px solid black;"><?php echo number_format( $reponse['fob'], 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php //echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']*0.6), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']*0.002), 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
					<?php
					}
				?>
					<td style="text-align: center; border: 1px solid black;">
						<a href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherFactureLicenceModele($id_mod_lic, $id_cli, $premiere_entree, $nombre_dossier_par_page, $etat){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$compteur = $premiere_entree;
			$bg = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql2 = ' AND cl.id_cli = '.$id_cli;
			}

			if ($etat == 'Factures sans licence') {
				
				$requete = $connexion-> prepare("SELECT f.ref_fact AS ref_fact,
												DATE_FORMAT(f.date_fact, '%d/%m/%Y') AS date_fact,
												DATE_FORMAT(f.date_fact_rec, '%d/%m/%Y') AS date_fact_rec,
												f.date_fact_rec AS date_fact_rec2,
												DATE_FORMAT(f.date_val, '%d/%m/%Y') AS date_val,
												UPPER(cl.nom_cli) AS nom_cli,
												f.fournisseur AS fournisseur,
												f.fichier_fact AS fichier_fact,
												DATE(CURRENT_DATE()) AS aujourdhui,
												f.commodity AS commodity,
												m.sig_mon AS sig_mon,
												f.montant_fact AS montant_fact,
												f.fret_fact AS fret_fact,
												f.assurance_fact AS assurance_fact,
												f.autre_frais_fact AS autre_frais_fact,
												f.aur AS aur,
												f.fsi AS fsi
											FROM facture_licence f, client cl, monnaie m
											WHERE f.id_mod_lic = ?
												AND f.id_cli = cl.id_cli
												$sql2
												AND f.id_mon = m.id_mon
												AND f.ref_fact NOT IN(
													SELECT f.ref_fact AS ref_fact
													FROM facture_licence f, client cl, monnaie m
													WHERE f.id_cli = cl.id_cli
														$sql2
														AND f.id_mon = m.id_mon
														AND f.ref_fact IN(SELECT ref_fact FROM licence)
													ORDER BY f.date_creat_fact DESC
												)
											ORDER BY f.date_creat_fact DESC
											LIMIT $premiere_entree, $nombre_dossier_par_page");

			}else if ($etat == 'Facture ayant licence') {
				
				$requete = $connexion-> prepare("SELECT f.ref_fact AS ref_fact,
												DATE_FORMAT(f.date_fact, '%d/%m/%Y') AS date_fact,
												DATE_FORMAT(f.date_fact_rec, '%d/%m/%Y') AS date_fact_rec,
												f.date_fact_rec AS date_fact_rec2,
												DATE_FORMAT(f.date_val, '%d/%m/%Y') AS date_val,
												UPPER(cl.nom_cli) AS nom_cli,
												f.fournisseur AS fournisseur,
												f.fichier_fact AS fichier_fact,
												DATE(CURRENT_DATE()) AS aujourdhui,
												f.commodity AS commodity,
												m.sig_mon AS sig_mon,
												f.montant_fact AS montant_fact,
												f.fret_fact AS fret_fact,
												f.assurance_fact AS assurance_fact,
												f.autre_frais_fact AS autre_frais_fact,
												f.aur AS aur,
												f.fsi AS fsi
											FROM facture_licence f, client cl, monnaie m
											WHERE f.id_mod_lic = ?
												AND f.id_cli = cl.id_cli
												$sql2
												AND f.id_mon = m.id_mon
												AND f.ref_fact IN(SELECT ref_fact FROM licence)
											ORDER BY f.date_creat_fact DESC
											LIMIT $premiere_entree, $nombre_dossier_par_page");

			}else{

				$requete = $connexion-> prepare("SELECT f.ref_fact AS ref_fact,
												DATE_FORMAT(f.date_fact, '%d/%m/%Y') AS date_fact,
												DATE_FORMAT(f.date_fact_rec, '%d/%m/%Y') AS date_fact_rec,
												f.date_fact_rec AS date_fact_rec2,
												DATE_FORMAT(f.date_val, '%d/%m/%Y') AS date_val,
												UPPER(cl.nom_cli) AS nom_cli,
												f.fournisseur AS fournisseur,
												f.fichier_fact AS fichier_fact,
												DATE(CURRENT_DATE()) AS aujourdhui,
												f.commodity AS commodity,
												m.sig_mon AS sig_mon,
												f.montant_fact AS montant_fact,
												f.fret_fact AS fret_fact,
												f.assurance_fact AS assurance_fact,
												f.autre_frais_fact AS autre_frais_fact,
												f.aur AS aur,
												f.fsi AS fsi
											FROM facture_licence f, client cl, monnaie m
											WHERE f.id_mod_lic = ?
												AND f.id_cli = cl.id_cli
												$sql2
												AND f.id_mon = m.id_mon
											ORDER BY f.date_creat_fact DESC
											LIMIT $premiere_entree, $nombre_dossier_par_page");

			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = '';
				if ( $this-> getLicenceFacture($reponse['ref_fact']) != null ) {
					$bg = "bg bg-success";
				}else if ( $this-> getDifferenceDate($reponse['aujourdhui'], $reponse['date_fact_rec2']) >= '2' ) {
					$bg = "bg bg-danger";
				}else{
					$bg = "bg bg-light";
				}

			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.75rem; border-top: 1px solid black;" ><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.75rem; border-top: 1px solid black;" ><?php echo $reponse['ref_fact'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $this-> getLicenceFacture($reponse['ref_fact']);?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact_rec']?></td>
					<td class="" style="text-align: center; border: 1px solid black;">
						<?php 

							if ( $this-> getDelaiFactureLicence($reponse['ref_fact']) != null ) {
								echo $this-> getDelaiFactureLicence($reponse['ref_fact']);
							}else{
								echo $this-> getDifferenceDate($reponse['aujourdhui'], $reponse['date_fact_rec2']);
							}
				
						?>
					</td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;">
						<?php echo $reponse['date_val'];?>
					</td>
					<td class="" style="text-align: center; border: 1px solid black;">
						<?php echo $reponse['sig_mon'];?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['montant_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['fret_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['assurance_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['autre_frais_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['montant_fact']+$reponse['fret_fact']+$reponse['assurance_fact']+$reponse['autre_frais_fact'], 2, ',', ' ');?>
					</td>
					<?php
					if ($id_mod_lic == '2') {
					?>
					<td class="" style="text-align: ceter; border: 1px solid black;">
						<?php echo $reponse['fsi'];?>
					</td>
					<td class="" style="text-align: ceter; border: 1px solid black;">
						<?php echo $reponse['aur'];?>
					</td>
					<?php
					}
					?>
					<td style="text-align: center; border: 1px solid black; background-color: white;">
						<button class="btn btn-default" onclick="window.open('../factures/<?php echo $reponse['ref_fact'];?>/<?php echo $reponse['fichier_fact'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</button>
					</td>
					<td style="background-color: white; border: 1px solid black;">
						<form method="POST" action="">
							<input type="hidden" name="ref_fact_old" value="<?php echo $reponse['ref_fact'];?>">
							<center>
								<button class="btn btn-warning" type="submit" name="modifier">
									<i class="fa fa-edit"></i>
								</button>
							</center>
						</form>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherFactureLicenceModeleRecherche($id_mod_lic, $id_cli, $ref_fact){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_fact'] = $ref_fact;
			$compteur = 0;
			$bg = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql2 = ' AND cl.id_cli = '.$id_cli;
			}

			$requete = $connexion-> prepare("SELECT f.ref_fact AS ref_fact,
										DATE_FORMAT(f.date_fact, '%d/%m/%Y') AS date_fact,
										DATE_FORMAT(f.date_fact_rec, '%d/%m/%Y') AS date_fact_rec,
										f.date_fact_rec AS date_fact_rec2,
										DATE_FORMAT(f.date_val, '%d/%m/%Y') AS date_val,
										UPPER(cl.nom_cli) AS nom_cli,
										f.fournisseur AS fournisseur,
										f.fichier_fact AS fichier_fact,
										DATE(CURRENT_DATE()) AS aujourdhui,
										f.commodity AS commodity,
										m.sig_mon AS sig_mon,
										f.montant_fact AS montant_fact,
										f.fret_fact AS fret_fact,
										f.assurance_fact AS assurance_fact,
										f.autre_frais_fact AS autre_frais_fact,
										f.fsi AS fsi, f.aur AS aur
									FROM facture_licence f, client cl, monnaie m
									WHERE (f.ref_fact = ?
											OR f.ref_fact IN (
												SELECT ref_fact FROM licence WHERE num_lic = ?
											))
										AND f.id_mod_lic = ?
										AND f.id_cli = cl.id_cli
										$sql2
										AND f.id_mon = m.id_mon
									ORDER BY f.date_creat_fact DESC");
			$requete-> execute(array($entree['ref_fact'], $entree['ref_fact'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = '';
				if ( $this-> getLicenceFacture($reponse['ref_fact']) != null ) {
					$bg = "bg bg-success";
				}else if ( $this-> getDifferenceDate($reponse['aujourdhui'], $reponse['date_fact_rec2']) >= '2' ) {
					$bg = "bg bg-danger";
				}else{
					$bg = "bg bg-light";
				}

			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.75rem; border-top: 1px solid black;" ><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.75rem; border-top: 1px solid black;" ><?php echo $reponse['ref_fact'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $this-> getLicenceFacture($reponse['ref_fact']);?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['date_fact_rec']?></td>
					<td class="" style="text-align: center; border: 1px solid black;">
						<?php 

							if ( $this-> getDelaiFactureLicence($reponse['ref_fact']) != null ) {
								echo $this-> getDelaiFactureLicence($reponse['ref_fact']);
							}else{
								echo $this-> getDifferenceDate($reponse['aujourdhui'], $reponse['date_fact_rec2']);
							}
				
						?>
					</td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;">
						<?php echo $reponse['date_val'];?>
					</td>
					<td class="" style="text-align: center; border: 1px solid black;">
						<?php echo $reponse['sig_mon'];?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['montant_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['fret_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['assurance_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['autre_frais_fact'], 2, ',', ' ');?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format($reponse['montant_fact']+$reponse['fret_fact']+$reponse['assurance_fact']+$reponse['autre_frais_fact'], 2, ',', ' ');?>
					</td>
					<?php
					if ($id_mod_lic == '2') {
					?>
					<td class="" style="text-align: ceter; border: 1px solid black;">
						<?php echo $reponse['fsi'];?>
					</td>
					<td class="" style="text-align: ceter; border: 1px solid black;">
						<?php echo $reponse['aur'];?>
					</td>
					<?php
					}
					?>
					<td style="text-align: center; border: 1px solid black; background-color: white;">
						<button class="btn btn-default" onclick="window.open('../factures/<?php echo $reponse['ref_fact'];?>/<?php echo $reponse['fichier_fact'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</button>
					</td>
					<td style="background-color: white; border: 1px solid black;">
						<form method="POST" action="">
							<input type="hidden" name="ref_fact_old" value="<?php echo $reponse['ref_fact'];?>">
							<center>
								<button class="btn btn-warning" type="submit" name="modifier">
									<i class="fa fa-edit"></i>
								</button>
							</center>
						</form>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<td style=""><hr></td>
			</tr>
			<?php
		}

		public function afficherAV($id_mod_lic, $id_cli){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$compteur = 0;
			$bg = '';

			$requete = $connexion-> prepare("SELECT a.cod AS cod, DATE_FORMAT(a.date_av, '%d/%m/%Y') AS date_av,
													a.fxi AS fxi, a.montant_av AS montant_av, 
													a.fichier_av AS fichier_av, m.sig_mon AS sig_mon,
													a.num_lic AS num_lic,
													REPLACE(REPLACE(cod, ' ', '_'), '-', '_') AS cod_2
												FROM av a, monnaie m, licence l
												WHERE a.id_mon = m.id_mon
													AND a.num_lic = l.num_lic
													AND l.id_cli = ?
												ORDER BY a.date_creat DESC");
			$requete-> execute(array($entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = '';
				if ( $reponse['montant_av'] == $this-> getFobDossierAv($reponse['cod']) ) {
					$bg = "text text-success";
				}else if ( $reponse['montant_av'] < $this-> getFobDossierAv($reponse['cod']) ) {
					$bg = "text text-danger";
				}else {
					$bg = "";
				}
			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="" style=" text-align: left; border: 1px solid black;"><?php echo $compteur;?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['cod'];?></td>
					<td class="" style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_av'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['fxi']?></td>
					<td class="" style="text-align: left; border: 1px solid black;"><?php echo $reponse['sig_mon']?></td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format( $reponse['montant_av'], 2, ',', ' ');;?>
					</td>
					<td style="text-align: center;text-align: center; border: 1px solid black;">
						<button class="btn-xs btn-info" onclick="window.open('popUpDossierAv.php?cod_2=<?php echo $reponse['cod_2'];?>&id_cli=<?php echo $id_cli;?>&cod=<?php echo $reponse['cod'];?>','pop1','width=1000,height=800');"><i class="fa fa-eye"></i></button>
					</td>
					<td class="" style="text-align: center; border: 1px solid black;"><?php echo $this-> getNombreDossierAv($reponse['cod']);?></td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format( $this-> getFobDossierAv($reponse['cod']), 2, ',', ' ');;?>
					</td>
					<td class="" style="text-align: right; border: 1px solid black;">
						<?php echo number_format( ($reponse['montant_av'] - $this-> getFobDossierAv($reponse['cod'])), 2, ',', ' ');;?>
					</td>
					<td style="text-align: center; border: 1px solid black;">
						<a href="#" style="color: black;" onclick="window.open('../av/<?php echo $reponse['fichier_av'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherLicenceApresRechercheClient($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
													DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val,
													l.fob AS fob,
													l.assurance AS assurance,
													l.fret AS fret,
													UPPER(cl.nom_cli) AS nom_cli,
													l.fournisseur AS fournisseur,
													m.sig_mon AS sig_mon,
													l.qte_decl AS qte_decl,
													l.acheteur AS acheteur,
													l.fichier_lic AS fichier_lic,
													DATE(CURRENT_DATE()) AS aujourdhui
												FROM licence l, monnaie m, client cl
												WHERE l.id_cli = ?
													AND l.id_mod_lic = ?
													AND l.id_mon = m.id_mon
													AND l.id_cli = cl.id_cli");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				
				$bg = "bg-info";
				if( ($date_exp >= $reponse['aujourdhui']) ){
					$bg = "bg-success";
				}else if($date_exp < $reponse['aujourdhui']){
					$bg = "bg-danger";
				} 
				
			?>
				<tr class="<?php echo $bg;?>" style="">
					<td class="col_1 <?php echo $bg;?>" style=" text-align: left; border: 1px solid black;"><?php echo $compteur;?></td>
					<td class="col_6 <?php echo $bg;?>" style="text-align: left; border: 1px solid black;"><?php echo $reponse['num_lic'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $reponse['date_val'];?></td>
					<td style="text-align: center; border: 1px solid black;"><?php echo $this-> getLastEpirationLicence($reponse['num_lic']);?></td>
					<?php
				if($id_mod_lic == '1'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['acheteur'];?></td>
					<?php
				}
				if($id_mod_lic == '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<?php
				}
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<td style="text-align: left; border: 1px solid black;"><?php echo $reponse['fournisseur'];?></td>
					<?php
				}
				if($id_mod_lic != '3'){
					?>
					<td style="text-align: left; border: 1px solid black;"><?php echo $marchandise;?></td>
					<?php
				}
				?>
					<td style="text-align: right;border: 1px solid black;"><?php echo number_format( $reponse['fob'], 2, ',', ' ').' '.$reponse['sig_mon'];?></td>
				<?php
				if($id_mod_lic == '2'){
					?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['assurance'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['fret'], 2, ',', ' ');?></td>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( ($reponse['fob']+$reponse['assurance']+$reponse['fret']), 2, ',', ' ');?></td>
					<?php
				}
				?>
				<?php
				if($id_mod_lic == '1'){
				?>
					<td style="text-align: right; border: 1px solid black;"><?php echo number_format( $reponse['qte_decl'], 2, ',', ' ');?></td>
					<?php
					}
				?>
					<td style="text-align: center; border: 1px solid black;">
						<a href="#" style="color: black;" onclick="window.open('../dossiers/<?php echo $reponse['num_lic'];?>/<?php echo $reponse['fichier_lic'];?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i>
						</a>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossier($id_march, $id_cli, $id_mod_trans){
			include('connexion.php');

			$entree['id_march'] = $id_march;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND cl.id_cli = '.$id_cli;
			} 
			if( ($id_mod_trans != null) && ($id_mod_trans != '')){
				$sql2 = ' AND d.id_mod_trans = '.$id_mod_trans;
			} 

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.fournisseur AS fournisseur,
													l.num_lic AS num_lic,
													l.fob AS fob,
													l.tonnage AS tonnage,
													UPPER(m.nom_march) AS nom_march,
													s.nom_site AS nom_site
												FROM dossier d, client cl, marchandise m, licence l, site s
												WHERE d.id_march = ?
													AND d.id_march =  m.id_march
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													$sql2
													$sql
													AND d.id_cli =  cl.id_cli
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_march']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "bg-light";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<?php
						if ($this-> getStructureTracking($id_march) == '1') {
							include('acidRow.php');
						}else if ($this-> getStructureTracking($id_march) == '2') {
							include('diversRow.php');
						}
					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
						<select name="cleared_<?php echo $compteur;?>" class="control-form">
							<?php 
							if ($reponse['cleared'] == '1') {
							?>
							<option>CLEARED</option>
							<option value="0">TRANSIT</option>
							<option value="2">CANCELED</option>
							<?php
							}if ($reponse['cleared'] == '2') {
							?>
							<option>CANCELED</option>
							<option value="1">CLEARED</option>
							<option value="0">TRANSIT</option>
							<?php
							}if ($reponse['cleared'] == '0') {
							?>
							<option>TRANSIT</option>
							<option value="1">CLEARED</option>
							<option value="2">CANCELED</option>
							<?php
							}
							?>
						</select>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherDossierClientModeTransportModeLicence($id_cli, $id_mod_trans, $id_mod_lic, $num_lic, $premiere_entree, $nombre_dossier_par_page){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.fournisseur AS fournisseur,
													l.num_lic AS num_lic,
													l.commodity AS commodity,
													l.fob AS fob,
													l.tonnage AS tonnage,
													s.nom_site AS nom_site
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND l.num_lic = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.id_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['num_lic'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "bg-light";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['nom_cli'];?></td>
					<?php
						if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}
					?>
					<td class=" <?php echo $bg;?>" style="border: 1px solid black;">
						<select name="cleared_<?php echo $compteur;?>" class="control-form">
							<?php 
							if ($reponse['cleared'] == '1') {
							?>
							<option>CLEARED</option>
							<option value="0">TRANSIT</option>
							<option value="2">CANCELED</option>
							<?php
							}if ($reponse['cleared'] == '2') {
							?>
							<option>CANCELED</option>
							<option value="1">CLEARED</option>
							<option value="0">TRANSIT</option>
							<?php
							}if ($reponse['cleared'] == '0') {
							?>
							<option>TRANSIT</option>
							<option value="1">CLEARED</option>
							<option value="2">CANCELED</option>
							<?php
							}
							?>
						</select>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherDossierClientModeTransportModeLicence2($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, 
														$premiere_entree, $nombre_dossier_par_page){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.num_lic AS num_lic,
													l.fournisseur AS fournisseur,
													l.fob AS fob,
													l.tonnage AS tonnage,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay,
													IF(d.cleared IS NULL OR d.cleared='', '0', d.cleared) AS cleared,
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND ((d.date_quit IS NULL AND d.ref_quit IS NULL) 
														OR (d.date_quit = '' OR d.ref_quit = ''))
													$sql1
												ORDER BY d.ref_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<?php
						if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicence2($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity,
														$premiere_entree, $nombre_dossier_par_page, 
														$id_march=NULL, $statut=NULL, $num_lic=NULL, 
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			if ($id_mod_lic == '1') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '857') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '850') {
				$sqlOrder = ' ORDER BY d.ref_dos DESC';
			}else if ($id_mod_lic == '2') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND REPLACE(d.statut,"\'", " ") = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}else if ($id_mod_lic == '2' && $id_cli == '857') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '850') {
				$sqlOrder = ' ORDER BY d.ref_dos DESC';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}


				  if (isset($_GET['page'])) {
				    $page = '&page='.$_GET['page'];
				  }else{
				    $page = '&page=1';
				  }

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,


													IF(d.id_mod_lic='2' AND d.id_mod_trans='1',
														IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													      'AWAITING CRF/AD/INSURANCE',
													      IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													        'AWAITING CRF/AD',
													          IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													            'AWAITING CRF/INSURANCE',
													            IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NOT NULL,
													              'AWAITING CRF', 
													              IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													                'AWAITING AD/INSURANCE',
													                IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													                  'AWAITING AD',
													                    IF(d.date_crf IS NOT NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													                      'AWAITING INSURANCE',

													                      IF(d.date_decl IS NULL AND d.ref_decl IS NULL, 'UNDER PREPARATION',
													                        IF(d.date_liq IS NULL AND d.ref_liq IS NULL, 'AWAITING LIQUIDATION',
													                          IF(d.date_quit IS NULL AND d.ref_quit IS NULL, 'AWAITING QUITTANCE',
													                            IF(d.date_quit IS NOT NULL AND d.ref_quit IS NOT NULL AND d.dgda_out IS NULL, 'AWAITING BAE/BS', 
													                              IF(d.dgda_out IS NOT NULL AND d.dispatch_deliv IS NOT NULL, 'CLEARING COMPLETED', '')
													                              )
													                            )
													                          )
													                        )
													                      
													                      )
													                  )
													                )
													              )
													            )
													          )
													      )
														,
														IF(d.id_mod_lic='1', 
															IF(d.load_date IS NOT NULL AND d.ceec_in IS NULL,
																'LOADED',
																IF(d.ceec_in IS NOT NULL AND d.ceec_out IS NULL, 'AT CEEC',
																	IF(d.ceec_out IS NOT NULL AND d.min_div_in IS NULL, 'CEEC OUT',
																		IF(d.min_div_in IS NOT NULL AND d.min_div_out IS NULL, 'AT MINE DIVISION',
																			IF(d.min_div_out IS NOT NULL AND d.ref_decl IS NULL, 'MINE DIVISION OUT',
																				IF(d.ref_decl IS NOT NULL AND d.ref_liq IS NULL, 'DECLARATION',
																					IF(d.ref_liq IS NOT NULL AND d.ref_quit IS NULL, 'LIQUIDATED',
																						IF(d.ref_quit IS NOT NULL AND d.gov_in IS  NULL, 'DGDA OUT',
																							IF(d.gov_in IS NOT NULL AND d.gov_out IS NULL, 'AT GOVERNOR\'S OFFICE',
																								IF(d.gov_out IS NOT NULL AND d.dispatch_date IS NULL, 'GOVERNOR\'S OFFICE OUT',
																									IF(d.dispatch_date IS NOT NULL AND d.klsa_arriv IS NULL,
																										'DISPATCHED', 
																											IF(d.klsa_arriv IS NOT NULL AND d.end_form IS NULL, 'AT BORDER',
																												IF(d.end_form IS NOT NULL AND d.exit_drc IS NULL, 'UNDER FORMALITIES',
																													IF(d.exit_drc IS NOT NULL, 'EXIT DRC', '')
																													)
																												)
																										)
																									)
																								)
																							)
																						)
																					)
																				)
																			)
																		)
																	)
																)
															, d.statut )
													) AS statut,

													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.klsa_arriv IS NOT NULL AND d.wiski_arriv IS NULL,'ARRIVED AT K\'LSA', 
															IF(d.wiski_arriv IS NOT NULL AND d.dispatch_klsa IS NULL, 'AT WISKI',
																IF(d.dispatch_klsa IS NOT NULL, 'DISPATCHED FROM K\'LSA', 'EXCEPTED TO ARRIVE')
																)
															)
														, '') AS klsa_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='LUBUMBASHI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM AMICONGO', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT AMICONGO', '')
																)
															,'')
														,'') AS amicongo_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='KOLWEZI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM WAREHOUSE', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT WAREHOUSE', '')
																)
															,'')
														,'') AS kzi_status,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												$sqlOrder
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$index++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "";
					$class = "";
				}

				if (($this-> verifierErreurDateKlsa($reponse['id_dos']) == true) || ($this-> verifierDelaiDateKlsa($reponse['id_dos']) == true)) {
					$clignoteDos = ' clignoteb';
					$couleurDos = ' color: rgb(255,69,0);';
				}else{
					$clignoteDos = '';
					$couleurDos = '';
				}

				if (empty($this-> getSouscriptionLicence($reponse['num_lic'])) && ($this-> verifierSouscriptionLicence($id_cli, $id_mod_lic) == true) && ($reponse['num_lic'] != 'UNDER VALUE')) {
					$clignoteDos = ' clignoteb';
					$couleurDos = ' color: rgb(0,0,0);';
				}else{
					$clignoteDos = '';
					$couleurDos = '';
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDeleteDossier.php');
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><span class="<?php echo $clignoteDos;?>" style="<?php echo $couleurDos?>"><?php echo $reponse['ref_dos'];?></span>
					 <?php 
					  if(!isset($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'])){
					  	if($this-> getDossierFacture2($reponse['id_dos'])==false){
					  ?>
						<span title="Edit File" onclick="window.location.replace('editFile.php?id_cli=<?php echo $_GET['id_cli']; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>&id_mod_trac=<?php echo $_GET['id_mod_trac']; ?>&commodity=<?php echo $_GET['commodity']; ?>&statut=<?php echo $_GET['statut'];?>&id_march=<?php echo $_GET['id_march'];?>&page=<?php echo $page;?>&id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=80,height=80');">&nbsp;&nbsp;&nbsp;<i class="fa fa-edit bg bg-warning" style="padding: 3px; border-radius: 5px;"></i></span>

						<?php
					}
						if ($reponse['cleared'] != '2') {
							if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_delete'] == '1' && ($index == '1' && $premiere_entree == '0')) {
							?>
							<span title="Delete File" onclick="window.location.replace('deleteFile.php?id_cli=<?php echo $_GET['id_cli']; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>&id_mod_trac=<?php echo $_GET['id_mod_trac']; ?>&commodity=<?php echo $_GET['commodity']; ?>&statut=<?php echo $_GET['statut'];?>&id_march=<?php echo $_GET['id_march'];?>&id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=80,height=80');">
			                    <i class="fa fa-times bg bg-danger" style="padding: 3px; border-radius: 5px;"></i>
			                </span>
			                <?php
							}
						}

						if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_log'] == '1') {
						?>
					  	<span title="Historique du dossier" onclick="window.open('popUpLogFile.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=900,height=950');">
					  		<i class="fa fa-history bg bg-dark"  style="padding: 3px; border-radius: 5px;" aria-hidden="true"></i>
	                	</span>
		                <?php
						}
					
						
					
					  }
					  ?>
					</td>
					<td style="text-align: center;">
						<span class="btn-xs bg-purple dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                        	<a class="dropdown-item sm" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');">
								<i class="fa fa-plus"></i> Ajouter
							</a>
							<hr>
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </span>
					</td>
					<?php
					$this-> afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $reponse['statut'], $reponse['klsa_status'], $reponse['amicongo_status'], $reponse['kzi_status']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicence2_($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity,
														$premiere_entree, $nombre_dossier_par_page, 
														$id_march=NULL, $statut=NULL, $num_lic=NULL, 
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			if ($id_mod_lic == '1') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '857') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '850') {
				$sqlOrder = ' ORDER BY d.ref_dos DESC';
			}else if ($id_mod_lic == '2') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND REPLACE(d.statut,"\'", " ") = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}else if ($id_mod_lic == '2' && $id_cli == '857') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '850') {
				$sqlOrder = ' ORDER BY d.ref_dos DESC';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}


				  if (isset($_GET['page'])) {
				    $page = '&page='.$_GET['page'];
				  }else{
				    $page = '&page=1';
				  }

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,


													IF(d.id_mod_lic='2' AND d.id_mod_trans='1',
														IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													      'AWAITING CRF/AD/INSURANCE',
													      IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													        'AWAITING CRF/AD',
													          IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													            'AWAITING CRF/INSURANCE',
													            IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NOT NULL,
													              'AWAITING CRF', 
													              IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													                'AWAITING AD/INSURANCE',
													                IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													                  'AWAITING AD',
													                    IF(d.date_crf IS NOT NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													                      'AWAITING INSURANCE',

													                      IF(d.date_decl IS NULL AND d.ref_decl IS NULL, 'UNDER PREPARATION',
													                        IF(d.date_liq IS NULL AND d.ref_liq IS NULL, 'AWAITING LIQUIDATION',
													                          IF(d.date_quit IS NULL AND d.ref_quit IS NULL, 'AWAITING QUITTANCE',
													                            IF(d.date_quit IS NOT NULL AND d.ref_quit IS NOT NULL AND d.dgda_out IS NULL, 'AWAITING BAE/BS', 
													                              IF(d.dgda_out IS NOT NULL AND d.dispatch_deliv IS NOT NULL, 'CLEARING COMPLETED', '')
													                              )
													                            )
													                          )
													                        )
													                      
													                      )
													                  )
													                )
													              )
													            )
													          )
													      )
														,
														d.statut) AS statut,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.klsa_arriv IS NOT NULL AND d.wiski_arriv IS NULL,'ARRIVED AT K\'LSA', 
															IF(d.wiski_arriv IS NOT NULL AND d.dispatch_klsa IS NULL, 'AT WISKI',
																IF(d.dispatch_klsa IS NOT NULL, 'DISPATCHED FROM K\'LSA', 'EXCEPTED TO ARRIVE')
																)
															)
														, '') AS klsa_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='LUBUMBASHI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM AMICONGO', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT AMICONGO', '')
																)
															,'')
														,'') AS amicongo_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='KOLWEZI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM WAREHOUSE', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT WAREHOUSE', '')
																)
															,'')
														,'') AS kzi_status,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												$sqlOrder
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$index++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "";
					$class = "";
				}

				if (($this-> verifierErreurDateKlsa($reponse['id_dos']) == true) || ($this-> verifierDelaiDateKlsa($reponse['id_dos']) == true)) {
					$clignoteDos = ' clignoteb';
					$couleurDos = ' color: rgb(255,69,0);';
				}else{
					$clignoteDos = '';
					$couleurDos = '';
				}

				if (empty($this-> getSouscriptionLicence($reponse['num_lic'])) && ($this-> verifierSouscriptionLicence($id_cli, $id_mod_lic) == true) && ($reponse['num_lic'] != 'UNDER VALUE')) {
					$clignoteDos = ' clignoteb';
					$couleurDos = ' color: rgb(0,0,0);';
				}else{
					$clignoteDos = '';
					$couleurDos = '';
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDeleteDossier.php');
				
			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style="" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" <?php echo $color;?>"><span class="<?php echo $clignoteDos;?>" style="<?php echo $couleurDos?>"><?php echo $reponse['ref_dos'];?></span>
					 <?php 
					  if(!isset($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'])){
					  ?>
						<span title="Edit File" onclick="window.location.replace('editFile.php?id_cli=<?php echo $_GET['id_cli']; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>&id_mod_trac=<?php echo $_GET['id_mod_trac']; ?>&commodity=<?php echo $_GET['commodity']; ?>&statut=<?php echo $_GET['statut'];?>&id_march=<?php echo $_GET['id_march'];?>&page=<?php echo $page;?>&id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=80,height=80');">&nbsp;&nbsp;&nbsp;<i class="fa fa-edit bg bg-warning" style="padding: 3px; border-radius: 5px;"></i></span>
						<?php
						if ($reponse['cleared'] != '2') {
							if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_delete'] == '1' && ($index == '1' && $premiere_entree == '0')) {
							?>
							<span title="Delete File" onclick="window.location.replace('deleteFile.php?id_cli=<?php echo $_GET['id_cli']; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>&id_mod_trac=<?php echo $_GET['id_mod_trac']; ?>&commodity=<?php echo $_GET['commodity']; ?>&statut=<?php echo $_GET['statut'];?>&id_march=<?php echo $_GET['id_march'];?>&id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=80,height=80');">
			                    <i class="fa fa-times bg bg-danger" style="padding: 3px; border-radius: 5px;"></i>
			                </span>
			                <?php
							}
						}

						if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_log'] == '1') {
						?>
					  	<span title="Historique du dossier" onclick="window.open('popUpLogFile.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=900,height=950');">
					  		<i class="fa fa-history bg bg-dark"  style="padding: 3px; border-radius: 5px;" aria-hidden="true"></i>
	                	</span>
		                <?php
						}
					
						
					
					  }
					  ?>
					</td>
					<td style="text-align: center;">
						<span class="btn-xs bg-purple dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                        	<a class="dropdown-item sm" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');">
								<i class="fa fa-plus"></i> Ajouter
							</a>
							<hr>
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </span>
					</td>
					<td style="text-align: center;">
						<a href="#" class="date_preal" id="date_preal_<?php echo $reponse['id_dos'];?>" data-type="text" date-pk="<?php echo $reponse['id_dos'];?>" data-url="process.php" data-name="date_preal">
							<?php echo $reponse['date_preal'];?>
						</a>
					</td>
					<td style="text-align: center;">
						<a href="#" class="ref_fact" id="ref_fact_<?php echo $reponse['id_dos'];?>" data-type="text" date-pk="<?php echo $reponse['id_dos'];?>" data-url="process.php" data-name="ref_fact" style="color: black;">
							<?php echo $reponse['ref_fact'];?>
						</a>
					</td>
					<?php
					//$this-> afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $reponse['statut'], $reponse['klsa_status'], $reponse['amicongo_status'], $reponse['kzi_status']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<?php
		}

		public function afficherDocumentDossierBackUp($id_mod_lic, $id_dos){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				if($this-> getDocumentForDossier($id_dos, $reponse['id_doc']) == '0'){
					?>

		            <div class="col-md-4">
		            	<input type="hidden" name="id_doc_<?php echo $compteur;?>" value="<?php echo $reponse['id_doc'];?>">
		              <label for="x_card_code" class="control-label mb-1"><?php echo $reponse['nom_doc'];?></label>
		              <input type="file" name="fichier_<?php echo $compteur;?>" class="form-control cc-exp">
		            </div>

					<?php
				}else{
					$num_dos = $this-> getDossier($id_dos)['ref_dos'];
						
					if(stristr($num_dos, '/') == true) {
						$num_dos = str_replace("/", "_", "$num_dos");
					}
					
					$piece = $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);
					?>
		            <div class="col-md-4">
							<br>
		            	<!--<label for="x_card_code" class="control-label mb-1"><?php echo $reponse['nom_doc'];?></label>-->
						<span class="bg bg-dark" style="padding: 5px; border-radius: 5px;" onclick="window.open('../documents/<?php echo $num_dos;?>/<?php echo $piece;?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
						</span>
					</div>
					<?php
				}

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherDocumentDossier($id_mod_lic, $id_dos){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				?>
				<tr>
					<td>
						<?php 
						echo $compteur;
						?>
					</td>
					<td>
					<?php 
						echo $reponse['nom_doc'];
					?>
					</td>
					<td>
					<?php
					if($this-> getDocumentForDossier($id_dos, $reponse['id_doc']) != '0'){
						?>
			            <span class="bg bg-dark" style="padding: 5px; border-radius: 5px;" onclick="window.open('../documents/<?php echo $this-> getDossier($id_dos)['ref_dos'];?>/<?php echo $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);?>','pop1','width=700,height=900');">
							<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
						</span>
						<?php
					}
					?>
					</td>
					<td>
		            	<input type="hidden" name="id_doc_<?php echo $compteur;?>" value="<?php echo $reponse['id_doc'];?>">
						<input type="file" name="fichier_<?php echo $compteur;?>" class="form-control form-control-sm cc-exp">
					</td>
				</tr>
				<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function getDocumentForDossier($id_dos, $id_doc){
			$entree['id_dos'] = $id_dos;
			$entree['id_doc'] = $id_doc;
			include('connexion.php');

			$requete = $connexion-> prepare("SELECT *
												FROM dossier_document
												WHERE id_dos = ?
													AND id_doc = ?");
			$requete-> execute(array($entree['id_dos'], $entree['id_doc']));

			$reponse = $requete-> fetch();

			if(!empty($reponse)){
				return $reponse['piece'];
			}else{
				return 0;
			}
		}

		public function getPartielleCOD($cod){
			$entree['cod'] = $cod;
			// $entree['id_doc'] = $id_doc;
			include('connexion.php');

			$requete = $connexion-> prepare("SELECT SUM(fob) AS fob, SUM(poids) AS poids
												FROM partielle_av
												WHERE cod = ?");
			$requete-> execute(array($entree['cod']));

			$reponse = $requete-> fetch();

			if(!empty($reponse)){
				return $reponse;
			}else{
				return 0;
			}
		}

		public function getPartielleCRF($cod){
			$entree['cod'] = $cod;
			// $entree['id_doc'] = $id_doc;
			include('connexion.php');

			$requete = $connexion-> prepare("SELECT *
												FROM partielle_av
												WHERE CONCAT(cod,num_part) = ?");
			$requete-> execute(array($entree['cod']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function getPartielleID($id_part){
			$entree['id_part'] = $id_part;
			// $entree['id_doc'] = $id_doc;
			include('connexion.php');

			// $requete = $connexion-> prepare("SELECT *
			// 									FROM partielle_av, licence
			// 									WHERE partielle_av.id_part = ?
			// 										AND partielle_av.cod = licence.cod");
			$requete = $connexion-> prepare("SELECT *
												FROM partielle_av
												WHERE partielle_av.id_part = ?");
			$requete-> execute(array($entree['id_part']));

			$reponse = $requete-> fetch();

			if(!empty($reponse)){
				return $reponse;
			}else{
				return 0;
			}
		}

		public function getListeDocumentForDossier($id_dos, $id_mod_lic){
			
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;
			$requete = $connexion-> prepare("SELECT d.*
											FROM document d, affectation_document_modele_licence af, modele_licence m
											WHERE d.id_doc = af.id_doc
												AND af.active = '1'
												AND af.id_mod_lic = m.id_mod_lic
												AND m.id_mod_lic = ?
											ORDER BY af.rang");
			$requete-> execute(array($entree['id_mod_lic']));


			while($reponse = $requete-> fetch()){
				$compteur++;
				if($this-> getDocumentForDossier($id_dos, $reponse['id_doc']) == '0'){
					
				}else{
					$num_dos = $this-> getDossier($id_dos)['ref_dos'];
						
					if(stristr($num_dos, '/') == true) {
						$num_dos = str_replace("/", "_", "$num_dos");
					}
					
					$piece = $this-> getDocumentForDossier($id_dos, $reponse['id_doc']);
					?>
					<a class="dropdown-item" onclick="window.open('../documents/<?php echo $num_dos;?>/<?php echo $piece;?>','pop1','width=700,height=900');">
						<i class="fa fa-file"></i> <?php echo $reponse['nom_doc'];?>
					</a>
					<?php
				}

			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicence2Recherche($ref_dos, $id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity,
														$id_march=NULL, $statut=NULL, $num_lic=NULL, 
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['ref_dos'] = $ref_dos;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$index = 0;
			if ($id_cli == 869 && $_GET['id_march'] == 11) {
				$entree['id_cli'] = 883;
			}else{
				$entree['id_cli'] = $id_cli;
			}
			
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			if ($id_mod_lic == '1') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '857') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2') {
				$sqlOrder = ' ORDER BY d.ref_dos DESC';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND REPLACE(d.statut,"\'", " ") = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

				  if (isset($_GET['page'])) {
				    $page = '&page='.$_GET['page'];
				  }else{
				    $page = '&page=1';
				  }

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,

													
													IF(d.id_mod_lic='2' AND d.id_mod_trans='1',
														IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													      'AWAITING CRF/AD/INSURANCE',
													      IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													        'AWAITING CRF/AD',
													          IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													            'AWAITING CRF/INSURANCE',
													            IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NOT NULL,
													              'AWAITING CRF', 
													              IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													                'AWAITING AD/INSURANCE',
													                IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													                  'AWAITING AD',
													                    IF(d.date_crf IS NOT NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													                      'AWAITING INSURANCE',

													                      IF(d.date_decl IS NULL AND d.ref_decl IS NULL, 'UNDER PREPARATION',
													                        IF(d.date_liq IS NULL AND d.ref_liq IS NULL, 'AWAITING LIQUIDATION',
													                          IF(d.date_quit IS NULL AND d.ref_quit IS NULL, 'AWAITING QUITTANCE',
													                            IF(d.date_quit IS NOT NULL AND d.ref_quit IS NOT NULL AND d.dgda_out IS NULL, 'AWAITING BAE/BS', 
													                              IF(d.dgda_out IS NOT NULL AND d.dispatch_deliv IS NOT NULL, 'CLEARING COMPLETED', '')
													                              )
													                            )
													                          )
													                        )
													                      
													                      )
													                  )
													                )
													              )
													            )
													          )
													      )
														,
														IF(d.id_mod_lic='1', 
															IF(d.load_date IS NOT NULL AND d.ceec_in IS NULL,
																'LOADED',
																IF(d.ceec_in IS NOT NULL AND d.ceec_out IS NULL, 'AT CEEC',
																	IF(d.ceec_out IS NOT NULL AND d.min_div_in IS NULL, 'CEEC OUT',
																		IF(d.min_div_in IS NOT NULL AND d.min_div_out IS NULL, 'AT MINE DIVISION',
																			IF(d.min_div_out IS NOT NULL AND d.ref_decl IS NULL, 'MINE DIVISION OUT',
																				IF(d.ref_decl IS NOT NULL AND d.ref_liq IS NULL, 'DECLARATION',
																					IF(d.ref_liq IS NOT NULL AND d.ref_quit IS NULL, 'LIQUIDATED',
																						IF(d.ref_quit IS NOT NULL AND d.gov_in IS  NULL, 'DGDA OUT',
																							IF(d.gov_in IS NOT NULL AND d.gov_out IS NULL, 'AT GOVERNOR\'S OFFICE',
																								IF(d.gov_out IS NOT NULL AND d.dispatch_date IS NULL, 'GOVERNOR\'S OFFICE OUT',
																									IF(d.dispatch_date IS NOT NULL AND d.klsa_arriv IS NULL,
																										'DISPATCHED', 
																											IF(d.klsa_arriv IS NOT NULL AND d.end_form IS NULL, 'AT BORDER',
																												IF(d.end_form IS NOT NULL AND d.exit_drc IS NULL, 'UNDER FORMALITIES',
																													IF(d.exit_drc IS NOT NULL, 'EXIT DRC', '')
																													)
																												)
																										)
																									)
																								)
																							)
																						)
																					)
																				)
																			)
																		)
																	)
																)
															, d.statut )
													) AS statut,

													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.klsa_arriv IS NOT NULL AND d.wiski_arriv IS NULL,'ARRIVED AT K\'LSA', 
															IF(d.wiski_arriv IS NOT NULL AND d.dispatch_klsa IS NULL, 'AT WISKI',
																IF(d.dispatch_klsa IS NOT NULL, 'DISPATCHED FROM K\'LSA', 'EXCEPTED TO ARRIVE')
																)
															)
														, '') AS klsa_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='LUBUMBASHI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM AMICONGO', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT AMICONGO', '')
																)
															,'')
														,'') AS amicongo_status,
													IF(d.id_mod_trans='1' AND d.id_mod_lic='2', 
														IF(d.bond_warehouse='KOLWEZI',
															IF(d.warehouse_arriv IS NOT NULL AND d.warehouse_dep IS NOT NULL, 'DISPATCHED FROM WAREHOUSE', 
																IF(d.warehouse_arriv IS NOT NULL, 'ARRIVED AT WAREHOUSE', '')
																)
															,'')
														,'') AS kzi_status,

													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.ref_dos = ?
													AND d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												$sqlOrder");
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$index++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "";
					$class = "";
				}

				if (empty($this-> getSouscriptionLicence($reponse['num_lic'])) && ($this-> verifierSouscriptionLicence($id_cli, $id_mod_lic) == true)) {
					$clignoteDos = ' clignoteb';
					$couleurDos = ' color: rgb(255,69,0);';
				}else{
					$clignoteDos = '';
					$couleurDos = '';
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDeleteDossier.php');
				

			?>
				<input type="hidden" name="ref_dos" value="<?php echo $ref_dos;?>">
				<input type="hidden" name="rech" value="true">
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><span class="<?php echo $clignoteDos?>" style="<?php echo $couleurDos?>"><?php echo $reponse['ref_dos'];?></span>
					 <?php 
					  if(!isset($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_enab'])){
					  ?>
						<span title="Edit File" onclick="window.location.replace('editFile.php?id_cli=<?php echo $_GET['id_cli']; ?>&id_mod_trans=<?php echo $_GET['id_mod_trans']; ?>&id_mod_trac=<?php echo $_GET['id_mod_trac']; ?>&commodity=<?php echo $_GET['commodity']; ?>&statut=<?php echo $_GET['statut'];?>&id_march=<?php echo $_GET['id_march'];?>&id_dos=<?php echo $reponse['id_dos'];?>&page=<?php echo $page;?>','pop1','width=80,height=80');">&nbsp;&nbsp;&nbsp;<i class="fa fa-edit bg bg-warning" style="padding: 3px; border-radius: 5px;"></i></span>
						<?php
						if ($reponse['cleared'] != '2') {
							
						}

						if ($this-> getDataUtilisateur($_SESSION['id_util'])['tracking_log'] == '1') {
						?>
					  	<span title="Historique du dossier" onclick="window.open('popUpLogFile.php?id_dos=<?php echo $reponse['id_dos'];?>','pop1','width=900,height=950');">
					  		<i class="fa fa-history bg bg-dark"  style="padding: 3px; border-radius: 5px;" aria-hidden="true"></i>
	                	</span>
		                <?php
						}
					
					  }
					  ?>
					</td>
					<td style="text-align: center;">
						<span class="btn-xs bg-purple dropdown-toggle dropdown-hover dropdown-icon" data-toggle="dropdown" title="Documents Joints">
                        <i class="fa fa-folder-open"></i><sup><span class=""><?php echo $this-> getNombreDocumentDossier($reponse['id_dos']);?></span></sup>
                        <span class="sr-only">Toggle Dropdown</span>
                        <div class="dropdown-menu" role="menu">
                        	<a class="dropdown-item sm" onclick="window.location.replace('documentDossier.php?id_dos=<?php echo $reponse['id_dos']; ?>&id_cli=<?php echo $reponse['id_cli']; ?>&id_mod_trans=<?php echo $id_mod_trans; ?>&id_mod_trac=<?php echo $id_mod_lic; ?>&id_march=<?php echo $id_march; ?>&commodity=<?php echo $commodity; ?>&page=<?php echo $page;?>','pop1','width=80,height=80');">
								<i class="fa fa-plus"></i> Ajouter
							</a>
							<hr>
                          <?php
                            $this-> getListeDocumentForDossier($reponse['id_dos'], $reponse['id_mod_lic']);
                          ?>
                        </div>
                      </span>
					</td>
					<?php
					$this-> afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $reponse['statut'], $reponse['klsa_status'], $reponse['amicongo_status'], $reponse['kzi_status'], $clignoteDos);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierLogistiqueClientModeTransport($id_cli, $id_mod_trans, $id_trans, $premiere_entree, $nombre_dossier_par_page){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_trans'] = $id_trans;
			$compteur = $premiere_entree;
			$index = 0;
			$bg = '';
			$style = '';

			  if (isset($_GET['page'])) {
			    $page = '&page='.$_GET['page'];
			  }else{
			    $page = '&page=1';
			  }

			$requete = $connexion-> prepare("SELECT *, ROUND(poids, 2) AS poids, ROUND(montant_po, 2) AS montant_po
												FROM dossier_logistique
												WHERE id_cli = ?
													AND id_mod_trans = ?
													ANd id_trans = ?
												ORDER BY ref_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_trans']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$index++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['statut'] == 'ARRIVED') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['statut'] == 'CANCELLED') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "";
					$class = "";
				}

			?>
				<input type="hidden" name="ref_dos" value="<?php echo $ref_dos;?>">
				<input type="hidden" name="ref_dos_<?php echo $compteur;?>" value="<?php echo $reponse['ref_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" <?php echo $color;?>">
						<?php echo $reponse['ref_dos'];?>
					</td>
				<?php

					if ($id_trans==3 && $id_mod_trans==1) {
					?>
					<td style="text-align: center;">
						<input type="text" name="point_load_<?php echo $compteur;?>" value="<?php echo $reponse['point_load'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="destination_<?php echo $compteur;?>" value="<?php echo $reponse['destination'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="horse_<?php echo $compteur;?>" value="<?php echo $reponse['horse'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="trailer_1_<?php echo $compteur;?>" value="<?php echo $reponse['trailer_1'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="nom_chauf_<?php echo $compteur;?>" value="<?php echo $reponse['nom_chauf'];?>">
					</td>
					<td style="text-align: center;">
						<input type="text" name="lic_num_<?php echo $compteur;?>" value="<?php echo $reponse['lic_num'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="tel_chauf_<?php echo $compteur;?>" value="<?php echo $reponse['tel_chauf'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="date" name="date_load_<?php echo $compteur;?>" value="<?php echo $reponse['date_load'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="date" name="date_dispatch_<?php echo $compteur;?>" value="<?php echo $reponse['date_dispatch'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="frontiere_<?php echo $compteur;?>" value="<?php echo $reponse['frontiere'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="date" name="front_in_<?php echo $compteur;?>" value="<?php echo $reponse['front_in'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="date" name="front_out_<?php echo $compteur;?>" value="<?php echo $reponse['front_out'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="text" name="localisation_<?php echo $compteur;?>" value="<?php echo $reponse['localisation'];?>" style="text-transform:uppercase;">
					</td>
					<?php
					}else{
					?>
					<td style="text-align: center;">
						<input type="text" name="ref_mca_<?php echo $compteur;?>" value="<?php echo $reponse['ref_mca'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<?php
							echo $this-> getNomModeTransport($reponse['id_mod_trans']);
						?>
					</td>
					<td style="text-align: center;">
						<input type="text" name="road_manif_<?php echo $compteur;?>" value="<?php echo $reponse['road_manif'];?>" style="text-transform:uppercase; width: 10em;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $reponse['ref_fact'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="ref_batch_<?php echo $compteur;?>" value="<?php echo $reponse['ref_batch'];?>" style="text-transform:uppercase; width: 7em;">
					</td>
					<td style="text-align: center;">
						<input type="number" step="0.01" min="0" name="poids_<?php echo $compteur;?>" value="<?php echo $reponse['poids'];?>" style="width: 6em;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="ref_po_<?php echo $compteur;?>" value="<?php echo $reponse['ref_po'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="number" step="0.05" min="0" name="montant_po_<?php echo $compteur;?>" value="<?php echo $reponse['montant_po'];?>" style="text-transform:uppercase; width: 6em;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="origine_<?php echo $compteur;?>" value="<?php echo $reponse['origine'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="destination_<?php echo $compteur;?>" value="<?php echo $reponse['destination'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="date" name="date_dep_fbm_<?php echo $compteur;?>" value="<?php echo $reponse['date_dep_fbm'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="text" name="transit_<?php echo $compteur;?>" value="<?php echo $reponse['transit'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="date" name="date_transit_<?php echo $compteur;?>" value="<?php echo $reponse['date_transit'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="date" name="date_fd_<?php echo $compteur;?>" value="<?php echo $reponse['date_fd'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="date" name="deliv_date_<?php echo $compteur;?>" value="<?php echo $reponse['deliv_date'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="text" name="ref_pod_<?php echo $compteur;?>" value="<?php echo $reponse['ref_pod'];?>" style="text-transform:uppercase;">
					</td>
					<?php
					}

				?>
					<td style="text-align: center;" class="<?php echo $bg;?> <?php echo $class;?>">
						<select name="statut_<?php echo $compteur;?>">
							<?php
							if ($reponse['statut']=='ARRIVED') {
							?>
								<option value="ARRIVED">ARRIVED</option>
								<option value="IN TRANSIT">IN TRANSIT</option>
								<option value="CANCELLED">CANCELLED</option>
							<?php
							}else if ($reponse['statut']=='IN TRANSIT') {
							?>
								<option value="IN TRANSIT">IN TRANSIT</option>
								<option value="ARRIVED">ARRIVED</option>
								<option value="CANCELLED">CANCELLED</option>
							<?php
							}else if ($reponse['statut']=='CANCELLED') {
							?>
								<option value="CANCELLED">CANCELLED</option>
								<option value="ARRIVED">ARRIVED</option>
								<option value="IN TRANSIT">IN TRANSIT</option>
							<?php
							}
							?>
						</select>
					</td>
					<td style="text-align: center;">
						<input type="text" name="remarque_<?php echo $compteur;?>" value="<?php echo $reponse['remarque'];?>" style="text-transform:uppercase; width: 20em;">
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierLogistiqueClientModeTransportRecherche($ref_dos, $id_cli, $id_mod_trans, $id_trans, $premiere_entree, $nombre_dossier_par_page){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_trans'] = $id_trans;
			$entree['ref_dos'] = trim($ref_dos);
			$compteur = 0;
			$index = 0;
			$bg = '';
			$style = '';

			  if (isset($_GET['page'])) {
			    $page = '&page='.$_GET['page'];
			  }else{
			    $page = '&page=1';
			  }

			$requete = $connexion-> prepare("SELECT *, ROUND(poids, 2) AS poids, ROUND(montant_po, 2) AS montant_po
												FROM dossier_logistique
												WHERE id_cli = ?
													AND id_mod_trans = ?
													ANd id_trans = ?
													AND ref_dos = ?
												ORDER BY ref_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], 
										$entree['id_trans'], $entree['ref_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$index++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['statut'] == 'ARRIVED') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['statut'] == 'CANCELLED') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "";
					$class = "";
				}

			?>
				<input type="hidden" name="ref_dos" value="<?php echo $ref_dos;?>">
				<input type="hidden" name="ref_dos_<?php echo $compteur;?>" value="<?php echo $reponse['ref_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" <?php echo $color;?>">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td style="text-align: center;">
						<input type="text" name="ref_mca_<?php echo $compteur;?>" value="<?php echo $reponse['ref_mca'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<?php
							echo $this-> getNomModeTransport($reponse['id_mod_trans']);
						?>
					</td>
					<td style="text-align: center;">
						<input type="text" name="road_manif_<?php echo $compteur;?>" value="<?php echo $reponse['road_manif'];?>" style="text-transform:uppercase; width: 10em;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="ref_fact_<?php echo $compteur;?>" value="<?php echo $reponse['ref_fact'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="ref_batch_<?php echo $compteur;?>" value="<?php echo $reponse['ref_batch'];?>" style="text-transform:uppercase; width: 7em;">
					</td>
					<td style="text-align: center;">
						<input type="number" step="0.01" min="0" name="poids_<?php echo $compteur;?>" value="<?php echo $reponse['poids'];?>" style="width: 6em;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="ref_po_<?php echo $compteur;?>" value="<?php echo $reponse['ref_po'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="number" step="0.05" min="0" name="montant_po_<?php echo $compteur;?>" value="<?php echo $reponse['montant_po'];?>" style="text-transform:uppercase; width: 6em;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="origine_<?php echo $compteur;?>" value="<?php echo $reponse['origine'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="text" name="destination_<?php echo $compteur;?>" value="<?php echo $reponse['destination'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="date" name="date_dep_fbm_<?php echo $compteur;?>" value="<?php echo $reponse['date_dep_fbm'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="text" name="transit_<?php echo $compteur;?>" value="<?php echo $reponse['transit'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;">
						<input type="date" name="date_transit_<?php echo $compteur;?>" value="<?php echo $reponse['date_transit'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="date" name="date_fd_<?php echo $compteur;?>" value="<?php echo $reponse['date_fd'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="date" name="deliv_date_<?php echo $compteur;?>" value="<?php echo $reponse['deliv_date'];?>" style="">
					</td>
					<td style="text-align: center;">
						<input type="text" name="ref_pod_<?php echo $compteur;?>" value="<?php echo $reponse['ref_pod'];?>" style="text-transform:uppercase;">
					</td>
					<td style="text-align: center;" class="<?php echo $bg;?> <?php echo $class;?>">
						<select name="statut_<?php echo $compteur;?>">
							<?php
							if ($reponse['statut']=='ARRIVED') {
							?>
								<option value="ARRIVED">ARRIVED</option>
								<option value="IN TRANSIT">IN TRANSIT</option>
								<option value="CANCELLED">CANCELLED</option>
							<?php
							}else if ($reponse['statut']=='IN TRANSIT') {
							?>
								<option value="IN TRANSIT">IN TRANSIT</option>
								<option value="ARRIVED">ARRIVED</option>
								<option value="CANCELLED">CANCELLED</option>
							<?php
							}else if ($reponse['statut']=='CANCELLED') {
							?>
								<option value="CANCELLED">CANCELLED</option>
								<option value="ARRIVED">ARRIVED</option>
								<option value="IN TRANSIT">IN TRANSIT</option>
							<?php
							}
							?>
						</select>
					</td>
					<td style="text-align: center;">
						<input type="text" name="remarque_<?php echo $compteur;?>" value="<?php echo $reponse['remarque'];?>" style="text-transform:uppercase; width: 20em;">
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherRowDossierClientModeTransportModeLicence3($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, 
														$id_march=NULL, $statut=NULL, $num_lic=NULL, 
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			if ($id_mod_lic == '1') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '857') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2') {
				$sqlOrder = ' ORDER BY d.ref_dos DESC';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND REPLACE(d.statut,"\'","") = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

            if ($_GET['id_mod_lic'] == '1') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = '';
				}

            }else if ($_GET['id_mod_lic'] == '2') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = '';
				}

            }

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													$sqlClient
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												$sqlOrder");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "color: black;";
					$class = "bg-dark";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDeleteDossier.php');
				

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					</td>
					<?php
					//$this-> afficherRowTableau2($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
					$this-> afficherRowTableau3($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceStatusAuto($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, 
														$id_march=NULL, $statut=NULL, $num_lic=NULL, 
														$cleared=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/
				//echo '<br>-------'.$sqlStatus;

			$sql1 = "";
			$sqlOrder = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlLicence = "";
			$sqlCleared = "";
			$statut = str_replace('_', '/', $statut);

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}
			if ($id_mod_lic == '1') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2' && $id_cli == '857') {
				$sqlOrder = ' ORDER BY d.id_dos DESC';
			}else if ($id_mod_lic == '2') {
				$sqlOrder = ' ORDER BY d.ref_dos DESC';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND REPLACE(d.statut,"\'","") = "'.$statut.'"';
			}

			if (isset($num_lic) && ($num_lic != '')) {
				$sqlLicence = ' AND d.num_lic = "'.$num_lic.'"';
			}

			if (isset($cleared) && ($cleared != '')) {
				$sqlCleared = ' AND d.cleared = "'.$cleared.'"';
			}

            if ($_GET['id_mod_lic'] == '1') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = '';
				}

            }else if ($_GET['id_mod_lic'] == '2') {
              
				if (isset($id_cli) && ($id_cli!='')) {
					$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
				}else{
					$sqlClient = '';
				}

            }

            if ($id_mod_lic=='2' && $id_mod_trans=='1') {
            	

				if ($statut == 'AWAITING CRF/AD/INSURANCE') {

					$sqlStatus = " AND d.date_crf IS NULL
									AND d.date_ad IS NULL
									AND d.date_assurance IS NULL
									AND d.ref_dos NOT LIKE '%20-%'
									AND d.cleared <> '2'";

				}else if ($statut == 'AWAITING CRF/AD') {

					$sqlStatus = " AND d.date_crf IS NULL
									AND d.date_ad IS NULL
									AND d.date_assurance IS NOT NULL
									AND d.ref_dos NOT LIKE '%20-%'
									AND d.cleared <> '2'";

				}else if ($statut == 'AWAITING CRF/INSURANCE') {

					$sqlStatus = " AND d.date_crf IS NULL
									AND d.date_ad IS NOT NULL
									AND d.date_assurance IS NULL
									AND d.ref_dos NOT LIKE '%20-%'
									AND d.cleared <> '2'";

				}else if ($statut == 'AWAITING CRF') {

					$sqlStatus = " AND d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NOT NULL
									AND d.ref_dos NOT LIKE '%20-%'
									AND d.cleared <> '2'";

				}else if ($statut == 'AWAITING AD/INSURANCE') {

					$sqlStatus = " AND d.date_crf IS NOT NULL
									AND d.date_ad IS NULL
									AND d.date_assurance IS NULL
									AND d.ref_dos NOT LIKE '%20-%'
									AND d.cleared <> '2'";

				}else if ($statut == 'AWAITING AD') {

					$sqlStatus = " AND d.date_ad IS NULL AND d.date_crf IS NOT NULL AND d.date_assurance IS NOT NULL
									AND d.ref_dos NOT LIKE '%20-%'
									AND d.cleared <> '2'";

				}/*else if ($statut == 'AWAITING INSURANCE') {

					$sqlStatus = " AND d.date_crf IS NOT NULL
									AND d.date_ad IS NOT NULL
									AND d.date_assurance IS NULL
									AND d.ref_dos NOT LIKE '%20-%'
									AND d.cleared <> '2'";

				}*/else if ($statut == 'AWAITING INSURANCE') {

					$sqlStatus = " AND d.date_assurance IS NULL AND d.date_ad IS NOT NULL AND d.date_crf IS NOT NULL
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.cleared <> '2'";

				}else if ($statut == 'UNDER PREPARATION') {

					$sqlStatus = " AND d.date_crf IS NOT NULL
													AND d.date_ad IS NOT NULL
													AND d.date_assurance IS NOT NULL
													AND d.date_decl IS NULL 
													AND d.ref_decl IS NULL
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.cleared <> '2'";

				}else if ($statut == 'UNDER PREPARATION-EXCPECTED TO ARRIVE') {

						// $requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
						// 							FROM dossier
						// 							WHERE id_mod_lic = ?
						// 								AND date_crf IS NOT NULL
						// 								AND date_ad IS NOT NULL
						// 								AND date_assurance IS NOT NULL
						// 								AND date_decl IS NULL 
						// 								AND ref_decl IS NULL
						// 								AND ref_dos NOT LIKE '%20-%'
						// 								AND cleared <> '2'
						// 								$sqlClient
						// 								$sqlModeTransport
						// 								$sqlCommodity");

					$sqlStatus = " AND d.date_crf IS NOT NULL
													AND d.date_ad IS NOT NULL
													AND d.date_assurance IS NOT NULL
													AND d.date_decl IS NULL 
													AND d.ref_decl IS NULL
													AND d.klsa_arriv IS NULL 
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.cleared <> '2'";

					}else if ($statut == 'UNDER PREPARATION-DISPATCHED') {

						// $requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
						// 							FROM dossier
						// 							WHERE id_mod_lic = ?
						// 								AND date_crf IS NOT NULL
						// 								AND date_ad IS NOT NULL
						// 								AND date_assurance IS NOT NULL
						// 								AND dispatch_klsa IS NOT NULL 
						// 								AND wiski_arriv IS NOT NULL
						// 								AND date_decl IS NULL 
						// 								AND ref_decl IS NULL
						// 								AND ref_dos NOT LIKE '%20-%'
						// 								AND cleared <> '2'
						// 								$sqlClient
						// 								$sqlModeTransport
						// 								$sqlCommodity");

					$sqlStatus = " AND d.date_crf IS NOT NULL
													AND d.date_ad IS NOT NULL
													AND d.date_assurance IS NOT NULL
													AND d.date_decl IS NULL 
													AND d.ref_decl IS NULL
													AND d.dispatch_klsa IS NOT NULL 
													AND d.wiski_arriv IS NOT NULL
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.cleared <> '2'";

					}else if ($statut == 'UNDER PREPARATION-AT WISKY') {

						// $requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
						// 							FROM dossier
						// 							WHERE id_mod_lic = ?
						// 								AND date_crf IS NOT NULL
						// 								AND date_ad IS NOT NULL
						// 								AND date_assurance IS NOT NULL
						// 								AND dispatch_klsa IS NULL 
						// 								AND wiski_arriv IS NOT NULL
						// 								AND date_decl IS NULL 
						// 								AND ref_decl IS NULL
						// 								AND ref_dos NOT LIKE '%20-%'
						// 								AND cleared <> '2'
						// 								$sqlClient
						// 								$sqlModeTransport
						// 								$sqlCommodity");

					$sqlStatus = " AND d.date_crf IS NOT NULL
													AND d.date_ad IS NOT NULL
													AND d.date_assurance IS NOT NULL
													AND d.dispatch_klsa IS NULL 
													AND d.wiski_arriv IS NOT NULL
													AND d.date_decl IS NULL 
													AND d.ref_decl IS NULL
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.cleared <> '2'";

					}else if ($statut == 'AWAITING LIQUIDATION') {

					$sqlStatus = " AND d.date_decl IS NOT NULL 
													AND d.ref_decl IS NOT NULL
													AND d.date_liq IS NULL 
													AND d.ref_liq IS NULL
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.cleared <> '2'";

				}else if ($statut == 'AWAITING QUITTANCE') {

					$sqlStatus = " AND d.date_liq IS NOT NULL 
													AND d.ref_liq IS NOT NULL
													AND d.date_quit IS NULL 
													AND d.ref_quit IS NULL
													AND d.ref_dos NOT LIKE '%20-%'
													AND d.cleared <> '2'";

				}else if ($statut == 'AWAITING BAE/BS') {

					$sqlStatus = " AND d.date_quit IS NOT NULL 
													AND d.ref_quit IS NOT NULL
													AND dgda_out IS NULL
													AND d.cleared <> '2'";

				}else if ($statut == 'CLEARING COMPLETED') {

					$sqlStatus = " AND d.dgda_out IS NOT NULL 
													AND d.dispatch_deliv IS NOT NULL
													AND d.cleared <> '2'";

				}

            }else{
            	$sqlStatus = " AND d.statut = '$statut'";
            }

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													d.supplier AS fournisseur,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,

													
													IF(d.id_mod_lic='2' AND d.id_mod_trans='1',
														IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													      'AWAITING CRF/AD/INSURANCE',
													      IF(d.date_crf IS NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													        'AWAITING CRF/AD',
													          IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													            'AWAITING CRF/INSURANCE',
													            IF(d.date_crf IS NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NOT NULL,
													              'AWAITING CRF', 
													              IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NULL,
													                'AWAITING AD/INSURANCE',
													                IF(d.date_crf IS NOT NULL AND d.date_ad IS NULL AND d.date_assurance IS NOT NULL,
													                  'AWAITING AD',
													                    IF(d.date_crf IS NOT NULL AND d.date_ad IS NOT NULL AND d.date_assurance IS NULL,
													                      'AWAITING INSURANCE',

													                      IF(d.date_decl IS NULL AND d.ref_decl IS NULL, 'UNDER PREPARATION',
													                        IF(d.date_liq IS NULL AND d.ref_liq IS NULL, 'AWAITING LIQUIDATION',
													                          IF(d.date_quit IS NULL AND d.ref_quit IS NULL, 'AWAITING QUITTANCE',
													                            IF(d.date_quit IS NOT NULL AND d.ref_quit IS NOT NULL AND d.dgda_out IS NULL, 'AWAITING BAE/BS', 
													                              IF(d.dgda_out IS NOT NULL AND d.dispatch_deliv IS NOT NULL, 'CLEARING COMPLETED', '')
													                              )
													                            )
													                          )
													                        )
													                      
													                      )
													                  )
													                )
													              )
													            )
													          )
													      )
														,
														d.statut) AS statut,

													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													$sqlClient
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sqlLicence
													$sqlCleared
													$sql1
												$sqlOrder");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$color='';
				$class = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
					$color = "color: blue;";
					$class = "bg-primary";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
					$color = "color: red;";
					$class = "bg-danger";
				}else{
					$style = "";
					$color = "color: black;";
					$class = "bg-dark";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				$supplier = $this-> getLicence($reponse['num_lic'])['fournisseur'];

				if (isset($supplier)) {
					$reponse['fournisseur'] = $supplier;
				}

				//include('modalDeleteDossier.php');
				

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $class;?> <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="<?php echo $class;?>  <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black; <?php echo $color;?>"><?php echo $reponse['ref_dos'];?>
					</td>
					<?php
					//$this-> afficherRowTableau2($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
					$this-> afficherRowTableau3($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur, $reponse['statut']);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceDashboard($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, 
														$premiere_entree, $nombre_dossier_par_page, $type){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			$sql1 = "";
			$sqlClient = "";
			$sqlType = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			if (isset($id_cli) && ($id_cli != '')) {
				$sql1 = ' AND d.id_cli = "'.$id_cli.'"';
			}

			if (isset($type) && ($type == 'TOTAL FILES')) {
				$sqlType = '';
			}

			if (isset($type) && ($type == 'CLEARING COMPLETED')) {
				$sqlType = " AND d.cleared = '1'";
			}

			if (isset($type) && ($type == 'FILES IN PROCESS')) {
				$sqlType = " AND d.cleared = '0'";
			}

			if (isset($type) && ($type == 'CANCELLED')) {
				$sqlType = " AND d.cleared = '2'";
			}

			if (isset($type) && ($type == 'KASUMBALESA')) {
				$sqlType = " AND DATE(d.arrival_date) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'WISKI ARRIVAL')) {
				$sqlType = " AND DATE(d.wiski_arriv) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT WISKI')) {
				$sqlType = " AND (d.wiski_arriv IS NOT NULL AND d.wiski_arriv <> '')
												AND (d.wiski_dep IS NULL OR d.wiski_dep = '')";
			}

			if (isset($type) && ($type == 'WISKI DEPARTURE')) {
				$sqlType = " AND DATE(d.wiski_dep) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'AWAIT CRF')) {
				$sqlType = " AND (d.wiski_dep IS NOT NULL AND d.wiski_dep <> '')
												AND ( (d.date_crf IS NULL OR d.date_crf = '') AND (d.ref_crf IS NULL OR d.ref_crf = '' ))";
			}

			if (isset($type) && ($type == 'DGDA IN')) {
				$sqlType = " AND DATE(d.dgda_in) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT DGDA')) {
				$sqlType = " AND (d.dgda_in IS NOT NULL AND d.dgda_in <> '')
												AND (d.dgda_out IS NULL OR d.dgda_out = '')";
			}

			if (isset($type) && ($type == 'LIQUIDATED / AWAIT QUITTANCE')) {
				$sqlType = " AND ( (d.date_liq IS NOT NULL OR d.date_liq <> '')
													OR (d.ref_liq IS NOT NULL AND d.ref_liq <> '') )
												AND ( (d.date_quit IS NULL OR d.date_quit = '') 
													OR (d.ref_quit IS NULL OR d.ref_quit = '') )";
			}

			if (isset($type) && ($type == 'QUITTANCE')) {
				$sqlType = " AND DATE(d.date_quit) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'DGDA OUT')) {
				$sqlType = " AND DATE(d.dgda_out) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'FILES CLEARED WAITING INVOICE')) {
				$sqlType = " AND d.cleared = '1'
												AND d.facture = '0'";
			}

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sql1
													$sqlClient
													$sqlType
												ORDER BY d.ref_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<?php
					$this-> afficherRowTableau($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRowDossierClientModeTransportModeLicenceExcel($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, $id_march=NULL, $statut=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql1 = "";
			$sqlIdMarch = "";
			$sqlStatus = "";
			$sqlOrder = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			if ($id_mod_lic == '1') {
				$sqlOrder = ' ORDER BY d.id_dos ASC';
			}else if ($id_mod_lic == '2') {
				$sqlOrder = ' ORDER BY d.ref_dos ASC';
			}

			if (isset($id_march) && ($id_march != '')) {
				$sqlIdMarch = ' AND d.id_march = '.$id_march;
			}

			if (isset($statut) && ($statut != '')) {
				$sqlStatus = ' AND d.statut = "'.$statut.'"';
			}

			/*echo '<br> sql1 = '.$sql1;
			echo '<br> sqlIdMarch = '.$sqlIdMarch;
			echo '<br> sqlStatus = '.$sqlStatus;
			echo '<br> sqlOrder = '.$sqlOrder;*/

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													d.cleared AS cleared,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlIdMarch
													$sqlStatus
													$sql1
												$sqlOrder");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				if ($reponse['cleared'] == '1') {
					$style = "style='color: blue;'";
				}else if ($reponse['cleared'] == '2') {
					$style = "style='color: red;'";
				}else{
					$style = "";
				}

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<tr <?php echo $style;?>>
					<td  style="border: 0.5px solid black; text-align: right;"><?php echo $compteur;?></td>
					<td style="border: 0.5px solid black; text-align: center;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<?php
					$this-> afficherRowTableauExcel($id_mod_lic, $id_cli, $id_mod_trans, $reponse['id_dos'], $compteur);
						/*if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}*/
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierClientModeTransportModeLicenceExcel($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.num_lic AS num_lic,
													l.fournisseur AS fournisseur,
													l.fob AS fob,
													l.tonnage AS tonnage,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<tr>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 0.5px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 0.5px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 0.5px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 0.5px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<td class=" <?php echo $bg;?>" style="border: 0.5px solid black;"><?php echo $reponse['mca_num'];?></td>
					<?php
						if ($id_mod_trans == '1') {
							include('importRouteRowExcel.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRowExcel.php');
						}
					?>
				</tr>
			<?php
			}$requete-> closeCursor();

		}

		public function afficherDossierLicence($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$sommePoids = 0;
			$requete = $connexion-> prepare("SELECT d.*, 
													IF(cod IS NOT NULL AND cod <> 'TBC', cod, IF(ref_av IS NOT NULL, ref_av, IF(ref_crf IS NOT NULL, ref_crf, NULL))) AS cod,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit, '%d/%m/%Y') AS date_quit
												FROM dossier d, client cl
												WHERE d.num_lic = ?
													AND d.id_cli =  cl.id_cli
													AND d.cleared <> '2'");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];
				$sommePoids += $reponse['poids'];
				$ok_apurement = '';
				
				if ($this-> verifierApurementDossier($reponse['id_dos'])==true) {
					$bg = 'text-success';
					$ok_apurement = '<span class="text-success">YES</span>';
				}else {
					//$bg = 'bg bg-success';
					$ok_apurement = '<span class="text-danger">NO</span>';
				}

				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['cod'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['montant_decl'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['date_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['date_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['date_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['poids'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $ok_apurement;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $this-> getDataApurementDossier($reponse['id_dos']);?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<td class="<?php echo $bg;?>" colspan='10' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommeFob, 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommePoids, 2, ',', ' ');?>
					</td>
				</tr>
			<?php
		}

		public function afficherPartielleCODBack($cod){
			include('connexion.php');

			$entree['cod'] = $cod;
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT part.cod AS cod,
													part.num_part AS num_part,
													part.poids AS poids,
													part.fob AS fob
												FROM partielle_av part
												WHERE part.cod = ?");
			$requete-> execute(array($entree['cod']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

			?>
				<tr>
					<td>
						<?php echo $compteur;?>
					</td>
					<td>
						<?php echo $reponse['cod'];?>
					</td>
					<td>
						<?php echo $reponse['num_part'];?>
					</td>
					<td>
						<?php 
							echo $reponse['poids'];
						?>
					</td>
					<td>
						<?php 
							echo $reponse['fob'];
						?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherLogDossier($id_dos){
			include('connexion.php');

			$entree['id_dos'] = $id_dos;
			$compteur = 0;
			$requete = $connexion-> prepare("SELECT DATE_FORMAT(ld.date_log, '%d/%m/%Y %h:%i:%s') AS date_log,
													ld.colonne AS colonne,
													ld.valeur AS valeur,
													UPPER(u.nom_util) AS nom_util  
												FROM log_dossier ld, utilisateur u
												WHERE ld.id_dos = ?
													AND ld.id_util =  u.id_util
												ORDER BY id_log DESC");
			$requete-> execute(array($entree['id_dos']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

			?>
				<tr>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['date_log'];?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['colonne'];?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['valeur'];?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['nom_util'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierSansPoids($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['annee'] = '%'.date('y').'-%';
			$compteur = 0;
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, poids
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_trans = ?
													AND id_mod_lic = ?
													AND (poids IS NULL OR poids = '' OR poids = 0)
													AND (ref_dos LIKE '%21-%' OR ref_dos LIKE ?)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], $entree['annee']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
				<tr>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class=" " style="text-align: center; ">
						<?php echo $compteur;?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<input type="number" min="0" step="0.0001" name="poids_<?php echo $compteur;?>">
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td colspan="text-align: right;">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherDossierSansFob($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['annee'] = '%'.date('y').'-%';
			$compteur = 0;
			$requete = $connexion-> prepare("SELECT id_dos, ref_dos, fob
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_trans = ?
													AND id_mod_lic = ?
													AND (fob IS NULL OR fob = '' OR fob = 0)
													AND (ref_dos LIKE '%21-%' OR ref_dos LIKE ?)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], $entree['annee']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
				<tr>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class=" " style="text-align: center; ">
						<?php echo $compteur;?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<input type="number" min="0" step="0.0001" name="fob_<?php echo $compteur;?>">
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td colspan="text-align: right;">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRegimeSuspensionSansDateExtreme($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic, 
													DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													d.ref_decl AS ref_decl,
													d.id_dos AS id_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.temporelle = '1'
													AND (
															(d.klsa_arriv IS NOT NULL AND d.id_mod_trans = 1)
															OR
															(d.arrival_date IS NOT NULL AND d.id_mod_trans = 3)
														) 
													AND d.date_ext_temporelle IS NULL");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
				<tr>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class=" " style="text-align: center; ">
						<?php echo $compteur;?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['klsa_arriv'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<input type="date" name="date_ext_temporelle_<?php echo $compteur;?>">
					</td>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['date_decl'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td colspan="7" colspan="text-align: right;">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php
		}

		public function afficherRegimeSuspensionDateExtremeExpire($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos, d.num_lic AS num_lic, 
													DATE_FORMAT(d.klsa_arriv, '%d/%m/%Y') AS klsa_arriv,
													DATE_FORMAT(d.date_decl, '%d/%m/%Y') AS date_decl,
													DATE_FORMAT(d.date_ext_temporelle, '%d/%m/%Y') AS date_ext_temporelle,
													d.ref_decl AS ref_decl,
													d.id_dos AS id_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.temporelle = '1'
													AND d.klsa_arriv IS NOT NULL
													AND (DATEDIFF(d.date_ext_temporelle, CURRENT_DATE()) <= 0)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
			?>
				<tr>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class=" " style="text-align: center; ">
						<?php echo $compteur;?>
					</td>
					<td class=" " style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['num_lic'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['klsa_arriv'];?>
					</td>
					<td class=" " style="text-align: center; color: red;">
						<?php echo $reponse['date_ext_temporelle'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" " style="text-align: center; ">
						<?php echo $reponse['date_decl'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function getNbreDossierSansPoids($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['annee'] = '%'.date('y').'-%';
			$compteur = 0;
			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_trans = ?
													AND id_mod_lic = ?
													AND (poids IS NULL OR poids = '' OR poids = 0)
													AND (ref_dos LIKE '%21-%' OR ref_dos LIKE ?)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingCRFAtWiski($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND wiski_arriv IS NOT NULL
													AND dispatch_klsa IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND cleared = '2'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingCRFAtWiskiAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND wiski_arriv IS NOT NULL
													AND dispatch_klsa IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND cleared = '2'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingCRFDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '2'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingCRFDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '2'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedAwaitingCRFDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedAwaitingCRFDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingCRFDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingCRFDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedAwaitingBAEDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND dgda_out IS NULL
													AND date_quit IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedAwaitingBAEDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND dgda_out IS NULL
													AND date_quit IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingBAEDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND dgda_out IS NULL
													AND date_quit IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingBAEDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND dgda_out IS NULL
													AND date_quit IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingAssuranceDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '2'
													ANd ref_dos LIKE(?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingAssuranceDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '2'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedAwaitingAssuranceDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedAwaitingAssuranceDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedDispatchFromKlsa($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND dgda_out IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitClearedCompletedDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND dgda_out IS NOT NULL
													AND date_quit IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitClearedCompletedDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND dgda_out IS NOT NULL
													AND date_quit IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedAwaitingQuittanceDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_quit IS NULL
													AND date_liq IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedAwaitingQuittanceDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_quit IS NULL
													AND date_liq IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingAssuranceDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingAssuranceDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingAssuranceExceptedToArrive($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingAssuranceExceptedToArriveAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingAssuranceAtWiski($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND wiski_arriv IS NOT NULL
													AND dispatch_klsa IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitAwaitingAssuranceAtWiskiAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND wiski_arriv IS NOT NULL
													AND dispatch_klsa IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedCompletedDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND dgda_out IS NOT NULL
													AND date_quit IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedCompletedDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND dgda_out IS NOT NULL
													AND date_quit IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitUnderPreparationDispatchFromKlsa($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NOT NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitUnderPreparationDispatchFromKlsaAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NOT NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NOT NULL
													AND dispatch_klsa IS NOT NULL
													AND warehouse_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingCRFExceptedToArrival($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '2'
													AND ref_dos LIKE(?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingCRFExceptedToArrivalAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_crf IS NULL
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '2'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedCompletedCRFExceptedToArrival($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedCompletedCRFExceptedToArrivalAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '1'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitExceptedToArrival($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND klsa_arriv IS NULL
													AND date_crf IS NOT NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NOT NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierTransitExceptedToArrivalAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND klsa_arriv IS NULL
													AND date_crf IS NOT NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NOT NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedTransitCRFExceptedToArrival($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'
													AND ref_dos LIKE (?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierClearedTransitCRFExceptedToArrivalAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '0'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingAssuranceExceptedToArrival($id_cli, $annee=NULL){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '2'
													AND ref_dos LIKE(?)");
			$requete-> execute(array($entree['id_cli'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierCancelledAwaitingAssuranceExceptedToArrivalAll($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			// $entree['annee'] = $annee;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND date_assurance IS NULL
													AND klsa_arriv IS NULL
													AND id_mod_lic = '2'
													AND id_mod_trans = '1'
													AND ref_dos NOT LIKE '%20-%'
													AND cleared = '2'");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbreDossierSansFob($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['annee'] = '%'.date('y').'-%';
			$compteur = 0;
			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_trans = ?
													AND id_mod_lic = ?
													AND (fob IS NULL OR fob = '' OR fob = 0)
													AND (ref_dos NOT LIKE '%21-%' OR ref_dos LIKE ?)");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], $entree['annee']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function getNbrePartielleSansFob($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;

			$compteur = 0;
			$requete = $connexion-> prepare("SELECT COUNT(part.id_part) AS nbre
												FROM partielle_av part, licence l
												WHERE l.id_cli = ?
													AND l.cod = part.cod
													AND (part.fob IS NULL OR part.fob<=0)");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];
		}

		public function afficherDossierPopUp($id_cli, $id_mod_trans, 
											$id_mod_lic, $commodity, $statut){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['statut'] = $statut;
			$compteur = 0;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			$sqlClient = "";
			$sqlType = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			if (isset($id_cli) && ($id_cli != '')) {
				$sql1 = ' AND d.id_cli = "'.$id_cli.'"';
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													d.num_lot AS num_lot,
													d.ref_fact AS ref_fact,
													d.ref_decl AS ref_decl,
													d.ref_liq AS ref_liq,
													d.ref_quit AS ref_quit,
													DATE_FORMAT(d.date_liq,'%d/%m/%Y') AS date_liq,
													DATE_FORMAT(d.date_quit,'%d/%m/%Y') AS date_quit,
													DATE_FORMAT(d.date_decl,'%d/%m/%Y') AS date_decl
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.statut = ?
													$sql1
													$sqlClient
												ORDER BY d.ref_dos DESC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic'], $entree['statut']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";


			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class=" <?php echo $bg;?>" style="" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['ref_dos'];?></td>
					<?php 
					if ($_GET['id_mod_lic'] == '1') {
                     	?><td><?php echo $reponse['num_lot'];?></td><?php
                     }else if ($_GET['id_mod_lic'] == '2') {
                     	?><td><?php echo $reponse['ref_fact'];?></td><?php
                     }
					?>
					</td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['ref_decl'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['date_decl'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['ref_liq'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['date_liq'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['ref_quit'];?></td>
					<td class=" <?php echo $bg;?>" style=""><?php echo $reponse['date_quit'];?></td>
				</tr>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierPopUpBackUp($id_cli, $id_mod_trans, 
											$id_mod_lic, $commodity, $type,
											$premiere_entree, $nombre_dossier_par_page){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			$sqlClient = "";
			$sqlType = "";

			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			if (isset($id_cli) && ($id_cli != '')) {
				$sql1 = ' AND d.id_cli = "'.$id_cli.'"';
			}

			if (isset($type) && ($type == 'TOTAL FILES')) {
				$sqlType = '';
			}

			if (isset($type) && ($type == 'CLEARING COMPLETED')) {
				$sqlType = " AND d.cleared = '1'";
			}

			if (isset($type) && ($type == 'FILES IN PROCESS')) {
				$sqlType = " AND d.cleared = '0'";
			}

			if (isset($type) && ($type == 'CANCELLED')) {
				$sqlType = " AND d.cleared = '2'";
			}

			if (isset($type) && ($type == 'KASUMBALESA')) {
				$sqlType = " AND DATE(d.arrival_date) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'WISKI ARRIVAL')) {
				$sqlType = " AND DATE(d.wiski_arriv) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT WISKI')) {
				$sqlType = " AND (d.wiski_arriv IS NOT NULL AND d.wiski_arriv <> '')
												AND (d.wiski_dep IS NULL OR d.wiski_dep = '')";
			}

			if (isset($type) && ($type == 'WISKI DEPARTURE')) {
				$sqlType = " AND DATE(d.wiski_dep) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'AWAIT CRF')) {
				$sqlType = " AND (d.wiski_dep IS NOT NULL AND d.wiski_dep <> '')
												AND ( (d.date_crf IS NULL OR d.date_crf = '') AND (d.ref_crf IS NULL OR d.ref_crf = '' ))";
			}

			if (isset($type) && ($type == 'DGDA IN')) {
				$sqlType = " AND DATE(d.dgda_in) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT DGDA')) {
				$sqlType = " AND (d.dgda_in IS NOT NULL AND d.dgda_in <> '')
												AND (d.dgda_out IS NULL OR d.dgda_out = '')";
			}

			if (isset($type) && ($type == 'LIQUIDATED / AWAIT QUITTANCE')) {
				$sqlType = " AND ( (d.date_liq IS NOT NULL OR d.date_liq <> '')
													OR (d.ref_liq IS NOT NULL AND d.ref_liq <> '') )
												AND ( (d.date_quit IS NULL OR d.date_quit = '') 
													OR (d.ref_quit IS NULL OR d.ref_quit = '') )";
			}

			if (isset($type) && ($type == 'QUITTANCE')) {
				$sqlType = " AND DATE(d.date_quit) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'DGDA OUT')) {
				$sqlType = " AND DATE(d.dgda_out) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'FILES CLEARED WAITING INVOICE')) {
				$sqlType = " AND d.cleared = '1'
												AND d.facture = '0'";
			}

			$requete = $connexion-> prepare("SELECT d.ref_dos AS ref_dos,
													UPPER(cl.nom_cli) AS nom_cli,
													d.ref_fact AS ref_fact,
													d.fob AS fob_dos,
													d.fret AS fret,
													d.assurance AS assurance,
													d.autre_frais AS autre_frais,
													d.num_lic AS num_lic,
													d.montant_decl AS montant_decl,
													d.*,
													l.num_lic AS num_lic,
													l.fournisseur AS fournisseur,
													l.fob AS fob,
													l.tonnage AS tonnage,
													s.nom_site AS nom_site,
													d.dgda_in AS dgda_in_1,
													d.dgda_out AS dgda_out_1,
													d.custom_deliv AS custom_deliv_1,
													d.arrival_date AS arrival_date_1,
													DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.custom_deliv, d.arrival_date) AS arrival_deliver_delay
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sql1
													$sqlClient
													$sqlType
												ORDER BY d.ref_dos DESC
												LIMIT $premiere_entree, $nombre_dossier_par_page");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";

				$date_exp = $this-> getLastEpirationLicence($reponse['num_lic']);
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="bg-light col_1 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;" <?php echo $style;?>><?php echo $compteur;?></td>
					<td class="bg-light col_6 <?php echo $bg;?>" style=" border-right: 1px solid black; vertical-align: middle; text-align: left; padding: 0.6rem; border-top: 1px solid black;"><?php echo $reponse['ref_dos'];?></td>
					<!--<td class=" <?php echo $bg;?>" style="border: 1px solid black;"><?php echo $reponse['mca_num'];?></td>-->
					<?php
						if ($id_mod_trans == '1') {
							include('importRouteRow.php');
						}else if ($id_mod_trans == '3') {
							include('importAirRow.php');
						}
					?>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
			<tr>
				<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
				<td class="col_1">
					<button type="submit" class="btn btn-success" name="update">
						Mettre Ã  jour
					</button>
				</td>
			</tr>
			<?php
		}


		public function afficherDossierPopUpExcel($id_mod_lic, $type, $id_cli, $id_type_lic){
			include('connexion.php');
/*
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			if ($type == 'EN ATTENTE FACTURATION') {

				$requete = $connexion-> prepare("SELECT d.*,
													UPPER(m.nom_march) AS nom_march,
													UPPER(cl.nom_cli) AS nom_cli
												FROM dossier d, client cl, marchandise m
												WHERE d.id_mod_lic = ?
													AND d.id_march =  m.id_march
													AND d.id_cli =  cl.id_cli
													AND d.cleared = '1'
													AND d.facture = '0'");

			}
			
			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<td class="<?php echo $bg;?>" style="border: 0.5px solid black; " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; border: 0.5px solid black;">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['mca_b_ref'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['nom_cli'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['nom_march'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; border: 0.5px solid black;">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; border: 0.5px solid black;">
						<?php echo $reponse['fob'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			
			*/
		}

		public function afficherLicencePopUp($id_mod_lic, $type, $id_cli, $id_type_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sql3 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND l.id_cli = '.$id_cli;
			}

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND l.id_cli = '.$id_cli;
			}

			if($type == 'EXPIRES'){
				$sql3 = ' AND l.date_val IS NOT NULL ';
			}

			$sommeFob = 0;

			if ($id_mod_lic == '1') {
				
				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.poids AS fob,
														(l.poids) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														l.unit_mes AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3
													AND l.id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}else{

				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.fob AS fob,
														(l.fob+l.fret+l.assurance+l.autre_frais) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														mo.sig_mon AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3
													AND l.id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				$date_exp2 = $this-> getLastEpirationLicence($reponse['num_lic']);
				$bg = "";
				$sommeFob += $reponse['fob'];
				
				if ($type == 'EN COURS') {

					if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<?php
							if ($id_mod_lic == '2') {
							?>
							<td style="text-align: right;">
								<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
							</td>
							<?php
							}
							?>
							
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<?php
							if ($id_mod_lic == '2') {
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							<?php
							}
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							
						</tr>
						<?php
					}

				}else if ($type == 'EXTREME VALIDATION -40 JOURS') {

					if(($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) <= 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<?php
							if ($id_mod_lic == '2') {
							?>
							<td style="text-align: right;">
								<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
							</td>
							<?php
							}
							?>
							
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<?php
							if ($id_mod_lic == '2') {
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							<?php
							}
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							
						</tr>
						<?php
					}

				}else if ($type == 'EXPIRES') {

					if(($date_exp < $reponse['aujourdhui']) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic'])) && ( $reponse['num_lic'] != $this-> getLicenceApuree($reponse['num_lic'])) ){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<?php
							if ($id_mod_lic == '2') {
							?>
							<td style="text-align: right;">
								<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
							</td>
							<?php
							}
							?>
							
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<?php
							if ($id_mod_lic == '2') {
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							<?php
							}
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							
						</tr>
						<?php
					}

				}else if ($type == 'APPUREES TRACKING ATTENTE BANQUE') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) &&  ( $reponse['num_lic'] != $this-> getLicenceApuree($reponse['num_lic'])) && ($this-> verifierApurementDossierLicence($reponse['num_lic']) == false)){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<?php
							if ($id_mod_lic == '2') {
							?>
							<td style="text-align: right;">
								<?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
							</td>
							<?php
							}
							?>
							
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<?php
							if ($id_mod_lic == '2') {
							?>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
							<?php
							}
							?>
							
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'APPUREES PAR BANQUE') {

					if( ($this-> verifierApurementDossierLicence($reponse['num_lic']) != false) && ($reponse['num_lic'] != 'UNDER VALUE') ){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<td style="text-align: right;"><?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'CIF LICENCE DIFFERENT CIF DOSSIER(S)') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['cif'] != $this-> getSommeCIFLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo number_format( $reponse['fob'], 2, ',', ' ');?>
							<td style="text-align: right; background-color: rgb(152,251,152);"><?php echo number_format( $reponse['cif'], 2, ',', ' ');?>
	                    	<td style="text-align: center;">
	                    		<?php echo number_format($this->getNbreDossierLicence($reponse['num_lic']), 0, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right; background-color: rgb(152,251,152);">
	                    		<?php echo number_format($this->getSommeCIFLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo number_format($reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']), 2, ',', ' ');?>
	                    	</td>
						</tr>
						<?php
					}

				}

			?>
			<?php
			}$requete-> closeCursor();
		}

		public function getNombreDocumentDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT COUNT(id_doc) AS nbre
												FROM dossier_document
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return '0';
			}
		}

		public function getNombreLicenceDashboard($id_mod_lic, $type, $id_cli, $id_type_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$nbre = 0;

			$sql = '';
			$sql2 = '';
			$sql3 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND l.id_cli = '.$id_cli;
			}

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND l.id_cli = '.$id_cli;
			}

			if($type == 'EXPIRES'){
				$sql3 = ' AND l.date_val IS NOT NULL ';
			}

			$sommeFob = 0;

			if ($id_mod_lic == '1') {
				
				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.poids AS fob,
														(l.poids) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														l.unit_mes AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3");
			}else{

				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.fob AS fob,
														(l.fob+l.fret+l.assurance+l.autre_frais) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														mo.sig_mon AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				$date_exp2 = $this-> getLastEpirationLicence($reponse['num_lic']);
				$sommeFob += $reponse['fob'];
				
				if ($type == 'EN COURS') {

					if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						$nbre++;
					}

				}else if ($type == 'EXTREME VALIDATION -40 JOURS') {

					if(($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) <= 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						$nbre++;
					}

				}else if ($type == 'EXPIRES') {

					if(($date_exp < $reponse['aujourdhui']) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic'])) && ( $reponse['num_lic'] != $this-> getLicenceApuree($reponse['num_lic'])) ){
						$compteur++;
						$nbre++;
					}

				}else if ($type == 'APPUREES TRACKING ATTENTE BANQUE') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) &&  ( $reponse['num_lic'] != $this-> getLicenceApuree($reponse['num_lic'])) && ($this-> verifierApurementDossierLicence($reponse['num_lic']) == false)){
						$compteur++;
						$nbre++;
					}

				}else if ($type == 'APPUREES PAR BANQUE') {

					if( ($this-> verifierApurementDossierLicence($reponse['num_lic']) != false) && ($reponse['num_lic'] != 'UNDER VALUE') ){
						$compteur++;
						$nbre++;
					}

				}else if ($type == 'CIF LICENCE DIFFERENT CIF DOSSIER(S)') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['cif'] != $this-> getSommeCIFLicence($reponse['num_lic']))){
						$compteur++;
						$nbre++;
					}

				}

			?>
			<?php
			}$requete-> closeCursor();

			return $nbre;
		}

		public function afficherLicencePopUpExcel($id_mod_lic, $type, $id_cli, $id_type_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sql3 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND l.id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND l.id_type_lic = '.$id_type_lic;
			}

			if($type == 'EXPIRES'){
				$sql3 = ' AND l.date_val IS NOT NULL ';
			}

			$sommeFob = 0;

			
			if ($id_mod_lic == '1') {
				
				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.poids AS fob,
														(l.poids) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														l.unit_mes AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3");
			}else{

				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.fob AS fob,
														(l.fob+l.fret+l.assurance+l.autre_frais) AS cif,
														UPPER(cl.nom_cli) AS nom_cli,
														mo.sig_mon AS sig_mon,
														DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
													FROM licence l, client cl, monnaie mo
													WHERE l.id_mod_lic = ?
														AND l.id_cli = cl.id_cli
														AND l.id_mon = mo.id_mon
													$sql
													$sql2
													$sql3");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				$date_exp2 = $this-> getLastEpirationLicence($reponse['num_lic']);
				$bg = "";
				$sommeFob += $reponse['fob'];
				
				if ($type == 'EN COURS') {

					if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'EXTREME VALIDATION -40 JOURS') {

					if(($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) <= 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'EXPIRES') {

					if(($date_exp < $reponse['aujourdhui']) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'APPUREES TRACKING ATTENTE BANQUE') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'APPUREES PAR BANQUE') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] == $this-> getSommeFobAppureLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}else if ($type == 'CIF LICENCE DIFFERENT CIF DOSSIER(S)') {

					if(($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['cif'] != $this-> getSommeCIFLicence($reponse['num_lic']))){
						$compteur++;
						?>
						<tr>	
							<td class="<?php echo $bg;?>" style=" text-align: left;" <?php echo $style;?>><?php echo $compteur;?></td>
							<td class="<?php echo $bg;?>" style="text-align: left;"><?php echo $reponse['num_lic'];?></td>
							<td style="text-align: left;"><?php echo $reponse['nom_cli'];?></td>
							<td style="text-align: center;"><?php echo $reponse['date_val'];?></td>
							<td style="text-align: center;"><?php echo $date_exp2;?></td>
							<td style="text-align: center;"><?php echo $reponse['sig_mon'];?></td>
							<td style="text-align: right;"><?php echo  $reponse['fob'];?></td>
	                    	<td style="text-align: right;">
	                    		<?php echo $reponse['fob']-$this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: center;">
	                    		<?php echo $this->getNbreDossierLicence($reponse['num_lic']);?>
	                    	</td>
	                    	<td style="text-align: right;">
	                    		<?php echo $this->getSommeFobLicence($reponse['num_lic']);?>
	                    	</td>
						</tr>
						<?php
					}

				}

			?>
			<?php
			}$requete-> closeCursor();
		}

		public function afficherDossierLicencePretAppurement($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$requete = $connexion-> prepare("SELECT d.*
												FROM dossier d, client cl
												WHERE d.num_lic = ?
													AND d.id_cli =  cl.id_cli
													AND (d.ref_decl IS NOT NULL
														AND d.ref_decl <> ''
														AND d.ref_liq IS NOT NULL
														AND d.ref_quit IS NOT NULL
														AND d.ref_quit <> '')
													AND d.id_dos NOT IN(
															SELECT id_dos FROM appurement_licence
														)");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['cod'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['montant_av'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<input type="checkbox" name="check_<?php echo $compteur;?>">
						<?php //echo $reponse['ref_quit'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
					<td class="<?php echo $bg;?>" colspan='7' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommeFob, 2, ',', ' ');?>
					</td>
				</tr>
			<?php
		}

		public function afficherDossierLicencePretAppurementExcel($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$requete = $connexion-> prepare("SELECT d.*
												FROM dossier d, client cl
												WHERE d.num_lic = ?
													AND d.id_cli =  cl.id_cli
													AND (d.ref_decl IS NOT NULL
														AND d.ref_liq IS NOT NULL
														AND d.ref_quit IS NOT NULL)
													AND d.id_dos NOT IN(
															SELECT id_dos FROM appurement_licence
														)");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['cod'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['montant_av'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['fob'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<input type="checkbox" name="check_<?php echo $compteur;?>">
						<?php //echo $reponse['ref_quit'];?>
					</td>
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
					<td class="<?php echo $bg;?>" colspan='7' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $sommeFob;?>
					</td>
				</tr>
			<?php
		}

		public function afficherDossierLicenceAppuresBanque($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$requete = $connexion-> prepare("SELECT d.*
												FROM dossier d, client cl
												WHERE d.num_lic = ?
													AND d.id_cli =  cl.id_cli
													AND d.id_dos IN(
															SELECT id_dos FROM appurement_licence
														)");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['cod'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['montant_av'], 2, ',', ' ');?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($reponse['fob'], 2, ',', ' ');?>
					</td>
					<!--<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<input type="checkbox" name="check_<?php echo $compteur;?>">
						<?php //echo $reponse['ref_quit'];?>
					</td>-->
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
					<td class="<?php echo $bg;?>" colspan='7' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo number_format($sommeFob, 2, ',', ' ');?>
					</td>
				</tr>
			<?php
		}

		public function afficherDossierLicenceAppuresBanqueExcel($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$compteur = 0;
			$bg = '';
			$style = '';

			$sql = '';
			$sql2 = '';
			$sommeFob = 0;
			$requete = $connexion-> prepare("SELECT d.*
												FROM dossier d, client cl
												WHERE d.num_lic = ?
													AND d.id_cli =  cl.id_cli
													AND (d.ref_decl IS NOT NULL
														AND d.ref_liq IS NOT NULL
														AND d.ref_quit IS NOT NULL)
													AND d.id_dos IN(
															SELECT id_dos FROM appurement_licence
														)");
			$requete-> execute(array($entree['num_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$bg = "";
				$sommeFob += $reponse['fob'];
				
				/*$ref_dos, $id_cli, $ref_fact, $fob, 
				$fret, $assurance, $autre_frais, $num_lic, 
				$id_mod_lic, $id_march*/

			?>
				<tr class="<?php echo $bg;?>" <?php echo $style;?>>
					<input type="hidden" name="id_dos_<?php echo $compteur;?>" value="<?php echo $reponse['id_dos'];?>">
					<td class="<?php echo $bg;?>" style=" " <?php echo $style;?>>
						<?php echo $compteur;?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['ref_dos'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: left; ">
						<?php echo $reponse['cod'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['montant_av'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_decl'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_liq'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<?php echo $reponse['ref_quit'];?>
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $reponse['fob'];?>
					</td>
					<!--<td class=" <?php echo $bg;?>" style="text-align: center; ">
						<input type="checkbox" name="check_<?php echo $compteur;?>">
						<?php //echo $reponse['ref_quit'];?>
					</td>-->
				</tr>
			<?php
			}$requete-> closeCursor();
			?>
				<tr>
					<input type="hidden" name="nbre" value="<?php echo $compteur;?>">
					<td class="<?php echo $bg;?>" colspan='7' style="text-align: right;" <?php echo $style;?>>
						TOTAL
					</td>
					<td class=" <?php echo $bg;?>" style="text-align: right; ">
						<?php echo $sommeFob;?>
					</td>
				</tr>
			<?php
		}

		//FIN Methodes permettant d'afficher

		//Methode permettant de verifier 
		public function verifierUtilisateur($pseudo_util, $pass_util){
			include('connexion.php');
			$entree['pseudo_util'] = $pseudo_util;
			$entree['pass_util'] = $pass_util;

			$requete = $connexion-> prepare('SELECT id_util
												FROM utilisateur
												WHERE pseudo_util = ?
													AND pass_util = ?');
			$requete-> execute(array($entree['pseudo_util'], $entree['pass_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_util'];
			}else{
				return false;
			}
		}

		public function verifierDimancheDate($la_date){
			include('connexion.php');
			$entree['la_date'] = $la_date;

			$requete = $connexion-> prepare('SELECT day_name
												FROM time_dimension
												WHERE la_date = ?
													AND day_name = \'Sunday\'');
			$requete-> execute(array($entree['la_date']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['day_name'];
			}else{
				return false;
			}
		}

		public function verifierDocumentApurement($num_lic, $ref_apure, $date_apure){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['ref_apure'] = $ref_apure;
			$entree['date_apure'] = $date_apure;

			$requete = $connexion-> prepare('SELECT id_doc
												FROM document_appurement
												WHERE num_lic = ?
													AND ref_apure = ?
													AND date_apure = ?');
			$requete-> execute(array($entree['num_lic'], $entree['ref_apure'], $entree['date_apure']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_doc'];
			}else{
				return false;
			}
		}

		public function verifierTransmissionApurement($ref_trans_ap, $date_trans_ap, $banque){
			include('connexion.php');
			$entree['ref_trans_ap'] = $ref_trans_ap;
			$entree['date_trans_ap'] = $date_trans_ap;
			$entree['banque'] = $banque;

			$requete = $connexion-> prepare("SELECT id_trans_ap
												FROM transmission_apurement
												WHERE ref_trans_ap = ?
													AND date_trans_ap = ?
													AND banque = ?
													AND id_util = ?");
			$requete-> execute(array($entree['ref_trans_ap'], $entree['date_trans_ap'], $entree['banque'], $_SESSION['id_util']));
			$reponse = $requete-> fetch();
			return $reponse['id_trans_ap'];
		}

		public function getTransmissionApurement($id_trans_ap){
			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare("SELECT ref_trans_ap, id_trans_ap, 
													DATE_FORMAT(date_trans_ap, '%d/%m/%Y') AS date_trans_ap, 
													DATE_FORMAT(date_trans_ap, '%d-%m-%Y') AS date_trans_ap2, 
													UPPER(banque) AS banque,
													date_depot
												FROM transmission_apurement
												WHERE id_trans_ap = ?");
			$requete-> execute(array($entree['id_trans_ap']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function verifierClient($nom_cli){
			include('connexion.php');
			$entree['nom_cli'] = $nom_cli;
			//$entree['pass_util'] = $pass_util;

			$requete = $connexion-> prepare('SELECT id_cli
												FROM client
												WHERE nom_cli = ?');
			$requete-> execute(array($entree['nom_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_cli'];
			}else{
				return false;
			}
		}

		public function verifierDossier($ref_dos){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			//$entree['pass_util'] = $pass_util;

			$requete = $connexion-> prepare('SELECT id_dos
												FROM dossier
												WHERE ref_dos = ?');
			$requete-> execute(array($entree['ref_dos']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_dos'];
			}else{
				return false;
			}
		}

		// public function verifierApurementDossier($id_dos){
		// 	include('connexion.php');
		// 	$entree['id_dos'] = $id_dos;
		// 	//$entree['pass_util'] = $pass_util;

		// 	$requete = $connexion-> prepare('SELECT id_dos
		// 										FROM detail_apurement
		// 										WHERE id_dos = ?');
		// 	$requete-> execute(array($entree['id_dos']));
		// 	$reponse = $requete-> fetch();
		// 	if($reponse){
		// 		return $reponse['id_dos'];
		// 	}else{
		// 		return false;
		// 	}
		// }
		//FIN Methode permettant de verifier 

		//Methode permettant de recuperer

		public function getTailleCompteur($i){
			if(strlen($i) == '1' ){
				$i = '00'.$i;
			}else if(strlen($i) == '2' ){
				$i = '0'.$i;
			}else if(strlen($i) == '3' ){
				$i = ''.$i;
			}
			return $i;
		}
		
		public function getTailleCompteur2($i){
			if(strlen($i) == '1' ){
				$i = '000'.$i;
			}else if(strlen($i) == '2' ){
				$i = '00'.$i;
			}else if(strlen($i) == '3' ){
				$i = '0'.$i;
			}else if(strlen($i) == '4' ){
				$i = ''.$i;
			}
			return $i;
		}
		
		public function nbreSummary($statut, $id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['statut'] = $statut;

			$sqlClient = '';
			$sqlModeTransport = '';
			$sqlCommodity = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlModeTransport = ' AND id_mod_trans = "'.$id_mod_trans.'"';
			}else{
				$sqlModeTransport = '';
			}

			if (isset($commodity) && ($commodity!='')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE id_mod_lic = ?
												AND statut = ?
												$sqlClient
												$sqlModeTransport
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic'], $entree['statut']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreSummaryStatus($statut, $id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$statut = str_replace('\'', '', str_replace('_', '/', $statut));

			$sqlClient = '';
			$sqlModeTransport = '';
			$sqlCommodity = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlModeTransport = ' AND id_mod_trans = "'.$id_mod_trans.'"';
			}else{
				$sqlModeTransport = '';
			}

			if (isset($commodity) && ($commodity!='')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			if($id_mod_lic=='2' && $id_mod_trans=='1'){
				if ($statut == 'AWAITING CRF/AD/INSURANCE') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NULL
													AND date_ad IS NULL
													AND date_assurance IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'AWAITING CRF/AD') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NULL
													AND date_ad IS NULL
													AND date_assurance IS NOT NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'AWAITING CRF/INSURANCE') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'AWAITING CRF') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NULL AND date_ad IS NOT NULL AND date_assurance IS NOT NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'AWAITING AD/INSURANCE') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NOT NULL
													AND date_ad IS NULL
													AND date_assurance IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'AWAITING AD') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_ad IS NULL AND date_crf IS NOT NULL AND date_assurance IS NOT NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'AWAITING INSURANCE') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_assurance IS NULL  AND date_ad IS NOT NULL AND date_crf IS NOT NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'UNDER PREPARATION') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NOT NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NOT NULL
													AND date_decl IS NULL 
													AND ref_decl IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'UNDER PREPARATION-EXCPECTED TO ARRIVE') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NOT NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NOT NULL
													AND klsa_arriv IS NULL 
													AND date_decl IS NULL 
													AND ref_decl IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'UNDER PREPARATION-DISPATCHED') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NOT NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NOT NULL
													AND dispatch_klsa IS NOT NULL 
													AND wiski_arriv IS NOT NULL
													AND date_decl IS NULL 
													AND ref_decl IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'UNDER PREPARATION-AT WISKY') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NOT NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NOT NULL
													AND dispatch_klsa IS NULL 
													AND wiski_arriv IS NOT NULL
													AND date_decl IS NULL 
													AND ref_decl IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'AWAITING LIQUIDATION') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_decl IS NOT NULL 
													AND ref_decl IS NOT NULL
													AND date_liq IS NULL 
													AND ref_liq IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'AWAITING QUITTANCE') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_liq IS NOT NULL 
													AND ref_liq IS NOT NULL
													AND date_quit IS NULL 
													AND ref_quit IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'AWAITING BAE/BS') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_quit IS NOT NULL 
													AND ref_quit IS NOT NULL
													AND dgda_out IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'CLEARING COMPLETED') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_quit IS NOT NULL 
													AND ref_quit IS NOT NULL
													AND dgda_out IS NOT NULL
													AND dispatch_deliv IS NOT NULL
													AND ref_dos NOT LIKE '%20-%'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}
			}else{
				$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND REPLACE(statut, '\'','') = '$statut'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreSummaryStatusClient($statut, $id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$statut = str_replace('\'', '', str_replace('_', '/', $statut));

			$sqlClient = '';
			$sqlModeTransport = '';
			$sqlCommodity = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}else{
				$sqlClient = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans!='')) {
				$sqlModeTransport = ' AND id_mod_trans = "'.$id_mod_trans.'"';
			}else{
				$sqlModeTransport = '';
			}

			if (isset($commodity) && ($commodity!='')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			if($id_mod_lic=='2' && $id_mod_trans=='1'){
				if ($statut == 'AWAITING CRF/AD/INSURANCE') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (date_crf IS NULL
														OR date_ad IS NULL
														OR date_assurance IS NULL
														)
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport
													$sqlCommodity");

				}else if ($statut == 'UNDER PREPARATION') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_crf IS NOT NULL
													AND date_ad IS NOT NULL
													AND date_assurance IS NOT NULL
													AND date_decl IS NULL 
													AND ref_decl IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport");

				}else if ($statut == 'AWAITING LIQUIDATION') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_decl IS NOT NULL 
													AND ref_decl IS NOT NULL
													AND date_liq IS NULL 
													AND ref_liq IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport");

				}else if ($statut == 'AWAITING QUITTANCE') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_liq IS NOT NULL 
													AND ref_liq IS NOT NULL
													AND date_quit IS NULL 
													AND ref_quit IS NULL
													AND ref_dos NOT LIKE '%20-%'
													AND cleared <> '2'
													$sqlClient
													$sqlModeTransport");

				}else if ($statut == 'AWAITING BAE/BS') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_quit IS NOT NULL 
													AND ref_quit IS NOT NULL
													AND dgda_out IS NULL
													$sqlClient
													$sqlModeTransport");

				}else if ($statut == 'CLEARING COMPLETED') {

					$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND date_quit IS NOT NULL 
													AND ref_quit IS NOT NULL
													AND dgda_out IS NOT NULL
													AND dispatch_deliv IS NOT NULL
													$sqlClient
													$sqlModeTransport");

				}
			}else{
				$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND REPLACE(statut, '\'','') = '$statut'
													$sqlClient
													$sqlModeTransport");
			}

			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function getSummary($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			$requete = $connexion-> prepare("SELECT REPLACE(nom_stat, '\'','') AS nom_stat, nom_stat AS nom_stat2
												FROM status_dashboard
													WHERE id_mod_lic = ?
													AND active ='1'
												ORDER BY rang_stat");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse=$requete-> fetch()){
			?>

	          <div class="col-md-3 col-sm-6 col-12">

	            <div class="small-box bg-<?php echo $bg[rand(1, 8)];?>">
	              <div class="inner">
	                <h3>
	                  <?php echo number_format($this-> nbreSummary($reponse['nom_stat2'], $id_mod_lic, $id_cli, $id_mod_trans, $commodity), 0, ',', ' ');?>
	                </h3>

	                <p> <?php echo $reponse['nom_stat2'];?> </p>
	              </div>
	              <div class="icon">
	                <i class="fas fa-file"></i>
	              </div>
	              <a href="#" class="small-box-footer" onclick="window.open('popUpDashboardDossier.php?statut=<?php echo $reponse['nom_stat'];?>&id_mod_lic=<?php echo $_GET['id_mod_trac'];?>&id_mod_trans=<?php echo $_GET['id_mod_trans'];?>&id_cli=<?php echo $_GET['id_cli'];?>&commodity=<?php echo $_GET['commodity'];?>','pop1','width=1500,height=950');">
	                More info <i class="fas fa-arrow-circle-right"></i>
	              </a>
	            </div>

	            <!-- /.info-box -->
	          </div>
	        
			<?php
			}$requete-> closeCursor();
		}

		public function getSummaryClient($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			$requete = $connexion-> prepare("SELECT REPLACE(nom_stat, '\'','') AS nom_stat, nom_stat AS nom_stat2
												FROM status_dashboard
													WHERE id_mod_lic = ?
													AND active ='1'
												ORDER BY rang_stat");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse=$requete-> fetch()){
			?>

	          <div class="col-md-3 col-sm-6 col-12">

	            <!--<div class="small-box bg-<?php echo $bg[rand(1, 8)];?>">-->
	            <div class="small-box bg-dark">
	              <div class="inner">
	                <h5>
	                  <?php echo number_format($this-> nbreSummary($reponse['nom_stat2'], $id_mod_lic, $id_cli, $id_mod_trans, $commodity), 0, ',', ' ');?>
	                </h5>

	                <p> <?php echo $reponse['nom_stat2'];?> </p>
	              </div>
	              <div class="icon">
	                <i class="fas fa-file"></i>
	              </div>
	              <a href="#" class="small-box-footer" onclick="window.open('popUpDashboardAutomatique.php?statut=<?php echo $reponse['nom_stat'];?>&id_mod_lic=<?php echo $_GET['id_mod_trac'];?>&id_mod_trans=<?php echo $_GET['id_mod_trans'];?>&id_cli=<?php echo $_GET['id_cli'];?>&commodity=<?php echo $_GET['commodity'];?>','pop1','width=800,height=600');">
	                More info <i class="fas fa-arrow-circle-right"></i>
	              </a>
	            </div>

	            <!-- /.info-box -->
	          </div>
	        
			<?php
			}$requete-> closeCursor();
		}

		public function getSummaryClient2($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			$requete = $connexion-> prepare("SELECT REPLACE(nom_stat, '\'','') AS nom_stat, nom_stat AS nom_stat2
												FROM status_dashboard
													WHERE id_mod_lic = ?
														AND nom_stat <> 'CEEC OUT'
														AND nom_stat <> 'DECLARATION'
														AND nom_stat <> 'MINE DIVISION OUT'
														AND nom_stat <> 'UNDER FORMALITIES'
														AND nom_stat <> 'BORDER FORMALITIES'
														AND active ='1'
												ORDER BY rang_stat");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse=$requete-> fetch()){
				$compteur++;
				if ($this-> nbreSummaryStatus($reponse['nom_stat2'], $id_mod_lic, $id_cli, $id_mod_trans, $commodity)>0) {
			?>

            <tr>
              <td><?php echo $reponse['nom_stat2'];?></td>
              <td>
              	<!-- <span class="badge bg-<?php echo $bg[rand(1, 8)];?>"> -->
              	<?php echo number_format($this-> nbreSummaryStatus($reponse['nom_stat2'], $id_mod_lic, $id_cli, $id_mod_trans, $commodity), 0, ',', ' ');?>
              	<!-- </span> -->
              </td>
              <td style="text-align: center;">
              	<button class="btn btn-xs bg-purple" onclick="window.open('popUpDashboardAutomatique.php?statut=<?php echo $reponse['nom_stat'];?>&id_mod_lic=<?php echo $id_mod_lic;?>&id_mod_trans=<?php echo $id_mod_trans;?>&id_cli=<?php echo $id_cli;?>&commodity=<?php echo $commodity;?>','pop1','width=800,height=600');">
              		<i class="fa fa-eye"></i>
              	</button>
              </td>
            </tr>
	        
			<?php
					// code...
				}
			}$requete-> closeCursor();
		}

		public function getSummaryClientAIR($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = 0;
			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			$requete = $connexion-> prepare("SELECT REPLACE(nom_stat, '\'','') AS nom_stat, nom_stat AS nom_stat2
												FROM status_dashboard
													WHERE id_mod_lic = ?
													AND active ='1'
													AND nom_stat <> 'AT KLSA'
													AND nom_stat <> 'DISPATCHED FROM WISKI'
													AND nom_stat <> 'UNDER PROCESS AT WISKI'
													AND nom_stat <> 'AT KBP'
													AND nom_stat <> 'AT AMICONGO'
													AND nom_stat <> 'AWAITING AD'
													AND nom_stat <> 'AWAITING ASSURANCE'
													AND nom_stat <> 'AWAITING CRF'
													AND nom_stat <> 'CEEC OUT'
													AND nom_stat <> 'DECLARATION'
													AND nom_stat <> 'MINE DIVISION OUT'
													AND nom_stat <> 'UNDER FORMALITIES'
													AND nom_stat <> 'BORDER FORMALITIES'
													AND nom_stat <> 'AT KOLWEZI'
												ORDER BY rang_stat");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse=$requete-> fetch()){
				$compteur++;
				if ($this-> nbreSummaryStatus($reponse['nom_stat2'], $id_mod_lic, $id_cli, $id_mod_trans, $commodity) > 0) {
			?>

            <tr>
              <td><?php echo $reponse['nom_stat2'];?></td>
              <td>
              	<!-- <span class="badge bg-<?php echo $bg[rand(1, 8)];?>"> -->
              	<?php echo number_format($this-> nbreSummaryStatus($reponse['nom_stat2'], $id_mod_lic, $id_cli, $id_mod_trans, $commodity), 0, ',', ' ');?>
              	<!-- </span> -->
              </td>
              <td style="text-align: center;">
              	<button class="btn btn-xs bg-purple" onclick="window.open('popUpDashboardAutomatique.php?statut=<?php echo $reponse['nom_stat'];?>&id_mod_lic=<?php echo $id_mod_lic;?>&id_mod_trans=<?php echo $id_mod_trans;?>&id_cli=<?php echo $id_cli;?>&commodity=<?php echo $commodity;?>','pop1','width=800,height=600');">
              		<i class="fa fa-eye"></i>
              	</button>
              </td>
            </tr>
	        
			<?php
				}
			}$requete-> closeCursor();
		}

		public function getSummaryStatus($id_mod_lic, $id_cli, $id_mod_trans, $commodity, $status){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$bg[1] = 'teal';
			$bg[2] = 'info';
			$bg[3] = 'primary';
			$bg[4] = 'success';
			$bg[5] = 'olive';
			$bg[6] = 'warning';
			$bg[7] = 'dark';
			$bg[8] = 'danger';

			
			?>

	          <div class="col-md-3 col-sm-6 col-12">

	            <div class="small-box bg-<?php echo $bg[rand(1, 8)];?>">
	              <div class="inner">
	                <h3>
	                  <?php echo number_format($this-> nbreSummaryStatus($status, $id_mod_lic, $id_cli, $id_mod_trans, $commodity), 0, ',', ' ');?>
	                </h3>

	                <p> <?php echo strtoupper($status);?> </p>
	              </div>
	              <div class="icon">
	                <i class="fas fa-file"></i>
	              </div>
	              <a href="#" class="small-box-footer" onclick="window.open('popUpDashboardDossierAutomatique.php?statut=<?php echo str_replace('/', '_', $status);?>&id_mod_lic=<?php echo $_GET['id_mod_trac'];?>&id_mod_trans=<?php echo $_GET['id_mod_trans'];?>&id_cli=<?php echo $_GET['id_cli'];?>&commodity=<?php echo $_GET['commodity'];?>','pop1','width=1500,height=950');">
	                More info <i class="fas fa-arrow-circle-right"></i>
	              </a>
	            </div>

	            <!-- /.info-box -->
	          </div>
	        
			<?php
		}

		public function getDataRow($champ_col, $id_dos){
			include('connexion.php');
			$entree['champ_col'] = $champ_col;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT $champ_col
												FROM dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse["$champ_col"];
			}
		}

		public function getDataRowCalcul($champ_col, $id_dos){
			include('connexion.php');
			$entree['champ_col'] = $champ_col;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT DATEDIFF(dgda_out, dgda_in) AS dgda_delay,
													DATEDIFF(dispatch_deliv, arrival_date) AS arrival_deliver_delay
												FROM dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataRowCalculNetDays($champ_col, $id_dos){
			include('connexion.php');
			$entree['champ_col'] = $champ_col;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT DATEDIFF(dgda_out, dgda_in) AS dgda_delay,
													DATEDIFF(dispatch_deliv, arrival_date) AS arrival_deliver_delay,
													arrival_date, dispatch_deliv
												FROM dossier
													WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return ( $reponse['arrival_deliver_delay'] - $this-> getWeekendsAndHolidays($reponse['arrival_date'], $reponse['dispatch_deliv']) );
			}
		}

		public function codePourClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT code_cli
												FROM client
													WHERE id_cli = ?");
			$requete-> execute(array($entree['id_cli']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['code_cli'];
			}
		}

		public function getBalanceLicenceDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;


			$requete = $connexion-> prepare("SELECT SUM(poids) AS somme
												FROM dossier
													WHERE id_dos < ?
														AND num_lic = ?");
			$requete-> execute(array($entree['id_dos'], $this-> getDossier($id_dos)['num_lic']));
			$reponse=$requete-> fetch();


			if($reponse){
				return ( ($this-> getLicence2($this-> getDossier($id_dos)['num_lic'])['poids']) - ($reponse['somme']) - ($this-> getDossier($id_dos)['poids']) );
			}
		}

		public function getDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDossier2($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT dos.*,
													((IF(dos.fob_usd IS NULL, 0, dos.fob_usd) +IF(dos.fret_usd IS NULL, 0, dos.fret_usd)+IF(dos.assurance_usd IS NULL, 0, dos.assurance_usd)+IF(dos.autre_frais_usd IS NULL, 0, dos.autre_frais_usd)))*dos.roe_inv AS cif_cdf
												FROM dossier dos
												WHERE dos.id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		// public function getDossier($id_dos){
		// 	include('connexion.php');
		// 	$entree['id_dos'] = $id_dos;

		// 	$requete = $connexion-> prepare("SELECT *, 
		// 											entF.nom_ent AS nom_ent_front, 
		// 											entF.id_ent AS id_ent_front, 
		// 											entrepot_frontiere_dossier.date_in AS date_in_front, 
		// 											entrepot_frontiere_dossier.date_out AS date_out_front, 
		// 											dossier.id_dos AS id_dos
		// 										FROM dossier
		// 										LEFT JOIN frontiere
		// 											ON dossier.id_front = frontiere.id_front
		// 										LEFT JOIN regime
		// 											ON dossier.id_reg = regime.id_reg
		// 										LEFT JOIN entrepot_frontiere_dossier
		// 											ON dossier.id_dos = entrepot_frontiere_dossier.id_dos
		// 										LEFT JOIN entrepot entF
		// 											ON entrepot_frontiere_dossier.id_ent = entF.id_ent
		// 										WHERE dossier.id_dos = ?");
		// 	$requete-> execute(array($entree['id_dos']));
		// 	$reponse=$requete-> fetch();
		// 	if($reponse){
		// 		return $reponse;
		// 	}
		// }

		public function getNomColonneClient($nom_champ, $id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');
			$entree['nom_champ'] = $nom_champ;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT c.titre_col AS titre_col
												FROM colonne c, affectation_colonne_client_modele_licence aff
													WHERE c.champ_col = ?
														AND c.id_col = aff.id_col
														AND aff.id_mod_trans = ?
														AND aff.id_mod_lic = ?");
			$requete-> execute(array($entree['nom_champ'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['titre_col'];
			}
		}

		public function getNombreIrSansAVClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(ref_crf)) AS nbre
												FROM dossier
												WHERE id_cli = ?
													AND cod NOT IN(
															SELECT cod FROM av
														)
													AND ref_crf IS NOT NULL
													AND ref_crf <> ''
													AND ref_crf <> 'N/A'
													AND ref_crf <> '-'
													AND ref_crf NOT LIKE '%UNDER%'
													AND ref_crf <> 'TBC'");
			$requete-> execute(array($entree['id_cli']));
			$reponse=$requete-> fetch();
			//if($reponse){
				return $reponse['nbre'];
			//}
		}

		public function getFactureLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM facture
													WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDossierRefDos($ref_dos){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
													WHERE ref_dos = ?");
			$requete-> execute(array($entree['ref_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDelaiFactureLicence($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT DATEDIFF(DATE(l.date_creat_lic), f.date_fact_rec) AS diff
												FROM licence l, facture_licence f
													WHERE f.ref_fact = ?
														AND f.ref_fact = l.ref_fact");
			$requete-> execute(array($entree['ref_fact']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['diff'];
			}else{
				return null;
			}
		}

		public function verifierExistanceMCAFile($mca_file){
			include('connexion.php');
			$entree['mca_file'] = $mca_file;

			$requete = $connexion-> prepare("SELECT id_dos
												FROM dossier
													WHERE ref_dos = ?");
			$requete-> execute(array($entree['mca_file']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierExistanceMCAFileLogistique($ref_dos){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;

			$requete = $connexion-> prepare("SELECT ref_dos
												FROM dossier_logistique
													WHERE ref_dos = ?");
			$requete-> execute(array($entree['ref_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierReferenceTransmissionApurement($ref_trans_ap){
			include('connexion.php');
			$entree['ref_trans_ap'] = $ref_trans_ap;

			$requete = $connexion-> prepare("SELECT id_trans_ap
												FROM transmission_apurement
													WHERE ref_trans_ap = ?");
			$requete-> execute(array($entree['ref_trans_ap']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function verifierApurementDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT det.id_dos
												FROM detail_apurement det, transmission_apurement tr
													WHERE det.id_dos = ?
														AND det.id_trans_ap = tr.id_trans_ap
														AND tr.fichier_trans_ap IS NOT NULL");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();
			if($reponse){
				return true;
			}
		}

		public function getDataApurementDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(tr.date_trans_ap, '%d/%m/%Y') AS date_trans_ap
												FROM detail_apurement det, transmission_apurement tr
													WHERE det.id_dos = ?
														AND det.id_trans_ap = tr.id_trans_ap");
			$requete-> execute(array($entree['id_dos']));
			$reponse=$requete-> fetch();

			if($reponse){
				return $reponse['ref_trans_ap'].' du '.$reponse['date_trans_ap'];
			}else{
				return null;
			}
		}

		public function verifierApurementDossierLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT COUNT(da.id_dos) AS nbre
												FROM dossier d, detail_apurement da, transmission_apurement tr
													WHERE d.num_lic = ?
														AND d.id_dos = da.id_dos
														AND da.id_trans_ap = tr.id_trans_ap
														AND tr.fichier_trans_ap IS NOT NULL");
			$requete-> execute(array($entree['num_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getNbreMcaFile($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$masque_date = '%'.date('y').'-%';
			$entree['masque_date']= '\'%'.date('y').'-%\'';
			$masque_date= date('y').'-%';

			if ($_GET['id_march']!='' && isset($_GET['id_march'])) {
				$sqlIdMarch = ' AND id_march = '.$_GET['id_march'];
			}else{
				$sqlIdMarch = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre 
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_trans = ?
													AND id_mod_lic = ?
													$sqlIdMarch
													AND ref_dos LIKE '%$masque_date%'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getNbreMcaFileLogistique($id_cli, $id_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_trans'] = $id_trans;
			$masque_date = '%'.date('y').'-%';
			$entree['masque_date']= '\'%'.date('y').'-%\'';

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre 
												FROM dossier_logistique
												WHERE id_cli = ?
													AND id_trans = ?
													-- AND ref_dos LIKE ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_trans']/*, $entree['masque_date']*/));
			$reponse=$requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return false;
			}
		}

		public function getMcaFile($id_cli, $id_mod_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$code = '';

			$nbre = $this->  getNbreMcaFile($id_cli, $id_mod_trans, '2');
			if ($nbre > 20) {
				$i = $nbre-10;
			}else{
				$i = 1;
			}
			
			//$i = $nbre;

			$a = $this-> getTailleCompteur($i);

			//SUL pour import SOMIKA
			if ($id_cli == '872' && $id_mod_trans=='1') {
				$cod_mod_trans = 'SUL';
			}//DIL pour import DILUENT
			elseif ($id_cli == '869' && $_GET['id_march']=='16') {
				$cod_mod_trans = 'DIL';
			}else{
				$cod_mod_trans = $this-> getCodeModeTransport($id_mod_trans);
			}

			$code = $this-> codePourClient($id_cli).'-'.$cod_mod_trans.date('y').'-'.$a;

			while($this-> verifierExistanceMCAFile($code) == true){
				$i++;

				$a = $this-> getTailleCompteur($i);

				$code = $this-> codePourClient($id_cli).'-'.$cod_mod_trans.date('y').'-'.$a;
			}

			return $code;
		}

		public function getMcaFileLogistique($id_cli, $id_trans){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$code = '';

			$nbre = $this->  getNbreMcaFileLogistique($id_cli, $id_trans);

			if ($nbre > 20) {
				$i = $nbre+1;
			}else{
				$i = 1;
			}
			
			//$i = $nbre;

			$a = $this-> getTailleCompteur($i);

			//EXP pour export
			// if ($id_trans=='1') {
			// 	$cod_mod_trans = 'LOG-EXP';
			// }//LOC pour local
			// else if ($id_trans=='2') {
			// 	$cod_mod_trans = 'LOG-LOC';
			// }
			$cod_mod_trans = 'LOG';

			$code = $this-> codePourClient($id_cli).'-'.$cod_mod_trans.date('y').'-'.$a;

			while($this-> verifierExistanceMCAFileLogistique($code) == true){
				$i++;

				$a = $this-> getTailleCompteur($i);

				$code = $this-> codePourClient($id_cli).'-'.$cod_mod_trans.date('y').'-'.$a;
			}

			return $code;
		}

		public function buildReferenceTransmissionApurementModeleLicence($id_mod_lic){
			include('connexion.php');

			$code = '';

			$i = 1;

			$a = $this-> getTailleCompteur2($i);

			$code = $a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');

			while($this-> verifierReferenceTransmissionApurement($code) == true){
				$i++;

				$a = $this-> getTailleCompteur2($i);

				$code = $a.'-'.$this-> getElementModeleLicence($id_mod_lic)['sigle_mod_lic'].'-'.date('y');
			}

			return $code;
		}

		public function getNombreMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;
			$entree['id_mod_lic'] = $id_mod_lic;
			$annee = date('Y');
			$entree['annee'] = "%$annee%";

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre 
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_trans = ?
													AND id_march = ?
													AND id_mod_lic = ?
													AND ref_dos LIKE ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], 
									$entree['id_march'], $entree['id_mod_lic'], $entree['annee']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getNombreMcaFileAcide($id_cli, $id_mod_trans, $id_march, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_march'] = $id_march;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['annee'] = date('Y');

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre 
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_trans = ?
													AND id_march = ?
													AND id_mod_lic = ?
													AND YEAR(date_creat_dos) = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], 
									$entree['id_march'], $entree['id_mod_lic'], $entree['annee']));

			$reponse = $requete-> fetch();

			return $reponse['nbre'];
		}

		public function getMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $compteur, $step=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$code = '';
			if ($id_cli==869 && $id_mod_lic==2) {
				$nbre = $this-> getNombreMcaFileAcide($id_cli, $id_mod_trans, $id_march, $id_mod_lic);
			}else{
				$nbre = $this-> getNombreMcaFileAcide($id_cli, $id_mod_trans, $id_march, $id_mod_lic);
				// $nbre = $this-> getNombreMcaFileExport($id_cli, $id_mod_trans, $id_march, $id_mod_lic);
			}
			
			if ($nbre > 20) {
				
					$i = $nbre-10;
				
				
			}else{
				$i = $compteur;
				
			}
			


			$code_marchandise = $this-> getCodeModeMarchandise($id_cli, $id_mod_lic, $id_march);
			$code_2_marchandise = $this-> getCode2ModeMarchandise($id_cli, $id_mod_lic, $id_march);

			$cod_mod_trans = '';

			if ($id_mod_trans == '4') {
				$cod_mod_trans = $this-> getCodeModeTransport($id_mod_trans);
			}else if ($id_mod_trans == '5') {
				$cod_mod_trans = $this-> getCodeModeTransport($id_mod_trans);
			}

			if ($id_cli == 869 && $id_mod_lic == 2) {
				$a = $this-> getTailleCompteur2($i);
				$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'-'.date('y').'-'.$cod_mod_trans.$a;
			}else{
				if ( ($id_cli == '845') && ($id_mod_lic == '1') && (date('Y')=='2021') && ($id_march == '13') ) {
					$a = $this-> getTailleCompteur2($i);
				}else if ( ($id_cli == '864') && ($id_mod_lic == '1') && (date('Y')=='2021') && ($id_march == '13') ) {
					$a = $this-> getTailleCompteur2($i);
				}else{
					$a = $this-> getTailleCompteur($i);
				}
				if ($id_cli == 874) {
					$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'21'.'-'.$cod_mod_trans.$code_2_marchandise.$a;
				}else{
					$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$code_2_marchandise.$a;
				}
				
			}

			while($this-> verifierExistanceMCAFile($code) == true){
				$i++;

				if ($id_cli == 869 && $id_mod_lic == 2) {
					$a = $this-> getTailleCompteur2($i);
					$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'-'.date('y').'-'.$cod_mod_trans.$a;
					// return $code;
				}else{
					if ( ($id_cli == '845') && ($id_mod_lic == '1') && (date('Y')=='2021') && ($id_march == '13') ) {
						$a = $this-> getTailleCompteur2($i);
					}else if ( ($id_cli == '864') && ($id_mod_lic == '1') && (date('Y')=='2021') && ($id_march == '13') ) {
						$a = $this-> getTailleCompteur2($i);
					}else{
						$a = $this-> getTailleCompteur($i);
					}
					

					if ($id_cli == 874) {
						$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'21'.'-'.$cod_mod_trans.$code_2_marchandise.$a;
					}else{
						$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$code_2_marchandise.$a;
					}

				}

			}

			if (isset($step)) {
				//$a = $this-> getTailleCompteur($a+$step);
				//$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$a;
				if ($id_cli == 869 && $id_mod_lic == 2) {
					$a = $this-> getTailleCompteur2($a+$step);
					//$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'-'.date('y').'-'.$cod_mod_trans.$a;
					$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'-'.date('y').'-'.$cod_mod_trans.$a;
					// if ($id_cli == 874) {
					// 	$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'21'.'-'.$cod_mod_trans.$code_2_marchandise.$a;
					// }else{
					// 	$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$code_2_marchandise.$a;
					// }

				}else{
					if ( ($id_cli == '845') && ($id_mod_lic == '1') && (date('Y')=='2021') && ($id_march == '13') ) {
						$a = $this-> getTailleCompteur2($a+$step);
					}else if ( ($id_cli == '864') && ($id_mod_lic == '1') && (date('Y')=='2021') && ($id_march == '13') ) {
						$a = $this-> getTailleCompteur2($a+$step);
					}else{
						$a = $this-> getTailleCompteur($a+$step);
					}
					
					//$a = $this-> getTailleCompteur($a+$step);
					//$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$code_2_marchandise.$a;
					if ($id_cli == 874) {
						$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.'21'.'-'.$cod_mod_trans.$code_2_marchandise.$a;
					}else{
						$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$code_2_marchandise.$a;
					}
				}

			}

			return $code;
		}

		/*public function getMcaFileExportData($id_cli, $id_mod_trans, $id_march, $id_mod_lic, $compteur){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$code = '';

			$i = $compteur;

			$a = $this-> getTailleCompteur($i);

			$code_marchandise = $this-> getCodeModeMarchandise($id_cli, $id_mod_lic, $id_march);

			$cod_mod_trans = '';

			if ($id_mod_trans == '4') {
				$cod_mod_trans = $this-> getCodeModeTransport($id_mod_trans);
			}

			$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$a;

			while($this-> verifierExistanceMCAFile($code) == true){
				$i++;

				$a = $this-> getTailleCompteur($i);

				$code = $this-> codePourClient($id_cli).'-'.$code_marchandise.date('y').'-'.$cod_mod_trans.$a;
			}

			return $code;
		}*/

		public function getCodeModeTransport($id_mod_trans){
			include('connexion.php');
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT UPPER(cod_mod_trans) AS cod_mod_trans
												FROM mode_transport
												WHERE id_mod_trans = ?");
			$requete-> execute(array($entree['id_mod_trans']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['cod_mod_trans'];
			}
		}

		public function getCodeModeMarchandise($id_cli, $id_mod_lic, $id_march){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("SELECT code
												FROM affectation_marchandise_client_modele_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_march = ?
													AND active = '1'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['code'];
			}
		}

		public function getCode2ModeMarchandise($id_cli, $id_mod_lic, $id_march){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("SELECT code_2
												FROM affectation_marchandise_client_modele_licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND id_march = ?
													AND active = '1'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['code_2'];
			}
		}

		public function getNom($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT UPPER(nom_util) AS nom_util
												FROM utilisateur
												WHERE id_util = ?");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_util'];
			}
		}

		public function getNomModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT UPPER(nom_mod_lic) AS nom_mod_lic
												FROM modele_licence
												WHERE id_mod_lic = ?");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_mod_lic'];
			}
		}

		public function getNomTransit($id_trans){
			include('connexion.php');
			$entree['id_trans'] = $id_trans;

			$requete = $connexion-> prepare("SELECT UPPER(nom_trans) AS nom_trans
												FROM transit
												WHERE id_trans = ?");
			$requete-> execute(array($entree['id_trans']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_trans'];
			}
		}

		public function getWeekendsAndHolidays($debut, $fin){
			include('connexion.php');
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			$requete = $connexion-> prepare("SELECT COUNT(id) AS nbre
												FROM time_dimension
												WHERE (day_name = 'Sunday'
													OR day_name = 'Saturday'
													OR holiday_flag = '1')
													AND la_date BETWEEN ? AND ?");
			$requete-> execute(array($entree['debut'], $entree['fin']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getWeekendsAndHolidaysBackUp($debut, $fin){
			include('connexion.php');
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			$requete = $connexion-> prepare("SELECT COUNT(id) AS nbre
												FROM time_dimension
												WHERE (weekend_flag = '1'
													OR holiday_flag = '1')
													AND la_date BETWEEN ? AND ?");
			$requete-> execute(array($entree['debut'], $entree['fin']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare("SELECT *
												FROM client
												WHERE id_cli = ?");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getSubClass($id_sub_class){
			include('connexion.php');
			$entree['id_sub_class'] = $id_sub_class;

			$requete = $connexion-> prepare("SELECT *
												FROM sub_classe_compte
												WHERE id_sub_class = ?");
			$requete-> execute(array($entree['id_sub_class']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getCompte($id_compte){
			include('connexion.php');
			$entree['id_compte'] = $id_compte;

			$requete = $connexion-> prepare("SELECT *
												FROM compte
												WHERE id_compte = ?");
			$requete-> execute(array($entree['id_compte']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getFournisseur($id_four){
			include('connexion.php');
			$entree['id_four'] = $id_four;

			$requete = $connexion-> prepare("SELECT *
												FROM fournisseur
												WHERE id_four = ?");
			$requete-> execute(array($entree['id_four']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLastLicenceClient($id_cli, $id_mod_lic, $id_mod_trans, $id_march=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			if ( ($id_mod_lic==1) && (isset($id_march) && ($id_march!=NULL))) {
				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_march = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC
												LIMIT 0, 1");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
				# code...
			}else{

				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC
												LIMIT 0, 1");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			}
			
			/*$requete = $connexion-> prepare("SELECT *
												FROM licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
												ORDER BY date_creat_lic DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));*/
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLastFactureDossier($id_cli, $id_mod_lic, $id_mod_trans, $id_march=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT facture_dossier.ref_fact AS ref_fact
												FROM facture_dossier, dossier, detail_facture_dossier
												WHERE facture_dossier.id_cli = ?
													AND facture_dossier.id_mod_lic = ?
													AND facture_dossier.ref_fact = detail_facture_dossier.ref_fact
													AND detail_facture_dossier.id_dos = dossier.id_dos
													AND dossier.id_mod_trans = ?
													AND dossier.id_march = ?
												GROUP BY facture_dossier.ref_fact
												ORDER BY detail_facture_dossier.ref_fact DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				$reponse['ref_fact']++;
				return $reponse['ref_fact'];
			}
		}

		public function getLastLicenceClientActive($id_cli, $id_mod_lic, $id_mod_trans, $id_march=NULL){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;

			if ( ($id_mod_lic==1) && (isset($id_march) && ($id_march!=NULL))) {
				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_march = ?
													AND id_mod_trans = ?
													AND affichier_tracking = '1'
												ORDER BY date_creat_lic  DESC
												LIMIT 0, 1");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_march'], $entree['id_mod_trans']));
				# code...
			}else{

				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC
												LIMIT 0, 1");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			}
			
			/*$requete = $connexion-> prepare("SELECT *
												FROM licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
												ORDER BY date_creat_lic DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));*/
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getIdClient($nom_cli){
			include('connexion.php');
			$entree['nom_cli'] = $nom_cli;

			$requete = $connexion-> prepare("SELECT *
												FROM client
												WHERE nom_cli = ?");
			$requete-> execute(array($entree['nom_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_cli'];
			}
		}

		public function getIdDossierClientLicence($ref_dos, $id_cli, $num_lic){
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['id_cli'] = $id_cli;
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT id_dos
												FROM dossier
												WHERE ref_dos = ?
													AND id_cli = ?
													AND num_lic = ?");
			$requete-> execute(array($entree['ref_dos'], $entree['id_cli'], $entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_dos'];
			}
		}

		public function getIdMonnaie($sig_mon){
			include('connexion.php');
			$entree['sig_mon'] = $sig_mon;

			$requete = $connexion-> prepare("SELECT *
												FROM monnaie
												WHERE sig_mon = ?");
			$requete-> execute(array($entree['sig_mon']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_mon'];
			}else{
				return false;
			}
		}

		public function getMonnaie($id_mon){
			include('connexion.php');
			$entree['id_mon'] = $id_mon;

			$requete = $connexion-> prepare("SELECT *
												FROM monnaie
												WHERE id_mon = ?");
			$requete-> execute(array($entree['id_mon']));
			$reponse = $requete-> fetch();
			return $reponse;
		}

		public function getStructureTracking($id_march){
			include('connexion.php');
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare("SELECT id_struct
												FROM marchandise
												WHERE id_march = ?");
			$requete-> execute(array($entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_struct'];
			}
		}

		public function getDataFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT *
												FROM facture_licence
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataFacture2($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT *
												FROM facture_dossier
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getPoidsFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT SUM(dossier.poids) AS poids
												FROM detail_facture_dossier, dossier
												WHERE detail_facture_dossier.ref_fact = ?
													AND detail_facture_dossier.id_dos = dossier.id_dos
												GROUP BY detail_facture_dossier.id_deb");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['poids'];
			}
		}

		public function getPoidsFactureFERE($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT SUM(dossier.poids) AS poids
												FROM detail_facture_dossier, dossier
												WHERE detail_facture_dossier.ref_fact = ?
													AND detail_facture_dossier.id_dos = dossier.id_dos
													AND (dossier.pied_container IS NULL OR dossier.pied_container = '')
												GROUP BY detail_facture_dossier.id_deb");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['poids'];
			}
		}

		public function getDataAv($cod){
			include('connexion.php');
			$entree['cod'] = $cod;

			$requete = $connexion-> prepare("SELECT *
												FROM av
												WHERE cod = ?");
			$requete-> execute(array($entree['cod']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataMouvementTresorerie($id_mvt){
			include('connexion.php');
			$entree['id_mvt'] = $id_mvt;

			$requete = $connexion-> prepare("SELECT *
												FROM mouvement_tresorerie
												WHERE id_mvt = ?");
			$requete-> execute(array($entree['id_mvt']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataDossier($id_dos){
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT *,
													DATE_FORMAT(date_decl, '%d/%m/%Y') AS date_decl_dos,
													DATE_FORMAT(date_liq, '%d/%m/%Y') AS date_liq_dos,
													DATE_FORMAT(date_quit, '%d/%m/%Y') AS date_quit_dos,
													(
														IF(montant_decl IS NOT NULL,
															montant_decl, 0)+
														IF(fret IS NOT NULL,
															fret, 0)+
														IF(assurance IS NOT NULL,
															assurance, 0)+
														IF(autre_frais IS NOT NULL,
															autre_frais, 0)
														) AS cif,
													CONCAT(
														IF(horse IS NOT NULL AND REPLACE(horse, ' ', '') NOT LIKE '',
															horse,
															''),
														IF(trailer_1 IS NOT NULL AND REPLACE(trailer_1, ' ', '') NOT LIKE '',
															CONCAT(' / ', trailer_1),
															''),
														IF(trailer_2 IS NOT NULL AND REPLACE(trailer_2, ' ', '') NOT LIKE '',
															CONCAT(' / ', trailer_2),
															'')
													) AS truck,
													IF(wiski_arriv IS NOT NULL,
														wiski_arriv,
														IF(klsa_arriv IS NOT NULL AND dispatch_klsa IS NOT NULL,
															klsa_arriv,
															'<span class=\'clignoteb text-sm \'>TBC</span>'
														)
													) AS wareh_arriv,
													IF(wiski_dep IS NOT NULL,
														wiski_dep,
														IF(dispatch_klsa IS NOT NULL ,
															dispatch_klsa,
															'<span class=\'clignoteb text-sm \'>TBC</span>'
														)
													) AS wareh_dep,
													IF(wiski_arriv IS NOT NULL AND wiski_dep IS NOT NULL,
														DATEDIFF(wiski_dep, wiski_arriv),
														IF(klsa_arriv IS NOT NULL AND dispatch_klsa IS NOT NULL,
															DATEDIFF(dispatch_klsa, wiski_dep),
															'-'
														)
													) AS wareh_delay,
													IF(klsa_arriv IS NOT NULL AND dispatch_deliv IS NOT NULL,
														DATEDIFF(dispatch_deliv, klsa_arriv),
														IF(klsa_arriv IS NOT NULL AND dispatch_klsa IS NOT NULL,
															DATEDIFF(dispatch_klsa, dispatch_deliv),
															'-'
														)
													) AS dispatch_delay
												FROM dossier
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataDeclaration($date_decl){
			include('connexion.php');
			$entree['date_decl'] = $date_decl;

			$requete = $connexion-> prepare("SELECT *
												FROM dossier
												WHERE date_decl = ?
													AND roe_liq > 0");
			$requete-> execute(array($entree['date_decl']));
			$reponse = $requete-> fetch();
			return $reponse;
			
		}

		public function getDataUtilisateur($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT *
												FROM utilisateur
												WHERE id_util = ?");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLicenceFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("SELECT num_lic
												FROM licence
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['num_lic'];
			}
		}

		public function getSouscriptionLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT num_lic
												FROM licence
												WHERE num_lic = ?
													AND id_cli IN (
														SELECT id_cli
															FROM souscription_licence
													)");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getSoldeCompte($id_compte){
			include('connexion.php');
			$entree['id_compte'] = $id_compte;

			$requete = $connexion-> prepare("SELECT (SUM(IF(debit IS NULL, 0, debit))-SUM(IF(credit IS NULL, 0, credit))) AS solde_1,
													IF((SUM(IF(debit IS NULL, 0, debit))-SUM(IF(credit IS NULL, 0, credit)))>0,
														(SUM(IF(debit IS NULL, 0, debit))-SUM(IF(credit IS NULL, 0, credit))),
														(SUM(IF(credit IS NULL, 0, credit))-SUM(IF(debit IS NULL, 0, debit)))
													) AS solde,
													IF((SUM(IF(debit IS NULL, 0, debit))-SUM(IF(credit IS NULL, 0, credit)))>0,
														'Dr',
														'Cr'
													) AS type_solde
												FROM detail_ecriture
												WHERE id_compte = ?");
			$requete-> execute(array($entree['id_compte']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['solde'];
			}else{
				return '0';
			}
		}

		public function getSoldeCompte2($id_compte){
			include('connexion.php');
			$entree['id_compte'] = $id_compte;

			// $requete = $connexion-> prepare("SELECT (SUM(IF(debit IS NULL, 0, debit))-SUM(IF(credit IS NULL, 0, credit))) AS solde_1,
			// 										IF((SUM(IF(debit IS NULL, 0, debit))-SUM(IF(credit IS NULL, 0, credit)))>0,
			// 											(SUM(IF(debit IS NULL, 0, debit))-SUM(IF(credit IS NULL, 0, credit))),
			// 											(SUM(IF(credit IS NULL, 0, credit))-SUM(IF(debit IS NULL, 0, debit)))
			// 										) AS solde,
			// 										IF((SUM(debit) IS NOT NULL) OR (SUM(credit) IS NOT NULL),
			// 											IF((SUM(IF(debit IS NULL, 0, debit))-SUM(IF(credit IS NULL, 0, credit)))>0,
			// 												'Dr',
			// 												'Cr'
			// 											),
			// 											''
			// 										) AS type_solde
			// 									FROM detail_ecriture
			// 									WHERE id_compte = ?");

			$requete = $connexion-> prepare("SELECT IF((SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon=c.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))-SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=c.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant)))))>0,
														SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon=c.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))-SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=c.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant)))),
														SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=c.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant))))-SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon=c.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))
													) AS solde,
													IF((SUM(debit) IS NOT NULL) OR (SUM(credit) IS NOT NULL),
														IF((SUM(IF(det.debit IS NULL, 0, IF(ec.id_mon=c.id_mon, det.debit, IF(ec.id_mon='1', det.debit, det.debit/te.montant))))-SUM(IF(det.credit IS NULL, 0, IF(ec.id_mon=c.id_mon, det.credit, IF(ec.id_mon='1', det.credit, det.credit/te.montant)))))>0,
															'Dr',
															'Cr'
														),
														''
													) AS type_solde
												FROM detail_ecriture det, compte c, ecriture ec, taux_echange te
												WHERE c.id_compte = ?
													AND c.id_compte = det.id_compte
													AND det.id_e = ec.id_e
													AND ec.id_taux = te.id_taux");
			$requete-> execute(array($entree['id_compte']));
			$reponse = $requete-> fetch();
			return $reponse;

		}

		public function getLicenceApuree($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT num_lic
												FROM licence
												WHERE num_lic = ?
													AND apurement = '1'");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['num_lic'];
			}
		}

		public function getIdDocumentAppurement($fichier_doc, $id_util){
			include('connexion.php');
			$entree['fichier_doc'] = $fichier_doc;
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT id_doc
												FROM document_appurement
												WHERE fichier_doc = ?
													AND id_util = ?
												ORDER BY id_doc DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['fichier_doc'], $entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_doc'];
			}
		}

		public function getLastTaux(){
			include('connexion.php');
			// $entree['id_util'] = $id_util;

			$requete = $connexion-> query("SELECT *
												FROM taux_echange
												ORDER BY id_taux DESC
												LIMIT 0, 1");
			// $requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}else{
				$reponse['id_taux'] = NULL;
				$reponse['montant'] = NULL;
				return $reponse;
			}
		}

		public function getLastEcritureUtilisateur($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT *
											FROM ecriture
											WHERE id_util = ?
											ORDER BY id_e DESC
											LIMIT 0, 1");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLastDossierRisqueDouaneUtilisateur($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT *
											FROM dossier_risque_douane
											WHERE id_util = ?
											ORDER BY id DESC
											LIMIT 0, 1");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLastIdDocumentAppurement($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare("SELECT id_doc
												FROM document_appurement
												WHERE id_util = ?
												ORDER BY id_doc DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_doc'];
			}
		}

		public function getLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT l.*, cl.*, 
													IF(l.poids IS NULL OR l.poids='', 0, l.poids) AS poids_lic,
													IF(l.consommable='1', 'Consommable', 'Divers') AS label_consommable
												FROM licence l, client cl
												WHERE l.num_lic = ?
													AND l.id_cli = cl.id_cli");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}else{
				return null;
			}
		}

		public function getLicenceCOD($cod){
			include('connexion.php');
			$entree['cod'] = $cod;

			$requete = $connexion-> prepare("SELECT l.*, cl.*, 
													IF(l.poids IS NULL OR l.poids='', 0, l.poids) AS poids_lic,
													IF(l.consommable='1', 'Consommable', 'Divers') AS label_consommable
												FROM licence l, client cl
												WHERE l.cod = ?
													AND l.id_cli = cl.id_cli");
			$requete-> execute(array($entree['cod']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}else{
				return null;
			}
		}

		public function getLicenceSousTypeModePaiement($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT s.id_sous_type_paie AS id_sous_type_paie,
													CONCAT(s.code,' - ',UPPER(s.nom_sous_type_paie)) AS nom_sous_type_paie
												FROM licence l, sous_type_paiement s
												WHERE l.num_lic = ?
													AND l.id_sous_type_paie = s.id_sous_type_paie");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLicenceModalitePaiement($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT s.id_mod_paie AS id_mod_paie,
													CONCAT(s.code,' - ',UPPER(s.nom_mod_paie)) AS nom_mod_paie
												FROM licence l, modalite_paiement s
												WHERE l.num_lic = ?
													AND l.id_mod_paie = s.id_mod_paie");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getLicence2($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT *
												FROM licence 
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT l.*, m.*, (l.fob+l.fret+l.assurance+l.autre_frais) AS cif,
													DATE_FORMAT(l.date_val, '%d/%m/%Y') AS date_val
												FROM licence l, monnaie m
												WHERE l.num_lic = ?
													AND l.id_mon = m.id_mon");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDataLicence2($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT l.*, m.*, (l.fob+l.fret+l.assurance+l.autre_frais) AS cif
												FROM licence l, monnaie m
												WHERE l.num_lic = ?
													AND l.id_mon = m.id_mon");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
		}

		public function getDateExpirationLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(date_exp, '%d/%m/%Y') AS date_exp
												FROM expiration_licence
												WHERE num_lic = ?
												ORDER BY id_date_exp DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['date_exp'];
			}
		}

		public function getDateExpirationLicence2($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT DATE(date_exp) AS date_exp
												FROM expiration_licence
												WHERE num_lic = ?
												ORDER BY id_date_exp DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['date_exp'];
			}
		}

		public function getNomModeTransport($id_mod_trans){
			include('connexion.php');
			$entree['id_mod_trans'] = $id_mod_trans;

			$requete = $connexion-> prepare("SELECT UPPER(nom_mod_trans) AS nom_mod_trans
												FROM mode_transport
												WHERE id_mod_trans = ?");
			$requete-> execute(array($entree['id_mod_trans']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_mod_trans'];
			}
		}

		public function getSommeFobLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			if ( $this-> getLicence($num_lic)['tonnage'] == '1') {
				
				$requete = $connexion-> prepare("SELECT SUM(poids) AS fob
													FROM dossier
													WHERE num_lic = ?
														AND cleared <> '2'");

			}else{

				$requete = $connexion-> prepare("SELECT SUM(fob) AS fob
													FROM dossier
													WHERE num_lic = ?
														AND cleared <> '2'");
			}

			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['fob'];
			}
		}

		public function getSommeFobTransmisBanqueLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT SUM(d.fob) AS fob
													FROM dossier d, detail_apurement det
													WHERE d.num_lic = ?
														AND d.id_dos = det.id_dos
														AND d.cleared <> '2'");

			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['fob'];
			}
		}

		public function getSommePoidsLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT SUM(poids) AS poids
												FROM dossier
												WHERE num_lic = ?
													AND cleared <> '2'");

		
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['poids'];
			}
		}

		public function getSommeCIFLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT SUM(IFNULL(fob, 0)+IFNULL(fret, 0)+IFNULL(assurance, 0)+IFNULL(autre_frais, 0)) AS cif
												FROM dossier
												WHERE num_lic = ?
													AND cleared <> '2'");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['cif'];
			}
		}

		public function getSommeFobAppureLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT SUM(d.fob) AS fob
												FROM dossier d, detail_apurement ap, transmission_apurement tr
												WHERE d.num_lic = ?
													AND d.cleared <> '2'
													AND d.id_dos = ap.id_dos
													AND ap.id_trans_ap = tr.id_trans_ap
													AND tr.fichier_trans_ap IS NOT NULL
												");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['fob'];
			}
		}


		public function getSommePoidsAppureLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT SUM(d.poids) AS poids
												FROM dossier d, detail_apurement ap
												WHERE d.num_lic = ?
													AND d.id_dos = ap.id_dos
													AND d.cleared <> '2'
												");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['poids'];
			}
		}

		public function getSommeQteLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT SUM(qte_decl) AS qte_decl
												FROM dossier
												WHERE num_lic = ?
													AND cleared <> '2'");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['qte_decl'];
			}
		}

		public function getNbreDossierLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE num_lic = ?
													AND cleared <> '2'");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNbreDossierTransmisBanqueLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(d.id_dos)) AS nbre
												FROM dossier d, detail_apurement det
												WHERE d.num_lic = ?
													AND d.id_dos = det.id_dos
													AND d.cleared <> '2'");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getMarchandiseLicence($num_lic){
			include('connexion.php');
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare('SELECT UPPER(m.nom_march) AS nom_march
												FROM licence l, marchandise m
												WHERE l.num_lic = ?
													AND l.id_march = m.id_march');
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_march'];
			}
		}

		public function getMarchandise($id_march){
			include('connexion.php');
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare('SELECT UPPER(m.nom_march) AS nom_march
												FROM marchandise m
												WHERE m.id_march = ?');
			$requete-> execute(array($entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_march'];
			}
		}

		public function getLastEpirationLicence($num_lic){
			include("connexion.php");
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT DATE_FORMAT(date_exp, '%d/%m/%Y') AS date_exp
												FROM expiration_licence
												WHERE num_lic = ?
												ORDER BY id_date_exp DESC LIMIT 0, 1");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();

			if ($reponse) {
				return $reponse['date_exp'];
			}else{
				return null;
			}

			
		}

		public function getLastEpirationLicence2($num_lic){
			include("connexion.php");
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT date_exp
												FROM expiration_licence
												WHERE num_lic = ?
												ORDER BY id_date_exp DESC LIMIT 0, 1");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['date_exp'];
			}else{
				return NULL;
			}

		}

		public function getElementFacture($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare('SELECT cl.id_cli AS id_cli,
													UPPER(cl.nom_cli) AS nom_cli,
													f.date_fact AS date_fact,
													f.date_fact_rec AS date_fact_rec,
													f.fournisseur AS fournisseur,
													f.date_val AS date_val,
													f.ref_fact AS ref_fact,
													f.commodity AS commodity,
													f.montant_fact AS montant_fact,
													f.fret_fact AS fret_fact,
													f.assurance_fact AS assurance_fact,
													f.autre_frais_fact AS autre_frais_fact,
													m.id_mon AS id_mon,
													m.sig_mon AS sig_mon,
													f.fichier_fact AS fichier_fact,
													f.fsi AS fsi, f.aur AS aur
												FROM facture_licence f, client cl, monnaie m
												WHERE f.ref_fact = ?
													AND f.id_cli = cl.id_cli
													AND f.id_mon = m.id_mon');
			$requete-> execute(array($entree['ref_fact']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }
        
		public function getElementModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT id_mod_lic, 
													UPPER(nom_mod_lic) AS nom_mod_lic,
													sigle_mod_lic
												FROM modele_licence
												WHERE id_mod_lic = ?');
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }
        
		public function getElementMarchandise($id_march){
			include('connexion.php');
			$entree['id_march'] = $id_march;

			$requete = $connexion-> prepare('SELECT id_march, 
													UPPER(nom_march) AS nom_march
												FROM marchandise
												WHERE id_march = ?');
			$requete-> execute(array($entree['id_march']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }
        
		public function getElementClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare('SELECT *, id_cli, 
													UPPER(nom_cli) AS nom_cli
												FROM client
												WHERE id_cli = ?');
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }
        
		public function getNomClient($id_cli){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;

			$requete = $connexion-> prepare('SELECT nom_cli AS nom_cli
												FROM client
												WHERE id_cli = ?');
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_cli'];
			}
        }
        
		public function getUtilisateur($id_util){
			include('connexion.php');
			$entree['id_util'] = $id_util;

			$requete = $connexion-> prepare('SELECT *
												FROM utilisateur
												WHERE id_util = ?');
			$requete-> execute(array($entree['id_util']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse;
			}
        }
        
		public function getNomTypeLicence($id_type_lic){
			include('connexion.php');
			$entree['id_type_lic'] = $id_type_lic;

			$requete = $connexion-> prepare('SELECT UPPER(nom_type_lic) AS nom_type_lic
												FROM type_licence
												WHERE id_type_lic = ?');
			$requete-> execute(array($entree['id_type_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom_type_lic'];
			}
        }
        
		public function getIdRoleUtilisateur($id){
			include('connexion.php');
			$entree['id'] = $id;

			$requete = $connexion-> prepare('SELECT r.id_role AS id_role
												FROM utilisateur u, role r
												WHERE u.id_util = ?
													AND u.id_role = r.id_role');
			$requete-> execute(array($entree['id']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['id_role'];
			}
        }
        
		public function getNomRoleUtilisateur($id){
			include('connexion.php');
			$entree['id'] = $id;

			$requete = $connexion-> prepare('SELECT r.nom_role AS nom
												FROM utilisateur u, role r
												WHERE u.id_util = ?
													AND u.id_role = r.id_role');
			$requete-> execute(array($entree['id']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nom'];
			}
		}

		public function getNombreLicenceModele($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare('SELECT COUNT(num_lic) AS nbre
												FROM licence
												WHERE id_mod_lic = ?');
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierClientModeLicenceStatus($id_cli, $id_mod_lic, $id_mod_trans, $statut){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['statut'] = $statut;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
													AND statut = ?');
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans'], $entree['statut']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierClientModeLicenceStatusAutomatique($id_cli, $id_mod_lic, $id_mod_trans, $statut){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['statut'] = $statut;

			$sqlStatus = '';

			if ($statut == 'AWAITING CRF/AD/INSURANCE') {

				$sqlStatus = " AND d.date_crf IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'UNDER PREPARATION') {

				$sqlStatus = " AND d.date_crf IS NOT NULL
												AND d.date_ad IS NOT NULL
												AND d.date_assurance IS NOT NULL
												AND d.date_decl IS NULL 
												AND d.ref_decl IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'AWAITING LIQUIDATION') {

				$sqlStatus = " AND d.date_decl IS NOT NULL 
												AND d.ref_decl IS NOT NULL
												AND d.date_liq IS NULL 
												AND d.ref_liq IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'AWAITING QUITTANCE') {

				$sqlStatus = " AND d.date_liq IS NOT NULL 
												AND d.ref_liq IS NOT NULL
												AND d.date_quit IS NULL 
												AND d.ref_quit IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'AWAITING BAE/BS') {

				$sqlStatus = " AND d.date_quit IS NOT NULL 
												AND d.ref_quit IS NOT NULL
												AND dgda_out IS NULL
												AND d.cleared <> '2'";

			}else if ($statut == 'CLEARING COMPLETED') {

				$sqlStatus = " AND d.dgda_out IS NOT NULL 
												AND d.dispatch_deliv IS NOT NULL
												AND d.cleared <> '2'";

			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d
												WHERE d.id_mod_lic = ?
													AND d.id_cli = ?
													AND d.id_mod_trans = ?
													$sqlStatus");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierIr($id_cli, $ref_crf){
			include('connexion.php');
			$entree['ref_crf'] = $ref_crf;
			$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE ref_crf = ?
													AND id_cli = ?');
			$requete-> execute(array($entree['ref_crf'], $entree['id_cli']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierAv($cod){
			include('connexion.php');
			$entree['cod'] = $cod;
			//$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE cod = ?');
			$requete-> execute(array($entree['cod']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getFobDossierAv($cod){
			include('connexion.php');
			$entree['cod'] = $cod;
			//$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare('SELECT SUM(fob) AS nbre
												FROM dossier
												WHERE cod = ?');
			$requete-> execute(array($entree['cod']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierModeLicenceStatus($id_mod_lic, $id_mod_trans, $statut){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['statut'] = $statut;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND id_mod_trans = ?
													AND statut = ?');
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_trans'], $entree['statut']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierClientModeLicenceStatusCalculNetDays($id_cli, $id_mod_lic, $id_mod_trans, $statut, $nombreInf, $nombreSup){
			include('connexion.php');
			//$entree['champ_col'] = $champ_col;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['statut'] = $statut;
			$nbre = 0;

			$requete = $connexion-> prepare("SELECT DATEDIFF(dgda_out, dgda_in) AS dgda_delay,
													DATEDIFF(dispatch_deliv, arrival_date) AS arrival_deliver_delay,
													arrival_date, dispatch_deliv
												FROM dossier
													WHERE id_cli = ?
														AND id_mod_lic = ?
														AND id_mod_trans = ?
														AND statut = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], 
								$entree['id_mod_trans'], $entree['statut']));
			while ($reponse = $requete-> fetch()) {
				
				if ( ( ( $reponse['arrival_deliver_delay'] - $this-> getWeekendsAndHolidays($reponse['arrival_date'], $reponse['dispatch_deliv']) ) >= $nombreInf ) && ( ( $reponse['arrival_deliver_delay'] - $this-> getWeekendsAndHolidays($reponse['arrival_date'], $reponse['dispatch_deliv']) ) < $nombreSup )){
					$nbre++;
				}

			}$requete-> closeCursor();
			
			return $nbre;
		}

		public function getNombreDossierClientModeLicenceStatusCalculNetDaysAutomatique($id_cli, $id_mod_lic, $id_mod_trans, $statut, $nombreInf, $nombreSup){
			include('connexion.php');
			//$entree['champ_col'] = $champ_col;
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['statut'] = $statut;
			$nbre = 0;

			$sqlStatus = '';

			if ($statut == 'AWAITING CRF') {

				$sqlStatus = " AND d.date_crf IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'AWAITING AD') {

				$sqlStatus = " AND d.date_ad IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'AWAITING INSURANCE') {

				$sqlStatus = " AND d.date_assurance IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'UNDER PREPARATION') {

				$sqlStatus = " AND d.date_crf IS NOT NULL
												AND d.date_ad IS NOT NULL
												AND d.date_assurance IS NOT NULL
												AND d.date_decl IS NULL 
												AND d.ref_decl IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'AWAITING LIQUIDATION') {

				$sqlStatus = " AND d.date_decl IS NOT NULL 
												AND d.ref_decl IS NOT NULL
												AND d.date_liq IS NULL 
												AND d.ref_liq IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'AWAITING QUITTANCE') {

				$sqlStatus = " AND d.date_liq IS NOT NULL 
												AND d.ref_liq IS NOT NULL
												AND d.date_quit IS NULL 
												AND d.ref_quit IS NULL
												AND d.ref_dos NOT LIKE '%20-%'
												AND d.cleared <> '2'";

			}else if ($statut == 'AWAITING BAE/BS') {

				$sqlStatus = " AND d.date_quit IS NOT NULL 
												AND d.ref_quit IS NOT NULL
												AND dgda_out IS NULL
												AND d.cleared <> '2'";

			}else if ($statut == 'CLEARING COMPLETED') {

				$sqlStatus = " AND d.dgda_out IS NOT NULL 
												AND d.dispatch_deliv IS NOT NULL
												AND d.cleared <> '2'";

			}

			$requete = $connexion-> prepare("SELECT DATEDIFF(d.dgda_out, d.dgda_in) AS dgda_delay,
													DATEDIFF(d.dispatch_deliv, d.arrival_date) AS d.arrival_deliver_delay,
													d.arrival_date, d.dispatch_deliv
												FROM dossier d
													WHERE d.id_cli = ?
														AND d.id_mod_lic = ?
														AND d.id_mod_trans = ?
														$sqlStatus");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], 
								$entree['id_mod_trans']));
			while ($reponse = $requete-> fetch()) {
				
				if ( ( ( $reponse['arrival_deliver_delay'] - $this-> getWeekendsAndHolidays($reponse['arrival_date'], $reponse['dispatch_deliv']) ) >= $nombreInf ) && ( ( $reponse['arrival_deliver_delay'] - $this-> getWeekendsAndHolidays($reponse['arrival_date'], $reponse['dispatch_deliv']) ) < $nombreSup )){
					$nbre++;
				}

			}$requete-> closeCursor();
			
			return $nbre;
		}

		public function getNombreDossierModeLicenceStatusCalculNetDays($id_mod_lic, $id_mod_trans, $statut, $nombreInf, $nombreSup){
			include('connexion.php');
			//$entree['champ_col'] = $champ_col;

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['statut'] = $statut;
			$nbre = 0;

			$requete = $connexion-> prepare("SELECT DATEDIFF(dgda_out, dgda_in) AS dgda_delay,
													DATEDIFF(dispatch_deliv, arrival_date) AS arrival_deliver_delay,
													arrival_date, dispatch_deliv
												FROM dossier
													WHERE id_mod_lic = ?
														AND id_mod_trans = ?
														AND statut = ?");
			$requete-> execute(array($entree['id_mod_lic'], 
								$entree['id_mod_trans'], $entree['statut']));
			while ($reponse = $requete-> fetch()) {
				
				if ( ( ( $reponse['arrival_deliver_delay'] - $this-> getWeekendsAndHolidays($reponse['arrival_date'], $reponse['dispatch_deliv']) ) >= $nombreInf ) && ( ( $reponse['arrival_deliver_delay'] - $this-> getWeekendsAndHolidays($reponse['arrival_date'], $reponse['dispatch_deliv']) ) < $nombreSup )){
					$nbre++;
				}


			}$requete-> closeCursor();
			
			return $nbre;
		}

		public function getNombreTransmissionApurement($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND ta.id_trans_ap IN(
									SELECT DISTINCT(det.id_trans_ap) AS id_trans_ap
										FROM detail_apurement det, dossier d
										WHERE det.id_dos = d.id_dos
											AND d.id_cli = "'.$id_cli.'") ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ta.id_trans_ap) AS nbre
												FROM transmission_apurement ta
												WHERE ta.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreTransmissionApurementSansFichier($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND ta.id_trans_ap IN(
									SELECT DISTINCT(det.id_trans_ap) AS id_trans_ap
										FROM detail_apurement det, dossier d
										WHERE det.id_dos = d.id_dos
											AND d.id_cli = "'.$id_cli.'") ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ta.id_trans_ap) AS nbre
												FROM transmission_apurement ta
												WHERE ta.id_mod_lic = ?
													$sqlClient
													AND (ta.fichier_trans_ap IS NULL
														OR ta.fichier_trans_ap = '')");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierApures($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND d.id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM detail_apurement det, dossier d
												WHERE det.id_dos = d.id_dos
													AND d.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierPretAEtreApuresLicenceClient($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;


			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}


			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													$sqlClient
													AND ref_quit IS NOT NULL
													AND ref_decl IS NOT NULL
													AND ref_decl <> ''
													AND ref_quit <> ''
													AND num_lic <> 'N/A'
													AND num_lic <> 'UNDER VALUE'
													AND num_lic <> 'UNDERVALUE'
													AND num_lic NOT LIKE '%UNDER%'
													AND id_dos NOT IN (
														SELECT id_dos 
															FROM dossier 
															WHERE ref_dos LIKE '%RF20-%' OR ref_dos LIKE '%AW20-%' OR ref_dos LIKE '%-ACID-%' OR ref_dos LIKE '%-SUL%'
														)
													AND (id_cli <> 869 AND id_cli <> 929 AND id_cli <> 927 AND id_cli <> 870 AND id_cli <> 902 AND id_cli <> 873 AND id_cli <> 871 AND id_cli <> 872 AND id_cli <> 905)
													AND id_dos NOT IN(
														SELECT id_dos FROM detail_apurement
													)");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierAttenteFacture($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND cleared = '1'
													AND facture = '0'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreFactureAttenteLicence($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM facture_licence
												WHERE id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){

				if ($this-> getLicenceFacture($reponse['ref_fact']) == null) {
					$compteur++;
				}

			}$requete-> closeCursor();
			
			return $compteur;
		}

		public function getNbreFacture($id_mod_lic=NULL, $id_util=NULL, $debut=NULL, $fin=NULL){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlTransit = "";
			if (isset($id_mod_lic) && ($id_mod_lic != '')) {
				$sqlTransit = ' AND id_mod_lic = "'.$id_mod_lic.'" ';
			}

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$sqlUtilisateur = "";
			if (isset($id_util) && ($id_util != '')) {
				$sqlUtilisateur = ' AND id_util = "'.$id_util.'" ';
			}

			$sqlTime = "";
			if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
				$sqlTime = ' AND DATE(date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}

			$compteur = 0;

			$requete = $connexion-> query("SELECT COUNT(ref_fact) AS nbre
												FROM facture_dossier
												WHERE YEAR(date_fact) = YEAR(CURRENT_DATE())
													$sqlTransit
													$sqlClient
													$sqlUtilisateur
													$sqlTime");
			// $requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNbreNoteDebit($id_mod_lic=NULL, $id_util=NULL, $debut=NULL, $fin=NULL){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlTransit = "";
			if (isset($id_mod_lic) && ($id_mod_lic != '')) {
				$sqlTransit = ' AND id_mod_lic = "'.$id_mod_lic.'" ';
			}

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$sqlUtilisateur = "";
			if (isset($id_util) && ($id_util != '')) {
				$sqlUtilisateur = ' AND id_util = "'.$id_util.'" ';
			}

			$sqlTime = "";
			if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
				$sqlTime = ' AND DATE(date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}

			$compteur = 0;

			$requete = $connexion-> query("SELECT COUNT(ref_note) AS nbre
												FROM note_debit
												WHERE YEAR(date_create) = YEAR(CURRENT_DATE())
													$sqlTransit
													$sqlClient
													$sqlUtilisateur
													$sqlTime");
			// $requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNbreNoteDebitFile($id_mod_lic=NULL, $id_util=NULL, $debut=NULL, $fin=NULL){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlTransit = "";
			if (isset($id_mod_lic) && ($id_mod_lic != '')) {
				$sqlTransit = ' AND id_mod_lic = "'.$id_mod_lic.'" ';
			}

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$sqlUtilisateur = "";
			if (isset($id_util) && ($id_util != '')) {
				$sqlUtilisateur = ' AND id_util = "'.$id_util.'" ';
			}

			$sqlTime = "";
			if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
				$sqlTime = ' AND DATE(date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}

			$compteur = 0;

			$requete = $connexion-> query("SELECT COUNT(dos.id_dos) AS nbre
												FROM detail_note_debit det, depense_dossier depdos, dossier dos
												WHERE det.id_dep_dos = depdos.id_dep_dos
													AND depdos.id_dos = dos.id_dos
													$sqlTransit
													$sqlClient
													$sqlUtilisateur
													$sqlTime");
			// $requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNbreDepenseNoteDebit($id_mod_lic=NULL, $id_util=NULL, $debut=NULL, $fin=NULL){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlTransit = "";
			if (isset($id_mod_lic) && ($id_mod_lic != '')) {
				$sqlTransit = ' AND id_mod_lic = "'.$id_mod_lic.'" ';
			}

			$sqlClient = "";
			// if (isset($id_cli) && ($id_cli != '')) {
			// 	$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			// }

			$sqlUtilisateur = "";
			// if (isset($id_util) && ($id_util != '')) {
			// 	$sqlUtilisateur = ' AND id_util = "'.$id_util.'" ';
			// }

			$sqlTime = "";
			// if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
			// 	$sqlTime = ' AND DATE(date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
			// }

			$compteur = 0;

			$requete = $connexion-> query("SELECT COUNT(id_dep_dos) AS nbre
												FROM depense_dossier
												WHERE id_dep_dos NOT IN (SELECT id_dep_dos FROM detail_note_debit)
													-- $sqlTransit
													-- $sqlClient
													-- $sqlUtilisateur
													-- $sqlTime
													");
			// $requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getListeUploadDepense(){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> query("SELECT *
											FROM depense");
			// $requete-> execute(array($entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				?>
				<a class="dropdown-item" href="#" onclick="modal_upload_depense('<?php echo $reponse['id_dep'];?>', '<?php echo $reponse['nom_dep'];?>');"><?php echo $reponse['nom_dep'];?></a>
				<?php
			}$requete-> closeCursor();
			
		}

		public function getListeFactures($statut, $id_mod_lic, $id_util=NULL, $debut=NULL, $fin=NULL){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND dos.id_cli = "'.$id_cli.'" ';
			}

			$compteur = 0;

			if($statut=='Factures'){

				$sqlTransit = "";
				if (isset($id_mod_lic) && ($id_mod_lic != '')) {
					$sqlTransit = ' AND fd.id_mod_lic = "'.$id_mod_lic.'" ';
				}

				$sqlUtilisateur = "";
				if (isset($id_util) && ($id_util != '')) {
					$sqlUtilisateur = ' AND fd.id_util = "'.$id_util.'" ';
				}

				$sqlTime = "";
				if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
					$sqlTime = ' AND DATE(fd.date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
				}

				$requete = $connexion-> query("SELECT fd.ref_fact AS ref_fact, 
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													cl.nom_cli AS nom_cli,
													IF(fd.validation='0',
														'Pending Validation',
														IF(fd.date_mail IS NULL,
															'Awaiting to send',
															IF(fd.ref_paie IS NULL,
																'Pending Payment',
																'Payed'
																)
															)
														) AS statut,
													CONCAT(CONCAT('<button class=\"btn btn-xs bg-primary square-btn-adjust\" onclick=\"window.open(\'',mf.view_page,'?ref_fact=',fd.ref_fact,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View invoice\">
									                    <i class=\"fas fa-eye\"></i> 
									                </button>'),' ',
									                IF(mf.excel IS NOT NULL, CONCAT('<button class=\"btn btn-xs bg-success square-btn-adjust\" onclick=\"window.location.replace(\'',mf.excel,'?ref_fact=',fd.ref_fact,'\',\'pop4\',\'width=1000,height=800\');\" title=\"Export Annex\">
									                    <i class=\"fas fa-file-excel\"></i> 
									                </button>'), '')) AS view_page,
									                SUM( 
															IF(det.usd='1', 
																det.montant, 
																IF(det.tva='1',
																	IF(det.montant_tva>0,
																		(det.montant_tva+det.montant)/dos.roe_decl,
																		(det.montant)/dos.roe_decl
																	),
																	(det.montant/dos.roe_decl)
																)
															) 
														) AS montant_ht,
									                SUM(
																IF(det.usd='1', 
																	IF(det.tva='1',
																		det.montant*0.16,
																		0
																	), 
																	0
																)
															) AS tva_usd,
									                SUM(
														IF(det.usd='0', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																	),
																det.montant/dos.roe_decl
															), 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															)
														)
													) AS montant,

													SUM(
														IF(det.usd='1', 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl),
																	(det.montant/dos.roe_decl)*1.16
																),
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,

													SUM(
														IF(det.usd='0', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	det.montant_tva+det.montant,
																	det.montant*0.16
																	),
																det.montant
															),
															0
														)
													) AS ttc_cdf_2,
													SUM(
														IF(debours.id_t_deb='1',
															IF(det.tva='1',
																IF(det.usd='0',
																	det.montant*1.16,
																	(det.montant*dos.roe_decl)*1.16),
																IF(det.usd='0',
																	det.montant,
																	det.montant*dos.roe_decl)
																)
															, 0)
														) AS duty_cdf_2,
													AVG(dos.roe_decl) AS roe_decl,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0',
															det.montant,
															0)
														) AS duty_vat_excl_cdf,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0',
															det.montant/dos.roe_decl,
															0)
														) AS duty_vat_excl_usd,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0' AND det.tva='1',
															IF(det.montant_tva>0,
																det.montant_tva,
																det.montant*0.16
																),
															0)
														) AS duty_vat_cdf,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0' AND det.tva='1',
															IF(det.montant_tva>0,
																det.montant_tva/dos.roe_decl,
																(det.montant*0.16)/dos.roe_decl
																),
															0)
														) AS duty_vat_usd,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0',
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	det.montant+det.montant_tva,
																	det.montant*1.16
																),
																det.montant
															),
															0
														)
													) AS total_duty_cdf,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0',
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	(det.montant+det.montant_tva)/dos.roe_decl,
																	(det.montant*1.16)/dos.roe_decl
																),
																det.montant/dos.roe_decl
															),
															0
														)
													) AS total_duty_usd,
													SUM(
														IF(debours.id_t_deb='2',
															det.montant,
															0
															)
														) AS other_charge_vat_excl,
													SUM(
														IF(debours.id_t_deb='2' AND det.tva='1',
															det.montant*0.16,
															0
															)
														) AS other_charge_vat,
													SUM(
														IF(debours.id_t_deb='3',
															det.montant,
															0
															)
														) AS ops_vat_excl,
													SUM(
														IF(debours.id_t_deb='3' AND det.tva='1',
															det.montant*0.16,
															0
															)
														) AS ops_vat,
													SUM(
														IF(debours.id_t_deb='4',
															det.montant,
															0
															)
														) AS service_vat_excl,
													SUM(
														IF(debours.id_t_deb='4' AND det.tva='1',
															det.montant*0.16,
															0
															)
														) AS service_vat
												FROM facture_dossier fd, modele_facture mf, client cl, detail_facture_dossier det, dossier dos, debours
												WHERE YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.id_cli = cl.id_cli
													AND fd.ref_fact = det.ref_fact
													AND debours.id_deb = det.id_deb
													AND det.id_dos = dos.id_dos
													$sqlClient
													$sqlTransit
													$sqlUtilisateur
													$sqlTime
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact DESC");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					$reponse['total_other_charge'] = $reponse['other_charge_vat_excl']+$reponse['other_charge_vat'];
					$reponse['total_ops'] = $reponse['ops_vat_excl']+$reponse['ops_vat'];
					$reponse['total_service'] = $reponse['service_vat_excl']+$reponse['service_vat'];

					$reponse['compteur'] = $compteur;
					// $reponse['montant'] = number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
					$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;

			}else if($statut=='Dossiers FacturÃ©s'){

				$sqlTransit = "";
				if (isset($id_mod_lic) && ($id_mod_lic != '')) {
					$sqlTransit = ' AND dos.id_mod_lic = "'.$id_mod_lic.'" ';
				}

				$sqlUtilisateur = "";
				if (isset($id_util) && ($id_util != '')) {
					$sqlUtilisateur = ' AND fd.id_util = "'.$id_util.'" ';
				}

				$sqlTime = "";
				if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
					$sqlTime = ' AND DATE(fd.date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
				}
				$requete = $connexion-> query("SELECT dos.ref_dos AS ref_dos, 
													fd.ref_fact AS ref_fact, 
													dos.po_ref AS po_ref,
													dos.roe_decl AS roe_decl,
													dos.container AS container,
													dos.pied_container AS pied_container,
									                IF(dos.roe_liq IS NOT NULL,
									                	dos.roe_liq,
									                	dos.roe_decl
									                ) AS roe_liq,
													IF(dos.poids>1,
														dos.poids,
														1
														) AS poids,
													dos.id_dos AS id_dos,
													dos.ref_liq AS ref_liq,
													dos.ref_quit AS ref_quit,
													dos.id_bank_liq AS id_bank_liq,
													dos.montant_liq AS montant_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													cl.nom_cli AS nom_cli,
													SUM(
														IF(det.usd='0' AND deb.id_t_deb='1', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant),
																	(det.montant*0.16)
																),
																det.montant
															), 
															0
														)
													) AS liquidation_cdf,
													SUM(
														IF(det.usd='0' AND deb.id_t_deb='1', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																),
																det.montant/dos.roe_decl
															), 
															0
														)
													) AS liquidation_usd,
													SUM(
														IF(det.usd='0' AND deb.id_t_deb='1', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl)/dos.poids,
																	(det.montant*0.16)/dos.roe_decl
																),
																(det.montant/dos.roe_decl)/dos.poids
															), 
															0
														)
													) AS liquidation_usd_per_ton,
													SUM(
														IF(deb.id_t_deb='2' AND det.usd='1',
															det.montant,
															0
														)
													) AS other_charge,
													SUM(
														IF(deb.id_t_deb='1', 
															IF(det.usd='0',
																IF(det.tva='1',
																	IF(det.montant_tva>0,
																		(det.montant_tva+det.montant)/dos.roe_decl,
																		(det.montant*0.16)/dos.roe_decl
																	),
																	det.montant/dos.roe_decl
																),
																IF(det.tva='1',
																	IF(det.montant_tva>0,
																		(det.montant_tva+det.montant),
																		(det.montant*0.16)
																	),
																	det.montant
																)
															),
															0
														)
													) AS clearing_fee,
													SUM(
														IF(deb.id_t_deb='2' AND det.usd='1' AND det.tva='1',
															det.montant*0.16,
															0
														)
													) AS tva_other_charge,
													SUM(

														IF(deb.id_t_deb='2' AND det.usd='1',
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															),
															0
														)
													) AS total_other_charge,
													SUM(
														IF(deb.id_t_deb='3' AND det.usd='1',
															det.montant,
															0
														)
													) AS ops_fee,
													SUM(
														IF(deb.id_deb='196' OR deb.id_deb='197' OR deb.id_deb='198',
															det.montant,
															0
														)
													) AS ogefrem_contenair,
													SUM(
														IF(deb.id_t_deb='3' AND det.usd='1' AND det.tva='1',
															det.montant*0.16,
															0
														)
													) AS tva_ops_fee,
													SUM(

														IF(deb.id_t_deb='3' AND det.usd='1',
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															),
															0
														)
													) AS total_ops_fee,
													SUM(
														IF(deb.id_t_deb='4' AND det.usd='1',
															det.montant,
															0
														)
													) AS agency_fee,
													SUM(
														IF(deb.id_t_deb='4' AND det.usd='1' AND det.tva='1',
															det.montant*0.16,
															0
														)
													) AS tva_agency_fee,
													SUM(

														IF(deb.id_t_deb='4' AND det.usd='1',
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															),
															0
														)
													) AS total_agency_fee,
									                SUM(
														IF(det.usd='0', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																	),
																det.montant/dos.roe_decl
															), 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															)
														)
													) AS montant_total,
													IF(fd.validation='0',
														'Pending Validation',
														IF(fd.date_mail IS NULL,
															'Awaiting to send',
															IF(fd.ref_paie IS NULL,
																'Pending Payment',
																'Payed'
																)
															)
														) AS statut,
													CONCAT(CONCAT('<a href=\"#\" onclick=\"window.open(\'',mf.view_page,'?ref_fact=',fd.ref_fact,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View invoice\">
									                    <i class=\"fas fa-eye\"></i> 
									                </a>'),' ',
									                CONCAT('<a href=\"#\" class=\"text-success\" onclick=\"window.location.replace(\'',mf.excel,'?ref_fact=',fd.ref_fact,'\',\'pop4\',\'width=1000,height=800\');\" title=\"Export Annex\">
									                    <i class=\"fas fa-file-excel\"></i> 
									                </a>')) AS view_page,
									                dos.id_mod_lic AS id_mod_lic,
									                dos.id_cli AS id_cli,
									                dos.id_mod_trans AS id_mod_trans,
									                dos.id_march AS id_march
												FROM facture_dossier fd, modele_facture mf, client cl, dossier dos, detail_facture_dossier det, debours deb
												WHERE YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.note_debit = '0'
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													AND det.id_deb = deb.id_deb
													AND fd.id_cli = cl.id_cli
													$sqlClient
													$sqlTransit
													$sqlUtilisateur
													$sqlTime
												GROUP BY dos.id_dos
												ORDER BY dos.id_dos DESC");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					if ($id_mod_lic=='1') {
						
						$reponse['avg_liquidation_usd_per_ton'] = $this-> getMontantFactureDossierDebours3($reponse['ref_fact'], 2)/$this-> getPoidsFacture($reponse['ref_fact']);

					}else{

						$reponse['avg_liquidation_usd_per_ton'] = 0;

					}

					$reponse['compteur'] = $compteur;
					$reponse['montant'] = number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
					$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
					$reponse['nbre_dossier'] = $this-> getNombreDossierFacture2($reponse['ref_fact']);
					$reponse['liste_dossier'] = $this-> getRangDossierFacture($reponse['ref_fact']);
					$reponse['feri'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 5, $reponse['id_dos']);
					$reponse['feri_per_ton'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 5, $reponse['id_dos'])/$reponse['poids'];
					$reponse['lmc'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 6, $reponse['id_dos']);
					$reponse['lmc_per_ton'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 6, $reponse['id_dos'])/$reponse['poids'];
					$reponse['voirie'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 7, $reponse['id_dos']);
					$reponse['voirie_per_ton'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 7, $reponse['id_dos'])/$reponse['poids'];
					if ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 11, $reponse['id_dos'])>0) {
						$reponse['ceec'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 11, $reponse['id_dos']);
					}else{
						$reponse['ceec'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 12, $reponse['id_dos']);
					}

					if ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 54, $reponse['id_dos'])>0) {
						$reponse['finance_cost'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 54, $reponse['id_dos']);
					}else{
						$reponse['finance_cost'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 101, $reponse['id_dos']);
					}

					if ($reponse['roe_decl']>1) {
						$reponse['roe_decl'] = $reponse['roe_decl'];
					}else{
						$reponse['roe_decl'] = 1;
					}

					$reponse['rie'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 1, $reponse['id_dos']))/$reponse['roe_decl'];
					$reponse['rie_per_ton'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 1, $reponse['id_dos'])/$reponse['poids'])/$reponse['roe_decl'];
					$reponse['rls'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 3, $reponse['id_dos']))/$reponse['roe_decl'];
					$reponse['rls_per_ton'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 3, $reponse['id_dos'])/$reponse['poids'])/$reponse['roe_decl'];
					$reponse['fsr'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 4, $reponse['id_dos']))/$reponse['roe_decl'];
					$reponse['fsr_per_ton'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 4, $reponse['id_dos'])/$reponse['poids'])/$reponse['roe_decl'];
					
					$reponse['occ_sample'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 9, $reponse['id_dos']);
					$reponse['cgea'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 10, $reponse['id_dos']);
					$reponse['dgda_seal'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 13, $reponse['id_dos']);
					$reponse['assay'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 15, $reponse['id_dos']);
					if ($this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport2(45, $reponse['id_mod_lic'], $reponse['id_cli'], $reponse['id_march'], $reponse['id_mod_trans'])['montant']>1) {
						$reponse['nbre_scelle'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 45, $reponse['id_dos'])/$this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport2(45, $reponse['id_mod_lic'], $reponse['id_cli'], $reponse['id_march'], $reponse['id_mod_trans'])['montant'];
					}else{
						$reponse['nbre_scelle'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 45, $reponse['id_dos'])/35;
					}
					
					$reponse['scelle'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 45, $reponse['id_dos']);
					$reponse['tresco'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 94, $reponse['id_dos']);
					$reponse['nom_banq'] = $this-> getDataBancaire($reponse['id_bank_liq'])['nom_banq'];

					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;
				
			}else if($statut=='Dossiers Non FacturÃ©s'){

				$sqlTransit = "";
				if (isset($id_mod_lic) && ($id_mod_lic != '')) {
					$sqlTransit = ' AND dos.id_mod_lic = "'.$id_mod_lic.'" ';
				}

				$requete = $connexion-> query("SELECT dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli, 
													dos.id_dos AS id_dos,
													dos.po_ref AS po_ref,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													IF(dos.num_lot IS NOT NULL,
														dos.num_lot,
														dos.ref_fact
													) AS num_lot,
													IF(march.nom_march IS NOT NULL,
														march.nom_march,
														dos.commodity
													) AS commodity,
													dos.ref_decl AS ref_decl,
													IF(dos.support_doc='1',
														'Available',
														'Unavailable'
													) AS support_doc,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													dos.montant_liq AS montant_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATEDIFF(CURRENT_DATE(), dos.date_quit) AS delay
												FROM dossier dos
												LEFT JOIN marchandise march
													ON dos.id_march = march.id_march
												LEFT JOIN client cl
													ON dos.id_cli = cl.id_cli
												WHERE dos.not_fact = '0'
													AND dos.date_decl IS NOT NULL
													AND dos.ref_decl IS NOT NULL
													AND dos.date_liq IS NOT NULL
													AND dos.ref_liq IS NOT NULL
													AND dos.date_quit IS NOT NULL
													AND dos.ref_quit IS NOT NULL
													AND dos.id_dos NOT IN (
														SELECT DISTINCT(dos.id_dos) 
															FROM facture_dossier fd, detail_facture_dossier det, dossier dos
															WHERE YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
																AND fd.ref_fact = det.ref_fact
																AND fd.note_debit = '0'
																AND det.id_dos = dos.id_dos
													)
													$sqlTransit
												ORDER BY dos.id_dos
											");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					$reponse['compteur'] = $compteur;
					$reponse['date_log'] = $this-> getLastEncodingDateDataInLog($reponse['id_dos'], 'Quit')['date_log'];
					$reponse['truck'] = $reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'];
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;
				
			}

		}

		public function getListeDepense($statut, $id_mod_lic, $id_util=NULL, $debut=NULL, $fin=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND dos.id_cli = "'.$id_cli.'" ';
			}

			$compteur = 0;

			if($statut=='Depenses'){

				$sqlTransit = "";
				if (isset($id_mod_lic) && ($id_mod_lic != '')) {
					$sqlTransit = ' AND fd.id_mod_lic = "'.$id_mod_lic.'" ';
				}

				$sqlUtilisateur = "";
				if (isset($id_util) && ($id_util != '')) {
					$sqlUtilisateur = ' AND fd.id_util = "'.$id_util.'" ';
				}

				$sqlTime = "";
				if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
					$sqlTime = ' AND DATE(fd.date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
				}

				$requete = $connexion-> prepare("SELECT dos.id_dos AS id_dos,
													dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli,
													dep.nom_dep AS nom_dep,
													DATE_FORMAT(depdos.date_dep, '%d/%m/%Y') AS date_dep,
													depdos.montant AS montant,
													depdos.assigned_to AS assigned_to
												FROM depense_dossier depdos, dossier dos, client cl, depense dep
												WHERE depdos.id_dos = dos.id_dos
													AND dos.id_mod_lic = ?
													AND dos.id_cli = cl.id_cli
													AND depdos.id_dep = dep.id_dep
													AND depdos.id_dep_dos NOT IN (
															SELECT id_dep_dos 
															 FROM detail_note_debit 
														)");
				$requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;
					$reponse['compteur'] = $compteur;
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;

			}else if($statut=='REPORTING - AS PER FILES CLEARED'){

				$sqlTransit = "";
				if (isset($id_mod_lic) && ($id_mod_lic != '')) {
					$sqlTransit = ' AND fd.id_mod_lic = "'.$id_mod_lic.'" ';
				}

				$sqlUtilisateur = "";
				if (isset($id_util) && ($id_util != '')) {
					$sqlUtilisateur = ' AND fd.id_util = "'.$id_util.'" ';
				}

				$sqlTime = "";
				if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
					$sqlTime = ' AND DATE(fd.date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
				}

				$requete = $connexion-> prepare("SELECT dos.id_dos AS id_dos,
													dos.ref_dos AS ref_dos,
													dos.po_ref AS po_ref,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													dos.road_manif AS road_manif,
													CONCAT(dos.ref_dos, '(PO : ',dos.po_ref,')') AS debit_note_format,
													det.montant AS montant,
													note.ref_note AS ref_note,
													DATE_FORMAT(note.date_create, '%d/%m/%Y') AS date_note,
													util.nom_util AS nom_util
												FROM depense_dossier depdos, dossier dos, client cl, depense dep
												WHERE depdos.id_dos = dos.id_dos
													AND dos.id_mod_lic = ?
													AND dos.id_cli = cl.id_cli
													AND depdos.id_dep = dep.id_dep
													AND depdos.id_dep_dos NOT IN (
															SELECT id_dep_dos 
															 FROM detail_note_debit 
														)");
				$requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;
					$reponse['compteur'] = $compteur;
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;

			}

		}

		public function popFilesInvoicingStatus($id_mod_lic, $annee){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['annee'] = $annee;

			// $sqlClient = "";
			// if (isset($id_cli) && ($id_cli != '')) {
			// 	$sqlClient = ' AND dos.id_cli = "'.$id_cli.'" ';
			// }
			$rows = array();
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT dos.ref_dos AS ref_dos, 
												fd.ref_fact AS ref_fact, 
												dos.po_ref AS po_ref,
												dos.roe_decl AS roe_decl,
												IF(dos.poids>1,
													dos.poids,
													1
													) AS poids,
												dos.id_dos AS id_dos,
												dos.ref_liq AS ref_liq,
												dos.montant_liq AS montant_liq,
												dos.ref_decl AS ref_decl,
												dos.date_decl AS date_decl,
												dos.date_liq AS date_liq,
												dos.ref_quit AS ref_quit,
												dos.date_quit AS date_quit,
												dos.montant_liq AS montant_liq,
												-- DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
												-- DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
												cl.nom_cli AS nom_cli,
								                SUM(
													IF(det.usd='0', 
														IF(det.tva='1',
															IF(det.montant_tva>0,
																(det.montant_tva+det.montant)/dos.roe_decl,
																(det.montant*0.16)/dos.roe_decl
																),
															det.montant/dos.roe_decl
														), 
														IF(det.tva='1',
															det.montant*1.16,
															det.montant
														)
													)
												) AS montant_total,
												fd.date_fact AS date_fact,
												IF(fd.validation='0',
													'Pending Validation',
													IF(fd.date_mail IS NULL,
														'Awaiting to send',
														IF(fd.ref_paie IS NULL,
															'Pending Payment',
															'Payed'
															)
														)
													) AS statut,
												CONCAT(CONCAT('<a href=\"#\" onclick=\"window.open(\'',mf.view_page,'?ref_fact=',fd.ref_fact,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View invoice\">
								                    <i class=\"fas fa-eye\"></i> 
								                </a>'),' ',
								                CONCAT('<a href=\"#\" class=\"text-success\" onclick=\"window.location.replace(\'',mf.excel,'?ref_fact=',fd.ref_fact,'\',\'pop4\',\'width=1000,height=800\');\" title=\"Export Annex\">
								                    <i class=\"fas fa-file-excel\"></i> 
								                </a>')) AS view_page,
								                dos.id_mod_lic AS id_mod_lic,
								                dos.id_cli AS id_cli,
								                dos.id_mod_trans AS id_mod_trans,
								                dos.id_march AS id_march,
								                IF(dos.id_mod_lic='2' AND dos.id_mod_trans='1',
														IF(dos.date_crf IS NULL AND dos.date_ad IS NULL AND dos.date_assurance IS NULL,
													      'AWAITING CRF/AD/INSURANCE',
													      IF(dos.date_crf IS NULL AND dos.date_ad IS NULL AND dos.date_assurance IS NOT NULL,
													        'AWAITING CRF/AD',
													          IF(dos.date_crf IS NULL AND dos.date_ad IS NOT NULL AND dos.date_assurance IS NULL,
													            'AWAITING CRF/INSURANCE',
													            IF(dos.date_crf IS NULL AND dos.date_ad IS NOT NULL AND dos.date_assurance IS NOT NULL,
													              'AWAITING CRF', 
													              IF(dos.date_crf IS NOT NULL AND dos.date_ad IS NULL AND dos.date_assurance IS NULL,
													                'AWAITING AD/INSURANCE',
													                IF(dos.date_crf IS NOT NULL AND dos.date_ad IS NULL AND dos.date_assurance IS NOT NULL,
													                  'AWAITING AD',
													                    IF(dos.date_crf IS NOT NULL AND dos.date_ad IS NOT NULL AND dos.date_assurance IS NULL,
													                      'AWAITING INSURANCE',

													                      IF(dos.date_decl IS NULL AND dos.ref_decl IS NULL, 'UNDER PREPARATION',
													                        IF(dos.date_liq IS NULL AND dos.ref_liq IS NULL, 'AWAITING LIQUIDATION',
													                          IF(dos.date_quit IS NULL AND dos.ref_quit IS NULL, 'AWAITING QUITTANCE',
													                            IF(dos.date_quit IS NOT NULL AND dos.ref_quit IS NOT NULL AND dos.dgda_out IS NULL, 'AWAITING BAE/BS', 
													                              IF(dos.dgda_out IS NOT NULL AND dos.dispatch_deliv IS NOT NULL, 'CLEARING COMPLETED', '')
													                              )
													                            )
													                          )
													                        )
													                      
													                      )
													                  )
													                )
													              )
													            )
													          )
													      )
														,
														IF(dos.id_mod_lic='1', 
															IF(dos.load_date IS NOT NULL AND dos.ceec_in IS NULL,
																'LOADED',
																IF(dos.ceec_in IS NOT NULL AND dos.ceec_out IS NULL, 'AT CEEC',
																	IF(dos.ceec_out IS NOT NULL AND dos.min_div_in IS NULL, 'CEEC OUT',
																		IF(dos.min_div_in IS NOT NULL AND dos.min_div_out IS NULL, 'AT MINE DIVISION',
																			IF(dos.min_div_out IS NOT NULL AND dos.ref_decl IS NULL, 'MINE DIVISION OUT',
																				IF(dos.ref_decl IS NOT NULL AND dos.ref_liq IS NULL, 'DECLARATION',
																					IF(dos.ref_liq IS NOT NULL AND dos.ref_quit IS NULL, 'LIQUIDATED',
																						IF(dos.ref_quit IS NOT NULL AND dos.gov_in IS  NULL, 'DGDA OUT',
																							IF(dos.gov_in IS NOT NULL AND dos.gov_out IS NULL, 'AT GOVERNOR\'S OFFICE',
																								IF(dos.gov_out IS NOT NULL AND dos.dispatch_date IS NULL, 'GOVERNOR\'S OFFICE OUT',
																									IF(dos.dispatch_date IS NOT NULL AND dos.klsa_arriv IS NULL,
																										'DISPATCHED', 
																											IF(dos.klsa_arriv IS NOT NULL AND dos.end_form IS NULL, 'AT BORDER',
																												IF(dos.end_form IS NOT NULL AND dos.exit_drc IS NULL, 'UNDER FORMALITIES',
																													IF(dos.exit_drc IS NOT NULL, 'EXIT DRC', '')
																													)
																												)
																										)
																									)
																								)
																							)
																						)
																					)
																				)
																			)
																		)
																	)
																)
															, dos.statut )
													) AS statut,
								                IF(dos.cleared='0',
								                	'Transit',
								                	IF(dos.cleared='1',
								                		'Cleared',
								                		'Cancelled'
								                	)
								                ) AS cleared_status,
								                IF(dos.not_fact='0',
								                	'Enable',
								                	'Disabled'
								                ) AS invoicing_status,
								                dos.remarque AS remarque
											FROM dossier dos 
												LEFT JOIN client cl
													ON dos.id_cli = cl.id_cli
												LEFT JOIN detail_facture_dossier det
													ON dos.id_dos = det.id_dos
												LEFT JOIN facture_dossier fd
													ON fd.ref_fact = det.ref_fact
												LEFT JOIN debours deb
													ON deb.id_deb = det.id_deb
												LEFT JOIN modele_facture mf
													ON mf.id_mod_fact = fd.id_mod_fact
											WHERE dos.id_mod_lic = ?
												AND YEAR(dos.date_creat_dos) = ?
												AND dos.id_dos NOT IN (SELECT id_dos FROM detail_facture_dossier GROUP BY id_dos)
												AND dos.id_dos NOT IN (
														SELECT id_dos
															FROM dossier
															WHERE date_quit IS NOT NULL
																AND ref_quit IS NOT NULL
																AND not_fact='0'
													)
												AND dos.id_cli <> 1
												AND dos.cleared <= 1
											GROUP BY dos.id_dos
											ORDER BY dos.id_dos ASC");
			$requete-> execute(array($entree['id_mod_lic'], $entree['annee']));
			while($reponse = $requete-> fetch()){
				$compteur++;

				$reponse['compteur'] = $compteur;
				// $reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
				// $reponse['nbre_dossier'] = $this-> getNombreDossierFacture2($reponse['ref_fact']);
				// $reponse['liste_dossier'] = $this-> getRangDossierFacture($reponse['ref_fact']);
				// $reponse['feri'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 5, $reponse['id_dos']);
				// $reponse['feri_per_ton'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 5, $reponse['id_dos'])/$reponse['poids'];
				// $reponse['lmc'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 6, $reponse['id_dos']);
				// $reponse['lmc_per_ton'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 6, $reponse['id_dos'])/$reponse['poids'];
				// $reponse['voirie'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 7, $reponse['id_dos']);
				// $reponse['voirie_per_ton'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 7, $reponse['id_dos'])/$reponse['poids'];
				// if ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 11, $reponse['id_dos'])>0) {
				// 	$reponse['ceec'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 11, $reponse['id_dos']);
				// }else{
				// 	$reponse['ceec'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 12, $reponse['id_dos']);
				// }

				// if ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 54, $reponse['id_dos'])>0) {
				// 	$reponse['finance_cost'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 54, $reponse['id_dos']);
				// }else{
				// 	$reponse['finance_cost'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 101, $reponse['id_dos']);
				// }

				// if ($reponse['roe_decl']>1) {
				// 	$reponse['roe_decl'] = $reponse['roe_decl'];
				// }else{
				// 	$reponse['roe_decl'] = 1;
				// }

				// $reponse['rie'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 1, $reponse['id_dos']))/$reponse['roe_decl'];
				// $reponse['rie_per_ton'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 1, $reponse['id_dos'])/$reponse['poids'])/$reponse['roe_decl'];
				// $reponse['rls'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 3, $reponse['id_dos']))/$reponse['roe_decl'];
				// $reponse['rls_per_ton'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 3, $reponse['id_dos'])/$reponse['poids'])/$reponse['roe_decl'];
				// $reponse['fsr'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 4, $reponse['id_dos']))/$reponse['roe_decl'];
				// $reponse['fsr_per_ton'] = ($this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 4, $reponse['id_dos'])/$reponse['poids'])/$reponse['roe_decl'];
				
				// $reponse['occ_sample'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 9, $reponse['id_dos']);
				// $reponse['cgea'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 10, $reponse['id_dos']);
				// $reponse['dgda_seal'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 13, $reponse['id_dos']);
				// $reponse['assay'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 15, $reponse['id_dos']);
				// if ($this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport2(45, $reponse['id_mod_lic'], $reponse['id_cli'], $reponse['id_march'], $reponse['id_mod_trans'])['montant']>1) {
				// 	$reponse['nbre_scelle'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 45, $reponse['id_dos'])/$this-> getMontantDeboursClientModeleLicenceMarchandiseModeTransport2(45, $reponse['id_mod_lic'], $reponse['id_cli'], $reponse['id_march'], $reponse['id_mod_trans'])['montant'];
				// }else{
				// 	$reponse['nbre_scelle'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 45, $reponse['id_dos'])/35;
				// }
				
				// $reponse['scelle'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 45, $reponse['id_dos']);
				// $reponse['tresco'] = $this-> getMontantDeboursFactureDossier2($reponse['ref_fact'], 94, $reponse['id_dos']);

				$rows[] = $reponse;
			}$requete-> closeCursor();
			
			return $rows;
			


		}

		public function getListeFacturesBACKUP3_7_23($statut, $id_mod_lic, $id_util=NULL, $debut=NULL, $fin=NULL){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND dos.id_cli = "'.$id_cli.'" ';
			}

			$compteur = 0;

			if($statut=='Factures'){

				$sqlTransit = "";
				if (isset($id_mod_lic) && ($id_mod_lic != '')) {
					$sqlTransit = ' AND fd.id_mod_lic = "'.$id_mod_lic.'" ';
				}

				$sqlUtilisateur = "";
				if (isset($id_util) && ($id_util != '')) {
					$sqlUtilisateur = ' AND fd.id_util = "'.$id_util.'" ';
				}

				$sqlTime = "";
				if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
					$sqlTime = ' AND DATE(fd.date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
				}

				$requete = $connexion-> query("SELECT fd.ref_fact AS ref_fact, 
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													cl.nom_cli AS nom_cli,
													IF(fd.validation='0',
														'Pending Validation',
														IF(fd.date_mail IS NULL,
															'Awaiting to send',
															IF(fd.ref_paie IS NULL,
																'Pending Payment',
																'Payed'
																)
															)
														) AS statut,
													CONCAT(CONCAT('<button class=\"btn btn-xs bg-primary square-btn-adjust\" onclick=\"window.open(\'',mf.view_page,'?ref_fact=',fd.ref_fact,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View invoice\">
									                    <i class=\"fas fa-eye\"></i> 
									                </button>'),' ',
									                IF(mf.excel IS NOT NULL, CONCAT('<button class=\"btn btn-xs bg-success square-btn-adjust\" onclick=\"window.location.replace(\'',mf.excel,'?ref_fact=',fd.ref_fact,'\',\'pop4\',\'width=1000,height=800\');\" title=\"Export Annex\">
									                    <i class=\"fas fa-file-excel\"></i> 
									                </button>'), '')) AS view_page,
									                SUM( 
															IF(det.usd='1', 
																det.montant, 
																IF(det.tva='1',
																	IF(det.montant_tva>0,
																		(det.montant_tva+det.montant)/dos.roe_decl,
																		(det.montant)/dos.roe_decl
																	),
																	(det.montant/dos.roe_decl)
																)
															) 
														) AS montant_ht,
									                SUM(
																IF(det.usd='1', 
																	IF(det.tva='1',
																		det.montant*0.16,
																		0
																	), 
																	0
																)
															) AS tva_usd,
									                SUM(
														IF(det.usd='0', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	(det.montant_tva+det.montant)/dos.roe_decl,
																	(det.montant*0.16)/dos.roe_decl
																	),
																det.montant/dos.roe_decl
															), 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															)
														)
													) AS montant,

													SUM(
														IF(det.usd='1', 
															IF(det.tva='1',
																det.montant*1.16,
																det.montant
															), 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	((det.montant_tva+det.montant)/dos.roe_decl),
																	(det.montant/dos.roe_decl)*1.16
																),
																(det.montant/dos.roe_decl)
															)
														)
													) AS ttc_usd,

													SUM(
														IF(det.usd='0', 
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	det.montant_tva+det.montant,
																	det.montant*0.16
																	),
																det.montant
															),
															0
														)
													) AS ttc_cdf_2,
													SUM(
														IF(debours.id_t_deb='1',
															IF(det.tva='1',
																IF(det.usd='0',
																	det.montant*1.16,
																	(det.montant*dos.roe_decl)*1.16),
																IF(det.usd='0',
																	det.montant,
																	det.montant*dos.roe_decl)
																)
															, 0)
														) AS duty_cdf_2,
													AVG(dos.roe_decl) AS roe_decl,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0',
															det.montant,
															0)
														) AS duty_vat_excl_cdf,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0',
															det.montant/dos.roe_decl,
															0)
														) AS duty_vat_excl_usd,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0' AND det.tva='1',
															IF(det.montant_tva>0,
																det.montant_tva,
																det.montant*0.16
																),
															0)
														) AS duty_vat_cdf,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0' AND det.tva='1',
															IF(det.montant_tva>0,
																det.montant_tva/dos.roe_decl,
																(det.montant*0.16)/dos.roe_decl
																),
															0)
														) AS duty_vat_usd,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0',
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	det.montant+det.montant_tva,
																	det.montant*1.16
																),
																det.montant
															),
															0
														)
													) AS total_duty_cdf,
													SUM(
														IF(debours.id_t_deb='1' AND det.usd='0',
															IF(det.tva='1',
																IF(det.montant_tva>0,
																	(det.montant+det.montant_tva)/dos.roe_decl,
																	(det.montant*1.16)/dos.roe_decl
																),
																det.montant/dos.roe_decl
															),
															0
														)
													) AS total_duty_usd,
													SUM(
														IF(debours.id_t_deb='2',
															det.montant,
															0
															)
														) AS other_charge_vat_excl,
													SUM(
														IF(debours.id_t_deb='2' AND det.tva='1',
															det.montant*0.16,
															0
															)
														) AS other_charge_vat,
													SUM(
														IF(debours.id_t_deb='3',
															det.montant,
															0
															)
														) AS ops_vat_excl,
													SUM(
														IF(debours.id_t_deb='3' AND det.tva='1',
															det.montant*0.16,
															0
															)
														) AS ops_vat,
													SUM(
														IF(debours.id_t_deb='4',
															det.montant,
															0
															)
														) AS service_vat_excl,
													SUM(
														IF(debours.id_t_deb='4' AND det.tva='1',
															det.montant*0.16,
															0
															)
														) AS service_vat
												FROM facture_dossier fd, modele_facture mf, client cl, detail_facture_dossier det, dossier dos, debours
												WHERE YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.id_cli = cl.id_cli
													AND fd.ref_fact = det.ref_fact
													AND debours.id_deb = det.id_deb
													AND det.id_dos = dos.id_dos
													$sqlClient
													$sqlTransit
													$sqlUtilisateur
													$sqlTime
												GROUP BY fd.ref_fact
												ORDER BY fd.date_fact DESC");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					$reponse['total_other_charge'] = $reponse['other_charge_vat_excl']+$reponse['other_charge_vat'];
					$reponse['total_ops'] = $reponse['ops_vat_excl']+$reponse['ops_vat'];
					$reponse['total_service'] = $reponse['service_vat_excl']+$reponse['service_vat'];

					$reponse['compteur'] = $compteur;
					// $reponse['montant'] = number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
					$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;

			}else if($statut=='Dossiers FacturÃ©s'){

				$sqlTransit = "";
				if (isset($id_mod_lic) && ($id_mod_lic != '')) {
					$sqlTransit = ' AND dos.id_mod_lic = "'.$id_mod_lic.'" ';
				}

				$sqlUtilisateur = "";
				if (isset($id_util) && ($id_util != '')) {
					$sqlUtilisateur = ' AND fd.id_util = "'.$id_util.'" ';
				}

				$sqlTime = "";
				if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
					$sqlTime = ' AND DATE(fd.date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
				}
				$requete = $connexion-> query("SELECT dos.ref_dos AS ref_dos, 
													fd.ref_fact AS ref_fact, 
													dos.po_ref AS po_ref,
													DATE_FORMAT(fd.date_fact, '%d/%m/%Y') AS date_fact,
													cl.nom_cli AS nom_cli,
													IF(fd.validation='0',
														'Pending Validation',
														IF(fd.date_mail IS NULL,
															'Awaiting to send',
															IF(fd.ref_paie IS NULL,
																'Pending Payment',
																'Payed'
																)
															)
														) AS statut,
													CONCAT(CONCAT('<button class=\"btn btn-xs bg-primary square-btn-adjust\" onclick=\"window.open(\'',mf.view_page,'?ref_fact=',fd.ref_fact,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View invoice\">
									                    <i class=\"fas fa-eye\"></i> 
									                </button>'),' ',
									                IF(mf.excel IS NOT NULL, CONCAT('<button class=\"btn btn-xs bg-success square-btn-adjust\" onclick=\"window.location.replace(\'',mf.excel,'?ref_fact=',fd.ref_fact,'\',\'pop4\',\'width=1000,height=800\');\" title=\"Export Annex\">
									                    <i class=\"fas fa-file-excel\"></i> 
									                </button>'), '')) AS view_page
												FROM facture_dossier fd, modele_facture mf, client cl, dossier dos, detail_facture_dossier det
												WHERE YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
													AND fd.id_mod_fact = mf.id_mod_fact
													AND fd.ref_fact = det.ref_fact
													AND det.id_dos = dos.id_dos
													AND fd.id_cli = cl.id_cli
													$sqlClient
													$sqlTransit
													$sqlUtilisateur
													$sqlTime
												GROUP BY dos.id_dos
												ORDER BY dos.id_dos DESC");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					$reponse['compteur'] = $compteur;
					$reponse['montant'] = number_format($this-> getMontantFactureGlobale($reponse['ref_fact'])+(( ($this-> getMontantFactureDebours($reponse['ref_fact'], 27)*$this-> getFactureGlobale($reponse['ref_fact'])['taux_commission']) - $this-> getMontantFactureDebours($reponse['ref_fact'], 27))), 2, ',', ' ');
					$reponse['commodity'] = $this-> getMarchandiseFacture($reponse['ref_fact'])['nom_march'];
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;
				
			}else if($statut=='Dossiers Non FacturÃ©s'){

				$sqlTransit = "";
				if (isset($id_mod_lic) && ($id_mod_lic != '')) {
					$sqlTransit = ' AND dos.id_mod_lic = "'.$id_mod_lic.'" ';
				}

				$requete = $connexion-> query("SELECT dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli, 
													dos.po_ref AS po_ref,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													IF(dos.num_lot IS NOT NULL,
														dos.num_lot,
														dos.ref_fact
													) AS num_lot,
													IF(march.nom_march IS NOT NULL,
														march.nom_march,
														dos.commodity
													) AS commodity,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATEDIFF(CURRENT_DATE(), dos.date_quit) AS delay
												FROM dossier dos
												LEFT JOIN marchandise march
													ON dos.id_march = march.id_march
												LEFT JOIN client cl
													ON dos.id_cli = cl.id_cli
												WHERE dos.not_fact = '0'
													AND dos.date_decl IS NOT NULL
													AND dos.ref_decl IS NOT NULL
													AND dos.date_liq IS NOT NULL
													AND dos.ref_liq IS NOT NULL
													AND dos.date_quit IS NOT NULL
													AND dos.ref_quit IS NOT NULL
													AND dos.id_dos NOT IN (
														SELECT DISTINCT(dos.id_dos) 
															FROM facture_dossier fd, detail_facture_dossier det, dossier dos
															WHERE YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
																AND fd.ref_fact = det.ref_fact
																AND det.id_dos = dos.id_dos
													)
													$sqlTransit
												ORDER BY dos.id_dos
											");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					$reponse['compteur'] = $compteur;
					$reponse['truck'] = $reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'];
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;
				
			}

		}

		public function getListeClient(){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$compteur = 0;

			$requete = $connexion-> query("SELECT *,
												CONCAT('<button class=\"btn btn-xs bg-primary square-btn-adjust\" onclick=\"window.location.replace(\'detail_client.php?id_cli=',id_cli,'\');\">
									                    <i class=\"fas fa-eye\"></i> 
									                </button>') AS btn_action 
											FROM client 
											ORDER BY nom_cli
										");
			// $requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
				$compteur++;

				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;
			}$requete-> closeCursor();
			
			return $rows;
			

		}

		public function getListeOperation($statut){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND dos.id_cli = "'.$id_cli.'" ';
			}

			$compteur = 0;

			if($statut=='Dossiers En Cours'){

				$requete = $connexion-> query("SELECT dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													IF(dos.num_lot IS NOT NULL,
														dos.num_lot,
														dos.ref_fact
													) AS num_lot,
													IF(march.nom_march IS NOT NULL,
														march.nom_march,
														dos.commodity
													) AS commodity,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATEDIFF(CURRENT_DATE(), dos.date_creat_dos) AS delay
												FROM dossier dos
												LEFT JOIN marchandise march
													ON dos.id_march = march.id_march
												LEFT JOIN client cl
													ON dos.id_cli = cl.id_cli
												WHERE dos.cleared = '0'
													AND dos.ref_dos NOT LIKE '%20-%'
													AND (dos.id_mod_lic = '1' OR dos.id_mod_lic = '2')
												ORDER BY dos.id_dos");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					$reponse['compteur'] = $compteur;
					$reponse['truck'] = $reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'];
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;

			}else if($statut=='Dossiers non declarÃ©s'){

				$requete = $connexion-> query("SELECT dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													IF(dos.num_lot IS NOT NULL,
														dos.num_lot,
														dos.ref_fact
													) AS num_lot,
													IF(march.nom_march IS NOT NULL,
														march.nom_march,
														dos.commodity
													) AS commodity,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATEDIFF(CURRENT_DATE(), dos.date_creat_dos) AS delay
												FROM dossier dos
												LEFT JOIN marchandise march
													ON dos.id_march = march.id_march
												LEFT JOIN client cl
													ON dos.id_cli = cl.id_cli
												WHERE dos.cleared = '0'
													AND dos.ref_dos NOT LIKE '%20-%'
													AND (dos.id_mod_lic = '1' OR dos.id_mod_lic = '2')
													AND dos.ref_decl IS NULL
													AND dos.date_decl IS NULL
												ORDER BY dos.id_dos");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					$reponse['compteur'] = $compteur;
					$reponse['truck'] = $reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'];
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;

			}else if($statut=='Dossiers DeclarÃ©s Non LiquidÃ©s'){

				$requete = $connexion-> query("SELECT dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													IF(dos.num_lot IS NOT NULL,
														dos.num_lot,
														dos.ref_fact
													) AS num_lot,
													IF(march.nom_march IS NOT NULL,
														march.nom_march,
														dos.commodity
													) AS commodity,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATEDIFF(CURRENT_DATE(), dos.date_creat_dos) AS delay
												FROM dossier dos
												LEFT JOIN marchandise march
													ON dos.id_march = march.id_march
												LEFT JOIN client cl
													ON dos.id_cli = cl.id_cli
												WHERE dos.cleared = '0'
													AND dos.ref_dos NOT LIKE '%20-%'
													AND (dos.id_mod_lic = '1' OR dos.id_mod_lic = '2')
													AND dos.ref_decl IS NOT NULL
													AND dos.date_decl IS NOT NULL
													AND dos.ref_liq IS NULL
													AND dos.date_liq IS NULL
												ORDER BY dos.id_dos");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					$reponse['compteur'] = $compteur;
					$reponse['truck'] = $reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'];
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;

			}else if($statut=='Dossiers En Attente Quittance'){

				$requete = $connexion-> query("SELECT dos.ref_dos AS ref_dos,
													cl.nom_cli AS nom_cli,
													dos.horse AS horse,
													dos.trailer_1 AS trailer_1,
													dos.trailer_2 AS trailer_2,
													IF(dos.num_lot IS NOT NULL,
														dos.num_lot,
														dos.ref_fact
													) AS num_lot,
													IF(march.nom_march IS NOT NULL,
														march.nom_march,
														dos.commodity
													) AS commodity,
													dos.ref_decl AS ref_decl,
													DATE_FORMAT(dos.date_decl, '%d/%m/%Y') AS date_decl,
													dos.ref_liq AS ref_liq,
													DATE_FORMAT(dos.date_liq, '%d/%m/%Y') AS date_liq,
													dos.ref_quit AS ref_quit,
													DATE_FORMAT(dos.date_quit, '%d/%m/%Y') AS date_quit,
													DATEDIFF(CURRENT_DATE(), dos.date_creat_dos) AS delay
												FROM dossier dos
												LEFT JOIN marchandise march
													ON dos.id_march = march.id_march
												LEFT JOIN client cl
													ON dos.id_cli = cl.id_cli
												WHERE dos.cleared = '0'
													AND dos.ref_dos NOT LIKE '%20-%'
													AND (dos.id_mod_lic = '1' OR dos.id_mod_lic = '2')
													AND dos.ref_liq IS NOT NULL
													AND dos.date_liq IS NOT NULL
													AND dos.ref_quit IS NULL
													AND dos.date_quit IS NULL
												ORDER BY dos.id_dos");
				// $requete-> execute(array($entree['id_mod_lic']));
				while($reponse = $requete-> fetch()){
					$compteur++;

					$reponse['compteur'] = $compteur;
					$reponse['truck'] = $reponse['horse'].' / '.$reponse['trailer_1'].' / '.$reponse['trailer_2'];
					$rows[] = $reponse;
				}$requete-> closeCursor();
				
				return $rows;

			}
		}

		public function getNbreDossierFacture($id_mod_lic=NULL, $id_util=NULL, $debut=NULL, $fin=NULL){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlTransit = "";
			if (isset($id_mod_lic) && ($id_mod_lic != '')) {
				$sqlTransit = ' AND dos.id_mod_lic = "'.$id_mod_lic.'" ';
			}

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND fd.id_cli = "'.$id_cli.'" ';
			}

			$sqlUtilisateur = "";
			if (isset($id_util) && ($id_util != '')) {
				$sqlUtilisateur = ' AND fd.id_util = "'.$id_util.'" ';
			}

			$sqlTime = "";
			if (isset($debut) && ($debut != '') && isset($fin) && ($fin != '')) {
				$sqlTime = ' AND DATE(fd.date_fact) BETWEEN "'.$debut.'" AND "'.$fin.'"';
			}

			$compteur = 0;

			$requete = $connexion-> query("SELECT COUNT(DISTINCT(dos.id_dos)) AS nbre
												FROM facture_dossier fd, detail_facture_dossier det, dossier dos
												WHERE YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
													AND fd.ref_fact = det.ref_fact
													AND fd.note_debit = '0'
													AND det.id_dos = dos.id_dos
													$sqlClient
													$sqlTransit
													$sqlUtilisateur
													$sqlTime");
			// $requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function nbre_facture_sans_taux($id_mod_lic=NULL){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlTransit = "";
			if (isset($id_mod_lic) && ($id_mod_lic != '')) {
				$sqlTransit = ' AND dos.id_mod_lic = "'.$id_mod_lic.'" ';
			}

			$compteur = 0;

			$requete = $connexion-> query("SELECT COUNT(DISTINCT(dos.id_dos)) AS nbre
												FROM dossier dos
												WHERE dos.id_dos IN (
														SELECT DISTINCT(id_dos)
															FROM detail_facture_dossier det, facture_dossier fact
															WHERE det.ref_fact = fact.ref_fact
													)
													AND (
														dos.id_bank_liq IS NULL
														OR
														dos.roe_decl <> (
																SELECT tb.montant
																	FROM taux_banque tb
																	WHERE tb.id_banq = dos.id_bank_liq
																		AND tb.date_taux = dos.date_quit
															)
														)
													AND DATE(dos.date_quit) >= '2023-08-22'
													$sqlTransit");
			// $requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNbreDossierNonFacture($id_mod_lic){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$sqlTransit = "";
			if (isset($id_mod_lic) && ($id_mod_lic != '')) {
				$sqlTransit = ' AND id_mod_lic = "'.$id_mod_lic.'" ';
			}

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$compteur = 0;

			$requete = $connexion-> query("SELECT COUNT(id_dos) AS nbre
											FROM dossier
											WHERE not_fact = '0'
												AND date_decl IS NOT NULL
												AND ref_decl IS NOT NULL
												AND date_liq IS NOT NULL
												AND ref_liq IS NOT NULL
												AND date_quit IS NOT NULL
												AND ref_quit IS NOT NULL
												AND id_dos NOT IN (
													SELECT DISTINCT(dos.id_dos) 
														FROM facture_dossier fd, detail_facture_dossier det, dossier dos
														WHERE YEAR(fd.date_fact) = YEAR(CURRENT_DATE())
															AND fd.ref_fact = det.ref_fact
															AND fd.note_debit = '0'
															AND det.id_dos = dos.id_dos
												)
												$sqlTransit
												$sqlClient
										");
			// $requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNombreFactureAvecLicence($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$compteur = 0;

			$requete = $connexion-> prepare("SELECT ref_fact
												FROM facture_licence
												WHERE id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){

				if ($this-> getLicenceFacture($reponse['ref_fact']) != null) {
					$compteur++;
				}

			}$requete-> closeCursor();
			
			return $compteur;
		}

		public function getNombreDossierFacture($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND cleared = '1'
													AND facture = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierManqueFob($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (fob = '' OR fob IS NULL OR fob = '0')
													AND id_cli <> 869
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierManqueAv($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (ref_av = '' OR ref_av IS NULL OR montant_av = '' OR montant_av IS NULL)
													AND id_cli <> 869
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierManqueRoadManifest($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (road_manif = '' OR road_manif IS NULL)
													AND id_cli <> 869
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		/*public function getNombreDossierManqueRoadManifest($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (road_manif = '' OR road_manif IS NULL)
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}*/

		public function getNombreDossierManqueDeclarationOuQuittance($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'" ';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE id_mod_lic = ?
													AND (ref_decl = '' OR ref_decl IS NULL OR ref_quit = '' OR ref_quit IS NULL)
													AND cleared = '1'
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreDossierTransmissionApurement($id_trans_ap){
			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare('SELECT COUNT(id_dos) AS nbre
												FROM detail_apurement
												WHERE id_trans_ap = ?');
			$requete-> execute(array($entree['id_trans_ap']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}

		public function getNombreLicenceTransmissionApurement($id_trans_ap){
			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare('SELECT COUNT(DISTINCT(l.num_lic)) AS nbre
												FROM detail_apurement dt, dossier d, licence l
												WHERE dt.id_trans_ap = ?
													AND dt.id_dos = d.id_dos
													AND d.num_lic = l.num_lic');
			$requete-> execute(array($entree['id_trans_ap']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}
		}
		
		public function getNombreDossierClientModeTransportModeLicence3($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND ((d.date_quit IS NULL AND d.ref_quit IS NULL) 
														OR (d.date_quit = '' OR d.ref_quit = ''))
													$sql1
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNombreDossierLicence($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier 
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNombreDossierApureLicence($num_lic, $id_trans_ap){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;
			$entree['id_trans_ap'] = $id_trans_ap;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM detail_apurement
												WHERE id_dos IN (
													SELECT id_dos FROM dossier WHERE num_lic = ?
												)
												AND id_trans_ap = ?");
			$requete-> execute(array($entree['num_lic'], $entree['id_trans_ap']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, $debut, $fin){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND ((d.date_quit IS NULL AND d.ref_quit IS NULL) 
														OR (d.date_quit = '' OR d.ref_quit = ''))
													$sql1
													AND d.id_dos BETWEEN ? AND ?
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], 
									$entree['debut'], $entree['fin']));
			$reponse = $requete-> fetch();
			
			return $reponse['nbre'];
		}

		public function getNombreLicenceEnCoursModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = "";
			$sql2 = "";
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob, poids
												FROM licence
												WHERE id_mod_lic = ?
												$sql
												$sql2
													AND id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				if ($id_mod_lic == '1') {
					if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['poids'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$nbre++;
					}
				}else if ($id_mod_lic == '2') {
					if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
						$nbre++;
					}
				}

			}$requete-> closeCursor(); 

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicencePartiellementApure($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$nbre = 0;

			$sqlClient = "";
			$sql2 = "";
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sqlClient = ' AND cl.id_cli = '.$id_cli;
			}

			$requete = $connexion-> prepare("SELECT COUNT(l.num_lic) AS nbre
												FROM licence l, client cl
												WHERE l.id_cli = cl.id_cli
													AND l.fob > (
															SELECT sum(d.fob) AS fob
																FROM dossier d, detail_apurement det
																WHERE d.num_lic = l.num_lic
																	AND d.id_dos = det.id_dos
														)
													AND l.num_lic IN (
															SELECT DISTINCT(d.num_lic) AS num_lic
																FROM dossier d, detail_apurement det
																WHERE d.num_lic = l.num_lic
																	AND d.id_dos = det.id_dos
														)
													AND l.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch(); 

			return $reponse['nbre'];

		}

		public function getNombreLicenceTotalementApure($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$nbre = 0;

			$sqlClient = "";
			$sql2 = "";
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sqlClient = ' AND cl.id_cli = '.$id_cli;
			}

			$requete = $connexion-> prepare("SELECT COUNT(l.num_lic) AS nbre
												FROM licence l, client cl
												WHERE l.id_cli = cl.id_cli
													AND l.fob <= (
															SELECT sum(d.fob) AS fob
																FROM dossier d, detail_apurement det
																WHERE d.num_lic = l.num_lic
																	AND d.id_dos = det.id_dos
														)
													AND l.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch(); 

			return $reponse['nbre'];

		}

		public function getNombreLicenceExpiree($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$nbre = 0;

			$sqlClient = "";
			$sql2 = "";
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sqlClient = ' AND cl.id_cli = '.$id_cli;
			}

			$requete = $connexion-> prepare("SELECT COUNT(l.num_lic) AS nbre
												FROM licence l, client cl
												WHERE l.id_cli = cl.id_cli
													AND (
															(
																l.fob > (
																	SELECT sum(d.fob) AS fob
																		FROM dossier d, detail_apurement det
																		WHERE d.num_lic = l.num_lic
																			AND d.id_dos = det.id_dos
																)
																AND
																l.num_lic IN (
																	SELECT DISTINCT(d.num_lic)
																		FROM dossier d, detail_apurement det
																		WHERE d.num_lic = l.num_lic
																			AND d.id_dos = det.id_dos
																)
															)
															OR (
																l.num_lic NOT IN (
																	SELECT DISTINCT(d.num_lic)
																		FROM dossier d, detail_apurement det
																		WHERE d.num_lic = l.num_lic
																			AND d.id_dos = det.id_dos
																)
															)
														)

													AND l.num_lic IN (
															SELECT num_lic
																FROM expiration_licence
																WHERE date_exp <= CURRENT_DATE()
																AND id_date_exp = (
																		SELECT MAX(id_date_exp)
																			FROM expiration_licence
																			WHERE num_lic = l.num_lic
																	)
														)
													AND l.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch(); 

			return $reponse['nbre'];

		}

		public function getNombreLicenceEnCours($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$nbre = 0;

			$sqlClient = "";
			$sql2 = "";
			
			if( ($id_cli != null) && ($id_cli != '')){
				$sqlClient = ' AND cl.id_cli = '.$id_cli;
			}

			$requete = $connexion-> prepare("SELECT COUNT(l.num_lic) AS nbre
												FROM licence l, client cl
												WHERE l.id_cli = cl.id_cli
													AND l.fob > (
															SELECT sum(d.fob) AS fob
																FROM dossier d, detail_apurement det
																WHERE d.num_lic = l.num_lic
																	AND d.id_dos = det.id_dos
														)
													AND (l.fob-5) > (
															SELECT sum(d.fob) AS fob
																FROM dossier d, detail_apurement det
																WHERE d.num_lic = l.num_lic
																	AND d.id_dos = det.id_dos
														)
													AND l.num_lic IN (
															SELECT num_lic
																FROM expiration_licence
																WHERE date_exp >= CURRENT_DATE()
																AND id_date_exp = (
																		SELECT MAX(id_date_exp)
																			FROM expiration_licence
																			WHERE num_lic = l.num_lic
																	)
														)
													AND l.id_mod_lic = ?
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch(); 

			return $reponse['nbre'];

		}

		public function getNombreLicenceExpiration40JoursModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, poids AS fob
													FROM licence
													WHERE id_mod_lic = ?
													$sql
													$sql2
													AND id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}else{
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob
													FROM licence
													WHERE id_mod_lic = ?
													$sql
													$sql2
													AND id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) <= 40) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) > 0) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
					$nbre++;
				}
			}$requete-> closeCursor(); 

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicenceExpireModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, poids AS fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
														AND apurement <> '1'
													$sql
													$sql2
													AND l.id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}else{
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
														AND apurement <> '1'
													$sql
													$sql2
													AND l.id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				if( ($date_exp < $reponse['aujourdhui']) && ($reponse['fob'] > $this-> getSommeFobLicence($reponse['num_lic']))){
					$nbre++;
				}
			}$requete-> closeCursor(); 

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicenceClotureeAppureeModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, poids AS fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
														AND apurement <> '1'
													$sql
													$sql2
													AND id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}else{
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
														AND apurement <> '1'
													$sql
													$sql2
													AND id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['fob'] != $this-> getSommeFobAppureLicence($reponse['num_lic'])) && ($this-> verifierApurementDossierLicence($reponse['num_lic']) == false) ){
					$nbre++;
				}
			}$requete-> closeCursor(); 

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicenceCIFLicenceDifferentCIFDossier($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob,
													(fob+fret+assurance+autre_frais) AS cif
												FROM licence
												WHERE id_mod_lic = ?
												$sql
												$sql2
													AND id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) && ($reponse['cif'] != $this-> getSommeCIFLicence($reponse['num_lic'])) ){
					$nbre++;
				}
			}$requete-> closeCursor(); 

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreLicenceClotureeTrackingAttenteBanqueAppureeModele($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$nbre = 0;

			$sql = '';
			$sql2 = '';

			if( ($id_cli != null) && ($id_cli != '')){
				$sql = ' AND id_cli = '.$id_cli;
			}

			if( ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			if ($id_mod_lic == '1') {
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, poids AS fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
													$sql
													$sql2
													AND id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}else{
				$requete = $connexion-> prepare("SELECT num_lic, DATE(CURRENT_DATE()) AS aujourdhui, fob
													FROM licence
													WHERE id_mod_lic = ?
														AND date_val IS NOT NULL
													$sql
													$sql2
													AND id_cli IN (
														SELECT id_cli 
															FROM souscription_licence 
															WHERE id_mod_lic = ? 
														)");
			}

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				if( ($this-> verifierApurementDossierLicence($reponse['num_lic']) != false) && ($reponse['num_lic'] != 'UNDER VALUE') ){
					$nbre++;
				}
			}$requete-> closeCursor(); 

			return $nbre;
			//return $this-> getDifferenceDate('2020-11-15', $date_exp);
		}

		public function getNombreDossierClientModeTransportModeLicence($id_cli, $id_mod_trans, $id_mod_lic, $num_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.*) AS nbre
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND l.num_lic = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['num_lic'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierClientModeTransportModeLicence2($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.id_dos) AS nbre
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierLogistiqueClientModeTransport($id_cli, $id_mod_trans, $id_trans){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_trans'] = $id_trans;
			//$entree['num_lic'] = $num_lic;

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_trans = '.$id_trans;
			echo '<br> num_lic = '.$num_lic;*/

			$requete = $connexion-> prepare("SELECT COUNT(d.ref_dos) AS nbre
												FROM dossier_logistique d, client cl, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_trans = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_trans']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreLicenceClientModeLicenceTypeLicence($id_cli, $id_mod_lic, $id_type_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;


			if((isset($id_type_lic)) && ($id_type_lic != null) && ($id_type_lic != '')){
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}else{
				$sql2 = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(*) AS nbre
												FROM licence
												WHERE id_cli = ?
													AND id_mod_lic = ?
													$sql2");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreFactureClientModeldeLicence($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;


			if((isset($id_cli)) && ($id_cli != null) && ($id_cli != '')){
				$sql2 = ' AND id_cli = '.$id_cli;
			}else{
				$sql2 = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(*) AS nbre
												FROM facture_licence
												WHERE id_mod_lic = ?
													$sql2");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombrePartielleEtat($id_cli, $consommable, $etat){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['consommable'] = $consommable;
			$sqlClient = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND l.id_cli = '.$id_cli;
			}

			if ($etat == 'Partial Without FOB') {

				$requete = $connexion-> prepare("SELECT COUNT(part.id_part) AS nbre
													FROM partielle_av part, licence l
													WHERE (part.fob IS NULL OR part.fob = 0)
														AND part.cod = l.cod
														AND l.consommable = ?
														$sqlClient");
			}else if ($etat == 'Partial Without Weight') {

				$requete = $connexion-> prepare("SELECT COUNT(part.id_part) AS nbre
													FROM partielle_av part, licence l
													WHERE (part.poids IS NULL OR part.poids = 0)
														AND part.cod = l.cod
														AND l.consommable = ?
														$sqlClient");
			}else if ($etat == 'Partial Having Negative FOB Balance') {

				$requete = $connexion-> prepare("SELECT COUNT(part.id_part) AS nbre
													FROM partielle_av part, licence l
													WHERE part.cod = l.cod
														AND l.consommable = ?
														$sqlClient
														AND part.fob < (
															SELECT SUM(fob)
																FROM dossier 
																WHERE REPLACE(ref_crf, ' ', '') = REPLACE(CONCAT(part.cod,part.num_part), ' ', '')
																GROUP BY REPLACE(ref_crf, ' ', '')
														)
													");
			}else if ($etat == 'Partial Having Negative Weight Balance') {

				$requete = $connexion-> prepare("SELECT COUNT(part.id_part) AS nbre
													FROM partielle_av part, licence l
													WHERE part.cod = l.cod
														AND l.consommable = ?
														$sqlClient
														AND part.poids < (
															SELECT SUM(poids)
																FROM dossier 
																WHERE REPLACE(ref_crf, ' ', '') = REPLACE(CONCAT(part.cod,part.num_part), ' ', '')
																GROUP BY REPLACE(ref_crf, ' ', '')
														)
													");
			}

			$requete-> execute(array($entree['consommable']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreCRFSansPartielle($id_cli, $consommable){
			include('connexion.php');

			$entree['consommable'] = $consommable;

			$sqlClient = '';

			if (isset($id_cli) && ($id_cli!='')) {
				$sqlClient = ' AND l.id_cli = '.$id_cli;
			}

			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(dos.ref_crf)) AS nbre
												FROM dossier dos, licence l, client cl
												WHERE REPLACE(dos.ref_crf, ' ', '') NOT IN (
														SELECT REPLACE(CONCAT(cod,num_part), ' ', '')
															FROM partielle_av
													)
													AND REPLACE(dos.ref_crf, ' ', '') <> ''
													AND REPLACE(dos.ref_crf, ' ', '') <> 'N/A'
													AND dos.id_cli = cl.id_cli
													$sqlClient
													AND dos.num_lic = l.num_lic
													AND l.consommable = ?
													AND DATE(l.date_val) >= '2022-08-01'");
			$requete-> execute(array($entree['consommable']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse['nbre'];
			}else{
				return 0;
			}
			

		}

		public function getNombreDocumentApurement($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;


			$requete = $connexion-> prepare("SELECT COUNT(DISTINCT(tr.id_trans_ap)) AS nbre
												FROM client cl, transmission_apurement tr, detail_apurement dt, dossier d
												WHERE cl.id_cli = ?
													AND cl.id_cli = d.id_cli
													AND d.id_dos = dt.id_dos
													AND dt.id_trans_ap = tr.id_trans_ap");
			$requete-> execute(array($entree['id_cli']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}

		public function getNombreDossierComplementDataDossier($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;



			if((isset($id_cli)) && ($id_cli != null) && ($id_cli != '')){
				$sqlClient = ' AND id_cli = '.$id_cli;
			}else{
				$sqlClient = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(id_dos) AS nbre
												FROM dossier
												WHERE (
														fob = '' OR fob IS NULL OR fob = '0'
														OR ref_av IS NULL OR ref_av = ''
														OR montant_av IS NULL OR montant_av = ''
														OR road_manif IS NULL OR road_manif = ''
														OR ref_decl IS NULL OR ref_decl = ''
														OR montant_decl IS NULL OR montant_decl = ''
														OR ref_quit IS NULL OR ref_quit = ''
														OR ref_fact IS NULL OR ref_fact = ''
													)
													AND id_mod_lic = ?
													AND (cleared = '1' OR cleared = '0')
													$sqlClient");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}
		/*
		public function getNombreDossierClientModeTransportModeLicence($id_cli, $id_mod_trans, $id_mod_lic, $num_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['num_lic'] = $num_lic;

			$requete = $connexion-> prepare("SELECT COUNT(d.*) AS nbre
												FROM dossier d, client cl, licence l, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.num_lic = l.num_lic
													AND l.num_lic = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
												ORDER BY d.id_dos DESC");
			$requete-> execute(array($entree['id_cli'], $entree['num_lic'], $entree['id_mod_trans'], $entree['id_mod_lic']));
			$reponse = $requete-> fetch();
			return $reponse['nbre'];

		}
		*/
		public function getDifferenceDate($date1, $date2){
			include('connexion.php');
			$entree['date1'] = $date1;
			$entree['date2'] = $date2;

			$requete = $connexion-> prepare('SELECT DATEDIFF(IF(? IS NULL, DATE(CURRENT_DATE()), ?) ,?) AS difference');
			$requete-> execute(array($entree['date1'], $entree['date1'], $entree['date2']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['difference'];
			}
		}

		public function nbreImportKlsa(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(klsa_arriv) = CURRENT_DATE()");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreWiskiArrived($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(wiski_arriv) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreWiskiDeparture($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(wiski_dep) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDgdaIn($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(dgda_in) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreUnderWiski($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE (wiski_arriv IS NOT NULL AND wiski_arriv <> '')
												AND (wiski_dep IS NULL OR wiski_dep = '')
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreUnderDgda($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE (dgda_in IS NOT NULL AND dgda_in <> '')
												AND (dgda_out IS NULL OR dgda_out = '')
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierLiquidation($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE ( (date_liq IS NOT NULL OR date_liq <> '')
													OR (ref_liq IS NOT NULL OR ref_liq <> '') )
												AND ( (date_quit IS NULL OR date_quit = '') 
													OR (ref_quit IS NULL OR ref_quit = '') )
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierQuittance($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(date_quit) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDgdaOut($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(dgda_out) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreAwaitCRF($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE (wiski_dep IS NOT NULL AND wiski_dep <> '')
												AND ( (date_crf IS NULL OR date_crf = '') AND (ref_crf IS NULL OR ref_crf = '' ))
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportWiskiDeparture(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(wiski_dep) = CURRENT_DATE()");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportDgdaIn(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(dgda_in) = CURRENT_DATE()");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportDgdaOrLiquidation(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(dgda_in) IS NOT NULL
												AND (dgda_out IS NULL
														AND date_liq IS NULL AND ref_liq IS NULL)
												AND DATEDIFF(CURRENT_DATE(), ADDDATE(dgda_in, 1)) > 1");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierModeleLicence($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE id_mod_lic = ?
											$sql
											$sqlTrans
											$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierCleared($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE cleared = '1'
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierProcess($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE cleared = '0'
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierCanceled($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE cleared = '2'
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierKlsaToDay($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE DATE(arrival_date) = CURRENT_DATE()
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportLiquidation(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE date_liq IS NOT NULL
												AND date_quit IS NULL
												AND ref_quit IS NULL");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportQuitance(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE date_quit IS NOT NULL
												AND ref_quit IS NOT NULL
												AND dgda_out IS NULL");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreImportDgdaOut(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE (DATE(dgda_out) = CURRENT_DATE()
													OR DATE(dgda_out) = ADDDATE(CURRENT_DATE(),-1))");
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		public function nbreDossierClearedWaitFacture($id_mod_lic, $id_cli, $id_mod_trans, $commodity){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			if (isset($id_cli) && ($id_cli != '')) {
				$sql = ' AND id_cli = '.$id_cli;
			}else{
				$sql = '';
			}

			if (isset($id_mod_trans) && ($id_mod_trans != '')) {
				$sqlTrans = ' AND id_mod_trans = '.$id_mod_trans;
			}else{
				$sqlTrans = '';
			}

			if (isset($commodity) && ($commodity != '')) {
				$sqlCommodity = ' AND commodity = "'.$commodity.'"';
			}else{
				$sqlCommodity = '';
			}

			$requete = $connexion-> prepare("SELECT COUNT(ref_dos) AS nbre
											FROM dossier
											WHERE cleared = '1'
												AND facture = '0'
												AND id_mod_lic = ?
												$sql
												$sqlTrans
												$sqlCommodity");
			$requete-> execute(array($entree['id_mod_lic']));
			$reponse = $requete-> fetch();

			if($reponse){
				return $reponse['nbre'];
			}

		}

		//FIN Methode permettant de recuperer

		//Methodes permettant de Selectionner 

		public function selectionnerModeleLicence(){
			include('connexion.php');
			// $entree['id_role'] = $id_role;
			$requete = $connexion-> query("SELECT *
											FROM modele_licence
											WHERE id_etat = 1");
			// $requete-> execute(array($entree['id_role']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_mod_lic']; ?>">
					<?php echo $reponse['nom_mod_lic']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerUtilisateurRole($id_role){
			include('connexion.php');
			$entree['id_role'] = $id_role;
			$requete = $connexion-> prepare("SELECT *
											FROM utilisateur
											WHERE id_role = ?
											ORDER BY nom_util");
			$requete-> execute(array($entree['id_role']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_util']; ?>">
					<?php echo $reponse['nom_util']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerJournal(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM journal");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_jour']; ?>">
					<?php echo $reponse['nom_jour']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerTypeEcriture(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM type_ecriture");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_t_e']; ?>">
					<?php echo $reponse['nom_t_e']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerEtatPV(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM etat_pv");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_etat']; ?>">
					<?php echo $reponse['nom_etat']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerTresorerie(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM tresorerie
											ORDER BY nom_tres");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_tres']; ?>">
					<?php echo $reponse['nom_tres']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerScenariioPV(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM senario_pv");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_sen']; ?>">
					<?php echo $reponse['nom_sen']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerScenario(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM senario_pv");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_sen']; ?>">
					<?php echo $reponse['nom_sen']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerFactureEnCoursClient($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
											FROM facture_dossier
											WHERE id_cli = ?
												AND id_mod_trans = ?
												AND id_mod_lic = ?
												AND validation = '2'");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['ref_fact']; ?>">
					<?php echo $reponse['ref_fact']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerFactureNonValideeClient($id_cli, $id_mod_trans, $id_mod_lic){
			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;

			$select = '<select class="form-control form-control-sm bg bg-dark" type="text" name="ref_fact" id="ref_fact" onchange="detail_invoice_acid(this.value);">
              			<option></option>';

			$requete = $connexion-> prepare("SELECT *
											FROM facture_dossier
											WHERE id_cli = ?
												AND id_mod_trans = ?
												AND id_mod_lic = ?
												AND validation = '0'
											ORDER BY ref_fact DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				$select .= '<option value="'.$reponse['ref_fact'].'">
								'.$reponse['ref_fact'].'
							</option>';
			}$requete-> closeCursor();

			$select .= '</select>';

			return $select;
		}

		public function detail_invoice_acid($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			// $entree['id_mod_trans'] = $id_mod_trans;
			// $entree['id_mod_lic'] = $id_mod_lic;

			$file = '';
			$compteur = 0;
			$duty_cdf = 0;
			$duty_usd = 0;
			$other_usd = 0;
			$total_usd = 0;
			$liquidation = 0;
			$liquidation_usd = 0;

			$requete = $connexion-> prepare("SELECT dossier.ref_dos AS ref_dos,
													dossier.id_dos AS id_dos,
													dossier.id_cli AS id_cli,
													dossier.id_mod_lic AS id_mod_lic,
													dossier.id_march AS id_march,
													dossier.id_mod_trans AS id_mod_trans,
													dossier.num_lic AS num_lic,
													dossier.roe_decl AS roe_decl,
													SUM(
														IF(detail_facture_dossier.usd='0', 
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.montant_tva>0,
																	detail_facture_dossier.montant_tva+detail_facture_dossier.montant,
																	detail_facture_dossier.montant*0.16
																	),
																detail_facture_dossier.montant
															),
															0
														)
													) AS ttc_cdf,
													SUM(
														IF(debours.id_t_deb='1' AND detail_facture_dossier.usd='0',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant*dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant*dossier.roe_decl)
																)
															, 0)
														) AS liquidation,
													SUM(
														IF(debours.id_t_deb='1' AND detail_facture_dossier.usd='0',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='0',
																	(detail_facture_dossier.montant*1.16)/dossier.roe_decl,
																	(detail_facture_dossier.montant*dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant/dossier.roe_decl,
																	detail_facture_dossier.montant)
																)
															, 0)
														) AS liquidation_usd,
													SUM(
														IF(debours.id_t_deb='1',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant*dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant*dossier.roe_decl)
																)
															, 0)
														) AS duty_cdf,
													SUM(
														IF(debours.id_t_deb='1',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant/dossier.roe_decl)
																)
															, 0)
														) AS duty_usd,
													SUM(
														IF(debours.id_t_deb<>'1',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant/dossier.roe_decl)
																)
															, 0)
														) AS other_usd,
													SUM(
														IF(detail_facture_dossier.tva='1',
															IF(detail_facture_dossier.usd='1',
																detail_facture_dossier.montant*1.16,
																(detail_facture_dossier.montant/dossier.roe_decl)*1.16),
															IF(detail_facture_dossier.usd='1',
																detail_facture_dossier.montant,
																(detail_facture_dossier.montant/dossier.roe_decl))
															)
														) AS total_usd
												FROM dossier, detail_facture_dossier, debours
												WHERE detail_facture_dossier.ref_fact = ?
													AND detail_facture_dossier.id_dos = dossier.id_dos
													AND detail_facture_dossier.id_deb = debours.id_deb
												GROUP BY dossier.id_dos");
			$requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$duty_cdf += $reponse['duty_cdf'];
				$duty_usd += $reponse['duty_usd'];
				$other_usd += $reponse['other_usd'];
				$total_usd += $reponse['total_usd'];
				$liquidation += $reponse['liquidation'];
				$liquidation_usd += $reponse['liquidation_usd'];

				$file .= '<tr>
							<td>'.$compteur.'</td>
							<td>'.$reponse['ref_dos'].'</td>
							<td style="text-align: right;">'.number_format($reponse['roe_decl'], 4, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['liquidation'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['liquidation_usd'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['ttc_cdf'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['duty_usd'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['other_usd'], 2, ',', ' ').'</td>
							<td style="text-align: right;">'.number_format($reponse['total_usd'], 2, ',', ' ').'</td>
							<td style="text-align: center;">
								<span class="btn btn-xs btn btn-warning" onclick="modalEditDetailFactureDossier('.$reponse['id_dos'].', \''.$ref_fact.'\', \''.$reponse['ref_dos'].'\', '.$reponse['id_cli'].', '.$reponse['id_mod_lic'].', '.$reponse['id_march'].', '.$reponse['id_mod_trans'].', \''.$reponse['num_lic'].'\', \''.$ref_fact.'\');">
									<i class="fa fa-edit"></i>
								</span>
								<span class="btn btn-xs btn btn-danger" onclick="supprimerDetailFactureDossier2('.$reponse['id_dos'].', \''.$ref_fact.'\', \''.$reponse['ref_dos'].'\', '.$reponse['id_cli'].', '.$reponse['id_mod_lic'].', '.$reponse['id_march'].', '.$reponse['id_mod_trans'].', \''.$reponse['num_lic'].'\');">
									<i class="fa fa-times"></i>
								</span>
							</td>
						</tr>';
			}$requete-> closeCursor();

			$file .= '<tr>
						<td colspan="3">TOTAL</td>
						<td style="text-align: right;">'.number_format($liquidation, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($liquidation_usd, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($duty_cdf, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($duty_usd, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($other_usd, 2, ',', ' ').'</td>
						<td style="text-align: right;">'.number_format($total_usd, 2, ',', ' ').'</td>
					</tr>';

			return $file;
		}

		public function detail_invoice($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			// $entree['id_mod_trans'] = $id_mod_trans;
			// $entree['id_mod_lic'] = $id_mod_lic;

			$file = '';
			$compteur = 0;
			$duty_cdf = 0;
			$duty_usd = 0;
			$other_usd = 0;
			$total_usd = 0;
			$liquidation = 0;
			$liquidation_usd = 0;

			$requete = $connexion-> prepare("SELECT dossier.ref_dos AS ref_dos,
													dossier.id_dos AS id_dos,
													dossier.id_cli AS id_cli,
													dossier.id_mod_lic AS id_mod_lic,
													dossier.id_march AS id_march,
													dossier.id_mod_trans AS id_mod_trans,
													dossier.num_lic AS num_lic,
													dossier.roe_decl AS roe_decl,
													SUM(
														IF(detail_facture_dossier.usd='0', 
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.montant_tva>0,
																	detail_facture_dossier.montant_tva+detail_facture_dossier.montant,
																	detail_facture_dossier.montant*0.16
																	),
																detail_facture_dossier.montant
															),
															0
														)
													) AS ttc_cdf,
													SUM(
														IF(debours.id_t_deb='1' AND detail_facture_dossier.usd='0',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant*dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant*dossier.roe_decl)
																)
															, 0)
														) AS liquidation,
													SUM(
														IF(debours.id_t_deb='1' AND detail_facture_dossier.usd='0',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='0',
																	(detail_facture_dossier.montant*1.16)/dossier.roe_decl,
																	(detail_facture_dossier.montant*dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant/dossier.roe_decl,
																	detail_facture_dossier.montant)
																)
															, 0)
														) AS liquidation_usd,
													SUM(
														IF(debours.id_t_deb='1',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant*dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='0',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant*dossier.roe_decl)
																)
															, 0)
														) AS duty_cdf,
													SUM(
														IF(debours.id_t_deb='1',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant/dossier.roe_decl)
																)
															, 0)
														) AS duty_usd,
													SUM(
														IF(debours.id_t_deb<>'1',
															IF(detail_facture_dossier.tva='1',
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant*1.16,
																	(detail_facture_dossier.montant/dossier.roe_decl)*1.16),
																IF(detail_facture_dossier.usd='1',
																	detail_facture_dossier.montant,
																	detail_facture_dossier.montant/dossier.roe_decl)
																)
															, 0)
														) AS other_usd,
													SUM(
														IF(detail_facture_dossier.tva='1',
															IF(detail_facture_dossier.usd='1',
																detail_facture_dossier.montant*1.16,
																(detail_facture_dossier.montant/dossier.roe_decl)*1.16),
															IF(detail_facture_dossier.usd='1',
																detail_facture_dossier.montant,
																(detail_facture_dossier.montant/dossier.roe_decl))
															)
														) AS total_usd
												FROM dossier, detail_facture_dossier, debours
												WHERE detail_facture_dossier.ref_fact = ?
													AND detail_facture_dossier.id_dos = dossier.id_dos
													AND detail_facture_dossier.id_deb = debours.id_deb
												GROUP BY dossier.id_dos");
			$requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$duty_cdf += $reponse['duty_cdf'];
				$duty_usd += $reponse['duty_usd'];
				$other_usd += $reponse['other_usd'];
				$total_usd += $reponse['total_usd'];
				$liquidation += $reponse['liquidation'];
				$liquidation_usd += $reponse['liquidation_usd'];

				$file .= '<tr>
							<td>'.$compteur.'</td>
							<td>'.$reponse['ref_dos'].'</td>
							<td style="text-align: right;">'.number_format($reponse['total_usd'], 2, ',', ' ').'</td>
							<td style="text-align: center;">
								<span class="btn btn-xs btn btn-danger" onclick="supprimerDetailFactureDossier3(\''.$ref_fact.'\', '.$reponse['id_dos'].');">
									<i class="fa fa-times"></i>
								</span>
							</td>
						</tr>';
			}$requete-> closeCursor();

			$file .= '<tr>
						<td colspan="2">TOTAL</td>
						<td style="text-align: right;">'.number_format($total_usd, 2, ',', ' ').'</td>
					</tr>';

			return $file;
		}

		public function modal_edit_avance($ref_fact){
			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			// $entree['id_mod_trans'] = $id_mod_trans;
			// $entree['id_mod_lic'] = $id_mod_lic;

			$file = '';
			$compteur = 0;
			$duty_cdf = 0;
			$duty_usd = 0;
			$other_usd = 0;
			$total_usd = 0;
			$liquidation = 0;
			$liquidation_usd = 0;

			$id_t_deb = '';

			$requete = $connexion-> prepare("SELECT dossier.id_dos AS id_dos,
													dossier.ref_dos AS ref_dos,
													ROUND(detail_facture_dossier.montant, 2) AS montant,
													ROUND(detail_facture_dossier.montant_tva, 2) AS montant_tva,
													detail_facture_dossier.tva AS tva,
													detail_facture_dossier.usd AS usd,
													debours.nom_deb AS nom_deb,
													debours.id_deb AS id_deb,
													type_debours.id_t_deb AS id_t_deb,
													type_debours.nom_t_deb AS nom_t_deb,
													IF(detail_facture_dossier.usd='1',
														CONCAT('<option value=\'1\'>USD</option><option value=\'0\'>CDF</option>'),
														CONCAT('<option value=\'0\'>CDF</option><option value=\'1\'>USD</option>')
													) AS usd,
													IF(detail_facture_dossier.tva='1',
														CONCAT('<option value=\'1\'>YES</option><option value=\'0\'>NO</option>'),
														CONCAT('<option value=\'0\'>NO</option><option value=\'1\'>YES</option>')
													) AS tva
												FROM dossier, detail_facture_dossier, debours, type_debours
												WHERE detail_facture_dossier.ref_fact = ?
													AND detail_facture_dossier.id_dos = dossier.id_dos
													AND detail_facture_dossier.id_deb = debours.id_deb
													AND debours.id_t_deb = type_debours.id_t_deb
												ORDER BY debours.id_t_deb, debours.rang, debours.id_deb");
			$requete-> execute(array($entree['ref_fact']));

			while($reponse = $requete-> fetch()){
				$compteur++;

				if ($id_t_deb != $reponse['id_t_deb']) {
					$id_t_deb = $reponse['id_t_deb'];
					$file.= '
							<tr id="">
								<th colspan="6" class="bg bg-secondary">
									<u>'.$reponse['nom_t_deb'].'</u> <span class="float-right text-sm badge badge-dark" id="montant_t_deb_'.$reponse['id_t_deb'].'"></span>
								</th>
							</tr>';
				}
				// advance_edit(ref_fact, id_dos, id_deb, montant, montant_tva, tva, usd)

				$file .= '<tr>
							<input type="hidden" id="id_deb_am_'.$compteur.'" value="'.$reponse['id_deb'].'">
							<td>'.$compteur.'</td>
							<td>'.$reponse['nom_deb'].'</td>
							<td><input type="number" id="montant_am_'.$compteur.'" class="text-right" value="'.$reponse['montant'].'" onblur="advance_edit(\''.$ref_fact.'\', '.$reponse['id_dos'].', id_deb_am_'.$compteur.'.value, this.value, montant_tva_am_'.$compteur.'.value, tva_am_'.$compteur.'.value, usd_am_'.$compteur.'.value);"></td>
							<td><select id="usd_am_'.$compteur.'" onchange="advance_edit(\''.$ref_fact.'\', '.$reponse['id_dos'].', id_deb_am_'.$compteur.'.value, montant_am_'.$compteur.'.value, montant_tva_am_'.$compteur.'.value, tva_am_'.$compteur.'.value, this.value);">'.$reponse['usd'].'</select></td>
							<td><select name="tva"  id="tva_am_'.$compteur.'" onchange="advance_edit(\''.$ref_fact.'\', '.$reponse['id_dos'].', id_deb_am_'.$compteur.'.value, montant_am_'.$compteur.'.value, montant_tva_am_'.$compteur.'.value, this.value, usd_am_'.$compteur.'.value);" >'.$reponse['tva'].'</select></td>
							<td><input type="number" id="montant_tva_am_'.$compteur.'" class="text-right" value="'.$reponse['montant_tva'].'" onblur="advance_edit(\''.$ref_fact.'\', '.$reponse['id_dos'].', id_deb_am_'.$compteur.'.value, montant_am_'.$compteur.'.value, this.value, tva_am_'.$compteur.'.value, usd_am_'.$compteur.'.value);"></td>
						</tr>';
			}$requete-> closeCursor();

			return $file;
		}

		public function get_total_advance($ref_fact, $id_dos){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;

			$requete = $connexion-> prepare("SELECT ROUND(SUM(
														IF(debours.id_t_deb='1', detail_facture_dossier.montant+IF(detail_facture_dossier.montant_tva IS NOT NULL, detail_facture_dossier.montant_tva, 0), 0)
													)) AS taxe,
													SUM(
														IF(debours.id_t_deb='2', 
															IF(detail_facture_dossier.tva='1', 
																detail_facture_dossier.montant*1.16,
																detail_facture_dossier.montant
															), 
															0
														)
													) AS other,
													SUM(
														IF(debours.id_t_deb='3', 
															IF(detail_facture_dossier.tva='1', 
																detail_facture_dossier.montant*1.16,
																detail_facture_dossier.montant
															), 
															0
														)
													) AS ops,
													SUM(
														IF(debours.id_t_deb='4', 
															IF(detail_facture_dossier.tva='1', 
																detail_facture_dossier.montant*1.16,
																detail_facture_dossier.montant
															), 
															0
														)
													) AS service
												FROM detail_facture_dossier, debours
												WHERE detail_facture_dossier.ref_fact = ? 
													AND detail_facture_dossier.id_dos = ?
													and detail_facture_dossier.id_deb = debours.id_deb
												GROUP BY detail_facture_dossier.id_dos");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos']));
			$reponse=$requete-> fetch();

			if($reponse){
				return $reponse;
			}
		}

		public function advance_edit($ref_fact, $id_dos, $id_deb, $montant, $montant_tva, $tva, $usd){
			include('connexion.php');

			$entree['ref_fact'] = $ref_fact;
			$entree['id_dos'] = $id_dos;
			$entree['id_deb'] = $id_deb;
			$entree['montant'] = $montant;
			$entree['montant_tva'] = $montant_tva;
			$entree['tva'] = $tva;
			$entree['usd'] = $usd;

			$requete = $connexion-> prepare("UPDATE detail_facture_dossier
											SET montant = ?, montant_tva = ?, tva = ?, usd = ?
											WHERE ref_fact = ?
												AND id_dos = ?
												AND id_deb = ?");
			$requete-> execute(array($entree['montant'], $entree['montant_tva'], $entree['tva'], $entree['usd'], $entree['ref_fact'], $entree['id_dos'], $entree['id_deb']));
		}

		public function selectionnerMonnaieComptable(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM monnaie
											WHERE comptabilite = '1'");
			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_mon']; ?>">
					<?php echo $reponse['sig_mon']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerDossierPrincipalEnAttenteFacture($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$option = "";
			$objResponse = new xajaxResponse();
			$bg = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT ref_dos, id_dos
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
													AND ref_quit IS NOT NULL
													AND ref_quit <> ''
													AND ref_decl IS NOT NULL
													AND ref_decl <> ''
													AND ref_liq IS NOT NULL
													AND ref_liq <> ''
													AND id_dos NOT IN (
															SELECT id_dos FROM detail_facture_dossier
														)
													AND not_fact = '0'
												ORDER BY id_dos  DESC");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				echo '<option value="'.$reponse['id_dos'].'">
								'.$reponse['ref_dos'].'
							</option>';
			}$requete-> closeCursor();
		}

		public function creerPVContentieux($ref_pv, $date_pv, $date_reception, $id_bur_douane, $annee, $marchandise, $id_cli, $id_mod_lic, $fichier_pv, $id_util){
			include('connexion.php');
			$entree['ref_pv']=$ref_pv;
			$entree['date_pv']=$date_pv;
			$entree['date_reception']=$date_reception;
			$entree['id_bur_douane']=$id_bur_douane;
			$entree['annee']=$annee;
			$entree['marchandise']=$marchandise;
			$entree['id_cli']=$id_cli;
			$entree['id_mod_lic']=$id_mod_lic;
			$entree['fichier_pv']=$fichier_pv;
			$entree['id_util']=$id_util;

			$requete = $connexion-> prepare('INSERT INTO pv_contencieux(ref_pv, date_pv, date_reception, 
																id_bur_douane, annee, marchandise, 
																id_cli, id_mod_lic, fichier_pv, id_util) 
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_pv'], $entree['date_pv'], $entree['date_reception'], $entree['id_bur_douane'], $entree['annee'], $entree['marchandise'], $entree['id_cli'], $entree['id_mod_lic'], $entree['fichier_pv'], $entree['id_util']));

		}

		public function creerDossierRisque($ref_doc, $id_cli, $date_doc, $date_recept, $id_bur_douane, $id_etap, $date_proch_pres, $id_reg, $fichier, $id_util){
			include('connexion.php');
			$entree['ref_doc']=$ref_doc;
			$entree['id_cli']=$id_cli;
			$entree['date_doc']=$date_doc;
			$entree['date_recept']=$date_recept;
			$entree['id_bur_douane']=$id_bur_douane;
			$entree['id_etap']=$id_etap;
			$entree['date_proch_pres']=$date_proch_pres;
			$entree['id_reg']=$id_reg;
			$entree['fichier']=$fichier;
			$entree['id_util']=$id_util;

			$requete = $connexion-> prepare('INSERT INTO dossier_risque_douane(ref_doc, id_cli, date_doc, date_recept, 
																id_bur_douane, id_etap, date_proch_pres, 
																id_reg, fichier, id_util) 
												VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
			$requete-> execute(array($entree['ref_doc'], $entree['id_cli'], $entree['date_doc'], $entree['date_recept'], $entree['id_bur_douane'], $entree['id_etap'], $entree['date_proch_pres'], $entree['id_reg'], $entree['fichier'], $entree['id_util']));

		}

		public function editerDossierRisque($id, $ref_doc, $date_doc, $date_recept, $id_bur_douane, $id_etap, $id_sen, $date_proch_pres, $id_reg, $date_pres, $remarque){
			include('connexion.php');
			$entree['id']=$id;
			$entree['ref_doc']=$ref_doc;
			$entree['date_doc']=$date_doc;
			$entree['date_recept']=$date_recept;
			$entree['id_bur_douane']=$id_bur_douane;
			$entree['id_etap']=$id_etap;
			$entree['id_sen']=$id_sen;
			$entree['date_proch_pres']=$date_proch_pres;
			$entree['id_reg']=$id_reg;
			$entree['date_pres']=$date_pres;
			$entree['remarque']=$remarque;

			if ($entree['date_pres'] == '') {
				$entree['date_pres'] = NULL;
			}

			$requete = $connexion-> prepare('UPDATE dossier_risque_douane
												SET ref_doc = ?, date_doc = ?, date_recept = ?, 
																id_bur_douane = ?, id_etap = ?, id_sen = ?, date_proch_pres = ?, 
																id_reg = ?, date_pres = ?, remarque = ?
												WHERE id = ?');
			$requete-> execute(array($entree['ref_doc'], $entree['date_doc'], $entree['date_recept'], $entree['id_bur_douane'], $entree['id_etap'], $entree['id_sen'], $entree['date_proch_pres'], $entree['id_reg'], $entree['date_pres'], $entree['remarque'], $entree['id']));

		}

		public function getPVContentieux(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$compteur=0;

			$row = array();

			$requete = $connexion-> query("SELECT bur.nom_bur_douane AS nom_bur_douane,
												pv.ref_pv AS ref_pv,
												DATE_FORMAT(pv.date_pv, '%d/%m/%Y') AS date_pv,
												DATE_FORMAT(pv.date_reception, '%d/%m/%Y') AS date_reception,
												pv.annee AS annee,
												client.nom_cli AS nom_cli,
												ml.nom_mod_lic AS nom_mod_lic,
												pv.marchandise AS marchandise,
												pv.date_deb_contrad AS date_deb_contrad,
												pv.date_next_pres AS date_next_pres,
												pv.delai_grief AS delai_grief,
												pv.action_en_cours AS action_en_cours,
												pv.remarque AS remarque,
												pv.fichier_pv AS fichier_pv,
												pv.id_pv AS id_pv,
												etat_pv.nom_etat AS nom_etat,
												REPLACE(pv.ref_pv, '/', '_') AS ref_pv_2,
												pv.infraction AS infraction,
												pv.droit_cdf AS droit_cdf,
												pv.droit_usd AS droit_usd,
												pv.amende_cdf AS amende_cdf,
												pv.amende_usd AS amende_usd,
												pv.risque_potentiel AS risque_potentiel,
												sen.nom_sen AS nom_sen
											FROM pv_contencieux pv, bureau_douane bur, client, modele_licence ml, etat_pv, senario_pv sen
											WHERE pv.id_bur_douane = bur.id_bur_douane
												AND pv.id_cli = client.id_cli
												AND pv.id_mod_lic = ml.id_mod_lic
												AND pv.id_etat = etat_pv.id_etat
												AND pv.id_sen = sen.id_sen");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['detail_act'] = '<a href="#" onclick="modal_actePV('.$reponse['id_pv'].');;">
												<img src="../images/presse-papiers.png" width="20px">
											</a> '.$this-> getDernierActePV($reponse['id_pv'])['detail_act'];
				$reponse['btn_action'] = '<button class="btn btn-xs btn-light" onclick="window.open(\'../pv/'.$reponse['ref_pv_2'].'/'.$reponse['fichier_pv'].'\',\'pop5\',\'width=900,height=500\');">
												<img src="../images/dossier (1).png" width="20px">
										</button>
										<button class="btn btn-xs btn-light" onclick="modalModificationPV('.$reponse['id_pv'].');;">
											<img src="../images/crayon.png" width="20px">
										</button>';
				$row[] = $reponse;

			}$requete-> closeCursor();

			if ($row) {
				return $row;
			}else{
				return NULL;
			}

			

		}

		public function ecriture_comptable(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$compteur=0;

			$row = array();

			$requete = $connexion-> query("SELECT *, DATE_FORMAT(ec.date_e, '%Y-%m-%d') AS date_e_2,
												SUM(det.debit) AS debit,
												SUM(det.credit) AS credit,
												mon.sig_mon AS sig_mon
											FROM ecriture ec, detail_ecriture det, compte c, journal j, type_ecriture te, monnaie mon
											WHERE ec.id_jour = j.id_jour
												AND ec.id_e = det.id_e
												AND det.id_compte = c.id_compte
												AND ec.id_t_e = te.id_t_e
												AND ec.id_mon = mon.id_mon
											GROUP BY ec.id_e
											-- ORDER BY ec.id_e DESC
											ORDER BY DATE(ec.date_e) DESC, ec.id_e ASC");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['btn_action'] = '<a href="#" onclick="detail_ecriture(\''.$reponse['id_e'].'\');">
												<i class="fa fa-eye"></i>
										</a>';
				$reponse['btn_action2'] = '<a href="#" onclick="window.open(\'../pv/'.$reponse['id_e'].'/'.$reponse['id_e'].'\',\'pop5\',\'width=900,height=500\');">
												<img src="../images/dossier (1).png" width="20px">
										</a>';
				$row[] = $reponse;

			}$requete-> closeCursor();

			return $row;
			

		}

		public function detail_ecriture_comptable($id_e){
			include("connexion.php");
			$entree['id_e'] = $id_e;
			$compteur=0;

			$row = array();

			$requete = $connexion-> prepare("SELECT *, DATE_FORMAT(ec.date_e, '%Y-%m-%d') AS date_e_2
											FROM ecriture ec, detail_ecriture det, compte c, journal j
											WHERE ec.id_e = ?
												AND ec.id_jour = j.id_jour
												AND ec.id_e = det.id_e
												AND det.id_compte = c.id_compte
											ORDER BY det.credit");
			$requete-> execute(array($entree['id_e']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['btn_action'] = '<a href="#" onclick="detail_ecriture(\''.$reponse['id_e'].'\');">
												<i class="fa fa-eye"></i>
										</a>';
				$reponse['btn_action2'] = '<a href="#" onclick="window.open(\'../pv/'.$reponse['id_e'].'/'.$reponse['id_e'].'\',\'pop5\',\'width=900,height=500\');">
												<img src="../images/dossier (1).png" width="20px">
										</a>';
				$row[] = $reponse;

			}$requete-> closeCursor();

			return $row;
			

		}

		public function getEcriture($id_e){
			include("connexion.php");
			$entree['id_e'] = $id_e;
			$compteur=0;

			$row = array();

			$requete = $connexion-> prepare("SELECT *
											FROM ecriture, journal, type_ecriture, monnaie
											WHERE ecriture.id_e = ?
												AND ecriture.id_jour = journal.id_jour
												AND ecriture.id_t_e = type_ecriture.id_t_e
												AND ecriture.id_mon = monnaie.id_mon");
			$requete-> execute(array($entree['id_e']));
			$reponse = $requete-> fetch();
			return $reponse;
			

		}

		public function dossier_risque_douane(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$compteur=0;

			$row = array();

			// $requete = $connexion-> query("SELECT *,
			// 									DATE_FORMAT(dos.date_recept, '%d/%m/%Y') AS date_recept,
			// 									DATE_FORMAT(dos.date_doc, '%d/%m/%Y') AS date_doc
			// 								FROM dossier_risque_douane dos, bureau_douane bur, modele_licence ml, regime reg, etape_risque_douane et, senario_pv sen, client cl
			// 								WHERE dos.id_bur_douane = bur.id_bur_douane
			// 									AND dos.id_reg = reg.id_reg
			// 									AND reg.id_mod_lic = ml.id_mod_lic
			// 									AND dos.id_etap = et.id_etap
			// 									AND dos.id_sen = sen.id_sen
			// 									AND dos.id_cli = cl.id_cli");

			$requete = $connexion-> query("SELECT *,
												dos.fichier AS fichier,
												DATE_FORMAT(dos.date_recept, '%d/%m/%Y') AS date_recept,
												DATE_FORMAT(dos.date_doc, '%d/%m/%Y') AS date_doc,
												DATE_FORMAT(prd.date_prevu, '%d/%m/%Y') AS date_prevu,
												dos.id AS id,
												IF(sen.id_sen=13,
													'',
													IF(prd.date_pres IS NOT NULL,
														'',
														DATEDIFF(prd.date_prevu, CURRENT_DATE())
													)
												) AS delai
											FROM dossier_risque_douane dos
												LEFT JOIN bureau_douane bur 
													ON dos.id_bur_douane = bur.id_bur_douane
												LEFT JOIN regime reg 
													ON dos.id_reg = reg.id_reg 
												LEFT JOIN modele_licence ml
													ON reg.id_mod_lic = ml.id_mod_lic 
												LEFT JOIN etape_risque_douane et
													ON dos.id_etap = et.id_etap 
												LEFT JOIN senario_pv sen 
													ON dos.id_sen = sen.id_sen 
												LEFT JOIN client cl
													ON dos.id_cli = cl.id_cli
												LEFT JOIN presentation_risque_douane prd
													ON dos.id = prd.id
														AND prd.date_pres IS NULL");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['btn_action'] = '<a href="#" onclick="window.open(\'../pv/'.$reponse['id'].'/'.$reponse['fichier'].'\',\'pop5\',\'width=900,height=500\');">
												<img src="../images/dossier (1).png" width="20px">
										</a>
										<a href="#" onclick="modal_dossier_risque_douane('.$reponse['id'].');;">
											<img src="../images/crayon.png" width="20px">
										</a>';
				$row[] = $reponse;

			}$requete-> closeCursor();

			return $row;
			

		}

		public function get_dossier_risque_douane($id){
			include("connexion.php");
			$entree['id'] = $id;
			$compteur=0;

			$row = array();

			$requete = $connexion-> prepare("SELECT *,
												CONCAT('<button class=\'btn  \' onclick=\"window.open(\'../pv/',dos.id,'/',dos.fichier,'\',\'pop5\',\'width=900,height=500\');\"></button>') AS fichier_actuel
											FROM dossier_risque_douane dos, bureau_douane bur, modele_licence ml, regime reg, etape_risque_douane et, senario_pv sen
											WHERE dos.id_bur_douane = bur.id_bur_douane
												AND dos.id_reg = reg.id_reg
												AND reg.id_mod_lic = ml.id_mod_lic
												AND dos.id_etap = et.id_etap
												AND dos.id_sen = sen.id_sen
												AND dos.id = ?");
			$requete-> execute(array($entree['id']));
			$reponse = $requete-> fetch();
				$reponse['btn_action'] = '<a href="#" class="btn form-control cc-exp form-control-sm " onclick=\"window.open(\'../pv/'.$reponse['id'].'/'.$reponse['fichier'].'\',\'pop5\',\'width=900,height=500\');">
												<img src="../images/dossier (1).png" width="20px">
										</a>';
			return $reponse;

			

		}

		public function presentation_risque_douane($id){
			include("connexion.php");
			$entree['id'] = $id;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> prepare("SELECT *,
													DATE_FORMAT(date_prevu, '%d/%m/%Y') AS date_prevu,
													DATE_FORMAT(date_pres, '%d/%m/%Y') AS date_pres,
													IF(fichier IS NOT NULL,
														CONCAT('<a href=\"#\" title=\"Fichier\" onclick=\"window.open(\'../pv/',id,'/',fichier,'\',\'pop6\',\'width=900,height=500\');\">
																	<img src=\"../images/dossier (1).png\" width=\"15px\">
															</a>'),
														NULL
													) AS btn_fichier
											FROM presentation_risque_douane
											WHERE id = ?");
			$requete-> execute(array($entree['id']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$tableau .= '<tr>
								<td>'.$compteur.'</td>
								<td style="text-align: center;">'.$reponse['date_prevu'].'</td>
								<td style="text-align: center;">'.$reponse['date_pres'].'</td>
								<td style="">'.$reponse['remarque'].'</td>
								<td style="">
									'.$reponse['btn_fichier'].'
									<a href="#" title="Modifier" onclick="modal_editPresentation('.$reponse['id_pres'].', '.$reponse['id'].');">
										<img src="../images/crayon (1).png" width="15px">
									</a>
									<a href="#" title="Supprimer" onclick="deletePresentation('.$reponse['id_pres'].', '.$reponse['id'].');">
										<img src="../images/bouton-supprimer.png" width="15px">
									</a>
								</td>
							</tr>';
			}
			return $tableau;

			

		}

		public function document_joint_risque($id){
			include("connexion.php");
			$entree['id'] = $id;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> prepare("SELECT dr.nom_doc AS nom_doc,
													DATE_FORMAT(djr.date_create, '%d/%m/%Y') AS date_create,
													CONCAT('<a href=\"#\" class=\"btn btn-xs btn-info\" title=\"Fichier\" onclick=\"window.open(\'../pv/',id,'/',djr.fichier,'\',\'pop6\',\'width=900,height=500\');\">
																	<img src=\"../images/dossier (1).png\" width=\"15px\"> Cliquez pour voir le fichier
															</a>') AS btn_fichier
											FROM document_joint_risque djr, document_risque dr, dossier_risque_douane dos
											WHERE dos.id = ?
												AND dos.id = djr.id_dos
												AND djr.id_doc = dr.id_doc");
			$requete-> execute(array($entree['id']));
			while($reponse = $requete-> fetch()){
				$compteur++;
				$tableau .= '<tr>
								<td>'.$compteur.'</td>
								<td style="text-align: left;">'.$reponse['nom_doc'].'</td>
								<td style="text-align: center;">'.$reponse['date_create'].'</td>
								<td style="">
									'.$reponse['btn_fichier'].'
								</td>
							</tr>';
			}
			return $tableau;

			

		}

		public function deletePresentation($id_pres){
			include("connexion.php");
			$entree['id_pres'] = $id_pres;

			$requete = $connexion-> prepare("DELETE FROM presentation_risque_douane
												WHERE id_pres = ?");
			$requete-> execute(array($entree['id_pres']));
		}

		public function getNombreDossierRisqueDouane(){
			include("connexion.php");
			// $entree['id_pres'] = $id_pres;

			$requete = $connexion-> query("SELECT COUNT(*) AS nbre_not_pres 
												FROM presentation_risque_douane pres, dossier_risque_douane dos
												WHERE pres.date_prevu IS NOT NULL
													AND pres.date_pres IS NULL
													AND pres.id = dos.id
													AND dos.id_sen <> 13");
			// $requete-> execute(array($entree['id_pres']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function getNombreNotPres10(){
			include("connexion.php");
			// $entree['id_pres'] = $id_pres;

			$requete = $connexion-> query("SELECT COUNT(*) AS nbre_not_pres_10
												FROM presentation_risque_douane pres, dossier_risque_douane dos
												WHERE pres.date_prevu IS NOT NULL
													AND pres.date_pres IS NULL
													AND DATEDIFF(pres.date_prevu, CURRENT_DATE()) <= 10
													AND pres.id = dos.id
													AND dos.id_sen <> 13");
			// $requete-> execute(array($entree['id_pres']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function getPresentation($id_pres){
			include("connexion.php");
			$entree['id_pres'] = $id_pres;

			$requete = $connexion-> prepare("SELECT * 
												FROM presentation_risque_douane
												WHERE id_pres = ?");
			$requete-> execute(array($entree['id_pres']));

			$reponse = $requete-> fetch();

			return $reponse;
		}

		public function creerPresentationRisqueDouane($id, $date_prevu, $date_pres, $remarque, $fichier){
			include("connexion.php");
			$entree['id'] = $id;
			$entree['date_prevu'] = $date_prevu;
			$entree['date_pres'] = $date_pres;
			$entree['remarque'] = $remarque;
			$entree['fichier'] = $fichier;

			if ($entree['date_pres'] == '') {
				$entree['date_pres'] = NULL;
			}

			$requete = $connexion-> prepare("INSERT INTO presentation_risque_douane(id, date_prevu, date_pres, remarque, fichier, id_util)
												VALUES(?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['id'], $entree['date_prevu'], $entree['date_pres'], $entree['remarque'], $entree['fichier'], $_SESSION['id_util']));
			

		}

		public function creerDepenseDossier($id_dep, $id_dos, $date_dep, $montant, $assigned_to){
			include("connexion.php");
			$entree['id_dep'] = $id_dep;
			$entree['id_dos'] = $id_dos;
			$entree['date_dep'] = $date_dep;
			$entree['montant'] = $montant;
			$entree['assigned_to'] = $assigned_to;

			// if ($entree['date_dep'] == '') {
			// 	$entree['date_dep'] = NULL;
			// }

			$requete = $connexion-> prepare("INSERT INTO depense_dossier(id_dep, id_dos, date_dep, montant, assigned_to, id_util)
												VALUES(?, ?, ?, ?, ?, ?)");
			$requete-> execute(array($entree['id_dep'], $entree['id_dos'], $entree['date_dep'], $entree['montant'], $entree['assigned_to'], $_SESSION['id_util']));
			

		}

		public function creerBureauDouane($nom_bur_douane){
			include("connexion.php");

			$entree['nom_bur_douane'] = $nom_bur_douane;

			$requete = $connexion-> prepare("INSERT INTO bureau_douane(nom_bur_douane)
												VALUES(?)");
			$requete-> execute(array($entree['nom_bur_douane']));
			

		}

		public function creerRegime($nom_reg, $id_mod_lic){
			include("connexion.php");

			$entree['nom_reg'] = $nom_reg;
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("INSERT INTO regime(nom_reg, id_mod_lic)
												VALUES(?, ?)");
			$requete-> execute(array($entree['nom_reg'], $entree['id_mod_lic']));
			

		}

		public function creerDocumentJointRisque($id, $id_doc, $fichier){
			include("connexion.php");
			$entree['id'] = $id;
			$entree['id_doc'] = $id_doc;
			$entree['fichier'] = $fichier;

			$requete = $connexion-> prepare("INSERT INTO document_joint_risque(id_dos, id_doc, fichier, id_util)
												VALUES(?, ?, ?, ?)");
			$requete-> execute(array($entree['id'], $entree['id_doc'], $entree['fichier'], $_SESSION['id_util']));
			

		}

		public function editPresentation($id_pres, $date_prevu, $date_pres, $remarque, $fichier){
			include("connexion.php");
			$entree['id_pres'] = $id_pres;
			$entree['date_prevu'] = $date_prevu;
			$entree['date_pres'] = $date_pres;
			$entree['remarque'] = $remarque;
			$entree['fichier'] = $fichier;

			if ($entree['date_pres'] == '') {
				$entree['date_pres'] = NULL;
			}

			$requete = $connexion-> prepare("UPDATE presentation_risque_douane 
												SET date_prevu = ?, date_pres = ?, remarque = ?, fichier = ?
												WHERE id_pres = ?");
			$requete-> execute(array($entree['date_prevu'], $entree['date_pres'], $entree['remarque'], $entree['fichier'], $entree['id_pres']));

		}

		public function editPresentation2($id_pres, $date_prevu, $date_pres, $remarque){
			include("connexion.php");
			$entree['id_pres'] = $id_pres;
			$entree['date_prevu'] = $date_prevu;
			$entree['date_pres'] = $date_pres;
			$entree['remarque'] = $remarque;

			if ($entree['date_pres'] == '') {
				$entree['date_pres'] = NULL;
			}

			$requete = $connexion-> prepare("UPDATE presentation_risque_douane 
												SET date_prevu = ?, date_pres = ?, remarque = ?
												WHERE id_pres = ?");
			$requete-> execute(array($entree['date_prevu'], $entree['date_pres'], $entree['remarque'], $entree['id_pres']));

		}

		public function getPVContentieuxBackUp(){
			include("connexion.php");
			// $entree['id_cli'] = $id_cli;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT bur.nom_bur_douane AS nom_bur_douane,
												pv.ref_pv AS ref_pv,
												DATE_FORMAT(pv.date_pv, '%d/%m/%Y') AS date_pv,
												DATE_FORMAT(pv.date_reception, '%d/%m/%Y') AS date_reception,
												pv.annee AS annee,
												client.nom_cli AS nom_cli,
												ml.nom_mod_lic AS nom_mod_lic,
												pv.marchandise AS marchandise,
												pv.date_deb_contrad AS date_deb_contrad,
												pv.date_next_pres AS date_next_pres,
												pv.delai_grief AS delai_grief,
												pv.action_en_cours AS action_en_cours,
												pv.remarque AS remarque,
												pv.fichier_pv AS fichier_pv,
												pv.id_pv AS id_pv,
												etat_pv.nom_etat AS nom_etat,
												REPLACE(pv.ref_pv, '/', '_') AS ref_pv_2,
												pv.infraction AS infraction,
												pv.droit_cdf AS droit_cdf,
												pv.droit_usd AS droit_usd,
												pv.amende_cdf AS amende_cdf,
												pv.amende_usd AS amende_usd,
												pv.risque_potentiel AS risque_potentiel
											FROM pv_contencieux pv, bureau_douane bur, client, modele_licence ml, etat_pv
											WHERE pv.id_bur_douane = bur.id_bur_douane
												AND pv.id_cli = client.id_cli
												AND pv.id_mod_lic = ml.id_mod_lic
												AND pv.id_etat = etat_pv.id_etat");
			// $requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td class="bg bg-dark">
									'.$reponse['ref_pv'].'
									<button class="btn btn-xs btn-light" onclick="window.open(\'../pv/'.$reponse['ref_pv_2'].'/'.$reponse['fichier_pv'].'\',\'pop5\',\'width=900,height=500\');">
										<img src="../images/dossier (1).png" width="20px">
									</button>
									<button class="btn btn-xs btn-light" onclick="modalModificationPV('.$reponse['id_pv'].');;">
										<img src="../images/crayon.png" width="20px">
									</button>
								</td>
								<td>'.$reponse['nom_bur_douane'].'</td>
								<td>'.$reponse['date_pv'].'</td>
								<td>'.$reponse['date_reception'].'</td>
								<td>
									<a href="#" onclick="modal_actePV('.$reponse['id_pv'].');;">
										<img src="../images/presse-papiers.png" width="20px">
									</a>
									'.$this-> getDernierActePV($reponse['id_pv'])['detail_act'].'</td>
								<td>'.$reponse['annee'].'</td>
								<td>'.$reponse['nom_cli'].'</td>
								<td>'.$reponse['nom_mod_lic'].'</td>
								<td>'.$reponse['marchandise'].'</td>
								<td>'.$reponse['infraction'].'</td>
								<td style="text-align: right;">'.number_format($reponse['droit_cdf'], 2, ',', ' ').'</td>
								<td style="text-align: right;">'.number_format($reponse['droit_usd'], 2, ',', ' ').'</td>
								<td style="text-align: right;">'.number_format($reponse['amende_cdf'], 2, ',', ' ').'</td>
								<td style="text-align: right;">'.number_format($reponse['amende_usd'], 2, ',', ' ').'</td>
								<td>'.$reponse['risque_potentiel'].'</td>
								<td>'.$reponse['date_deb_contrad'].'</td>
								<td>'.$reponse['date_next_pres'].'</td>
								<td>'.$reponse['delai_grief'].'</td>
								<td>'.$reponse['remarque'].'</td>
								<td>'.$reponse['nom_etat'].'</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function ajouterActePV($date_act, $detail_act, $id_pv){
			include('connexion.php');

			$entree['date_act'] = $date_act;
			$entree['detail_act'] = $detail_act;
			$entree['id_pv'] = $id_pv;
			// $entree['id_util'] = $id_util;

			// echo '<br>-----------------date_act = '.$date_act;
			// echo '<br>-----------------detail_act = '.$detail_act;
			// echo '<br>-----------------id_pv = '.$id_pv;
			// echo '<br>-----------------id_util = '.$id_util;

			$requete = $connexion-> prepare('INSERT INTO acte_pv(date_act, detail_act, id_pv, id_util)
												VALUES(?, ?, ?, ?)');
			$requete-> execute(array($entree['date_act'], $entree['detail_act'], $entree['id_pv'], $_SESSION['id_util']));
		}
			
		public function selectionnerBureauDouaneAjax(){
			include('connexion.php');
			$select = "";
			$requete = $connexion-> query("SELECT *
											FROM bureau_douane
											WHERE active = '1'");


			while($reponse = $requete-> fetch()){
				$select .= '<option value="'.$reponse['id_bur_douane'].'">
								'.$reponse['nom_bur_douane'].'
							</option>';
			}$requete-> closeCursor();

			return $select;
		}
		
		public function selectionnerBureauDouaneAjax2(){
			include('connexion.php');
			$select = "<select name='id_bur_douane' id='id_bur_douane' class='form-control cc-exp form-control-sm' required>
              			<option></option>";
			$requete = $connexion-> query("SELECT *
											FROM bureau_douane
											WHERE active = '1'
											ORDER BY nom_bur_douane");


			while($reponse = $requete-> fetch()){
				$select .= '<option value="'.$reponse['id_bur_douane'].'">
								'.$reponse['nom_bur_douane'].'
							</option>';
			}$requete-> closeCursor();

			$select.='</select>';

			return $select;
		}
		
		public function selectionnerBureauDouaneAjax2_edit(){
			include('connexion.php');
			$select = "<select name='id_bur_douane' id='id_bur_douane_edit' class='form-control cc-exp form-control-sm' required>
              			<option></option>";
			$requete = $connexion-> query("SELECT *
											FROM bureau_douane
											WHERE active = '1'
											ORDER BY nom_bur_douane");


			while($reponse = $requete-> fetch()){
				$select .= '<option value="'.$reponse['id_bur_douane'].'">
								'.$reponse['nom_bur_douane'].'
							</option>';
			}$requete-> closeCursor();

			$select.='</select>';

			return $select;
		}
		
		public function selectionnerDocumentRisqueAjax(){
			include('connexion.php');
			$select = "";
			$requete = $connexion-> query("SELECT *
											FROM document_risque");


			while($reponse = $requete-> fetch()){
				$select .= '<option value="'.$reponse['id_doc'].'">
								'.$reponse['nom_doc'].'
							</option>';
			}$requete-> closeCursor();

			return $select;
		}

		public function selectionnerDocumentRisque(){
			include('connexion.php');
			$select = "";
			$requete = $connexion-> query("SELECT *
											FROM document_risque");


			while($reponse = $requete-> fetch()){
				?>
				<option value="<?php echo $reponse['id_doc'];?>">
					<?php echo $reponse['nom_doc'];?>
				</option>
					<?php
			}$requete-> closeCursor();

		}

		public function modificationPVContentieux($id_pv, $ref_pv, $date_pv, $date_reception, $id_bur_douane, $annee, $marchandise, $id_cli, $id_mod_lic, $id_etat, $id_sen, $remarque, $date_deb_contrad, $date_next_pres, $delai_grief, $infraction, $droit_cdf, $droit_usd, $amende_cdf, $amende_usd, $risque_potentiel){
			include('connexion.php');
			$entree['id_pv']=$id_pv;
			$entree['ref_pv']=$ref_pv;
			$entree['date_pv']=$date_pv;
			$entree['date_reception']=$date_reception;
			$entree['id_bur_douane']=$id_bur_douane;
			$entree['annee']=$annee;
			$entree['marchandise']=$marchandise;
			$entree['id_cli']=$id_cli;
			$entree['id_mod_lic']=$id_mod_lic;
			$entree['id_etat']=$id_etat;
			$entree['id_sen']=$id_sen;
			$entree['remarque']=$remarque;
			$entree['date_deb_contrad']=$date_deb_contrad;
			$entree['date_next_pres']=$date_next_pres;
			$entree['delai_grief']=$delai_grief;
			// $entree['action_en_cours']=$action_en_cours;
			$entree['infraction']=$infraction;
			$entree['droit_cdf']=$droit_cdf;
			$entree['droit_usd']=$droit_usd;
			$entree['amende_cdf']=$amende_cdf;
			$entree['amende_usd']=$amende_usd;
			$entree['risque_potentiel']=$risque_potentiel;

			if ($entree['date_deb_contrad'] == '') {
				$entree['date_deb_contrad'] = NULL;
			}

			if ($entree['date_next_pres'] == '') {
				$entree['date_next_pres'] = NULL;
			}

			if ($entree['droit_cdf'] == '') {
				$entree['droit_cdf'] = NULL;
			}

			if ($entree['droit_usd'] == '') {
				$entree['droit_usd'] = NULL;
			}

			if ($entree['amende_cdf'] == '') {
				$entree['amende_cdf'] = NULL;
			}

			if ($entree['amende_usd'] == '') {
				$entree['amende_usd'] = NULL;
			}

			if ($entree['delai_grief'] == '') {
				$entree['delai_grief'] = NULL;
			}

			// echo '<br>ref_pv = '.$ref_pv;
			// echo '<br>date_pv = '.$date_pv;
			// echo '<br>date_reception = '.$date_reception;
			// echo '<br>id_bur_douane = '.$id_bur_douane;
			// echo '<br>annee = '.$annee;
			// echo '<br>marchandise = '.$marchandise;
			// echo '<br>id_cli = '.$id_cli;
			// echo '<br>id_mod_lic = '.$id_mod_lic;
			// echo '<br> fichier_pv= '.$fichier_pv;
			// echo '<br>id_util = '.$id_util;

			$requete = $connexion-> prepare('UPDATE pv_contencieux
												SET ref_pv = ?, date_pv = ?, date_reception = ?, 
													id_bur_douane = ?, annee = ?, marchandise = ?, 
													id_cli = ?, id_mod_lic = ?, id_etat = ?, id_sen = ?, remarque = ?, 
													date_deb_contrad = ?, date_next_pres = ?, delai_grief = ?, 
													infraction = ?, droit_cdf = ?, droit_usd = ?, amende_cdf = ?, 
													amende_usd = ?, risque_potentiel = ?
												WHERE id_pv = ?');
			$requete-> execute(array($entree['ref_pv'], $entree['date_pv'], $entree['date_reception'], $entree['id_bur_douane'], $entree['annee'], $entree['marchandise'], $entree['id_cli'], $entree['id_mod_lic'], $entree['id_etat'], $entree['id_sen'], $entree['remarque'], $entree['date_deb_contrad'], $entree['date_next_pres'], $entree['delai_grief'], $entree['infraction'], $entree['droit_cdf'], $entree['droit_usd'], $entree['amende_cdf'], $entree['amende_usd'], $entree['risque_potentiel'], $entree['id_pv']));

		}


		public function getDataPVContentieux($id_pv){
			include("connexion.php");
			$entree['id_pv'] = $id_pv;
			$select = '';


			$requete = $connexion-> prepare("SELECT *,
												REPLACE(pv.ref_pv, '/', '_') AS ref_pv_2
											FROM pv_contencieux pv, bureau_douane bur, client, modele_licence ml, etat_pv, senario_pv
											WHERE pv.id_bur_douane = bur.id_bur_douane
												AND pv.id_cli = client.id_cli
												AND pv.id_mod_lic = ml.id_mod_lic
												AND pv.id_etat = etat_pv.id_etat
												AND pv.id_sen = senario_pv.id_sen
												AND pv.id_pv = ?");
			$requete-> execute(array($entree['id_pv']));
			$reponse = $requete-> fetch();
			$select = '<select name="id_bur_douane_edit" id="id_bur_douane_edit" class="form-control form-control-sm cc-exp" required><option value="'.$reponse['id_bur_douane'].'">'.$reponse['nom_bur_douane'].'</option><option></option>'.$this->selectionnerBureauDouaneAjax().'</select>';
			$reponse['select_id_bur'] = $select;
			return $reponse;

		}

		public function tableau_acte_pv($id_pv){
			include("connexion.php");
			$entree['id_pv'] = $id_pv;
			$compteur=0;

			$tableau = '<tr>
							<td></td>
							<td><input class="form-control-sm form-control" type="date" id="date_act"></td>
							<td><input class="form-control-sm form-control" type="text" id="detail_act"></td>
							<td><button class="btn btn-xs btn-primary" onclick="ajouterActePV(date_act.value, detail_act.value, id_pv_acte.value);"><i class="fa fa-check"></i> Inserer</button></td>
						</tr>';

			$requete = $connexion-> prepare("SELECT *
											FROM pv_contencieux pv, acte_pv
											WHERE pv.id_pv = acte_pv.id_pv
												AND pv.id_pv = ?
											ORDER BY acte_pv.id_act DESC");
			$requete-> execute(array($entree['id_pv']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['date_act'].'</td>
								<td>'.$reponse['detail_act'].'</td>
								<td>
									<button class="btn-xs btn-danger" onclick="supprimerActePV('.$reponse['id_act'].');">
										<span class="fa fa-times"></span>
									</button>
								</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function groups_account(){
			include("connexion.php");
			// $entree['id_pv'] = $id_pv;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT cl.nom_class AS nom_class,
												cl.id_class AS id_class,
												cat.nom_cat_cmpte AS nom_cat_cmpte
											FROM categorie_compte cat, classe_compte cl
											WHERE cl.id_cat_cmpte = cat.id_cat_cmpte
											ORDER BY cl.nom_class ASC");
			// $requete-> execute(array($entree['id_pv']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['nom_class'].'</td>
								<td style="text-align: center;">'.$reponse['nom_cat_cmpte'].'</td>
								<td style="text-align: center;">
									<button class="btn-xs btn-warning" onclick="modalEditClasse('.$reponse['id_class'].');">
										<span class="fa fa-edit"></span>
									</button>
								</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function journaux(){
			include("connexion.php");
			// $entree['id_pv'] = $id_pv;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT *
											FROM journal
											ORDER BY nom_jour ASC");
			// $requete-> execute(array($entree['id_pv']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['nom_jour'].'</td>
								<td style="text-align: center;">
								'.$this-> getNombreCompteJournal($reponse['id_jour']).' | 
								<button class="btn btn-xs bg-info" onclick="modal_compte_journal('.$reponse['id_jour'].');">
										<i class="fa fa-eye"></i>
									</button>
								</td>
								<td style="text-align: center;">
									<button class="btn-xs btn-warning" onclick="modalEditJournal('.$reponse['id_jour'].');">
										<span class="fa fa-edit"></span>
									</button>
								</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function getNombreCompteJournal($id_jour){
			include("connexion.php");
			$entree['id_jour'] = $id_jour;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> prepare("SELECT COUNT(id_compte) AS nbre
											FROM compte_journal
											WHERE id_jour = ?");
			$requete-> execute(array($entree['id_jour']));
			$reponse = $requete-> fetch();
			if($reponse){
				return $reponse['nbre'];
			}else{
				return '0';
			}

		}

		public function ecriture_journal($id_jour){
			include("connexion.php");
			$entree['id_jour'] = $id_jour;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT DISTINCT(date_e) AS date_e
											FROM ecriture
											WHERE id_jour = ?");
			$requete-> execute(array($entree['id_jour']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['date_e'].'</td>
								<td style="text-align: center;">'.$reponse['nom_cat_cmpte'].'</td>
								<td style="text-align: center;">
									<button class="btn-xs btn-warning" onclick="modalEditClasse('.$reponse['id_class'].');">
										<span class="fa fa-edit"></span>
									</button>
								</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function account(){
			include("connexion.php");
			// $entree['id_pv'] = $id_pv;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT c.nom_compte AS nom_compte,
												c.id_compte AS id_compte,
												c.code_compte AS code_compte,
												cl.nom_class AS nom_class,
												cl.id_class AS id_class,
												cat.nom_cat_cmpte AS nom_cat_cmpte
											FROM categorie_compte cat, classe_compte cl, compte c
											WHERE cl.id_cat_cmpte = cat.id_cat_cmpte
												AND cl.id_class = c.id_class
											ORDER BY c.nom_compte ASC");
			// $requete-> execute(array($entree['id_pv']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['nom_compte'].'</td>
								<td style="text-align: center;">'.$reponse['code_compte'].'</td>
								<td style="text-align: center;">'.$reponse['nom_class'].'</td>
								<td style="text-align: center;">'.$reponse['nom_cat_cmpte'].'</td>
								<td style="text-align: center;">
									<button class="btn-xs btn-warning" onclick="modalEditCompte('.$reponse['id_compte'].');">
										<span class="fa fa-edit"></span>
									</button>
								</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function liste_compte_journal($compteur_compte, $id_jour){
			include("connexion.php");
			$entree['id_jour'] = $id_jour;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> prepare("SELECT compte.id_compte AS id_compte, 
													compte.nom_compte AS nom_compte
											FROM compte, compte_journal
											WHERE compte.id_compte = compte_journal.id_compte
												AND compte_journal.id_jour = ?
											ORDER BY compte.nom_compte");
			$requete-> execute(array($entree['id_jour']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td><a href="#" onclick="select_compte(\''.$reponse['id_compte'].'\', \''.$reponse['nom_compte'].'\',\''.$this-> getSoldeCompte($reponse['id_compte']).'\', '.$compteur_compte.')">'.$reponse['nom_compte'].'</a></td>
								<td style="text-align: right;">'.$this-> getSoldeCompte($reponse['id_compte']).'</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function liste_dossier_ajax($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			$row = array();

			$requete = $connexion-> prepare("SELECT dos.id_dos AS id_dos, 
													dos.ref_dos AS ref_dos
											FROM dossier dos
											WHERE id_cli = ?
												AND id_mod_lic = ?");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['dossier'] = '<a href="#" onclick="select_dossier(\''.$reponse['id_dos'].'\', \''.$reponse['ref_dos'].'\')">'.$reponse['ref_dos'].'</a>';
				$row[] = $reponse;

			}$requete-> closeCursor();

			return $row;

		}

		public function nouveauDossierLicence($id_cli, $id_mod_lic){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur=0;

			$row = array();

			$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic,
													l.commodity AS commodity,
													l.fob AS fob_lic,
													l.poids AS poids_lic,
													SUM(
														IF(dos.fob IS NULL, 0, dos.fob)
													) AS sum_fob,
													SUM(
														IF(dos.poids IS NULL, 0, dos.poids)
													) AS sum_poids,
													(
														l.fob - SUM(
															IF(dos.fob IS NULL, 0, dos.fob)
														) 
													)AS solde_fob,
													(
														l.poids - SUM(
															IF(dos.poids IS NULL, 0, dos.poids)
														) 
													)AS solde_poids,
													IF(march.id_march IS NULL,
														l.commodity,
														march.nom_march
													) AS commodity
											FROM licence l
												LEFT JOIN dossier dos
													ON l.num_lic = dos.num_lic
												LEFT JOIN marchandise march
													ON l.id_march = march.id_march
											WHERE l.id_cli = ?
												AND l.id_mod_lic = ?
												AND l.num_lic IN (SELECT num_lic FROM expiration_licence WHERE date_exp >= DATE(CURRENT_DATE))
											GROUP BY l.num_lic
											ORDER BY l.date_val DESC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['date_exp'] = $this-> getLastEpirationLicence2($reponse['num_lic']);
				$reponse['btn_action'] = '<a href="#" class="" onclick="modal_nouveauDossierAcid(\''.$reponse['num_lic'].'\', \''.$id_cli.'\', \''.$id_mod_lic.'\')"><i class="fa fa-calculator"></i></a>';
				$row[] = $reponse;

			}$requete-> closeCursor();

			return $row;

		}

		public function liste_compte($compteur_compte){
			include("connexion.php");
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT compte.id_compte AS id_compte, 
													compte.nom_compte AS nom_compte
											FROM compte
											ORDER BY compte.nom_compte");
			// $requete-> execute(array($entree['id_jour']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td><a href="#" onclick="select_compte(\''.$reponse['id_compte'].'\', \''.$reponse['nom_compte'].'\',\''.$this-> getSoldeCompte($reponse['id_compte']).'\', '.$compteur_compte.')">'.$reponse['nom_compte'].'</a></td>
								<td style="text-align: right;">'.$this-> getSoldeCompte($reponse['id_compte']).'</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		// public function liste_compte2($compteur_compte){
		// 	include("connexion.php");
		// 	$compteur=0;

		// 	$tableau = '';

		// 	$requete = $connexion-> query("SELECT compte.id_compte AS id_compte, 
		// 											compte.nom_compte AS nom_compte
		// 									FROM compte
		// 									ORDER BY compte.nom_compte");
		// 	// $requete-> execute(array($entree['id_jour']));
		// 	while ($reponse = $requete-> fetch()) {
		// 		$compteur++;

		// 		$tableau .='<tr>
		// 						<td>'.$compteur.'</td>
		// 						<td><a href="#" onclick="select_compte2(\''.$reponse['id_compte'].'\', \''.$reponse['nom_compte'].'\',\''.$this-> getSoldeCompte($reponse['id_compte']).'\', '.$compteur_compte.')">'.$reponse['nom_compte'].'</a></td>
		// 						<td style="text-align: right;">'.$this-> getSoldeCompte($reponse['id_compte']).'</td>
		// 					</tr>';

		// 	}$requete-> closeCursor();

		// 	return $tableau;

		// }

		public function liste_compte2Ajax($compteur_compte){
			include("connexion.php");
			$compteur=0;

			$row = array();

			$requete = $connexion-> query("SELECT compte.id_compte AS id_compte, 
													compte.nom_compte AS nom_compte
											FROM compte
											ORDER BY compte.nom_compte");
			// $requete-> execute(array($entree['id_jour']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$reponse['compteur'] = $compteur;
				$reponse['compte'] = '<a href="#" onclick="select_compte2(\''.$reponse['id_compte'].'\', \''.$reponse['nom_compte'].'\',\''.$this-> getSoldeCompte2($reponse['id_compte'])['solde'].'\', '.$compteur_compte.', \''.$this-> getSoldeCompte2($reponse['id_compte'])['type_solde'].'\')">'.$reponse['nom_compte'].'</a>';
				$reponse['solde'] = $this-> getSoldeCompte2($reponse['id_compte'])['solde'];
				$reponse['type_solde'] = $this-> getSoldeCompte2($reponse['id_compte'])['type_solde'];
				$row[] = $reponse;

			}$requete-> closeCursor();

			return $row;

		}

		public function liste_compte_hors_journal($id_jour){
			include("connexion.php");
			$entree['id_jour'] = $id_jour;
			$compteur=0;

			$tableau = '<select id="id_compte_add" class="form-control form-control-sm rounded-0">
							<option></option>';

			$requete = $connexion-> prepare("SELECT *
											FROM compte
											WHERE id_compte NOT IN (
													SELECT id_compte
														FROM compte_journal
														WHERE id_jour = ?
												)
											ORDER BY nom_compte");
			$requete-> execute(array($entree['id_jour']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<option value="'.$reponse['id_compte'].'">'.$reponse['nom_compte'].'</option>';

			}$requete-> closeCursor();

			$tableau .= '</select>';

			return $tableau;

		}

		public function compte_journal($id_jour){
			include("connexion.php");
			$entree['id_jour'] = $id_jour;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> prepare("SELECT compte.id_compte AS id_compte,
													compte.nom_compte AS nom_compte
											FROM compte, compte_journal
											WHERE compte.id_compte = compte_journal.id_compte
												AND compte_journal.id_jour = ?
											ORDER BY compte.nom_compte");
			$requete-> execute(array($entree['id_jour']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td>'.$reponse['nom_compte'].'</td>
								<td><i class="fa fa-times text text-danger btn-xs" onclick="select_compte(\''.$reponse['id_compte'].'\', \''.$reponse['nom_compte'].'\')"></i></td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function liste_compte_tresorerie($compteur_compte){
			include("connexion.php");
			// $entree['id_pv'] = $id_pv;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> query("SELECT *, monnaie.id_mon AS id_mon
											FROM compte, monnaie
											WHERE compte.id_class = 3
												AND compte.id_mon = monnaie.id_mon
											ORDER BY compte.nom_compte");
			// $requete-> execute(array($entree['id_pv']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td><a href="#" onclick="select_compte(\''.$reponse['id_compte'].'\', \''.$reponse['nom_compte'].'\',\''.$this-> getSoldeCompte($reponse['id_compte']).'\', \''.$reponse['sig_mon'].'\', \''.$reponse['id_mon'].'\', '.$compteur_compte.')">'.$reponse['nom_compte'].'</a></td>
								<td style="text-align: right;">'.number_format($this-> getSoldeCompte($reponse['id_compte']), 2, ',', ' ').'</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function nom_compte_search($nom_compte, $compteur_compte){
			include("connexion.php");
			$entree['nom_compte'] = '%'.$nom_compte.'%';
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> prepare("SELECT *
											FROM compte
											WHERE nom_compte LIKE ?
											ORDER BY nom_compte");
			$requete-> execute(array($entree['nom_compte']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td><a href="#" onclick="select_compte(\''.$reponse['id_compte'].'\', \''.$reponse['nom_compte'].'\',\''.$this-> getSoldeCompte($reponse['id_compte']).'\', \''.$compteur_compte.'\')">'.$reponse['nom_compte'].'</a></td>
								<td style="text-align: right;">'.number_format($this-> getSoldeCompte($reponse['id_compte']), 2, ',', ' ').'</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function nom_compte_search_journal($nom_compte, $compteur_compte, $id_jour){
			include("connexion.php");
			$entree['nom_compte'] = '%'.$nom_compte.'%';
			$entree['id_jour'] = $id_jour;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> prepare("SELECT compte.id_compte AS id_compte,
													compte.nom_compte AS nom_compte
											FROM compte, compte_journal
											WHERE compte.nom_compte LIKE ?
												AND compte.id_compte = compte_journal.id_compte
												AND compte_journal.id_jour = ?
											ORDER BY compte.nom_compte");
			$requete-> execute(array($entree['nom_compte'], $entree['id_jour']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td><a href="#" onclick="select_compte(\''.$reponse['id_compte'].'\', \''.$reponse['nom_compte'].'\',\''.$this-> getSoldeCompte($reponse['id_compte']).'\', \''.$compteur_compte.'\')">'.$reponse['nom_compte'].'</a></td>
								<td style="text-align: right;">'.$this-> getSoldeCompte($reponse['id_compte']).'</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function creer_compte_journal($id_compte, $id_jour){
			include("connexion.php");
			$entree['id_compte'] = $id_compte;
			$entree['id_jour'] = $id_jour;
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> prepare("INSERT INTO compte_journal(id_compte, id_jour)
												VALUES(?, ?)");
			$requete-> execute(array($entree['id_compte'], $entree['id_jour']));
		}

		public function nom_compte_tresorerie_search($nom_compte, $compteur_compte){
			include("connexion.php");
			$entree['nom_compte'] = '%'.$nom_compte.'%';
			$compteur=0;

			$tableau = '';

			$requete = $connexion-> prepare("SELECT *, monnaie.id_mon AS id_mon
											FROM compte, monnaie
											WHERE compte.id_class = 3
												AND compte.id_mon = monnaie.id_mon
												AND compte.nom_compte LIKE ?
												AND compte.id_class = 3
											ORDER BY compte.nom_compte");
			$requete-> execute(array($entree['nom_compte']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;

				$tableau .='<tr>
								<td>'.$compteur.'</td>
								<td><a href="#" onclick="select_compte(\''.$reponse['id_compte'].'\', \''.$reponse['nom_compte'].'\',\''.$this-> getSoldeCompte($reponse['id_compte']).'\', \''.$reponse['sig_mon'].'\', \''.$reponse['id_mon'].'\', \''.$compteur_compte.'\')">'.$reponse['nom_compte'].'</a></td>
								<td style="text-align: right;">'.number_format($this-> getSoldeCompte($reponse['id_compte']), 2, ',', ' ').'</td>
							</tr>';

			}$requete-> closeCursor();

			return $tableau;

		}

		public function getDernierActePV($id_pv){
			include("connexion.php");
			$entree['id_pv'] = $id_pv;
			$select = '';


			$requete = $connexion-> prepare("SELECT *
												FROM acte_pv
												WHERE id_pv = ?
												ORDER BY id_act DESC
												LIMIT 0, 1");
			$requete-> execute(array($entree['id_pv']));
			$reponse = $requete-> fetch();
			if ($reponse) {
				return $reponse;
			}else{
				$reponse['detail_act']=null;
				return $reponse;
			}
			

		}

		public function selectionnerBureauDouane3(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT *
											FROM bureau_douane
											WHERE active = '1'");


			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_bur_douane']; ?>">
					<?php echo $reponse['nom_bur_douane']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function select_debours($id_cli, $id_mod_lic, $id_march, $id_mod_trans){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$option = "<select id='id_deb' class='form-control form-control-sm cc-exp'><option></option>";

			$requete1 = $connexion-> query("SELECT * FROM type_debours");
			while ($reponse1=$requete1-> fetch()) {
				$option .= '<optgroup label="'.$reponse1['nom_t_deb'].'">';

				$requete = $connexion-> prepare("SELECT * 
													FROM debours 
													WHERE id_t_deb = ? 
														AND id_deb NOT IN (
																SELECT id_deb
																	FROM affectation_debours_client_modele_licence
																	WHERE id_cli = ?
																		AND id_mod_lic = ?
																		AND id_march = ?
																		AND id_mod_trans = ?
															)
													ORDER BY nom_deb");

				$requete-> execute(array($reponse1['id_t_deb'], $entree['id_cli'], $entree['id_mod_lic'], $entree['id_march'], $entree['id_mod_trans']));

				while($reponse = $requete-> fetch()){
					$option .= '<option value='.$reponse['id_deb'].'>'.$reponse['nom_deb'].'</option>';
				}$requete-> closeCursor();

				$option .= '</optgroup>';

			}$requete1-> closeCursor();

			$option .= '</select>';

			return $option;
		}

		public function selectionnerNewModeleFactureClient($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare("SELECT * 
												FROM modele_facture mf
												-- WHERE mf.id_mod_fact NOT IN (
												-- 	SELECT id_mod_fact
												-- 		FROM affectation_modele_facture_client_marchandise
												-- 		WHERE id_cli = ?
												-- ) 
											");

			$requete-> execute(array($entree['id_cli']));

			while($reponse = $requete-> fetch()){
				echo '<option value="'.$reponse['id_mod_fact'].'">
								'.$reponse['nom_mod_fact'].'
							</option>';
			}$requete-> closeCursor();
		}

		public function selectionnerFacturationLiquidation(){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare("SELECT with_duty+0 AS with_duty
												FROM facture_dossier");

			$requete-> execute(array($entree['id_cli']));

			while($reponse = $requete-> fetch()){
				echo '<option value="'.$reponse['with_duty'].'">
								'.$reponse['with_duty'].'
							</option>';
			}$requete-> closeCursor();
		}

		public function selectionnerCompteBancaireAjax(){
			include('connexion.php');

			// $entree['id_cli'] = $id_cli;
			$tbl = '<option></option>';
			$requete = $connexion-> query("SELECT * 
												FROM compte_bancaire");

			// $requete-> execute(array($entree['id_cli']));

			while($reponse = $requete-> fetch()){
				$tbl .= '<option value="'.$reponse['num_cmpt'].'">
								'.$reponse['num_cmpt'].'
							</option>';
			}$requete-> closeCursor();

			return $tbl;
		}

		public function selectionnerMarchandiseClient($id_cli){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$requete = $connexion-> prepare("SELECT march.nom_march AS nom_march, march.id_march AS id_march 
												FROM affectation_marchandise_client_modele_licence aff, marchandise march
												WHERE aff.id_cli = ?
													AND aff.id_march = march.id_march
												ORDER BY march.nom_march");

			$requete-> execute(array($entree['id_cli']));

			while($reponse = $requete-> fetch()){
				echo '<option value="'.$reponse['id_march'].'">
								'.$reponse['nom_march'].'
							</option>';
			}$requete-> closeCursor();
		}

		public function selectionnerDossierClientModeleLicenceMarchandise($id_cli, $id_mod_lic, $id_march, $id_mod_trans, $num_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['num_lic'] = $num_lic;

			if($id_mod_lic==1){
				$sqlIdMarch = ' AND id_march = '.$id_march;
			}else{
				$sqlIdMarch = '';
			}

			$requete = $connexion-> prepare("SELECT ref_dos, id_dos
											FROM dossier
											WHERE id_cli = ?
												AND id_mod_lic = ?
												$sqlIdMarch
												AND id_mod_trans = ?
												AND num_lic = ?
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												AND ref_liq IS NOT NULL
												AND ref_liq <> ''
												AND id_dos NOT IN (
														SELECT id_dos FROM detail_facture_dossier
													)
												AND not_fact = '0'
											ORDER BY id_dos  ASC");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['num_lic']));

			while($reponse = $requete-> fetch()){
				echo '<option value="'.$reponse['id_dos'].'">'.$reponse['ref_dos'].'</option>';
			}$requete-> closeCursor();
		}

		public function selectionnerDossierClientModeleLicenceMarchandise3($id_cli, $id_mod_lic, $id_march, $id_mod_trans, $num_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['num_lic'] = $num_lic;

			$ref_dos = '<option></option>';

			if($id_mod_lic==1){
				$sqlIdMarch = ' AND id_march = '.$id_march;
			}else{
				$sqlIdMarch = '';
			}

			$requete = $connexion-> prepare("SELECT ref_dos, id_dos
											FROM dossier
											WHERE id_cli = ?
												AND id_mod_lic = ?
												$sqlIdMarch
												AND id_mod_trans = ?
												AND num_lic = ?
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												AND ref_liq IS NOT NULL
												AND ref_liq <> ''
												AND id_dos NOT IN (
														SELECT id_dos FROM detail_facture_dossier
													)
												AND not_fact = '0'
											ORDER BY id_dos  ASC");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_mod_trans'], $entree['num_lic']));

			while($reponse = $requete-> fetch()){
				$ref_dos .= '<option value="'.$reponse['id_dos'].'">'.$reponse['ref_dos'].'</option>';
			}$requete-> closeCursor();

			return $ref_dos;
		}

		public function selectionnerDossierClientModeleLicenceMarchandise2($id_cli, $id_mod_lic, $id_march){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_march'] = $id_march;

			$ref_dos = '<option></option>';

			$requete = $connexion-> prepare("SELECT ref_dos, id_dos
											FROM dossier
											WHERE id_cli = ?
												AND id_mod_lic = ?
												AND id_march = ?
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												AND ref_liq IS NOT NULL
												AND ref_liq <> ''
												AND id_dos NOT IN (
														SELECT id_dos FROM detail_facture_dossier
													)
												AND not_fact = '0'
											ORDER BY id_dos  ASC");

			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic'], $entree['id_march']));

			while($reponse = $requete-> fetch()){
				$ref_dos .= '<option value="'.$reponse['id_dos'].'">'.$reponse['ref_dos'].'</option>';
			}$requete-> closeCursor();

			return $ref_dos;
		}

		public function selectionnerFactureEnAttenteTransmis($id_cli, $id_mod_lic, $type_fact){
			include('connexion.php');

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['type_fact'] = $type_fact;

			$requete = $connexion-> prepare("SELECT *
											FROM facture_dossier
											WHERE id_mod_lic = ?
												AND ref_fact NOT IN (
													SELECT ref_fact
														FROM detail_transmis_facture_dossier
													)
												AND type_fact = ?
												AND validation = '1'
												AND not_transmis = '0'
												$sqlClient
											ORDER BY date_fact");

			$requete-> execute(array($entree['id_mod_lic'], $entree['type_fact']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['ref_fact']; ?>">
					<?php echo $reponse['ref_fact']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerTypeDebitCredit($credit_debit, $id_mod_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['credit_debit'] = $credit_debit;

			$requete = $connexion-> prepare("SELECT *
											FROM type_debit_credit_note
											WHERE credit_debit = ?
												AND (id_mod_lic = ? OR id_mod_lic IS NULL)");

			$requete-> execute(array($entree['credit_debit'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_type']; ?>">
					<?php echo $reponse['nom_type']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerFacturePourClientModele($id_cli, $id_mod_lic){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			$option = "";
			$objResponse = new xajaxResponse();
			$bg = '';
			$style = '';
			$option = '';

			$requete = $connexion-> prepare("SELECT *
											FROM facture_licence
											WHERE id_mod_lic = ?
												AND id_cli = ?
											ORDER BY date_creat_fact  DESC");

			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['ref_fact']; ?>">
					<?php echo $reponse['ref_fact']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerDossierEnAttenteApurement($id_cli, $id_mod_lic){
			include('connexion.php');

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}

			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT *
											FROM dossier
											WHERE id_mod_lic = ?
												AND id_dos NOT IN (
													SELECT id_dos 
														FROM detail_apurement
													)
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												-- AND LENGTH(ref_quit) > 2
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												-- AND LENGTH(ref_decl) > 2
												AND num_lic <> 'N/A'
												AND num_lic <> 'UNDER VALUE'
												AND num_lic <> 'UNDERVALUE'
												AND (id_cli <> 869 AND id_cli <> 929 AND id_cli <> 927 AND id_cli <> 870 AND id_cli <> 902 AND id_cli <> 873 AND id_cli <> 871 AND id_cli <> 872 AND id_cli <> 905)
												AND id_dos NOT IN (
													SELECT id_dos 
														FROM dossier 
														WHERE ref_dos LIKE '%RF20-%' OR ref_dos LIKE '%AW20-%' OR ref_dos LIKE '%-ACID-%' OR ref_dos LIKE '%-SUL%'
													)
												$sqlClient
											ORDER BY id_dos");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_dos']; ?>">
					<?php echo $reponse['ref_dos']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerLicenceDossierEnAttenteApurement($id_cli, $id_mod_lic){
			include('connexion.php');

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}

			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT num_lic
											FROM dossier
											WHERE id_mod_lic = ?
												AND id_dos NOT IN (
													SELECT id_dos 
														FROM detail_apurement
													)
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												-- AND LENGTH(ref_quit) > 2
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												-- AND LENGTH(ref_decl) > 2
												AND num_lic <> 'N/A'
												AND num_lic <> 'UNDER VALUE'
												AND num_lic <> 'UNDERVALUE'
												AND (id_cli <> 869 AND id_cli <> 929 AND id_cli <> 927 AND id_cli <> 870 AND id_cli <> 902 AND id_cli <> 873 AND id_cli <> 871 AND id_cli <> 872 AND id_cli <> 905)
												AND id_dos NOT IN (
													SELECT id_dos 
														FROM dossier 
														WHERE ref_dos LIKE '%RF20-%' OR ref_dos LIKE '%AW20-%' OR ref_dos LIKE '%-ACID-%' OR ref_dos LIKE '%-SUL%'
													)
												$sqlClient
											GROUP BY num_lic
											ORDER BY num_lic");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['num_lic']; ?>">
					<?php echo $reponse['num_lic']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function getDossierEnAttenteApurementLicenceAjax($num_lic){
			include('connexion.php');

			$entree['num_lic'] = $num_lic;

			$tbl = '';
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT *,
													dossier.ref_decl AS ref_decl,
													DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
													dossier.ref_liq AS ref_liq,
													DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
													dossier.ref_quit AS ref_quit,
													DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit,
													IF(fob_usd > 0,
														fob_usd,
														fob
													) AS fob_usd
													
											FROM dossier
											WHERE num_lic = ?
												AND id_dos NOT IN (
													SELECT id_dos 
														FROM detail_apurement
													)
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												-- AND LENGTH(ref_quit) > 2
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												-- AND LENGTH(ref_decl) > 2
												AND num_lic <> 'N/A'
												AND num_lic <> 'UNDER VALUE'
												AND num_lic <> 'UNDERVALUE'
												AND (id_cli <> 869 AND id_cli <> 929 AND id_cli <> 927 AND id_cli <> 870 AND id_cli <> 902 AND id_cli <> 873 AND id_cli <> 871 AND id_cli <> 872 AND id_cli <> 905)
												AND id_dos NOT IN (
													SELECT id_dos 
														FROM dossier 
														WHERE ref_dos LIKE '%RF20-%' OR ref_dos LIKE '%AW20-%' OR ref_dos LIKE '%-ACID-%' OR ref_dos LIKE '%-SUL%'
													)
											ORDER BY id_dos");

			$requete-> execute(array($entree['num_lic']));

			while($reponse = $requete-> fetch()){

				$compteur++;

				$tbl .= '
						<input type="hidden" name="id_dos_'.$compteur.'" value="'.$reponse['id_dos'].'">
						<tr>
							<td>'.$compteur.'</td>
							<td class="text-center">'.$reponse['ref_dos'].'</td>
							<td class="text-center">'.$reponse['num_lic'].'</td>
							<td class="text-right">'.number_format($reponse['fob_usd'], 2, ',', ' ').'</td>
							<td class="text-center">'.$reponse['ref_decl'].'</td>
							<td class="text-center">'.$reponse['ref_liq'].'</td>
							<td class="text-center">'.$reponse['ref_quit'].'</td>
						</tr>';

			}$requete-> closeCursor();

			$tbl .='<input type="hidden" name="nbre" value="'.$compteur.'">';

			return $tbl;
		}

		public function getDossierEnAttenteApurementAjax($id_cli, $id_mod_lic){
			include('connexion.php');

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND id_cli = "'.$id_cli.'"';
			}

			$entree['id_mod_lic'] = $id_mod_lic;

			$tbl = '';
			$compteur = 0;

			$requete = $connexion-> prepare("SELECT *,
													dossier.ref_decl AS ref_decl,
													DATE_FORMAT(dossier.date_decl, '%d/%m/%Y') AS date_decl,
													dossier.ref_liq AS ref_liq,
													DATE_FORMAT(dossier.date_liq, '%d/%m/%Y') AS date_liq,
													dossier.ref_quit AS ref_quit,
													DATE_FORMAT(dossier.date_quit, '%d/%m/%Y') AS date_quit,
													IF(fob_usd > 0,
														fob_usd,
														fob
													) AS fob_usd
													
											FROM dossier
											WHERE id_mod_lic = ?
												AND id_dos NOT IN (
													SELECT id_dos 
														FROM detail_apurement
													)
												AND ref_quit IS NOT NULL
												AND ref_quit <> ''
												-- AND LENGTH(ref_quit) > 2
												AND ref_decl IS NOT NULL
												AND ref_decl <> ''
												-- AND LENGTH(ref_decl) > 2
												AND num_lic <> 'N/A'
												AND num_lic <> 'UNDER VALUE'
												AND num_lic <> 'UNDERVALUE'
												AND (id_cli <> 869 AND id_cli <> 929 AND id_cli <> 927 AND id_cli <> 870 AND id_cli <> 902 AND id_cli <> 873 AND id_cli <> 871 AND id_cli <> 872 AND id_cli <> 905)
												AND id_dos NOT IN (
													SELECT id_dos 
														FROM dossier 
														WHERE ref_dos LIKE '%RF20-%' OR ref_dos LIKE '%AW20-%' OR ref_dos LIKE '%-ACID-%' OR ref_dos LIKE '%-SUL%'
													)
												$sqlClient
											ORDER BY id_dos");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				$compteur++;

				$tbl .= '<tr>
							<td>'.$compteur.'</td>
							<td class="text-center">'.$reponse['ref_dos'].'</td>
							<td class="text-center">'.$reponse['num_lic'].'</td>
							<td class="text-right">'.number_format($reponse['fob_usd'], 2, ',', ' ').'</td>
							<td class="text-center">'.$reponse['ref_decl'].'</td>
							<td class="text-center">'.$reponse['date_decl'].'</td>
							<td class="text-center">'.$reponse['ref_liq'].'</td>
							<td class="text-center">'.$reponse['date_liq'].'</td>
							<td class="text-center">'.$reponse['ref_quit'].'</td>
							<td class="text-center">'.$reponse['date_quit'].'</td>
							<td style="text-align: center;"><input class="" type="checkbox" id="check_'.$compteur.'" name="check_'.$compteur.'"></td>
						</tr>';

			}$requete-> closeCursor();

			return $tbl;
		}

		public function selectionnerClientPourFactureModeleLicence($id_mod_lic){
			include('connexion.php');

			$entree['id_mod_lic'] = $id_mod_lic;
			$option = "";
			$objResponse = new xajaxResponse();
			$bg = '';
			$style = '';
			$option = '';

			$requete = $connexion-> prepare("SELECT DISTINCT(cl.id_cli) AS id_cli, 
													UPPER(cl.nom_cli) AS nom_cli
											FROM facture_licence f, client cl
											WHERE f.id_mod_lic = ?
												AND cl.id_cli = f.id_cli");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){

				?>
				<option value="<?php echo $reponse['id_cli']; ?>">
					<?php echo $reponse['nom_cli']; ?>
				</option>
				<?php
			}$requete-> closeCursor();
		}

		public function selectionnerClientModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli,
													c.id_cli AS id_cli
												FROM client c, modele_licence ml,
													affectation_client_modele_licence a
												WHERE ml.id_mod_lic = ?
													AND ml.id_mod_lic = a.id_mod_lic
													AND a.id_cli = c.id_cli
													AND a.id_etat = 1
												ORDER BY c.nom_cli ASC");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_cli'];?>">
				<?php echo $reponse['nom_cli'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerClientModeleLicence2($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT UPPER(c.nom_cli) AS nom_cli,
													c.id_cli AS id_cli
												FROM client c, modele_licence ml,
													affectation_client_modele_licence a
												WHERE ml.id_mod_lic = ?
													AND ml.id_mod_lic = a.id_mod_lic
													AND a.id_cli = c.id_cli
													AND a.id_etat = 1
												ORDER BY c.nom_cli ASC");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['nom_cli'];?>">
				<?php echo $reponse['nom_cli'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerClasseCompte(){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> query("SELECT *
											FROM classe_compte");
			// $requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_class'];?>">
				<?php echo $reponse['nom_class'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerCategorieCompte(){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> query("SELECT *
											FROM categorie_compte");
			// $requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_cat_cmpte'];?>">
				<?php echo $reponse['nom_cat_cmpte'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerDossierClientModeTransportModeLicence2($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													$sqlClient
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.cleared = '0'
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			
			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['ref_dos'];?>">
				<?php echo $reponse['ref_dos'];?>
			</option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerDossierClientModeTransportModeLicence3($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, $type){
			include('connexion.php');

			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$compteur = $premiere_entree;
			$bg = '';
			$style = '';

			/*echo '<br> id_cli = '.$id_cli;
			echo '<br> id_mod_trans = '.$id_mod_trans;
			echo '<br> id_mod_lic = '.$id_mod_lic;
			echo '<br> num_lic = '.$num_lic;*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$sqlClient = "";
			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND cl.id_cli = "'.$id_cli.'"';
			}

			if (isset($type) && ($type == 'TOTAL FILES')) {
				$sqlType = '';
			}

			if (isset($type) && ($type == 'CLEARING COMPLETED')) {
				$sqlType = " AND cleared = '1'";
			}

			if (isset($type) && ($type == 'FILES IN PROCESS')) {
				$sqlType = " AND cleared = '0'";
			}

			if (isset($type) && ($type == 'CANCELLED')) {
				$sqlType = " AND cleared = '2'";
			}

			if (isset($type) && ($type == 'KASUMBALESA')) {
				$sqlType = " AND DATE(arrival_date) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'WISKI ARRIVAL')) {
				$sqlType = " AND DATE(wiski_arriv) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT WISKI')) {
				$sqlType = " AND (wiski_arriv IS NOT NULL AND wiski_arriv <> '')
												AND (wiski_dep IS NULL OR wiski_dep = '')";
			}

			if (isset($type) && ($type == 'WISKI DEPARTURE')) {
				$sqlType = " AND DATE(wiski_dep) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'AWAIT CRF')) {
				$sqlType = " AND (wiski_dep IS NOT NULL AND wiski_dep <> '')
												AND ( (date_crf IS NULL OR date_crf = '') AND (ref_crf IS NULL OR ref_crf = '' ))";
			}

			if (isset($type) && ($type == 'DGDA IN')) {
				$sqlType = " AND DATE(dgda_in) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT DGDA')) {
				$sqlType = " AND (dgda_in IS NOT NULL AND dgda_in <> '')
												AND (dgda_out IS NULL OR dgda_out = '')";
			}

			if (isset($type) && ($type == 'LIQUIDATED / AWAIT QUITTANCE')) {
				$sqlType = " AND ( (date_liq IS NOT NULL OR date_liq <> '')
													OR (refORq IS NOT NULL AND ref_liq <> '') )
												AND ( (date_quit IS NULL OR date_quit = '') 
													OR (ref_quit IS NULL OR ref_quit = '') )";
			}

			if (isset($type) && ($type == 'QUITTANCE')) {
				$sqlType = " AND DATE(date_quit) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'DGDA OUT')) {
				$sqlType = " AND DATE(dgda_out) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'FILES CLEARED WAITING INVOICE')) {
				$sqlType = " AND cleared = '1'
												AND facture = '0'";
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													$sqlClient
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													$sqlType
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic']));
			
			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['ref_dos'];?>">
				<?php echo $reponse['ref_dos'];?>
			</option>
			<?php
			}$requete-> closeCursor();
		}

		public function selectionnerMarchandiseClientModeleLicence($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT DISTINCT(UPPER(commodity)) AS commodity
												FROM dossier
												WHERE id_cli = ?
													AND id_mod_lic = ?
												ORDER BY commodity");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['commodity'];?>">
				<?php echo $reponse['commodity'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerMarchandiseClientModeleLicence2($id_cli, $id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT UPPER(m.nom_march) AS nom_march, m.id_march AS id_march
												FROM marchandise m, client cl, modele_licence ml, affectation_marchandise_client_modele_licence af
												WHERE cl.id_cli = ?
													AND cl.id_cli = af.id_cli
													AND af.id_march = m.id_march
													AND af.id_mod_lic = ml.id_mod_lic
													AND ml.id_mod_lic = ?
												ORDER BY m.nom_march");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_march'];?>">
				<?php echo $reponse['nom_march'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerMarchandiseModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT DISTINCT(UPPER(commodity)) AS commodity
												FROM dossier
												WHERE id_mod_lic = ?
												ORDER BY commodity");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['commodity'];?>">
				<?php echo $reponse['commodity'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerStatusModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['id_cli'] = $id_cli;
			//echo $id_cli.' - '.$id_mod_lic;
			$requete = $connexion-> prepare("SELECT DISTINCT(UPPER(REPLACE(nom_stat,'\'',' '))) AS statut
												FROM status_dashboard
												WHERE id_mod_lic = ?
													AND active = '1'
												ORDER BY rang_stat");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				if ($reponse['statut']=='CANCELLED' && $_SESSION['id_role']!='1') {
					
				}else{
				?>
				<option value="<?php echo $reponse['statut'];?>">
					<?php echo $reponse['statut'];?>
				</option>
				<?php	
				}
			}$requete-> closeCursor();

		}

		public function selectionnerClient(){
			include('connexion.php');
			//$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> query("SELECT UPPER(c.nom_cli) AS nom_cli,
													c.id_cli AS id_cli
												FROM client c
												ORDER BY c.nom_cli ASC");
			//$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_cli'];?>">
				<?php echo $reponse['nom_cli'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerBanque(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_banq) AS nom_banq,
													id_banq
												FROM banque
												ORDER BY nom_banq ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_banq'];?>">
				<?php echo $reponse['nom_banq'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerBanqueLiquidation(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_banq) AS nom_banq,
													id_banq
												FROM banque
												WHERE liquidation = '1'
												ORDER BY nom_banq ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_banq'];?>">
				<?php echo $reponse['nom_banq'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerBanqueLiquidationAjax(){
			include('connexion.php');

			$select = '';

			$requete = $connexion-> query("SELECT UPPER(nom_banq) AS nom_banq,
													id_banq
												FROM banque
												WHERE liquidation = '1'
												ORDER BY nom_banq ASC");

			while($reponse = $requete-> fetch()){
				$select.= '<option value="'.$reponse['id_banq'].'">'.$reponse['nom_banq'].'</option>';
			}$requete-> closeCursor();

			return $select;

		}

		public function selectionnerFrontiere(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_front) AS nom_front,
													id_front
												FROM frontiere
												ORDER BY nom_front ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_front'];?>">
				<?php echo $reponse['nom_front'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerFrontiere2(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_front) AS nom_front,
													id_front
												FROM frontiere
												ORDER BY nom_front ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['nom_front'];?>">
				<?php echo $reponse['nom_front'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerEntrepot(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_ent) AS nom_ent,
													id_ent
												FROM entrepot
												ORDER BY nom_ent ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_ent'];?>">
				<?php echo $reponse['nom_ent'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerEntrepot2(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_ent) AS nom_ent,
													id_ent
												FROM entrepot
												ORDER BY nom_ent ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['nom_ent'];?>">
				<?php echo $reponse['nom_ent'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerRegime($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT UPPER(nom_reg) AS nom_reg,
													id_reg
												FROM regime
												WHERE id_mod_lic = ?
												ORDER BY nom_reg ASC");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_reg'];?>">
				<?php echo $reponse['nom_reg'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerRegime2($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> prepare("SELECT UPPER(nom_reg) AS nom_reg,
													id_reg
												FROM regime
												WHERE id_mod_lic = ?
												ORDER BY nom_reg ASC");
			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['nom_reg'];?>">
				<?php echo $reponse['nom_reg'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerRegimeGrouping(){
			include('connexion.php');
			// $entree['id_mod_lic'] = $id_mod_lic;

			$requete = $connexion-> query("SELECT *
												FROM modele_licence
													WHERE id_etat = '1'
												ORDER BY id_mod_lic DESC");
			// $requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
			?>
			<optgroup label="<?php echo $reponse['nom_mod_lic'];?>">
			<?php
				$requete2 = $connexion-> prepare("SELECT UPPER(nom_reg) AS nom_reg,
														id_reg
													FROM regime
														WHERE id_mod_lic = ?
													ORDER BY nom_reg ASC");
				$requete2-> execute(array($reponse['id_mod_lic']));

				while($reponse2 = $requete2-> fetch()){
				?>
				<option value="<?php echo $reponse2['id_reg'];?>">
					<?php echo $reponse2['nom_reg'];?>
				</option>
				<?php
				}$requete2-> closeCursor();

			?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerRegimeGroupingAjax(){
			include('connexion.php');
			
			$select = "<select name='id_reg' id='id_reg' class='form-control cc-exp form-control-sm' required>
              			<option></option>";

			$requete = $connexion-> query("SELECT *
												FROM modele_licence
													WHERE id_etat = '1'
												ORDER BY id_mod_lic DESC");
			// $requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$select .='<optgroup label="'.$reponse['nom_mod_lic'].'">';

				$requete2 = $connexion-> prepare("SELECT UPPER(nom_reg) AS nom_reg,
														id_reg
													FROM regime
														WHERE id_mod_lic = ?
													ORDER BY nom_reg ASC");
				$requete2-> execute(array($reponse['id_mod_lic']));

				while($reponse2 = $requete2-> fetch()){
					$select .='<option value="'.$reponse2['id_reg'].'">'.$reponse2['nom_reg'].'</option>';
				}$requete2-> closeCursor();

				$select .='</option>';
			}$requete-> closeCursor();

			$select .= '</select>';

			return $select;

		}

		public function selectionnerRegimeGroupingAjax_edit(){
			include('connexion.php');
			
			$select = "<select name='id_reg' id='id_reg_edit' class='form-control cc-exp form-control-sm' required>
              			<option></option>";

			$requete = $connexion-> query("SELECT *
												FROM modele_licence
													WHERE id_etat = '1'
												ORDER BY id_mod_lic DESC");
			// $requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$select .='<optgroup label="'.$reponse['nom_mod_lic'].'">';

				$requete2 = $connexion-> prepare("SELECT UPPER(nom_reg) AS nom_reg,
														id_reg
													FROM regime
														WHERE id_mod_lic = ?
													ORDER BY nom_reg ASC");
				$requete2-> execute(array($reponse['id_mod_lic']));

				while($reponse2 = $requete2-> fetch()){
					$select .='<option value="'.$reponse2['id_reg'].'">'.$reponse2['nom_reg'].'</option>';
				}$requete2-> closeCursor();

				$select .='</option>';
			}$requete-> closeCursor();

			$select .= '</select>';

			return $select;

		}

		public function selectionnerNomBanque(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_banq) AS nom_banq,
													id_banq
												FROM banque
												ORDER BY nom_banq ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['nom_banq'];?>">
				<?php echo $reponse['nom_banq'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerPoste(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_post) AS nom_post,
													id_post
												FROM poste_entree
												ORDER BY nom_post ASC");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_post'];?>">
				<?php echo $reponse['nom_post'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerTypeLicence(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_type_lic) AS nom_type_lic,
													id_type_lic
												FROM type_licence");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_type_lic'];?>">
				<?php echo $reponse['nom_type_lic'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerModalitePaiement(){
			include('connexion.php');

			$requete = $connexion-> query("SELECT UPPER(nom_mod_paie) AS nom_mod_paie, code,
													id_mod_paie
												FROM modalite_paiement");

			while($reponse = $requete-> fetch()){
			?>
			<option value="<?php echo $reponse['id_mod_paie'];?>">
				<?php echo $reponse['code'].' - '.$reponse['nom_mod_paie'];?>
			</option>
			<?php
			}$requete-> closeCursor();

		}

		public function selectionnerSousTypePaiement($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$requete = $connexion-> prepare("SELECT id_sous_type_paie, code, 
												UPPER(nom_sous_type_paie) AS nom_sous_type_paie
											FROM sous_type_paiement
											WHERE id_mod_lic = ?");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['id_sous_type_paie'];?>">
				<?php echo $reponse['code'].' - '.$reponse['nom_sous_type_paie'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		} 

		public function selectionnerMonnaie(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT id_mon, UPPER(sig_mon) AS nom_mon
											FROM monnaie");
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['id_mon'];?>">
				<?php echo $reponse['nom_mon'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		} 

		public function selectionnerMonnaie2(){
			include('connexion.php');
			$monnaie = '<option></option>';
			$requete = $connexion-> query("SELECT id_mon, UPPER(sig_mon) AS nom_mon
											FROM monnaie");
			while($reponse = $requete-> fetch()){
				$monnaie.='<option value="'.$reponse['id_mon'].'">
							'.$reponse['nom_mon'].'
						  </option>';
			}$requete-> closeCursor();

			return $monnaie;
		} 

		public function selectionnerMonnaie3($mon){
			include('connexion.php');
			$monnaie = '<select id=\''.$mon.'\' class=\'bg bg-purple\'>';
			$requete = $connexion-> query("SELECT id_mon, UPPER(sig_mon) AS nom_mon
											FROM monnaie");
			while($reponse = $requete-> fetch()){
				$monnaie.='<option value=\''.$reponse['id_mon'].'\'>
							'.$reponse['nom_mon'].'
						  </option>';
			}$requete-> closeCursor();

			$monnaie .= '</select>';

			return $monnaie;
		} 

		public function selectionnerModeTransport(){
			include('connexion.php');
			$requete = $connexion-> query("SELECT id_mod_trans, UPPER(nom_mod_trans) AS nom_mod_trans
											FROM mode_transport
											WHERE id_mod_trans < 5");
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['id_mod_trans'];?>">
				<?php echo $reponse['nom_mod_trans'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		} 

		/*public function selectionnerMarchandiseModeleLicence($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$requete = $connexion-> prepare("SELECT id_march, UPPER(nom_march) AS nom_march
											FROM marchandise
											WHERE id_mod_lic = ?
											ORDER BY nom_march  ASC");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['id_march'];?>">
				<?php echo $reponse['nom_march'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		} */

		public function selectionnerLicenceModele($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$requete = $connexion-> prepare("SELECT num_lic
											FROM licence
											WHERE id_mod_lic = ?
											ORDER BY date_creat_lic  DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		} 

		public function selectionnerLicenceModele2($id_mod_lic, $id_cli, $id_type_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;

			$sql = '';
			$sql2 = '';

			if (isset($id_cli)) {
				$sql = ' AND id_cli = '.$id_cli;
			}
			if (isset($id_type_lic)) {
				$sql2 = ' AND id_type_lic = '.$id_type_lic;
			}

			$requete = $connexion-> prepare("SELECT num_lic
											FROM licence
											WHERE id_mod_lic = ?
											$sql
											$sql2
											ORDER BY date_creat_lic  DESC");
			$requete-> execute(array($entree['id_mod_lic']));
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		} 

		public function selectionnerLicenceModeleClient($id_mod_lic, $id_cli, $id_mod_trans, $id_march=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			if ( ($id_mod_lic==1) && (isset($id_march) && ($id_march!=NULL))) {
				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_march = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], 
										$entree['id_march'], $entree['id_mod_trans']));
				# code...
			}else{

				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			}
			
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'].' '.$reponse['comment'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		} 

		public function selectionnerLicenceModeleClientActive($id_mod_lic, $id_cli, $id_mod_trans, $id_march=NULL){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$entree['id_march'] = $id_march;
			$entree['id_mod_trans'] = $id_mod_trans;
			if ( ($id_mod_lic==1) && (isset($id_march) && ($id_march!=NULL))) {
				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_march = ?
													AND id_mod_trans = ?
													AND affichier_tracking = '1'
												ORDER BY date_creat_lic  DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], 
										$entree['id_march'], $entree['id_mod_trans']));
				# code...
			}else{

				$requete = $connexion-> prepare("SELECT num_lic, comment
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
													AND id_mod_trans = ?
												ORDER BY date_creat_lic  DESC");
				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli'], $entree['id_mod_trans']));
			}
			
			while($reponse = $requete-> fetch()){
			?>
			  <option value="<?php echo $reponse['num_lic'];?>">
				<?php echo $reponse['num_lic'].' '.$reponse['comment'];?>
			  </option>
			<?php
			}$requete-> closeCursor();
		} 

		public function selectionnerLicenceEnCoursModele($id_mod_lic){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$bg = '';
			$style = '';

			$requete = $connexion-> prepare("SELECT num_lic, fob, DATE(CURRENT_DATE()) AS aujourdhui
											FROM licence
											WHERE id_mod_lic = ?
											ORDER BY date_creat_lic  DESC");

			$requete-> execute(array($entree['id_mod_lic']));

			while($reponse = $requete-> fetch()){
				$compteur++;
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);
				
				$bg = "bg-light";
				
				if( (!$date_exp) && ($this-> getSommeFobLicence($reponse['num_lic']) <= $fob) ){
					?>
					  <option value="<?php echo $reponse['num_lic'];?>">
						<?php echo $reponse['num_lic'];?>
					  </option>
					<?php
				}else{
						
					$style = '';//" style='color: black; background-color: orange;'";
					if( ($reponse['fob'] == $this-> getSommeFobLicence($reponse['num_lic'])) ){
						$bg = "bg-success";
						$style = " style=''";
					}else if($date_exp < $reponse['aujourdhui']){
						$bg = "bg-danger";
						$style = " style=''";
					}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 30) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) >= 0) ){
						$bg = "bg-warning";
						$style = " style=''";
					}else if( ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 30) && ($this-> getDifferenceDate($date_exp, $reponse['aujourdhui']) < 0) ){
						$bg = "bg-danger";
						$style = " style=''";
					} else if( ($reponse['fob'] >= $this-> getSommeFobLicence($reponse['num_lic'])) && ($this-> getSommeFobLicence($reponse['num_lic'])>0) ){
						$bg = "bg-info";
						$style = " style=''";
						?>
						  <option value="<?php echo $reponse['num_lic'];?>">
							<?php echo $reponse['num_lic'];?>
						  </option>
						<?php
					}else{
						?>
						  <option value="<?php echo $reponse['num_lic'];?>">
							<?php echo $reponse['num_lic'];?>
						  </option>
						<?php
					}
				}
			}$requete-> closeCursor();
		} 

		public function selectionnerLicenceEnCoursModeleClient($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$bg = '';
			$style = '';

			if ($id_cli==845 || $id_cli==885) {
				
				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														l.fob AS fob, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.date_val
												FROM licence l
												WHERE l.id_mod_lic = ?
													AND (l.id_cli = 845 OR l.id_cli = 885)
													AND (l.fob > ROUND((
															SELECT SUM(fob) AS fob
																FROM dossier
																WHERE num_lic = l.num_lic
															))+1
															OR l.num_lic NOT IN(
																SELECT DISTINCT(num_lic) FROM dossier
																)
														)
													AND DATE(CURRENT_DATE()) <= (
															SELECT date_exp
																FROM expiration_licence
																WHERE num_lic = l.num_lic
																ORDER BY id_date_exp DESC
																LIMIT 0, 1
														)
												ORDER BY l.num_lic  ASC");

				$requete-> execute(array($entree['id_mod_lic']));

			}else if ($id_cli==918 || $id_cli==903) {
				
				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														l.fob AS fob, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.date_val
												FROM licence l
												WHERE l.id_mod_lic = ?
													AND (l.id_cli = 918 OR l.id_cli = 903)
													AND (l.fob > ROUND((
															SELECT SUM(fob) AS fob
																FROM dossier
																WHERE num_lic = l.num_lic
															))+1
															OR l.num_lic NOT IN(
																SELECT DISTINCT(num_lic) FROM dossier
																)
														)
													AND DATE(CURRENT_DATE()) <= (
															SELECT date_exp
																FROM expiration_licence
																WHERE num_lic = l.num_lic
																ORDER BY id_date_exp DESC
																LIMIT 0, 1
														)
												ORDER BY l.num_lic  ASC");

				$requete-> execute(array($entree['id_mod_lic']));

			}else{
				
				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														l.fob AS fob, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.date_val
												FROM licence l
												WHERE l.id_mod_lic = ?
													AND l.id_cli = ?
													AND (l.fob > ROUND((
															SELECT SUM(fob) AS fob
																FROM dossier
																WHERE num_lic = l.num_lic
														))+1

														OR l.num_lic NOT IN(
															SELECT DISTINCT(num_lic) FROM dossier
															)
													)
													AND DATE(CURRENT_DATE()) <= (
															SELECT date_exp
																FROM expiration_licence
																WHERE num_lic = l.num_lic
																ORDER BY id_date_exp DESC
																LIMIT 0, 1
														)
												ORDER BY l.num_lic  ASC");

				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));

			}

			while($reponse = $requete-> fetch()){
				?>
				  <option value="<?php echo $reponse['num_lic'];?>">
					<?php echo $reponse['num_lic'];?>
				  </option>
				<?php
			
			}$requete-> closeCursor();
		} 
/*
		public function selectionnerLicenceEnCoursModeleClient($id_mod_lic, $id_cli){
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_cli'] = $id_cli;
			$bg = '';
			$style = '';

			if ($id_cli==845 || $id_cli==885) {
				
				$requete = $connexion-> prepare("SELECT l.num_lic AS num_lic, 
														l.fob AS fob, 
														DATE(CURRENT_DATE()) AS aujourdhui, 
														l.date_val
												FROM licence l
												WHERE l.id_mod_lic = ?
													AND (l.id_cli = 845 OR l.id_cli = 885)
													AND (l.fob > ROUND((
															SELECT SUM(fob) AS fob
																FROM dossier
																WHERE num_lic = l.num_lic
														))+1
																		))

																		)
																		)
													AND DATE(CURRENT_DATE()) <= (
															SELECT date_exp
																FROM expiration_licence
																WHERE num_lic = l.num_lic
																ORDER BY id_date_exp DESC
																LIMIT 0, 1
														)
												ORDER BY num_lic  ASC");

				$requete-> execute(array($entree['id_mod_lic']));

			}else{
				
				$requete = $connexion-> prepare("SELECT num_lic, fob, DATE(CURRENT_DATE()) AS aujourdhui, date_val
												FROM licence
												WHERE id_mod_lic = ?
													AND id_cli = ?
												ORDER BY num_lic  ASC");

				$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));

			}

			while($reponse = $requete-> fetch()){
				$compteur++;
				$marchandise = $this-> getMarchandiseLicence($reponse['num_lic']);
				$date_exp = $this-> getLastEpirationLicence2($reponse['num_lic']);

				if( ($this->getDifferenceDate($date_exp, $reponse['date_val']) > 0) && ($this-> getSommeFobLicence($reponse['num_lic']) < $reponse['fob']) ){
					?>
					  <option value="<?php echo $reponse['num_lic'];?>">
						<?php echo $reponse['num_lic'];?>
					  </option>
					<?php
				}
			}$requete-> closeCursor();
		} */

		//FIN Methodes permettant de Selectionner 

		//Methodes permettant de mettre Ã  jour
		public function modifierLicence($num_lic, $date_val, $date_exp, 
										$fournisseur, $commodity, $fob, 
										$fret, $assurance, $autre_frais, 
										$num_lic_old, $id_mon, $id_mod_paie, 
										$id_type_lic, $id_sous_type_paie, $poids, 
										$id_mod_trans, $cod, $consommable, $id_banq){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['num_lic_old'] = $num_lic_old;
			/*if (!isset($date_val) || $date_val = '' ) {
				$date_val = NULL;
			}*/
			$entree['date_val'] = $date_val;
			$entree['fournisseur'] = $fournisseur;
			$entree['commodity'] = $commodity;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['id_mon'] = $id_mon;
			$entree['id_mod_paie'] = $id_mod_paie;
			$entree['id_type_lic'] = $id_type_lic;
			$entree['id_sous_type_paie'] = $id_sous_type_paie;
			$entree['poids'] = $poids;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['cod'] = $cod;
			$entree['consommable'] = $consommable;
			$entree['id_banq'] = $id_banq;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;
			echo '<br> fret = '.$fret;
			echo '<br> assurance = '.$assurance;
			echo '<br> autre_frais = '.$autre_frais;
			echo '<br> id_mod_paie = '.$id_mod_paie;
			echo '<br> id_type_lic = '.$id_type_lic;
			echo '<br> id_sous_type_paie = '.$id_sous_type_paie;*/

			$requete = $connexion-> prepare("UPDATE licence SET num_lic= ?,  date_val = ?, 
													fournisseur = ?, commodity = ?, fob = ?, 
													fret = ?, assurance = ?, autre_frais = ?, 
													id_mon = ?, id_mod_paie = ?, id_type_lic = ?,
													id_sous_type_paie = ?, poids = ?, id_mod_trans = ?, 
													cod = ?, consommable = ?, id_banq = ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic'], $entree['date_val'], $entree['fournisseur'], 
									$entree['commodity'], $entree['fob'], $entree['fret'], 
									$entree['assurance'], $entree['autre_frais'], $entree['id_mon'], 
									$entree['id_mod_paie'], $entree['id_type_lic'], $entree['id_sous_type_paie'], 
									$entree['poids'], $entree['id_mod_trans'], $entree['cod'], $entree['consommable'], $entree['id_banq'], 
									$entree['num_lic_old']));

			if ($date_exp != $this-> getLastEpirationLicence2($num_lic)) {
				$this-> annulerDateExpirationLicence($num_lic);
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

			$this-> modifierLicencePourDossier($num_lic, $num_lic_old);

		} 

		public function modifierLicenceExport($num_lic, $date_val, $date_exp, 
										$acheteur, $commodity, $fob, 
										$fret, $assurance, $autre_frais, 
										$num_lic_old, $id_mon, $id_mod_paie, 
										$id_type_lic, $id_mod_trans, $id_banq){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['num_lic_old'] = $num_lic_old;
			/*if (!isset($date_val) || $date_val = '' ) {
				$date_val = NULL;
			}*/
			$entree['date_val'] = $date_val;
			$entree['acheteur'] = $acheteur;
			$entree['commodity'] = $commodity;
			$entree['fob'] = $fob;
			$entree['fret'] = $fret;
			$entree['assurance'] = $assurance;
			$entree['autre_frais'] = $autre_frais;
			$entree['id_mon'] = $id_mon;
			$entree['id_mod_paie'] = $id_mod_paie;
			$entree['id_type_lic'] = $id_type_lic;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_banq'] = $id_banq;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> acheteur = '.$acheteur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;
			echo '<br> fret = '.$fret;
			echo '<br> assurance = '.$assurance;
			echo '<br> autre_frais = '.$autre_frais;
			echo '<br> id_mod_paie = '.$id_mod_paie;
			echo '<br> id_type_lic = '.$id_type_lic;*/

			$requete = $connexion-> prepare("UPDATE licence SET num_lic= ?,  date_val = ?, 
													acheteur = ?, commodity = ?, fob = ?, 
													fret = ?, assurance = ?, autre_frais = ?, 
													id_mon = ?, id_mod_paie = ?, id_type_lic = ?, id_mod_trans = ?, id_banq= ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic'], $entree['date_val'], $entree['acheteur'], 
									$entree['commodity'], $entree['fob'], $entree['fret'], 
									$entree['assurance'], $entree['autre_frais'], $entree['id_mon'], 
									$entree['id_mod_paie'], $entree['id_type_lic'],  $entree['id_mod_trans'],  $entree['id_banq'],  
									$entree['num_lic_old']));

			if ($date_exp != $this-> getLastEpirationLicence2($num_lic)) {
				$this-> annulerDateExpirationLicence($num_lic);
				$this-> creerDateExpirationLicence($num_lic, $date_exp);
			}

			$this-> modifierLicencePourDossier($num_lic, $num_lic_old);

		} 

		public function modifierLicencePourDossier($num_lic, $num_lic_old){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['num_lic_old'] = $num_lic_old;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/

			$requete = $connexion-> prepare("UPDATE dossier SET num_lic= ?	
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic'], $entree['num_lic_old']));

		} 
		
		public function appliquer_taux($id){

			include('connexion.php');
			$entree['id'] = $id;

			$requete = $connexion-> prepare('SELECT *
												FROM taux_banque
												WHERE id_taux_bcc = ?');
			while ($reponse = $requete-> fetch()) {
				
				$requete2 = $connexion-> prepare('UPDATE dossier 
													SET roe_decl = ?
													WHERE id_bank_liq = ? 
														AND date_quit = ?');
				$requete2-> execute(array($reponse['montant'], $reponse['id_banq'], $reponse['date_taux']));

			}$requete-> closeCursor();

		} 

		public function uploadAccuseeRecpetionTransmissionApurement($id_trans_ap, $fichier_trans_ap, $tmp){

			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;
			$entree['fichier_trans_ap'] = $fichier_trans_ap;

			$transmision_apurement = '../transmision_apurements/'.$id_trans_ap;

			if(!is_dir($transmision_apurement)){
				mkdir("../transmision_apurements/$id_trans_ap", 0777);
			}

			move_uploaded_file($tmp, '../transmision_apurements/'.$id_trans_ap.'/' . basename($fichier_trans_ap));

			$requete = $connexion-> prepare("UPDATE transmission_apurement SET fichier_trans_ap= ?	
												WHERE id_trans_ap = ?");
			$requete-> execute(array($entree['fichier_trans_ap'], $entree['id_trans_ap']));



		} 

		public function annuler_accuser_reception_transmis_apurement($id_trans_ap){

			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;

			$requete = $connexion-> prepare("UPDATE transmission_apurement SET fichier_trans_ap= NULL
												WHERE id_trans_ap = ?");
			$requete-> execute(array($entree['id_trans_ap']));



		} 

		public function update_date_depot_transmis($id_trans_ap, $date_depot){

			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;
			$entree['date_depot'] = $date_depot;

			if ($entree['date_depot'] == '') {
				$entree['date_depot'] = NULL;
			}

			$requete = $connexion-> prepare("UPDATE transmission_apurement SET date_depot= ?	
												WHERE id_trans_ap = ?");
			$requete-> execute(array($entree['date_depot'], $entree['id_trans_ap']));



		} 

		public function update_ref_trans_ap($id_trans_ap, $ref_trans_ap){

			include('connexion.php');
			$entree['id_trans_ap'] = $id_trans_ap;
			$entree['ref_trans_ap'] = $ref_trans_ap;

			$requete = $connexion-> prepare("UPDATE transmission_apurement SET ref_trans_ap= ?	
												WHERE id_trans_ap = ?");
			$requete-> execute(array($entree['ref_trans_ap'], $entree['id_trans_ap']));



		} 

		public function updateMultipleFiles($debut, $fin, $klsa_arriv, 
			                                  $crossing_date, $wiski_arriv, $wiski_dep, 
			                                  $amicong_arriv, $insp_receiv, $ir, 
			                                  $ref_crf, $date_crf, $dgda_in, $ref_decl,
			                                  $ref_liq, $date_liq, $ref_quit, 
			                                  $date_quit, $custom_deliv, $cleared, 
			                                  $dispatch_deliv, $statut, $remarque, 
			                                  $nbre, $id_cli, $id_mod_trans, $id_mod_lic, 
			                                  $commodity){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) { 
				# code...
			}*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.ref_dos BETWEEN ? AND ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], 
									$entree['debut'], $entree['fin']));
			
			while($reponse = $requete-> fetch()){

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($date_decl) && ($date_decl != '')) {
		        $this-> MAJ_date_decl($reponse['id_dos'], $date_decl);
		      }

		      if (isset($ref_liq) && ($ref_liq != '')) {
		        $this-> MAJ_ref_liq($reponse['id_dos'], $ref_liq);
		      }

		      if (isset($date_liq) && ($date_liq != '')) {
		        $this-> MAJ_date_liq($reponse['id_dos'], $date_liq);
		      }

		      if (isset($ref_quit) && ($ref_quit != '')) {
		        $this-> MAJ_ref_quit($reponse['id_dos'], $ref_quit);
		      }

		      if (isset($date_quit) && ($date_quit != '')) {
		        $this-> MAJ_date_quit($reponse['id_dos'], $date_quit);
		      }

		      if (isset($montant_decl) && ($montant_decl != '')) {
		        $this-> MAJ_montant_decl($reponse['id_dos'], $montant_decl);
		      }

		      if (isset($klsa_arriv) && ($klsa_arriv != '')) {
		        $this-> MAJ_klsa_arriv($reponse['id_dos'], $klsa_arriv);
		      }
		      
		      if (isset($crossing_date) && ($crossing_date != '')) {
		        $this-> MAJ_crossing_date($reponse['id_dos'], $crossing_date);
		      }
		      
		      if (isset($wiski_arriv) && ($wiski_arriv != '')) {
		        $this-> MAJ_wiski_arriv($reponse['id_dos'], $wiski_arriv);
		      }
		      
		      if (isset($wiski_dep) && ($wiski_dep != '')) {
		        $this-> MAJ_wiski_dep($reponse['id_dos'], $wiski_dep);
		      }
		      
		      if (isset($ref_crf) && ($ref_crf != '')) {
		        $this-> MAJ_ref_crf($reponse['id_dos'], $ref_crf);
		      }
		      
		      if (isset($date_crf) && ($date_crf != '')) {
		        $this-> MAJ_date_crf($reponse['id_dos'], $date_crf);
		      }
		      
		      if (isset($dgda_in) && ($dgda_in != '')) {
		        $this-> MAJ_dgda_in($reponse['id_dos'], $dgda_in);
		      }
		      
		      if (isset($dgda_out) && ($dgda_out != '')) {
		        $this-> MAJ_dgda_out($reponse['id_dos'], $dgda_out);
		      }

		      if (isset($date_preal) && ($date_preal != '')) {
		        $this-> MAJ_date_preal($reponse['id_dos'], $date_preal);
		      }

		      if (isset($custom_deliv) && ($custom_deliv != '')) {
		        $this-> MAJ_custom_deliv($reponse['id_dos'], $custom_deliv);
		      }
		      
		      if (isset($dispatch_klsa) && ($dispatch_klsa != '')) {
		        $this-> MAJ_dispatch_klsa($reponse['id_dos'], $dispatch_klsa);
		      }
		      
		      if (isset($dispatch_deliv) && ($dispatch_deliv != '')) {
		        $this-> MAJ_dispatch_deliv($reponse['id_dos'], $dispatch_deliv);
		      }
		      
		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($statut) && ($statut != '')) {
		        $this-> MAJ_statut($reponse['id_dos'], $statut);
		      }

		      if (isset($remarque) && ($remarque != '')) {
		        $this-> MAJ_remarque($reponse['id_dos'], $remarque);
		      }

		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($amicongo_arriv) && ($amicongo_arriv != '')) {
		        $this-> MAJ_amicongo_arriv($reponse['id_dos'], $amicongo_arriv);
		      }

		      if (isset($insp_receiv) && ($insp_receiv != '')) {
		        $this-> MAJ_insp_receiv($reponse['id_dos'], $insp_receiv);
		      }

		      if (isset($ir) && ($ir != '')) {
		        $this-> MAJ_ir($reponse['id_dos'], $ir);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		      	//echo "<br> $ref_decl";
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

			}

		} 

		public function updateMultipleFiles2($debut, $fin, $data){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) { 
				# code...
			}*/

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.ref_dos BETWEEN ? AND ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], 
									$entree['debut'], $entree['fin']));
			
			while($reponse = $requete-> fetch()){

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($date_decl) && ($date_decl != '')) {
		        $this-> MAJ_date_decl($reponse['id_dos'], $date_decl);
		      }

		      if (isset($ref_liq) && ($ref_liq != '')) {
		        $this-> MAJ_ref_liq($reponse['id_dos'], $ref_liq);
		      }

		      if (isset($date_liq) && ($date_liq != '')) {
		        $this-> MAJ_date_liq($reponse['id_dos'], $date_liq);
		      }

		      if (isset($ref_quit) && ($ref_quit != '')) {
		        $this-> MAJ_ref_quit($reponse['id_dos'], $ref_quit);
		      }

		      if (isset($date_quit) && ($date_quit != '')) {
		        $this-> MAJ_date_quit($reponse['id_dos'], $date_quit);
		      }

		      if (isset($montant_decl) && ($montant_decl != '')) {
		        $this-> MAJ_montant_decl($reponse['id_dos'], $montant_decl);
		      }

		      if (isset($klsa_arriv) && ($klsa_arriv != '')) {
		        $this-> MAJ_klsa_arriv($reponse['id_dos'], $klsa_arriv);
		      }
		      
		      if (isset($crossing_date) && ($crossing_date != '')) {
		        $this-> MAJ_crossing_date($reponse['id_dos'], $crossing_date);
		      }
		      
		      if (isset($wiski_arriv) && ($wiski_arriv != '')) {
		        $this-> MAJ_wiski_arriv($reponse['id_dos'], $wiski_arriv);
		      }
		      
		      if (isset($wiski_dep) && ($wiski_dep != '')) {
		        $this-> MAJ_wiski_dep($reponse['id_dos'], $wiski_dep);
		      }
		      
		      if (isset($ref_crf) && ($ref_crf != '')) {
		        $this-> MAJ_ref_crf($reponse['id_dos'], $ref_crf);
		      }
		      
		      if (isset($date_crf) && ($date_crf != '')) {
		        $this-> MAJ_date_crf($reponse['id_dos'], $date_crf);
		      }
		      
		      if (isset($dgda_in) && ($dgda_in != '')) {
		        $this-> MAJ_dgda_in($reponse['id_dos'], $dgda_in);
		      }
		      
		      if (isset($dgda_out) && ($dgda_out != '')) {
		        $this-> MAJ_dgda_out($reponse['id_dos'], $dgda_out);
		      }

		      if (isset($date_preal) && ($date_preal != '')) {
		        $this-> MAJ_date_preal($reponse['id_dos'], $date_preal);
		      }

		      if (isset($custom_deliv) && ($custom_deliv != '')) {
		        $this-> MAJ_custom_deliv($reponse['id_dos'], $custom_deliv);
		      }
		      
		      if (isset($dispatch_klsa) && ($dispatch_klsa != '')) {
		        $this-> MAJ_dispatch_klsa($reponse['id_dos'], $dispatch_klsa);
		      }
		      
		      if (isset($dispatch_deliv) && ($dispatch_deliv != '')) {
		        $this-> MAJ_dispatch_deliv($reponse['id_dos'], $dispatch_deliv);
		      }
		      
		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($statut) && ($statut != '')) {
		        $this-> MAJ_statut($reponse['id_dos'], $statut);
		      }

		      if (isset($remarque) && ($remarque != '')) {
		        $this-> MAJ_remarque($reponse['id_dos'], $remarque);
		      }

		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($amicongo_arriv) && ($amicongo_arriv != '')) {
		        $this-> MAJ_amicongo_arriv($reponse['id_dos'], $amicongo_arriv);
		      }

		      if (isset($insp_receiv) && ($insp_receiv != '')) {
		        $this-> MAJ_insp_receiv($reponse['id_dos'], $insp_receiv);
		      }

		      if (isset($ir) && ($ir != '')) {
		        $this-> MAJ_ir($reponse['id_dos'], $ir);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		      	//echo "<br> $ref_decl";
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

			}

		} 

		public function updateMultipleFilesExport($debut, $fin, $id_cli, $id_mod_trans, $id_mod_lic){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) { 
				# code...
			}*/

			$sql1 = "";
			/*if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}*/
			$method = '';
			$increment = 0;
			$maj = 'MAJ_';
			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.cleared = '0'
													AND d.ref_dos BETWEEN ? AND ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], 
									$entree['debut'], $entree['fin']));
			
			while($reponse = $requete-> fetch()){
				$increment = 0;
				foreach ($this->getNameRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans']) as $champCol) {

				  if (isset($_POST[$champCol]) && ($_POST[$champCol] != '')) {
				  	$maj = 'MAJ_'.$champCol;
				  	//echo '<br>-------------------'.$champCol.' = '.$_POST[$champCol];
			        //$this-> $maj($reponse['id_dos'], $this-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment]);
			        $this-> $maj($reponse['id_dos'], $_POST[$champCol]);
			      }
			      
			        //echo '<br>----------------------------'.$champCol.' = '.$maClasse-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment];
			        $increment++;
		      	}

		      /*if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }*/
			}

		} 

		public function updateFile($id_dos, $id_cli, $id_mod_trans, $id_mod_lic){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_dos'] = $id_dos;

			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> num_lic_old = '.$num_lic_old;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, $id_dos, $fin);

			for ($i=1; $i <= $nbre ; $i++) { 
				# code...
			}*/

			$sql1 = "";
			/*if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}*/
			$method = '';
			$increment = 0;
			$maj = 'MAJ_';
			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND cl.id_cli = ?
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.id_dos = ?
													$sql1
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_cli'], $entree['id_mod_trans'], $entree['id_mod_lic'], 
									$entree['id_dos']));
			
			while($reponse = $requete-> fetch()){
				$increment = 0;
				foreach ($this->getNameRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans']) as $champCol) {

				  if (isset($_POST[$champCol]) && ($_POST[$champCol] != '')) {
				  	$maj = 'MAJ_'.$champCol;

				  	$this-> $maj($reponse['id_dos'], $this-> getRowUpdate2($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment]);
				  	
			        //$this-> $maj($reponse['id_dos'], $this-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment]);
			      }else{

				  		$requeteUpdate = $connexion-> prepare("UPDATE dossier SET $champCol = NULL WHERE id_dos = ?");
				  		$requeteUpdate-> execute(array($entree['id_dos']));

			      }
			      
			        //echo '<br>----------------------------'.$champCol.' = '.$maClasse-> getRowUpdate($_GET['id_mod_trac'], $_GET['id_cli'], $_GET['id_mod_trans'])[$increment];
			        $increment++;
		      	}

		      /*if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }*/
			}

		} 

		public function updateMultipleFilesPopUp($debut, $fin, $klsa_arriv, 
			                                  $crossing_date, $wiski_arriv, $wiski_dep, 
			                                  $amicong_arriv, $insp_receiv, $ir, 
			                                  $ref_crf, $date_crf, $dgda_in, $ref_decl,
			                                  $ref_liq, $date_liq, $ref_quit, 
			                                  $date_quit, $dgda_out, $custom_deliv, $cleared, 
			                                  $dispatch_deliv, $statut, $remarque, 
			                                  $nbre, $id_cli, $id_mod_trans, $id_mod_lic, 
			                                  $commodity, $type){

			include('connexion.php');
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_trans'] = $id_mod_trans;
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['debut'] = $debut;
			$entree['fin'] = $fin;

			/*echo '<br> debut = '.$debut;
			echo '<br> fin = '.$fin;
			echo '<br> dgda_out = '.$dgda_out;
			echo '<br> type = '.$type;
			echo '<br> id_cli = '.$id_cli;
			echo '<br> date_val = '.$date_val;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> commodity = '.$commodity;
			echo '<br> fob = '.$fob;*/
			/*$nbre = $this-> getNombreDossierClientModeTransportModeLicenceUpdate($id_cli, $id_mod_trans, 
														$id_mod_lic, $commodity, $debut, $fin);

			for ($i=1; $i <= $nbre ; $i++) { 
				# code...
			}*/
			$sqlType = '';
			$sqlClient = '';

			if (isset($type) && ($type == 'TOTAL FILES')) {
				$sqlType = '';
			}

			if (isset($id_cli) && ($id_cli != '')) {
				$sqlClient = ' AND d.id_cli = '.$id_cli;
			}

			if (isset($type) && ($type == 'CLEARING COMPLETED')) {
				$sqlType = " AND d.cleared = '1'";
			}

			if (isset($type) && ($type == 'FILES IN PROCESS')) {
				$sqlType = " AND d.cleared = '0'";
			}

			if (isset($type) && ($type == 'CANCELLED')) {
				$sqlType = " AND d.cleared = '2'";
			}

			if (isset($type) && ($type == 'KASUMBALESA')) {
				$sqlType = " AND DATE(d.arrival_date) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'WISKI ARRIVAL')) {
				$sqlType = " AND DATE(d.wiski_arriv) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT WISKI')) {
				$sqlType = " AND (d.wiski_arriv IS NOT NULL AND d.wiski_arriv <> '')
												AND (d.wiski_dep IS NULL OR d.wiski_dep = '')";
			}

			if (isset($type) && ($type == 'WISKI DEPARTURE')) {
				$sqlType = " AND DATE(d.wiski_dep) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'AWAIT CRF')) {
				$sqlType = " AND (d.wiski_dep IS NOT NULL AND d.wiski_dep <> '')
												AND ( (d.date_crf IS NULL OR d.date_crf = '') AND (d.ref_crf IS NULL OR d.ref_crf = '' ))";
			}

			if (isset($type) && ($type == 'DGDA IN')) {
				$sqlType = " AND DATE(dgda_in) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'UNDER PROCESS AT DGDA')) {
				$sqlType = " AND (d.dgda_in IS NOT NULL AND d.dgda_in <> '')
												AND (d.dgda_out IS NULL OR d.dgda_out = '')";
			}

			if (isset($type) && ($type == 'LIQUIDATED / AWAIT QUITTANCE')) {
				$sqlType = " AND ( (d.date_liq IS NOT NULL OR d.date_liq <> '')
													OR (d.ref_liq IS NOT NULL OR d.ref_liq <> '') )
												AND ( (d.date_quit IS NULL AND d.date_quit = '') 
													AND (d.ref_quit IS NULL AND d.ref_quit = '') )";
			}

			if (isset($type) && ($type == 'QUITTANCE')) {
				$sqlType = " AND DATE(d.date_quit) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'DGDA OUT')) {
				$sqlType = " AND DATE(d.dgda_out) = CURRENT_DATE()";
			}

			if (isset($type) && ($type == 'FILES CLEARED WAITING INVOICE')) {
				$sqlType = " AND d.cleared = '1'
												AND d.facture = '0'";
			}

			$sql1 = "";
			if (isset($commodity) && ($commodity != '')) {
				$sql1 = ' AND d.commodity = "'.$commodity.'"';
			}

			$requete = $connexion-> prepare("SELECT d.id_dos AS id_dos, d.ref_dos AS ref_dos
												FROM dossier d, client cl, site s, mode_transport mt
												WHERE d.id_cli =  cl.id_cli
													AND d.id_site = s.id_site
													AND d.id_mod_trans = mt.id_mod_trans
													AND mt.id_mod_trans = ?
													AND d.id_mod_lic = ?
													AND d.ref_dos BETWEEN ? AND ?
													$sql1
													$sqlType
													$sqlClient
												ORDER BY d.ref_dos ASC");
			$requete-> execute(array($entree['id_mod_trans'], $entree['id_mod_lic'], 
									$entree['debut'], $entree['fin']));
			
			while($reponse = $requete-> fetch()){
				//echo $reponse['id_dos'].'<br>';
		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($date_decl) && ($date_decl != '')) {
		        $this-> MAJ_date_decl($reponse['id_dos'], $date_decl);
		      }

		      if (isset($ref_liq) && ($ref_liq != '')) {
		        $this-> MAJ_ref_liq($reponse['id_dos'], $ref_liq);
		      }

		      if (isset($date_liq) && ($date_liq != '')) {
		        $this-> MAJ_date_liq($reponse['id_dos'], $date_liq);
		      }

		      if (isset($ref_quit) && ($ref_quit != '')) {
		        $this-> MAJ_ref_quit($reponse['id_dos'], $ref_quit);
		      }

		      if (isset($date_quit) && ($date_quit != '')) {
		        $this-> MAJ_date_quit($reponse['id_dos'], $date_quit);
		      }

		      if (isset($montant_decl) && ($montant_decl != '')) {
		        $this-> MAJ_montant_decl($reponse['id_dos'], $montant_decl);
		      }

		      if (isset($klsa_arriv) && ($klsa_arriv != '')) {
		        $this-> MAJ_klsa_arriv($reponse['id_dos'], $klsa_arriv);
		      }
		      
		      if (isset($crossing_date) && ($crossing_date != '')) {
		        $this-> MAJ_crossing_date($reponse['id_dos'], $crossing_date);
		      }
		      
		      if (isset($wiski_arriv) && ($wiski_arriv != '')) {
		        $this-> MAJ_wiski_arriv($reponse['id_dos'], $wiski_arriv);
		      }
		      
		      if (isset($wiski_dep) && ($wiski_dep != '')) {
		        $this-> MAJ_wiski_dep($reponse['id_dos'], $wiski_dep);
		      }
		      
		      if (isset($ref_crf) && ($ref_crf != '')) {
		        $this-> MAJ_ref_crf($reponse['id_dos'], $ref_crf);
		      }
		      
		      if (isset($date_crf) && ($date_crf != '')) {
		        $this-> MAJ_date_crf($reponse['id_dos'], $date_crf);
		      }
		      
		      if (isset($dgda_in) && ($dgda_in != '')) {
		        $this-> MAJ_dgda_in($reponse['id_dos'], $dgda_in);
		      }
		      
		      if (isset($dgda_out) && ($dgda_out != '')) {
		        $this-> MAJ_dgda_out($reponse['id_dos'], $dgda_out);
		      	//echo "<br> $dgda_out";
		      }

		      if (isset($date_preal) && ($date_preal != '')) {
		        $this-> MAJ_date_preal($reponse['id_dos'], $date_preal);
		      }

		      if (isset($custom_deliv) && ($custom_deliv != '')) {
		        $this-> MAJ_custom_deliv($reponse['id_dos'], $custom_deliv);
		      }
		      
		      if (isset($dispatch_klsa) && ($dispatch_klsa != '')) {
		        $this-> MAJ_dispatch_klsa($reponse['id_dos'], $dispatch_klsa);
		      }
		      
		      if (isset($dispatch_deliv) && ($dispatch_deliv != '')) {
		        $this-> MAJ_dispatch_deliv($reponse['id_dos'], $dispatch_deliv);
		      }
		      
		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($statut) && ($statut != '')) {
		        $this-> MAJ_statut($reponse['id_dos'], $statut);
		      }

		      if (isset($remarque) && ($remarque != '')) {
		        $this-> MAJ_remarque($reponse['id_dos'], $remarque);
		      }

		      if (isset($cleared) && ($cleared != '')) {
		        $this-> MAJ_cleared($reponse['id_dos'], $cleared);
		      }

		      if (isset($amicongo_arriv) && ($amicongo_arriv != '')) {
		        $this-> MAJ_amicongo_arriv($reponse['id_dos'], $amicongo_arriv);
		      }

		      if (isset($insp_receiv) && ($insp_receiv != '')) {
		        $this-> MAJ_insp_receiv($reponse['id_dos'], $insp_receiv);
		      }

		      if (isset($ir) && ($ir != '')) {
		        $this-> MAJ_ir($reponse['id_dos'], $ir);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		      	//echo "<br> $ref_decl";
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

		      if (isset($ref_decl) && ($ref_decl != '')) {
		        $this-> MAJ_ref_decl($reponse['id_dos'], $ref_decl);
		      }

			}$requete-> closeCursor();

		} 

		public function modifierFacture($ref_fact, $date_fact, $date_fact_rec, $fournisseur, $date_val, 
										$id_cli, $commodity, $montant_fact, $id_mon, $fret_fact, $assurance_fact, 
										$autre_frais_fact, $ref_fact_old, $fsi, $aur){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['date_fact'] = $date_fact;
			$entree['date_fact_rec'] = $date_fact_rec;
			$entree['fournisseur'] = $fournisseur;
			$entree['date_val'] = $date_val;
			$entree['id_cli'] = $id_cli;
			$entree['commodity'] = $commodity;
			$entree['montant_fact'] = $montant_fact;
			$entree['id_mon'] = $id_mon;
			$entree['fret_fact'] = $fret_fact;
			$entree['assurance_fact'] = $assurance_fact;
			$entree['autre_frais_fact'] = $autre_frais_fact;
			$entree['ref_fact_old'] = $ref_fact_old;
			$entree['aur'] = $aur;
			$entree['fsi'] = $fsi;


			if ($fret_fact == '') {
				$fret_fact = NULL;
			}
			if ($assurance_fact == '') {
				$assurance_fact = NULL;
			}
			if ($autre_frais_fact == '') {
				$autre_frais_fact = NULL;
			}
			if ($montant_fact == '') {
				$montant_fact = NULL;
			}
			/*echo '<br> ref_fact = '.$ref_fact;
			echo '<br> date_fact = '.$date_fact;
			echo '<br> date_fact_rec = '.$date_fact_rec;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> date_val = '.$date_val;
			echo '<br> id_cli = '.$id_cli;
			echo '<br> commodity = '.$commodity;
			echo '<br> montant_fact = '.$montant_fact;
			echo '<br> id_mon = '.$id_mon;
			echo '<br> fret_fact = '.$fret_fact;
			echo '<br> assurance_fact = '.$assurance_fact;
			echo '<br> autre_frais_fact = '.$autre_frais_fact;
			echo '<br> ref_fact_old = '.$ref_fact_old;*/

			$requete = $connexion-> prepare("UPDATE facture_licence 
														SET ref_fact = ?, date_fact = ?, date_fact_rec = ?, 
															fournisseur = ?, date_val = ?, id_cli = ?, 
															commodity = ?, montant_fact = ?, id_mon = ?, 
															fret_fact = ?, assurance_fact = ?, 
															fsi = ?, aur = ?, autre_frais_fact = ? 	
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['date_fact'], $entree['date_fact_rec'], 
									$entree['fournisseur'], $entree['date_val'], $entree['id_cli'], 
									$entree['commodity'], $entree['montant_fact'], $entree['id_mon'], 
									$entree['fret_fact'], $entree['assurance_fact'],
									$entree['fsi'], $entree['aur'], $entree['autre_frais_fact'], 
									$entree['ref_fact_old']));

		} 

		public function modifierFichierFacture($ref_fact, $fichier_fact, $tmp_fact){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['fichier_fact'] = $fichier_fact;
			/*echo '<br> ref_fact = '.$ref_fact;
			echo '<br> date_fact = '.$date_fact;
			echo '<br> date_fact_rec = '.$date_fact_rec;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> date_val = '.$date_val;
			echo '<br> id_cli = '.$id_cli;
			echo '<br> commodity = '.$commodity;
			echo '<br> montant_fact = '.$montant_fact;
			echo '<br> id_mon = '.$id_mon;
			echo '<br> fret_fact = '.$fret_fact;
			echo '<br> assurance_fact = '.$assurance_fact;
			echo '<br> autre_frais_fact = '.$autre_frais_fact;
			echo '<br> ref_fact_old = '.$ref_fact_old;*/

			$requete = $connexion-> prepare("UPDATE facture_licence 
														SET fichier_fact = ?	
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['fichier_fact'], $entree['ref_fact']));

			$facture = '../factures/'.$ref_fact;

			if(!is_dir($facture)){
				mkdir("../factures/$ref_fact", 0777);
			}

			move_uploaded_file($tmp_fact, '../factures/'.$ref_fact.'/' . basename($fichier_fact));

		} 

		public function modifierFichierLicence($num_lic, $fichier_lic, $tmp){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['fichier_lic'] = $fichier_lic;
			/*echo '<br> num_lic = '.$num_lic;
			echo '<br> date_fact = '.$date_fact;
			echo '<br> date_fact_rec = '.$date_fact_rec;
			echo '<br> fournisseur = '.$fournisseur;
			echo '<br> date_val = '.$date_val;
			echo '<br> id_cli = '.$id_cli;
			echo '<br> commodity = '.$commodity;
			echo '<br> montant_fact = '.$montant_fact;
			echo '<br> id_mon = '.$id_mon;
			echo '<br> fret_fact = '.$fret_fact;
			echo '<br> assurance_fact = '.$assurance_fact;
			echo '<br> autre_frais_fact = '.$autre_frais_fact;
			echo '<br> num_lic_old = '.$num_lic_old;*/

			$requete = $connexion-> prepare("UPDATE licence 
														SET fichier_lic = ?	
												WHERE num_lic = ?");
			$requete-> execute(array($entree['fichier_lic'], $entree['num_lic']));

			$dossier = '../dossiers/'.$num_lic;

			if(!is_dir($dossier)){
				mkdir("../dossiers/$num_lic", 0777);
			}

			move_uploaded_file($tmp, '../dossiers/'.$num_lic.'/' . basename($fichier_lic));

		} 

		public function annulerDateExpirationLicence($num_lic){

			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$requete = $connexion-> prepare("UPDATE expiration_licence SET id_etat = '2'
												WHERE num_lic = ?");
			$requete-> execute(array($entree['num_lic']));

		} 

		public function MAJ_ref_dos($id_dos, $ref_dos){

			//Log
			if ($this-> getDossier($id_dos)['ref_dos'] != $ref_dos) {
				
				$colonne = $this-> getNomColonneClient('ref_dos', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_dos, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_dos'] = $ref_dos;
			$requete = $connexion-> prepare("UPDATE dossier SET ref_dos = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_dos'], $entree['id_dos']));

		} 

		public function MAJ_id_front($id_dos, $id_front){

			//Log
			if ($this-> getDossier($id_dos)['id_front'] != $id_front) {
				
				$colonne = $this-> getNomColonneClient('id_front', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $id_front, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_front'] = $id_front;
			$requete = $connexion-> prepare("UPDATE dossier SET id_front = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_front'], $entree['id_dos']));

		} 

		public function MAJ_support_doc($id_dos, $support_doc){

			//Log
			if ($this-> getDossier($id_dos)['support_doc'] != $support_doc) {
				
				// $colonne = $this-> getNomColonneClient('support_doc', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier('Support Documents', $support_doc, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['support_doc'] = $support_doc;
			$requete = $connexion-> prepare("UPDATE dossier SET support_doc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['support_doc'], $entree['id_dos']));

		} 

		public function MAJ_id_reg($id_dos, $id_reg){

			//Log
			if ($this-> getDossier($id_dos)['id_reg'] != $id_reg) {
				
				$colonne = $this-> getNomColonneClient('id_reg', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $id_reg, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_reg'] = $id_reg;
			$requete = $connexion-> prepare("UPDATE dossier SET id_reg = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_reg'], $entree['id_dos']));

		} 

		public function MAJ_not_fact($id_dos, $not_fact){

			//Log
			if ($this-> getDossier($id_dos)['not_fact'] != $not_fact) {
				
				// $colonne = $this-> getNomColonneClient('not_fact', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier('Facturation', $not_fact, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['not_fact'] = $not_fact;
			$requete = $connexion-> prepare("UPDATE dossier SET not_fact = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['not_fact'], $entree['id_dos']));

		} 

		public function MAJ_roe_decl($id_dos, $roe_decl){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['roe_decl'] = $roe_decl;

			//Log
			if ($this-> getDossier($id_dos)['roe_decl'] != $roe_decl) {
				
				$this-> creerLogDossier('ROE Decl', $roe_decl, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET roe_decl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['roe_decl'], $entree['id_dos']));

		}

		public function MAJ_id_bank_liq($id_dos, $id_bank_liq){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_bank_liq'] = $id_bank_liq;

			//Log
			if ($this-> getDossier($id_dos)['id_bank_liq'] != $id_bank_liq) {
				
				$this-> creerLogDossier('Bank Liq', $id_bank_liq, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET id_bank_liq = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_bank_liq'], $entree['id_dos']));

		}

		public function MAJ_roe_liq($id_dos, $roe_liq){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['roe_liq'] = $roe_liq;

			//Log
			if ($this-> getDossier($id_dos)['roe_liq'] != $roe_liq) {
				
				$this-> creerLogDossier('Roe Liq', $roe_liq, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET roe_liq = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['roe_liq'], $entree['id_dos']));

		}

		public function MAJ_roe_inv($id_dos, $roe_inv){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['roe_inv'] = $roe_inv;

			//Log
			if ($this-> getDossier($id_dos)['roe_inv'] != $roe_inv) {
				
				$this-> creerLogDossier('ROE INV', $roe_inv, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET roe_inv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['roe_inv'], $entree['id_dos']));

		}

		public function MAJ_montant_liq($id_dos, $montant_liq){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['montant_liq'] = $montant_liq;

			//Log
			if ($this-> getDossier($id_dos)['montant_liq'] != $montant_liq) {
				
				if (isset($_GET['id_mod_lic']) && ($_GET['id_mod_lic']!='') && (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '' )) {
					$_GET['id_mod_trac'] = $_GET['id_mod_lic'];
				}else if (!isset($_GET['id_mod_trac']) || $_GET['id_mod_trac'] == '') {
					$_GET['id_mod_trac'] = 1;
				}


				if (!isset($_GET['id_cli']) || ($_GET['id_cli']=='')) {
					$_GET['id_cli'] = 883;
				}

				if (!isset($_GET['id_mod_trans']) || ($_GET['id_mod_trans']=='')) {
					$_GET['id_mod_trans'] = 1;
				}
				
				$colonne = $this-> getNomColonneClient('montant_liq', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $montant_liq, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET montant_liq = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['montant_liq'], $entree['id_dos']));

		}

		public function MAJ_fob_usd($id_dos, $fob_usd){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fob_usd'] = $fob_usd;

			$requete = $connexion-> prepare("UPDATE dossier SET fob_usd = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fob_usd'], $entree['id_dos']));

		}

		public function MAJ_fret_usd($id_dos, $fret_usd){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fret_usd'] = $fret_usd;

			$requete = $connexion-> prepare("UPDATE dossier SET fret_usd = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fret_usd'], $entree['id_dos']));

		}

		public function MAJ_autre_frais_usd($id_dos, $autre_frais_usd){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['autre_frais_usd'] = $autre_frais_usd;

			$requete = $connexion-> prepare("UPDATE dossier SET autre_frais_usd = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['autre_frais_usd'], $entree['id_dos']));

		}

		public function MAJ_code_tarif($id_dos, $code_tarif){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['code_tarif'] = $code_tarif;

			$requete = $connexion-> prepare("UPDATE dossier SET code_tarif = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['code_tarif'], $entree['id_dos']));

		}

		public function MAJ_num_exo($id_dos, $num_exo){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['num_exo'] = $num_exo;

			$requete = $connexion-> prepare("UPDATE dossier SET num_exo = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['num_exo'], $entree['id_dos']));

		}

		public function MAJ_id_mon_fob($id_dos, $id_mon_fob){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_mon_fob'] = $id_mon_fob;

			$requete = $connexion-> prepare("UPDATE dossier SET id_mon_fob = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_mon_fob'], $entree['id_dos']));

		}

		public function MAJ_id_mon_fret($id_dos, $id_mon_fret){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_mon_fret'] = $id_mon_fret;

			$requete = $connexion-> prepare("UPDATE dossier SET id_mon_fret = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_mon_fret'], $entree['id_dos']));

		}

		public function MAJ_id_mon_assurance($id_dos, $id_mon_assurance){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_mon_assurance'] = $id_mon_assurance;

			$requete = $connexion-> prepare("UPDATE dossier SET id_mon_assurance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_mon_assurance'], $entree['id_dos']));

		}

		public function MAJ_id_mon_autre_frais($id_dos, $id_mon_autre_frais){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['id_mon_autre_frais'] = $id_mon_autre_frais;

			$requete = $connexion-> prepare("UPDATE dossier SET id_mon_autre_frais = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_mon_autre_frais'], $entree['id_dos']));

		}

		public function MAJ_assurance_usd($id_dos, $assurance_usd){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['assurance_usd'] = $assurance_usd;

			$requete = $connexion-> prepare("UPDATE dossier SET assurance_usd = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['assurance_usd'], $entree['id_dos']));

		}


		public function MAJ_temporelle($id_dos, $temporelle){

			//Log
			if ($this-> getDossier($id_dos)['temporelle'] != $temporelle) {
				
				$colonne = $this-> getNomColonneClient('temporelle', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $temporelle, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['temporelle'] = $temporelle;
			$requete = $connexion-> prepare("UPDATE dossier SET temporelle = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['temporelle'], $entree['id_dos']));

		} 

		public function MAJ_warehouse_arriv($id_dos, $warehouse_arriv){

			//Log
			if ($this-> getDossier($id_dos)['warehouse_arriv'] != $warehouse_arriv) {
				
				$colonne = $this-> getNomColonneClient('warehouse_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $warehouse_arriv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['warehouse_arriv'] = $warehouse_arriv;
			$requete = $connexion-> prepare("UPDATE dossier SET warehouse_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['warehouse_arriv'], $entree['id_dos']));

		} 

		public function MAJ_warehouse_dep($id_dos, $warehouse_dep){

			//Log
			if ($this-> getDossier($id_dos)['warehouse_dep'] != $warehouse_dep) {
				
				$colonne = $this-> getNomColonneClient('warehouse_dep', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $warehouse_dep, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['warehouse_dep'] = $warehouse_dep;
			$requete = $connexion-> prepare("UPDATE dossier SET warehouse_dep = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['warehouse_dep'], $entree['id_dos']));

		} 

		public function MAJ_mca_b_ref($id_dos, $mca_b_ref){

			//Log
			if ($this-> getDossier($id_dos)['mca_b_ref'] != $mca_b_ref) {
				
				$colonne = $this-> getNomColonneClient('mca_b_ref', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $mca_b_ref, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['mca_b_ref'] = $mca_b_ref;
			$requete = $connexion-> prepare("UPDATE dossier SET mca_b_ref = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['mca_b_ref'], $entree['id_dos']));

		} 

		public function MAJ_regime($id_dos, $regime){

			//Log
			if ($this-> getDossier($id_dos)['regime'] != $regime) {
				
				$colonne = $this-> getNomColonneClient('regime', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $regime, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['regime'] = $regime;
			$requete = $connexion-> prepare("UPDATE dossier SET regime = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['regime'], $entree['id_dos']));

		} 

		public function MAJ_ref_decl($id_dos, $ref_decl){

			//Log
			if ($this-> getDossier($id_dos)['ref_decl'] != $ref_decl) {
				
				$colonne = $this-> getNomColonneClient('ref_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_decl, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_decl'] = $ref_decl;
			$requete = $connexion-> prepare("UPDATE dossier SET ref_decl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_decl'], $entree['id_dos']));

		} 

		public function MAJ_date_decl($id_dos, $date_decl){
			
			//Log
			if ($this-> getDossier($id_dos)['date_decl'] != $date_decl) {
				
				$colonne = $this-> getNomColonneClient('date_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_decl, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_decl'] = $date_decl;
			$requete = $connexion-> prepare("UPDATE dossier SET date_decl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_decl'], $entree['id_dos']));

		} 

		public function MAJ_ref_liq($id_dos, $ref_liq){
			
			//Log
			if ($this-> getDossier($id_dos)['ref_liq'] != $ref_liq) {
				
				$colonne = $this-> getNomColonneClient('ref_liq', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_liq, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_liq'] = $ref_liq;
			$requete = $connexion-> prepare("UPDATE dossier SET ref_liq = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_liq'], $entree['id_dos']));

		} 

		public function MAJ_date_liq($id_dos, $date_liq){
			
			//Log
			if ($this-> getDossier($id_dos)['date_liq'] != $date_liq) {
				
				$colonne = $this-> getNomColonneClient('date_liq', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_liq, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_liq'] = $date_liq;
			$requete = $connexion-> prepare("UPDATE dossier SET date_liq = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_liq'], $entree['id_dos']));

		} 

		public function MAJ_ref_quit($id_dos, $ref_quit){
			
			//Log
			if ($this-> getDossier($id_dos)['ref_quit'] != $ref_quit) {
				
				$colonne = $this-> getNomColonneClient('ref_quit', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_quit, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_quit'] = $ref_quit;
			$requete = $connexion-> prepare("UPDATE dossier SET ref_quit = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_quit'], $entree['id_dos']));

		} 

		public function MAJ_date_quit($id_dos, $date_quit){
			
			//Log
			if ($this-> getDossier($id_dos)['date_quit'] != $date_quit) {
				
				$colonne = $this-> getNomColonneClient('date_quit', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_quit, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_quit'] = $date_quit;
			$requete = $connexion-> prepare("UPDATE dossier SET date_quit = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_quit'], $entree['id_dos']));

		} 

		public function MAJ_montant_decl($id_dos, $montant_decl){
			
			//Log
			if ($this-> getDossier($id_dos)['montant_decl'] != $montant_decl) {
				
				$colonne = $this-> getNomColonneClient('montant_decl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $montant_decl, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['montant_decl'] = $montant_decl;
			$requete = $connexion-> prepare("UPDATE dossier SET montant_decl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['montant_decl'], $entree['id_dos']));

		} 

		public function MAJ_ref_assurance($id_dos, $ref_assurance){
			
			//Log
			if ($this-> getDossier($id_dos)['ref_assurance'] != $ref_assurance) {
				
				// $colonne = $this-> getNomColonneClient('ref_assurance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier('ref_assurance', $ref_assurance, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_assurance'] = $ref_assurance;
			$requete = $connexion-> prepare("UPDATE dossier SET ref_assurance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_assurance'], $entree['id_dos']));

		} 

		public function MAJ_type_apurement($id_dos, $type_apurement){
			
			//Log
			if ($this-> getDossier($id_dos)['type_apurement'] != $type_apurement) {
				
				// $colonne = $this-> getNomColonneClient('type_apurement', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier('type_apurement', $type_apurement, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['type_apurement'] = $type_apurement;
			$requete = $connexion-> prepare("UPDATE dossier SET type_apurement = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['type_apurement'], $entree['id_dos']));

		} 

		public function MAJ_remarque_apurement($id_dos, $remarque_apurement){
			
			//Log
			if ($this-> getDossier($id_dos)['remarque_apurement'] != $remarque_apurement) {
				
				// $colonne = $this-> getNomColonneClient('remarque_apurement', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier('remarque_apurement', $remarque_apurement, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['remarque_apurement'] = $remarque_apurement;
			$requete = $connexion-> prepare("UPDATE dossier SET remarque_apurement = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['remarque_apurement'], $entree['id_dos']));

		} 

		public function MAJ_cod($id_dos, $cod){

			//Log
			if ($this-> getDossier($id_dos)['cod'] != $cod) {
				
				$colonne = $this-> getNomColonneClient('cod', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $cod, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['cod'] = $cod;
			$requete = $connexion-> prepare("UPDATE dossier SET cod = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['cod'], $entree['id_dos']));
			$requete = $connexion-> prepare("UPDATE dossier SET ref_crf = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['cod'], $entree['id_dos']));

		} 

		public function MAJ_codAllDossier($ref_crf, $cod){

			include('connexion.php');
			$entree['ref_crf'] = $ref_crf;
			$entree['cod'] = $cod;

			$requete = $connexion-> prepare("UPDATE dossier SET cod = ?, montant_av = fob, fxi = ?
												WHERE ref_crf = ?");
			$requete-> execute(array($entree['cod'], $this-> getDataAv($cod)['fxi'], $entree['ref_crf']));

		} 

		public function MAJ_fxi($id_dos, $fxi){
			
			//Log
			if ($this-> getDossier($id_dos)['fxi'] != $fxi) {
				
				$colonne = $this-> getNomColonneClient('fxi', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fxi, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fxi'] = $fxi;
			$requete = $connexion-> prepare("UPDATE dossier SET fxi = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fxi'], $entree['id_dos']));

		} 

		public function MAJ_montant_av($id_dos, $montant_av){

			//Log
			if ($this-> getDossier($id_dos)['montant_av'] != $montant_av) {
				
				$colonne = $this-> getNomColonneClient('montant_av', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $montant_av, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['montant_av'] = $montant_av;
			$requete = $connexion-> prepare("UPDATE dossier SET montant_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['montant_av'], $entree['id_dos']));

		} 

		public function MAJ_ref_av($id_dos, $ref_av){

			//Log
			if ($this-> getDossier($id_dos)['ref_av'] != $ref_av) {
				
				$colonne = $this-> getNomColonneClient('ref_av', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_av, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_av'] = $ref_av;
			$requete = $connexion-> prepare("UPDATE dossier SET ref_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_av'], $entree['id_dos']));

		} 

		public function MAJ_fret_dos($id_dos, $fret){
			
			//Log
			if ($this-> getDossier($id_dos)['fret'] != $fret) {
				
				$colonne = $this-> getNomColonneClient('fret', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fret, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fret'] = $fret;
			$requete = $connexion-> prepare("UPDATE dossier SET fret = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fret'], $entree['id_dos']));

		} 

		public function MAJ_assurance_dos($id_dos, $assurance){
			
			//Log
			if ($this-> getDossier($id_dos)['assurance'] != $assurance) {
				
				$colonne = $this-> getNomColonneClient('assurance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $assurance, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['assurance'] = $assurance;
			$requete = $connexion-> prepare("UPDATE dossier SET assurance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['assurance'], $entree['id_dos']));

		} 

		public function MAJ_autre_frais_dos($id_dos, $autre_frais){
			
			//Log
			if ($this-> getDossier($id_dos)['autre_frais'] != $autre_frais) {
				
				$colonne = $this-> getNomColonneClient('autre_frais', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $autre_frais, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['autre_frais'] = $autre_frais;
			$requete = $connexion-> prepare("UPDATE dossier SET autre_frais = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['autre_frais'], $entree['id_dos']));

		} 

		public function MAJ_t1($id_dos, $t1){
			
			//Log
			if ($this-> getDossier($id_dos)['t1'] != $t1) {
				
				$colonne = $this-> getNomColonneClient('t1', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $t1, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['t1'] = $t1;
			$requete = $connexion-> prepare("UPDATE dossier SET t1 = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['t1'], $entree['id_dos']));

		}  

		public function MAJ_poids($id_dos, $poids){
			
			//Log
			if ($this-> getDossier($id_dos)['poids'] != $poids) {
				
				$colonne = $this-> getNomColonneClient('poids', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $poids, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['poids'] = $poids;
			$requete = $connexion-> prepare("UPDATE dossier SET poids = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['poids'], $entree['id_dos']));

		}  

		public function MAJ_horse($id_dos, $horse){
			
			//Log
			if ($this-> getDossier($id_dos)['horse'] != $horse) {
				
				$colonne = $this-> getNomColonneClient('horse', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $horse, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['horse'] = $horse;
			$requete = $connexion-> prepare("UPDATE dossier SET horse = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['horse'], $entree['id_dos']));

		}  

		public function MAJ_trailer_1($id_dos, $trailer_1){
			
			//Log
			if ($this-> getDossier($id_dos)['trailer_1'] != $trailer_1) {
				
				$colonne = $this-> getNomColonneClient('trailer_1', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $trailer_1, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['trailer_1'] = $trailer_1;
			$requete = $connexion-> prepare("UPDATE dossier SET trailer_1 = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['trailer_1'], $entree['id_dos']));

		}  

		public function MAJ_trailer_2($id_dos, $trailer_2){
			
			//Log
			if ($this-> getDossier($id_dos)['trailer_2'] != $trailer_2) {
				
				$colonne = $this-> getNomColonneClient('trailer_2', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $trailer_2, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['trailer_2'] = $trailer_2;
			$requete = $connexion-> prepare("UPDATE dossier SET trailer_2 = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['trailer_2'], $entree['id_dos']));

		}  

		public function MAJ_pied_container($id_dos, $pied_container){
			
			//Log
			if ($this-> getDossier($id_dos)['pied_container'] != $pied_container) {
				
				$colonne = $this-> getNomColonneClient('pied_container', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $pied_container, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['pied_container'] = $pied_container;
			$requete = $connexion-> prepare("UPDATE dossier SET pied_container = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['pied_container'], $entree['id_dos']));

		}  

		public function MAJ_container($id_dos, $container){
			
			//Log
			if ($this-> getDossier($id_dos)['container'] != $container) {
				
				$colonne = $this-> getNomColonneClient('container', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $container, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['container'] = $container;
			$requete = $connexion-> prepare("UPDATE dossier SET container = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['container'], $entree['id_dos']));

		}  

		public function MAJ_klsa_arriv($id_dos, $klsa_arriv){
			
			//Log
			if ($this-> getDossier($id_dos)['klsa_arriv'] != $klsa_arriv) {
				
				$colonne = $this-> getNomColonneClient('klsa_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $klsa_arriv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['klsa_arriv'] = $klsa_arriv;
			$requete = $connexion-> prepare("UPDATE dossier SET klsa_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['klsa_arriv'], $entree['id_dos']));

		}  

		public function MAJ_crossing_date($id_dos, $crossing_date){
			
			//Log
			if ($this-> getDossier($id_dos)['crossing_date'] != $crossing_date) {
				
				$colonne = $this-> getNomColonneClient('crossing_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $crossing_date, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['crossing_date'] = $crossing_date;
			$requete = $connexion-> prepare("UPDATE dossier SET crossing_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['crossing_date'], $entree['id_dos']));

		}  

		public function MAJ_wiski_arriv($id_dos, $wiski_arriv){
			
			//Log
			if ($this-> getDossier($id_dos)['wiski_arriv'] != $wiski_arriv) {
				
				$colonne = $this-> getNomColonneClient('wiski_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $wiski_arriv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['wiski_arriv'] = $wiski_arriv;
			$requete = $connexion-> prepare("UPDATE dossier SET wiski_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['wiski_arriv'], $entree['id_dos']));

		}  

		public function MAJ_wiski_dep($id_dos, $wiski_dep){
			
			//Log
			if ($this-> getDossier($id_dos)['wiski_dep'] != $wiski_dep) {
				
				$colonne = $this-> getNomColonneClient('wiski_dep', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $wiski_dep, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['wiski_dep'] = $wiski_dep;
			$requete = $connexion-> prepare("UPDATE dossier SET wiski_dep = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['wiski_dep'], $entree['id_dos']));

		}  

		public function MAJ_ref_crf($id_dos, $ref_crf){
			
			//Log
			if ($this-> getDossier($id_dos)['ref_crf'] != $ref_crf) {
				
				$colonne = $this-> getNomColonneClient('ref_crf', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_crf, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_crf'] = $ref_crf;
			$requete = $connexion-> prepare("UPDATE dossier SET ref_crf = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_crf'], $entree['id_dos']));
			$requete = $connexion-> prepare("UPDATE dossier SET cod = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_crf'], $entree['id_dos']));

		}  

		public function MAJ_date_crf($id_dos, $date_crf){
			
			//Log
			if ($this-> getDossier($id_dos)['date_crf'] != $date_crf) {
				
				$colonne = $this-> getNomColonneClient('date_crf', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_crf, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_crf'] = $date_crf;
			$requete = $connexion-> prepare("UPDATE dossier SET date_crf  = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_crf'], $entree['id_dos']));

		}  

		public function MAJ_ir_crf($id_dos, $ir_crf){
			
			//Log
			if ($this-> getDossier($id_dos)['ir_crf'] != $ir_crf) {
				
				$colonne = $this-> getNomColonneClient('ir_crf', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ir_crf, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ir_crf'] = $ir_crf;
			$requete = $connexion-> prepare("UPDATE dossier SET ir_crf  = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ir_crf'], $entree['id_dos']));

		}  

		public function MAJ_date_ad($id_dos, $date_ad){
			
			//Log
			if ($this-> getDossier($id_dos)['date_ad'] != $date_ad) {
				
				$colonne = $this-> getNomColonneClient('date_ad', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_ad, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_ad'] = $date_ad;
			$requete = $connexion-> prepare("UPDATE dossier SET date_ad  = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_ad'], $entree['id_dos']));

		}  

		public function MAJ_date_assurance($id_dos, $date_assurance){
			
			//Log
			if ($this-> getDossier($id_dos)['date_assurance'] != $date_assurance) {
				
				$colonne = $this-> getNomColonneClient('date_assurance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_assurance, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_assurance'] = $date_assurance;
			$requete = $connexion-> prepare("UPDATE dossier SET date_assurance  = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_assurance'], $entree['id_dos']));

		}  

		public function MAJ_dgda_in($id_dos, $dgda_in){
			
			//Log
			if ($this-> getDossier($id_dos)['dgda_in'] != $dgda_in) {
				
				$colonne = $this-> getNomColonneClient('dgda_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dgda_in, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dgda_in'] = $dgda_in;
			$requete = $connexion-> prepare("UPDATE dossier SET dgda_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dgda_in'], $entree['id_dos']));

		}  

		public function MAJ_dgda_out($id_dos, $dgda_out){
			
			//Log
			if ($this-> getDossier($id_dos)['dgda_out'] != $dgda_out) {
				
				$colonne = $this-> getNomColonneClient('dgda_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dgda_out, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dgda_out'] = $dgda_out;
			$requete = $connexion-> prepare("UPDATE dossier SET dgda_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dgda_out'], $entree['id_dos']));

		}  

		public function MAJ_date_preal($id_dos, $date_preal){
			
			//Log
			if ($this-> getDossier($id_dos)['date_preal'] != $date_preal) {
				
				$colonne = $this-> getNomColonneClient('date_preal', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_preal, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_preal'] = $date_preal;
			$requete = $connexion-> prepare("UPDATE dossier SET date_preal = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_preal'], $entree['id_dos']));

		}

		public function MAJ_frontiere($id_dos, $frontiere){
			
			//Log
			if ($this-> getDossier($id_dos)['frontiere'] != $frontiere) {
				
				$colonne = $this-> getNomColonneClient('frontiere', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $frontiere, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['frontiere'] = $frontiere;
			$requete = $connexion-> prepare("UPDATE dossier SET frontiere = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['frontiere'], $entree['id_dos']));

		}

		public function MAJ_entrepot_frontiere($id_dos, $entrepot_frontiere){
			
			//Log
			if ($this-> getDossier($id_dos)['entrepot_frontiere'] != $entrepot_frontiere) {
				
				$colonne = $this-> getNomColonneClient('entrepot_frontiere', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $entrepot_frontiere, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['entrepot_frontiere'] = $entrepot_frontiere;
			$requete = $connexion-> prepare("UPDATE dossier SET entrepot_frontiere = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['entrepot_frontiere'], $entree['id_dos']));

		}

		public function MAJ_po_ref($id_dos, $po_ref){
			
			//Log
			if ($this-> getDossier($id_dos)['po_ref'] != $po_ref) {
				
				$colonne = $this-> getNomColonneClient('po_ref', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $po_ref, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['po_ref'] = $po_ref;
			$requete = $connexion-> prepare("UPDATE dossier SET po_ref = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['po_ref'], $entree['id_dos']));

		}
		
		public function MAJ_road_manif($id_dos, $road_manif){
			
			//Log
			if ($this-> getDossier($id_dos)['road_manif'] != $road_manif) {
				
				$colonne = $this-> getNomColonneClient('road_manif', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $road_manif, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['road_manif'] = $road_manif;
			$requete = $connexion-> prepare("UPDATE dossier SET road_manif = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['road_manif'], $entree['id_dos']));

		}
		
		public function MAJ_arr_bond($id_dos, $arr_bond){
			
			//Log
			if ($this-> getDossier($id_dos)['arr_bond'] != $arr_bond) {
				
				$colonne = $this-> getNomColonneClient('arr_bond', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $arr_bond, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['arr_bond'] = $arr_bond;
			$requete = $connexion-> prepare("UPDATE dossier SET arr_bond = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['arr_bond'], $entree['id_dos']));

		}
		
		public function MAJ_custom_deliv($id_dos, $custom_deliv){
			
			//Log
			if ($this-> getDossier($id_dos)['custom_deliv'] != $custom_deliv) {
				
				$colonne = $this-> getNomColonneClient('custom_deliv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $custom_deliv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['custom_deliv'] = $custom_deliv;
			$requete = $connexion-> prepare("UPDATE dossier SET custom_deliv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['custom_deliv'], $entree['id_dos']));

		}
		
		public function MAJ_lshi_arriv($id_dos, $lshi_arriv){
			
			//Log
			if ($this-> getDossier($id_dos)['lshi_arriv'] != $lshi_arriv) {
				
				$colonne = $this-> getNomColonneClient('lshi_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $lshi_arriv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['lshi_arriv'] = $lshi_arriv;
			$requete = $connexion-> prepare("UPDATE dossier SET lshi_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['lshi_arriv'], $entree['id_dos']));

		}
		
		public function MAJ_dispatch_klsa($id_dos, $dispatch_klsa){
			
			//Log
			if ($this-> getDossier($id_dos)['dispatch_klsa'] != $dispatch_klsa) {
				
				$colonne = $this-> getNomColonneClient('dispatch_klsa', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dispatch_klsa, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dispatch_klsa'] = $dispatch_klsa;
			$requete = $connexion-> prepare("UPDATE dossier SET dispatch_klsa = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dispatch_klsa'], $entree['id_dos']));

		}
		
		public function MAJ_dispatch_deliv($id_dos, $dispatch_deliv){
			
			//Log
			if ($this-> getDossier($id_dos)['dispatch_deliv'] != $dispatch_deliv) {
				
				$colonne = $this-> getNomColonneClient('dispatch_deliv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dispatch_deliv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dispatch_deliv'] = $dispatch_deliv;
			$requete = $connexion-> prepare("UPDATE dossier SET dispatch_deliv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dispatch_deliv'], $entree['id_dos']));

		}
		
		public function MAJ_arrival_date($id_dos, $arrival_date){
			
			//Log
			if ($this-> getDossier($id_dos)['arrival_date'] != $arrival_date) {
				
				$colonne = $this-> getNomColonneClient('arrival_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $arrival_date, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['arrival_date'] = $arrival_date;
			$requete = $connexion-> prepare("UPDATE dossier SET arrival_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['arrival_date'], $entree['id_dos']));

		}

		public function MAJ_cleared($id_dos, $cleared){
			
			//Log
			if ($this-> getDossier($id_dos)['cleared'] != $cleared) {
				
				$colonne = $this-> getNomColonneClient('cleared', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $cleared, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['cleared'] = $cleared;
			$requete = $connexion-> prepare("UPDATE dossier SET cleared = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['cleared'], $entree['id_dos']));

			if ($this-> getDossier($id_dos)['cleared'] == '1') {
				
				$this-> MAJ_statut($id_dos, 'CLEARING COMPLETED');

			}
			
		}

		public function MAJ_cleared_is_null(){
			
			//Log

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['cleared'] = $cleared;
			$connexion-> exec("UPDATE dossier SET cleared = '0'
								WHERE cleared = '' OR cleared is null");
			
			
		}

		public function MAJ_ref_fact($id_dos, $ref_fact){
			
			//Log
			if ($this-> getDossier($id_dos)['ref_fact'] != $ref_fact) {
				
				$colonne = $this-> getNomColonneClient('ref_fact', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ref_fact, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;
			$requete = $connexion-> prepare("UPDATE dossier SET ref_fact = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['id_dos']));

		} 
		
		public function MAJ_fournisseur($id_dos, $fournisseur){
			
			//Log
			if ($this-> getDossier($id_dos)['fournisseur'] != $fournisseur) {
				
				$colonne = $this-> getNomColonneClient('fournisseur', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fournisseur, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fournisseur'] = $fournisseur;
			$requete = $connexion-> prepare("UPDATE dossier SET fournisseur = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fournisseur'], $entree['id_dos']));

		} 

		public function MAJ_commodity($id_dos, $commodity){
			
			//Log
			if ($this-> getDossier($id_dos)['commodity'] != $commodity) {
				
				$colonne = $this-> getNomColonneClient('commodity', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $commodity, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['commodity'] = $commodity;
			$requete = $connexion-> prepare("UPDATE dossier SET commodity = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['commodity'], $entree['id_dos']));

		} 

		public function MAJ_num_lic($id_dos, $num_lic){
			
			//Log
			if ($this-> getDossier($id_dos)['num_lic'] != $num_lic) {
				
				$colonne = $this-> getNomColonneClient('num_lic', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $num_lic, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['num_lic'] = $num_lic;
			$requete = $connexion-> prepare("UPDATE dossier SET num_lic = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['num_lic'], $entree['id_dos']));

		} 

		public function MAJ_amicongo_arriv($id_dos, $amicongo_arriv){
			
			//Log
			if ($this-> getDossier($id_dos)['amicongo_arriv'] != $amicongo_arriv) {
				
				$colonne = $this-> getNomColonneClient('amicongo_arriv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $amicongo_arriv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['amicongo_arriv'] = $amicongo_arriv;
			$requete = $connexion-> prepare("UPDATE dossier SET amicongo_arriv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['amicongo_arriv'], $entree['id_dos']));

		} 

		public function MAJ_insp_receiv($id_dos, $insp_receiv){
			
			//Log
			if ($this-> getDossier($id_dos)['insp_receiv'] != $insp_receiv) {
				
				$colonne = $this-> getNomColonneClient('insp_receiv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $insp_receiv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['insp_receiv'] = $insp_receiv;
			$requete = $connexion-> prepare("UPDATE dossier SET insp_receiv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['insp_receiv'], $entree['id_dos']));

		} 

		public function MAJ_ir($id_dos, $ir){
			
			//Log
			if ($this-> getDossier($id_dos)['ir'] != $ir) {
				
				$colonne = $this-> getNomColonneClient('ir', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ir, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ir'] = $ir;
			$requete = $connexion-> prepare("UPDATE dossier SET ir = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ir'], $entree['id_dos']));

		} 

		public function MAJ_regul_ir($id_dos, $regul_ir){
			
			//Log
			if ($this-> getDossier($id_dos)['regul_ir'] != $regul_ir) {
				
				$colonne = $this-> getNomColonneClient('regul_ir', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $regul_ir, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['regul_ir'] = $regul_ir;
			$requete = $connexion-> prepare("UPDATE dossier SET regul_ir = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['regul_ir'], $entree['id_dos']));

		} 

		public function MAJ_remarque($id_dos, $remarque){
			
			//Log
			if ($this-> getDossier($id_dos)['remarque'] != $remarque) {
				
				$colonne = $this-> getNomColonneClient('remarque', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $remarque, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['remarque'] = $remarque;
			$requete = $connexion-> prepare("UPDATE dossier SET remarque = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['remarque'], $entree['id_dos']));

		} 

		public function MAJ_statut($id_dos, $statut){
			
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['statut'] = $statut;

			//Log
			if ($this-> getDossier($id_dos)['statut'] != $statut) {
				
				$colonne = $this-> getNomColonneClient('statut', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $statut, $id_dos, $_SESSION['id_util']);

			}

			$requete = $connexion-> prepare("UPDATE dossier SET statut = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['statut'], $entree['id_dos']));

		} 

		public function MAJ_date_ext_temporelle($id_dos, $date_ext_temporelle){
			
			//Log
			if ($this-> getDossier($id_dos)['date_ext_temporelle'] != $date_ext_temporelle) {
				
				$colonne = $this-> getNomColonneClient('date_ext_temporelle', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $date_ext_temporelle, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['date_ext_temporelle'] = $date_ext_temporelle;
			$requete = $connexion-> prepare("UPDATE dossier SET date_ext_temporelle = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['date_ext_temporelle'], $entree['id_dos']));

		} 

		public function MAJ_fob($id_dos, $fob){
			
			//Log
			if ($this-> getDossier($id_dos)['fob'] != $fob) {
				
				$colonne = $this-> getNomColonneClient('fob', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fob, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fob'] = $fob;
			$requete = $connexion-> prepare("UPDATE dossier SET fob = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fob'], $entree['id_dos']));

		} 

		public function MAJ_fact_suiv_lic($num_lic, $fact_suiv_lic){
			
			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['fact_suiv_lic'] = $fact_suiv_lic;
			$requete = $connexion-> prepare("UPDATE licence SET fact_suiv_lic = ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['fact_suiv_lic'], $entree['num_lic']));

		} 

		public function MAJ_fret($id_dos, $fret){
			
			//Log
			if ($this-> getDossier($id_dos)['fret'] != $fret) {
				
				$colonne = $this-> getNomColonneClient('fret', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $fret, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['fret'] = $fret;
			$requete = $connexion-> prepare("UPDATE dossier SET fret = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['fret'], $entree['id_dos']));

		} 

		public function MAJ_assurance($id_dos, $assurance){
			
			//Log
			if ($this-> getDossier($id_dos)['assurance'] != $assurance) {
				
				$colonne = $this-> getNomColonneClient('assurance', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $assurance, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['assurance'] = $assurance;
			$requete = $connexion-> prepare("UPDATE dossier SET assurance = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['assurance'], $entree['id_dos']));

		} 

		public function MAJ_autre_frais($id_dos, $autre_frais){
			
			//Log
			if ($this-> getDossier($id_dos)['autre_frais'] != $autre_frais) {
				
				$colonne = $this-> getNomColonneClient('autre_frais', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $autre_frais, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['autre_frais'] = $autre_frais;
			$requete = $connexion-> prepare("UPDATE dossier SET autre_frais = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['autre_frais'], $entree['id_dos']));

		} 

		public function MAJ_supplier($id_dos, $supplier){
			
			//Log
			if ($this-> getDossier($id_dos)['supplier'] != $supplier) {
				
				$colonne = $this-> getNomColonneClient('supplier', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $supplier, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['supplier'] = $supplier;
			$requete = $connexion-> prepare("UPDATE dossier SET supplier = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['supplier'], $entree['id_dos']));

		} 

		public function MAJ_bl($id_dos, $bl){
			
			//Log
			if ($this-> getDossier($id_dos)['bl'] != $bl) {
				
				$colonne = $this-> getNomColonneClient('bl', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bl, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bl'] = $bl;
			$requete = $connexion-> prepare("UPDATE dossier SET bl = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bl'], $entree['id_dos']));

		} 

		public function MAJ_pv_mine($id_dos, $pv_mine){
			
			//Log
			if ($this-> getDossier($id_dos)['pv_mine'] != $pv_mine) {
				
				$colonne = $this-> getNomColonneClient('pv_mine', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $pv_mine, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['pv_mine'] = $pv_mine;
			$requete = $connexion-> prepare("UPDATE dossier SET pv_mine = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['pv_mine'], $entree['id_dos']));

		} 

		public function MAJ_transporter($id_dos, $transporter){
			
			//Log
			if ($this-> getDossier($id_dos)['transporter'] != $transporter) {
				
				$colonne = $this-> getNomColonneClient('transporter', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $transporter, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['transporter'] = $transporter;
			$requete = $connexion-> prepare("UPDATE dossier SET transporter = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['transporter'], $entree['id_dos']));

		} 
		public function MAJ_demande_attestation($id_dos, $demande_attestation){
			
			//Log
			if ($this-> getDossier($id_dos)['demande_attestation'] != $demande_attestation) {
				
				$colonne = $this-> getNomColonneClient('demande_attestation', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $demande_attestation, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['demande_attestation'] = $demande_attestation;
			$requete = $connexion-> prepare("UPDATE dossier SET demande_attestation = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['demande_attestation'], $entree['id_dos']));

		} 
		public function MAJ_assay_date($id_dos, $assay_date){
			
			//Log
			if ($this-> getDossier($id_dos)['assay_date'] != $assay_date) {
				
				$colonne = $this-> getNomColonneClient('assay_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $assay_date, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['assay_date'] = $assay_date;
			$requete = $connexion-> prepare("UPDATE dossier SET assay_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['assay_date'], $entree['id_dos']));

		} 
		public function MAJ_ceec_in($id_dos, $ceec_in){
			
			//Log
			if ($this-> getDossier($id_dos)['ceec_in'] != $ceec_in) {
				
				$colonne = $this-> getNomColonneClient('ceec_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ceec_in, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ceec_in'] = $ceec_in;
			$requete = $connexion-> prepare("UPDATE dossier SET ceec_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ceec_in'], $entree['id_dos']));

		} 
		public function MAJ_ceec_out($id_dos, $ceec_out){
			
			//Log
			if ($this-> getDossier($id_dos)['ceec_out'] != $ceec_out) {
				
				$colonne = $this-> getNomColonneClient('ceec_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ceec_out, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ceec_out'] = $ceec_out;
			$requete = $connexion-> prepare("UPDATE dossier SET ceec_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ceec_out'], $entree['id_dos']));

		} 
		public function MAJ_min_div_in($id_dos, $min_div_in){
			
			//Log
			if ($this-> getDossier($id_dos)['min_div_in'] != $min_div_in) {
				
				$colonne = $this-> getNomColonneClient('min_div_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $min_div_in, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['min_div_in'] = $min_div_in;
			$requete = $connexion-> prepare("UPDATE dossier SET min_div_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['min_div_in'], $entree['id_dos']));

		} 
		public function MAJ_min_div_out($id_dos, $min_div_out){
			
			//Log
			if ($this-> getDossier($id_dos)['min_div_out'] != $min_div_out) {
				
				$colonne = $this-> getNomColonneClient('min_div_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $min_div_out, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['min_div_out'] = $min_div_out;
			$requete = $connexion-> prepare("UPDATE dossier SET min_div_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['min_div_out'], $entree['id_dos']));

		} 
		public function MAJ_gov_in($id_dos, $gov_in){
			
			//Log
			if ($this-> getDossier($id_dos)['gov_in'] != $gov_in) {
				
				$colonne = $this-> getNomColonneClient('gov_in', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $gov_in, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['gov_in'] = $gov_in;
			$requete = $connexion-> prepare("UPDATE dossier SET gov_in = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['gov_in'], $entree['id_dos']));

		} 
		public function MAJ_gov_out($id_dos, $gov_out){
			
			//Log
			if ($this-> getDossier($id_dos)['gov_out'] != $gov_out) {
				
				$colonne = $this-> getNomColonneClient('gov_out', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $gov_out, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['gov_out'] = $gov_out;
			$requete = $connexion-> prepare("UPDATE dossier SET gov_out = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['gov_out'], $entree['id_dos']));

		} 
		public function MAJ_dispatch_date($id_dos, $dispatch_date){
			
			//Log
			if ($this-> getDossier($id_dos)['dispatch_date'] != $dispatch_date) {
				
				$colonne = $this-> getNomColonneClient('dispatch_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dispatch_date, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dispatch_date'] = $dispatch_date;
			$requete = $connexion-> prepare("UPDATE dossier SET dispatch_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dispatch_date'], $entree['id_dos']));

		} 
		public function MAJ_end_form($id_dos, $end_form){
			
			//Log
			if ($this-> getDossier($id_dos)['end_form'] != $end_form) {
				
				$colonne = $this-> getNomColonneClient('end_form', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $end_form, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['end_form'] = $end_form;
			$requete = $connexion-> prepare("UPDATE dossier SET end_form = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['end_form'], $entree['id_dos']));

		} 
		public function MAJ_exit_drc($id_dos, $exit_drc){
			
			//Log
			if ($this-> getDossier($id_dos)['exit_drc'] != $exit_drc) {
				
				$colonne = $this-> getNomColonneClient('exit_drc', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $exit_drc, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['exit_drc'] = $exit_drc;
			$requete = $connexion-> prepare("UPDATE dossier SET exit_drc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['exit_drc'], $entree['id_dos']));

		} 
		public function MAJ_site_load($id_dos, $site_load){
			
			//Log
			if ($this-> getDossier($id_dos)['site_load'] != $site_load) {
				
				$colonne = $this-> getNomColonneClient('site_load', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $site_load, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['site_load'] = $site_load;
			$requete = $connexion-> prepare("UPDATE dossier SET site_load = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['site_load'], $entree['id_dos']));

		} 
		public function MAJ_num_lot($id_dos, $num_lot){
			
			//Log
			if ($this-> getDossier($id_dos)['num_lot'] != $num_lot) {
				
				$colonne = $this-> getNomColonneClient('num_lot', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $num_lot, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['num_lot'] = $num_lot;
			$requete = $connexion-> prepare("UPDATE dossier SET num_lot = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['num_lot'], $entree['id_dos']));

		} 
		public function MAJ_nbre_seal($id_dos, $nbre_seal){
			
			//Log
			if ($this-> getDossier($id_dos)['nbre_seal'] != $nbre_seal) {
				
				$colonne = $this-> getNomColonneClient('nbre_seal', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $nbre_seal, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['nbre_seal'] = $nbre_seal;
			$requete = $connexion-> prepare("UPDATE dossier SET nbre_seal = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['nbre_seal'], $entree['id_dos']));

		} 
		public function MAJ_dgda_seal($id_dos, $dgda_seal){
			
			//Log
			if ($this-> getDossier($id_dos)['dgda_seal'] != $dgda_seal) {
				
				$colonne = $this-> getNomColonneClient('dgda_seal', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dgda_seal, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dgda_seal'] = $dgda_seal;
			$requete = $connexion-> prepare("UPDATE dossier SET dgda_seal = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dgda_seal'], $entree['id_dos']));

		} 
		public function MAJ_dispatch_pweto($id_dos, $dispatch_pweto){
			
			//Log
			if ($this-> getDossier($id_dos)['dispatch_pweto'] != $dispatch_pweto) {
				
				$colonne = $this-> getNomColonneClient('dispatch_pweto', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $dispatch_pweto, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['dispatch_pweto'] = $dispatch_pweto;
			$requete = $connexion-> prepare("UPDATE dossier SET dispatch_pweto = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['dispatch_pweto'], $entree['id_dos']));

		} 
		public function MAJ_arrival_pweto($id_dos, $arrival_pweto){
			
			//Log
			if ($this-> getDossier($id_dos)['arrival_pweto'] != $arrival_pweto) {
				
				$colonne = $this-> getNomColonneClient('arrival_pweto', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $arrival_pweto, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['arrival_pweto'] = $arrival_pweto;
			$requete = $connexion-> prepare("UPDATE dossier SET arrival_pweto = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['arrival_pweto'], $entree['id_dos']));

		} 
		public function MAJ_barge_load($id_dos, $barge_load){
			
			//Log
			if ($this-> getDossier($id_dos)['barge_load'] != $barge_load) {
				
				$colonne = $this-> getNomColonneClient('barge_load', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $barge_load, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['barge_load'] = $barge_load;
			$requete = $connexion-> prepare("UPDATE dossier SET barge_load = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['barge_load'], $entree['id_dos']));

		} 
		public function MAJ_barge_dispatch_date($id_dos, $barge_dispatch_date){
			
			//Log
			if ($this-> getDossier($id_dos)['barge_dispatch_date'] != $barge_dispatch_date) {
				
				$colonne = $this-> getNomColonneClient('barge_dispatch_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $barge_dispatch_date, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['barge_dispatch_date'] = $barge_dispatch_date;
			$requete = $connexion-> prepare("UPDATE dossier SET barge_dispatch_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['barge_dispatch_date'], $entree['id_dos']));

		} 
		public function MAJ_doc_receiv($id_dos, $doc_receiv){
			
			//Log
			if ($this-> getDossier($id_dos)['doc_receiv'] != $doc_receiv) {
				
				$colonne = $this-> getNomColonneClient('doc_receiv', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $doc_receiv, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['doc_receiv'] = $doc_receiv;
			$requete = $connexion-> prepare("UPDATE dossier SET doc_receiv = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['doc_receiv'], $entree['id_dos']));

		} 

		public function MAJ_load_date($id_dos, $load_date){
			
			//Log
			if ($this-> getDossier($id_dos)['load_date'] != $load_date) {
				
				$colonne = $this-> getNomColonneClient('load_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $load_date, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['load_date'] = $load_date;
			$requete = $connexion-> prepare("UPDATE dossier SET load_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['load_date'], $entree['id_dos']));

		} 

		public function MAJ_nbr_bags($id_dos, $nbr_bags){
			
			//Log
			if ($this-> getDossier($id_dos)['nbr_bags'] != $nbr_bags) {
				
				$colonne = $this-> getNomColonneClient('nbr_bags', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $nbr_bags, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['nbr_bags'] = $nbr_bags;
			$requete = $connexion-> prepare("UPDATE dossier SET nbr_bags = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['nbr_bags'], $entree['id_dos']));

		} 
		public function MAJ_docs_sncc($id_dos, $docs_sncc){
			
			//Log
			if ($this-> getDossier($id_dos)['docs_sncc'] != $docs_sncc) {
				
				$colonne = $this-> getNomColonneClient('docs_sncc', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $docs_sncc, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['docs_sncc'] = $docs_sncc;
			$requete = $connexion-> prepare("UPDATE dossier SET docs_sncc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['docs_sncc'], $entree['id_dos']));

		} 
		public function MAJ_sncc_sakania($id_dos, $sncc_sakania){
			
			//Log
			if ($this-> getDossier($id_dos)['sncc_sakania'] != $sncc_sakania) {
				
				$colonne = $this-> getNomColonneClient('sncc_sakania', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $sncc_sakania, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['sncc_sakania'] = $sncc_sakania;
			$requete = $connexion-> prepare("UPDATE dossier SET sncc_sakania = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['sncc_sakania'], $entree['id_dos']));

		} 
		public function MAJ_sakania_date($id_dos, $sakania_date){
			
			//Log
			if ($this-> getDossier($id_dos)['sakania_date'] != $sakania_date) {
				
				$colonne = $this-> getNomColonneClient('sakania_date', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $sakania_date, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['sakania_date'] = $sakania_date;
			$requete = $connexion-> prepare("UPDATE dossier SET sakania_date = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['sakania_date'], $entree['id_dos']));

		} 
		public function MAJ_destination($id_dos, $destination){
			
			//Log
			if ($this-> getDossier($id_dos)['destination'] != $destination) {
				
				$colonne = $this-> getNomColonneClient('destination', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $destination, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['destination'] = $destination;
			$requete = $connexion-> prepare("UPDATE dossier SET destination = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['destination'], $entree['id_dos']));

		}
		public function MAJ_impala_sncc($id_dos, $impala_sncc){
			
			//Log
			if ($this-> getDossier($id_dos)['impala_sncc'] != $impala_sncc) {
				
				$colonne = $this-> getNomColonneClient('impala_sncc', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $impala_sncc, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['impala_sncc'] = $impala_sncc;
			$requete = $connexion-> prepare("UPDATE dossier SET impala_sncc = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['impala_sncc'], $entree['id_dos']));

		} 

		public function MAJ_barge($id_dos, $barge){
			
			//Log
			if ($this-> getDossier($id_dos)['barge'] != $barge) {
				
				$colonne = $this-> getNomColonneClient('barge', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $barge, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['barge'] = $barge;
			$requete = $connexion-> prepare("UPDATE dossier SET barge = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['barge'], $entree['id_dos']));

		} 

		public function MAJ_ship_num($id_dos, $ship_num){
			
			//Log
			if ($this-> getDossier($id_dos)['ship_num'] != $ship_num) {
				
				$colonne = $this-> getNomColonneClient('ship_num', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $ship_num, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ship_num'] = $ship_num;
			$requete = $connexion-> prepare("UPDATE dossier SET ship_num = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['ship_num'], $entree['id_dos']));

		} 

		public function MAJ_kapulo_load($id_dos, $kapulo_load){
			
			//Log
			if ($this-> getDossier($id_dos)['kapulo_load'] != $kapulo_load) {
				
				$colonne = $this-> getNomColonneClient('kapulo_load', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $kapulo_load, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['kapulo_load'] = $kapulo_load;
			$requete = $connexion-> prepare("UPDATE dossier SET kapulo_load = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['kapulo_load'], $entree['id_dos']));

		}

		public function MAJ_facture($id_dos, $facture){
			
			//Log
			if ($this-> getDossier($id_dos)['facture'] != $facture) {
				
				$colonne = $this-> getNomColonneClient('facture', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $facture, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['facture'] = $facture;
			$requete = $connexion-> prepare("UPDATE dossier SET facture = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['facture'], $entree['id_dos']));

		} 

		public function MAJ_bond_warehouse($id_dos, $bond_warehouse){
			
			//Log
			if ($this-> getDossier($id_dos)['bond_warehouse'] != $bond_warehouse) {
				
				$colonne = $this-> getNomColonneClient('bond_warehouse', $_GET['id_cli'], $_GET['id_mod_trans'], $_GET['id_mod_trac']);
				$this-> creerLogDossier($colonne, $bond_warehouse, $id_dos, $_SESSION['id_util']);

			}

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['bond_warehouse'] = $bond_warehouse;
			$requete = $connexion-> prepare("UPDATE dossier SET bond_warehouse = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['bond_warehouse'], $entree['id_dos']));

		} 

		/*public function MAJ_montant_av($id_dos, $montant_av){
			
			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['montant_av'] = $montant_av;
			$requete = $connexion-> prepare("UPDATE dossier SET montant_av = ?
												WHERE id_dos = ?");
			$requete-> execute(array($entree['montant_av'], $entree['id_dos']));

		} */

		public function MAJ_apurement_lic($num_lic, $apurement){
			
			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['apurement'] = $apurement;
			$requete = $connexion-> prepare("UPDATE licence SET apurement = ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['apurement'], $entree['num_lic']));

		} 
		
		public function MAJ_affichier_tracking($num_lic, $affichier_tracking){
			
			include('connexion.php');
			$entree['num_lic'] = $num_lic;
			$entree['affichier_tracking'] = $affichier_tracking;
			$requete = $connexion-> prepare("UPDATE licence SET affichier_tracking = ?
												WHERE num_lic = ?");
			$requete-> execute(array($entree['affichier_tracking'], $entree['num_lic']));

		} 

		/*
		MAJ dossier logistique
		*/

		public function MAJ_ref_mca_logistic($ref_dos, $ref_mca){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['ref_mca'] = $ref_mca;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET ref_mca = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['ref_mca'], $entree['ref_dos']));

		} 

		public function MAJ_road_manif_logistic($ref_dos, $road_manif){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['road_manif'] = $road_manif;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET road_manif = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['road_manif'], $entree['ref_dos']));

		} 

		public function MAJ_ref_fact_logistic($ref_dos, $ref_fact){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['ref_fact'] = $ref_fact;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET ref_fact = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['ref_fact'], $entree['ref_dos']));

		} 

		public function MAJ_ref_batch_logistic($ref_dos, $ref_batch){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['ref_batch'] = $ref_batch;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET ref_batch = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['ref_batch'], $entree['ref_dos']));

		} 

		public function MAJ_poids_logistic($ref_dos, $poids){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['poids'] = $poids;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET poids = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['poids'], $entree['ref_dos']));

		} 

		public function MAJ_ref_po_logistic($ref_dos, $ref_po){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['ref_po'] = $ref_po;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET ref_po = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['ref_po'], $entree['ref_dos']));

		} 

		public function MAJ_montant_po_logistic($ref_dos, $montant_po){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['montant_po'] = $montant_po;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET montant_po = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['montant_po'], $entree['ref_dos']));

		} 

		public function MAJ_origine_logistic($ref_dos, $origine){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['origine'] = $origine;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET origine = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['origine'], $entree['ref_dos']));

		} 

		public function MAJ_destination_logistic($ref_dos, $destination){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['destination'] = $destination;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET destination = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['destination'], $entree['ref_dos']));

		} 

		public function MAJ_date_dep_fbm_logistic($ref_dos, $date_dep_fbm){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['date_dep_fbm'] = $date_dep_fbm;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET date_dep_fbm = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['date_dep_fbm'], $entree['ref_dos']));

		} 

		public function MAJ_transit_logistic($ref_dos, $transit){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['transit'] = $transit;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET transit = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['transit'], $entree['ref_dos']));

		} 

		public function MAJ_date_transit_logistic($ref_dos, $date_transit){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['date_transit'] = $date_transit;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET date_transit = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['date_transit'], $entree['ref_dos']));

		} 

		public function MAJ_date_fd_logistic($ref_dos, $date_fd){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['date_fd'] = $date_fd;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET date_fd = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['date_fd'], $entree['ref_dos']));

		} 

		public function MAJ_deliv_date_logistic($ref_dos, $deliv_date){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['deliv_date'] = $deliv_date;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET deliv_date = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['deliv_date'], $entree['ref_dos']));

		} 

		public function MAJ_ref_pod_logistic($ref_dos, $ref_pod){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['ref_pod'] = $ref_pod;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET ref_pod = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['ref_pod'], $entree['ref_dos']));

		} 

		public function MAJ_statut_logistic($ref_dos, $statut){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['statut'] = $statut;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET statut = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['statut'], $entree['ref_dos']));

		} 

		public function MAJ_remarque_logistic($ref_dos, $remarque){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['remarque'] = $remarque;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET remarque = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['remarque'], $entree['ref_dos']));

		} 

		public function MAJ_point_load_logistic($ref_dos, $point_load){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['point_load'] = $point_load;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET point_load = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['point_load'], $entree['ref_dos']));

		} 
		public function MAJ_horse_logistic($ref_dos, $horse){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['horse'] = $horse;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET horse = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['horse'], $entree['ref_dos']));

		} 
		public function MAJ_trailer_1_logistic($ref_dos, $trailer_1){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['trailer_1'] = $trailer_1;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET trailer_1 = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['trailer_1'], $entree['ref_dos']));

		} 
		public function MAJ_nom_chauf_logistic($ref_dos, $nom_chauf){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['nom_chauf'] = $nom_chauf;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET nom_chauf = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['nom_chauf'], $entree['ref_dos']));

		} 
		public function MAJ_lic_num_logistic($ref_dos, $lic_num){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['lic_num'] = $lic_num;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET lic_num = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['lic_num'], $entree['ref_dos']));

		} 
		public function MAJ_tel_chauf_logistic($ref_dos, $tel_chauf){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['tel_chauf'] = $tel_chauf;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET tel_chauf = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['tel_chauf'], $entree['ref_dos']));

		} 
		public function MAJ_date_load_logistic($ref_dos, $date_load){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['date_load'] = $date_load;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET date_load = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['date_load'], $entree['ref_dos']));

		} 
		public function MAJ_date_dispatch_logistic($ref_dos, $date_dispatch){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['date_dispatch'] = $date_dispatch;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET date_dispatch = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['date_dispatch'], $entree['ref_dos']));

		} 
		public function MAJ_frontiere_logistic($ref_dos, $frontiere){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['frontiere'] = $frontiere;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET frontiere = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['frontiere'], $entree['ref_dos']));

		} 
		public function MAJ_front_in_logistic($ref_dos, $front_in){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['front_in'] = $front_in;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET front_in = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['front_in'], $entree['ref_dos']));

		}  
		public function MAJ_front_out_logistic($ref_dos, $front_out){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['front_out'] = $front_out;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET front_out = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['front_out'], $entree['ref_dos']));

		}  
		public function MAJ_localisation_logistic($ref_dos, $localisation){
			
			include('connexion.php');
			$entree['ref_dos'] = $ref_dos;
			$entree['localisation'] = $localisation;
			$requete = $connexion-> prepare("UPDATE dossier_logistique SET localisation = ?
												WHERE ref_dos = ?");
			$requete-> execute(array($entree['localisation'], $entree['ref_dos']));

		} 

		public function MAJ_send_mail_facture_dossier($ref_fact, $id_util_mail){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['id_util_mail'] = $id_util_mail;
			
			$requete = $connexion-> prepare("UPDATE facture_dossier SET id_util_mail = ?, date_mail = NOW()
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['id_util_mail'], $entree['ref_fact']));

		}

		public function MAJ_tax_duty_part_facture_dossier($ref_fact, $tax_duty_part){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['tax_duty_part'] = $tax_duty_part;
			
			$requete = $connexion-> prepare("UPDATE facture_dossier SET tax_duty_part = ?
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['tax_duty_part'], $entree['ref_fact']));

		}

		public function MAJ_validation_facture_dossier($ref_fact, $validation){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['validation'] = $validation;
			
			$requete = $connexion-> prepare("UPDATE facture_dossier SET validation = ?, id_util_validation = ?, date_validation = NOW()
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['validation'], $_SESSION['id_util'], $entree['ref_fact']));

		}

		public function MAJ_validation_note_debit($ref_note, $validation){

			include('connexion.php');
			$entree['ref_note'] = $ref_note;
			$entree['validation'] = $validation;
			
			$requete = $connexion-> prepare("UPDATE note_debit SET validation = ?, id_util_validation = ?, date_validation = NOW()
												WHERE ref_note = ?");
			$requete-> execute(array($entree['validation'], $_SESSION['id_util'], $entree['ref_note']));

		}

		public function MAJ_transmission_facture_dossier($ref_fact, $transmission, $id_util){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;
			$entree['transmission'] = $transmission;
			$entree['id_util'] = $id_util;
			$requete = $connexion-> prepare("UPDATE facture_dossier SET transmission = ?, id_util_transmis = ?, date_transmis = NOW()
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['transmission'], $entree['id_util'], $entree['ref_fact']));

		}

		//FIN Methodes permettant de mettre Ã  jour

		//Methode permettant de supprimer
		public function deleteLicenceUpload($id_mod_lic, $id_util){
			
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_util= '.$id_util;*/

			$requete = $connexion-> prepare("DELETE FROM licence_upload
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));

		} 

		public function supprimerFactureDossier($ref_fact){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  ref_fact= '.$ref_fact;*/

			$requete = $connexion-> prepare("DELETE FROM facture_dossier
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));

		}

		public function supprimer_mouvement_tresorerie($id_mvt){

			include('connexion.php');
			$entree['id_mvt'] = $id_mvt;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_mvt= '.$id_mvt;*/

			$requete = $connexion-> prepare("DELETE FROM mouvement_tresorerie
												WHERE id_mvt = ?");
			$requete-> execute(array($entree['id_mvt']));

		}

		public function supprimerDetailFactureDossier($ref_fact){

			include('connexion.php');
			$entree['ref_fact'] = $ref_fact;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  ref_fact= '.$ref_fact;*/

			$requete = $connexion-> prepare("DELETE FROM detail_facture_dossier
												WHERE ref_fact = ?");
			$requete-> execute(array($entree['ref_fact']));

		}

		public function supprimerDetailFactureDossier2($id_dos){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_dos= '.$id_dos;*/

			$requete = $connexion-> prepare("DELETE FROM detail_facture_dossier
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));

		}

		public function supprimerDetailFactureDossier3($ref_fact, $id_dos){

			include('connexion.php');
			$entree['id_dos'] = $id_dos;
			$entree['ref_fact'] = $ref_fact;

			$requete = $connexion-> prepare("DELETE FROM detail_facture_dossier
												WHERE id_dos = ?
													AND ref_fact = ?");
			$requete-> execute(array($entree['id_dos'], $entree['ref_fact']));

		}

		public function deleteDossierUpload($id_mod_lic, $id_util){
			
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_util= '.$id_util;*/

			$requete = $connexion-> prepare("DELETE FROM dossier_upload
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));

		} 

		public function deleteDossierUploadTracking($id_mod_lic, $id_util){
			
			include('connexion.php');
			$entree['id_mod_lic'] = $id_mod_lic;
			$entree['id_util'] = $id_util;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_util= '.$id_util;*/

			$requete = $connexion-> prepare("DELETE FROM dossier_upload_tracking
												WHERE id_mod_lic = ?
													AND id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_util']));

		} 

		public function deleteDossierEBUpload($id_util){
			
			include('connexion.php');
			$entree['id_util'] = $id_util;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_util= '.$id_util;*/

			$requete = $connexion-> prepare("DELETE FROM dossier_upload_export
												WHERE id_util = ?
													AND etat = '0'");
			$requete-> execute(array($entree['id_util']));

		} 

		public function deleteDossier($id_dos){
			
			include('connexion.php');
			$entree['id_dos'] = $id_dos;

			/*echo '<br>  id_mod_lic= '.$id_mod_lic;
			echo '<br>  id_dos= '.$id_dos;*/

			$requete = $connexion-> prepare("DELETE FROM dossier
												WHERE id_dos = ?");
			$requete-> execute(array($entree['id_dos']));

		} 

		public function getServiceFees(){
			
			include('connexion.php');
			$nbre = 0;

			$requete = $connexion-> query("SELECT *
												FROM debours
												WHERE nom_deb LIKE 'Service Fee %'");
			// $requete-> execute(array($entree['id_dos']));
			while($reponse = $requete-> fetch()){
				$nbre++;
				?>
				<tr>
					<td><?php echo $nbre;?></td>
					<td>
						<input type="hidden" name="id_deb_<?php echo $nbre;?>" value="<?php echo $reponse['id_deb'];?>">
						<input type="text" class="form-control form-control-sm" name="detail_<?php echo $nbre;?>">
					</td>
					<td>
						<input type="number" class="form-control form-control-sm text-center" name="unite_<?php echo $nbre;?>" value="1">
					</td>
					<td>
						<input type="number" class="form-control form-control-sm text-right" name="montant_<?php echo $nbre;?>">
					</td>
					<td>
						<select name="tva_<?php echo $nbre;?>" class="form-control text-dark form-control-sm">
		                  <option value="0">NO</option>
		                  <option value="1">YES</option>
		                </select>
					</td>
				</tr>
				<?php
			}$requete-> closeCursor();
			?>
			<input type="hidden" name="nbre" value="<?php echo $nbre;?>">
			<?php

		} 


		public function getNoteDebitAjax($id_cli, $id_mod_lic, $statut){
			include("connexion.php");
			$entree['id_cli'] = $id_cli;
			$entree['id_mod_lic'] = $id_mod_lic;
			//$entree['type_fact'] = $type_fact;
			$compteur=0;

			$bg = "";
			$badge = '';
			$btn = '';
			$etat ='';
			$tableau = '';

			$debut = $compteur;

			$rows = array();

			if ($statut=='debit_note_pending_validation') {
				$requete = $connexion-> prepare("SELECT note.ref_note AS ref_note,
													DATE_FORMAT(note.date_create, '%d/%m/%Y') AS date_note,
													dep.nom_dep AS nom_dep,
													CONCAT('<button class=\"btn btn-xs bg-info square-btn-adjust\" onclick=\"window.open(\'',mnd.view_note,'?ref_note=',note.ref_note,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View note\">
									                    <i class=\"fas fa-eye\"></i> 
									                </button> <button class=\"btn btn-xs bg-primary square-btn-adjust\" onclick=\"validerNoteDebit(\'',note.ref_note,'\');\" title=\"Validate\">
									                    <i class=\"fas fa-check\"></i> 
									                </button> 
									                </button> <button class=\"btn btn-xs bg-danger square-btn-adjust\" onclick=\"supprimerFacture(\'',note.ref_note,'\');\" title=\"Delete\">
									                    <i class=\"fas fa-times\"></i> 
									                </button>') AS action,
													SUM(IF(det.tva='1',
														det.montant*1.16,
														det.montant
													)) AS montant_ttc
 												FROM note_debit note, modele_note_debit mnd, affectation_modele_note_debit_client aff, depense dep, depense_dossier depdos, detail_note_debit det
												WHERE note.id_mod_lic = ?
													AND note.id_cli = ?
													AND note.validation = '0'
													AND note.id_cli = aff.id_cli
													AND aff.id_model_nd = mnd.id_model_nd
													AND note.ref_note = det.ref_note
													AND det.id_dep_dos = depdos.id_dep_dos
													AND depdos.id_dep = dep.id_dep
												GROUP BY note.ref_note
												ORDER BY note.date_create ASC");
			}else if ($statut=='debit_note_validated') {
				$requete = $connexion-> prepare("SELECT note.ref_note AS ref_note,
													DATE_FORMAT(note.date_create, '%d/%m/%Y') AS date_note,
													dep.nom_dep AS nom_dep,
													CONCAT('<button class=\"btn btn-xs bg-info square-btn-adjust\" onclick=\"window.open(\'',mnd.view_note,'?ref_note=',note.ref_note,'\',\'pop3\',\'width=1000,height=800\');\" title=\"View note\">
											                    <i class=\"fas fa-eye\"></i> 
											                </button>') AS action,
													SUM(IF(det.tva='1',
														det.montant*1.16,
														det.montant
													)) AS montant_ttc
 												FROM note_debit note, modele_note_debit mnd, affectation_modele_note_debit_client aff, depense dep, depense_dossier depdos, detail_note_debit det
												WHERE note.id_mod_lic = ?
													AND note.id_cli = ?
													AND note.validation = '1'
													AND note.id_cli = aff.id_cli
													AND aff.id_model_nd = mnd.id_model_nd
													AND note.ref_note = det.ref_note
													AND det.id_dep_dos = depdos.id_dep_dos
													AND depdos.id_dep = dep.id_dep
												GROUP BY note.ref_note
												ORDER BY note.validation DESC");
			}
			$requete-> execute(array($entree['id_mod_lic'], $entree['id_cli']));
			while ($reponse = $requete-> fetch()) {
				$compteur++;
				$reponse['compteur'] = $compteur;
				$rows[] = $reponse;
			}$requete-> closeCursor();
			return $rows;

		}

		//FIN Methode permettant de supprimer

	}
?>